{"version":3,"file":"i18n.js","sourceRoot":"","sources":["../src/ts/i18n.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * i18n.ts - Internationalization System\r\n *\r\n * Central translation system - TypeScript implementation.\r\n * Single Source of Truth for all translations in the portfolio.\r\n *\r\n * Translation data is organized in separate language files (de.ts, en.ts)\r\n * to keep this file focused on logic and type definitions.\r\n *\r\n * @module i18n\r\n */\r\n\r\n// ========================================\r\n// Imports\r\n// ========================================\r\n\r\nimport { de } from './i18n/de';\r\nimport { en } from './i18n/en';\r\n\r\n// ========================================\r\n// Type Definitions\r\n// ========================================\r\n\r\nexport type LanguageCode = 'de' | 'en';\r\nexport type LanguagePreference = 'system' | LanguageCode;\r\n\r\nexport interface TranslationParams {\r\n    [key: string]: string | number;\r\n}\r\n\r\nexport interface TranslateOptions {\r\n    language?: LanguageCode;\r\n    fallback?: string;\r\n}\r\n\r\ntype TranslationValue = string | TranslationDict;\r\n\r\ninterface TranslationDict {\r\n    [key: string]: TranslationValue;\r\n}\r\n\r\nexport interface AppI18n {\r\n    translate: (key: string, params?: TranslationParams, options?: TranslateOptions) => string;\r\n    applyTranslations: (root?: Document | Element) => void;\r\n    setLanguagePreference: (pref: LanguagePreference) => LanguageCode;\r\n    getLanguagePreference: () => LanguagePreference;\r\n    getActiveLanguage: () => LanguageCode;\r\n    translations: Record<LanguageCode, TranslationDict>;\r\n    supportedLanguages: readonly LanguageCode[];\r\n    languageOptions: readonly LanguagePreference[];\r\n}\r\n\r\ndeclare global {\r\n    interface Window {\r\n        appI18n: AppI18nAPI;\r\n    }\r\n}\r\n\r\n// ========================================\r\n// Constants\r\n// ========================================\r\n\r\nconst LANGUAGE_PREFERENCE_KEY = 'languagePreference';\r\nconst SUPPORTED_LANGUAGES: readonly LanguageCode[] = ['de', 'en'] as const;\r\nconst LANGUAGE_OPTIONS: readonly LanguagePreference[] = ['system', ...SUPPORTED_LANGUAGES] as const;\r\nconst FALLBACK_LANGUAGE: LanguageCode = 'en';\r\n\r\n// ========================================\r\n// Translation Database\r\n// ========================================\r\n\r\nconst translations: Record<LanguageCode, TranslationDict> = {\r\n    de,\r\n    en,\r\n};\r\n\r\n// ========================================\r\n// Language Detection & Management\r\n// ========================================\r\n\r\nfunction normalizeLanguage(input: unknown): LanguageCode | null {\r\n    if (!input) return null;\r\n    const value = String(input).trim().toLowerCase();\r\n    if (!value) return null;\r\n    const base = value.split(/[-_]/)[0] || '';\r\n    return (SUPPORTED_LANGUAGES as readonly string[]).includes(base)\r\n        ? (base as LanguageCode)\r\n        : null;\r\n}\r\n\r\nfunction parsePreference(value: unknown): LanguagePreference {\r\n    if (value === null || value === undefined) return 'system';\r\n    const normalized = String(value).trim();\r\n    return (LANGUAGE_OPTIONS as readonly string[]).includes(normalized)\r\n        ? (normalized as LanguagePreference)\r\n        : 'system';\r\n}\r\n\r\nfunction getBrowserLanguages(): string[] {\r\n    const langs: string[] = [];\r\n    if (Array.isArray(navigator.languages)) {\r\n        langs.push(...navigator.languages);\r\n    }\r\n    if (navigator.language) {\r\n        langs.push(navigator.language);\r\n    }\r\n    // Legacy IE support\r\n    const navWithUserLang = navigator as { userLanguage?: string };\r\n    if (navWithUserLang.userLanguage) {\r\n        langs.push(navWithUserLang.userLanguage);\r\n    }\r\n    return langs.length ? langs : ['en'];\r\n}\r\n\r\nfunction detectSystemLanguage(): LanguageCode {\r\n    const candidates = getBrowserLanguages();\r\n    for (const candidate of candidates) {\r\n        const normalized = normalizeLanguage(candidate);\r\n        if (normalized) {\r\n            return normalized;\r\n        }\r\n    }\r\n    return FALLBACK_LANGUAGE;\r\n}\r\n\r\n// ========================================\r\n// State Management\r\n// ========================================\r\n\r\nlet languagePreference: LanguagePreference = parsePreference(\r\n    typeof localStorage !== 'undefined' ? localStorage.getItem(LANGUAGE_PREFERENCE_KEY) : null\r\n);\r\n\r\nfunction resolveActiveLanguage(pref: LanguagePreference): LanguageCode {\r\n    if (pref === 'system') {\r\n        return detectSystemLanguage();\r\n    }\r\n    return (SUPPORTED_LANGUAGES as readonly string[]).includes(pref)\r\n        ? (pref as LanguageCode)\r\n        : FALLBACK_LANGUAGE;\r\n}\r\n\r\nlet activeLanguage: LanguageCode = resolveActiveLanguage(languagePreference);\r\n\r\nfunction setDocumentLanguage(lang: LanguageCode): void {\r\n    if (typeof document !== 'undefined' && document.documentElement) {\r\n        document.documentElement.lang = lang;\r\n    }\r\n}\r\n\r\n// ========================================\r\n// Translation Functions\r\n// ========================================\r\n\r\nfunction formatTemplate(template: string, params?: TranslationParams): string {\r\n    if (typeof template !== 'string') {\r\n        return template;\r\n    }\r\n    if (!params || typeof params !== 'object') {\r\n        return template;\r\n    }\r\n    return template.replace(/\\{([^}]+)\\}/g, (match, token) => {\r\n        const key = token.trim();\r\n        return Object.prototype.hasOwnProperty.call(params, key) ? String(params[key]) : match;\r\n    });\r\n}\r\n\r\nfunction resolveKey(lang: LanguageCode, key: string): unknown {\r\n    const segments = key.split('.');\r\n    let current: unknown = translations[lang];\r\n    for (const segment of segments) {\r\n        if (!current || typeof current !== 'object' || !(segment in current)) {\r\n            return undefined;\r\n        }\r\n        current = (current as Record<string, unknown>)[segment];\r\n    }\r\n    return current;\r\n}\r\n\r\nexport function translate(\r\n    key: string,\r\n    params: TranslationParams = {},\r\n    options: TranslateOptions = {}\r\n): string {\r\n    if (!key) return '';\r\n    const lang = options.language || activeLanguage;\r\n    let value = resolveKey(lang, key);\r\n    if (value === undefined && lang !== FALLBACK_LANGUAGE) {\r\n        value = resolveKey(FALLBACK_LANGUAGE, key);\r\n    }\r\n    if (value === undefined) {\r\n        return options.fallback !== undefined ? options.fallback : key;\r\n    }\r\n    if (typeof value === 'string') {\r\n        return formatTemplate(value, params);\r\n    }\r\n    return String(value);\r\n}\r\n\r\n// ========================================\r\n// DOM Translation\r\n// ========================================\r\n\r\nfunction parseParams(element: Element): TranslationParams | undefined {\r\n    const paramsAttr = element.getAttribute('data-i18n-params');\r\n    if (!paramsAttr) {\r\n        return undefined;\r\n    }\r\n    try {\r\n        return JSON.parse(paramsAttr) as TranslationParams;\r\n    } catch (err) {\r\n        console.warn('Could not parse data-i18n-params:', err);\r\n        return undefined;\r\n    }\r\n}\r\n\r\nfunction translateElement(element: Element): void {\r\n    if (!(element instanceof Element)) {\r\n        return;\r\n    }\r\n    const params = parseParams(element) || {};\r\n    const textKey = element.getAttribute('data-i18n');\r\n    if (textKey) {\r\n        element.textContent = translate(textKey, params);\r\n    }\r\n    const htmlKey = element.getAttribute('data-i18n-html');\r\n    if (htmlKey) {\r\n        element.innerHTML = translate(htmlKey, params);\r\n    }\r\n    Array.from(element.attributes).forEach(attr => {\r\n        if (!attr.name.startsWith('data-i18n-')) return;\r\n        if (attr.name === 'data-i18n' || attr.name === 'data-i18n-html') return;\r\n        const targetAttr = attr.name.substring('data-i18n-'.length);\r\n        if (!targetAttr) return;\r\n        element.setAttribute(targetAttr, translate(attr.value, params));\r\n    });\r\n}\r\n\r\nexport function applyTranslations(root: Document | Element = document): void {\r\n    if (!root) return;\r\n    const base = root === document ? document.documentElement : root;\r\n    if (!base || !(base instanceof Element)) return;\r\n    translateElement(base);\r\n    const elements = base.querySelectorAll('*');\r\n    elements.forEach(translateElement);\r\n}\r\n\r\n// ========================================\r\n// Language Change Management\r\n// ========================================\r\n\r\nfunction dispatchLanguageEvent(): void {\r\n    if (typeof window === 'undefined') return;\r\n    const event = new CustomEvent('languagePreferenceChange', {\r\n        detail: {\r\n            preference: languagePreference,\r\n            language: activeLanguage,\r\n        },\r\n    });\r\n    window.dispatchEvent(event);\r\n}\r\n\r\nfunction refreshActiveLanguage(emitEvent = true): void {\r\n    const nextLanguage = resolveActiveLanguage(languagePreference);\r\n    const languageChanged = nextLanguage !== activeLanguage;\r\n    activeLanguage = nextLanguage;\r\n    setDocumentLanguage(activeLanguage);\r\n    applyTranslations(document);\r\n    if (emitEvent || languageChanged) {\r\n        dispatchLanguageEvent();\r\n    }\r\n}\r\n\r\nexport function setLanguagePreference(pref: LanguagePreference): LanguageCode {\r\n    const normalized = parsePreference(pref);\r\n    if (normalized === languagePreference) {\r\n        refreshActiveLanguage(true);\r\n        return activeLanguage;\r\n    }\r\n    languagePreference = normalized;\r\n    if (typeof localStorage !== 'undefined') {\r\n        if (normalized === 'system') {\r\n            localStorage.setItem(LANGUAGE_PREFERENCE_KEY, 'system');\r\n        } else {\r\n            localStorage.setItem(LANGUAGE_PREFERENCE_KEY, normalized);\r\n        }\r\n    }\r\n    refreshActiveLanguage(true);\r\n    return activeLanguage;\r\n}\r\n\r\nexport function getLanguagePreference(): LanguagePreference {\r\n    return languagePreference;\r\n}\r\n\r\nexport function getActiveLanguage(): LanguageCode {\r\n    return activeLanguage;\r\n}\r\n\r\n// ========================================\r\n// Browser Event Listeners\r\n// ========================================\r\n\r\nif (typeof window !== 'undefined') {\r\n    window.addEventListener('languagechange', () => {\r\n        if (languagePreference === 'system') {\r\n            refreshActiveLanguage(true);\r\n        }\r\n    });\r\n\r\n    window.addEventListener('storage', (event: StorageEvent) => {\r\n        if (event.key !== LANGUAGE_PREFERENCE_KEY) {\r\n            return;\r\n        }\r\n        const newPreference = parsePreference(event.newValue);\r\n        languagePreference = newPreference;\r\n        refreshActiveLanguage(true);\r\n    });\r\n}\r\n\r\n// ========================================\r\n// Initialization\r\n// ========================================\r\n\r\nif (typeof document !== 'undefined') {\r\n    setDocumentLanguage(activeLanguage);\r\n\r\n    if (document.readyState === 'loading') {\r\n        document.addEventListener('DOMContentLoaded', () => applyTranslations(document));\r\n    } else {\r\n        applyTranslations(document);\r\n    }\r\n}\r\n\r\n// ========================================\r\n// Global API Export\r\n// ========================================\r\n\r\nexport const appI18n: AppI18n = {\r\n    translate,\r\n    applyTranslations,\r\n    setLanguagePreference,\r\n    getLanguagePreference,\r\n    getActiveLanguage,\r\n    translations,\r\n    supportedLanguages: SUPPORTED_LANGUAGES,\r\n    languageOptions: LANGUAGE_OPTIONS,\r\n};\r\n\r\n// Expose to global window object\r\nif (typeof window !== 'undefined') {\r\n    window.appI18n = appI18n;\r\n}\r\n"]}