{"version":3,"file":"app-init.js","sourceRoot":"","sources":["../src/ts/app-init.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Application Initialization Module\r\n * Handles DOMContentLoaded setup and modal initialization.\r\n * \r\n * This module centralizes application bootstrap logic that was previously\r\n * in the DOMContentLoaded handler in app.js.\r\n * \r\n * @module app-init\r\n */\r\n\r\n// Export to make this a proper module for global augmentation\r\nexport {};\r\n\r\n/**\r\n * Global window interface extensions for app initialization\r\n */\r\ndeclare global {\r\n    interface Window {\r\n        initApp?: () => void;\r\n    }\r\n}\r\n\r\n/**\r\n * Type helper for WindowManager\r\n */\r\ninterface IWindowManager {\r\n    getAllWindowIds?: () => string[];\r\n    getTransientWindowIds?: () => string[];\r\n    setDialogInstance?: (id: string, instance: unknown) => void;\r\n}\r\n\r\n/**\r\n * Type helper for Dialog class\r\n */\r\ninterface IDialog {\r\n    new (id: string): unknown;\r\n}\r\n\r\n/**\r\n * Type helper for external module functions\r\n */\r\ninterface GlobalModules {\r\n    ActionBus?: {\r\n        init?: () => void;\r\n    };\r\n    Dialog?: IDialog;\r\n    FinderSystem?: {\r\n        init?: () => void;\r\n    };\r\n    SettingsSystem?: {\r\n        init?: (container: HTMLElement) => void;\r\n    };\r\n    TextEditorSystem?: {\r\n        init?: (container: HTMLElement) => void;\r\n    };\r\n    TerminalSystem?: {\r\n        init?: (container: HTMLElement) => void;\r\n    };\r\n    TerminalInstanceManager?: unknown;\r\n    DockSystem?: {\r\n        initDockDragDrop?: () => void;\r\n    };\r\n}\r\n\r\n/**\r\n * Initialize modal IDs from WindowManager or fallback to default list\r\n * @returns Object containing modalIds array and transientModalIds set\r\n */\r\nfunction initModalIds(): { modalIds: string[]; transientModalIds: Set<string> } {\r\n    const win = window as Window & { WindowManager?: IWindowManager; APP_CONSTANTS?: { MODAL_IDS?: string[]; TRANSIENT_MODAL_IDS?: Set<string> } };\r\n    \r\n    if (win.WindowManager) {\r\n        const modalIds = win.WindowManager.getAllWindowIds?.() || [];\r\n        const transientIds = win.WindowManager.getTransientWindowIds?.() || [];\r\n        return {\r\n            modalIds,\r\n            transientModalIds: new Set(transientIds),\r\n        };\r\n    } else {\r\n        // Fallback\r\n        const modalIds = win.APP_CONSTANTS?.MODAL_IDS || [\r\n            'finder-modal',\r\n            'projects-modal',\r\n            'about-modal',\r\n            'settings-modal',\r\n            'text-modal',\r\n            'terminal-modal',\r\n            'image-modal',\r\n            'program-info-modal',\r\n        ];\r\n        const transientModalIds = win.APP_CONSTANTS?.TRANSIENT_MODAL_IDS || new Set(['program-info-modal']);\r\n        return { modalIds, transientModalIds };\r\n    }\r\n}\r\n\r\n/**\r\n * Main application initialization function.\r\n * Called automatically on DOMContentLoaded.\r\n * Sets up dialog instances, ActionBus, and initializes all subsystems.\r\n */\r\nfunction initApp(): void {\r\n    const win = window as Window & GlobalModules & { WindowManager?: IWindowManager };\r\n    const funcs = window as Window & {\r\n        hideMenuDropdowns?: () => void;\r\n        bringDialogToFront?: (id: string) => void;\r\n        updateProgramLabelByTopModal?: () => void;\r\n        syncTopZIndexWithDOM?: () => void;\r\n        restoreWindowPositions?: () => void;\r\n        restoreOpenModals?: () => void;\r\n        loadGithubRepos?: () => void;\r\n        initSystemStatusControls?: () => void;\r\n        initDesktop?: () => void;\r\n        initDockMagnification?: () => void;\r\n    };\r\n\r\n    // Modal-IDs initialisieren\r\n    const { modalIds } = initModalIds();\r\n\r\n    // ActionBus initialisieren\r\n    if (win.ActionBus) {\r\n        win.ActionBus.init?.();\r\n    }\r\n\r\n    // Wenn auf einen sichtbaren Modalcontainer geklickt wird, hole das Fenster in den Vordergrund\r\n    document.querySelectorAll('.modal').forEach((modal) => {\r\n        modal.addEventListener('click', function (e) {\r\n            // Verhindere, dass Klicks auf interaktive Elemente im Modal den Fokuswechsel stören.\r\n            const target = e.target as Node;\r\n            if (e.target === modal || modal.contains(target)) {\r\n                funcs.hideMenuDropdowns?.();\r\n                funcs.bringDialogToFront?.(modal.id);\r\n                funcs.updateProgramLabelByTopModal?.();\r\n            }\r\n        });\r\n    });\r\n\r\n    // Dialog-Instanzen erstellen und im WindowManager registrieren\r\n    const dialogs = window.dialogs || {};\r\n    window.dialogs = dialogs;\r\n    if (modalIds && Array.isArray(modalIds)) {\r\n        modalIds.forEach((id) => {\r\n            const modal = document.getElementById(id);\r\n            if (!modal || !win.Dialog) return;\r\n            const dialogInstance = new win.Dialog(id);\r\n            dialogs[id] = dialogInstance as unknown as Record<string, unknown>;\r\n\r\n            // Im WindowManager registrieren\r\n            if (win.WindowManager) {\r\n                win.WindowManager.setDialogInstance?.(id, dialogInstance);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Add click-outside-to-close functionality for launchpad\r\n    const launchpadModal = document.getElementById('launchpad-modal');\r\n    if (launchpadModal) {\r\n        launchpadModal.addEventListener('click', function (e) {\r\n            // Check if the click is on the modal background (not on the inner content)\r\n            if (e.target === launchpadModal) {\r\n                const launchpadDialog = dialogs['launchpad-modal'] as { close?: () => void };\r\n                launchpadDialog?.close?.();\r\n            }\r\n        });\r\n    }\r\n\r\n    funcs.syncTopZIndexWithDOM?.();\r\n    funcs.restoreWindowPositions?.();\r\n    funcs.restoreOpenModals?.();\r\n    funcs.loadGithubRepos?.();\r\n    funcs.initSystemStatusControls?.();\r\n    funcs.initDesktop?.();\r\n\r\n    // Finder initialisieren nach Dialog-Setup\r\n    if (win.FinderSystem && typeof win.FinderSystem.init === 'function') {\r\n        win.FinderSystem.init();\r\n    }\r\n\r\n    // Initialize settings module\r\n    if (win.SettingsSystem) {\r\n        const settingsContainer = document.getElementById('settings-container');\r\n        if (settingsContainer) {\r\n            win.SettingsSystem.init?.(settingsContainer);\r\n        }\r\n    }\r\n\r\n    // Initialize text editor module\r\n    if (win.TextEditorSystem) {\r\n        const textEditorContainer = document.getElementById('text-editor-container');\r\n        if (textEditorContainer) {\r\n            win.TextEditorSystem.init?.(textEditorContainer);\r\n        }\r\n    }\r\n\r\n    // Initialize terminal module (legacy) only when multi‑instance is not available\r\n    // Prevents duplicate inputs causing E2E strict-mode locator conflicts\r\n    if (!win.TerminalInstanceManager && win.TerminalSystem) {\r\n        const terminalContainer = document.getElementById('terminal-container');\r\n        if (terminalContainer) {\r\n            win.TerminalSystem.init?.(terminalContainer);\r\n        }\r\n    }\r\n\r\n    funcs.initDockMagnification?.();\r\n    if (win.DockSystem && typeof win.DockSystem.initDockDragDrop === 'function') {\r\n        win.DockSystem.initDockDragDrop();\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// IIFE Export Pattern - Expose initApp globally and auto-attach to DOMContentLoaded\r\n// ============================================================================\r\n\r\n(() => {\r\n    if (typeof window.initApp !== 'function') {\r\n        window.initApp = initApp;\r\n    }\r\n    \r\n    // Auto-attach to DOMContentLoaded\r\n    if (document.readyState === 'loading') {\r\n        document.addEventListener('DOMContentLoaded', initApp);\r\n    } else {\r\n        // DOMContentLoaded already fired, run immediately\r\n        initApp();\r\n    }\r\n})();\r\n"]}