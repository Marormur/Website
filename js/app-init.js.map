{"version":3,"file":"app-init.js","sourceRoot":"","sources":["../src/ts/app-init.ts"],"names":[],"mappings":";AAAA;;;;;;;;GAQG;;AAsEH;;;GAGG;AACH,SAAS,YAAY;IACjB,MAAM,GAAG,GAAG,MAGX,CAAC;IAEF,IAAI,GAAG,CAAC,aAAa,EAAE,CAAC;QACpB,MAAM,QAAQ,GAAG,GAAG,CAAC,aAAa,CAAC,eAAe,EAAE,EAAE,IAAI,EAAE,CAAC;QAC7D,MAAM,YAAY,GAAG,GAAG,CAAC,aAAa,CAAC,qBAAqB,EAAE,EAAE,IAAI,EAAE,CAAC;QACvE,OAAO;YACH,QAAQ;YACR,iBAAiB,EAAE,IAAI,GAAG,CAAC,YAAY,CAAC;SAC3C,CAAC;IACN,CAAC;SAAM,CAAC;QACJ,WAAW;QACX,MAAM,QAAQ,GAAG,GAAG,CAAC,aAAa,EAAE,SAAS,IAAI;YAC7C,gBAAgB;YAChB,aAAa;YACb,gBAAgB;YAChB,YAAY;YACZ,gBAAgB;YAChB,aAAa;YACb,oBAAoB;SACvB,CAAC;QACF,MAAM,iBAAiB,GACnB,GAAG,CAAC,aAAa,EAAE,mBAAmB,IAAI,IAAI,GAAG,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC;QAC9E,OAAO,EAAE,QAAQ,EAAE,iBAAiB,EAAE,CAAC;IAC3C,CAAC;AACL,CAAC;AAED;;;;GAIG;AACH,SAAS,OAAO;IACZ,MAAM,GAAG,GAAG,MAAqE,CAAC;IAClF,MAAM,KAAK,GAAG,MAUb,CAAC;IAEF,2BAA2B;IAC3B,MAAM,EAAE,QAAQ,EAAE,GAAG,YAAY,EAAE,CAAC;IAEpC,2BAA2B;IAC3B,IAAI,GAAG,CAAC,SAAS,EAAE,CAAC;QAChB,GAAG,CAAC,SAAS,CAAC,IAAI,EAAE,EAAE,CAAC;IAC3B,CAAC;IAED,8FAA8F;IAC9F,QAAQ,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;QAChD,KAAK,CAAC,gBAAgB,CAAC,OAAO,EAAE,UAAU,CAAC;YACvC,qFAAqF;YACrF,MAAM,MAAM,GAAG,CAAC,CAAC,MAAc,CAAC;YAChC,IAAI,CAAC,CAAC,MAAM,KAAK,KAAK,IAAI,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC;gBAC/C,KAAK,CAAC,iBAAiB,EAAE,EAAE,CAAC;gBAC5B,KAAK,CAAC,kBAAkB,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;gBACrC,KAAK,CAAC,4BAA4B,EAAE,EAAE,CAAC;YAC3C,CAAC;QACL,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,+DAA+D;IAC/D,MAAM,OAAO,GAAG,MAAM,CAAC,OAAO,IAAI,EAAE,CAAC;IACrC,MAAM,CAAC,OAAO,GAAG,OAAO,CAAC;IACzB,IAAI,QAAQ,IAAI,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC;QACtC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC,EAAE;YAClB,MAAM,KAAK,GAAG,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC;YAC1C,IAAI,CAAC,KAAK,IAAI,CAAC,GAAG,CAAC,MAAM;gBAAE,OAAO;YAElC,IAAI,CAAC;gBACD,MAAM,cAAc,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;gBAC1C,OAAO,CAAC,EAAE,CAAC,GAAG,cAAoD,CAAC;gBAEnE,gCAAgC;gBAChC,IAAI,GAAG,CAAC,aAAa,EAAE,CAAC;oBACpB,GAAG,CAAC,aAAa,CAAC,iBAAiB,EAAE,CAAC,EAAE,EAAE,cAAc,CAAC,CAAC;gBAC9D,CAAC;YACL,CAAC;YAAC,OAAO,GAAG,EAAE,CAAC;gBACX,OAAO,CAAC,KAAK,CAAC,yCAAyC,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC;YACxE,CAAC;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IAED,yDAAyD;IACzD,MAAM,cAAc,GAAG,QAAQ,CAAC,cAAc,CAAC,iBAAiB,CAAC,CAAC;IAClE,IAAI,cAAc,EAAE,CAAC;QACjB,mFAAmF;QACnF,cAAc,CAAC,gBAAgB,CAAC,OAAO,EAAE,UAAU,CAAC;YAChD,IAAI,CAAC;gBACD,MAAM,KAAK,GAAG,cAAc,CAAC,aAAa,CAAC,wBAAwB,CAAC,CAAC;gBACrE,MAAM,MAAM,GAAG,CAAC,CAAC,MAAc,CAAC;gBAChC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,KAAK,cAAc,EAAE,CAAC;oBAC9D,MAAM,eAAe,GAAG,OAAO,CAAC,iBAAiB,CAA2B,CAAC;oBAC7E,eAAe,EAAE,KAAK,EAAE,EAAE,CAAC;gBAC/B,CAAC;YACL,CAAC;YAAC,MAAM,CAAC;gBACL,YAAY;YAChB,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,yFAAyF;QACzF,yFAAyF;QACzF,QAAQ,CAAC,gBAAgB,CACrB,OAAO,EACP,UAAU,CAAC;YACP,IAAI,CAAC;gBACD,6CAA6C;gBAC7C,IAAI,cAAc,CAAC,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC;oBAAE,OAAO;gBACxD,MAAM,KAAK,GAAG,cAAc,CAAC,aAAa,CAAC,wBAAwB,CAAC,CAAC;gBACrE,MAAM,MAAM,GAAG,CAAC,CAAC,MAAc,CAAC;gBAChC,IAAI,KAAK,IAAI,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC;oBAAE,OAAO,CAAC,0BAA0B;gBACvE,MAAM,eAAe,GAAG,OAAO,CAAC,iBAAiB,CAA2B,CAAC;gBAC7E,eAAe,EAAE,KAAK,EAAE,EAAE,CAAC;YAC/B,CAAC;YAAC,MAAM,CAAC;gBACL,YAAY;YAChB,CAAC;QACL,CAAC,EACD,IAAI,CACP,CAAC;IACN,CAAC;IAED,KAAK,CAAC,oBAAoB,EAAE,EAAE,CAAC;IAC/B,KAAK,CAAC,sBAAsB,EAAE,EAAE,CAAC;IACjC,yEAAyE;IAErE,MACH,CAAC,6BAA6B,GAAG,IAAI,CAAC;IACvC,KAAK,CAAC,iBAAiB,EAAE,EAAE,CAAC;IAC5B,KAAK,CAAC,wBAAwB,EAAE,EAAE,CAAC;IAEnC,2BAA2B;IAC3B,IAAI,GAAG,CAAC,aAAa,EAAE,CAAC;QACpB,GAAG,CAAC,aAAa,CAAC,WAAW,EAAE,EAAE,CAAC;IACtC,CAAC;IAED,0CAA0C;IAC1C,2EAA2E;IAC3E,yEAAyE;IACzE,+BAA+B;IAC/B,IAAI;IAEJ,6BAA6B;IAC7B,IAAI,GAAG,CAAC,cAAc,EAAE,CAAC;QACrB,MAAM,iBAAiB,GAAG,QAAQ,CAAC,cAAc,CAAC,oBAAoB,CAAC,CAAC;QACxE,IAAI,iBAAiB,EAAE,CAAC;YACpB,GAAG,CAAC,cAAc,CAAC,IAAI,EAAE,CAAC,iBAAiB,CAAC,CAAC;QACjD,CAAC;IACL,CAAC;IAED,gCAAgC;IAChC,IAAI,GAAG,CAAC,gBAAgB,EAAE,CAAC;QACvB,MAAM,mBAAmB,GAAG,QAAQ,CAAC,cAAc,CAAC,uBAAuB,CAAC,CAAC;QAC7E,IAAI,mBAAmB,EAAE,CAAC;YACtB,GAAG,CAAC,gBAAgB,CAAC,IAAI,EAAE,CAAC,mBAAmB,CAAC,CAAC;QACrD,CAAC;IACL,CAAC;IAED,gFAAgF;IAChF,sEAAsE;IACtE,IAAI,CAAC,GAAG,CAAC,uBAAuB,IAAI,GAAG,CAAC,cAAc,EAAE,CAAC;QACrD,MAAM,iBAAiB,GAAG,QAAQ,CAAC,cAAc,CAAC,oBAAoB,CAAC,CAAC;QACxE,IAAI,iBAAiB,EAAE,CAAC;YACpB,GAAG,CAAC,cAAc,CAAC,IAAI,EAAE,CAAC,iBAAiB,CAAC,CAAC;QACjD,CAAC;IACL,CAAC;IAED,KAAK,CAAC,qBAAqB,EAAE,EAAE,CAAC;IAChC,IAAI,GAAG,CAAC,UAAU,IAAI,OAAO,GAAG,CAAC,UAAU,CAAC,gBAAgB,KAAK,UAAU,EAAE,CAAC;QAC1E,GAAG,CAAC,UAAU,CAAC,gBAAgB,EAAE,CAAC;IACtC,CAAC;IAED,oDAAoD;IACpD,IAAI,GAAG,CAAC,cAAc,EAAE,CAAC;QACrB,GAAG,CAAC,cAAc,CAAC,IAAI,EAAE,EAAE,CAAC;IAChC,CAAC;IAED,yCAAyC;IACzC,IAAI,GAAG,CAAC,yBAAyB,EAAE,CAAC;QAChC,IAAI,CAAC;YACD,8EAA8E;YAC9E,IAAI,mBAAmB,GAAG,KAAK,CAAC;YAEhC,6BAA6B;YAC7B,IAAI,CAAC;gBACD,MAAM,WAAW,GAAG,YAAY,CAAC,OAAO,CAAC,sBAAsB,CAAC,CAAC;gBACjE,IAAI,WAAW,EAAE,CAAC;oBACd,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;oBACxC,OAAO,CAAC,GAAG,CAAC,wCAAwC,EAAE;wBAClD,WAAW,EAAE,OAAO,CAAC,OAAO,EAAE,MAAM,IAAI,CAAC;wBACzC,OAAO,EAAE,OAAO,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,CAAM,EAAE,EAAE,CAAC,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC,IAAI,EAAE,EAAE,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,IAAI,EAAE;qBAChF,CAAC,CAAC;oBAEH,mDAAmD;oBACnD,IAAI,OAAO,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,GAAG,EAAE,EAAE,CAAC;wBACjD,OAAO,CAAC,IAAI,CACR,8DAA8D,CACjE,CAAC;wBACF,mBAAmB,GAAG,IAAI,CAAC;oBAC/B,CAAC;oBACD,iEAAiE;oBACjE,MAAM,SAAS,GAAG,IAAI,GAAG,EAAE,CAAC;oBAC5B,IAAI,OAAO,CAAC,OAAO,EAAE,CAAC;wBAClB,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAM,EAAE,EAAE;4BAC/B,MAAM,KAAK,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;4BACzC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,EAAE,KAAK,GAAG,CAAC,CAAC,CAAC;wBACrC,CAAC,CAAC,CAAC;wBACH,KAAK,MAAM,CAAC,IAAI,EAAE,KAAK,CAAC,IAAI,SAAS,CAAC,OAAO,EAAE,EAAE,CAAC;4BAC9C,IAAI,KAAK,GAAG,CAAC,EAAE,CAAC;gCACZ,OAAO,CAAC,IAAI,CACR,uCAAuC,KAAK,IAAI,IAAI,2BAA2B,CAClF,CAAC;gCACF,mBAAmB,GAAG,IAAI,CAAC;gCAC3B,MAAM;4BACV,CAAC;wBACL,CAAC;oBACL,CAAC;gBACL,CAAC;YACL,CAAC;YAAC,MAAM,CAAC;gBACL,0BAA0B;gBAC1B,mBAAmB,GAAG,IAAI,CAAC;YAC/B,CAAC;YAED,uBAAuB;YACvB,IAAI,CAAC;gBACD,MAAM,UAAU,GAAG,YAAY,CAAC,OAAO,CAAC,wBAAwB,CAAC,CAAC;gBAClE,OAAO,CAAC,GAAG,CAAC,mCAAmC,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC;gBAE/D,IAAI,UAAU,EAAE,CAAC;oBACb,MAAM,aAAa,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;oBAC7C,OAAO,CAAC,GAAG,CAAC,kCAAkC,EAAE;wBAC5C,aAAa,EAAE,aAAa,CAAC,SAAS,EAAE,MAAM,IAAI,CAAC;wBACnD,SAAS,EACL,aAAa,CAAC,SAAS,EAAE,GAAG,CAAC,CAAC,CAAM,EAAE,EAAE,CAAC,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC,IAAI,EAAE,EAAE,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,IAAI,EAAE;qBACnF,CAAC,CAAC;oBAEH,IAAI,iBAAiB,GAAG,KAAK,CAAC;oBAE9B,IAAI,aAAa,CAAC,SAAS,IAAI,aAAa,CAAC,SAAS,CAAC,MAAM,GAAG,EAAE,EAAE,CAAC;wBACjE,OAAO,CAAC,IAAI,CAAC,0DAA0D,CAAC,CAAC;wBACzE,iBAAiB,GAAG,IAAI,CAAC;oBAC7B,CAAC;oBACD,2CAA2C;oBAC3C,MAAM,SAAS,GAAG,IAAI,GAAG,EAAE,CAAC;oBAC5B,IAAI,aAAa,CAAC,SAAS,EAAE,CAAC;wBAC1B,aAAa,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,IAAS,EAAE,EAAE;4BAC1C,MAAM,KAAK,GAAG,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;4BAC5C,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,GAAG,CAAC,CAAC,CAAC;wBACxC,CAAC,CAAC,CAAC;wBACH,KAAK,MAAM,CAAC,IAAI,EAAE,KAAK,CAAC,IAAI,SAAS,CAAC,OAAO,EAAE,EAAE,CAAC;4BAC9C,IAAI,KAAK,GAAG,CAAC,EAAE,CAAC;gCACZ,OAAO,CAAC,IAAI,CACR,iCAAiC,KAAK,IAAI,IAAI,6BAA6B,CAC9E,CAAC;gCACF,iBAAiB,GAAG,IAAI,CAAC;gCACzB,MAAM;4BACV,CAAC;wBACL,CAAC;oBACL,CAAC;oBAED,IAAI,iBAAiB,EAAE,CAAC;wBACpB,OAAO,CAAC,IAAI,CAAC,qDAAqD,CAAC,CAAC;wBACpE,YAAY,CAAC,UAAU,CAAC,wBAAwB,CAAC,CAAC;oBACtD,CAAC;gBACL,CAAC;YACL,CAAC;YAAC,OAAO,GAAG,EAAE,CAAC;gBACX,2CAA2C;gBAC3C,OAAO,CAAC,IAAI,CAAC,kCAAkC,EAAE,GAAG,CAAC,CAAC;gBACtD,OAAO,CAAC,IAAI,CACR,0EAA0E,CAC7E,CAAC;gBACF,YAAY,CAAC,UAAU,CAAC,wBAAwB,CAAC,CAAC;YACtD,CAAC;YAED,2FAA2F;YAC3F,IAAI,mBAAmB,EAAE,CAAC;gBACtB,OAAO,CAAC,IAAI,CAAC,sDAAsD,CAAC,CAAC;gBACrE,YAAY,CAAC,UAAU,CAAC,sBAAsB,CAAC,CAAC;YACpD,CAAC;YAED,GAAG,CAAC,yBAAyB,CAAC,IAAI,EAAE,EAAE,CAAC;YACvC,OAAO,CAAC,GAAG,CAAC,kDAAkD,CAAC,CAAC;YAEhE,0CAA0C;YAC1C,UAAU,CAAC,KAAK,IAAI,EAAE;gBAClB,IAAI,CAAC;oBACD,IAAI,GAAG,CAAC,yBAAyB,EAAE,cAAc,EAAE,CAAC;wBAChD,MAAM,QAAQ,GAAG,MAAM,GAAG,CAAC,yBAAyB,CAAC,cAAc,EAAE,CAAC;wBACtE,IAAI,QAAQ,EAAE,CAAC;4BACX,OAAO,CAAC,GAAG,CAAC,0CAA0C,CAAC,CAAC;wBAC5D,CAAC;oBACL,CAAC;gBACL,CAAC;gBAAC,OAAO,GAAG,EAAE,CAAC;oBACX,OAAO,CAAC,IAAI,CAAC,iDAAiD,EAAE,GAAG,CAAC,CAAC;gBACzE,CAAC;YACL,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,yCAAyC;QACtD,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACX,OAAO,CAAC,IAAI,CAAC,6DAA6D,EAAE,GAAG,CAAC,CAAC;QACrF,CAAC;IACL,CAAC;IAED,kFAAkF;IAClF,IAAI,GAAG,CAAC,cAAc,EAAE,CAAC;QACrB,IAAI,CAAC;YACD,GAAG,CAAC,cAAc,CAAC,IAAI,EAAE,EAAE,CAAC;YAC5B,gEAAgE;YAChE,4DAA4D;YAC5D,UAAU,CAAC,GAAG,EAAE;gBACZ,IAAI,CAAC;oBACD,IAAI,GAAG,CAAC,cAAc,EAAE,cAAc,EAAE,CAAC;wBACrC,GAAG,CAAC,cAAc,CAAC,cAAc,EAAE,CAAC;oBACxC,CAAC;gBACL,CAAC;wBAAS,CAAC;oBACP,+DAA+D;oBAE3D,MAIH,CAAC,6BAA6B,GAAG,KAAK,CAAC;oBAEpC,MACH,CAAC,sBAAsB,GAAG,IAAI,CAAC;gBACpC,CAAC;YACL,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,+CAA+C;QAC5D,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACX,OAAO,CAAC,IAAI,CAAC,uCAAuC,EAAE,GAAG,CAAC,CAAC;QAC/D,CAAC;IACL,CAAC;IAED,2EAA2E;IAC3E,yEAAyE;IACzE,uEAAuE;IACvE,4DAA4D;IAC5D,IAAI,CAAC;QACD,MAAM,MAAM,GAAG,QAAQ,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;QAC/C,IAAI,MAAM,EAAE,CAAC;YACT,IAAI,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC;gBAAE,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;YAC3E,2DAA2D;YAC3D,MAAM,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC,KAAK,CAAC,OAAO,IAAI,EAAE,CAAC;YAClD,MAAM,CAAC,KAAK,CAAC,UAAU,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU,IAAI,SAAS,CAAC;QACnE,CAAC;IACL,CAAC;IAAC,MAAM,CAAC;QACL,8BAA8B;IAClC,CAAC;IAED,uEAAuE;IACvE,4EAA4E;IAC5E,yEAAyE;IACzE,yEAAyE;IACzE,uEAAuE;IACvE,aAAa;IACb,IAAI,CAAC;QACD,MAAM,MAAM,GAAG,QAAQ,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;QAC/C,IAAI,MAAM,IAAI,MAAM,CAAC,aAAa,IAAI,MAAM,CAAC,aAAa,KAAK,QAAQ,CAAC,IAAI,EAAE,CAAC;YAC3E,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;YAClC,OAAO,CAAC,IAAI,CAAC,qEAAqE,CAAC,CAAC;QACxF,CAAC;IACL,CAAC;IAAC,MAAM,CAAC;QACL,YAAY;IAChB,CAAC;IAED,sEAAsE;IACtE,mEAAmE;IACnE,kEAAkE;IAClE,0DAA0D;IAC1D,IAAI,CAAC;QACD,MAAM,kBAAkB,GAAG,GAAG,EAAE;YAC5B,IAAI,CAAC;gBACD,MAAM,MAAM,GAAG,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAkB,CAAC;gBAChF,IAAI,KAAK,GAAG,KAAK,CAAC;gBAClB,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;oBACf,IAAI,CAAC,CAAC,aAAa,IAAI,CAAC,CAAC,aAAa,KAAK,QAAQ,CAAC,IAAI,EAAE,CAAC;wBACvD,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;wBAC7B,KAAK,GAAG,IAAI,CAAC;oBACjB,CAAC;gBACL,CAAC,CAAC,CAAC;gBACH,IAAI,KAAK;oBACL,OAAO,CAAC,IAAI,CACR,kEAAkE,CACrE,CAAC;gBACN,OAAO,KAAK,CAAC;YACjB,CAAC;YAAC,MAAM,CAAC;gBACL,OAAO,KAAK,CAAC;YACjB,CAAC;QACL,CAAC,CAAC;QAEF,kBAAkB,EAAE,CAAC;QACrB,UAAU,CAAC,kBAAkB,EAAE,EAAE,CAAC,CAAC;QACnC,UAAU,CAAC,kBAAkB,EAAE,GAAG,CAAC,CAAC;QACpC,UAAU,CAAC,kBAAkB,EAAE,GAAG,CAAC,CAAC;IACxC,CAAC;IAAC,MAAM,CAAC;QACL,YAAY;IAChB,CAAC;IAED,yEAAyE;IACzE,yEAAyE;IACzE,IAAI,CAAC;QACD,MAAM,MAAM,GAAG,QAAQ,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;QAC/C,IAAI,MAAM,EAAE,CAAC;YACT,MAAM,IAAI,GAAG,MAAM,CAAC,qBAAqB,EAAE,CAAC;YAC5C,MAAM,EAAE,GAAG,MAAM,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;YAC3C,OAAO,CAAC,IAAI,CAAC,wBAAwB,EAAE;gBACnC,SAAS,EAAE,MAAM,CAAC,SAAS;gBAC3B,OAAO,EAAE,EAAE,CAAC,OAAO;gBACnB,UAAU,EAAE,EAAE,CAAC,UAAU;gBACzB,OAAO,EAAE,EAAE,CAAC,OAAO;gBACnB,KAAK,EAAE,IAAI,CAAC,KAAK;gBACjB,MAAM,EAAE,IAAI,CAAC,MAAM;gBACnB,GAAG,EAAE,IAAI,CAAC,GAAG;gBACb,IAAI,EAAE,IAAI,CAAC,IAAI;gBACf,UAAU,EAAE,IAAI,CAAC,GAAG,GAAG,CAAC,MAAM,CAAC,WAAW,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC;aACtE,CAAC,CAAC;YACH,qEAAqE;YACrE,gEAAgE;YAChE,qCAAqC;YACrC,IAAI,CAAC;gBACD,MAAM,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC;oBACvB,SAAS,EAAE,MAAM,CAAC,SAAS;oBAC3B,OAAO,EAAE,EAAE,CAAC,OAAO;oBACnB,UAAU,EAAE,EAAE,CAAC,UAAU;oBACzB,OAAO,EAAE,EAAE,CAAC,OAAO;oBACnB,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC;oBAC7B,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC;oBAC/B,GAAG,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC;oBACzB,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC;oBAC3B,UAAU,EAAE,IAAI,CAAC,GAAG,GAAG,CAAC,MAAM,CAAC,WAAW,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC;iBACtE,CAAC,CAAC;gBACH,MAAM,CAAC,YAAY,CAAC,iBAAiB,EAAE,GAAG,CAAC,CAAC;YAChD,CAAC;YAAC,MAAM,CAAC;gBACL,aAAa;YACjB,CAAC;QACL,CAAC;aAAM,CAAC;YACJ,OAAO,CAAC,IAAI,CAAC,0CAA0C,CAAC,CAAC;QAC7D,CAAC;IACL,CAAC;IAAC,OAAO,CAAC,EAAE,CAAC;QACT,OAAO,CAAC,IAAI,CAAC,8BAA8B,EAAE,CAAC,CAAC,CAAC;IACpD,CAAC;IAED,8CAA8C;IAC9C,sEAAsE;IACtE,kEAAkE;IAClE,iEAAiE;IACjE,sCAAsC;IACtC,MAAM,EAAE,GAAG,MAA4C,CAAC;IACxD,SAAS,SAAS;QACd,IAAI,CAAC;YACD,iEAAiE;YACjE,iEAAiE;YACjE,kEAAkE;YAClE,+BAA+B;YAC/B,MAAM,gBAAgB,GAAG,GAAG,EAAE;gBAC1B,IAAI,CAAC;oBACD,MAAM,MAAM,GAAG,QAAQ,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;oBAC/C,IAAI,MAAM,IAAI,MAAM,CAAC,aAAa,IAAI,MAAM,CAAC,aAAa,KAAK,QAAQ,CAAC,IAAI,EAAE,CAAC;wBAC3E,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;wBAClC,OAAO,CAAC,IAAI,CAAC,2DAA2D,CAAC,CAAC;wBAC1E,OAAO,IAAI,CAAC;oBAChB,CAAC;gBACL,CAAC;gBAAC,MAAM,CAAC;oBACL,YAAY;gBAChB,CAAC;gBACD,OAAO,KAAK,CAAC;YACjB,CAAC,CAAC;YAEF,sEAAsE;YACtE,sDAAsD;YACtD,gBAAgB,EAAE,CAAC;YACnB,UAAU,CAAC,gBAAgB,EAAE,EAAE,CAAC,CAAC;YACjC,UAAU,CAAC,gBAAgB,EAAE,GAAG,CAAC,CAAC;YAClC,UAAU,CAAC,gBAAgB,EAAE,GAAG,CAAC,CAAC;YAElC,wEAAwE;YACxE,0EAA0E;YAC1E,wEAAwE;YACxE,kDAAkD;YAClD,2CAA2C;YAC3C,iDAAiD;YACjD,kDAAkD;YAElD,MAAM,GAAG,GAAG,MAAa,CAAC;YAE1B,iEAAiE;YACjE,IAAI,OAAO,GAAG,CAAC,SAAS,KAAK,WAAW,IAAI,GAAG,CAAC,WAAW,KAAK,SAAS,EAAE,CAAC;gBACxE,IAAI,CAAC;oBACD,+EAA+E;oBAC/E,4CAA4C;oBAC5C,MAAM,MAAM,GAAG,GAAG,EAAE;wBAChB,wDAAwD;wBACxD,IAAI,GAAG,CAAC,uBAAuB,EAAE,gBAAgB,EAAE,EAAE,EAAE,CAAC;4BACpD,0DAA0D;4BAC1D,OAAO,IAAI,CAAC;wBAChB,CAAC;wBACD,OAAO,KAAK,CAAC;oBACjB,CAAC,CAAC;oBACF,2CAA2C;oBAC3C,GAAG,CAAC,iBAAiB,GAAG,MAAM,EAAE,CAAC;oBACjC,OAAO,CAAC,IAAI,CAAC,2CAA2C,CAAC,CAAC;gBAC9D,CAAC;gBAAC,OAAO,CAAC,EAAE,CAAC;oBACT,OAAO,CAAC,KAAK,CAAC,wCAAwC,EAAG,CAAW,CAAC,OAAO,CAAC,CAAC;gBAClF,CAAC;YACL,CAAC;YAED,uDAAuD;YACvD,IAAI,GAAG,CAAC,cAAc,EAAE,CAAC;gBACrB,GAAG,CAAC,gBAAgB,GAAG,GAAG,CAAC,cAAc,CAAC;gBAC1C,OAAO,CAAC,IAAI,CAAC,uDAAuD,CAAC,CAAC;YAC1E,CAAC;YAED,8CAA8C;YAC9C,IAAI,GAAG,CAAC,YAAY,EAAE,CAAC;gBACnB,GAAG,CAAC,cAAc,GAAG,GAAG,CAAC,YAAY,CAAC;gBACtC,OAAO,CAAC,IAAI,CAAC,mDAAmD,CAAC,CAAC;YACtE,CAAC;YAED,kDAAkD;YAClD,IAAI,GAAG,CAAC,cAAc,EAAE,CAAC;gBACrB,GAAG,CAAC,gBAAgB,GAAG,GAAG,CAAC,cAAc,CAAC;gBAC1C,OAAO,CAAC,IAAI,CAAC,uDAAuD,CAAC,CAAC;YAC1E,CAAC;YAED,oDAAoD;YACpD,IAAI,GAAG,CAAC,eAAe,EAAE,CAAC;gBACtB,GAAG,CAAC,iBAAiB,GAAG,GAAG,CAAC,eAAe,CAAC;gBAC5C,OAAO,CAAC,IAAI,CAAC,yDAAyD,CAAC,CAAC;YAC5E,CAAC;YAED,kDAAkD;YAClD,IAAI,GAAG,CAAC,cAAc,EAAE,CAAC;gBACrB,GAAG,CAAC,gBAAgB,GAAG,GAAG,CAAC,cAAc,CAAC;gBAC1C,OAAO,CAAC,IAAI,CAAC,uDAAuD,CAAC,CAAC;YAC1E,CAAC;YAED,2EAA2E;YAC3E,IAAI,GAAG,CAAC,cAAc,EAAE,CAAC;gBACrB,OAAO,CAAC,IAAI,CAAC,8CAA8C,CAAC,CAAC;YACjE,CAAC;YAED,0CAA0C;YAC1C,IAAI,GAAG,CAAC,UAAU,EAAE,CAAC;gBACjB,GAAG,CAAC,YAAY,GAAG,GAAG,CAAC,UAAU,CAAC;gBAClC,OAAO,CAAC,IAAI,CAAC,+CAA+C,CAAC,CAAC;YAClE,CAAC;YAED,yCAAyC;YACzC,IAAI,GAAG,CAAC,SAAS,EAAE,CAAC;gBAChB,GAAG,CAAC,WAAW,GAAG,GAAG,CAAC,SAAS,CAAC;gBAChC,OAAO,CAAC,IAAI,CAAC,6CAA6C,CAAC,CAAC;YAChE,CAAC;YAED,EAAE,CAAC,WAAW,GAAG,IAAI,CAAC;YACtB,OAAO,CAAC,IAAI,CAAC,6BAA6B,CAAC,CAAC;QAChD,CAAC;QAAC,MAAM,CAAC;YACL,aAAa;QACjB,CAAC;IACL,CAAC;IAED,IAAI,QAAQ,CAAC,UAAU,KAAK,UAAU,EAAE,CAAC;QACrC,qBAAqB;QACrB,SAAS,EAAE,CAAC;IAChB,CAAC;SAAM,CAAC;QACJ,MAAM,CAAC,gBAAgB,CAAC,MAAM,EAAE,SAAS,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;QAC3D,6EAA6E;QAC7E,2EAA2E;QAC3E,UAAU,CAAC,GAAG,EAAE;YACZ,IAAI,CAAC,EAAE,CAAC,WAAW,EAAE,CAAC;gBAClB,OAAO,CAAC,IAAI,CACR,wEAAwE,CAC3E,CAAC;gBACF,SAAS,EAAE,CAAC;YAChB,CAAC;QACL,CAAC,EAAE,IAAI,CAAC,CAAC;IACb,CAAC;AACL,CAAC;AAED,+EAA+E;AAC/E,oFAAoF;AACpF,+EAA+E;AAE/E,CAAC,GAAG,EAAE;IACF,IAAI,OAAO,MAAM,CAAC,OAAO,KAAK,UAAU,EAAE,CAAC;QACvC,MAAM,CAAC,OAAO,GAAG,OAAO,CAAC;IAC7B,CAAC;IAED,kCAAkC;IAClC,IAAI,QAAQ,CAAC,UAAU,KAAK,SAAS,EAAE,CAAC;QACpC,QAAQ,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,OAAO,CAAC,CAAC;IAC3D,CAAC;SAAM,CAAC;QACJ,kDAAkD;QAClD,OAAO,EAAE,CAAC;IACd,CAAC;AACL,CAAC,CAAC,EAAE,CAAC","sourcesContent":["/**\r\n * Application Initialization Module\r\n * Handles DOMContentLoaded setup and modal initialization.\r\n *\r\n * This module centralizes application bootstrap logic that was previously\r\n * in the DOMContentLoaded handler in app.js.\r\n *\r\n * @module app-init\r\n */\r\n\r\n// Export to make this a proper module for global augmentation\r\nexport {};\r\n\r\n/**\r\n * Global window interface extensions for app initialization\r\n */\r\ndeclare global {\r\n    interface Window {\r\n        initApp?: () => void;\r\n    }\r\n}\r\n\r\n/**\r\n * Type helper for WindowManager\r\n */\r\ninterface IWindowManager {\r\n    getAllWindowIds?: () => string[];\r\n    getTransientWindowIds?: () => string[];\r\n    setDialogInstance?: (id: string, instance: unknown) => void;\r\n}\r\n\r\n/**\r\n * Type helper for Dialog class\r\n */\r\ninterface IDialog {\r\n    new (id: string): unknown;\r\n}\r\n\r\n/**\r\n * Type helper for external module functions\r\n */\r\ninterface GlobalModules {\r\n    ActionBus?: {\r\n        init?: () => void;\r\n    };\r\n    DesktopSystem?: {\r\n        initDesktop?: () => void;\r\n    };\r\n    Dialog?: IDialog;\r\n    FinderSystem?: {\r\n        init?: () => void;\r\n    };\r\n    SettingsSystem?: {\r\n        init?: (container: HTMLElement) => void;\r\n    };\r\n    TextEditorSystem?: {\r\n        init?: (container: HTMLElement) => void;\r\n    };\r\n    TerminalSystem?: {\r\n        init?: (container: HTMLElement) => void;\r\n    };\r\n    TerminalInstanceManager?: unknown;\r\n    DockSystem?: {\r\n        initDockDragDrop?: () => void;\r\n    };\r\n    SessionManager?: {\r\n        init?: () => void;\r\n        restoreSession?: () => boolean;\r\n    };\r\n    MultiWindowSessionManager?: {\r\n        init?: () => void;\r\n        restoreSession?: () => Promise<boolean>;\r\n    };\r\n    WindowRegistry?: {\r\n        init?: () => void;\r\n    };\r\n}\r\n\r\n/**\r\n * Initialize modal IDs from WindowManager or fallback to default list\r\n * @returns Object containing modalIds array and transientModalIds set\r\n */\r\nfunction initModalIds(): { modalIds: string[]; transientModalIds: Set<string> } {\r\n    const win = window as Window & {\r\n        WindowManager?: IWindowManager;\r\n        APP_CONSTANTS?: { MODAL_IDS?: string[]; TRANSIENT_MODAL_IDS?: Set<string> };\r\n    };\r\n\r\n    if (win.WindowManager) {\r\n        const modalIds = win.WindowManager.getAllWindowIds?.() || [];\r\n        const transientIds = win.WindowManager.getTransientWindowIds?.() || [];\r\n        return {\r\n            modalIds,\r\n            transientModalIds: new Set(transientIds),\r\n        };\r\n    } else {\r\n        // Fallback\r\n        const modalIds = win.APP_CONSTANTS?.MODAL_IDS || [\r\n            'projects-modal',\r\n            'about-modal',\r\n            'settings-modal',\r\n            'text-modal',\r\n            'terminal-modal',\r\n            'image-modal',\r\n            'program-info-modal',\r\n        ];\r\n        const transientModalIds =\r\n            win.APP_CONSTANTS?.TRANSIENT_MODAL_IDS || new Set(['program-info-modal']);\r\n        return { modalIds, transientModalIds };\r\n    }\r\n}\r\n\r\n/**\r\n * Main application initialization function.\r\n * Called automatically on DOMContentLoaded.\r\n * Sets up dialog instances, ActionBus, and initializes all subsystems.\r\n */\r\nfunction initApp(): void {\r\n    const win = window as Window & GlobalModules & { WindowManager?: IWindowManager };\r\n    const funcs = window as Window & {\r\n        hideMenuDropdowns?: () => void;\r\n        bringDialogToFront?: (id: string) => void;\r\n        updateProgramLabelByTopModal?: () => void;\r\n        syncTopZIndexWithDOM?: () => void;\r\n        restoreWindowPositions?: () => void;\r\n        restoreOpenModals?: () => void;\r\n        initSystemStatusControls?: () => void;\r\n        initDesktop?: () => void;\r\n        initDockMagnification?: () => void;\r\n    };\r\n\r\n    // Modal-IDs initialisieren\r\n    const { modalIds } = initModalIds();\r\n\r\n    // ActionBus initialisieren\r\n    if (win.ActionBus) {\r\n        win.ActionBus.init?.();\r\n    }\r\n\r\n    // Wenn auf einen sichtbaren Modalcontainer geklickt wird, hole das Fenster in den Vordergrund\r\n    document.querySelectorAll('.modal').forEach(modal => {\r\n        modal.addEventListener('click', function (e) {\r\n            // Verhindere, dass Klicks auf interaktive Elemente im Modal den Fokuswechsel stören.\r\n            const target = e.target as Node;\r\n            if (e.target === modal || modal.contains(target)) {\r\n                funcs.hideMenuDropdowns?.();\r\n                funcs.bringDialogToFront?.(modal.id);\r\n                funcs.updateProgramLabelByTopModal?.();\r\n            }\r\n        });\r\n    });\r\n\r\n    // Dialog-Instanzen erstellen und im WindowManager registrieren\r\n    const dialogs = window.dialogs || {};\r\n    window.dialogs = dialogs;\r\n    if (modalIds && Array.isArray(modalIds)) {\r\n        modalIds.forEach(id => {\r\n            const modal = document.getElementById(id);\r\n            if (!modal || !win.Dialog) return;\r\n\r\n            try {\r\n                const dialogInstance = new win.Dialog(id);\r\n                dialogs[id] = dialogInstance as unknown as Record<string, unknown>;\r\n\r\n                // Im WindowManager registrieren\r\n                if (win.WindowManager) {\r\n                    win.WindowManager.setDialogInstance?.(id, dialogInstance);\r\n                }\r\n            } catch (err) {\r\n                console.error(`Failed to create dialog instance for \"${id}\":`, err);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Add click-outside-to-close functionality for launchpad\r\n    const launchpadModal = document.getElementById('launchpad-modal');\r\n    if (launchpadModal) {\r\n        // Primary: close when clicking outside the inner content within the modal wrapper.\r\n        launchpadModal.addEventListener('click', function (e) {\r\n            try {\r\n                const inner = launchpadModal.querySelector('.launchpad-modal-inner');\r\n                const target = e.target as Node;\r\n                if (inner ? !inner.contains(target) : target === launchpadModal) {\r\n                    const launchpadDialog = dialogs['launchpad-modal'] as { close?: () => void };\r\n                    launchpadDialog?.close?.();\r\n                }\r\n            } catch {\r\n                /* ignore */\r\n            }\r\n        });\r\n\r\n        // Fallback: capture-phase handler to close even when the wrapper has pointer-events:none\r\n        // and clicks are dispatched to underlying elements (e.g., tests using page.mouse.click).\r\n        document.addEventListener(\r\n            'click',\r\n            function (e) {\r\n                try {\r\n                    // Only act if launchpad is currently visible\r\n                    if (launchpadModal.classList.contains('hidden')) return;\r\n                    const inner = launchpadModal.querySelector('.launchpad-modal-inner');\r\n                    const target = e.target as Node;\r\n                    if (inner && inner.contains(target)) return; // clicked inside → ignore\r\n                    const launchpadDialog = dialogs['launchpad-modal'] as { close?: () => void };\r\n                    launchpadDialog?.close?.();\r\n                } catch {\r\n                    /* ignore */\r\n                }\r\n            },\r\n            true\r\n        );\r\n    }\r\n\r\n    funcs.syncTopZIndexWithDOM?.();\r\n    funcs.restoreWindowPositions?.();\r\n    // Suppress default init handlers while we restore previously open modals\r\n    (\r\n        window as unknown as { __SESSION_RESTORE_IN_PROGRESS?: boolean }\r\n    ).__SESSION_RESTORE_IN_PROGRESS = true;\r\n    funcs.restoreOpenModals?.();\r\n    funcs.initSystemStatusControls?.();\r\n\r\n    // Initialize desktop icons\r\n    if (win.DesktopSystem) {\r\n        win.DesktopSystem.initDesktop?.();\r\n    }\r\n\r\n    // Finder initialisieren nach Dialog-Setup\r\n    // DISABLED: Using Multi-Window FinderWindow instead of legacy FinderSystem\r\n    // if (win.FinderSystem && typeof win.FinderSystem.init === 'function') {\r\n    //     win.FinderSystem.init();\r\n    // }\r\n\r\n    // Initialize settings module\r\n    if (win.SettingsSystem) {\r\n        const settingsContainer = document.getElementById('settings-container');\r\n        if (settingsContainer) {\r\n            win.SettingsSystem.init?.(settingsContainer);\r\n        }\r\n    }\r\n\r\n    // Initialize text editor module\r\n    if (win.TextEditorSystem) {\r\n        const textEditorContainer = document.getElementById('text-editor-container');\r\n        if (textEditorContainer) {\r\n            win.TextEditorSystem.init?.(textEditorContainer);\r\n        }\r\n    }\r\n\r\n    // Initialize terminal module (legacy) only when multi‑instance is not available\r\n    // Prevents duplicate inputs causing E2E strict-mode locator conflicts\r\n    if (!win.TerminalInstanceManager && win.TerminalSystem) {\r\n        const terminalContainer = document.getElementById('terminal-container');\r\n        if (terminalContainer) {\r\n            win.TerminalSystem.init?.(terminalContainer);\r\n        }\r\n    }\r\n\r\n    funcs.initDockMagnification?.();\r\n    if (win.DockSystem && typeof win.DockSystem.initDockDragDrop === 'function') {\r\n        win.DockSystem.initDockDragDrop();\r\n    }\r\n\r\n    // Initialize WindowRegistry for multi-window system\r\n    if (win.WindowRegistry) {\r\n        win.WindowRegistry.init?.();\r\n    }\r\n\r\n    // Initialize Multi-Window SessionManager\r\n    if (win.MultiWindowSessionManager) {\r\n        try {\r\n            // SAFETY: Check BOTH sessions (new multi-window + legacy) before initializing\r\n            let shouldClearSessions = false;\r\n\r\n            // Check multi-window session\r\n            try {\r\n                const sessionData = localStorage.getItem('multi-window-session');\r\n                if (sessionData) {\r\n                    const session = JSON.parse(sessionData);\r\n                    console.log('[APP-INIT] Found multi-window session:', {\r\n                        windowCount: session.windows?.length || 0,\r\n                        windows: session.windows?.map((w: any) => ({ type: w.type, id: w.id })) || [],\r\n                    });\r\n\r\n                    // Clear if too many windows (indicates corruption)\r\n                    if (session.windows && session.windows.length > 10) {\r\n                        console.warn(\r\n                            '[APP-INIT] Multi-window session corrupted (too many windows)'\r\n                        );\r\n                        shouldClearSessions = true;\r\n                    }\r\n                    // Also check for duplicate types (e.g., multiple finder windows)\r\n                    const typeCount = new Map();\r\n                    if (session.windows) {\r\n                        session.windows.forEach((w: any) => {\r\n                            const count = typeCount.get(w.type) || 0;\r\n                            typeCount.set(w.type, count + 1);\r\n                        });\r\n                        for (const [type, count] of typeCount.entries()) {\r\n                            if (count > 3) {\r\n                                console.warn(\r\n                                    `[APP-INIT] Multi-window session has ${count} ${type} windows (max 3 per type)`\r\n                                );\r\n                                shouldClearSessions = true;\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            } catch {\r\n                // Invalid JSON - clear it\r\n                shouldClearSessions = true;\r\n            }\r\n\r\n            // Check legacy session\r\n            try {\r\n                const legacyData = localStorage.getItem('windowInstancesSession');\r\n                console.log('[APP-INIT] Legacy session exists?', !!legacyData);\r\n\r\n                if (legacyData) {\r\n                    const legacySession = JSON.parse(legacyData);\r\n                    console.log('[APP-INIT] Found legacy session:', {\r\n                        instanceCount: legacySession.instances?.length || 0,\r\n                        instances:\r\n                            legacySession.instances?.map((i: any) => ({ type: i.type, id: i.id })) || [],\r\n                    });\r\n\r\n                    let shouldClearLegacy = false;\r\n\r\n                    if (legacySession.instances && legacySession.instances.length > 10) {\r\n                        console.warn('[APP-INIT] Legacy session corrupted (too many instances)');\r\n                        shouldClearLegacy = true;\r\n                    }\r\n                    // Also check for duplicate types in legacy\r\n                    const typeCount = new Map();\r\n                    if (legacySession.instances) {\r\n                        legacySession.instances.forEach((inst: any) => {\r\n                            const count = typeCount.get(inst.type) || 0;\r\n                            typeCount.set(inst.type, count + 1);\r\n                        });\r\n                        for (const [type, count] of typeCount.entries()) {\r\n                            if (count > 3) {\r\n                                console.warn(\r\n                                    `[APP-INIT] Legacy session has ${count} ${type} instances (max 3 per type)`\r\n                                );\r\n                                shouldClearLegacy = true;\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (shouldClearLegacy) {\r\n                        console.warn('[APP-INIT] Clearing ONLY legacy session (corrupted)');\r\n                        localStorage.removeItem('windowInstancesSession');\r\n                    }\r\n                }\r\n            } catch (err) {\r\n                // Invalid JSON - clear ONLY legacy session\r\n                console.warn('[APP-INIT] Legacy session error:', err);\r\n                console.warn(\r\n                    '[APP-INIT] Clearing ONLY legacy session (multi-window session preserved)'\r\n                );\r\n                localStorage.removeItem('windowInstancesSession');\r\n            }\r\n\r\n            // Clear multi-window session if corrupted (legacy session already cleared above if needed)\r\n            if (shouldClearSessions) {\r\n                console.warn('[APP-INIT] Clearing multi-window session (corrupted)');\r\n                localStorage.removeItem('multi-window-session');\r\n            }\r\n\r\n            win.MultiWindowSessionManager.init?.();\r\n            console.log('[APP-INIT] MultiWindowSessionManager initialized');\r\n\r\n            // Attempt to restore multi-window session\r\n            setTimeout(async () => {\r\n                try {\r\n                    if (win.MultiWindowSessionManager?.restoreSession) {\r\n                        const restored = await win.MultiWindowSessionManager.restoreSession();\r\n                        if (restored) {\r\n                            console.log('[APP-INIT] Multi-window session restored');\r\n                        }\r\n                    }\r\n                } catch (err) {\r\n                    console.warn('[APP-INIT] Multi-window session restore failed:', err);\r\n                }\r\n            }, 150); // Delay to ensure all managers are ready\r\n        } catch (err) {\r\n            console.warn('[APP-INIT] MultiWindowSessionManager initialization failed:', err);\r\n        }\r\n    }\r\n\r\n    // Initialize legacy SessionManager for auto-save and restore session if available\r\n    if (win.SessionManager) {\r\n        try {\r\n            win.SessionManager.init?.();\r\n            // Attempt to restore session after all managers are initialized\r\n            // This happens after Terminal/TextEditor managers are ready\r\n            setTimeout(() => {\r\n                try {\r\n                    if (win.SessionManager?.restoreSession) {\r\n                        win.SessionManager.restoreSession();\r\n                    }\r\n                } finally {\r\n                    // Mark restore finished so initHandlers can run normally again\r\n                    (\r\n                        window as unknown as {\r\n                            __SESSION_RESTORE_IN_PROGRESS?: boolean;\r\n                            __SESSION_RESTORE_DONE?: boolean;\r\n                        }\r\n                    ).__SESSION_RESTORE_IN_PROGRESS = false;\r\n                    (\r\n                        window as unknown as { __SESSION_RESTORE_DONE?: boolean }\r\n                    ).__SESSION_RESTORE_DONE = true;\r\n                }\r\n            }, 100); // Small delay to ensure all managers are ready\r\n        } catch (err) {\r\n            console.warn('SessionManager initialization failed:', err);\r\n        }\r\n    }\r\n\r\n    // Defensive: ensure the dock is visible. Some environments or timing races\r\n    // can leave the dock with hidden/display styles that make it \"invisible\"\r\n    // to Playwright checks. Remove any accidental 'hidden' class and reset\r\n    // inline visibility/display so tests can interact reliably.\r\n    try {\r\n        const dockEl = document.getElementById('dock');\r\n        if (dockEl) {\r\n            if (dockEl.classList.contains('hidden')) dockEl.classList.remove('hidden');\r\n            // Reset common inline properties that may hide the element\r\n            dockEl.style.display = dockEl.style.display || '';\r\n            dockEl.style.visibility = dockEl.style.visibility || 'visible';\r\n        }\r\n    } catch {\r\n        // non-fatal; continue startup\r\n    }\r\n\r\n    // Defensive DOM fix: if the dock has been accidentally placed inside a\r\n    // modal wrapper (for example due to malformed HTML or runtime reparenting),\r\n    // move it to document.body so it isn't affected by ancestor display:none\r\n    // which makes it invisible to Playwright. This is a low-risk, idempotent\r\n    // operation and keeps tests deterministic while the underlying HTML is\r\n    // corrected.\r\n    try {\r\n        const dockEl = document.getElementById('dock');\r\n        if (dockEl && dockEl.parentElement && dockEl.parentElement !== document.body) {\r\n            document.body.appendChild(dockEl);\r\n            console.info('[APP-INIT] moved #dock to document.body to avoid hidden ancestor(s)');\r\n        }\r\n    } catch {\r\n        /* ignore */\r\n    }\r\n\r\n    // Defensive: ensure all modal wrappers are direct children of <body>.\r\n    // This helps when malformed HTML accidentally nests modal wrappers\r\n    // inside each other which in turn causes computed display:none on\r\n    // ancestors and zero-sized geometry for centered content.\r\n    try {\r\n        const ensureModalsInBody = () => {\r\n            try {\r\n                const modals = Array.from(document.querySelectorAll('.modal')) as HTMLElement[];\r\n                let moved = false;\r\n                modals.forEach(m => {\r\n                    if (m.parentElement && m.parentElement !== document.body) {\r\n                        document.body.appendChild(m);\r\n                        moved = true;\r\n                    }\r\n                });\r\n                if (moved)\r\n                    console.info(\r\n                        '[APP-INIT] reparented misplaced .modal elements to document.body'\r\n                    );\r\n                return moved;\r\n            } catch {\r\n                return false;\r\n            }\r\n        };\r\n\r\n        ensureModalsInBody();\r\n        setTimeout(ensureModalsInBody, 50);\r\n        setTimeout(ensureModalsInBody, 200);\r\n        setTimeout(ensureModalsInBody, 500);\r\n    } catch {\r\n        /* ignore */\r\n    }\r\n\r\n    // Debugging: log some runtime info about the dock so E2E traces show why\r\n    // Playwright may mark it hidden; include computed styles and dimensions.\r\n    try {\r\n        const dockEl = document.getElementById('dock');\r\n        if (dockEl) {\r\n            const rect = dockEl.getBoundingClientRect();\r\n            const cs = window.getComputedStyle(dockEl);\r\n            console.info('[APP-INIT] Dock debug:', {\r\n                className: dockEl.className,\r\n                display: cs.display,\r\n                visibility: cs.visibility,\r\n                opacity: cs.opacity,\r\n                width: rect.width,\r\n                height: rect.height,\r\n                top: rect.top,\r\n                left: rect.left,\r\n                inViewport: rect.top < (window.innerHeight || 0) && rect.bottom > 0,\r\n            });\r\n            // Also write these values into a data attribute so E2E snapshots and\r\n            // traces (which may not include console output) can inspect the\r\n            // runtime state of the dock element.\r\n            try {\r\n                const dbg = JSON.stringify({\r\n                    className: dockEl.className,\r\n                    display: cs.display,\r\n                    visibility: cs.visibility,\r\n                    opacity: cs.opacity,\r\n                    width: Math.round(rect.width),\r\n                    height: Math.round(rect.height),\r\n                    top: Math.round(rect.top),\r\n                    left: Math.round(rect.left),\r\n                    inViewport: rect.top < (window.innerHeight || 0) && rect.bottom > 0,\r\n                });\r\n                dockEl.setAttribute('data-dock-debug', dbg);\r\n            } catch {\r\n                /* swallow */\r\n            }\r\n        } else {\r\n            console.info('[APP-INIT] Dock debug: element not found');\r\n        }\r\n    } catch (e) {\r\n        console.warn('[APP-INIT] Dock debug failed', e);\r\n    }\r\n\r\n    // Signal that the app is ready for E2E tests.\r\n    // Important: delay setting __APP_READY until the full page load event\r\n    // so that later scripts (for example the legacy `app.js` included\r\n    // after this file) have a chance to run and not hide UI elements\r\n    // after tests consider the app ready.\r\n    const gw = window as Window & { __APP_READY?: boolean };\r\n    function markReady() {\r\n        try {\r\n            // At load time, ensure the dock is placed under document.body so\r\n            // any legacy scripts that reparent early don't leave it inside a\r\n            // hidden modal. Do this right before signaling readiness so tests\r\n            // observe the final DOM state.\r\n            const ensureDockInBody = () => {\r\n                try {\r\n                    const dockEl = document.getElementById('dock');\r\n                    if (dockEl && dockEl.parentElement && dockEl.parentElement !== document.body) {\r\n                        document.body.appendChild(dockEl);\r\n                        console.info('[APP-INIT] moved #dock to document.body (ensured at load)');\r\n                        return true;\r\n                    }\r\n                } catch {\r\n                    /* ignore */\r\n                }\r\n                return false;\r\n            };\r\n\r\n            // Try immediately and a few times after small delays to survive other\r\n            // scripts that may reparent DOM nodes during startup.\r\n            ensureDockInBody();\r\n            setTimeout(ensureDockInBody, 50);\r\n            setTimeout(ensureDockInBody, 200);\r\n            setTimeout(ensureDockInBody, 500);\r\n\r\n            // =====================================================================\r\n            // PHASE 1: Expose system singletons for E2E tests and inter-module access\r\n            // =====================================================================\r\n            // Make core system objects globally available so:\r\n            // 1. E2E tests can query application state\r\n            // 2. Legacy JS modules can access new TS systems\r\n            // 3. Debugging and introspection becomes possible\r\n            \r\n            const gw2 = window as any;\r\n            \r\n            // VirtualFS - Expose for terminal and finder state introspection\r\n            if (typeof gw2.VirtualFS === 'undefined' && gw2.__VirtualFS === undefined) {\r\n                try {\r\n                    // VirtualFS is imported in terminal-session.ts, but we need a global reference\r\n                    // Try to locate it through existing systems\r\n                    const getVFS = () => {\r\n                        // Check if any TerminalSession has VirtualFS accessible\r\n                        if (gw2.TerminalInstanceManager?.getActiveSession?.()) {\r\n                            // VirtualFS will be available through the session context\r\n                            return true;\r\n                        }\r\n                        return false;\r\n                    };\r\n                    // Mark that VirtualFS should be accessible\r\n                    gw2.__VirtualFS_Ready = getVFS();\r\n                    console.info('[APP-INIT] VirtualFS state made queryable');\r\n                } catch (e) {\r\n                    console.debug('[APP-INIT] VirtualFS exposure skipped:', (e as Error).message);\r\n                }\r\n            }\r\n            \r\n            // WindowRegistry - Expose for window/tab introspection\r\n            if (gw2.WindowRegistry) {\r\n                gw2.__WindowRegistry = gw2.WindowRegistry;\r\n                console.info('[APP-INIT] WindowRegistry exposed as __WindowRegistry');\r\n            }\r\n            \r\n            // FinderSystem - Expose for finder operations\r\n            if (gw2.FinderSystem) {\r\n                gw2.__FinderSystem = gw2.FinderSystem;\r\n                console.info('[APP-INIT] FinderSystem exposed as __FinderSystem');\r\n            }\r\n            \r\n            // TerminalSystem - Expose for terminal operations\r\n            if (gw2.TerminalSystem) {\r\n                gw2.__TerminalSystem = gw2.TerminalSystem;\r\n                console.info('[APP-INIT] TerminalSystem exposed as __TerminalSystem');\r\n            }\r\n            \r\n            // LaunchpadSystem - Expose for launchpad operations\r\n            if (gw2.LaunchpadSystem) {\r\n                gw2.__LaunchpadSystem = gw2.LaunchpadSystem;\r\n                console.info('[APP-INIT] LaunchpadSystem exposed as __LaunchpadSystem');\r\n            }\r\n            \r\n            // SettingsSystem - Expose for settings operations\r\n            if (gw2.SettingsSystem) {\r\n                gw2.__SettingsSystem = gw2.SettingsSystem;\r\n                console.info('[APP-INIT] SettingsSystem exposed as __SettingsSystem');\r\n            }\r\n            \r\n            // SessionManager - Already exposed by legacy JS, but ensure it's available\r\n            if (gw2.SessionManager) {\r\n                console.info('[APP-INIT] SessionManager available (legacy)');\r\n            }\r\n            \r\n            // DockSystem - Expose for dock operations\r\n            if (gw2.DockSystem) {\r\n                gw2.__DockSystem = gw2.DockSystem;\r\n                console.info('[APP-INIT] DockSystem exposed as __DockSystem');\r\n            }\r\n            \r\n            // ActionBus - Expose for action dispatch\r\n            if (gw2.ActionBus) {\r\n                gw2.__ActionBus = gw2.ActionBus;\r\n                console.info('[APP-INIT] ActionBus exposed as __ActionBus');\r\n            }\r\n\r\n            gw.__APP_READY = true;\r\n            console.info('[APP-INIT] __APP_READY=true');\r\n        } catch {\r\n            /* swallow */\r\n        }\r\n    }\r\n\r\n    if (document.readyState === 'complete') {\r\n        // load already fired\r\n        markReady();\r\n    } else {\r\n        window.addEventListener('load', markReady, { once: true });\r\n        // Fallback: if the load event doesn't fire (e.g., due to a blocked resource)\r\n        // make sure tests can proceed by marking ready after a short grace period.\r\n        setTimeout(() => {\r\n            if (!gw.__APP_READY) {\r\n                console.warn(\r\n                    '[APP-INIT] load event not observed within timeout; forcing __APP_READY'\r\n                );\r\n                markReady();\r\n            }\r\n        }, 4000);\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// IIFE Export Pattern - Expose initApp globally and auto-attach to DOMContentLoaded\r\n// ============================================================================\r\n\r\n(() => {\r\n    if (typeof window.initApp !== 'function') {\r\n        window.initApp = initApp;\r\n    }\r\n\r\n    // Auto-attach to DOMContentLoaded\r\n    if (document.readyState === 'loading') {\r\n        document.addEventListener('DOMContentLoaded', initApp);\r\n    } else {\r\n        // DOMContentLoaded already fired, run immediately\r\n        initApp();\r\n    }\r\n})();\r\n"]}