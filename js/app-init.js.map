{"version":3,"file":"app-init.js","sourceRoot":"","sources":["../src/ts/app-init.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Application Initialization Module\n * Handles DOMContentLoaded setup and modal initialization.\n *\n * This module centralizes application bootstrap logic that was previously\n * in the DOMContentLoaded handler in app.js.\n *\n * @module app-init\n */\n\n// Export to make this a proper module for global augmentation\nexport {};\n\n/**\n * Global window interface extensions for app initialization\n */\ndeclare global {\n    interface Window {\n        initApp?: () => void;\n    }\n}\n\n/**\n * Type helper for WindowManager\n */\ninterface IWindowManager {\n    getAllWindowIds?: () => string[];\n    getTransientWindowIds?: () => string[];\n    setDialogInstance?: (id: string, instance: unknown) => void;\n}\n\n/**\n * Type helper for Dialog class\n */\ninterface IDialog {\n    new (id: string): unknown;\n}\n\n/**\n * Type helper for external module functions\n */\ninterface GlobalModules {\n    ActionBus?: {\n        init?: () => void;\n    };\n    Dialog?: IDialog;\n    FinderSystem?: {\n        init?: () => void;\n    };\n    SettingsSystem?: {\n        init?: (container: HTMLElement) => void;\n    };\n    TextEditorSystem?: {\n        init?: (container: HTMLElement) => void;\n    };\n    TerminalSystem?: {\n        init?: (container: HTMLElement) => void;\n    };\n    TerminalInstanceManager?: unknown;\n    DockSystem?: {\n        initDockDragDrop?: () => void;\n    };\n}\n\n/**\n * Initialize modal IDs from WindowManager or fallback to default list\n * @returns Object containing modalIds array and transientModalIds set\n */\nfunction initModalIds(): { modalIds: string[]; transientModalIds: Set<string> } {\n    const win = window as Window & {\n        WindowManager?: IWindowManager;\n        APP_CONSTANTS?: { MODAL_IDS?: string[]; TRANSIENT_MODAL_IDS?: Set<string> };\n    };\n\n    if (win.WindowManager) {\n        const modalIds = win.WindowManager.getAllWindowIds?.() || [];\n        const transientIds = win.WindowManager.getTransientWindowIds?.() || [];\n        return {\n            modalIds,\n            transientModalIds: new Set(transientIds),\n        };\n    } else {\n        // Fallback\n        const modalIds = win.APP_CONSTANTS?.MODAL_IDS || [\n            'finder-modal',\n            'projects-modal',\n            'about-modal',\n            'settings-modal',\n            'text-modal',\n            'terminal-modal',\n            'image-modal',\n            'program-info-modal',\n        ];\n        const transientModalIds =\n            win.APP_CONSTANTS?.TRANSIENT_MODAL_IDS || new Set(['program-info-modal']);\n        return { modalIds, transientModalIds };\n    }\n}\n\n/**\n * Main application initialization function.\n * Called automatically on DOMContentLoaded.\n * Sets up dialog instances, ActionBus, and initializes all subsystems.\n */\nfunction initApp(): void {\n    const win = window as Window & GlobalModules & { WindowManager?: IWindowManager };\n    const funcs = window as Window & {\n        hideMenuDropdowns?: () => void;\n        bringDialogToFront?: (id: string) => void;\n        updateProgramLabelByTopModal?: () => void;\n        syncTopZIndexWithDOM?: () => void;\n        restoreWindowPositions?: () => void;\n        restoreOpenModals?: () => void;\n        initSystemStatusControls?: () => void;\n        initDesktop?: () => void;\n        initDockMagnification?: () => void;\n    };\n\n    // Modal-IDs initialisieren\n    const { modalIds } = initModalIds();\n\n    // ActionBus initialisieren\n    if (win.ActionBus) {\n        win.ActionBus.init?.();\n    }\n\n    // Wenn auf einen sichtbaren Modalcontainer geklickt wird, hole das Fenster in den Vordergrund\n    document.querySelectorAll('.modal').forEach(modal => {\n        modal.addEventListener('click', function (e) {\n            // Verhindere, dass Klicks auf interaktive Elemente im Modal den Fokuswechsel stören.\n            const target = e.target as Node;\n            if (e.target === modal || modal.contains(target)) {\n                funcs.hideMenuDropdowns?.();\n                funcs.bringDialogToFront?.(modal.id);\n                funcs.updateProgramLabelByTopModal?.();\n            }\n        });\n    });\n\n    // Dialog-Instanzen erstellen und im WindowManager registrieren\n    const dialogs = window.dialogs || {};\n    window.dialogs = dialogs;\n    if (modalIds && Array.isArray(modalIds)) {\n        modalIds.forEach(id => {\n            const modal = document.getElementById(id);\n            if (!modal || !win.Dialog) return;\n            const dialogInstance = new win.Dialog(id);\n            dialogs[id] = dialogInstance as unknown as Record<string, unknown>;\n\n            // Im WindowManager registrieren\n            if (win.WindowManager) {\n                win.WindowManager.setDialogInstance?.(id, dialogInstance);\n            }\n        });\n    }\n\n    // Add click-outside-to-close functionality for launchpad\n    const launchpadModal = document.getElementById('launchpad-modal');\n    if (launchpadModal) {\n        launchpadModal.addEventListener('click', function (e) {\n            // Close when clicking outside the inner content. Some markup has\n            // an overlay/inner wrapper that covers the full modal area, so\n            // compare against the inner content element rather than only the\n            // modal root element to determine background clicks.\n            try {\n                const inner = launchpadModal.querySelector('.launchpad-modal-inner');\n                const target = e.target as Node;\n                if (inner) {\n                    if (!inner.contains(target)) {\n                        const launchpadDialog = dialogs['launchpad-modal'] as {\n                            close?: () => void;\n                        };\n                        launchpadDialog?.close?.();\n                    }\n                } else if (target === launchpadModal) {\n                    const launchpadDialog = dialogs['launchpad-modal'] as { close?: () => void };\n                    launchpadDialog?.close?.();\n                }\n            } catch {\n                /* ignore */\n            }\n        });\n    }\n\n    funcs.syncTopZIndexWithDOM?.();\n    funcs.restoreWindowPositions?.();\n    funcs.restoreOpenModals?.();\n    funcs.initSystemStatusControls?.();\n    funcs.initDesktop?.();\n\n    // Finder initialisieren nach Dialog-Setup\n    if (win.FinderSystem && typeof win.FinderSystem.init === 'function') {\n        win.FinderSystem.init();\n    }\n\n    // Initialize settings module\n    if (win.SettingsSystem) {\n        const settingsContainer = document.getElementById('settings-container');\n        if (settingsContainer) {\n            win.SettingsSystem.init?.(settingsContainer);\n        }\n    }\n\n    // Initialize text editor module\n    if (win.TextEditorSystem) {\n        const textEditorContainer = document.getElementById('text-editor-container');\n        if (textEditorContainer) {\n            win.TextEditorSystem.init?.(textEditorContainer);\n        }\n    }\n\n    // Initialize terminal module (legacy) only when multi‑instance is not available\n    // Prevents duplicate inputs causing E2E strict-mode locator conflicts\n    if (!win.TerminalInstanceManager && win.TerminalSystem) {\n        const terminalContainer = document.getElementById('terminal-container');\n        if (terminalContainer) {\n            win.TerminalSystem.init?.(terminalContainer);\n        }\n    }\n\n    funcs.initDockMagnification?.();\n    if (win.DockSystem && typeof win.DockSystem.initDockDragDrop === 'function') {\n        win.DockSystem.initDockDragDrop();\n    }\n\n    // Defensive: ensure the dock is visible. Some environments or timing races\n    // can leave the dock with hidden/display styles that make it \"invisible\"\n    // to Playwright checks. Remove any accidental 'hidden' class and reset\n    // inline visibility/display so tests can interact reliably.\n    try {\n        const dockEl = document.getElementById('dock');\n        if (dockEl) {\n            if (dockEl.classList.contains('hidden')) dockEl.classList.remove('hidden');\n            // Reset common inline properties that may hide the element\n            dockEl.style.display = dockEl.style.display || '';\n            dockEl.style.visibility = dockEl.style.visibility || 'visible';\n        }\n    } catch {\n        // non-fatal; continue startup\n    }\n\n    // Defensive DOM fix: if the dock has been accidentally placed inside a\n    // modal wrapper (for example due to malformed HTML or runtime reparenting),\n    // move it to document.body so it isn't affected by ancestor display:none\n    // which makes it invisible to Playwright. This is a low-risk, idempotent\n    // operation and keeps tests deterministic while the underlying HTML is\n    // corrected.\n    try {\n        const dockEl = document.getElementById('dock');\n        if (dockEl && dockEl.parentElement && dockEl.parentElement !== document.body) {\n            document.body.appendChild(dockEl);\n            console.info('[APP-INIT] moved #dock to document.body to avoid hidden ancestor(s)');\n        }\n    } catch {\n        /* ignore */\n    }\n\n    // Defensive: ensure all modal wrappers are direct children of <body>.\n    // This helps when malformed HTML accidentally nests modal wrappers\n    // inside each other which in turn causes computed display:none on\n    // ancestors and zero-sized geometry for centered content.\n    try {\n        const ensureModalsInBody = () => {\n            try {\n                const modals = Array.from(document.querySelectorAll('.modal')) as HTMLElement[];\n                let moved = false;\n                modals.forEach(m => {\n                    if (m.parentElement && m.parentElement !== document.body) {\n                        document.body.appendChild(m);\n                        moved = true;\n                    }\n                });\n                if (moved)\n                    console.info(\n                        '[APP-INIT] reparented misplaced .modal elements to document.body'\n                    );\n                return moved;\n            } catch {\n                return false;\n            }\n        };\n\n        ensureModalsInBody();\n        setTimeout(ensureModalsInBody, 50);\n        setTimeout(ensureModalsInBody, 200);\n        setTimeout(ensureModalsInBody, 500);\n    } catch {\n        /* ignore */\n    }\n\n    // Debugging: log some runtime info about the dock so E2E traces show why\n    // Playwright may mark it hidden; include computed styles and dimensions.\n    try {\n        const dockEl = document.getElementById('dock');\n        if (dockEl) {\n            const rect = dockEl.getBoundingClientRect();\n            const cs = window.getComputedStyle(dockEl);\n            console.info('[APP-INIT] Dock debug:', {\n                className: dockEl.className,\n                display: cs.display,\n                visibility: cs.visibility,\n                opacity: cs.opacity,\n                width: rect.width,\n                height: rect.height,\n                top: rect.top,\n                left: rect.left,\n                inViewport: rect.top < (window.innerHeight || 0) && rect.bottom > 0,\n            });\n            // Also write these values into a data attribute so E2E snapshots and\n            // traces (which may not include console output) can inspect the\n            // runtime state of the dock element.\n            try {\n                const dbg = JSON.stringify({\n                    className: dockEl.className,\n                    display: cs.display,\n                    visibility: cs.visibility,\n                    opacity: cs.opacity,\n                    width: Math.round(rect.width),\n                    height: Math.round(rect.height),\n                    top: Math.round(rect.top),\n                    left: Math.round(rect.left),\n                    inViewport: rect.top < (window.innerHeight || 0) && rect.bottom > 0,\n                });\n                dockEl.setAttribute('data-dock-debug', dbg);\n            } catch {\n                /* swallow */\n            }\n        } else {\n            console.info('[APP-INIT] Dock debug: element not found');\n        }\n    } catch (e) {\n        console.warn('[APP-INIT] Dock debug failed', e);\n    }\n\n    // Signal that the app is ready for E2E tests.\n    // Important: delay setting __APP_READY until the full page load event\n    // so that later scripts (for example the legacy `app.js` included\n    // after this file) have a chance to run and not hide UI elements\n    // after tests consider the app ready.\n    const gw = window as Window & { __APP_READY?: boolean };\n    function markReady() {\n        try {\n            // At load time, ensure the dock is placed under document.body so\n            // any legacy scripts that reparent early don't leave it inside a\n            // hidden modal. Do this right before signaling readiness so tests\n            // observe the final DOM state.\n            const ensureDockInBody = () => {\n                try {\n                    const dockEl = document.getElementById('dock');\n                    if (dockEl && dockEl.parentElement && dockEl.parentElement !== document.body) {\n                        document.body.appendChild(dockEl);\n                        console.info('[APP-INIT] moved #dock to document.body (ensured at load)');\n                        return true;\n                    }\n                } catch {\n                    /* ignore */\n                }\n                return false;\n            };\n\n            // Try immediately and a few times after small delays to survive other\n            // scripts that may reparent DOM nodes during startup.\n            ensureDockInBody();\n            setTimeout(ensureDockInBody, 50);\n            setTimeout(ensureDockInBody, 200);\n            setTimeout(ensureDockInBody, 500);\n\n            gw.__APP_READY = true;\n            console.info('[APP-INIT] __APP_READY=true');\n        } catch {\n            /* swallow */\n        }\n    }\n\n    if (document.readyState === 'complete') {\n        // load already fired\n        markReady();\n    } else {\n        window.addEventListener('load', markReady, { once: true });\n    }\n}\n\n// ============================================================================\n// IIFE Export Pattern - Expose initApp globally and auto-attach to DOMContentLoaded\n// ============================================================================\n\n(() => {\n    if (typeof window.initApp !== 'function') {\n        window.initApp = initApp;\n    }\n\n    // Auto-attach to DOMContentLoaded\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', initApp);\n    } else {\n        // DOMContentLoaded already fired, run immediately\n        initApp();\n    }\n})();\n"]}