{"version":3,"file":"base-window.js","sourceRoot":"","sources":["../src/ts/base-window.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * src/ts/base-window.ts\r\n * Base class for multi-window system\r\n * Each window can contain multiple tabs with drag & drop support\r\n */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport type { BaseTab } from './base-tab.js';\r\n\r\nexport interface WindowPosition {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\nexport interface WindowConfig {\r\n    id?: string;\r\n    type: string; // 'terminal', 'text-editor', 'finder'\r\n    title?: string;\r\n    position?: WindowPosition;\r\n    tabs?: BaseTab[];\r\n    metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface WindowState {\r\n    id: string;\r\n    type: string;\r\n    position: WindowPosition;\r\n    zIndex: number;\r\n    isMinimized: boolean;\r\n    isMaximized: boolean;\r\n    activeTabId: string | null;\r\n    tabs: string[]; // Tab IDs\r\n    created: number;\r\n    modified: number;\r\n}\r\n\r\n/**\r\n * BaseWindow - Fundament des neuen Fenster-Systems\r\n *\r\n * Überblick\r\n * ---------\r\n * Ein BaseWindow ist ein frei bewegliches, resizables „App‑Fenster“ – kein klassischer\r\n * Fullscreen-Modal. Jedes Fenster besitzt eine eigene Tab-Leiste und kann mehrere\r\n * Inhalts-Tabs (Instanzen von BaseTab) aufnehmen. Tabs lassen sich zwischen Fenstern\r\n * verschieben (Drag&Drop) oder in ein neues Fenster „herausziehen“.\r\n *\r\n * Ziele\r\n * -----\r\n * - Einheitliche API für Text-Editor, Terminal, Finder etc.\r\n * - Persistenz: Fensterzustand (Position, Größe, Tabs, aktiver Tab) wird über\r\n *   Session-Manager konserviert.\r\n * - Interop mit alter Infrastruktur: Registrierung im (legacy) WindowManager, damit\r\n *   MenülLeiste/ProgramLabel korrekt wechseln.\r\n *\r\n * Lebenszyklus\r\n * ------------\r\n * 1) new SubclassOfBaseWindow({...})\r\n * 2) show() -> erzeugt DOM, rendert Tabbar/Content, setzt Fokus/Z‑Index\r\n * 3) addTab()/setActiveTab() -> Tabs werden an Content‑Area angehängt\r\n * 4) hide()/close()/destroy()\r\n *\r\n * Erweiterung\r\n * -----------\r\n * - Subklassen überschreiben createDOM() und optional _renderTabs(), wenn eine\r\n *   eigene Tabbar (z. B. via WindowTabs) genutzt wird.\r\n * - BaseWindow kümmert sich um Drag/Resize/Fokus/Z‑Index/Session‑Save.\r\n */\r\nexport class BaseWindow {\r\n    id: string;\r\n    type: string;\r\n    element: HTMLElement | null;\r\n    titlebarElement: HTMLElement | null;\r\n    contentElement: HTMLElement | null;\r\n    position: WindowPosition;\r\n    zIndex: number;\r\n    isMinimized: boolean;\r\n    isMaximized: boolean;\r\n    tabs: Map<string, BaseTab>;\r\n    activeTabId: string | null;\r\n    metadata: Record<string, any>;\r\n    private dragState: {\r\n        isDragging: boolean;\r\n        startX: number;\r\n        startY: number;\r\n        offsetX: number;\r\n        offsetY: number;\r\n    };\r\n\r\n    constructor(config: WindowConfig) {\r\n        // Set type FIRST, before generating ID (ID generation uses this.type)\r\n        this.type = config.type;\r\n        this.id = config.id || this._generateId();\r\n        this.element = null;\r\n        this.titlebarElement = null;\r\n        this.contentElement = null;\r\n        this.position = config.position || this._getDefaultPosition();\r\n        this.zIndex = 1000;\r\n        this.isMinimized = false;\r\n        this.isMaximized = false;\r\n        this.tabs = new Map();\r\n        this.activeTabId = null;\r\n        this.metadata = config.metadata || {};\r\n        this.dragState = {\r\n            isDragging: false,\r\n            startX: 0,\r\n            startY: 0,\r\n            offsetX: 0,\r\n            offsetY: 0,\r\n        };\r\n\r\n        // Add initial tabs if provided\r\n        if (config.tabs) {\r\n            config.tabs.forEach(tab => this.addTab(tab));\r\n        }\r\n    }\r\n\r\n    private _generateId(): string {\r\n        return `window-${this.type}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n    }\r\n\r\n    private _getDefaultPosition(): WindowPosition {\r\n        // Center window with slight offset for multiple windows\r\n        const offset = Math.random() * 100 - 50;\r\n        return {\r\n            x: window.innerWidth / 2 - 400 + offset,\r\n            y: window.innerHeight / 2 - 300 + offset,\r\n            width: 800,\r\n            height: 600,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Create the window DOM element.\r\n     * Subklassen können überschreiben, wenn z. B. eine dedizierte Tabbar\r\n     * oder zusätzliche UI‑Elemente nötig sind. Wichtig: setze this.element,\r\n     * this.titlebarElement und this.contentElement.\r\n     */\r\n    createDOM(): HTMLElement {\r\n        // Create window container (no modal overlay - this is a floating window, not a modal dialog)\r\n        const windowEl = document.createElement('div');\r\n        windowEl.id = this.id;\r\n        // Add 'modal' class for compatibility with existing focus/z-index management\r\n        windowEl.className =\r\n            'modal multi-window hidden fixed bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-lg flex flex-col max-h-[90vh] min-w-[560px] min-h-[360px]';\r\n        windowEl.setAttribute('role', 'dialog');\r\n        windowEl.setAttribute('aria-modal', 'false'); // Not a modal\r\n\r\n        // Override modal pointer-events: none\r\n        windowEl.style.pointerEvents = 'auto';\r\n\r\n        // Set position and size\r\n        windowEl.style.left = `${this.position.x}px`;\r\n        windowEl.style.top = `${this.position.y}px`;\r\n        windowEl.style.width = `${this.position.width}px`;\r\n        windowEl.style.height = `${this.position.height}px`;\r\n        windowEl.style.zIndex = String(this.zIndex);\r\n\r\n        // Titlebar (draggable) – enthält die drei Mac‑Kontrollpunkte und die window‑Überschrift\r\n        this.titlebarElement = this._createTitlebar();\r\n        windowEl.appendChild(this.titlebarElement);\r\n\r\n        // Tab bar container\r\n        const tabBar = document.createElement('div');\r\n        tabBar.id = `${this.id}-tabs`;\r\n        tabBar.className = 'window-tab-bar';\r\n        windowEl.appendChild(tabBar);\r\n\r\n        // Content area\r\n        this.contentElement = document.createElement('div');\r\n        this.contentElement.id = `${this.id}-content`;\r\n        this.contentElement.className = 'flex-1 overflow-hidden';\r\n        windowEl.appendChild(this.contentElement);\r\n\r\n        this.element = windowEl;\r\n\r\n        // Beweglichkeit / Fokus / Größe\r\n        this._attachDragHandlers();\r\n        this._attachFocusHandler();\r\n        this._attachResizeHandlers();\r\n\r\n        // Register with legacy WindowManager for menubar integration\r\n        this._registerWithWindowManager();\r\n\r\n        // Apply i18n translations to window elements\r\n        const W = window as any;\r\n        if (W.appI18n && typeof W.appI18n.applyTranslations === 'function') {\r\n            W.appI18n.applyTranslations(windowEl);\r\n        }\r\n\r\n        return windowEl;\r\n    }\r\n\r\n    /**\r\n     * Baut die Titelleiste inklusive Close/Minimize/Maximize „Dots“.\r\n     * Events sind an BaseWindow‑Methoden gebunden (close/minimize/toggleMaximize).\r\n     */\r\n    private _createTitlebar(): HTMLElement {\r\n        const titlebar = document.createElement('div');\r\n        titlebar.className =\r\n            'window-titlebar flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-t-lg draggable-header cursor-move';\r\n\r\n        // Window controls (macOS style: close, minimize, maximize as dots)\r\n        const controls = document.createElement('div');\r\n        controls.className = 'flex space-x-2';\r\n\r\n        // Close button (red dot)\r\n        const closeBtn = document.createElement('button');\r\n        closeBtn.className = 'ml-auto text-2xl leading-none text-gray-700 dark:text-gray-300';\r\n        closeBtn.title = 'Schließen';\r\n        closeBtn.setAttribute('data-i18n-title', 'common.close');\r\n        closeBtn.innerHTML = '<div class=\"w-3 h-3 bg-red-500 rounded-full\"></div>';\r\n        closeBtn.addEventListener('click', () => this.close());\r\n\r\n        // Minimize button (yellow dot) - clickable div with title\r\n        const minBtn = document.createElement('div');\r\n        minBtn.className = 'w-3 h-3 bg-yellow-500 rounded-full cursor-pointer';\r\n        minBtn.title = 'Minimieren';\r\n        minBtn.setAttribute('data-i18n-title', 'menuItems.window.minimize');\r\n        minBtn.addEventListener('click', () => this.minimize());\r\n\r\n        // Maximize button (green dot) - clickable div with title\r\n        const maxBtn = document.createElement('div');\r\n        maxBtn.className = 'w-3 h-3 bg-green-500 rounded-full cursor-pointer';\r\n        maxBtn.title = 'Zoomen';\r\n        maxBtn.setAttribute('data-i18n-title', 'menuItems.window.zoom');\r\n        maxBtn.addEventListener('click', () => this.toggleMaximize());\r\n\r\n        controls.appendChild(closeBtn);\r\n        controls.appendChild(minBtn);\r\n        controls.appendChild(maxBtn);\r\n\r\n        // Title\r\n        const title = document.createElement('h2');\r\n        title.className = 'ml-4 font-semibold text-gray-700 dark:text-gray-300 no-select';\r\n\r\n        // Set i18n key based on window type\r\n        // Map text-editor to text for i18n key\r\n        const typeKey = this.type === 'text-editor' ? 'text' : this.type;\r\n        const titleKey = `desktop.${typeKey}`;\r\n        title.setAttribute('data-i18n', titleKey);\r\n        title.textContent = this.metadata.title || this.type; // Fallback before i18n\r\n\r\n        titlebar.appendChild(controls);\r\n        titlebar.appendChild(title);\r\n\r\n        return titlebar;\r\n    }\r\n\r\n    /**\r\n     * Ermöglicht Dragging des Fensters über die Titelleiste.\r\n     * Speicherung der Position erfolgt am Ende des Drags via _saveState().\r\n     */\r\n    private _attachDragHandlers(): void {\r\n        if (!this.titlebarElement) return;\r\n\r\n        this.titlebarElement.addEventListener('mousedown', (e: MouseEvent) => {\r\n            if ((e.target as HTMLElement).tagName === 'BUTTON') return; // Ignore control buttons\r\n\r\n            this.dragState.isDragging = true;\r\n            this.dragState.startX = e.clientX;\r\n            this.dragState.startY = e.clientY;\r\n\r\n            const rect = this.element?.getBoundingClientRect();\r\n            if (rect) {\r\n                this.dragState.offsetX = this.dragState.startX - rect.left;\r\n                this.dragState.offsetY = this.dragState.startY - rect.top;\r\n            }\r\n\r\n            e.preventDefault();\r\n        });\r\n\r\n        document.addEventListener('mousemove', (e: MouseEvent) => {\r\n            if (!this.dragState.isDragging || !this.element) return;\r\n\r\n            const newX = e.clientX - this.dragState.offsetX;\r\n            const newY = e.clientY - this.dragState.offsetY;\r\n\r\n            this.position.x = newX;\r\n            this.position.y = newY;\r\n\r\n            this._updatePosition();\r\n        });\r\n\r\n        document.addEventListener('mouseup', () => {\r\n            if (this.dragState.isDragging) {\r\n                this.dragState.isDragging = false;\r\n                this._saveState();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Klick in das Fenster bringt es nach vorne und aktualisiert Menubar‑Status.\r\n     */\r\n    private _attachFocusHandler(): void {\r\n        if (!this.element) return;\r\n\r\n        // Bring window to front when clicked anywhere\r\n        this.element.addEventListener('mousedown', () => {\r\n            this.bringToFront();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Fügt 8 Resize‑Griffe hinzu (N, S, E, W sowie Ecken).\r\n     * Während des Resizings wird ein Overlay gesetzt, um Mouse‑Events zuverlässig\r\n     * zu capturen. Mindestgrößen werden berücksichtigt.\r\n     */\r\n    private _attachResizeHandlers(): void {\r\n        if (!this.element) return;\r\n\r\n        // Remove existing resize handles\r\n        const existingHandles = this.element.querySelectorAll('.resizer');\r\n        existingHandles.forEach(handle => handle.remove());\r\n\r\n        const createHandle = (handle: any) => {\r\n            const resizer = document.createElement('div');\r\n            resizer.classList.add('resizer', `resizer-${handle.name}`);\r\n            Object.assign(resizer.style, {\r\n                position: 'absolute',\r\n                zIndex: '9999',\r\n                backgroundColor: 'transparent',\r\n                pointerEvents: 'auto',\r\n                touchAction: 'none',\r\n                cursor: handle.cursor,\r\n                ...(handle.style || {}),\r\n            });\r\n\r\n            this.element!.appendChild(resizer);\r\n\r\n            const startResize = (event: MouseEvent) => {\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n\r\n                this.bringToFront();\r\n\r\n                const startX = event.clientX;\r\n                const startY = event.clientY;\r\n                const rect = this.element!.getBoundingClientRect();\r\n                const computed = window.getComputedStyle(this.element!);\r\n                const minWidth = parseFloat(computed.minWidth) || 560;\r\n                const minHeight = parseFloat(computed.minHeight) || 360;\r\n\r\n                let startLeft = parseFloat(computed.left);\r\n                let startTop = parseFloat(computed.top);\r\n                if (!Number.isFinite(startLeft)) startLeft = rect.left;\r\n                if (!Number.isFinite(startTop)) startTop = rect.top;\r\n\r\n                const startWidth = rect.width;\r\n                const startHeight = rect.height;\r\n\r\n                // Create overlay to capture mouse events\r\n                const overlay = document.createElement('div');\r\n                Object.assign(overlay.style, {\r\n                    position: 'fixed',\r\n                    top: '0',\r\n                    left: '0',\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    zIndex: '9999',\r\n                    cursor: handle.cursor,\r\n                    backgroundColor: 'transparent',\r\n                    touchAction: 'none',\r\n                });\r\n                document.body.appendChild(overlay);\r\n\r\n                let resizing = true;\r\n\r\n                const applySize = (clientX: number, clientY: number) => {\r\n                    if (!resizing) return;\r\n\r\n                    window.requestAnimationFrame(() => {\r\n                        const dx = clientX - startX;\r\n                        const dy = clientY - startY;\r\n                        let newWidth = startWidth;\r\n                        let newHeight = startHeight;\r\n                        let newLeft = startLeft;\r\n                        let newTop = startTop;\r\n\r\n                        // Apply direction-based changes\r\n                        if (handle.directions.includes('e')) newWidth = startWidth + dx;\r\n                        if (handle.directions.includes('s')) newHeight = startHeight + dy;\r\n                        if (handle.directions.includes('w')) {\r\n                            newWidth = startWidth - dx;\r\n                            newLeft = startLeft + dx;\r\n                        }\r\n                        if (handle.directions.includes('n')) {\r\n                            newHeight = startHeight - dy;\r\n                            newTop = startTop + dy;\r\n                        }\r\n\r\n                        // Enforce minimum size\r\n                        if (newWidth < minWidth) {\r\n                            const deficit = minWidth - newWidth;\r\n                            if (handle.directions.includes('w')) newLeft -= deficit;\r\n                            newWidth = minWidth;\r\n                        }\r\n                        if (newHeight < minHeight) {\r\n                            const deficit = minHeight - newHeight;\r\n                            if (handle.directions.includes('n')) newTop -= deficit;\r\n                            newHeight = minHeight;\r\n                        }\r\n\r\n                        // Enforce menu bar boundary\r\n                        const minTop = (window as any).getMenuBarBottom?.() || 0;\r\n                        if (handle.directions.includes('n') && newTop < minTop) {\r\n                            const overshoot = minTop - newTop;\r\n                            newTop = minTop;\r\n                            newHeight = Math.max(minHeight, newHeight - overshoot);\r\n                        }\r\n\r\n                        // Apply new size and position\r\n                        if (handle.directions.includes('w') || handle.directions.includes('e')) {\r\n                            this.element!.style.width = Math.max(minWidth, newWidth) + 'px';\r\n                            this.position.width = Math.max(minWidth, newWidth);\r\n                        }\r\n                        if (handle.directions.includes('s') || handle.directions.includes('n')) {\r\n                            this.element!.style.height = Math.max(minHeight, newHeight) + 'px';\r\n                            this.position.height = Math.max(minHeight, newHeight);\r\n                        }\r\n                        if (handle.directions.includes('w')) {\r\n                            this.element!.style.left = newLeft + 'px';\r\n                            this.position.x = newLeft;\r\n                        }\r\n                        if (handle.directions.includes('n')) {\r\n                            this.element!.style.top = newTop + 'px';\r\n                            this.position.y = newTop;\r\n                        }\r\n                    });\r\n                };\r\n\r\n                const stopResize = () => {\r\n                    if (!resizing) return;\r\n                    resizing = false;\r\n                    overlay.remove();\r\n                    overlay.removeEventListener('mousemove', overlayMouseMove);\r\n                    overlay.removeEventListener('mouseup', overlayMouseUp);\r\n                    window.removeEventListener('mousemove', windowMouseMove);\r\n                    window.removeEventListener('mouseup', windowMouseUp);\r\n                    window.removeEventListener('blur', onBlur);\r\n\r\n                    // Save state after resize\r\n                    this._saveState();\r\n                };\r\n\r\n                const overlayMouseMove = (moveEvent: MouseEvent) =>\r\n                    applySize(moveEvent.clientX, moveEvent.clientY);\r\n                const windowMouseMove = (moveEvent: MouseEvent) =>\r\n                    applySize(moveEvent.clientX, moveEvent.clientY);\r\n                const overlayMouseUp = () => stopResize();\r\n                const windowMouseUp = () => stopResize();\r\n                const onBlur = () => stopResize();\r\n\r\n                overlay.addEventListener('mousemove', overlayMouseMove);\r\n                overlay.addEventListener('mouseup', overlayMouseUp);\r\n                window.addEventListener('mousemove', windowMouseMove);\r\n                window.addEventListener('mouseup', windowMouseUp);\r\n                window.addEventListener('blur', onBlur);\r\n            };\r\n\r\n            resizer.addEventListener('mousedown', startResize);\r\n        };\r\n\r\n        // Resize handles (8 directions)\r\n        const handles = [\r\n            {\r\n                name: 'top',\r\n                cursor: 'n-resize',\r\n                directions: ['n'],\r\n                style: { top: '-4px', left: '12px', right: '12px', height: '8px' },\r\n            },\r\n            {\r\n                name: 'bottom',\r\n                cursor: 's-resize',\r\n                directions: ['s'],\r\n                style: { bottom: '-4px', left: '12px', right: '12px', height: '8px' },\r\n            },\r\n            {\r\n                name: 'left',\r\n                cursor: 'w-resize',\r\n                directions: ['w'],\r\n                style: { left: '-4px', top: '12px', bottom: '12px', width: '8px' },\r\n            },\r\n            {\r\n                name: 'right',\r\n                cursor: 'e-resize',\r\n                directions: ['e'],\r\n                style: { right: '-4px', top: '12px', bottom: '12px', width: '8px' },\r\n            },\r\n            {\r\n                name: 'top-left',\r\n                cursor: 'nw-resize',\r\n                directions: ['n', 'w'],\r\n                style: { top: '-6px', left: '-6px', width: '14px', height: '14px' },\r\n            },\r\n            {\r\n                name: 'top-right',\r\n                cursor: 'ne-resize',\r\n                directions: ['n', 'e'],\r\n                style: { top: '-6px', right: '-6px', width: '14px', height: '14px' },\r\n            },\r\n            {\r\n                name: 'bottom-left',\r\n                cursor: 'sw-resize',\r\n                directions: ['s', 'w'],\r\n                style: { bottom: '-6px', left: '-6px', width: '14px', height: '14px' },\r\n            },\r\n            {\r\n                name: 'bottom-right',\r\n                cursor: 'se-resize',\r\n                directions: ['s', 'e'],\r\n                style: { bottom: '-6px', right: '-6px', width: '14px', height: '14px' },\r\n            },\r\n        ];\r\n\r\n        handles.forEach(createHandle);\r\n    }\r\n\r\n    private _updatePosition(): void {\r\n        if (!this.element) return;\r\n\r\n        // Update position on the window element itself\r\n        this.element.style.left = `${this.position.x}px`;\r\n        this.element.style.top = `${this.position.y}px`;\r\n    }\r\n\r\n    /**\r\n     * Fenster anzeigen. Erzeugt bei Bedarf das DOM, hängt Tabs an die Content‑Area an\r\n     * und ruft bringToFront() + Menubar‑Update. Persistiert den Zustand.\r\n     */\r\n    show(): void {\r\n        if (!this.element) {\r\n            this.createDOM();\r\n            document.body.appendChild(this.element!);\r\n\r\n            // Append all existing tabs to content area\r\n            if (this.contentElement) {\r\n                this.tabs.forEach(tab => {\r\n                    if (tab.element && !this.contentElement!.contains(tab.element)) {\r\n                        this.contentElement!.appendChild(tab.element);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        this.element?.classList.remove('hidden');\r\n        this.bringToFront();\r\n        // Update menubar to reflect new active window\r\n        const W = window as any;\r\n        W.updateProgramLabelByTopModal?.();\r\n        W.updateDockIndicators?.();\r\n        this._saveState();\r\n    }\r\n\r\n    /**\r\n     * Fenster ausblenden und Menubar entsprechend aktualisieren.\r\n     */\r\n    hide(): void {\r\n        this.element?.classList.add('hidden');\r\n        // Update menubar to reflect next top window\r\n        const W = window as any;\r\n        W.updateProgramLabelByTopModal?.();\r\n        const menuSystem = W.MenuSystem;\r\n        if (menuSystem?.renderApplicationMenu) {\r\n            const current = menuSystem.getCurrentMenuModalId?.();\r\n            menuSystem.renderApplicationMenu(current);\r\n        }\r\n        this._saveState();\r\n    }\r\n\r\n    /**\r\n     * Fenster schließen. Übergibt die endgültige Entfernung an den WindowRegistry,\r\n     * sodass dieser Aufräumarbeiten übernehmen kann.\r\n     */\r\n    close(): void {\r\n        this.hide();\r\n\r\n        // Remove from z-index manager stack\r\n        const W = window as any;\r\n        if (W.__zIndexManager && typeof W.__zIndexManager.removeWindow === 'function') {\r\n            W.__zIndexManager.removeWindow(this.id);\r\n        }\r\n\r\n        // WindowRegistry will handle cleanup\r\n        if (W.WindowRegistry) {\r\n            W.WindowRegistry.removeWindow(this.id);\r\n        }\r\n\r\n        // Update dock indicators after window is closed\r\n        W.updateDockIndicators?.();\r\n        // Refresh menus after closing in case active app changes\r\n        const menuSystem = W.MenuSystem;\r\n        if (menuSystem?.renderApplicationMenu) {\r\n            const current = menuSystem.getCurrentMenuModalId?.();\r\n            menuSystem.renderApplicationMenu(current);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Fenster minimieren (aktuell nur Hide + Flag). Integration in Dock/Taskbar\r\n     * kann später hier erfolgen.\r\n     */\r\n    minimize(): void {\r\n        this.isMinimized = true;\r\n        this.hide();\r\n        // TODO: Add to dock/taskbar\r\n    }\r\n\r\n    /**\r\n     * Maximieren/Restore. Setzt inline‑Styles auf das innere Window‑Element.\r\n     */\r\n    toggleMaximize(): void {\r\n        this.isMaximized = !this.isMaximized;\r\n\r\n        if (!this.element) return;\r\n        const windowEl = this.element.querySelector('div') as HTMLElement;\r\n        if (!windowEl) return;\r\n\r\n        if (this.isMaximized) {\r\n            windowEl.style.width = '95vw';\r\n            windowEl.style.height = '95vh';\r\n        } else {\r\n            windowEl.style.width = `${this.position.width}px`;\r\n            windowEl.style.height = `${this.position.height}px`;\r\n        }\r\n\r\n        this._saveState();\r\n    }\r\n\r\n    /**\r\n     * Nach vorne holen. Nutzt bevorzugt den (legacy) __zIndexManager, ansonsten\r\n     * WindowRegistry.getNextZIndex(). Aktualisiert die Menubar.\r\n     */\r\n    bringToFront(): void {\r\n        const W = window as any;\r\n\r\n        // Initialize __zIndexManager if not exists (needed for proper z-index stacking)\r\n        if (!W.__zIndexManager) {\r\n            this._ensureZIndexManager();\r\n        }\r\n\r\n        // Use __zIndexManager for consistent z-index management across all windows\r\n        if (W.__zIndexManager && typeof W.__zIndexManager.bringToFront === 'function') {\r\n            W.__zIndexManager.bringToFront(this.id, this.element, this.element);\r\n            // Notify menubar about focus change\r\n            // Track active window in WindowRegistry if available\r\n            W.WindowRegistry?.setActiveWindow?.(this.id);\r\n            W.updateProgramLabelByTopModal?.();\r\n            // Refresh dynamic application menu (e.g. switch to Terminal menu)\r\n            const menuSystem = W.MenuSystem;\r\n            if (menuSystem?.renderApplicationMenu) {\r\n                // Pass current menu modal id so sections rebuild with new active context\r\n                const current = menuSystem.getCurrentMenuModalId?.();\r\n                menuSystem.renderApplicationMenu(current);\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Fallback to WindowRegistry (should rarely happen now)\r\n        if (W.WindowRegistry) {\r\n            this.zIndex = W.WindowRegistry.getNextZIndex();\r\n            if (this.element) {\r\n                this.element.style.zIndex = String(this.zIndex);\r\n            }\r\n            W.WindowRegistry.setActiveWindow?.(this.id);\r\n        }\r\n\r\n        // Notify menubar about focus change\r\n        W.updateProgramLabelByTopModal?.();\r\n        const menuSystem = W.MenuSystem;\r\n        if (menuSystem?.renderApplicationMenu) {\r\n            const current = menuSystem.getCurrentMenuModalId?.();\r\n            menuSystem.renderApplicationMenu(current);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Ensure __zIndexManager exists. This is normally initialized by Dialog class,\r\n     * but BaseWindow instances may be created before any Dialog, so we initialize it here.\r\n     */\r\n    private _ensureZIndexManager(): void {\r\n        const W = window as any;\r\n        if (W.__zIndexManager) return;\r\n\r\n        const BASE_Z_INDEX = 1000;\r\n        const MAX_WINDOW_Z_INDEX = 2147483500; // Below Dock (2147483550) and Launchpad (2147483600)\r\n        const windowStack: string[] = []; // Ordered list of window IDs (bottom to top)\r\n\r\n        W.__zIndexManager = {\r\n            bringToFront(windowId: string, _modal: HTMLElement, _windowEl?: HTMLElement | null) {\r\n                // Remove from current position if exists\r\n                const currentIndex = windowStack.indexOf(windowId);\r\n                if (currentIndex !== -1) {\r\n                    windowStack.splice(currentIndex, 1);\r\n                }\r\n\r\n                // Add to top of stack\r\n                windowStack.push(windowId);\r\n\r\n                // Reassign z-indexes to all windows in stack\r\n                // This prevents z-index from growing indefinitely\r\n                windowStack.forEach((id, index) => {\r\n                    const zIndex = BASE_Z_INDEX + index;\r\n                    const element = document.getElementById(id);\r\n\r\n                    if (element) {\r\n                        // Clamp to maximum to ensure critical UI elements stay on top\r\n                        const clampedZIndex = Math.min(zIndex, MAX_WINDOW_Z_INDEX);\r\n                        element.style.zIndex = clampedZIndex.toString();\r\n\r\n                        // Also update windowEl if it's a separate element\r\n                        const win = element.querySelector('.window-container') as HTMLElement;\r\n                        if (win) {\r\n                            win.style.zIndex = clampedZIndex.toString();\r\n                        }\r\n                    }\r\n                });\r\n\r\n                // Update legacy topZIndex for compatibility\r\n                W.topZIndex = Math.min(BASE_Z_INDEX + windowStack.length, MAX_WINDOW_Z_INDEX);\r\n            },\r\n\r\n            removeWindow(windowId: string) {\r\n                const index = windowStack.indexOf(windowId);\r\n                if (index !== -1) {\r\n                    windowStack.splice(index, 1);\r\n                }\r\n            },\r\n\r\n            getWindowStack() {\r\n                return [...windowStack];\r\n            },\r\n\r\n            restoreWindowStack(savedStack: string[]) {\r\n                // Clear current stack\r\n                windowStack.length = 0;\r\n\r\n                // Restore stack in order, validating each window exists\r\n                savedStack.forEach(windowId => {\r\n                    const element = document.getElementById(windowId);\r\n                    if (element) {\r\n                        windowStack.push(windowId);\r\n                    }\r\n                });\r\n\r\n                // Reassign z-indexes based on restored order\r\n                windowStack.forEach((id, index) => {\r\n                    const zIndex = BASE_Z_INDEX + index;\r\n                    const element = document.getElementById(id);\r\n\r\n                    if (element) {\r\n                        const clampedZIndex = Math.min(zIndex, MAX_WINDOW_Z_INDEX);\r\n                        element.style.zIndex = clampedZIndex.toString();\r\n\r\n                        const win = element.querySelector('.window-container') as HTMLElement;\r\n                        if (win) {\r\n                            win.style.zIndex = clampedZIndex.toString();\r\n                        }\r\n                    }\r\n                });\r\n            },\r\n\r\n            reset() {\r\n                windowStack.length = 0;\r\n            },\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Tab hinzufügen. Erzeugt bei Bedarf dessen DOM und hängt ihn in die Content‑Area.\r\n     * Falls noch kein aktiver Tab existiert, wird dieser gesetzt. Rendert die Tabbar neu\r\n     * und speichert den Zustand.\r\n     */\r\n    addTab(tab: BaseTab): void {\r\n        this.tabs.set(tab.id, tab);\r\n        tab.setParentWindow(this);\r\n\r\n        // Create tab DOM if not exists\r\n        if (!tab.element) {\r\n            tab.element = tab.createDOM();\r\n        }\r\n\r\n        // Append tab content to window content area (only if window DOM exists)\r\n        if (tab.element && this.contentElement) {\r\n            this.contentElement.appendChild(tab.element);\r\n        }\r\n        // If window DOM doesn't exist yet, tab will be added when show() is called\r\n\r\n        if (!this.activeTabId) {\r\n            this.setActiveTab(tab.id);\r\n        }\r\n\r\n        this._renderTabs();\r\n        this._saveState();\r\n    }\r\n\r\n    /**\r\n     * Tab entfernen und ggf. anderen Tab aktivieren. Bei Leere wird das Fenster\r\n     * automatisch geschlossen.\r\n     */\r\n    removeTab(tabId: string): void {\r\n        const tab = this.tabs.get(tabId);\r\n        if (!tab) return;\r\n\r\n        tab.destroy();\r\n        this.tabs.delete(tabId);\r\n\r\n        // If this was the active tab, activate another\r\n        if (this.activeTabId === tabId) {\r\n            const remainingTabs = Array.from(this.tabs.keys());\r\n            this.activeTabId = remainingTabs[0] || null;\r\n            if (this.activeTabId) {\r\n                this.setActiveTab(this.activeTabId);\r\n            }\r\n        }\r\n\r\n        // If no tabs left, close window\r\n        if (this.tabs.size === 0) {\r\n            this.close();\r\n        } else {\r\n            this._renderTabs();\r\n            this._saveState();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Tab abkoppeln (z. B. für Drag&Drop in anderes Fenster). Der Tab bleibt bestehen,\r\n     * wird aber aus diesem Fenster entfernt und versteckt.\r\n     */\r\n    detachTab(tabId: string): BaseTab | null {\r\n        const tab = this.tabs.get(tabId) || null;\r\n        if (!tab) return null;\r\n\r\n        // Hide but do not destroy\r\n        tab.hide();\r\n        tab.setParentWindow(null as unknown as any);\r\n        this.tabs.delete(tabId);\r\n\r\n        // Adjust active tab\r\n        if (this.activeTabId === tabId) {\r\n            const remaining = Array.from(this.tabs.keys());\r\n            this.activeTabId = remaining[0] || null;\r\n            if (this.activeTabId) this.setActiveTab(this.activeTabId);\r\n        }\r\n\r\n        if (this.tabs.size === 0) {\r\n            this.close();\r\n        } else {\r\n            this._renderTabs();\r\n            this._saveState();\r\n        }\r\n\r\n        return tab;\r\n    }\r\n\r\n    /**\r\n     * Tab in ein Ziel‑Fenster verschieben.\r\n     */\r\n    transferTabTo(target: BaseWindow, tabId: string): void {\r\n        const tab = this.detachTab(tabId);\r\n        if (tab) {\r\n            target.addTab(tab);\r\n            target.setActiveTab(tab.id);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Aktiven Tab setzen (zeigt diesen und versteckt alle anderen).\r\n     */\r\n    setActiveTab(tabId: string): void {\r\n        const tab = this.tabs.get(tabId);\r\n        if (!tab) return;\r\n\r\n        // Hide all tabs\r\n        this.tabs.forEach(t => t.hide());\r\n\r\n        // Show active tab\r\n        this.activeTabId = tabId;\r\n        tab.show();\r\n\r\n        this._renderTabs();\r\n        this._saveState();\r\n    }\r\n\r\n    /**\r\n     * Einfache Default‑Tabbar. Subklassen (z. B. FinderWindow/TextEditorWindow) können\r\n     * diese Methode überschreiben und die dedizierte WindowTabs‑Leiste nutzen.\r\n     */\r\n    protected _renderTabs(): void {\r\n        // Basic implementation - subclasses should override\r\n        const tabBar = this.element?.querySelector(`#${this.id}-tabs`);\r\n        if (!tabBar) return;\r\n\r\n        tabBar.innerHTML = '';\r\n\r\n        this.tabs.forEach(tab => {\r\n            const tabEl = document.createElement('button');\r\n            tabEl.className = `px-3 py-1 text-sm ${tab.id === this.activeTabId ? 'bg-white dark:bg-gray-900' : 'bg-gray-200 dark:bg-gray-800'}`;\r\n            tabEl.textContent = tab.title;\r\n            tabEl.addEventListener('click', () => this.setActiveTab(tab.id));\r\n\r\n            tabBar.appendChild(tabEl);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Serialisierung des Fensterzustands (für Session‑Restore).\r\n     */\r\n    serialize(): WindowState {\r\n        return {\r\n            id: this.id,\r\n            type: this.type,\r\n            position: { ...this.position },\r\n            zIndex: this.zIndex,\r\n            isMinimized: this.isMinimized,\r\n            isMaximized: this.isMaximized,\r\n            activeTabId: this.activeTabId,\r\n            tabs: Array.from(this.tabs.keys()),\r\n            created: this.metadata.created || Date.now(),\r\n            modified: Date.now(),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Rehydrierung aus persistiertem Zustand. Subklassen können eigene\r\n     * deserialize‑Routinen bereitstellen.\r\n     */\r\n    static deserialize(state: WindowState): BaseWindow {\r\n        const window = new BaseWindow({\r\n            id: state.id,\r\n            type: state.type,\r\n            position: state.position,\r\n            metadata: {\r\n                created: state.created,\r\n            },\r\n        });\r\n\r\n        window.zIndex = state.zIndex;\r\n        window.isMinimized = state.isMinimized;\r\n        window.isMaximized = state.isMaximized;\r\n        window.activeTabId = state.activeTabId;\r\n\r\n        return window;\r\n    }\r\n\r\n    private _saveState(): void {\r\n        const W = window as any;\r\n\r\n        // Trigger multi-window session save (debounced)\r\n        if (W.MultiWindowSessionManager) {\r\n            W.MultiWindowSessionManager.saveSession();\r\n        }\r\n\r\n        // Legacy session manager (for backwards compatibility)\r\n        if (W.SessionManager) {\r\n            W.SessionManager.saveWindowState?.(this.serialize());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Vollständiges Aufräumen: Tabs zerstören, DOM entfernen, Menubar aktualisieren\r\n     * und Session speichern.\r\n     */\r\n    destroy(): void {\r\n        // Destroy all tabs\r\n        this.tabs.forEach(tab => tab.destroy());\r\n        this.tabs.clear();\r\n\r\n        // Remove DOM\r\n        if (this.element) {\r\n            this.element.remove();\r\n            this.element = null;\r\n        }\r\n\r\n        this._saveState();\r\n        // Update menubar after destruction\r\n        const W = window as any;\r\n        W.updateProgramLabelByTopModal?.();\r\n    }\r\n\r\n    /**\r\n     * Registrierung im (legacy) WindowManager, damit ProgramLabel/Anwendungsmenüs\r\n     * korrekt auf das aktive Fenster gemappt werden. Diese Brücke hält die neue\r\n     * Multi‑Window‑Welt kompatibel zur bestehenden Menubar.\r\n     */\r\n    private _registerWithWindowManager(): void {\r\n        const W = window as any;\r\n        const WM = W.WindowManager;\r\n        if (!WM || typeof WM.getConfig !== 'function' || typeof WM.register !== 'function') return;\r\n        if (WM.getConfig(this.id)) return; // already registered\r\n\r\n        // Map window types to programKey/icon used by the menubar\r\n        const map: Record<string, { programKey: string; icon: string }> = {\r\n            finder: { programKey: 'programs.finder', icon: './img/sucher.png' },\r\n            'text-editor': { programKey: 'programs.text', icon: './img/notepad.png' },\r\n            terminal: { programKey: 'programs.terminal', icon: './img/terminal.png' },\r\n        };\r\n        const meta = map[this.type] || { programKey: 'programs.default', icon: './img/sucher.png' };\r\n\r\n        try {\r\n            WM.register({\r\n                id: this.id,\r\n                type: 'persistent',\r\n                programKey: meta.programKey,\r\n                icon: meta.icon,\r\n                closeButtonId: null,\r\n                metadata: {\r\n                    /* dynamic multi-window */\r\n                },\r\n            });\r\n            if (typeof WM.setDialogInstance === 'function') {\r\n                WM.setDialogInstance(this.id, {\r\n                    open: () => this.show(),\r\n                    close: () => this.hide(),\r\n                    bringToFront: () => this.bringToFront(),\r\n                });\r\n            }\r\n        } catch (e) {\r\n            console.warn('[BaseWindow] WM.register failed for', this.id, e);\r\n        }\r\n    }\r\n}\r\n\r\n// Export to window for global access\r\n(window as any).BaseWindow = BaseWindow;\r\n"]}