{"version":3,"file":"keyboard-shortcuts.js","sourceRoot":"","sources":["../src/ts/keyboard-shortcuts.ts"],"names":[],"mappings":";AAAA,CAAC;IACC,YAAY,CAAC;IAyBb,MAAM,KAAK,GAAG;QACZ,QAAQ,EAAE,EAAe;QACzB,eAAe,EAAE,CAAC,GAAG,EAAE,CAAC,QAAQ,CAAiB;QACjD,sBAAsB,EAAE,KAAK;KAC9B,CAAC;IAEF,SAAS,KAAK;QACZ,OAAO,SAAS,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;IAC1D,CAAC;IAED,SAAS,UAAU,CAAC,MAA0B;QAC5C,IAAI,CAAC,CAAC,MAAM,YAAY,OAAO,CAAC;YAAE,OAAO,KAAK,CAAC;QAC/C,MAAM,GAAG,GAAG,MAAM,CAAC,OAAO,EAAE,WAAW,EAAE,CAAC;QAC1C,IAAI,GAAG,KAAK,OAAO,IAAI,GAAG,KAAK,UAAU,IAAI,GAAG,KAAK,QAAQ;YAAE,OAAO,IAAI,CAAC;QAC3E,OAAQ,MAAsB,CAAC,iBAAiB,CAAC;IACnD,CAAC;IAED,SAAS,SAAS,CAAC,OAAe,EAAE,KAAa;QAC/C,OAAO,CAAC,OAAO,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC;IAC/B,CAAC;IAED,SAAS,SAAS,CAAC,OAAe,EAAE,KAAa;QAC/C,OAAO,CAAC,OAAO,GAAG,CAAC,GAAG,KAAK,CAAC,GAAG,KAAK,CAAC;IACvC,CAAC;IAED,SAAS,SAAS,CAAC,CAAU;QAC3B,IAAI,OAAO,CAAC,KAAK,QAAQ,IAAI,CAAC,KAAK,IAAI;YAAE,OAAO,KAAK,CAAC;QACtD,MAAM,GAAG,GAAG,CAAyC,CAAC;QACtD,OAAO,OAAO,GAAG,CAAC,GAAG,KAAK,QAAQ,IAAI,OAAO,GAAG,CAAC,OAAO,KAAK,UAAU,CAAC;IAC1E,CAAC;IAMD,SAAS,QAAQ,CAAC,IAAuB,EAAE,OAAgB,EAAa;QACtE,yBAAyB;QACzB,IAAI,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC;YACpB,MAAM,CAAC,GAAG,IAAe,CAAC;YAC1B,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YACvB,oBAAoB,EAAE,CAAC;YACvB,OAAO,GAAG,EAAE;gBACV,MAAM,GAAG,GAAG,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;gBACtC,IAAI,GAAG,IAAI,CAAC;oBAAE,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;YAC9C,CAAC,CAAC;QACJ,CAAC;QAED,gBAAgB;QAChB,MAAM,OAAO,GAAG,IAAe,CAAC;QAChC,MAAM,KAAK,GAA2B,IAAI,CAAC,KAAK,IAAI,QAAQ,CAAC;QAC7D,MAAM,OAAO,GAAG,CAAC,CAAgB,EAAE,EAAE;YACnC,MAAM,OAAO,GAAG,KAAK,EAAE,CAAC;YACxB,MAAM,GAAG,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC;YAC5C,IAAI,CAAC,GAAG;gBAAE,OAAO;YACjB,IAAI,UAAU,CAAC,CAAC,CAAC,MAAM,CAAC;gBAAE,OAAO;YACjC,MAAM,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC;YAEhC,IAAI,GAAG,KAAK,GAAG,EAAE,CAAC;gBAChB,CAAC,CAAC,cAAc,EAAE,CAAC;gBACnB,MAAM,KAAK,GAAG,IAAI,CAAC,eAAe,EAAE,EAAE,CAAC;gBACvC,OAAO,CAAC,cAAc,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC;gBAClC,OAAO;YACT,CAAC;YAED,MAAM,MAAM,GAAG,OAAO,CAAC,iBAAiB,EAAE,CAAC;YAC3C,MAAM,SAAS,GAAG,OAAO,CAAC,eAAe,EAAE,CAAC;YAC5C,MAAM,KAAK,GAAG,SAAS,CAAC,MAAM,CAAC;YAC/B,IAAI,KAAK,KAAK,CAAC;gBAAE,OAAO;YAExB,IAAI,GAAG,KAAK,GAAG,IAAI,MAAM,EAAE,CAAC;gBAC1B,CAAC,CAAC,cAAc,EAAE,CAAC;gBACnB,OAAO,CAAC,eAAe,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;gBAC3C,OAAO;YACT,CAAC;YAED,IAAI,GAAG,KAAK,KAAK,EAAE,CAAC;gBAClB,CAAC,CAAC,cAAc,EAAE,CAAC;gBACnB,MAAM,YAAY,GAAG,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,UAAU,KAAK,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBAChG,MAAM,GAAG,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,SAAS,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;gBACzF,MAAM,MAAM,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC;gBAC9B,IAAI,MAAM;oBAAE,OAAO,CAAC,iBAAiB,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;gBACzD,OAAO;YACT,CAAC;YAED,IAAI,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC;gBACxB,CAAC,CAAC,cAAc,EAAE,CAAC;gBACnB,MAAM,CAAC,GAAG,QAAQ,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;gBAC5B,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,KAAK,GAAG,CAAC,CAAC,CAAC;gBACvC,MAAM,MAAM,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC;gBAC9B,IAAI,MAAM;oBAAE,OAAO,CAAC,iBAAiB,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;gBACzD,OAAO;YACT,CAAC;QACH,CAAC,CAAC;QACF,KAAK,CAAC,gBAAgB,CAAC,SAAS,EAAE,OAAmC,CAAC,CAAC;QACvE,OAAO,GAAG,EAAE,CAAC,KAAK,CAAC,mBAAmB,CAAC,SAAS,EAAE,OAAmC,CAAC,CAAC;IACzF,CAAC;IAED,SAAS,oBAAoB;QAC3B,IAAI,KAAK,CAAC,sBAAsB;YAAE,OAAO;QACzC,MAAM,QAAQ,GAAG,CAAC,CAAgB,EAAE,EAAE;YACpC,MAAM,OAAO,GAAG,KAAK,EAAE,CAAC;YACxB,MAAM,GAAG,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC;YAC5C,IAAI,CAAC,GAAG;gBAAE,OAAO;YACjB,IAAI,UAAU,CAAC,CAAC,CAAC,MAAM,CAAC;gBAAE,OAAO;YACjC,MAAM,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC;YAChC,MAAM,OAAO,GAAG,KAAK,CAAC,eAAe,EAAE,EAAE,IAAI,QAAQ,CAAC;YACtD,4DAA4D;YAC5D,MAAM,OAAO,GAAG,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;gBACtC,IAAI,CAAC,CAAC,GAAG,CAAC,WAAW,EAAE,KAAK,GAAG;oBAAE,OAAO,KAAK,CAAC;gBAC9C,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,IAAI;oBAAE,OAAO,KAAK,CAAC,CAAC,oCAAoC;gBACzE,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,IAAI,CAAC,CAAC,KAAK,KAAK,SAAS;oBAAE,OAAO,KAAK,CAAC;gBACtE,IAAI,CAAC,CAAC,OAAO,IAAI,CAAC,CAAC,OAAO,KAAK,OAAO;oBAAE,OAAO,KAAK,CAAC;gBACrD,OAAO,IAAI,CAAC;YACd,CAAC,CAAC,CAAC;YACH,IAAI,OAAO,EAAE,CAAC;gBACZ,CAAC,CAAC,cAAc,EAAE,CAAC;gBACnB,IAAI,CAAC;oBAAC,OAAO,CAAC,OAAO,EAAE,CAAC;gBAAC,CAAC;gBAAC,MAAM,CAAC,CAAA,CAAC;YACrC,CAAC;QACH,CAAC,CAAC;QACF,QAAQ,CAAC,gBAAgB,CAAC,SAAS,EAAE,QAAoC,CAAC,CAAC;QAC3E,KAAK,CAAC,sBAAsB,GAAG,IAAI,CAAC;IACtC,CAAC;IAED,SAAS,kBAAkB,CAAC,QAAsB;QAChD,KAAK,CAAC,eAAe,GAAG,QAAQ,CAAC;QACjC,oBAAoB,EAAE,CAAC;IACzB,CAAC;IAED,MAAM,iBAAiB,GAAG,EAAE,QAAQ,EAAE,kBAAkB,EAAE,CAAC;IAC1D,MAA8C,CAAC,iBAAiB,GAAG,iBAAiB,CAAC;AACxF,CAAC,CAAC,EAAE,CAAC","sourcesContent":["(function () {\n  'use strict';\n\n  type Instance = { instanceId: string };\n  type Manager = {\n    getAllInstances(): Instance[];\n    getActiveInstance(): Instance | null;\n    setActiveInstance(id: string): void;\n    createInstance(config?: { title?: string }): Instance | null;\n    destroyInstance(id: string): void;\n  };\n\n  interface Options {\n    scope?: HTMLElement | Document;\n    newTitleFactory?: () => string | undefined;\n  }\n\n  type Binding = {\n    key: string;\n    ctrl?: boolean;\n    shift?: boolean;\n    handler: () => void;\n    description?: string;\n    context?: string; // 'global' or a window type like 'finder'\n  };\n\n  const state = {\n    bindings: [] as Binding[],\n    contextResolver: (() => 'global') as () => string,\n    globalListenerAttached: false,\n  };\n\n  function isMac(): boolean {\n    return navigator.platform.toUpperCase().includes('MAC');\n  }\n\n  function isEditable(target: EventTarget | null): boolean {\n    if (!(target instanceof Element)) return false;\n    const tag = target.tagName?.toLowerCase();\n    if (tag === 'input' || tag === 'textarea' || tag === 'select') return true;\n    return (target as HTMLElement).isContentEditable;\n  }\n\n  function nextIndex(current: number, total: number): number {\n    return (current + 1) % total;\n  }\n\n  function prevIndex(current: number, total: number): number {\n    return (current - 1 + total) % total;\n  }\n\n  function isBinding(x: unknown): x is Binding {\n    if (typeof x !== 'object' || x === null) return false;\n    const obj = x as { key?: unknown; handler?: unknown };\n    return typeof obj.key === 'string' && typeof obj.handler === 'function';\n  }\n\n  // Legacy-friendly register that accepts a binding object (used by MultiInstanceIntegration)\n  function register(binding: Binding): () => void;\n  // Manager-scoped shortcuts helper (convenience API)\n  function register(manager: Manager, options?: Options): () => void;\n  function register(arg1: Binding | Manager, arg2: Options = {} as Options): () => void {\n    // Binding-style registry\n    if (isBinding(arg1)) {\n      const b = arg1 as Binding;\n      state.bindings.push(b);\n      ensureGlobalListener();\n      return () => {\n        const idx = state.bindings.indexOf(b);\n        if (idx >= 0) state.bindings.splice(idx, 1);\n      };\n    }\n\n    // Manager-style\n    const manager = arg1 as Manager;\n    const scope: Document | HTMLElement = arg2.scope || document;\n    const handler = (e: KeyboardEvent) => {\n      const useMeta = isMac();\n      const mod = useMeta ? e.metaKey : e.ctrlKey;\n      if (!mod) return;\n      if (isEditable(e.target)) return;\n      const key = e.key.toLowerCase();\n\n      if (key === 'n') {\n        e.preventDefault();\n        const title = arg2.newTitleFactory?.();\n        manager.createInstance({ title });\n        return;\n      }\n\n      const active = manager.getActiveInstance();\n      const instances = manager.getAllInstances();\n      const total = instances.length;\n      if (total === 0) return;\n\n      if (key === 'w' && active) {\n        e.preventDefault();\n        manager.destroyInstance(active.instanceId);\n        return;\n      }\n\n      if (key === 'tab') {\n        e.preventDefault();\n        const currentIndex = active ? instances.findIndex(i => i.instanceId === active.instanceId) : -1;\n        const idx = e.shiftKey ? prevIndex(currentIndex, total) : nextIndex(currentIndex, total);\n        const target = instances[idx];\n        if (target) manager.setActiveInstance(target.instanceId);\n        return;\n      }\n\n      if (/^[1-9]$/.test(key)) {\n        e.preventDefault();\n        const n = parseInt(key, 10);\n        const idx = Math.min(n - 1, total - 1);\n        const target = instances[idx];\n        if (target) manager.setActiveInstance(target.instanceId);\n        return;\n      }\n    };\n    scope.addEventListener('keydown', handler as unknown as EventListener);\n    return () => scope.removeEventListener('keydown', handler as unknown as EventListener);\n  }\n\n  function ensureGlobalListener() {\n    if (state.globalListenerAttached) return;\n    const listener = (e: KeyboardEvent) => {\n      const useMeta = isMac();\n      const mod = useMeta ? e.metaKey : e.ctrlKey;\n      if (!mod) return;\n      if (isEditable(e.target)) return;\n      const key = e.key.toLowerCase();\n      const context = state.contextResolver?.() || 'global';\n      // Find first matching binding for current context or global\n      const binding = state.bindings.find(b => {\n        if (b.key.toLowerCase() !== key) return false;\n        if (!!b.ctrl !== true) return false; // API expects ctrl/meta always true\n        if (!!b.shift !== !!e.shiftKey && b.shift !== undefined) return false;\n        if (b.context && b.context !== context) return false;\n        return true;\n      });\n      if (binding) {\n        e.preventDefault();\n        try { binding.handler(); } catch {}\n      }\n    };\n    document.addEventListener('keydown', listener as unknown as EventListener);\n    state.globalListenerAttached = true;\n  }\n\n  function setContextResolver(resolver: () => string) {\n    state.contextResolver = resolver;\n    ensureGlobalListener();\n  }\n\n  const KeyboardShortcuts = { register, setContextResolver };\n  (window as unknown as { [k: string]: unknown }).KeyboardShortcuts = KeyboardShortcuts;\n})();\n"]}