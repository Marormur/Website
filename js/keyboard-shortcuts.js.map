{"version":3,"file":"keyboard-shortcuts.js","sourceRoot":"","sources":["../src/ts/keyboard-shortcuts.ts"],"names":[],"mappings":"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","sourcesContent":["(function () {\r\n  'use strict';\r\n\r\n  type Instance = { instanceId: string };\r\n  type Manager = {\r\n    getAllInstances(): Instance[];\r\n    getActiveInstance(): Instance | null;\r\n    setActiveInstance(id: string): void;\r\n    createInstance(config?: { title?: string }): Instance | null;\r\n    destroyInstance(id: string): void;\r\n  };\r\n\r\n  interface Options {\r\n    scope?: HTMLElement | Document;\r\n    newTitleFactory?: () => string | undefined;\r\n  }\r\n\r\n  function isMac(): boolean {\r\n    return navigator.platform.toUpperCase().includes('MAC');\r\n  }\r\n\r\n  function isEditable(target: EventTarget | null): boolean {\r\n    if (!(target instanceof Element)) return false;\r\n    const tag = target.tagName?.toLowerCase();\r\n    if (tag === 'input' || tag === 'textarea' || tag === 'select') return true;\r\n    return (target as HTMLElement).isContentEditable;\r\n  }\r\n\r\n  function nextIndex(current: number, total: number): number {\r\n    return (current + 1) % total;\r\n  }\r\n\r\n  function prevIndex(current: number, total: number): number {\r\n    return (current - 1 + total) % total;\r\n  }\r\n\r\n  function register(manager: Manager, options: Options = {}): () => void {\r\n    const scope: Document | HTMLElement = options.scope || document;\r\n\r\n    const handler = (e: KeyboardEvent) => {\r\n      const useMeta = isMac();\r\n      const mod = useMeta ? e.metaKey : e.ctrlKey;\r\n\r\n      if (!mod) return;\r\n      if (isEditable(e.target)) return; // don't hijack typing\r\n\r\n      const key = e.key.toLowerCase();\r\n\r\n      // Cmd/Ctrl+N => new instance\r\n      if (key === 'n') {\r\n        e.preventDefault();\r\n        const title = options.newTitleFactory?.();\r\n        manager.createInstance({ title });\r\n        return;\r\n      }\r\n\r\n      const active = manager.getActiveInstance();\r\n      const instances = manager.getAllInstances();\r\n      const total = instances.length;\r\n\r\n      if (total === 0) return;\r\n\r\n      // Cmd/Ctrl+W => close active instance\r\n      if (key === 'w' && active) {\r\n        e.preventDefault();\r\n        manager.destroyInstance(active.instanceId);\r\n        return;\r\n      }\r\n\r\n      // Cmd/Ctrl+Tab => next, Shift+Tab => prev\r\n      if (key === 'tab') {\r\n        e.preventDefault();\r\n        const currentIndex = active ? instances.findIndex(i => i.instanceId === active.instanceId) : -1;\r\n        const idx = e.shiftKey ? prevIndex(currentIndex, total) : nextIndex(currentIndex, total);\r\n        const target = instances[idx];\r\n        if (target) manager.setActiveInstance(target.instanceId);\r\n        return;\r\n      }\r\n\r\n      // Cmd/Ctrl+1-9 => jump\r\n      if (/^[1-9]$/.test(key)) {\r\n        e.preventDefault();\r\n        const n = parseInt(key, 10);\r\n        const idx = Math.min(n - 1, total - 1);\r\n        const target = instances[idx];\r\n        if (target) manager.setActiveInstance(target.instanceId);\r\n        return;\r\n      }\r\n    };\r\n\r\n  scope.addEventListener('keydown', handler as unknown as EventListener);\r\n  return () => scope.removeEventListener('keydown', handler as unknown as EventListener);\r\n  }\r\n\r\n  const KeyboardShortcuts = { register };\r\n  (window as unknown as { [k: string]: unknown }).KeyboardShortcuts = KeyboardShortcuts;\r\n})();\r\n"]}