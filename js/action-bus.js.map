{"version":3,"file":"action-bus.js","sourceRoot":"","sources":["../src/ts/action-bus.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * ActionBus - Declarative event system to wire UI actions via data-action attributes.\r\n *\r\n * Example:\r\n *   <button data-action=\"closeWindow\" data-window-id=\"finder-modal\">Close</button>\r\n *   ActionBus.register('closeWindow', (params, el) => { ... })\r\n */\r\nconsole.log('ActionBus loaded');\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    type Params = Record<string, string | undefined>;\r\n    type Handler = (params: Params, element: HTMLElement | null) => void;\r\n\r\n    // Narrowly typed window surface we rely on\r\n    type GlobalExtras = {\r\n        dialogs?: Record<string, { open?: () => void; close?: () => void }>;\r\n        hideMenuDropdowns?: () => void;\r\n        resetWindowLayout?: () => void;\r\n        openProgramInfoDialog?: (arg: unknown) => void;\r\n        updateProgramLabelByTopModal?: () => void;\r\n        saveOpenModals?: () => void;\r\n        updateDockIndicators?: () => void;\r\n        openDesktopItemById?: (id: string) => void;\r\n    };\r\n\r\n    // Helper type to access the subset of FinderSystem APIs we call here\r\n    type FinderSystemLite = {\r\n        navigateUp?: () => void;\r\n        getState?: () => { currentView: string };\r\n        navigateTo?: (parts: string[], view?: string) => void;\r\n        setViewMode?: (mode: string) => void;\r\n        setSortBy?: (field: string) => void;\r\n        openItem?: (name: string, type: string) => void;\r\n    };\r\n    type WF = Window & { FinderSystem?: FinderSystemLite };\r\n\r\n    const actionHandlers = new Map<string, Handler>();\r\n    const eventDelegates: Array<{ eventType: string; delegate: (e: Event) => void }> = [];\r\n\r\n    const ActionBus = {\r\n        /**\r\n         * Registriert einen Action-Handler\r\n         * @param {string} actionName - Name der Action\r\n         * @param {Function} handler - Handler-Funktion (params, element) => void\r\n         */\r\n        register(actionName: string, handler: Handler) {\r\n            if (!actionName || typeof handler !== 'function') {\r\n                console.error('Invalid action registration:', actionName);\r\n                return;\r\n            }\r\n            actionHandlers.set(actionName, handler);\r\n        },\r\n\r\n        /**\r\n         * Registriert mehrere Actions auf einmal\r\n         * @param {Object} actions - Object mit actionName: handler Paaren\r\n         */\r\n        registerAll(actions: Record<string, Handler>) {\r\n            Object.entries(actions).forEach(([name, handler]) => {\r\n                this.register(name, handler);\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Führt eine Action aus\r\n         * @param {string} actionName - Name der Action\r\n         * @param {Object} params - Parameter für die Action\r\n         * @param {HTMLElement|null} element - Element das die Action ausgelöst hat\r\n         */\r\n        execute(actionName: string, params: Params = {}, element: HTMLElement | null = null) {\r\n            const handler = actionHandlers.get(actionName);\r\n            if (!handler) {\r\n                console.warn(`No handler registered for action: ${actionName}`);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                handler(params, element);\r\n            } catch (error) {\r\n                console.error(`Error executing action ${actionName}:`, error);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Initialisiert das Event-Delegation System\r\n         * Sucht alle Elemente mit data-action und bindet sie\r\n         */\r\n        init() {\r\n            // Click-Events\r\n            this.delegateEvent('click', '[data-action]', (element, event) => {\r\n                const actionName = element.getAttribute('data-action') as string;\r\n                const params = this.extractParams(element);\r\n\r\n                // Prevent default for buttons and links\r\n                if (element.tagName === 'BUTTON' || element.tagName === 'A') {\r\n                    event.preventDefault();\r\n                }\r\n                event.stopPropagation();\r\n\r\n                this.execute(actionName, params, element);\r\n            });\r\n\r\n            // Double-click support for data-action-dblclick\r\n            this.delegateEvent('dblclick', '[data-action-dblclick]', (element, event) => {\r\n                const actionName = element.getAttribute('data-action-dblclick') as string;\r\n                const params = this.extractParams(element);\r\n                if (element.tagName === 'BUTTON' || element.tagName === 'A') {\r\n                    event.preventDefault();\r\n                }\r\n                event.stopPropagation();\r\n                this.execute(actionName, params, element);\r\n            });\r\n\r\n            // Support für data-action-hover\r\n            this.delegateEvent('mouseenter', '[data-action-hover]', element => {\r\n                const actionName = element.getAttribute('data-action-hover') as string;\r\n                const params = this.extractParams(element);\r\n                this.execute(actionName, params, element);\r\n            });\r\n\r\n            console.log('ActionBus initialized');\r\n        },\r\n\r\n        /**\r\n         * Event-Delegation Helper\r\n         */\r\n        delegateEvent(\r\n            eventType: string,\r\n            selector: string,\r\n            handler: (element: HTMLElement, event: Event) => void\r\n        ) {\r\n            const delegate = (event: Event) => {\r\n                const target = event.target;\r\n                if (!(target instanceof Element)) return;\r\n\r\n                const element = target.closest(selector) as HTMLElement | null;\r\n                if (element) {\r\n                    handler(element, event);\r\n                }\r\n            };\r\n\r\n            document.addEventListener(eventType, delegate as EventListener);\r\n            eventDelegates.push({ eventType, delegate });\r\n        },\r\n\r\n        /**\r\n         * Extrahiert Parameter aus data-* Attributen\r\n         */\r\n        extractParams(element: HTMLElement): Params {\r\n            const params: Params = {};\r\n            const dataset = element.dataset;\r\n\r\n            // Alle data-* Attribute durchgehen, außer data-action selbst\r\n            for (const key in dataset) {\r\n                if (key !== 'action' && key !== 'actionHover') {\r\n                    params[key] = dataset[key];\r\n                }\r\n            }\r\n\r\n            return params;\r\n        },\r\n\r\n        /**\r\n         * Cleanup - entfernt alle Event-Listener\r\n         */\r\n        destroy() {\r\n            eventDelegates.forEach(({ eventType, delegate }) => {\r\n                document.removeEventListener(eventType, delegate as EventListener);\r\n            });\r\n            eventDelegates.length = 0;\r\n            actionHandlers.clear();\r\n        },\r\n    } as const;\r\n\r\n    // Standard-Actions registrieren\r\n    ActionBus.registerAll({\r\n        // Preview: generischer Öffnen-Handler (unterstützt direkte URLs oder Delegation an Finder)\r\n        openWithPreview: (params: Params) => {\r\n            try {\r\n                // 1) Direkte URL-Übergabe (ein Bild)\r\n                const single = (params['url'] || params['src'] || params['imageUrl']) as\r\n                    | string\r\n                    | undefined;\r\n                // 2) Liste als CSV\r\n                const csv = (params['urls'] || params['images']) as string | undefined;\r\n                // 3) Startindex\r\n                const idx = parseInt((params['index'] || '0') as string, 10) || 0;\r\n                // 4) Pfad (Anzeigezwecke)\r\n                const path = (params['path'] || params['imagePath']) as string | undefined;\r\n\r\n                const W = window as unknown as Window & {\r\n                    PreviewInstanceManager?: any;\r\n                    FinderSystem?: any;\r\n                };\r\n\r\n                if (single) {\r\n                    const list = [single];\r\n                    if (W.PreviewInstanceManager?.openImages) {\r\n                        W.PreviewInstanceManager.openImages(list, 0, path);\r\n                    }\r\n                    return;\r\n                }\r\n                if (csv) {\r\n                    const list = csv\r\n                        .split(',')\r\n                        .map(s => s.trim())\r\n                        .filter(Boolean);\r\n                    if (list.length && W.PreviewInstanceManager?.openImages) {\r\n                        W.PreviewInstanceManager.openImages(\r\n                            list,\r\n                            Math.max(0, Math.min(idx, list.length - 1)),\r\n                            path\r\n                        );\r\n                    }\r\n                    return;\r\n                }\r\n\r\n                // Fallback: Falls aus Finder mit Item-Name aufgerufen\r\n                const itemName = (params['itemName'] || params['name']) as string | undefined;\r\n                if (itemName && W.FinderSystem?.openItem) {\r\n                    W.FinderSystem.openItem(itemName, 'file');\r\n                }\r\n            } catch (e) {\r\n                console.warn('openWithPreview failed:', e);\r\n            }\r\n        },\r\n        // Fenster schließen\r\n        closeWindow: (params: Params) => {\r\n            const windowId = params.windowId;\r\n            if (!windowId) {\r\n                console.warn('closeWindow: missing windowId');\r\n                return;\r\n            }\r\n\r\n            const g = window as unknown as Window & GlobalExtras;\r\n            const wm = (window as Window & { WindowManager?: { close?: (id: string) => void } })\r\n                .WindowManager;\r\n            if (wm && typeof wm.close === 'function') {\r\n                wm.close(windowId);\r\n            }\r\n\r\n            // Callbacks\r\n            g.saveOpenModals?.();\r\n            g.updateDockIndicators?.();\r\n            g.updateProgramLabelByTopModal?.();\r\n        },\r\n\r\n        // Fenster öffnen\r\n        openWindow: (params: Params) => {\r\n            const windowId = params.windowId;\r\n            if (!windowId) {\r\n                console.warn('openWindow: missing windowId');\r\n                return;\r\n            }\r\n\r\n            // Close launchpad if it's open (clicking dock icon while launchpad is visible)\r\n            const launchpadModal = document.getElementById('launchpad-modal');\r\n            if (launchpadModal && !launchpadModal.classList.contains('hidden')) {\r\n                const g = window as unknown as Window & GlobalExtras;\r\n                g.dialogs?.['launchpad-modal']?.close?.();\r\n            }\r\n\r\n            (\r\n                window as Window & { WindowManager?: { open?: (id: string) => void } }\r\n            ).WindowManager?.open?.(windowId);\r\n\r\n            // Callbacks\r\n            (window as unknown as Window & GlobalExtras).updateProgramLabelByTopModal?.();\r\n        },\r\n\r\n        // Aktuelles (oberstes) Fenster schließen\r\n        closeTopWindow: () => {\r\n            const g = window as unknown as Window &\r\n                GlobalExtras & {\r\n                    WindowManager?: { getTopWindow?: () => unknown; close?: (id: string) => void };\r\n                };\r\n            g.hideMenuDropdowns?.();\r\n\r\n            const maybeTop = g.WindowManager?.getTopWindow?.();\r\n            let topId: string | null = null;\r\n            if (typeof maybeTop === 'string') {\r\n                topId = maybeTop;\r\n            } else if (maybeTop && typeof maybeTop === 'object') {\r\n                const obj = maybeTop as Record<string, unknown>;\r\n                if (typeof obj.id === 'string') topId = obj.id;\r\n            }\r\n            if (!topId) return;\r\n\r\n            g.WindowManager?.close?.(topId);\r\n\r\n            g.saveOpenModals?.();\r\n            g.updateDockIndicators?.();\r\n            g.updateProgramLabelByTopModal?.();\r\n        },\r\n\r\n        // Window-Layout zurücksetzen\r\n        resetWindowLayout: () => {\r\n            const g = window as unknown as Window & GlobalExtras;\r\n            g.hideMenuDropdowns?.();\r\n            g.resetWindowLayout?.();\r\n        },\r\n\r\n        // Program-Info Dialog öffnen\r\n        openProgramInfo: (_params: Params, _element: HTMLElement | null) => {\r\n            const g = window as unknown as Window & GlobalExtras;\r\n            g.hideMenuDropdowns?.();\r\n            g.openProgramInfoDialog?.(null);\r\n        },\r\n\r\n        // Über-Dialog öffnen (aus Apple-Menü)\r\n        openAbout: () => {\r\n            const g = window as unknown as Window & GlobalExtras;\r\n            g.hideMenuDropdowns?.();\r\n            g.dialogs?.['about-modal']?.open?.();\r\n            g.updateProgramLabelByTopModal?.();\r\n        },\r\n\r\n        // Settings öffnen\r\n        openSettings: () => {\r\n            const g = window as unknown as Window & GlobalExtras;\r\n            g.hideMenuDropdowns?.();\r\n            g.dialogs?.['settings-modal']?.open?.();\r\n            g.updateProgramLabelByTopModal?.();\r\n        },\r\n\r\n        // Desktop-Item öffnen (für Dock-Icons)\r\n        openDesktopItem: (params: Params) => {\r\n            const itemId = params.itemId;\r\n            if (!itemId) {\r\n                console.warn('openDesktopItem: missing itemId');\r\n                return;\r\n            }\r\n            const g = window as unknown as Window & GlobalExtras;\r\n            g.openDesktopItemById?.(itemId);\r\n        },\r\n\r\n        // Finder: eine Ebene nach oben\r\n        'finder:navigateUp': () => {\r\n            const wf = window as unknown as WF;\r\n            wf.FinderSystem?.navigateUp?.();\r\n        },\r\n\r\n        // Finder: zur Root der aktuellen Ansicht\r\n        'finder:goRoot': () => {\r\n            const wf = window as unknown as WF;\r\n            if (wf.FinderSystem?.navigateTo && wf.FinderSystem?.getState) {\r\n                const view = wf.FinderSystem.getState().currentView;\r\n                wf.FinderSystem.navigateTo([], view);\r\n            }\r\n        },\r\n\r\n        // Finder: Ansicht wechseln (computer/github/favorites/recent)\r\n        'finder:switchView': (params: Params) => {\r\n            const view = params['finderView'] || params.view;\r\n            if (!view) {\r\n                console.warn('finder:switchView: missing finderView');\r\n                return;\r\n            }\r\n            const wf = window as unknown as WF;\r\n            wf.FinderSystem?.navigateTo?.([], view as string);\r\n        },\r\n\r\n        // Finder: View-Mode setzen (list/grid/columns)\r\n        'finder:setViewMode': (params: Params) => {\r\n            const mode = params['viewMode'] || params['mode'];\r\n            if (!mode) {\r\n                console.warn('finder:setViewMode: missing viewMode');\r\n                return;\r\n            }\r\n            const wf = window as unknown as WF;\r\n            wf.FinderSystem?.setViewMode?.(mode as string);\r\n        },\r\n\r\n        // Finder: Sortierung setzen\r\n        'finder:setSortBy': (params: Params) => {\r\n            const field = params['sortBy'] || params['field'];\r\n            if (!field) {\r\n                console.warn('finder:setSortBy: missing sortBy');\r\n                return;\r\n            }\r\n            const wf = window as unknown as WF;\r\n            wf.FinderSystem?.setSortBy?.(field as string);\r\n        },\r\n\r\n        // Finder: In Pfad navigieren (data-path=\"A/B/C\")\r\n        'finder:navigateToPath': (params: Params) => {\r\n            const raw = params.path || '';\r\n            const parts = typeof raw === 'string' && raw.length ? raw.split('/') : [];\r\n            const wf = window as unknown as WF;\r\n            wf.FinderSystem?.navigateTo?.(parts);\r\n        },\r\n\r\n        // Finder: Item öffnen (Datei oder Ordner)\r\n        'finder:openItem': (params: Params) => {\r\n            const name = params['itemName'] || params['name'];\r\n            const type = params['itemType'] || params['type'];\r\n            if (!name || !type) {\r\n                console.warn('finder:openItem: missing name/type');\r\n                return;\r\n            }\r\n            const wf = window as unknown as WF;\r\n            wf.FinderSystem?.openItem?.(name as string, type as string);\r\n        },\r\n\r\n        // Settings: Show specific section\r\n        'settings:showSection': (params: Params) => {\r\n            const section = params['section'];\r\n            if (!section) {\r\n                console.warn('settings:showSection: missing section');\r\n                return;\r\n            }\r\n            const W = window as unknown as Window & {\r\n                SettingsSystem?: { showSection?: (section: string) => void };\r\n            };\r\n            W.SettingsSystem?.showSection?.(section as string);\r\n        },\r\n\r\n        // Session: Export current session as JSON file\r\n        'session:export': () => {\r\n            const W = window as unknown as Window & {\r\n                SessionManager?: { exportSession?: () => string | null };\r\n                appI18n?: { translate?: (key: string) => string };\r\n            };\r\n            const translate = W.appI18n?.translate || ((k: string) => k);\r\n\r\n            if (!W.SessionManager?.exportSession) {\r\n                console.error('SessionManager not available');\r\n                return;\r\n            }\r\n\r\n            const json = W.SessionManager.exportSession();\r\n            if (!json) {\r\n                alert(translate('menu.session.noSession'));\r\n                return;\r\n            }\r\n\r\n            // Create download link\r\n            const blob = new Blob([json], { type: 'application/json' });\r\n            const url = URL.createObjectURL(blob);\r\n            const a = document.createElement('a');\r\n            a.href = url;\r\n            a.download = `session-${new Date().toISOString().slice(0, 10)}.json`;\r\n            document.body.appendChild(a);\r\n            a.click();\r\n            document.body.removeChild(a);\r\n            URL.revokeObjectURL(url);\r\n\r\n            console.log('Session exported successfully');\r\n        },\r\n\r\n        // Session: Import session from JSON file\r\n        'session:import': () => {\r\n            const W = window as unknown as Window & {\r\n                SessionManager?: { importSession?: (json: string) => boolean };\r\n                appI18n?: { translate?: (key: string) => string };\r\n            };\r\n            const translate = W.appI18n?.translate || ((k: string) => k);\r\n\r\n            if (!W.SessionManager?.importSession) {\r\n                console.error('SessionManager not available');\r\n                return;\r\n            }\r\n\r\n            // Create file input\r\n            const input = document.createElement('input');\r\n            input.type = 'file';\r\n            input.accept = 'application/json,.json';\r\n            input.onchange = e => {\r\n                const file = (e.target as HTMLInputElement).files?.[0];\r\n                if (!file) return;\r\n\r\n                const reader = new FileReader();\r\n                reader.onload = event => {\r\n                    const json = event.target?.result;\r\n                    if (typeof json !== 'string') {\r\n                        alert(translate('menu.session.importError'));\r\n                        return;\r\n                    }\r\n\r\n                    const success = W.SessionManager?.importSession?.(json);\r\n                    if (success) {\r\n                        console.log('Session imported successfully');\r\n                    } else {\r\n                        alert(translate('menu.session.importError'));\r\n                    }\r\n                };\r\n                reader.onerror = () => {\r\n                    alert(translate('menu.session.importError'));\r\n                };\r\n                reader.readAsText(file);\r\n            };\r\n            input.click();\r\n        },\r\n    });\r\n\r\n    // Globaler Export\r\n    (window as unknown as { ActionBus: typeof ActionBus }).ActionBus = ActionBus;\r\n})();\r\n"]}