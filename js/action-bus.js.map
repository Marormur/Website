{"version":3,"file":"action-bus.js","sourceRoot":"","sources":["../src/ts/action-bus.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * ActionBus - Declarative event system to wire UI actions via data-action attributes.\n *\n * Example:\n *   <button data-action=\"closeWindow\" data-window-id=\"finder-modal\">Close</button>\n *   ActionBus.register('closeWindow', (params, el) => { ... })\n */\nconsole.log('ActionBus loaded');\n\n(function () {\n  'use strict';\n\n  type Params = Record<string, string | undefined>;\n  type Handler = (params: Params, element: HTMLElement | null) => void;\n\n  // Narrowly typed window surface we rely on\n  type GlobalExtras = {\n    dialogs?: Record<string, { open?: () => void; close?: () => void }>;\n    hideMenuDropdowns?: () => void;\n    resetWindowLayout?: () => void;\n    openProgramInfoDialog?: (arg: unknown) => void;\n    updateProgramLabelByTopModal?: () => void;\n    saveOpenModals?: () => void;\n    updateDockIndicators?: () => void;\n    openDesktopItemById?: (id: string) => void;\n  };\n\n  // Helper type to access the subset of FinderSystem APIs we call here\n  type FinderSystemLite = {\n    navigateUp?: () => void;\n    getState?: () => { currentView: string };\n    navigateTo?: (parts: string[], view?: string) => void;\n    setViewMode?: (mode: string) => void;\n    setSortBy?: (field: string) => void;\n    openItem?: (name: string, type: string) => void;\n  };\n  type WF = Window & { FinderSystem?: FinderSystemLite };\n\n  const actionHandlers = new Map<string, Handler>();\n  const eventDelegates: Array<{ eventType: string; delegate: (e: Event) => void }> = [];\n\n  const ActionBus = {\n    /**\n     * Registriert einen Action-Handler\n     * @param {string} actionName - Name der Action\n     * @param {Function} handler - Handler-Funktion (params, element) => void\n     */\n    register(actionName: string, handler: Handler) {\n      if (!actionName || typeof handler !== 'function') {\n        console.error('Invalid action registration:', actionName);\n        return;\n      }\n      actionHandlers.set(actionName, handler);\n    },\n\n    /**\n     * Registriert mehrere Actions auf einmal\n     * @param {Object} actions - Object mit actionName: handler Paaren\n     */\n    registerAll(actions: Record<string, Handler>) {\n      Object.entries(actions).forEach(([name, handler]) => {\n        this.register(name, handler);\n      });\n    },\n\n    /**\n     * Führt eine Action aus\n     * @param {string} actionName - Name der Action\n     * @param {Object} params - Parameter für die Action\n     * @param {HTMLElement|null} element - Element das die Action ausgelöst hat\n     */\n    execute(actionName: string, params: Params = {}, element: HTMLElement | null = null) {\n      const handler = actionHandlers.get(actionName);\n      if (!handler) {\n        console.warn(`No handler registered for action: ${actionName}`);\n        return;\n      }\n\n      try {\n        handler(params, element);\n      } catch (error) {\n        console.error(`Error executing action ${actionName}:`, error);\n      }\n    },\n\n    /**\n     * Initialisiert das Event-Delegation System\n     * Sucht alle Elemente mit data-action und bindet sie\n     */\n    init() {\n      // Click-Events\n      this.delegateEvent('click', '[data-action]', (element, event) => {\n        const actionName = element.getAttribute('data-action') as string;\n        const params = this.extractParams(element);\n\n        // Prevent default for buttons and links\n        if (element.tagName === 'BUTTON' || element.tagName === 'A') {\n          event.preventDefault();\n        }\n        event.stopPropagation();\n\n        this.execute(actionName, params, element);\n      });\n\n      // Double-click support for data-action-dblclick\n      this.delegateEvent('dblclick', '[data-action-dblclick]', (element, event) => {\n        const actionName = element.getAttribute('data-action-dblclick') as string;\n        const params = this.extractParams(element);\n        if (element.tagName === 'BUTTON' || element.tagName === 'A') {\n          event.preventDefault();\n        }\n        event.stopPropagation();\n        this.execute(actionName, params, element);\n      });\n\n      // Support für data-action-hover\n      this.delegateEvent('mouseenter', '[data-action-hover]', (element) => {\n        const actionName = element.getAttribute('data-action-hover') as string;\n        const params = this.extractParams(element);\n        this.execute(actionName, params, element);\n      });\n\n      console.log('ActionBus initialized');\n    },\n\n    /**\n     * Event-Delegation Helper\n     */\n    delegateEvent(eventType: string, selector: string, handler: (element: HTMLElement, event: Event) => void) {\n      const delegate = (event: Event) => {\n        const target = event.target;\n        if (!(target instanceof Element)) return;\n\n        const element = target.closest(selector) as HTMLElement | null;\n        if (element) {\n          handler(element, event);\n        }\n      };\n\n      document.addEventListener(eventType, delegate as EventListener);\n      eventDelegates.push({ eventType, delegate });\n    },\n\n    /**\n     * Extrahiert Parameter aus data-* Attributen\n     */\n    extractParams(element: HTMLElement): Params {\n      const params: Params = {};\n      const dataset = element.dataset;\n\n      // Alle data-* Attribute durchgehen, außer data-action selbst\n      for (const key in dataset) {\n        if (key !== 'action' && key !== 'actionHover') {\n          params[key] = dataset[key];\n        }\n      }\n\n      return params;\n    },\n\n    /**\n     * Cleanup - entfernt alle Event-Listener\n     */\n    destroy() {\n      eventDelegates.forEach(({ eventType, delegate }) => {\n        document.removeEventListener(eventType, delegate as EventListener);\n      });\n      eventDelegates.length = 0;\n      actionHandlers.clear();\n    },\n  } as const;\n\n  // Standard-Actions registrieren\n  ActionBus.registerAll({\n    // Fenster schließen\n    closeWindow: (params: Params) => {\n      const windowId = params.windowId;\n      if (!windowId) {\n        console.warn('closeWindow: missing windowId');\n        return;\n      }\n\n      const g = window as unknown as Window & GlobalExtras;\n      const wm = (window as Window & { WindowManager?: { close?: (id: string) => void } }).WindowManager;\n      if (wm && typeof wm.close === 'function') {\n        wm.close(windowId);\n      }\n\n      // Callbacks\n      g.saveOpenModals?.();\n      g.updateDockIndicators?.();\n      g.updateProgramLabelByTopModal?.();\n    },\n\n    // Fenster öffnen\n    openWindow: (params: Params) => {\n      const windowId = params.windowId;\n      if (!windowId) {\n        console.warn('openWindow: missing windowId');\n        return;\n      }\n\n      // Close launchpad if it's open (clicking dock icon while launchpad is visible)\n      const launchpadModal = document.getElementById('launchpad-modal');\n      if (launchpadModal && !launchpadModal.classList.contains('hidden')) {\n        const g = window as unknown as Window & GlobalExtras;\n        g.dialogs?.['launchpad-modal']?.close?.();\n      }\n\n      (window as Window & { WindowManager?: { open?: (id: string) => void } }).WindowManager?.open?.(windowId);\n\n      // Callbacks\n      (window as unknown as Window & GlobalExtras).updateProgramLabelByTopModal?.();\n    },\n\n    // Aktuelles (oberstes) Fenster schließen\n    closeTopWindow: () => {\n      const g = window as unknown as Window & GlobalExtras & { WindowManager?: { getTopWindow?: () => unknown; close?: (id: string) => void } };\n      g.hideMenuDropdowns?.();\n\n      const maybeTop = g.WindowManager?.getTopWindow?.();\n      let topId: string | null = null;\n      if (typeof maybeTop === 'string') {\n        topId = maybeTop;\n      } else if (maybeTop && typeof maybeTop === 'object') {\n        const obj = maybeTop as Record<string, unknown>;\n        if (typeof obj.id === 'string') topId = obj.id;\n      }\n      if (!topId) return;\n\n      g.WindowManager?.close?.(topId);\n\n      g.saveOpenModals?.();\n      g.updateDockIndicators?.();\n      g.updateProgramLabelByTopModal?.();\n    },\n\n    // Window-Layout zurücksetzen\n    resetWindowLayout: () => {\n      const g = window as unknown as Window & GlobalExtras;\n      g.hideMenuDropdowns?.();\n      g.resetWindowLayout?.();\n    },\n\n    // Program-Info Dialog öffnen\n    openProgramInfo: (_params: Params, _element: HTMLElement | null) => {\n      const g = window as unknown as Window & GlobalExtras;\n      g.hideMenuDropdowns?.();\n      g.openProgramInfoDialog?.(null);\n    },\n\n    // Über-Dialog öffnen (aus Apple-Menü)\n    openAbout: () => {\n      const g = window as unknown as Window & GlobalExtras;\n      g.hideMenuDropdowns?.();\n      g.dialogs?.['about-modal']?.open?.();\n      g.updateProgramLabelByTopModal?.();\n    },\n\n    // Settings öffnen\n    openSettings: () => {\n      const g = window as unknown as Window & GlobalExtras;\n      g.hideMenuDropdowns?.();\n      g.dialogs?.['settings-modal']?.open?.();\n      g.updateProgramLabelByTopModal?.();\n    },\n\n    // Desktop-Item öffnen (für Dock-Icons)\n    openDesktopItem: (params: Params) => {\n      const itemId = params.itemId;\n      if (!itemId) {\n        console.warn('openDesktopItem: missing itemId');\n        return;\n      }\n      const g = window as unknown as Window & GlobalExtras;\n      g.openDesktopItemById?.(itemId);\n    },\n\n    // Finder: eine Ebene nach oben\n    'finder:navigateUp': () => {\n      const wf = window as unknown as WF;\n      wf.FinderSystem?.navigateUp?.();\n    },\n\n    // Finder: zur Root der aktuellen Ansicht\n    'finder:goRoot': () => {\n      const wf = window as unknown as WF;\n      if (wf.FinderSystem?.navigateTo && wf.FinderSystem?.getState) {\n        const view = wf.FinderSystem.getState().currentView;\n        wf.FinderSystem.navigateTo([], view);\n      }\n    },\n\n    // Finder: Ansicht wechseln (computer/github/favorites/recent)\n    'finder:switchView': (params: Params) => {\n  const view = params['finderView'] || params.view;\n      if (!view) {\n        console.warn('finder:switchView: missing finderView');\n        return;\n      }\n      const wf = window as unknown as WF;\n      wf.FinderSystem?.navigateTo?.([], view as string);\n    },\n\n    // Finder: View-Mode setzen (list/grid/columns)\n    'finder:setViewMode': (params: Params) => {\n  const mode = params['viewMode'] || params['mode'];\n      if (!mode) {\n        console.warn('finder:setViewMode: missing viewMode');\n        return;\n      }\n      const wf = window as unknown as WF;\n      wf.FinderSystem?.setViewMode?.(mode as string);\n    },\n\n    // Finder: Sortierung setzen\n    'finder:setSortBy': (params: Params) => {\n  const field = params['sortBy'] || params['field'];\n      if (!field) {\n        console.warn('finder:setSortBy: missing sortBy');\n        return;\n      }\n      const wf = window as unknown as WF;\n      wf.FinderSystem?.setSortBy?.(field as string);\n    },\n\n    // Finder: In Pfad navigieren (data-path=\"A/B/C\")\n    'finder:navigateToPath': (params: Params) => {\n      const raw = params.path || '';\n      const parts = typeof raw === 'string' && raw.length ? raw.split('/') : [];\n      const wf = window as unknown as WF;\n      wf.FinderSystem?.navigateTo?.(parts);\n    },\n\n    // Finder: Item öffnen (Datei oder Ordner)\n    'finder:openItem': (params: Params) => {\n  const name = params['itemName'] || params['name'];\n  const type = params['itemType'] || params['type'];\n      if (!name || !type) {\n        console.warn('finder:openItem: missing name/type');\n        return;\n      }\n      const wf = window as unknown as WF;\n      wf.FinderSystem?.openItem?.(name as string, type as string);\n    },\n  });\n\n  // Globaler Export\n  (window as unknown as { ActionBus: typeof ActionBus }).ActionBus = ActionBus;\n})();\n"]}