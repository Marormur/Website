{"version":3,"file":"action-bus.js","sourceRoot":"","sources":["../src/ts/action-bus.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * ActionBus - Declarative event system to wire UI actions via data-action attributes.\r\n *\r\n * Example:\r\n *   <button data-action=\"closeWindow\" data-window-id=\"finder-modal\">Close</button>\r\n *   ActionBus.register('closeWindow', (params, el) => { ... })\r\n */\r\nconsole.log('ActionBus loaded');\r\n\r\n(function () {\r\n  'use strict';\r\n\r\n  type Params = Record<string, string | undefined>;\r\n  type Handler = (params: Params, element: HTMLElement | null) => void;\r\n\r\n  // Narrowly typed window surface we rely on\r\n  type GlobalExtras = {\r\n    dialogs?: Record<string, { open?: () => void; close?: () => void }>;\r\n    hideMenuDropdowns?: () => void;\r\n    resetWindowLayout?: () => void;\r\n    openProgramInfoDialog?: (arg: unknown) => void;\r\n    updateProgramLabelByTopModal?: () => void;\r\n    saveOpenModals?: () => void;\r\n    updateDockIndicators?: () => void;\r\n    openDesktopItemById?: (id: string) => void;\r\n  };\r\n\r\n  // Helper type to access the subset of FinderSystem APIs we call here\r\n  type FinderSystemLite = {\r\n    navigateUp?: () => void;\r\n    getState?: () => { currentView: string };\r\n    navigateTo?: (parts: string[], view?: string) => void;\r\n    setViewMode?: (mode: string) => void;\r\n    setSortBy?: (field: string) => void;\r\n    openItem?: (name: string, type: string) => void;\r\n  };\r\n  type WF = Window & { FinderSystem?: FinderSystemLite };\r\n\r\n  const actionHandlers = new Map<string, Handler>();\r\n  const eventDelegates: Array<{ eventType: string; delegate: (e: Event) => void }> = [];\r\n\r\n  const ActionBus = {\r\n    /**\r\n     * Registriert einen Action-Handler\r\n     * @param {string} actionName - Name der Action\r\n     * @param {Function} handler - Handler-Funktion (params, element) => void\r\n     */\r\n    register(actionName: string, handler: Handler) {\r\n      if (!actionName || typeof handler !== 'function') {\r\n        console.error('Invalid action registration:', actionName);\r\n        return;\r\n      }\r\n      actionHandlers.set(actionName, handler);\r\n    },\r\n\r\n    /**\r\n     * Registriert mehrere Actions auf einmal\r\n     * @param {Object} actions - Object mit actionName: handler Paaren\r\n     */\r\n    registerAll(actions: Record<string, Handler>) {\r\n      Object.entries(actions).forEach(([name, handler]) => {\r\n        this.register(name, handler);\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Führt eine Action aus\r\n     * @param {string} actionName - Name der Action\r\n     * @param {Object} params - Parameter für die Action\r\n     * @param {HTMLElement|null} element - Element das die Action ausgelöst hat\r\n     */\r\n    execute(actionName: string, params: Params = {}, element: HTMLElement | null = null) {\r\n      const handler = actionHandlers.get(actionName);\r\n      if (!handler) {\r\n        console.warn(`No handler registered for action: ${actionName}`);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        handler(params, element);\r\n      } catch (error) {\r\n        console.error(`Error executing action ${actionName}:`, error);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Initialisiert das Event-Delegation System\r\n     * Sucht alle Elemente mit data-action und bindet sie\r\n     */\r\n    init() {\r\n      // Click-Events\r\n      this.delegateEvent('click', '[data-action]', (element, event) => {\r\n        const actionName = element.getAttribute('data-action') as string;\r\n        const params = this.extractParams(element);\r\n\r\n        // Prevent default for buttons and links\r\n        if (element.tagName === 'BUTTON' || element.tagName === 'A') {\r\n          event.preventDefault();\r\n        }\r\n        event.stopPropagation();\r\n\r\n        this.execute(actionName, params, element);\r\n      });\r\n\r\n      // Double-click support for data-action-dblclick\r\n      this.delegateEvent('dblclick', '[data-action-dblclick]', (element, event) => {\r\n        const actionName = element.getAttribute('data-action-dblclick') as string;\r\n        const params = this.extractParams(element);\r\n        if (element.tagName === 'BUTTON' || element.tagName === 'A') {\r\n          event.preventDefault();\r\n        }\r\n        event.stopPropagation();\r\n        this.execute(actionName, params, element);\r\n      });\r\n\r\n      // Support für data-action-hover\r\n      this.delegateEvent('mouseenter', '[data-action-hover]', (element) => {\r\n        const actionName = element.getAttribute('data-action-hover') as string;\r\n        const params = this.extractParams(element);\r\n        this.execute(actionName, params, element);\r\n      });\r\n\r\n      console.log('ActionBus initialized');\r\n    },\r\n\r\n    /**\r\n     * Event-Delegation Helper\r\n     */\r\n    delegateEvent(eventType: string, selector: string, handler: (element: HTMLElement, event: Event) => void) {\r\n      const delegate = (event: Event) => {\r\n        const target = event.target;\r\n        if (!(target instanceof Element)) return;\r\n\r\n        const element = target.closest(selector) as HTMLElement | null;\r\n        if (element) {\r\n          handler(element, event);\r\n        }\r\n      };\r\n\r\n      document.addEventListener(eventType, delegate as EventListener);\r\n      eventDelegates.push({ eventType, delegate });\r\n    },\r\n\r\n    /**\r\n     * Extrahiert Parameter aus data-* Attributen\r\n     */\r\n    extractParams(element: HTMLElement): Params {\r\n      const params: Params = {};\r\n      const dataset = element.dataset;\r\n\r\n      // Alle data-* Attribute durchgehen, außer data-action selbst\r\n      for (const key in dataset) {\r\n        if (key !== 'action' && key !== 'actionHover') {\r\n          params[key] = dataset[key];\r\n        }\r\n      }\r\n\r\n      return params;\r\n    },\r\n\r\n    /**\r\n     * Cleanup - entfernt alle Event-Listener\r\n     */\r\n    destroy() {\r\n      eventDelegates.forEach(({ eventType, delegate }) => {\r\n        document.removeEventListener(eventType, delegate as EventListener);\r\n      });\r\n      eventDelegates.length = 0;\r\n      actionHandlers.clear();\r\n    },\r\n  } as const;\r\n\r\n  // Standard-Actions registrieren\r\n  ActionBus.registerAll({\r\n    // Preview: generischer Öffnen-Handler (unterstützt direkte URLs oder Delegation an Finder)\r\n    openWithPreview: (params: Params) => {\r\n      try {\r\n        // 1) Direkte URL-Übergabe (ein Bild)\r\n        const single = (params['url'] || params['src'] || params['imageUrl']) as string | undefined;\r\n        // 2) Liste als CSV\r\n        const csv = (params['urls'] || params['images']) as string | undefined;\r\n        // 3) Startindex\r\n        const idx = parseInt((params['index'] || '0') as string, 10) || 0;\r\n        // 4) Pfad (Anzeigezwecke)\r\n        const path = (params['path'] || params['imagePath']) as string | undefined;\r\n\r\n        const W = window as unknown as Window & { PreviewInstanceManager?: any; FinderSystem?: any };\r\n\r\n        if (single) {\r\n          const list = [single];\r\n          if (W.PreviewInstanceManager?.openImages) {\r\n            W.PreviewInstanceManager.openImages(list, 0, path);\r\n          }\r\n          return;\r\n        }\r\n        if (csv) {\r\n          const list = csv\r\n            .split(',')\r\n            .map(s => s.trim())\r\n            .filter(Boolean);\r\n          if (list.length && W.PreviewInstanceManager?.openImages) {\r\n            W.PreviewInstanceManager.openImages(list, Math.max(0, Math.min(idx, list.length - 1)), path);\r\n          }\r\n          return;\r\n        }\r\n\r\n        // Fallback: Falls aus Finder mit Item-Name aufgerufen\r\n        const itemName = (params['itemName'] || params['name']) as string | undefined;\r\n        if (itemName && W.FinderSystem?.openItem) {\r\n          W.FinderSystem.openItem(itemName, 'file');\r\n        }\r\n      } catch (e) {\r\n        console.warn('openWithPreview failed:', e);\r\n      }\r\n    },\r\n    // Fenster schließen\r\n    closeWindow: (params: Params) => {\r\n      const windowId = params.windowId;\r\n      if (!windowId) {\r\n        console.warn('closeWindow: missing windowId');\r\n        return;\r\n      }\r\n\r\n      const g = window as unknown as Window & GlobalExtras;\r\n      const wm = (window as Window & { WindowManager?: { close?: (id: string) => void } }).WindowManager;\r\n      if (wm && typeof wm.close === 'function') {\r\n        wm.close(windowId);\r\n      }\r\n\r\n      // Callbacks\r\n      g.saveOpenModals?.();\r\n      g.updateDockIndicators?.();\r\n      g.updateProgramLabelByTopModal?.();\r\n    },\r\n\r\n    // Fenster öffnen\r\n    openWindow: (params: Params) => {\r\n      const windowId = params.windowId;\r\n      if (!windowId) {\r\n        console.warn('openWindow: missing windowId');\r\n        return;\r\n      }\r\n\r\n      // Close launchpad if it's open (clicking dock icon while launchpad is visible)\r\n      const launchpadModal = document.getElementById('launchpad-modal');\r\n      if (launchpadModal && !launchpadModal.classList.contains('hidden')) {\r\n        const g = window as unknown as Window & GlobalExtras;\r\n        g.dialogs?.['launchpad-modal']?.close?.();\r\n      }\r\n\r\n      (window as Window & { WindowManager?: { open?: (id: string) => void } }).WindowManager?.open?.(windowId);\r\n\r\n      // Callbacks\r\n      (window as unknown as Window & GlobalExtras).updateProgramLabelByTopModal?.();\r\n    },\r\n\r\n    // Aktuelles (oberstes) Fenster schließen\r\n    closeTopWindow: () => {\r\n      const g = window as unknown as Window & GlobalExtras & { WindowManager?: { getTopWindow?: () => unknown; close?: (id: string) => void } };\r\n      g.hideMenuDropdowns?.();\r\n\r\n      const maybeTop = g.WindowManager?.getTopWindow?.();\r\n      let topId: string | null = null;\r\n      if (typeof maybeTop === 'string') {\r\n        topId = maybeTop;\r\n      } else if (maybeTop && typeof maybeTop === 'object') {\r\n        const obj = maybeTop as Record<string, unknown>;\r\n        if (typeof obj.id === 'string') topId = obj.id;\r\n      }\r\n      if (!topId) return;\r\n\r\n      g.WindowManager?.close?.(topId);\r\n\r\n      g.saveOpenModals?.();\r\n      g.updateDockIndicators?.();\r\n      g.updateProgramLabelByTopModal?.();\r\n    },\r\n\r\n    // Window-Layout zurücksetzen\r\n    resetWindowLayout: () => {\r\n      const g = window as unknown as Window & GlobalExtras;\r\n      g.hideMenuDropdowns?.();\r\n      g.resetWindowLayout?.();\r\n    },\r\n\r\n    // Program-Info Dialog öffnen\r\n    openProgramInfo: (_params: Params, _element: HTMLElement | null) => {\r\n      const g = window as unknown as Window & GlobalExtras;\r\n      g.hideMenuDropdowns?.();\r\n      g.openProgramInfoDialog?.(null);\r\n    },\r\n\r\n    // Über-Dialog öffnen (aus Apple-Menü)\r\n    openAbout: () => {\r\n      const g = window as unknown as Window & GlobalExtras;\r\n      g.hideMenuDropdowns?.();\r\n      g.dialogs?.['about-modal']?.open?.();\r\n      g.updateProgramLabelByTopModal?.();\r\n    },\r\n\r\n    // Settings öffnen\r\n    openSettings: () => {\r\n      const g = window as unknown as Window & GlobalExtras;\r\n      g.hideMenuDropdowns?.();\r\n      g.dialogs?.['settings-modal']?.open?.();\r\n      g.updateProgramLabelByTopModal?.();\r\n    },\r\n\r\n    // Desktop-Item öffnen (für Dock-Icons)\r\n    openDesktopItem: (params: Params) => {\r\n      const itemId = params.itemId;\r\n      if (!itemId) {\r\n        console.warn('openDesktopItem: missing itemId');\r\n        return;\r\n      }\r\n      const g = window as unknown as Window & GlobalExtras;\r\n      g.openDesktopItemById?.(itemId);\r\n    },\r\n\r\n    // Finder: eine Ebene nach oben\r\n    'finder:navigateUp': () => {\r\n      const wf = window as unknown as WF;\r\n      wf.FinderSystem?.navigateUp?.();\r\n    },\r\n\r\n    // Finder: zur Root der aktuellen Ansicht\r\n    'finder:goRoot': () => {\r\n      const wf = window as unknown as WF;\r\n      if (wf.FinderSystem?.navigateTo && wf.FinderSystem?.getState) {\r\n        const view = wf.FinderSystem.getState().currentView;\r\n        wf.FinderSystem.navigateTo([], view);\r\n      }\r\n    },\r\n\r\n    // Finder: Ansicht wechseln (computer/github/favorites/recent)\r\n    'finder:switchView': (params: Params) => {\r\n  const view = params['finderView'] || params.view;\r\n      if (!view) {\r\n        console.warn('finder:switchView: missing finderView');\r\n        return;\r\n      }\r\n      const wf = window as unknown as WF;\r\n      wf.FinderSystem?.navigateTo?.([], view as string);\r\n    },\r\n\r\n    // Finder: View-Mode setzen (list/grid/columns)\r\n    'finder:setViewMode': (params: Params) => {\r\n  const mode = params['viewMode'] || params['mode'];\r\n      if (!mode) {\r\n        console.warn('finder:setViewMode: missing viewMode');\r\n        return;\r\n      }\r\n      const wf = window as unknown as WF;\r\n      wf.FinderSystem?.setViewMode?.(mode as string);\r\n    },\r\n\r\n    // Finder: Sortierung setzen\r\n    'finder:setSortBy': (params: Params) => {\r\n  const field = params['sortBy'] || params['field'];\r\n      if (!field) {\r\n        console.warn('finder:setSortBy: missing sortBy');\r\n        return;\r\n      }\r\n      const wf = window as unknown as WF;\r\n      wf.FinderSystem?.setSortBy?.(field as string);\r\n    },\r\n\r\n    // Finder: In Pfad navigieren (data-path=\"A/B/C\")\r\n    'finder:navigateToPath': (params: Params) => {\r\n      const raw = params.path || '';\r\n      const parts = typeof raw === 'string' && raw.length ? raw.split('/') : [];\r\n      const wf = window as unknown as WF;\r\n      wf.FinderSystem?.navigateTo?.(parts);\r\n    },\r\n\r\n    // Finder: Item öffnen (Datei oder Ordner)\r\n    'finder:openItem': (params: Params) => {\r\n  const name = params['itemName'] || params['name'];\r\n  const type = params['itemType'] || params['type'];\r\n      if (!name || !type) {\r\n        console.warn('finder:openItem: missing name/type');\r\n        return;\r\n      }\r\n      const wf = window as unknown as WF;\r\n      wf.FinderSystem?.openItem?.(name as string, type as string);\r\n    },\r\n  });\r\n\r\n  // Globaler Export\r\n  (window as unknown as { ActionBus: typeof ActionBus }).ActionBus = ActionBus;\r\n})();\r\n"]}