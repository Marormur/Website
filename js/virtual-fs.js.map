{"version":3,"file":"virtual-fs.js","sourceRoot":"","sources":["../src/ts/virtual-fs.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * virtual-fs.ts\r\n * Central Virtual File System\r\n *\r\n * Provides a persistent, in-memory file system that can be shared across\r\n * multiple modules (Finder, Terminal, TextEditor, etc.).\r\n *\r\n * Features:\r\n * - CRUD operations (Create, Read, Update, Delete)\r\n * - LocalStorage persistence\r\n * - Path-based navigation\r\n * - File metadata (size, modified, type)\r\n * - Event system for change notifications\r\n */\r\n\r\nimport { getJSON, setJSON } from './storage-utils.js';\r\n\r\n// ============================================================================\r\n// Types\r\n// ============================================================================\r\n\r\nexport interface VirtualFile {\r\n    type: 'file';\r\n    icon: string;\r\n    content: string;\r\n    size: number;\r\n    modified: string;\r\n    created: string;\r\n}\r\n\r\nexport interface VirtualFolder {\r\n    type: 'folder';\r\n    icon: string;\r\n    children: Record<string, VirtualFileSystemItem>;\r\n    modified: string;\r\n    created: string;\r\n}\r\n\r\nexport type VirtualFileSystemItem = VirtualFile | VirtualFolder;\r\n\r\nexport interface FileSystemStats {\r\n    totalFiles: number;\r\n    totalFolders: number;\r\n    totalSize: number;\r\n}\r\n\r\nexport type FileSystemEventType = 'create' | 'update' | 'delete' | 'rename' | 'move';\r\n\r\nexport interface FileSystemEvent {\r\n    type: FileSystemEventType;\r\n    path: string;\r\n    item?: VirtualFileSystemItem;\r\n    oldPath?: string;\r\n}\r\n\r\ntype FileSystemListener = (event: FileSystemEvent) => void;\r\n\r\n// ============================================================================\r\n// Virtual File System Manager\r\n// ============================================================================\r\n\r\nclass VirtualFileSystemManager {\r\n    private root: Record<string, VirtualFolder>;\r\n    private listeners: FileSystemListener[] = [];\r\n    private readonly STORAGE_KEY = 'virtual-file-system';\r\n    private readonly AUTO_SAVE_DELAY = 1000; // 1 second debounce\r\n    private saveTimeout: number | null = null;\r\n\r\n    constructor() {\r\n        this.root = this.createDefaultStructure();\r\n        this.load();\r\n    }\r\n\r\n    // ========================================================================\r\n    // Initialization\r\n    // ========================================================================\r\n\r\n    private createDefaultStructure(): Record<string, VirtualFolder> {\r\n        const now = new Date().toISOString();\r\n\r\n        return {\r\n            '/': {\r\n                type: 'folder',\r\n                icon: '/',\r\n                created: now,\r\n                modified: now,\r\n                children: {\r\n                    home: {\r\n                        type: 'folder',\r\n                        icon: 'üè†',\r\n                        created: now,\r\n                        modified: now,\r\n                        children: {\r\n                            marvin: {\r\n                                type: 'folder',\r\n                                icon: 'üë§',\r\n                                created: now,\r\n                                modified: now,\r\n                                children: {\r\n                                    '.profile': {\r\n                                        type: 'file',\r\n                                        icon: '‚öôÔ∏è',\r\n                                        content:\r\n                                            '# ~/.profile\\n# User profile configuration\\n\\nexport PATH=$HOME/bin:/usr/local/bin:/usr/bin:/bin\\nexport EDITOR=vim\\n',\r\n                                        size: 112,\r\n                                        created: now,\r\n                                        modified: now,\r\n                                    },\r\n                                    'README.md': {\r\n                                        type: 'file',\r\n                                        icon: 'üìù',\r\n                                        content:\r\n                                            '# Welcome to your home directory\\n\\nThis is your personal space in the virtual file system.\\n\\n## Structure\\n- Documents: Store your text files and documents\\n- Downloads: Temporary download location\\n- Pictures: Image files\\n- Projects: Your code projects\\n',\r\n                                        size: 248,\r\n                                        created: now,\r\n                                        modified: now,\r\n                                    },\r\n                                    Documents: {\r\n                                        type: 'folder',\r\n                                        icon: 'üìÑ',\r\n                                        created: now,\r\n                                        modified: now,\r\n                                        children: {\r\n                                            'notes.txt': {\r\n                                                type: 'file',\r\n                                                icon: 'üìù',\r\n                                                content: 'Personal notes...',\r\n                                                size: 17,\r\n                                                created: now,\r\n                                                modified: now,\r\n                                            },\r\n                                        },\r\n                                    },\r\n                                    Downloads: {\r\n                                        type: 'folder',\r\n                                        icon: '‚¨áÔ∏è',\r\n                                        created: now,\r\n                                        modified: now,\r\n                                        children: {},\r\n                                    },\r\n                                    Pictures: {\r\n                                        type: 'folder',\r\n                                        icon: 'üñºÔ∏è',\r\n                                        created: now,\r\n                                        modified: now,\r\n                                        children: {},\r\n                                    },\r\n                                    Projects: {\r\n                                        type: 'folder',\r\n                                        icon: 'ÔøΩ',\r\n                                        created: now,\r\n                                        modified: now,\r\n                                        children: {},\r\n                                    },\r\n                                },\r\n                            },\r\n                        },\r\n                    },\r\n                    etc: {\r\n                        type: 'folder',\r\n                        icon: '‚öôÔ∏è',\r\n                        created: now,\r\n                        modified: now,\r\n                        children: {\r\n                            hosts: {\r\n                                type: 'file',\r\n                                icon: 'ÔøΩ',\r\n                                content:\r\n                                    '# /etc/hosts\\n127.0.0.1   localhost\\n::1         localhost\\n',\r\n                                size: 57,\r\n                                created: now,\r\n                                modified: now,\r\n                            },\r\n                        },\r\n                    },\r\n                    usr: {\r\n                        type: 'folder',\r\n                        icon: 'üì¶',\r\n                        created: now,\r\n                        modified: now,\r\n                        children: {\r\n                            bin: {\r\n                                type: 'folder',\r\n                                icon: '‚ö°',\r\n                                created: now,\r\n                                modified: now,\r\n                                children: {},\r\n                            },\r\n                            share: {\r\n                                type: 'folder',\r\n                                icon: 'üìö',\r\n                                created: now,\r\n                                modified: now,\r\n                                children: {\r\n                                    doc: {\r\n                                        type: 'folder',\r\n                                        icon: 'üìñ',\r\n                                        created: now,\r\n                                        modified: now,\r\n                                        children: {\r\n                                            README: {\r\n                                                type: 'file',\r\n                                                icon: 'üìù',\r\n                                                content:\r\n                                                    'Virtual File System Documentation\\n\\nThis is a UNIX-like filesystem hierarchy.\\n\\nStandard directories:\\n- /home: User home directories\\n- /etc: System configuration\\n- /usr: User programs and data\\n- /var: Variable data (logs, temp)\\n- /tmp: Temporary files\\n',\r\n                                                size: 252,\r\n                                                created: now,\r\n                                                modified: now,\r\n                                            },\r\n                                        },\r\n                                    },\r\n                                },\r\n                            },\r\n                        },\r\n                    },\r\n                    var: {\r\n                        type: 'folder',\r\n                        icon: 'üìä',\r\n                        created: now,\r\n                        modified: now,\r\n                        children: {\r\n                            log: {\r\n                                type: 'folder',\r\n                                icon: 'üìú',\r\n                                created: now,\r\n                                modified: now,\r\n                                children: {},\r\n                            },\r\n                            tmp: {\r\n                                type: 'folder',\r\n                                icon: 'ÔøΩÔ∏è',\r\n                                created: now,\r\n                                modified: now,\r\n                                children: {},\r\n                            },\r\n                        },\r\n                    },\r\n                    tmp: {\r\n                        type: 'folder',\r\n                        icon: 'üóëÔ∏è',\r\n                        created: now,\r\n                        modified: now,\r\n                        children: {},\r\n                    },\r\n                },\r\n            },\r\n        };\r\n    }\r\n\r\n    // ========================================================================\r\n    // Persistence\r\n    // ========================================================================\r\n\r\n    private load(): void {\r\n        try {\r\n            const stored = getJSON<Record<string, VirtualFolder>>(\r\n                this.STORAGE_KEY,\r\n                {} as Record<string, VirtualFolder>\r\n            );\r\n            if (stored && Object.keys(stored).length > 0) {\r\n                this.root = stored;\r\n                console.log('[VirtualFS] Loaded from localStorage');\r\n            } else {\r\n                console.log('[VirtualFS] No stored data, using defaults');\r\n            }\r\n        } catch (error) {\r\n            console.error('[VirtualFS] Failed to load:', error);\r\n        }\r\n    }\r\n\r\n    private scheduleSave(): void {\r\n        if (this.saveTimeout !== null) {\r\n            window.clearTimeout(this.saveTimeout);\r\n        }\r\n\r\n        this.saveTimeout = window.setTimeout(() => {\r\n            this.save();\r\n            this.saveTimeout = null;\r\n        }, this.AUTO_SAVE_DELAY);\r\n    }\r\n\r\n    private save(): void {\r\n        try {\r\n            setJSON(this.STORAGE_KEY, this.root);\r\n            console.log('[VirtualFS] Saved to localStorage');\r\n        } catch (error) {\r\n            console.error('[VirtualFS] Failed to save:', error);\r\n        }\r\n    }\r\n\r\n    public forceSave(): void {\r\n        if (this.saveTimeout !== null) {\r\n            window.clearTimeout(this.saveTimeout);\r\n            this.saveTimeout = null;\r\n        }\r\n        this.save();\r\n    }\r\n\r\n    // ========================================================================\r\n    // Event System\r\n    // ========================================================================\r\n\r\n    public addEventListener(listener: FileSystemListener): void {\r\n        this.listeners.push(listener);\r\n    }\r\n\r\n    public removeEventListener(listener: FileSystemListener): void {\r\n        const index = this.listeners.indexOf(listener);\r\n        if (index !== -1) {\r\n            this.listeners.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    private emit(event: FileSystemEvent): void {\r\n        this.listeners.forEach(listener => {\r\n            try {\r\n                listener(event);\r\n            } catch (error) {\r\n                console.error('[VirtualFS] Listener error:', error);\r\n            }\r\n        });\r\n    }\r\n\r\n    // ========================================================================\r\n    // Path Utilities\r\n    // ========================================================================\r\n\r\n    private parsePath(path: string | string[]): string[] {\r\n        if (Array.isArray(path)) {\r\n            return path;\r\n        }\r\n        return path.split('/').filter(p => p.length > 0);\r\n    }\r\n\r\n    private normalizePath(path: string | string[]): string {\r\n        return this.parsePath(path).join('/');\r\n    }\r\n\r\n    private navigate(path: string | string[]): VirtualFileSystemItem | null {\r\n        const parts = this.parsePath(path);\r\n\r\n        // Empty path = root folder\r\n        if (parts.length === 0) {\r\n            return null; // Root is not an item, it's the container\r\n        }\r\n\r\n        let current: Record<string, VirtualFileSystemItem> = this.root;\r\n        let lastItem: VirtualFileSystemItem | null = null;\r\n\r\n        for (const part of parts) {\r\n            const item = current[part];\r\n            if (!item) {\r\n                return null;\r\n            }\r\n\r\n            lastItem = item;\r\n\r\n            if (item.type === 'folder') {\r\n                current = item.children;\r\n            } else {\r\n                // File - stop navigation\r\n                return item;\r\n            }\r\n        }\r\n\r\n        // Return the last folder we successfully navigated to\r\n        return lastItem;\r\n    }\r\n\r\n    // ========================================================================\r\n    // Read Operations\r\n    // ========================================================================\r\n\r\n    public exists(path: string | string[]): boolean {\r\n        return this.navigate(path) !== null;\r\n    }\r\n\r\n    public get(path: string | string[]): VirtualFileSystemItem | null {\r\n        return this.navigate(path);\r\n    }\r\n\r\n    public getFolder(path: string | string[]): VirtualFolder | null {\r\n        const item = this.navigate(path);\r\n        return item?.type === 'folder' ? item : null;\r\n    }\r\n\r\n    public getFile(path: string | string[]): VirtualFile | null {\r\n        const item = this.navigate(path);\r\n        return item?.type === 'file' ? item : null;\r\n    }\r\n\r\n    public list(path: string | string[] = []): Record<string, VirtualFileSystemItem> {\r\n        const parts = this.parsePath(path);\r\n\r\n        if (parts.length === 0) {\r\n            return this.root;\r\n        }\r\n\r\n        const folder = this.getFolder(path);\r\n        return folder?.children || {};\r\n    }\r\n\r\n    public readFile(path: string | string[]): string | null {\r\n        const file = this.getFile(path);\r\n        return file?.content || null;\r\n    }\r\n\r\n    // ========================================================================\r\n    // Write Operations\r\n    // ========================================================================\r\n\r\n    public createFile(path: string | string[], content: string = '', icon: string = 'üìù'): boolean {\r\n        const parts = this.parsePath(path);\r\n        if (parts.length === 0) {\r\n            return false;\r\n        }\r\n\r\n        const fileName = parts[parts.length - 1]!;\r\n        const parentPath = parts.slice(0, -1);\r\n        const parent = parentPath.length > 0 ? this.getFolder(parentPath) : null;\r\n        const container = parent?.children || this.root;\r\n\r\n        if (container[fileName!]) {\r\n            console.warn('[VirtualFS] File already exists:', this.normalizePath(path));\r\n            return false;\r\n        }\r\n\r\n        const now = new Date().toISOString();\r\n        const file: VirtualFile = {\r\n            type: 'file',\r\n            icon,\r\n            content,\r\n            size: content.length,\r\n            created: now,\r\n            modified: now,\r\n        };\r\n\r\n        container[fileName!] = file;\r\n\r\n        if (parent) {\r\n            parent.modified = now;\r\n        }\r\n\r\n        this.scheduleSave();\r\n        this.emit({ type: 'create', path: this.normalizePath(path), item: file });\r\n        return true;\r\n    }\r\n\r\n    public createFolder(path: string | string[], icon: string = 'üìÅ'): boolean {\r\n        const parts = this.parsePath(path);\r\n        if (parts.length === 0) {\r\n            return false;\r\n        }\r\n\r\n        const folderName = parts[parts.length - 1]!;\r\n        const parentPath = parts.slice(0, -1);\r\n        const parent = parentPath.length > 0 ? this.getFolder(parentPath) : null;\r\n        const container = parent?.children || this.root;\r\n\r\n        if (container[folderName!]) {\r\n            console.warn('[VirtualFS] Folder already exists:', this.normalizePath(path));\r\n            return false;\r\n        }\r\n\r\n        const now = new Date().toISOString();\r\n        const folder: VirtualFolder = {\r\n            type: 'folder',\r\n            icon,\r\n            children: {},\r\n            created: now,\r\n            modified: now,\r\n        };\r\n\r\n        container[folderName!] = folder;\r\n\r\n        if (parent) {\r\n            parent.modified = now;\r\n        }\r\n\r\n        this.scheduleSave();\r\n        this.emit({ type: 'create', path: this.normalizePath(path), item: folder });\r\n        return true;\r\n    }\r\n\r\n    public writeFile(path: string | string[], content: string): boolean {\r\n        const file = this.getFile(path);\r\n        if (!file) {\r\n            console.warn('[VirtualFS] File not found:', this.normalizePath(path));\r\n            return false;\r\n        }\r\n\r\n        file.content = content;\r\n        file.size = content.length;\r\n        file.modified = new Date().toISOString();\r\n\r\n        this.scheduleSave();\r\n        this.emit({ type: 'update', path: this.normalizePath(path), item: file });\r\n        return true;\r\n    }\r\n\r\n    public delete(path: string | string[]): boolean {\r\n        const parts = this.parsePath(path);\r\n        if (parts.length === 0) {\r\n            return false;\r\n        }\r\n\r\n        const itemName = parts[parts.length - 1]!;\r\n        const parentPath = parts.slice(0, -1);\r\n        const parent = parentPath.length > 0 ? this.getFolder(parentPath) : null;\r\n        const container = parent?.children || this.root;\r\n\r\n        if (!container[itemName!]) {\r\n            console.warn('[VirtualFS] Item not found:', this.normalizePath(path));\r\n            return false;\r\n        }\r\n\r\n        const item = container[itemName!];\r\n        delete container[itemName!];\r\n\r\n        if (parent) {\r\n            parent.modified = new Date().toISOString();\r\n        }\r\n\r\n        this.scheduleSave();\r\n        this.emit({ type: 'delete', path: this.normalizePath(path), item });\r\n        return true;\r\n    }\r\n\r\n    public rename(oldPath: string | string[], newName: string): boolean {\r\n        const parts = this.parsePath(oldPath);\r\n        if (parts.length === 0) {\r\n            return false;\r\n        }\r\n\r\n        const oldName = parts[parts.length - 1]!;\r\n        const parentPath = parts.slice(0, -1);\r\n        const parent = parentPath.length > 0 ? this.getFolder(parentPath) : null;\r\n        const container = parent?.children || this.root;\r\n\r\n        if (!container[oldName!]) {\r\n            console.warn('[VirtualFS] Item not found:', this.normalizePath(oldPath));\r\n            return false;\r\n        }\r\n\r\n        if (container[newName]) {\r\n            console.warn('[VirtualFS] Target name already exists:', newName);\r\n            return false;\r\n        }\r\n\r\n        const item = container[oldName!]!; // Checked above\r\n        container[newName] = item;\r\n        delete container[oldName!];\r\n\r\n        if (parent) {\r\n            parent.modified = new Date().toISOString();\r\n        }\r\n\r\n        item.modified = new Date().toISOString();\r\n\r\n        const newPath = [...parentPath, newName].join('/');\r\n        this.scheduleSave();\r\n        this.emit({\r\n            type: 'rename',\r\n            path: newPath,\r\n            oldPath: this.normalizePath(oldPath),\r\n            item,\r\n        });\r\n        return true;\r\n    }\r\n\r\n    // ========================================================================\r\n    // Stats & Utilities\r\n    // ========================================================================\r\n\r\n    public getStats(): FileSystemStats {\r\n        let totalFiles = 0;\r\n        let totalFolders = 0;\r\n        let totalSize = 0;\r\n\r\n        const traverse = (items: Record<string, VirtualFileSystemItem>) => {\r\n            for (const item of Object.values(items)) {\r\n                if (item.type === 'file') {\r\n                    totalFiles++;\r\n                    totalSize += item.size;\r\n                } else if (item.type === 'folder') {\r\n                    totalFolders++;\r\n                    traverse(item.children);\r\n                }\r\n            }\r\n        };\r\n\r\n        traverse(this.root);\r\n\r\n        return { totalFiles, totalFolders, totalSize };\r\n    }\r\n\r\n    public reset(): void {\r\n        this.root = this.createDefaultStructure();\r\n        this.save();\r\n        console.log('[VirtualFS] Reset to defaults');\r\n    }\r\n\r\n    public export(): Record<string, VirtualFolder> {\r\n        return JSON.parse(JSON.stringify(this.root));\r\n    }\r\n\r\n    public import(data: Record<string, VirtualFolder>): boolean {\r\n        try {\r\n            // Basic validation\r\n            if (!data || typeof data !== 'object') {\r\n                return false;\r\n            }\r\n\r\n            this.root = data;\r\n            this.save();\r\n            console.log('[VirtualFS] Imported successfully');\r\n            return true;\r\n        } catch (error) {\r\n            console.error('[VirtualFS] Import failed:', error);\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// Singleton Instance\r\n// ============================================================================\r\n\r\nexport const VirtualFS = new VirtualFileSystemManager();\r\n\r\n// Expose globally for debugging\r\nif (typeof window !== 'undefined') {\r\n    (window as unknown as { VirtualFS: VirtualFileSystemManager }).VirtualFS = VirtualFS;\r\n}\r\n"]}