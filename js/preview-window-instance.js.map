{"version":3,"file":"preview-window-instance.js","sourceRoot":"","sources":["../src/ts/preview-window-instance.ts"],"names":[],"mappings":"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","sourcesContent":["import BaseWindowInstance, { BaseWindowConfig } from './base-window-instance';\n\n// Access global WindowChrome helper (no module export)\ntype WindowWithChrome = { WindowChrome?: {\n    createTitlebar: (cfg: {\n        title?: string; icon?: string; showClose?: boolean; showMinimize?: boolean; showMaximize?: boolean;\n        onClose?: () => void; onMinimize?: () => void; onMaximize?: () => void;\n    }) => HTMLElement;\n    createToolbar: (items: Array<{ type?: 'separator'; label?: string; icon?: string; title?: string; action?: string; onClick?: (e: MouseEvent) => void }>) => HTMLElement;\n    createStatusBar: (cfg: { leftContent?: string; rightContent?: string }) => HTMLElement;\n} };\nconst WindowChrome = (window as unknown as WindowWithChrome).WindowChrome!;\n\nexport interface PreviewWindowState {\n    imageUrl?: string;\n    repo?: string;\n    path?: string;\n    dimensions?: string;\n    size?: number;\n    zoom?: number;\n    images?: string[];\n    currentIndex?: number;\n}\n\nexport class PreviewWindowInstance extends BaseWindowInstance {\n    private keydownListener?: (e: KeyboardEvent) => void;\n\n    constructor(config: BaseWindowConfig) {\n        super(config);\n        // Base ctor initializes state; extend with preview defaults\n        this.updateState({\n            zoom: 1,\n            images: [],\n            currentIndex: 0,\n        });\n    }\n\n    render(): void {\n        if (!this.container) return;\n        this.container.innerHTML = '';\n        const titlebar = WindowChrome.createTitlebar({\n            title: this.title,\n            icon: './img/preview.png',\n            showClose: true,\n            showMinimize: true,\n            showMaximize: false,\n            onClose: () => this.destroy(),\n        });\n        this.container.appendChild(titlebar);\n\n        // Toolbar\n        const toolbar = WindowChrome.createToolbar([\n            { label: 'Zoom In', icon: '🔍+', onClick: () => this.zoomIn() },\n            { label: 'Zoom Out', icon: '🔍-', onClick: () => this.zoomOut() },\n            { type: 'separator' },\n            { label: 'Previous', icon: '⬅️', onClick: () => this.prevImage() },\n            { label: 'Next', icon: '➡️', onClick: () => this.nextImage() },\n        ]);\n        this.container.appendChild(toolbar);\n\n        // Image area\n        const imageArea = document.createElement('div');\n        imageArea.className = 'preview-image-area flex justify-center items-center';\n        imageArea.style.height = 'calc(100% - 80px)';\n        imageArea.style.position = 'relative';\n        imageArea.ondrop = (e) => this.handleDrop(e);\n        imageArea.ondragover = (e) => e.preventDefault();\n\n        const st = this.getState() as unknown as PreviewWindowState;\n        const images = st.images || [];\n        const idx = st.currentIndex ?? 0;\n        if (images.length > 0 && images[idx]) {\n            const img = document.createElement('img');\n            img.src = images[idx];\n            img.style.maxWidth = '100%';\n            img.style.maxHeight = '100%';\n            img.style.transform = `scale(${st.zoom ?? 1})`;\n            img.draggable = true;\n            img.addEventListener('contextmenu', (e) => this.showContextMenu(e));\n            imageArea.appendChild(img);\n        } else {\n            // Placeholder UI\n            const placeholder = document.createElement('div');\n            placeholder.className = 'text-gray-500 dark:text-gray-400 text-center px-6';\n            placeholder.textContent = 'No image selected';\n            imageArea.appendChild(placeholder);\n        }\n        this.container.appendChild(imageArea);\n\n        // Statusbar\n        const counter = images.length > 0 ? `${idx + 1} / ${images.length}` : '';\n        const statusBar = WindowChrome.createStatusBar({\n            leftContent: st.path || '',\n            rightContent: `Zoom: ${Math.round((st.zoom || 1) * 100)}% ${counter}`,\n        });\n        this.container.appendChild(statusBar);\n\n        // Keyboard shortcuts\n        this.attachKeyboardShortcuts();\n    }\n\n    attachKeyboardShortcuts() {\n        // Remove previous listener to avoid duplicates\n        if (this.keydownListener) {\n            document.removeEventListener('keydown', this.keydownListener);\n        }\n        this.keydownListener = (e: KeyboardEvent) => {\n            if (!this.isVisible) return;\n            if (e.key === 'ArrowLeft') {\n                e.preventDefault();\n                this.prevImage();\n            } else if (e.key === 'ArrowRight') {\n                e.preventDefault();\n                this.nextImage();\n            }\n        };\n        document.addEventListener('keydown', this.keydownListener);\n    }\n\n    zoomIn() {\n        const st = this.getState() as unknown as PreviewWindowState;\n        this.updateState({ zoom: Math.min((st.zoom || 1) + 0.1, 3) });\n        this.render();\n    }\n    zoomOut() {\n        const st = this.getState() as unknown as PreviewWindowState;\n        this.updateState({ zoom: Math.max((st.zoom || 1) - 0.1, 0.2) });\n        this.render();\n    }\n    nextImage() {\n        const st = this.getState() as unknown as PreviewWindowState;\n        const images = st.images || [];\n        if (images.length === 0) return;\n        const next = ((st.currentIndex ?? 0) + 1) % images.length;\n        this.updateState({ currentIndex: next });\n        this.render();\n    }\n    prevImage() {\n        const st = this.getState() as unknown as PreviewWindowState;\n        const images = st.images || [];\n        if (images.length === 0) return;\n        const prev = ((st.currentIndex ?? 0) - 1 + images.length) % images.length;\n        this.updateState({ currentIndex: prev });\n        this.render();\n    }\n    handleDrop(e: DragEvent) {\n        e.preventDefault();\n        const files = e.dataTransfer?.files;\n        if (files && files.length > 0 && files[0]) {\n            const url = URL.createObjectURL(files[0]);\n            this.updateState({ images: [url], currentIndex: 0 });\n            this.render();\n        }\n    }\n    showContextMenu(e: MouseEvent) {\n        e.preventDefault();\n        // TODO: Implement custom context menu (copy, save, open in new tab)\n    }\n    destroy() {\n        // Clean up keyboard listener before base destroy\n        if (this.keydownListener) {\n            document.removeEventListener('keydown', this.keydownListener);\n        }\n        super.destroy();\n    }\n}\n\n// Attach to window (avoid any)\ntype WindowWithPreview = { PreviewWindowInstance?: typeof PreviewWindowInstance };\n(window as unknown as WindowWithPreview).PreviewWindowInstance = PreviewWindowInstance;\nexport default PreviewWindowInstance;\n"]}