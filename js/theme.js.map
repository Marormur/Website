{"version":3,"file":"theme.js","sourceRoot":"","sources":["../src/ts/theme.ts"],"names":[],"mappings":"AAAA;;;GAGG;AAEH,CAAC,GAAG,EAAE;IACJ,YAAY,CAAC;IAIb,4CAA4C;IAC5C,MAAM,GAAG,GAAG,MAA4C,CAAC;IACzD,MAAM,aAAa,GAAI,GAAG,CAAC,aAAyC,IAAI,EAAE,CAAC;IAE3E,MAAM,SAAS,GACZ,aAAa,CAAC,oBAA+B,IAAI,iBAAiB,CAAC;IAEtE,MAAM,qBAAqB,GAAgB,CAAC,QAAQ,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;IAEvE,MAAM,eAAe,GAAG,MAAM,CAAC,UAAU,CAAC,8BAA8B,CAAC,CAAC;IAE1E,IAAI,eAAe,GAAc,CAAC,GAAG,EAAE;QACrC,MAAM,WAAW,GAAG,YAAY,CAAC,OAAO,CAAC,SAAS,CAAqB,CAAC;QACxE,OAAO,CAAC,WAAW,IAAI,qBAAqB,CAAC,QAAQ,CAAC,WAAW,CAAC;YAChE,CAAC,CAAC,WAAW;YACb,CAAC,CAAC,QAAQ,CAAc,CAAC;IAC7B,CAAC,CAAC,EAAE,CAAC;IAEL,SAAS,yBAAyB;QAChC,MAAM,OAAO,GACX,eAAe,KAAK,MAAM;YAC1B,CAAC,eAAe,KAAK,QAAQ,IAAI,eAAe,CAAC,OAAO,CAAC,CAAC;QAC5D,QAAQ,CAAC,eAAe,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;IAC7D,CAAC;IAED,SAAS,kBAAkB,CAAC,IAAe;QACzC,IAAI,CAAC,qBAAqB,CAAC,QAAQ,CAAC,IAAI,CAAC;YAAE,OAAO;QAClD,eAAe,GAAG,IAAI,CAAC;QACvB,YAAY,CAAC,OAAO,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QACtC,yBAAyB,EAAE,CAAC;QAE5B,uBAAuB;QACvB,MAAM,CAAC,aAAa,CAClB,IAAI,WAAW,CAAC,uBAAuB,EAAE;YACvC,MAAM,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE;SAC7B,CAAC,CACH,CAAC;IACJ,CAAC;IAED,SAAS,kBAAkB;QACzB,OAAO,eAAe,CAAC;IACzB,CAAC;IAED,aAAa;IACb,yBAAyB,EAAE,CAAC;IAE5B,MAAM,uBAAuB,GAAG,GAAG,EAAE;QACnC,yBAAyB,EAAE,CAAC;IAC9B,CAAC,CAAC;IAMF,MAAM,GAAG,GAAG,eAA4B,CAAC;IACzC,IAAI,OAAO,GAAG,CAAC,gBAAgB,KAAK,UAAU,EAAE,CAAC;QAC/C,GAAG,CAAC,gBAAgB,CAAC,QAAQ,EAAE,uBAAwC,CAAC,CAAC;IAC3E,CAAC;SAAM,IAAI,OAAO,GAAG,CAAC,WAAW,KAAK,UAAU,EAAE,CAAC;QACjD,GAAG,CAAC,WAAW,CAAC,uBAAkF,CAAC,CAAC;IACtG,CAAC;IAED,gBAAgB;IAChB,MAAM,CAAC,GAAG,MAA4C,CAAC;IACvD,CAAC,CAAC,aAAa,CAAC,GAAG;QACjB,kBAAkB;QAClB,kBAAkB;QAClB,yBAAyB;KAC1B,CAAC;IAEF,kBAAkB;IAClB,CAAC,CAAC,oBAAoB,CAAC,GAAG,kBAAkB,CAAC;IAC7C,CAAC,CAAC,oBAAoB,CAAC,GAAG,kBAAkB,CAAC;AAC/C,CAAC,CAAC,EAAE,CAAC","sourcesContent":["/**\r\n * src/ts/theme.ts\r\n * Theme management (dark/light/system) with safe typing and legacy compatibility.\r\n */\r\n\r\n(() => {\r\n  'use strict';\r\n\r\n  type ThemePref = 'system' | 'light' | 'dark';\r\n\r\n  // Constants from global config if available\r\n  const win = window as unknown as Record<string, unknown>;\r\n  const APP_CONSTANTS = (win.APP_CONSTANTS as Record<string, unknown>) || {};\r\n\r\n  const THEME_KEY =\r\n    (APP_CONSTANTS.THEME_PREFERENCE_KEY as string) || 'themePreference';\r\n\r\n  const validThemePreferences: ThemePref[] = ['system', 'light', 'dark'];\r\n\r\n  const systemDarkQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n\r\n  let themePreference: ThemePref = (() => {\r\n    const fromStorage = localStorage.getItem(THEME_KEY) as ThemePref | null;\r\n    return (fromStorage && validThemePreferences.includes(fromStorage)\r\n      ? fromStorage\r\n      : 'system') as ThemePref;\r\n  })();\r\n\r\n  function updateThemeFromPreference(): void {\r\n    const useDark =\r\n      themePreference === 'dark' ||\r\n      (themePreference === 'system' && systemDarkQuery.matches);\r\n    document.documentElement.classList.toggle('dark', useDark);\r\n  }\r\n\r\n  function setThemePreference(pref: ThemePref): void {\r\n    if (!validThemePreferences.includes(pref)) return;\r\n    themePreference = pref;\r\n    localStorage.setItem(THEME_KEY, pref);\r\n    updateThemeFromPreference();\r\n\r\n    // Notify other modules\r\n    window.dispatchEvent(\r\n      new CustomEvent('themePreferenceChange', {\r\n        detail: { preference: pref },\r\n      })\r\n    );\r\n  }\r\n\r\n  function getThemePreference(): ThemePref {\r\n    return themePreference;\r\n  }\r\n\r\n  // Initialize\r\n  updateThemeFromPreference();\r\n\r\n  const handleSystemThemeChange = () => {\r\n    updateThemeFromPreference();\r\n  };\r\n\r\n  type MQLLegacy = MediaQueryList & {\r\n    addListener?: (listener: (this: MediaQueryList, ev: MediaQueryListEvent) => void) => void;\r\n    removeListener?: (listener: (this: MediaQueryList, ev: MediaQueryListEvent) => void) => void;\r\n  };\r\n  const mql = systemDarkQuery as MQLLegacy;\r\n  if (typeof mql.addEventListener === 'function') {\r\n    mql.addEventListener('change', handleSystemThemeChange as EventListener);\r\n  } else if (typeof mql.addListener === 'function') {\r\n    mql.addListener(handleSystemThemeChange as (this: MediaQueryList, ev: MediaQueryListEvent) => void);\r\n  }\r\n\r\n  // Global export\r\n  const w = window as unknown as Record<string, unknown>;\r\n  w['ThemeSystem'] = {\r\n    setThemePreference,\r\n    getThemePreference,\r\n    updateThemeFromPreference,\r\n  };\r\n\r\n  // Legacy wrappers\r\n  w['setThemePreference'] = setThemePreference;\r\n  w['getThemePreference'] = getThemePreference;\r\n})();\r\n"]}