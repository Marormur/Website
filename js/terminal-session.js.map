{"version":3,"file":"terminal-session.js","sourceRoot":"","sources":["../src/ts/terminal-session.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * src/ts/terminal-session.ts\r\n * Terminal session as a tab within a terminal window\r\n *\r\n * Uses the shared VirtualFS for file system operations.\r\n */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport { BaseTab, type TabConfig } from './base-tab.js';\r\nimport { VirtualFS } from './virtual-fs.js';\r\n\r\n/**\r\n * TerminalSession - Individual terminal session tab\r\n *\r\n * Features:\r\n * - Command execution with VirtualFS integration\r\n * - Shared file system with Finder\r\n * - Command history\r\n * - Path resolution and navigation\r\n */\r\nexport class TerminalSession extends BaseTab {\r\n    outputElement: HTMLElement | null;\r\n    inputElement: HTMLInputElement | null;\r\n    commandHistory: string[];\r\n    historyIndex: number;\r\n    vfsCwd: string;\r\n\r\n    constructor(config?: Partial<TabConfig>) {\r\n        super({\r\n            type: 'terminal-session',\r\n            title: config?.title || 'Terminal',\r\n            ...config,\r\n        });\r\n\r\n        this.outputElement = null;\r\n        this.inputElement = null;\r\n        this.commandHistory = [];\r\n        this.historyIndex = -1;\r\n        this.vfsCwd = '/home/marvin';\r\n    }\r\n\r\n    /**\r\n     * Create terminal DOM\r\n     */\r\n    createDOM(): HTMLElement {\r\n        const container = document.createElement('div');\r\n        container.id = `${this.id}-container`;\r\n        container.className = 'tab-content hidden w-full h-full';\r\n\r\n        const html = `\r\n            <div class=\"terminal-wrapper h-full flex flex-col bg-gray-900 text-green-400 font-mono text-sm\">\r\n                <div class=\"terminal-output flex-1 overflow-y-auto p-4 space-y-1\" data-terminal-output>\r\n                </div>\r\n                <div class=\"terminal-input-line flex items-center px-4 py-2 border-t border-gray-700\">\r\n                    <span class=\"terminal-prompt text-blue-400\">guest@marvin:${this.vfsCwd}$</span>\r\n                    <input\r\n                        type=\"text\"\r\n                        class=\"flex-1 ml-2 bg-transparent outline-none text-green-400 terminal-input\"\r\n                        autocomplete=\"off\"\r\n                        spellcheck=\"false\"\r\n                        aria-label=\"Terminal input\"\r\n                        data-terminal-input\r\n                    />\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        container.innerHTML = html;\r\n        this.element = container;\r\n\r\n        this.outputElement = container.querySelector('[data-terminal-output]');\r\n        this.inputElement = container.querySelector('[data-terminal-input]');\r\n\r\n        this._attachEventListeners();\r\n        this.showWelcomeMessage();\r\n\r\n        return container;\r\n    }\r\n\r\n    private _attachEventListeners(): void {\r\n        if (!this.inputElement) return;\r\n\r\n        this.inputElement.addEventListener('keydown', (e: KeyboardEvent) => {\r\n            if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                const command = this.inputElement!.value.trim();\r\n                if (command) {\r\n                    this.executeCommand(command);\r\n                    this.commandHistory.push(command);\r\n                    this.historyIndex = this.commandHistory.length;\r\n                    this.updateContentState({ commandHistory: this.commandHistory });\r\n                }\r\n                this.inputElement!.value = '';\r\n                this.inputElement!.focus();\r\n            } else if (e.key === 'ArrowUp') {\r\n                e.preventDefault();\r\n                if (this.historyIndex > 0) {\r\n                    this.historyIndex--;\r\n                    const historyEntry = this.commandHistory[this.historyIndex];\r\n                    if (historyEntry !== undefined) {\r\n                        this.inputElement!.value = historyEntry;\r\n                    }\r\n                }\r\n            } else if (e.key === 'ArrowDown') {\r\n                e.preventDefault();\r\n                if (this.historyIndex < this.commandHistory.length - 1) {\r\n                    this.historyIndex++;\r\n                    const historyEntry = this.commandHistory[this.historyIndex];\r\n                    if (historyEntry !== undefined) {\r\n                        this.inputElement!.value = historyEntry;\r\n                    }\r\n                } else {\r\n                    this.historyIndex = this.commandHistory.length;\r\n                    this.inputElement!.value = '';\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    showWelcomeMessage(): void {\r\n        this.addOutput('Willkommen im Terminal! Gib \"help\" ein f√ºr verf√ºgbare Befehle.', 'info');\r\n    }\r\n\r\n    executeCommand(command: string): void {\r\n        this.addOutput(`guest@marvin:${this.vfsCwd}$ ${command}`, 'command');\r\n        const [cmd, ...args] = command.split(' ');\r\n\r\n        if (cmd === undefined) return;\r\n\r\n        const commands: Record<string, () => void> = {\r\n            help: () => this.showHelp(),\r\n            clear: () => this.clearOutput(),\r\n            ls: () => this.listDirectory(args[0]),\r\n            pwd: () => this.printWorkingDirectory(),\r\n            cd: () => this.changeDirectory(args[0]),\r\n            cat: () => this.catFile(args[0]),\r\n            touch: () => this.touch(args[0]),\r\n            mkdir: () => this.mkdir(args[0]),\r\n            rm: () => this.rm(args[0]),\r\n            echo: () => this.echo(args.join(' ')),\r\n            date: () => this.showDate(),\r\n            whoami: () => this.addOutput('guest', 'output'),\r\n        };\r\n\r\n        const commandFn = commands[cmd];\r\n        if (commandFn !== undefined) {\r\n            commandFn();\r\n        } else {\r\n            this.addOutput(\r\n                `Befehl nicht gefunden: ${cmd}. Gib \"help\" ein f√ºr verf√ºgbare Befehle.`,\r\n                'error'\r\n            );\r\n        }\r\n    }\r\n\r\n    addOutput(text: string, type: 'command' | 'output' | 'error' | 'info' = 'output'): void {\r\n        if (!this.outputElement) return;\r\n        const line = document.createElement('div');\r\n        line.className = `terminal-line terminal-${type}`;\r\n        const colorMap: Record<string, string> = {\r\n            command: 'text-blue-400',\r\n            output: 'text-green-400',\r\n            error: 'text-red-400',\r\n            info: 'text-yellow-400',\r\n        };\r\n        line.className += ` ${colorMap[type] || 'text-green-400'}`;\r\n        line.textContent = text;\r\n        this.outputElement.appendChild(line);\r\n        this.outputElement.scrollTop = this.outputElement.scrollHeight;\r\n    }\r\n\r\n    clearOutput(): void {\r\n        if (this.outputElement) this.outputElement.innerHTML = '';\r\n    }\r\n\r\n    showHelp(): void {\r\n        const helpText = [\r\n            'Verf√ºgbare Befehle:',\r\n            '  help     - Zeige diese Hilfe',\r\n            '  clear    - L√∂sche Ausgabe',\r\n            '  ls       - Liste Dateien',\r\n            '  pwd      - Zeige aktuelles Verzeichnis',\r\n            '  cd <dir> - Wechsle Verzeichnis',\r\n            '  cat <f>  - Zeige Dateiinhalt',\r\n            '  touch <f> - Erstelle leere Datei',\r\n            '  mkdir <d> - Erstelle Verzeichnis',\r\n            '  rm <p>    - L√∂sche Datei/Verzeichnis',\r\n            '  echo <t> - Gebe Text aus',\r\n            '  date     - Zeige Datum/Zeit',\r\n            '  whoami   - Zeige Benutzername',\r\n        ];\r\n        helpText.forEach(l => this.addOutput(l, 'info'));\r\n    }\r\n\r\n    listDirectory(path?: string): void {\r\n        const target = this.vfsResolve(path);\r\n        const item = VirtualFS.get(target);\r\n        if (!item) {\r\n            this.addOutput(`Verzeichnis/Datei nicht gefunden: ${path || target}`, 'error');\r\n            return;\r\n        }\r\n        if (item.type === 'file') {\r\n            this.addOutput('üìÑ ' + target.split('/').pop(), 'output');\r\n            return;\r\n        }\r\n        const entries = VirtualFS.list(target);\r\n        const names = Object.keys(entries);\r\n        if (names.length === 0) {\r\n            this.addOutput('(leer)', 'output');\r\n            return;\r\n        }\r\n        names.forEach(name => {\r\n            const child = entries[name];\r\n            if (child) {\r\n                const prefix = child.type === 'folder' ? 'üìÅ ' : 'üìÑ ';\r\n                this.addOutput(prefix + name, 'output');\r\n            }\r\n        });\r\n    }\r\n\r\n    printWorkingDirectory(): void {\r\n        this.addOutput(this.vfsCwd, 'output');\r\n    }\r\n\r\n    changeDirectory(path?: string): void {\r\n        const target = this.vfsResolve(path || '/home/marvin');\r\n        const folder = VirtualFS.getFolder(target);\r\n        if (!folder) {\r\n            this.addOutput(`Verzeichnis nicht gefunden: ${path || target}`, 'error');\r\n            return;\r\n        }\r\n        this.vfsCwd = target;\r\n        this.updatePrompt();\r\n        this.updateContentState({ currentPath: this.vfsCwd });\r\n    }\r\n\r\n    catFile(filename?: string): void {\r\n        if (!filename) {\r\n            this.addOutput('Dateiname fehlt', 'error');\r\n            return;\r\n        }\r\n        const target = this.vfsResolve(filename);\r\n        const file = VirtualFS.getFile(target);\r\n        if (!file) this.addOutput(`Datei nicht gefunden: ${filename}`, 'error');\r\n        else this.addOutput(file.content, 'output');\r\n    }\r\n\r\n    echo(text: string): void {\r\n        this.addOutput(text, 'output');\r\n    }\r\n\r\n    showDate(): void {\r\n        this.addOutput(new Date().toString(), 'output');\r\n    }\r\n\r\n    updatePrompt(): void {\r\n        const prompt = this.element?.querySelector('.terminal-prompt') as HTMLElement | null;\r\n        if (prompt) {\r\n            prompt.textContent = `guest@marvin:${this.vfsCwd}$`;\r\n        }\r\n    }\r\n\r\n    // ---------------------------\r\n    // VirtualFS helpers & cmds\r\n    // ---------------------------\r\n    private vfsResolve(path?: string): string {\r\n        // Default to current folder\r\n        if (!path || path.trim() === '' || path === '.') return this.vfsCwd;\r\n\r\n        // Handle tilde expansion for home directory\r\n        let raw = path.trim();\r\n        if (raw === '~') return '/home/marvin';\r\n        if (raw.startsWith('~/')) raw = '/home/marvin/' + raw.slice(2);\r\n\r\n        // Absolute path starts with /\r\n        if (raw.startsWith('/')) {\r\n            // Resolve '.' and '..'\r\n            const parts = raw.split('/').filter(Boolean);\r\n            const resolved: string[] = [];\r\n            for (const p of parts) {\r\n                if (p === '.') continue;\r\n                if (p === '..') {\r\n                    if (resolved.length > 0) resolved.pop();\r\n                } else {\r\n                    resolved.push(p);\r\n                }\r\n            }\r\n            return '/' + resolved.join('/');\r\n        }\r\n\r\n        // Relative path: append to current directory\r\n        const base = this.vfsCwd.split('/').filter(Boolean);\r\n        const parts = raw.split('/').filter(Boolean);\r\n        const combined = [...base, ...parts];\r\n\r\n        // Resolve '.' and '..'\r\n        const resolved: string[] = [];\r\n        for (const p of combined) {\r\n            if (p === '.') continue;\r\n            if (p === '..') {\r\n                if (resolved.length > 0) resolved.pop();\r\n            } else {\r\n                resolved.push(p);\r\n            }\r\n        }\r\n        return '/' + resolved.join('/');\r\n    }\r\n\r\n    touch(path?: string): void {\r\n        if (!path) {\r\n            this.addOutput('Pfad/Dateiname fehlt', 'error');\r\n            return;\r\n        }\r\n        const target = this.vfsResolve(path);\r\n        const existing = VirtualFS.get(target);\r\n        if (existing) {\r\n            if (existing.type === 'file') {\r\n                this.addOutput(`Datei existiert bereits: ${target}`, 'error');\r\n            } else {\r\n                this.addOutput(`Pfad ist ein Verzeichnis: ${target}`, 'error');\r\n            }\r\n            return;\r\n        }\r\n        // Ensure parent exists\r\n        const parts = target.split('/');\r\n        const name = parts.pop() as string;\r\n        const parentPath = parts.join('/');\r\n        const parent = VirtualFS.getFolder(parentPath);\r\n        if (!parent) {\r\n            this.addOutput(`√úbergeordnetes Verzeichnis nicht gefunden: ${parentPath}`, 'error');\r\n            return;\r\n        }\r\n        const ok = VirtualFS.createFile([...parts, name].join('/'), '');\r\n        if (!ok) this.addOutput(`Konnte Datei nicht erstellen: ${target}`, 'error');\r\n    }\r\n\r\n    mkdir(path?: string): void {\r\n        if (!path) {\r\n            this.addOutput('Verzeichnisname fehlt', 'error');\r\n            return;\r\n        }\r\n        const target = this.vfsResolve(path);\r\n        const parts = target.split('/');\r\n        const name = parts.pop() as string;\r\n        const parentPath = parts.join('/');\r\n        const parent = VirtualFS.getFolder(parentPath);\r\n        if (!parent) {\r\n            this.addOutput(`√úbergeordnetes Verzeichnis nicht gefunden: ${parentPath}`, 'error');\r\n            return;\r\n        }\r\n        const ok = VirtualFS.createFolder([...parts, name].join('/'));\r\n        if (!ok) this.addOutput(`Konnte Verzeichnis nicht erstellen: ${target}`, 'error');\r\n    }\r\n\r\n    rm(path?: string): void {\r\n        if (!path) {\r\n            this.addOutput('Pfad fehlt', 'error');\r\n            return;\r\n        }\r\n        const target = this.vfsResolve(path);\r\n        if (!VirtualFS.get(target)) {\r\n            this.addOutput(`Nicht gefunden: ${target}`, 'error');\r\n            return;\r\n        }\r\n        const ok = VirtualFS.delete(target);\r\n        if (!ok) this.addOutput(`Konnte nicht l√∂schen: ${target}`, 'error');\r\n    }\r\n\r\n    /**\r\n     * Serialize session state\r\n     */\r\n    serialize(): any {\r\n        return {\r\n            ...super.serialize(),\r\n            currentPath: this.vfsCwd,\r\n            commandHistory: this.commandHistory,\r\n            vfsCwd: this.vfsCwd,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Restore session from state\r\n     */\r\n    static deserialize(state: any): TerminalSession {\r\n        const session = new TerminalSession({\r\n            id: state.id,\r\n            title: state.title,\r\n        });\r\n\r\n        // Map legacy currentPath to vfsCwd\r\n        if (state.currentPath) {\r\n            // Map old 'Computer' paths to new '/' structure\r\n            if (state.currentPath === 'Computer' || state.currentPath === '~') {\r\n                session.vfsCwd = '/home/marvin';\r\n            } else if (state.currentPath.startsWith('Computer/')) {\r\n                // Map Computer/Home -> /home/marvin, Computer/Documents -> /home/marvin/Documents\r\n                const subPath = state.currentPath.slice(9); // Remove 'Computer/'\r\n                if (subPath === 'Home' || subPath.startsWith('Home/')) {\r\n                    const rest = subPath === 'Home' ? '' : subPath.slice(5);\r\n                    session.vfsCwd = rest ? `/home/marvin/${rest}` : '/home/marvin';\r\n                } else {\r\n                    session.vfsCwd = `/home/marvin/${subPath}`;\r\n                }\r\n            } else if (state.currentPath.startsWith('~/')) {\r\n                session.vfsCwd = '/home/marvin/' + state.currentPath.slice(2);\r\n            } else {\r\n                session.vfsCwd = state.currentPath;\r\n            }\r\n        }\r\n        // New vfsCwd property takes precedence\r\n        if (state.vfsCwd) {\r\n            // Migrate old Computer paths to new structure\r\n            if (state.vfsCwd === 'Computer') {\r\n                session.vfsCwd = '/home/marvin';\r\n            } else if (state.vfsCwd.startsWith('Computer/')) {\r\n                const subPath = state.vfsCwd.slice(9);\r\n                if (subPath === 'Home' || subPath.startsWith('Home/')) {\r\n                    const rest = subPath === 'Home' ? '' : subPath.slice(5);\r\n                    session.vfsCwd = rest ? `/home/marvin/${rest}` : '/home/marvin';\r\n                } else {\r\n                    session.vfsCwd = `/home/marvin/${subPath}`;\r\n                }\r\n            } else {\r\n                session.vfsCwd = state.vfsCwd;\r\n            }\r\n        }\r\n        if (state.commandHistory) {\r\n            session.commandHistory = state.commandHistory;\r\n            session.historyIndex = session.commandHistory.length;\r\n        }\r\n\r\n        return session;\r\n    }\r\n\r\n    /**\r\n     * Focus terminal input when tab is shown\r\n     */\r\n    protected onShow(): void {\r\n        if (this.inputElement && typeof this.inputElement.focus === 'function') {\r\n            this.inputElement.focus();\r\n        }\r\n    }\r\n}\r\n\r\n// Export to window\r\n(window as any).TerminalSession = TerminalSession;\r\n"]}