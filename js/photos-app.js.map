{"version":3,"file":"photos-app.js","sourceRoot":"","sources":["../src/ts/photos-app.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Fotos-App ΓÇô inspiriert von der macOS Fotos Anwendung.\n * L├ñdt Bilder aus der Picsum API, gruppiert sie in verschiedene Ansichten\n * und stellt einen Detail-Viewer inklusive Favoritenverwaltung bereit.\n */\n\n type Orientation = 'landscape' | 'portrait' | 'square';\n type SidebarFilter = 'all' | 'favorites' | Orientation;\n type SegmentView = 'moments' | 'collections' | 'years';\n\n interface PicsumApiPhoto {\n     id: string;\n     author: string;\n     width: number;\n     height: number;\n     url: string;\n     download_url: string;\n }\n\n interface PhotoLibraryItem {\n     id: string;\n     author: string;\n     width: number;\n     height: number;\n     orientation: Orientation;\n     year: number;\n     url: string;\n     downloadUrl: string;\n     thumbUrl: string;\n     largeUrl: string;\n }\n\n interface ExternalPhotoItem {\n     id: string;\n     author: string;\n     downloadUrl: string;\n     largeUrl: string;\n     url?: string;\n     width?: number;\n     height?: number;\n     orientation?: Orientation;\n     sourceName?: string;\n     isExternal: true;\n }\n\n type AnyPhotoItem = PhotoLibraryItem | ExternalPhotoItem;\n\ninterface PhotosElements {\n    container: HTMLElement | null;\n    sidebar: HTMLElement | null;\n    gallery: HTMLElement | null;\n    loading: HTMLElement | null;\n    error: HTMLElement | null;\n    errorRetry: HTMLButtonElement | null;\n    empty: HTMLElement | null;\n    placeholder: HTMLElement | null;\n    photoCount: HTMLElement | null;\n    refreshButton: HTMLButtonElement | null;\n    searchInput: HTMLInputElement | null;\n    searchClear: HTMLButtonElement | null;\n    sidebarButtons: HTMLButtonElement[];\n    segmentButtons: HTMLButtonElement[];\n    overlay: HTMLElement | null;\n    detailTitle: HTMLElement | null;\n    detailMeta: HTMLElement | null;\n    detailDimensions: HTMLElement | null;\n    detailCounter: HTMLElement | null;\n    detailOpen: HTMLAnchorElement | null;\n    detailDownload: HTMLAnchorElement | null;\n    detailFavorite: HTMLButtonElement | null;\n    detailFavoriteLabel: HTMLElement | null;\n    detailFavoriteIcon: HTMLElement | null;\n    detailClose: HTMLButtonElement | null;\n    detailPrev: HTMLButtonElement | null;\n    detailNext: HTMLButtonElement | null;\n    image: HTMLImageElement | null;\n    imageInfo: HTMLElement | null;\n    loader: HTMLElement | null;\n    countAll: HTMLElement | null;\n    countFavorites: HTMLElement | null;\n    countLandscape: HTMLElement | null;\n    countPortrait: HTMLElement | null;\n    countSquare: HTMLElement | null;\n    titlebar: HTMLElement | null;\n    statusbar: HTMLElement | null;\n} interface PhotosState {\n     initialized: boolean;\n     photos: PhotoLibraryItem[];\n     filteredPhotos: PhotoLibraryItem[];\n     filteredIndexMap: Map<string, number>;\n     favorites: Set<string>;\n     activeFilter: SidebarFilter;\n     activeSegment: SegmentView;\n     searchTerm: string;\n     isLoading: boolean;\n     currentPage: number;\n     overlayVisible: boolean;\n     selectedIndex: number;\n     activePhotoId: string | null;\n     externalPhoto: ExternalPhotoItem | null;\n     pendingImageId: string | null;\n     orientationCounts: Record<Orientation, number>;\n }\n\n interface PhotosAppApi {\n     init: () => void;\n     showExternalImage: (payload: { src: string; name?: string }) => void;\n }\n\ninterface PhotoGroup {\n    title: string;\n    photos: PhotoLibraryItem[];\n}\n\ntype TranslateFn = (key: string, params?: Record<string, unknown>, options?: { fallback?: string }) => string;\n\nconst globalWindow = window as typeof window & {\n    appI18n?: {\n        translate?: TranslateFn;\n        applyTranslations?: (root?: Element | Document) => void;\n    };\n    PhotosApp?: PhotosAppApi;\n    WindowChrome?: {\n        createWindowFrame: (config: unknown) => {\n            frame: HTMLElement;\n            titlebar: HTMLElement;\n            content: HTMLElement;\n            statusbar: HTMLElement | null;\n        };\n        updateStatusBar: (statusbar: HTMLElement, side: 'left' | 'right', content: string) => void;\n    };\n    API?: {\n        window?: {\n            close?: (windowId: string) => void;\n        };\n    };\n};\n\nfunction t(key: string, fallback: string, params?: Record<string, unknown>): string {\n    const translate = globalWindow.appI18n?.translate;\n    if (typeof translate === 'function') {\n        return translate(key, params, { fallback });\n    }\n    return fallback;\n}\n\n(function photosAppFactory() {\n    const state: PhotosState = {\n        initialized: false,\n        photos: [],\n        filteredPhotos: [],\n         filteredIndexMap: new Map(),\n         favorites: new Set(),\n         activeFilter: 'all',\n         activeSegment: 'moments',\n         searchTerm: '',\n         isLoading: false,\n         currentPage: 1,\n         overlayVisible: false,\n         selectedIndex: -1,\n         activePhotoId: null,\n         externalPhoto: null,\n         pendingImageId: null,\n         orientationCounts: { landscape: 0, portrait: 0, square: 0 },\n     };\n\n    const elements: PhotosElements = {\n        container: null,\n        sidebar: null,\n        gallery: null,\n        loading: null,\n        error: null,\n        errorRetry: null,\n        empty: null,\n        placeholder: null,\n        photoCount: null,\n        refreshButton: null,\n        searchInput: null,\n        searchClear: null,\n        sidebarButtons: [],\n        segmentButtons: [],\n        overlay: null,\n        detailTitle: null,\n        detailMeta: null,\n        detailDimensions: null,\n        detailCounter: null,\n        detailOpen: null,\n        detailDownload: null,\n        detailFavorite: null,\n        detailFavoriteLabel: null,\n        detailFavoriteIcon: null,\n        detailClose: null,\n        detailPrev: null,\n        detailNext: null,\n        image: null,\n        imageInfo: null,\n        loader: null,\n        countAll: null,\n        countFavorites: null,\n        countLandscape: null,\n        countPortrait: null,\n        countSquare: null,\n        titlebar: null,\n        statusbar: null,\n    };    function isExternalPhoto(photo: AnyPhotoItem): photo is ExternalPhotoItem {\n        return (photo as ExternalPhotoItem).isExternal === true;\n    }\n\n    function renderWindow(): HTMLElement | null {\n        const WindowChrome = globalWindow.WindowChrome;\n        if (!WindowChrome) {\n            console.error('WindowChrome not available');\n            return null;\n        }\n\n        const { frame, titlebar, content, statusbar } = WindowChrome.createWindowFrame({\n            title: t('photos.title', 'Fotos'),\n            icon: './img/fotos.png',\n            showClose: true,\n            showMinimize: false,\n            showMaximize: false,\n            onClose: () => {\n                globalWindow.API?.window?.close?.('photos-window');\n            },\n            toolbar: [\n                {\n                    label: '',\n                    icon: `<div class=\"relative flex-1 sm:flex-initial min-w-[200px]\">\n                        <input id=\"photos-search\" type=\"search\" placeholder=\"${t('photos.search.placeholder', 'Nach Autor suchen')}\" \n                            class=\"w-full rounded-2xl border border-gray-300 dark:border-gray-700 bg-white/70 dark:bg-gray-900/70 px-4 py-2 text-sm text-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400\" />\n                        <button id=\"photos-search-clear\" type=\"button\" class=\"absolute inset-y-0 right-2 flex items-center text-xl text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 invisible pointer-events-none\" \n                            title=\"${t('photos.search.clear', 'Suche löschen')}\">×</button>\n                    </div>`,\n                },\n                { type: 'separator' },\n                {\n                    label: '',\n                    icon: `<div class=\"flex bg-gray-200 dark:bg-gray-800 rounded-full p-1 text-sm font-medium text-gray-600 dark:text-gray-300 shadow-inner\" role=\"group\">\n                        <button type=\"button\" data-photos-segment=\"moments\" class=\"photos-segment-button\">${t('photos.segments.moments', 'Momente')}</button>\n                        <button type=\"button\" data-photos-segment=\"collections\" class=\"photos-segment-button\">${t('photos.segments.collections', 'Sammlungen')}</button>\n                        <button type=\"button\" data-photos-segment=\"years\" class=\"photos-segment-button\">${t('photos.segments.years', 'Jahre')}</button>\n                    </div>`,\n                },\n            ],\n            showStatusBar: true,\n            statusBarLeft: t('photos.status.countPlaceholder', '– Fotos'),\n            statusBarRight: '',\n        });\n\n        // Store references\n        elements.titlebar = titlebar;\n        elements.statusbar = statusbar;\n\n        // Build sidebar\n        const sidebar = document.createElement('aside');\n        sidebar.className = 'hidden md:flex flex-col w-56 border-r border-gray-200 dark:border-gray-800 bg-gray-50/80 dark:bg-gray-900/60';\n        sidebar.innerHTML = `\n            <div class=\"px-5 pt-6 pb-4\">\n                <p class=\"text-xs uppercase tracking-[0.2em] text-gray-400 dark:text-gray-500\">${t('photos.sidebar.library', 'Bibliothek')}</p>\n                <nav class=\"mt-4 space-y-1\" id=\"photos-sidebar\">\n                    <button type=\"button\" data-photos-filter=\"all\" class=\"photos-sidebar-button\">\n                        <span>${t('photos.sidebar.items.all', 'Alle Fotos')}</span>\n                        <span id=\"photos-count-all\" class=\"photos-sidebar-count\">–</span>\n                    </button>\n                    <button type=\"button\" data-photos-filter=\"favorites\" class=\"photos-sidebar-button\">\n                        <span>${t('photos.sidebar.items.favorites', 'Favoriten')}</span>\n                        <span id=\"photos-count-favorites\" class=\"photos-sidebar-count\">0</span>\n                    </button>\n                </nav>\n                <p class=\"text-xs uppercase tracking-[0.2em] text-gray-400 dark:text-gray-500 mt-6\">${t('photos.sidebar.filters', 'Filter')}</p>\n                <nav class=\"mt-4 space-y-1\">\n                    <button type=\"button\" data-photos-filter=\"landscape\" class=\"photos-sidebar-button\">\n                        <span>${t('photos.sidebar.items.landscape', 'Querformat')}</span>\n                        <span id=\"photos-count-landscape\" class=\"photos-sidebar-count\">–</span>\n                    </button>\n                    <button type=\"button\" data-photos-filter=\"portrait\" class=\"photos-sidebar-button\">\n                        <span>${t('photos.sidebar.items.portrait', 'Hochformat')}</span>\n                        <span id=\"photos-count-portrait\" class=\"photos-sidebar-count\">–</span>\n                    </button>\n                    <button type=\"button\" data-photos-filter=\"square\" class=\"photos-sidebar-button\">\n                        <span>${t('photos.sidebar.items.square', 'Quadratisch')}</span>\n                        <span id=\"photos-count-square\" class=\"photos-sidebar-count\">–</span>\n                    </button>\n                </nav>\n            </div>\n            <div class=\"px-5 pb-6 mt-auto\">\n                <button id=\"photos-refresh\" type=\"button\" class=\"w-full inline-flex items-center justify-center gap-2 px-3 py-2 text-sm font-medium rounded-2xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-200 transition hover:border-blue-400 hover:text-blue-600 dark:hover:border-blue-400 dark:hover:text-blue-300\">\n                    <span aria-hidden=\"true\">↻</span>\n                    <span>${t('photos.sidebar.refresh', 'Neu laden')}</span>\n                </button>\n                <p class=\"text-[11px] text-gray-400 dark:text-gray-500 mt-3 leading-relaxed\">${t('photos.sidebar.sourceNote', 'Quelle: Lorem Picsum – zufällige kuratierte Fotokollektionen.')}</p>\n            </div>\n        `;\n\n        // Build main area\n        const mainArea = document.createElement('div');\n        mainArea.className = 'flex-1 flex flex-col min-h-0 relative';\n        mainArea.innerHTML = `\n            <div class=\"flex-1 relative min-h-0\">\n                <div id=\"photos-loading\" class=\"absolute inset-0 flex items-center justify-center bg-white/80 dark:bg-gray-900/80 z-20 hidden\">\n                    <div class=\"flex flex-col items-center gap-2 text-gray-600 dark:text-gray-300\">\n                        <span class=\"h-10 w-10 border-4 border-gray-300 dark:border-gray-700 border-t-blue-500 dark:border-t-blue-400 rounded-full animate-spin\"></span>\n                        <span class=\"text-sm font-medium\">${t('photos.status.loading', 'Lade Fotos…')}</span>\n                    </div>\n                </div>\n                <div id=\"photos-error\" class=\"absolute inset-x-0 top-6 mx-auto max-w-lg bg-red-50 dark:bg-red-900/40 text-red-700 dark:text-red-200 rounded-2xl shadow px-5 py-4 hidden\">\n                    <p class=\"font-semibold mb-1\">${t('photos.errors.heading', 'Fehler beim Laden')}</p>\n                    <p class=\"text-sm\">${t('photos.errors.description', 'Bitte überprüfe deine Verbindung und versuche es erneut.')}</p>\n                    <button id=\"photos-error-retry\" type=\"button\" class=\"mt-3 inline-flex items-center gap-2 text-sm font-medium text-red-700 dark:text-red-100 underline decoration-dotted\">${t('photos.buttons.retry', 'Erneut versuchen')}</button>\n                </div>\n                <div id=\"photos-gallery\" class=\"absolute inset-0 overflow-y-auto px-5 sm:px-6 py-6 space-y-8\"></div>\n                <div id=\"photos-empty\" class=\"absolute inset-0 flex items-center justify-center text-center text-gray-500 dark:text-gray-400 hidden px-6\">\n                    <div>\n                        <p class=\"text-lg font-semibold\">${t('photos.empty.title', 'Keine Fotos gefunden')}</p>\n                        <p class=\"text-sm mt-1\">${t('photos.empty.description', 'Passe Suche oder Filter an, um weitere Ergebnisse zu sehen.')}</p>\n                    </div>\n                </div>\n                <div id=\"image-placeholder\" class=\"absolute inset-0 flex items-center justify-center text-gray-500 dark:text-gray-400 text-center px-6 hidden pointer-events-none\">${t('photos.placeholder', 'Wähle ein Foto aus, um Details zu sehen.')}</div>\n            </div>\n        `;\n\n        // Detail overlay\n        const detailOverlay = document.createElement('div');\n        detailOverlay.id = 'photo-detail-overlay';\n        detailOverlay.className = 'absolute inset-0 hidden items-center justify-center px-4 py-10 bg-black/50 backdrop-blur-sm z-30';\n        detailOverlay.innerHTML = `\n            <div class=\"bg-white dark:bg-gray-900 rounded-3xl shadow-2xl overflow-hidden max-w-5xl w-full h-full flex flex-col\">\n                <div class=\"flex items-center gap-4 px-6 py-4 border-b border-gray-200 dark:border-gray-800\">\n                    <div class=\"flex-1 min-w-0\">\n                        <p id=\"photo-detail-title\" class=\"text-xl font-semibold text-gray-900 dark:text-gray-100 truncate\">${t('photos.detail.titleFallback', 'Foto')}</p>\n                        <p id=\"photo-detail-meta\" class=\"text-sm text-gray-500 dark:text-gray-400 mt-1 truncate\"></p>\n                    </div>\n                    <div class=\"flex items-center gap-2\">\n                        <button id=\"photo-detail-favorite\" type=\"button\" class=\"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200 text-sm font-medium transition hover:bg-gray-200 dark:hover:bg-gray-700\">\n                            <span aria-hidden=\"true\">♡</span>\n                            <span>${t('photos.detail.favoriteAdd', 'Zu Favoriten')}</span>\n                        </button>\n                        <a id=\"photo-detail-download\" class=\"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-blue-600 text-white text-sm font-medium transition hover:bg-blue-500\" href=\"#\" target=\"_blank\" rel=\"noreferrer\">${t('photos.detail.download', 'Herunterladen')}</a>\n                        <button id=\"photo-detail-close\" type=\"button\" class=\"inline-flex items-center justify-center w-9 h-9 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200 text-lg leading-none transition hover:bg-gray-200 dark:hover:bg-gray-700\" title=\"${t('common.close', 'Schließen')}\">×</button>\n                    </div>\n                </div>\n                <div class=\"flex-1 flex overflow-hidden\">\n                    <button id=\"photo-detail-prev\" type=\"button\" class=\"hidden sm:flex items-center justify-center w-14 bg-transparent text-3xl text-gray-400 dark:text-gray-500 hover:text-gray-700 dark:hover:text-gray-200 transition\" title=\"${t('photos.detail.prev', 'Vorheriges Foto')}\">‹</button>\n                    <div class=\"flex-1 relative bg-gray-50 dark:bg-gray-950 flex items-center justify-center overflow-hidden\">\n                        <img id=\"image-viewer\" class=\"max-w-full max-h-full object-contain\" alt=\"${t('photos.detail.imageAlt', 'Ausgewähltes Foto')}\" />\n                        <div id=\"photo-detail-loader\" class=\"absolute inset-0 flex items-center justify-center bg-gray-900/40 text-white text-sm font-medium hidden\">${t('photos.detail.loader', 'Foto wird geladen…')}</div>\n                    </div>\n                    <button id=\"photo-detail-next\" type=\"button\" class=\"hidden sm:flex items-center justify-center w-14 bg-transparent text-3xl text-gray-400 dark:text-gray-500 hover:text-gray-700 dark:hover:text-gray-200 transition\" title=\"${t('photos.detail.next', 'Nächstes Foto')}\">›</button>\n                </div>\n                <div class=\"px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-gray-600 dark:text-gray-300\">\n                    <div class=\"flex-1 min-w-[200px]\">\n                        <p id=\"image-info\" class=\"font-medium text-gray-700 dark:text-gray-200\"></p>\n                        <p id=\"photo-detail-dimensions\" class=\"text-xs text-gray-500 dark:text-gray-400 mt-1\"></p>\n                    </div>\n                    <div class=\"flex items-center gap-3\">\n                        <span id=\"photo-detail-counter\" class=\"text-xs font-medium\"></span>\n                        <a id=\"photo-detail-open\" href=\"#\" target=\"_blank\" rel=\"noreferrer\" class=\"text-blue-600 dark:text-blue-400 hover:underline\">${t('photos.detail.openInBrowser', 'Im Browser öffnen')}</a>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        // Combine layout\n        const container = document.createElement('div');\n        container.className = 'flex h-full';\n        container.appendChild(sidebar);\n        container.appendChild(mainArea);\n\n        content.appendChild(container);\n        content.appendChild(detailOverlay);\n\n        return frame;\n    }\n\n    function init(): void {\n        if (state.initialized) {\n            return;\n        }\n        state.initialized = true;\n\n        // Check if we're in WindowChrome mode\n        const photosWindow = document.getElementById('photos-window');\n        if (!photosWindow) {\n            // Create and inject WindowChrome UI\n            const frame = renderWindow();\n            if (!frame) {\n                console.error('Failed to render photos window');\n                return;\n            }\n\n            // Find or create container\n            let container = document.getElementById('photos-window');\n            if (!container) {\n                container = document.createElement('div');\n                container.id = 'photos-window';\n                container.className = 'fixed inset-0 flex items-center justify-center hidden modal relative';\n                container.style.zIndex = '1000';\n                document.body.appendChild(container);\n            }\n\n            // Inject frame\n            const wrapper = document.createElement('div');\n            wrapper.className = 'w-[min(90vw,1100px)] h-[min(85vh,780px)]';\n            wrapper.appendChild(frame);\n            container.appendChild(wrapper);\n\n            elements.container = container;\n        } else {\n            elements.container = photosWindow;\n        }\n\n        cacheElements();\n        if (!elements.gallery) {\n            return;\n        }\n        wireSidebar();\n        wireSegments();\n        wireSearch();\n        wireGallery();\n        wireDetail();\n        globalWindow.appI18n?.applyTranslations?.(elements.container ?? undefined);\n        void fetchPhotos();\n    }\n\n    function cacheElements(): void {\n        if (!elements.container) {\n            return;\n        }\n        elements.sidebar = elements.container.querySelector('#photos-sidebar') ?? null;\n        elements.gallery = elements.container.querySelector('#photos-gallery') ?? null;\n        elements.loading = elements.container.querySelector('#photos-loading') ?? null;\n        elements.error = elements.container.querySelector('#photos-error') ?? null;\n        elements.errorRetry = elements.container.querySelector('#photos-error-retry') as HTMLButtonElement | null;\n        elements.empty = elements.container.querySelector('#photos-empty') ?? null;\n        elements.placeholder = elements.container.querySelector('#image-placeholder') ?? null;\n        elements.photoCount = elements.statusbar?.querySelector('.statusbar-left') ?? null;\n        elements.refreshButton = elements.container.querySelector('#photos-refresh') as HTMLButtonElement | null;\n        elements.searchInput = elements.container.querySelector('#photos-search') as HTMLInputElement | null;\n        elements.searchClear = elements.container.querySelector('#photos-search-clear') as HTMLButtonElement | null;\n        elements.overlay = elements.container.querySelector('#photo-detail-overlay') ?? null;\n        elements.detailTitle = elements.container.querySelector('#photo-detail-title') ?? null;\n        elements.detailMeta = elements.container.querySelector('#photo-detail-meta') ?? null;\n        elements.detailDimensions = elements.container.querySelector('#photo-detail-dimensions') ?? null;\n        elements.detailCounter = elements.container.querySelector('#photo-detail-counter') ?? null;\n        elements.detailOpen = elements.container.querySelector('#photo-detail-open') as HTMLAnchorElement | null;\n        elements.detailDownload = elements.container.querySelector('#photo-detail-download') as HTMLAnchorElement | null;\n        elements.detailFavorite = elements.container.querySelector('#photo-detail-favorite') as HTMLButtonElement | null;\n        elements.detailFavoriteLabel = elements.detailFavorite?.querySelector('span:last-child') ?? null;\n        elements.detailFavoriteIcon = elements.detailFavorite?.querySelector('span[aria-hidden=\"true\"]') ?? null;\n        elements.detailClose = elements.container.querySelector('#photo-detail-close') as HTMLButtonElement | null;\n        elements.detailPrev = elements.container.querySelector('#photo-detail-prev') as HTMLButtonElement | null;\n        elements.detailNext = elements.container.querySelector('#photo-detail-next') as HTMLButtonElement | null;\n        elements.image = elements.container.querySelector('#image-viewer') as HTMLImageElement | null;\n        elements.imageInfo = elements.container.querySelector('#image-info') ?? null;\n        elements.loader = elements.container.querySelector('#photo-detail-loader') ?? null;\n        elements.countAll = elements.container.querySelector('#photos-count-all') ?? null;\n        elements.countFavorites = elements.container.querySelector('#photos-count-favorites') ?? null;\n        elements.countLandscape = elements.container.querySelector('#photos-count-landscape') ?? null;\n        elements.countPortrait = elements.container.querySelector('#photos-count-portrait') ?? null;\n        elements.countSquare = elements.container.querySelector('#photos-count-square') ?? null;\n\n        const sidebarButtons = elements.sidebar?.querySelectorAll<HTMLButtonElement>('button[data-photos-filter]') ?? [];\n        elements.sidebarButtons = Array.from(sidebarButtons);\n        const segmentButtons = elements.container.querySelectorAll<HTMLButtonElement>('button[data-photos-segment]');\n        elements.segmentButtons = Array.from(segmentButtons);\n    }\n\n     function wireSidebar(): void {\n         elements.sidebarButtons.forEach(button => {\n             button.addEventListener('click', () => {\n                 const filter = button.getAttribute('data-photos-filter') as SidebarFilter | null;\n                 if (!filter || state.activeFilter === filter) {\n                     return;\n                 }\n                 state.activeFilter = filter;\n                 syncSidebarSelection();\n                 applyFilters();\n             });\n         });\n         syncSidebarSelection();\n         elements.refreshButton?.addEventListener('click', () => {\n             void fetchPhotos({ refresh: true });\n         });\n     }\n\n     function wireSegments(): void {\n         elements.segmentButtons.forEach(button => {\n             button.addEventListener('click', () => {\n                 const segment = button.getAttribute('data-photos-segment') as SegmentView | null;\n                 if (!segment || state.activeSegment === segment) {\n                     return;\n                 }\n                 state.activeSegment = segment;\n                 syncSegmentSelection();\n                 renderGallery();\n             });\n         });\n         syncSegmentSelection();\n     }\n\n     function wireSearch(): void {\n         elements.searchInput?.addEventListener('input', event => {\n             const target = event.currentTarget as HTMLInputElement;\n             state.searchTerm = target.value;\n             toggleSearchClear();\n             applyFilters();\n         });\n         elements.searchClear?.addEventListener('click', () => {\n             if (!elements.searchInput) {\n                 return;\n             }\n             elements.searchInput.value = '';\n             state.searchTerm = '';\n             toggleSearchClear();\n             applyFilters();\n         });\n         toggleSearchClear();\n     }\n\n     function wireGallery(): void {\n         elements.gallery?.addEventListener('click', event => {\n             const target = event.target as HTMLElement | null;\n             if (!target) {\n                 return;\n             }\n             const card = target.closest<HTMLElement>('[data-photo-index]');\n             if (!card) {\n                 return;\n             }\n             const rawIndex = card.getAttribute('data-photo-index');\n             const index = rawIndex ? Number(rawIndex) : NaN;\n             if (Number.isNaN(index) || index < 0) {\n                 return;\n             }\n             openDetail(index);\n         });\n     }\n\n     function wireDetail(): void {\n         elements.detailClose?.addEventListener('click', closeDetail);\n         elements.overlay?.addEventListener('click', event => {\n             if (event.target === elements.overlay) {\n                 closeDetail();\n             }\n         });\n         elements.detailPrev?.addEventListener('click', () => moveSelection(-1));\n         elements.detailNext?.addEventListener('click', () => moveSelection(1));\n         elements.detailFavorite?.addEventListener('click', toggleFavorite);\n         document.addEventListener('keydown', handleKeyNavigation);\n         elements.errorRetry?.addEventListener('click', () => {\n             void fetchPhotos({ refresh: true });\n         });\n         if (elements.image) {\n             elements.image.addEventListener('load', handleImageLoaded);\n             elements.image.addEventListener('error', handleImageError);\n         }\n     }\n\n     function handleImageLoaded(): void {\n         setDetailLoading(false);\n         if (!elements.image) {\n             return;\n         }\n         if (state.pendingImageId) {\n             const width = elements.image.naturalWidth;\n             const height = elements.image.naturalHeight;\n             const orientation = width === height ? 'square' : width > height ? 'landscape' : 'portrait';\n             if (state.externalPhoto && state.externalPhoto.id === state.pendingImageId) {\n                 state.externalPhoto.width = width;\n                 state.externalPhoto.height = height;\n                 state.externalPhoto.orientation = orientation;\n             }\n            if (state.overlayVisible) {\n                const current = getCurrentDetailPhoto();\n                if (current) {\n                    updateDetailMetadata(current);\n                }\n            }\n         }\n         state.pendingImageId = null;\n     }\n\n    function handleImageError(): void {\n        setDetailLoading(false);\n        if (elements.detailMeta) {\n            elements.detailMeta.textContent = t(\n                'photos.errors.detailImage',\n                'The photo could not be loaded.'\n            );\n        }\n    }\n\n     async function fetchPhotos(options: { refresh?: boolean } = {}): Promise<void> {\n         if (state.isLoading) {\n             return;\n         }\n         setError(false);\n         setLoading(true);\n         try {\n            const shouldRandomize = options.refresh || state.photos.length === 0;\n            const page = shouldRandomize ? getRandomPage() : state.currentPage;\n             const limit = 60;\n             const response = await fetch(`https://picsum.photos/v2/list?page=${page}&limit=${limit}`);\n             if (!response.ok) {\n                 throw new Error('Picsum request failed');\n             }\n             const data = (await response.json()) as PicsumApiPhoto[];\n             const mapped = data.map(mapPhotoItem);\n             state.photos = mapped;\n             state.currentPage = page;\n             state.favorites.clear();\n             state.externalPhoto = null;\n             state.orientationCounts = calculateOrientationCounts(mapped);\n             applyFilters();\n             updateSidebarCounts();\n         } catch (error) {\n            console.warn('Photos app: failed to load', error);\n             setError(true);\n         } finally {\n             setLoading(false);\n         }\n     }\n\n     function mapPhotoItem(item: PicsumApiPhoto, index: number): PhotoLibraryItem {\n         const width = Number(item.width) || 0;\n         const height = Number(item.height) || 0;\n         const orientation: Orientation = width === height ? 'square' : width > height ? 'landscape' : 'portrait';\n         const numericId = Number.parseInt(item.id, 10);\n         const yearBase = Number.isFinite(numericId) ? numericId : index;\n         const year = 2014 + ((yearBase % 10) + 1);\n        const sanitizedAuthor =\n            item.author && item.author.trim().length > 0\n                ? item.author.trim()\n                : t('photos.detail.unknownPhotographer', 'Unknown photographer');\n         const id = String(item.id);\n         return {\n             id,\n             author: sanitizedAuthor,\n             width,\n             height,\n             orientation,\n             year,\n             url: item.url,\n             downloadUrl: item.download_url,\n             thumbUrl: `https://picsum.photos/id/${id}/600/400`,\n             largeUrl: `https://picsum.photos/id/${id}/1600/1200`,\n         };\n     }\n\n     function calculateOrientationCounts(photos: PhotoLibraryItem[]): Record<Orientation, number> {\n         return photos.reduce(\n             (acc, photo) => {\n                 acc[photo.orientation] += 1;\n                 return acc;\n             },\n             { landscape: 0, portrait: 0, square: 0 } as Record<Orientation, number>,\n         );\n     }\n\n     function applyFilters(): void {\n         const search = state.searchTerm.trim().toLowerCase();\n         const previousActiveId = state.overlayVisible ? state.activePhotoId : null;\n         const filtered = state.photos.filter(photo => {\n             if (state.activeFilter === 'favorites' && !state.favorites.has(photo.id)) {\n                 return false;\n             }\n             if (state.activeFilter === 'landscape' && photo.orientation !== 'landscape') {\n                 return false;\n             }\n             if (state.activeFilter === 'portrait' && photo.orientation !== 'portrait') {\n                 return false;\n             }\n             if (state.activeFilter === 'square' && photo.orientation !== 'square') {\n                 return false;\n             }\n             if (search && !photo.author.toLowerCase().includes(search)) {\n                 return false;\n             }\n             return true;\n         });\n         state.filteredPhotos = filtered;\n         state.filteredIndexMap = new Map(filtered.map((photo, index) => [photo.id, index]));\n         renderGallery();\n         updateEmptyState();\n         updatePhotoCount();\n         updateSidebarCounts();\n         if (previousActiveId) {\n             const newIndex = state.filteredIndexMap.get(previousActiveId);\n             if (typeof newIndex === 'number') {\n                 state.selectedIndex = newIndex;\n                 updateNavigationButtons();\n                 updateCounter();\n                 setActiveCard(previousActiveId);\n             } else if (!state.externalPhoto) {\n                 closeDetail();\n             }\n         }\n     }\n\n     function renderGallery(): void {\n         if (!elements.gallery) {\n             return;\n         }\n         elements.gallery.innerHTML = '';\n         if (!state.filteredPhotos.length) {\n             return;\n         }\n         const groups = buildGroups(state.filteredPhotos, state.activeSegment);\n         groups.forEach(group => {\n             const section = document.createElement('section');\n             section.className = 'space-y-3';\n\n             const heading = document.createElement('div');\n             heading.className = 'flex items-baseline justify-between px-2';\n            const title = document.createElement('h3');\n            title.className = 'text-base font-semibold text-gray-800 dark:text-gray-100 tracking-wide';\n            title.textContent = group.title;\n            const count = document.createElement('span');\n            count.className = 'text-xs text-gray-500 dark:text-gray-400';\n            const countKey =\n                group.photos.length === 1 ? 'photos.labels.photoSingular' : 'photos.labels.photoPlural';\n            const countLabel = t(countKey, group.photos.length === 1 ? 'Photo' : 'Photos');\n            count.textContent = `${group.photos.length} ${countLabel}`;\n            heading.append(title, count);\n            section.append(heading);\n\n            const grid = document.createElement('div');\n            grid.className = 'grid gap-4 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 auto-rows-[minmax(140px,_auto)]';\n\n             group.photos.forEach(photo => {\n                 const index = state.filteredIndexMap.get(photo.id) ?? -1;\n                 const card = document.createElement('button');\n                 card.type = 'button';\n                 card.className = 'photos-card relative group overflow-hidden rounded-2xl bg-gray-200 dark:bg-gray-800 shadow-md hover:-translate-y-0.5 hover:shadow-xl focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-400';\n                 card.dataset.photoId = photo.id;\n                 card.dataset.photoIndex = String(index);\n                 if (state.favorites.has(photo.id)) {\n                     card.dataset.favorite = 'true';\n                 }\n                if (state.activePhotoId === photo.id && state.overlayVisible) {\n                    card.dataset.selected = 'true';\n                }\n\n                const image = document.createElement('img');\n                image.src = photo.thumbUrl;\n                image.alt = t('photos.gallery.alt', 'Photo by {author}', { author: photo.author });\n                image.loading = 'lazy';\n                image.className = 'w-full h-full object-cover transition duration-300 group-hover:scale-105';\n\n                 const overlay = document.createElement('div');\n                 overlay.className = 'absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent px-3 py-2 text-left';\n                 const author = document.createElement('p');\n                 author.className = 'text-white text-sm font-medium truncate';\n                 author.textContent = photo.author;\n                 const meta = document.createElement('p');\n                 meta.className = 'text-white/80 text-[11px] uppercase tracking-[0.3em]';\n                 meta.textContent = `${photo.year} ΓÇó ${formatOrientation(photo.orientation)}`;\n                 overlay.append(author, meta);\n\n                 card.append(image, overlay);\n                 grid.append(card);\n             });\n\n             section.append(grid);\n             elements.gallery?.append(section);\n         });\n     }\n\n     function buildGroups(photos: PhotoLibraryItem[], segment: SegmentView): PhotoGroup[] {\n        if (segment === 'collections') {\n            const orientations: Array<{ title: string; key: Orientation }> = [\n                { title: t('photos.collections.landscape', 'Landscapes'), key: 'landscape' },\n                { title: t('photos.collections.portrait', 'Portraits'), key: 'portrait' },\n                { title: t('photos.collections.square', 'Squares'), key: 'square' },\n            ];\n            return orientations\n                .map(item => ({ title: item.title, photos: photos.filter(photo => photo.orientation === item.key) }))\n                .filter(group => group.photos.length > 0);\n        }\n         if (segment === 'years') {\n             const byYear = new Map<number, PhotoLibraryItem[]>();\n             photos.forEach(photo => {\n                 const collection = byYear.get(photo.year) ?? [];\n                 collection.push(photo);\n                 byYear.set(photo.year, collection);\n             });\n             return Array.from(byYear.entries())\n                 .sort((a, b) => b[0] - a[0])\n                 .map(([year, group]) => ({ title: String(year), photos: group }));\n         }\n         // moments -> group by author\n         const byAuthor = new Map<string, PhotoLibraryItem[]>();\n         photos.forEach(photo => {\n             const key = photo.author;\n             const collection = byAuthor.get(key) ?? [];\n             collection.push(photo);\n             byAuthor.set(key, collection);\n         });\n         return Array.from(byAuthor.entries())\n             .sort((a, b) => {\n                 const latestA = Math.max(...a[1].map(item => item.year));\n                 const latestB = Math.max(...b[1].map(item => item.year));\n                 return latestB - latestA;\n             })\n             .map(([author, group]) => ({ title: author, photos: group }));\n     }\n\n    function formatOrientation(orientation: Orientation | undefined): string {\n        if (orientation === 'portrait') {\n            return t('photos.orientations.portrait', 'Portrait');\n        }\n        if (orientation === 'square') {\n            return t('photos.orientations.square', 'Square');\n        }\n        return t('photos.orientations.landscape', 'Landscape');\n    }\n\n     function setActiveCard(photoId: string): void {\n         if (!elements.gallery) {\n             return;\n         }\n         const current = elements.gallery.querySelector<HTMLElement>('.photos-card[data-selected=\"true\"]');\n         if (current) {\n             current.removeAttribute('data-selected');\n         }\n         const next = elements.gallery.querySelector<HTMLElement>(`.photos-card[data-photo-id=\"${photoId}\"]`);\n         if (next) {\n             next.dataset.selected = 'true';\n         }\n     }\n\n     function clearActiveCard(): void {\n         if (!elements.gallery) {\n             return;\n         }\n         const current = elements.gallery.querySelector<HTMLElement>('.photos-card[data-selected=\"true\"]');\n         current?.removeAttribute('data-selected');\n     }\n\n     function updateEmptyState(): void {\n         const shouldShow = state.filteredPhotos.length === 0;\n         elements.empty?.classList.toggle('hidden', !shouldShow);\n     }\n\n     function updatePhotoCount(): void {\n        const total = state.filteredPhotos.length;\n        const labelKey = total === 1 ? 'photos.labels.photoSingular' : 'photos.labels.photoPlural';\n        const label = t(labelKey, total === 1 ? 'Photo' : 'Photos');\n        const segmentKey =\n            state.activeSegment === 'collections'\n                ? 'photos.segments.collections'\n                : state.activeSegment === 'years'\n                ? 'photos.segments.years'\n                : 'photos.segments.moments';\n        const segmentFallback =\n            state.activeSegment === 'collections'\n                ? 'Collections'\n                : state.activeSegment === 'years'\n                ? 'Years'\n                : 'Moments';\n        const segmentLabel = t(segmentKey, segmentFallback);\n        const statusText = t(\n            'photos.status.count',\n            `${total} ${label} ΓÇó ${segmentLabel}`,\n            { count: total, label, segment: segmentLabel },\n        );\n\n        // Update statusbar if available\n        if (elements.statusbar && globalWindow.WindowChrome) {\n            globalWindow.WindowChrome.updateStatusBar(elements.statusbar, 'left', statusText);\n        }\n\n        // Fallback for old photo-count element\n        if (elements.photoCount) {\n            elements.photoCount.textContent = statusText;\n        }\n     }\n\n     function updateSidebarCounts(): void {\n         if (elements.countAll) {\n             elements.countAll.textContent = String(state.photos.length);\n         }\n         if (elements.countFavorites) {\n             elements.countFavorites.textContent = String(state.favorites.size);\n         }\n         if (elements.countLandscape) {\n             elements.countLandscape.textContent = String(state.orientationCounts.landscape);\n         }\n         if (elements.countPortrait) {\n             elements.countPortrait.textContent = String(state.orientationCounts.portrait);\n         }\n         if (elements.countSquare) {\n             elements.countSquare.textContent = String(state.orientationCounts.square);\n         }\n     }\n\n     function syncSidebarSelection(): void {\n         elements.sidebarButtons.forEach(button => {\n             const filter = button.getAttribute('data-photos-filter') as SidebarFilter | null;\n             button.dataset.active = filter === state.activeFilter ? 'true' : 'false';\n         });\n     }\n\n     function syncSegmentSelection(): void {\n         elements.segmentButtons.forEach(button => {\n             const segment = button.getAttribute('data-photos-segment') as SegmentView | null;\n             button.dataset.active = segment === state.activeSegment ? 'true' : 'false';\n         });\n     }\n\n     function toggleSearchClear(): void {\n         if (!elements.searchClear) {\n             return;\n         }\n         const hasValue = Boolean(state.searchTerm.trim());\n         elements.searchClear.classList.toggle('invisible', !hasValue);\n         elements.searchClear.classList.toggle('pointer-events-none', !hasValue);\n     }\n\n     function setLoading(isLoading: boolean): void {\n         state.isLoading = isLoading;\n         elements.loading?.classList.toggle('hidden', !isLoading);\n     }\n\n     function setError(hasError: boolean): void {\n         elements.error?.classList.toggle('hidden', !hasError);\n     }\n\n     function openDetail(index: number, options: { external?: boolean; photo?: ExternalPhotoItem } = {}): void {\n         const overlay = elements.overlay;\n         if (!overlay || !elements.image) {\n             return;\n         }\n         let photo: AnyPhotoItem | null = null;\n         if (options.external && options.photo) {\n             photo = options.photo;\n             state.externalPhoto = options.photo;\n             state.selectedIndex = -1;\n             state.activePhotoId = options.photo.id;\n         } else {\n             const selected = state.filteredPhotos[index];\n             if (!selected) {\n                 return;\n             }\n             photo = selected;\n             state.selectedIndex = index;\n             state.activePhotoId = selected.id;\n             state.externalPhoto = null;\n         }\n         state.overlayVisible = true;\n         overlay.classList.remove('hidden');\n         overlay.classList.add('flex');\n         if (!photo) {\n             return;\n         }\n         setDetailLoading(true);\n         state.pendingImageId = photo.id;\n         if ('largeUrl' in photo && photo.largeUrl) {\n             elements.image.src = photo.largeUrl;\n         } else {\n             elements.image.src = photo.downloadUrl;\n         }\n         updateDetailMetadata(photo);\n         updateNavigationButtons();\n         updateCounter();\n         if (!options.external) {\n             setActiveCard(photo.id);\n         } else {\n             clearActiveCard();\n         }\n     }\n\n     function getCurrentDetailPhoto(): AnyPhotoItem | null {\n         if (state.externalPhoto) {\n             return state.externalPhoto;\n         }\n         if (state.selectedIndex >= 0) {\n             return state.filteredPhotos[state.selectedIndex] ?? null;\n         }\n         return null;\n     }\n\n     function updateDetailMetadata(photo: AnyPhotoItem): void {\n        if (elements.detailTitle) {\n            const fallbackTitle = t('photos.detail.unknownPhoto', 'Unknown photo');\n            elements.detailTitle.textContent = photo.author || fallbackTitle;\n        }\n        if (elements.imageInfo) {\n            const label = isExternalPhoto(photo) && photo.sourceName ? photo.sourceName : photo.author;\n            elements.imageInfo.textContent = label;\n        }\n        const orientationLabel = formatOrientation(photo.orientation);\n        const metaParts: string[] = [];\n        if (isExternalPhoto(photo)) {\n            metaParts.push(t('photos.detail.externalLabel', 'External photo'));\n            if (photo.sourceName) {\n                metaParts.push(photo.sourceName);\n            }\n        } else {\n            metaParts.push(String(photo.year));\n            metaParts.push(orientationLabel);\n        }\n        if (elements.detailMeta) {\n            elements.detailMeta.textContent = metaParts.join(' ΓÇó ');\n        }\n        if (elements.detailDimensions) {\n            if (photo.width && photo.height) {\n                elements.detailDimensions.textContent = t(\n                    'photos.detail.dimensions',\n                    `Resolution: ${photo.width} ├ù ${photo.height}px`,\n                    { width: photo.width, height: photo.height },\n                );\n            } else {\n                elements.detailDimensions.textContent = '';\n            }\n        }\n        if (elements.detailOpen) {\n            elements.detailOpen.href = photo.url ?? photo.downloadUrl;\n        }\n        if (elements.detailDownload) {\n            elements.detailDownload.href = photo.downloadUrl;\n            elements.detailDownload.download = t(\n                'photos.detail.downloadFilename',\n                `photo-${photo.id}.jpg`,\n                { id: photo.id },\n            );\n        }\n        updateFavoriteButton(photo);\n    }\n\n    function updateFavoriteButton(photo: AnyPhotoItem): void {\n        if (!elements.detailFavorite || !elements.detailFavoriteLabel || !elements.detailFavoriteIcon) {\n            return;\n        }\n        if (isExternalPhoto(photo)) {\n            elements.detailFavorite.setAttribute('disabled', 'true');\n            elements.detailFavorite.classList.add('opacity-40', 'pointer-events-none');\n            elements.detailFavoriteLabel.textContent = t(\n                'photos.detail.favoriteUnavailable',\n                'Unavailable',\n            );\n            elements.detailFavoriteIcon.textContent = 'ΓÇô';\n            return;\n        }\n        const isFavorite = state.favorites.has(photo.id);\n        elements.detailFavorite.removeAttribute('disabled');\n        elements.detailFavorite.classList.remove('opacity-40', 'pointer-events-none');\n        const removeLabel = t('photos.detail.favoriteRemove', 'Remove favorite');\n        const addLabel = t('photos.detail.favoriteAdd', 'Add to favorites');\n        elements.detailFavoriteLabel.textContent = isFavorite ? removeLabel : addLabel;\n        elements.detailFavoriteIcon.textContent = isFavorite ? 'ΓÖÑ' : 'ΓÖí';\n    }\n\n     function closeDetail(): void {\n         if (!elements.overlay) {\n             return;\n         }\n         elements.overlay.classList.add('hidden');\n         elements.overlay.classList.remove('flex');\n         state.overlayVisible = false;\n         state.selectedIndex = -1;\n         state.activePhotoId = null;\n         state.externalPhoto = null;\n         state.pendingImageId = null;\n         clearActiveCard();\n         setDetailLoading(false);\n     }\n\n     function moveSelection(delta: number): void {\n         if (state.externalPhoto) {\n             return;\n         }\n         const nextIndex = state.selectedIndex + delta;\n         if (nextIndex < 0 || nextIndex >= state.filteredPhotos.length) {\n             return;\n         }\n         openDetail(nextIndex);\n     }\n\n     function toggleFavorite(): void {\n         if (state.externalPhoto) {\n             return;\n         }\n         const photo = state.filteredPhotos[state.selectedIndex];\n         if (!photo) {\n             return;\n         }\n         if (state.favorites.has(photo.id)) {\n             state.favorites.delete(photo.id);\n         } else {\n             state.favorites.add(photo.id);\n         }\n         updateFavoriteButton(photo);\n         updateSidebarCounts();\n         updateCardFavoriteState(photo.id);\n     }\n\n     function updateCardFavoriteState(photoId: string): void {\n         if (!elements.gallery) {\n             return;\n         }\n         const card = elements.gallery.querySelector<HTMLElement>(`.photos-card[data-photo-id=\"${photoId}\"]`);\n         if (!card) {\n             return;\n         }\n         if (state.favorites.has(photoId)) {\n             card.dataset.favorite = 'true';\n         } else {\n             card.removeAttribute('data-favorite');\n         }\n     }\n\n     function updateNavigationButtons(): void {\n         const hasPrev = state.selectedIndex > 0 && !state.externalPhoto;\n         const hasNext =\n             state.selectedIndex >= 0 &&\n             state.selectedIndex < state.filteredPhotos.length - 1 &&\n             !state.externalPhoto;\n         if (elements.detailPrev) {\n             elements.detailPrev.classList.toggle('opacity-30', !hasPrev);\n             elements.detailPrev.classList.toggle('pointer-events-none', !hasPrev);\n         }\n         if (elements.detailNext) {\n             elements.detailNext.classList.toggle('opacity-30', !hasNext);\n             elements.detailNext.classList.toggle('pointer-events-none', !hasNext);\n         }\n     }\n\n     function updateCounter(): void {\n        if (!elements.detailCounter) {\n            return;\n        }\n        if (state.externalPhoto) {\n            elements.detailCounter.textContent = t('photos.detail.externalCounter', 'External image');\n            return;\n        }\n        if (state.selectedIndex >= 0) {\n            elements.detailCounter.textContent = t(\n                'photos.detail.counter',\n                `${state.selectedIndex + 1} of ${state.filteredPhotos.length}`,\n                { index: state.selectedIndex + 1, total: state.filteredPhotos.length },\n            );\n        } else {\n            elements.detailCounter.textContent = '';\n        }\n    }\n\n     function setDetailLoading(isLoading: boolean): void {\n         elements.loader?.classList.toggle('hidden', !isLoading);\n     }\n\n    function handleKeyNavigation(event: KeyboardEvent): void {\n        if (!state.overlayVisible) {\n            return;\n        }\n        if (event.key === 'Escape') {\n            closeDetail();\n        } else if (event.key === 'ArrowLeft') {\n            moveSelection(-1);\n        } else if (event.key === 'ArrowRight') {\n            moveSelection(1);\n        }\n    }\n\n     function getRandomPage(): number {\n         return Math.floor(Math.random() * 10) + 1;\n     }\n\n    function showExternalImage(payload: { src: string; name?: string }): void {\n        if (!payload || !payload.src) {\n            return;\n        }\n        if (!state.initialized) {\n            init();\n        }\n        const name =\n            payload.name && payload.name.trim().length > 0\n                ? payload.name.trim()\n                : t('photos.detail.externalFile', 'External file');\n        const externalPhoto: ExternalPhotoItem = {\n            id: `external-${Date.now()}`,\n            author: name,\n            downloadUrl: payload.src,\n            largeUrl: payload.src,\n            url: payload.src,\n            sourceName: name,\n            isExternal: true,\n        };\n        openDetail(-1, { external: true, photo: externalPhoto });\n    }\n\n    function handleLanguageChange(): void {\n        if (!state.initialized) {\n            return;\n        }\n        renderGallery();\n        updateEmptyState();\n        updatePhotoCount();\n        if (state.overlayVisible) {\n            const current = getCurrentDetailPhoto();\n            if (current) {\n                updateDetailMetadata(current);\n            }\n            updateNavigationButtons();\n            updateCounter();\n        } else {\n            updateCounter();\n        }\n        globalWindow.appI18n?.applyTranslations?.(elements.container ?? undefined);\n    }\n\n    const api: PhotosAppApi = {\n        init,\n        showExternalImage,\n    };\n\n    globalWindow.PhotosApp = api;\n\n    window.addEventListener('languagePreferenceChange', handleLanguageChange);\n\n    // Don't auto-init - let WindowManager handle it\n    // if (document.readyState === 'loading') {\n    //     document.addEventListener('DOMContentLoaded', init, { once: true });\n    // } else {\n    //     init();\n    // }\n })();\n\n"]}