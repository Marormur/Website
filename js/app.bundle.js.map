{
  "version": 3,
  "sources": ["../src/ts/i18n/de.ts", "../src/ts/i18n/en.ts", "../src/ts/services/i18n.ts", "../src/ts/ui/dom-utils.ts", "../src/ts/core/constants.ts", "../src/ts/core/logger.ts", "../src/ts/services/storage-utils.ts", "../src/ts/core/error-handler.ts", "../src/ts/core/perf-monitor.ts", "../src/ts/core/api.ts", "../src/ts/windows/z-index-manager.ts", "../src/ts/windows/window-manager.ts", "../src/ts/ui/actions/helpers.ts", "../src/ts/ui/actions/finder.ts", "../src/ts/ui/actions/preview.ts", "../src/ts/ui/actions/session.ts", "../src/ts/ui/desktop.ts", "../src/ts/ui/actions/windows.ts", "../src/ts/ui/action-bus.ts", "../src/ts/ui/dialog-utils.ts", "../src/ts/ui/snap-utils.ts", "../src/ts/services/program-actions.ts", "../src/ts/services/program-menu-sync.ts", "../src/ts/ui/menu.ts", "../src/ts/ui/dock.ts", "../src/ts/ui/dialog.ts", "../src/ts/ui/menubar-utils.ts", "../src/ts/ui/context-menu.ts", "../src/ts/services/storage.ts", "../src/ts/services/theme.ts", "../src/ts/utils/auto-save-helper.ts", "../src/ts/windows/base-window-instance.ts", "../src/ts/windows/instance-manager.ts", "../src/ts/windows/window-chrome.ts", "../src/ts/windows/base-tab.ts", "../src/ts/windows/base-window.ts", "../src/ts/windows/window-registry.ts", "../src/ts/services/virtual-fs.ts", "../src/ts/apps/terminal/terminal-session.ts", "../src/ts/apps/terminal/terminal-window.ts", "../src/ts/apps/text-editor/text-editor-document.ts", "../src/ts/apps/text-editor/text-editor-window.ts", "../src/ts/apps/text-editor/text-editor-instance.ts", "../src/ts/windows/preview-window-instance.ts", "../src/ts/windows/preview-instance-manager.ts", "../src/ts/apps/finder/finder-view.ts", "../src/ts/apps/finder/finder-window.ts", "../src/ts/services/multi-window-session.ts", "../src/ts/services/session-manager.ts", "../src/ts/windows/window-tabs.ts", "../src/ts/apps/terminal/terminal-instance.ts", "../src/ts/apps/text-editor/text-editor.ts", "../src/ts/services/settings.ts", "../src/ts/apps/photos/image-viewer-utils.ts", "../src/ts/ui/keyboard-shortcuts.ts", "../src/ts/services/github-api.ts", "../src/ts/apps/photos/photos-app.ts", "../src/ts/windows/window-configs.ts", "../src/ts/apps/finder/finder-instance.ts", "../src/ts/ui/launchpad.ts", "../src/ts/windows/multi-instance-integration.ts", "../src/ts/services/system.ts", "../src/ts/ui/window-menu.ts", "../src/ts/services/session-guard.ts", "../src/ts/compat/instance-shims.ts", "../src/ts/core/app-init.ts", "../src/ts/compat/expose-globals.ts"],
  "sourcesContent": ["/**\r\n * de.ts - Deutsche \u00DCbersetzungen\r\n *\r\n * Alle deutschen \u00DCbersetzungsstrings f\u00FCr das Portfolio.\r\n */\r\n\r\nexport const de = {\r\n    context: {\r\n        menuLabel: 'Kontextmen\u00FC',\r\n        open: '\u00D6ffnen',\r\n        openFinder: 'Sucher \u00F6ffnen',\r\n        openTextEditor: 'Texteditor \u00F6ffnen',\r\n        openProjects: 'Projekte \u00F6ffnen',\r\n        openSettings: 'Systemeinstellungen \u2026',\r\n        toggleDarkMode: 'Dark Mode umschalten',\r\n        about: '\u00DCber Marvin',\r\n        image: {\r\n            openInTab: 'Bild in neuem Tab \u00F6ffnen',\r\n            save: 'Bild sichern \u2026',\r\n        },\r\n        finder: {\r\n            openItem: '\u00D6ffnen',\r\n            getInfo: 'Informationen',\r\n            refresh: 'Aktualisieren',\r\n            newFolder: 'Neuer Ordner',\r\n            viewList: 'Als Liste',\r\n            viewGrid: 'Als Raster',\r\n            sortByName: 'Nach Name sortieren',\r\n            sortByDate: 'Nach Datum sortieren',\r\n            sortBySize: 'Nach Gr\u00F6\u00DFe sortieren',\r\n        },\r\n    },\r\n    common: {\r\n        close: 'Schlie\u00DFen',\r\n        system: 'System',\r\n        german: 'Deutsch',\r\n        english: 'Englisch',\r\n    },\r\n    header: {\r\n        profile: {\r\n            about: '\u00DCber Marvin',\r\n            resetLayout: 'Fenster zur\u00FCcksetzen',\r\n            settings: 'Systemeinstellungen',\r\n            linkedin: 'LinkedIn',\r\n        },\r\n        program: {\r\n            close: 'Programm schlie\u00DFen',\r\n        },\r\n    },\r\n    desktop: {\r\n        finder: 'Sucher',\r\n        projects: 'Projekte',\r\n        github: 'GitHub Projekte',\r\n        text: 'Texteditor',\r\n        image: 'Bildbetrachter',\r\n        photos: 'Fotos',\r\n        settings: 'Systemeinstellungen',\r\n        about: '\u00DCber Marvin',\r\n        launchpad: 'Launchpad',\r\n        terminal: 'Terminal',\r\n    },\r\n    dock: {\r\n        finder: 'Sucher',\r\n        projects: 'GitHub Projekte',\r\n        text: 'Texteditor',\r\n        image: 'Bildbetrachter',\r\n        settings: 'Systemeinstellungen',\r\n        launchpad: 'Apps',\r\n        terminal: 'Terminal',\r\n    },\r\n    menubar: {\r\n        appleMenu: {\r\n            label: 'Apple-Men\u00FC',\r\n        },\r\n        applicationMenus: 'Anwendungsmen\u00FCs',\r\n        controlCenter: {\r\n            label: 'Kontrollzentrum',\r\n            quickActions: 'Schnellaktionen',\r\n            quickActionsAria: 'Schnellaktionen',\r\n            brightness: 'Helligkeit',\r\n            volume: 'Lautst\u00E4rke',\r\n        },\r\n        toggles: {\r\n            wifi: 'WLAN',\r\n            wifiStatus: 'WLAN-Status',\r\n            bluetooth: 'Bluetooth',\r\n            bluetoothStatus: 'Bluetooth-Status',\r\n            focus: 'Fokus',\r\n            darkMode: 'Dark Mode',\r\n        },\r\n        wifi: {\r\n            preferredNetworks: 'Bevorzugte Netzwerke',\r\n        },\r\n        bluetooth: {\r\n            devices: 'Ger\u00E4te',\r\n            airpods: 'Marvins AirPods Pro',\r\n            keyboard: 'Magic Keyboard',\r\n            speaker: 'HomeSpeaker',\r\n        },\r\n        sound: {\r\n            label: 'Ton',\r\n            outputDevices: 'Ausgabeger\u00E4te',\r\n            devices: {\r\n                speakers: 'MacBook Lautsprecher',\r\n                airpods: 'Marvins AirPods Pro',\r\n                display: 'Samsung Monitor',\r\n            },\r\n        },\r\n        networks: {\r\n            home: 'HomeLAN',\r\n            office: 'Office',\r\n            hotspot: 'Marvin iPhone',\r\n        },\r\n        state: {\r\n            on: 'Ein',\r\n            off: 'Aus',\r\n            active: 'Aktiv',\r\n            connected: 'Verbunden',\r\n            ready: 'Bereit',\r\n            notConnected: 'Nicht verbunden',\r\n            hotspot: 'Pers\u00F6nlicher Hotspot',\r\n            automatic: 'Automatisch',\r\n        },\r\n        actions: {\r\n            networkSettings: 'Netzwerkeinstellungen \u2026',\r\n            bluetoothSettings: 'Bluetooth-Einstellungen \u2026',\r\n            soundSettings: 'Ton-Einstellungen \u2026',\r\n            spotlight: 'Spotlight',\r\n            siri: 'Siri',\r\n        },\r\n        battery: {\r\n            label: 'Batteriestatus',\r\n            fullLabel: 'Batterie vollst\u00E4ndig geladen',\r\n        },\r\n    },\r\n    modals: {\r\n        projects: {\r\n            title: 'Projekte',\r\n            repositories: 'Repositories',\r\n            placeholder: 'W\u00E4hle ein Repository aus, um dessen Dateien zu sehen.',\r\n        },\r\n        about: {\r\n            title: '\u00DCber Marvin',\r\n            birth: 'M\u00E4rz 1999',\r\n            locationLabel: 'Wohnort',\r\n            locationValue: 'Deutschland',\r\n            jobLabel: 'Beruf',\r\n            jobValue: 'Softwareentwickler',\r\n            employerLabel: 'Arbeitgeber',\r\n            employerValue: 'WinWorker',\r\n            moreButton: 'Mehr Infos \u2026',\r\n            copyright: '\u00A9 2025 Marvin T. \u2014 Alle Rechte vorbehalten.',\r\n        },\r\n        settings: {\r\n            title: 'Systemeinstellungen',\r\n        },\r\n        text: {\r\n            title: 'Texteditor',\r\n        },\r\n        image: {\r\n            title: 'Bildbetrachter',\r\n            placeholder: '\u00D6ffne eine Bilddatei aus dem Sucher, um die Vorschau zu sehen.',\r\n        },\r\n        finder: {\r\n            title: 'Sucher',\r\n        },\r\n        programInfo: {\r\n            title: '\u00DCber dieses Programm',\r\n        },\r\n        launchpad: {\r\n            title: 'Launchpad',\r\n            searchPlaceholder: 'Programme suchen',\r\n        },\r\n        terminal: {\r\n            title: 'Terminal',\r\n        },\r\n    },\r\n    photos: {\r\n        title: 'Fotos',\r\n        badge: 'PICSUM CLOUD',\r\n        sidebar: {\r\n            library: 'Bibliothek',\r\n            filters: 'Filter',\r\n            refresh: 'Neu laden',\r\n            sourceNote: 'Quelle: Lorem Picsum \u2013 zuf\u00E4llige kuratierte Fotokollektionen.',\r\n            items: {\r\n                all: 'Alle Fotos',\r\n                favorites: 'Favoriten',\r\n                landscape: 'Querformat',\r\n                portrait: 'Hochformat',\r\n                square: 'Quadratisch',\r\n            },\r\n        },\r\n        segments: {\r\n            moments: 'Momente',\r\n            collections: 'Sammlungen',\r\n            years: 'Jahre',\r\n        },\r\n        search: {\r\n            placeholder: 'Nach Autor suchen',\r\n            clear: 'Suche l\u00F6schen',\r\n        },\r\n        status: {\r\n            countPlaceholder: '\u2013 Fotos',\r\n            loading: 'Lade Fotos\u2026',\r\n            count: '{count} {label} \u2022 {segment}',\r\n        },\r\n        errors: {\r\n            heading: 'Fehler beim Laden',\r\n            description: 'Bitte \u00FCberpr\u00FCfe deine Verbindung und versuche es erneut.',\r\n            detailImage: 'Das Foto konnte nicht geladen werden.',\r\n        },\r\n        buttons: {\r\n            retry: 'Erneut versuchen',\r\n        },\r\n        empty: {\r\n            title: 'Keine Fotos gefunden',\r\n            description: 'Passe Suche oder Filter an, um weitere Ergebnisse zu sehen.',\r\n        },\r\n        placeholder: 'W\u00E4hle ein Foto aus, um Details zu sehen.',\r\n        detail: {\r\n            titleFallback: 'Foto',\r\n            favoriteAdd: 'Zu Favoriten',\r\n            favoriteRemove: 'Favorit entfernen',\r\n            favoriteUnavailable: 'Nicht verf\u00FCgbar',\r\n            download: 'Herunterladen',\r\n            open: 'Auf Lorem Picsum ansehen',\r\n            loader: 'Foto wird geladen\u2026',\r\n            prev: 'Vorheriges Foto',\r\n            next: 'N\u00E4chstes Foto',\r\n            imageAlt: 'Ausgew\u00E4hltes Foto',\r\n            unknownPhoto: 'Unbekanntes Foto',\r\n            unknownPhotographer: 'Unbekannter Fotograf',\r\n            externalLabel: 'Externes Foto',\r\n            dimensions: 'Aufl\u00F6sung: {width} \u00D7 {height}px',\r\n            downloadFilename: 'foto-{id}.jpg',\r\n            externalCounter: 'Externes Bild',\r\n            counter: '{index} von {total}',\r\n            externalFile: 'Externe Datei',\r\n        },\r\n        orientations: {\r\n            landscape: 'Querformat',\r\n            portrait: 'Portr\u00E4t',\r\n            square: 'Quadrat',\r\n        },\r\n        collections: {\r\n            landscape: 'Horizonte',\r\n            portrait: 'Portr\u00E4ts',\r\n            square: 'Quadrate',\r\n        },\r\n        labels: {\r\n            photoSingular: 'Foto',\r\n            photoPlural: 'Fotos',\r\n        },\r\n        gallery: {\r\n            alt: 'Foto von {author}',\r\n        },\r\n    },\r\n    finder: {\r\n        toolbar: {\r\n            back: 'Zur\u00FCck',\r\n            forward: 'Vorw\u00E4rts',\r\n            listView: 'Listenansicht',\r\n            gridView: 'Rasteransicht',\r\n            search: 'Suchen',\r\n        },\r\n        sidebar: {\r\n            favorites: 'Favoriten',\r\n            home: 'Home',\r\n            computer: 'Computer',\r\n            recent: 'Zuletzt verwendet',\r\n            locations: 'Orte',\r\n            github: 'GitHub Projekte',\r\n            starred: 'Markiert',\r\n        },\r\n        back: 'Zur\u00FCck',\r\n        imageViewer: 'Bildbetrachter',\r\n        textEditor: 'Texteditor',\r\n        loadingFiles: 'Dateien werden geladen \u2026',\r\n        filesLoadError: 'Dateien konnten nicht geladen werden. Bitte versuche es sp\u00E4ter erneut.',\r\n        emptyDirectory: 'Keine Dateien in diesem Verzeichnis.',\r\n        noRepositories: 'Keine \u00F6ffentlichen Repositories gefunden.',\r\n        repositoriesError: 'Repos konnten nicht geladen werden. Bitte versuche es sp\u00E4ter erneut.',\r\n        repoDescriptionMissing: 'Keine Beschreibung verf\u00FCgbar.',\r\n        repoUnnamed: 'Unbenanntes Repository',\r\n        loadingImage: '{name} wird geladen \u2026',\r\n        imageLoadError: 'Bild konnte nicht geladen werden.',\r\n        imageLoadErrorRetry:\r\n            'Das Bild konnte nicht geladen werden. Bitte versuche es sp\u00E4ter erneut.',\r\n        fileLoadError: 'Die Datei konnte nicht geladen werden.',\r\n        rateLimit: 'GitHub Rate Limit erreicht. Bitte versuche es sp\u00E4ter erneut.',\r\n        pathNotFound: 'Der ausgew\u00E4hlte Pfad ist nicht mehr verf\u00FCgbar.',\r\n    },\r\n    programs: {\r\n        default: {\r\n            label: 'Sucher',\r\n            infoLabel: '\u00DCber Sucher',\r\n            about: {\r\n                name: 'Sucher',\r\n                tagline: 'Dein pers\u00F6nlicher Dateimanager.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. Alle Rechte vorbehalten.',\r\n            },\r\n        },\r\n        finder: {\r\n            label: 'Sucher',\r\n            infoLabel: '\u00DCber Sucher',\r\n            about: {\r\n                name: 'Sucher',\r\n                tagline: 'Der innovative Desktop-Dateimanager.',\r\n                version: 'Version 2.0',\r\n                copyright: '\u00A9 Marvin Temmen. Alle Rechte vorbehalten.',\r\n            },\r\n        },\r\n        projects: {\r\n            label: 'GitHub Projekte',\r\n            infoLabel: '\u00DCber GitHub Projekte',\r\n            about: {\r\n                name: 'GitHub Projekte',\r\n                tagline: 'Durchsuche deine GitHub-Repositories.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. Alle Rechte vorbehalten.',\r\n            },\r\n        },\r\n        settings: {\r\n            label: 'Systemeinstellungen',\r\n            infoLabel: '\u00DCber Systemeinstellungen',\r\n            about: {\r\n                name: 'Systemeinstellungen',\r\n                tagline: 'Konfiguriere Erscheinungsbild, Accounts und mehr.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. Alle Rechte vorbehalten.',\r\n            },\r\n        },\r\n        text: {\r\n            label: 'Texteditor',\r\n            infoLabel: '\u00DCber Texteditor',\r\n            about: {\r\n                name: 'Texteditor',\r\n                tagline: 'Leichtgewichtiger Editor f\u00FCr deine Notizen.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. Alle Rechte vorbehalten.',\r\n            },\r\n        },\r\n        image: {\r\n            label: 'Bildanzeige',\r\n            infoLabel: '\u00DCber Bildanzeige',\r\n            about: {\r\n                name: 'Bildanzeige',\r\n                tagline: 'Betrachte Screenshots und Fotos mit Vorschau.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. Alle Rechte vorbehalten.',\r\n            },\r\n        },\r\n        photos: {\r\n            label: 'Fotos',\r\n            infoLabel: '\u00DCber Fotos',\r\n            about: {\r\n                name: 'Fotos',\r\n                tagline: 'Deine Bilder auf einen Klick.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. Alle Rechte vorbehalten.',\r\n            },\r\n        },\r\n        about: {\r\n            label: '\u00DCber Marvin',\r\n            infoLabel: '\u00DCber dieses Fenster',\r\n            about: {\r\n                name: '\u00DCber Marvin',\r\n                tagline: 'Erfahre mehr \u00FCber Marvin Temmen.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. Alle Rechte vorbehalten.',\r\n            },\r\n        },\r\n        launchpad: {\r\n            label: 'Launchpad',\r\n            infoLabel: '\u00DCber Launchpad',\r\n            about: {\r\n                name: 'Launchpad',\r\n                tagline: 'Starte alle deine Programme.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. Alle Rechte vorbehalten.',\r\n            },\r\n        },\r\n        terminal: {\r\n            label: 'Terminal',\r\n            infoLabel: '\u00DCber Terminal',\r\n            about: {\r\n                name: 'Terminal',\r\n                tagline: 'Kommandozeilenschnittstelle f\u00FCr das Portfolio.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. Alle Rechte vorbehalten.',\r\n            },\r\n        },\r\n        preview: {\r\n            label: 'Vorschau',\r\n            infoLabel: 'Bildvorschau',\r\n            about: {\r\n                name: 'Vorschau',\r\n                tagline: 'Schnelle Bildanzeige',\r\n                version: '1.0',\r\n                copyright: '\u00A9 2025 Marormur',\r\n            },\r\n        },\r\n    },\r\n    textEditor: {\r\n        title: 'Texteditor',\r\n        documentTitle: 'Texteditor',\r\n        documentTitleWithFile: 'Texteditor \u2013 {fileName}',\r\n        toolbar: {\r\n            bold: 'Fett',\r\n            italic: 'Kursiv',\r\n            underline: 'Unterstrichen',\r\n            strikeThrough: 'Durchgestrichen',\r\n            heading1: '\u00DCberschrift 1',\r\n            heading2: '\u00DCberschrift 2',\r\n            heading3: '\u00DCberschrift 3',\r\n            unorderedList: 'Aufz\u00E4hlungsliste',\r\n            orderedList: 'Nummerierte Liste',\r\n            alignLeft: 'Linksb\u00FCndig',\r\n            alignCenter: 'Zentriert',\r\n            alignRight: 'Rechtsb\u00FCndig',\r\n            insertLink: 'Link einf\u00FCgen',\r\n            findReplace: 'Suchen & Ersetzen',\r\n            undo: 'R\u00FCckg\u00E4ngig',\r\n            redo: 'Wiederholen',\r\n            clear: 'Neu',\r\n            open: '\u00D6ffnen',\r\n            save: 'Speichern',\r\n        },\r\n        findReplace: {\r\n            find: 'Suchen...',\r\n            replace: 'Ersetzen...',\r\n            next: 'Weiter',\r\n            replaceOne: 'Ersetzen',\r\n            replaceAll: 'Alle ersetzen',\r\n            close: 'Schlie\u00DFen',\r\n            noMatch: 'Keine \u00DCbereinstimmung gefunden',\r\n            replacedCount: '{count} Vorkommen ersetzt',\r\n        },\r\n        status: {\r\n            loading: 'Lade Datei \u2026',\r\n            loadingWithLabel: '{label} (l\u00E4dt \u2026)',\r\n            loadError: 'Datei konnte nicht geladen werden.',\r\n            rateLimit: 'GitHub Rate Limit erreicht. Bitte versuche es sp\u00E4ter erneut.',\r\n            wordCount: 'W\u00F6rter: {words} | Zeichen: {chars}',\r\n            position: 'Zeile {line}, Spalte {col}',\r\n        },\r\n    },\r\n    menu: {\r\n        sections: {\r\n            file: 'Ablage',\r\n            edit: 'Bearbeiten',\r\n            view: 'Darstellung',\r\n            window: 'Fenster',\r\n            help: 'Hilfe',\r\n        },\r\n        finder: {\r\n            newWindow: 'Neues Sucher-Fenster',\r\n            reload: 'Sucher neu laden',\r\n            close: 'Fenster schlie\u00DFen',\r\n            help: 'Sucher-Hilfe anzeigen',\r\n        },\r\n        settings: {\r\n            close: 'Fenster schlie\u00DFen',\r\n            help: 'Einstellungs-Hilfe anzeigen',\r\n        },\r\n        text: {\r\n            newFile: 'Neu',\r\n            open: '\u00D6ffnen \u2026',\r\n            save: 'Speichern',\r\n            undo: 'R\u00FCckg\u00E4ngig',\r\n            redo: 'Wiederholen',\r\n            cut: 'Ausschneiden',\r\n            copy: 'Kopieren',\r\n            paste: 'Einf\u00FCgen',\r\n            selectAll: 'Alles ausw\u00E4hlen',\r\n            toggleWrap: 'Zeilenumbruch umschalten',\r\n            help: 'Texteditor-Hilfe anzeigen',\r\n        },\r\n        image: {\r\n            openInTab: 'Bild in neuem Tab \u00F6ffnen',\r\n            saveImage: 'Bild sichern \u2026',\r\n            close: 'Fenster schlie\u00DFen',\r\n            help: 'Bildbetrachter-Hilfe anzeigen',\r\n        },\r\n        terminal: {\r\n            newWindow: 'Neues Terminal-Fenster',\r\n            clear: 'Terminal l\u00F6schen',\r\n            close: 'Fenster schlie\u00DFen',\r\n            help: 'Terminal-Hilfe anzeigen',\r\n            newTab: 'Neuer Tab',\r\n            duplicateTab: 'Tab duplizieren',\r\n            closeTab: 'Tab schlie\u00DFen',\r\n            closeWindow: 'Terminal-Fenster schlie\u00DFen',\r\n            copy: 'Kopieren',\r\n            paste: 'Einf\u00FCgen',\r\n            selectAll: 'Alles ausw\u00E4hlen',\r\n        },\r\n        about: {\r\n            close: 'Fenster schlie\u00DFen',\r\n            help: '\u00DCber Marvin',\r\n        },\r\n        programInfo: {\r\n            close: 'Fenster schlie\u00DFen',\r\n        },\r\n        window: {\r\n            minimize: 'Minimieren',\r\n            zoom: 'Zoomen',\r\n            bringToFront: 'Alle nach vorne bringen',\r\n            close: 'Fenster schlie\u00DFen',\r\n            closeAll: 'Alle schlie\u00DFen',\r\n            newInstance: 'Neue Instanz',\r\n            newFinder: 'Neuer Sucher',\r\n            newTerminal: 'Neues Terminal',\r\n            newEditor: 'Neuer Editor',\r\n            closeAllConfirm: 'Alle {count} {type}-Instanzen schlie\u00DFen?',\r\n        },\r\n        session: {\r\n            export: 'Session exportieren \u2026',\r\n            import: 'Session importieren \u2026',\r\n            exportSuccess: 'Session erfolgreich exportiert',\r\n            importSuccess: 'Session erfolgreich importiert',\r\n            importError: 'Session konnte nicht importiert werden',\r\n            noSession: 'Keine Session zum Exportieren vorhanden',\r\n        },\r\n        help: {\r\n            showHelp: 'Programmhilfe anzeigen',\r\n        },\r\n    },\r\n    settingsPage: {\r\n        title: 'Einstellungen',\r\n        nav: {\r\n            general: '\uD83D\uDC64 Allgemein',\r\n            display: '\uD83D\uDDA5\uFE0F Darstellung',\r\n            language: '\uD83C\uDF10 Sprache',\r\n        },\r\n        general: {\r\n            title: 'Allgemein',\r\n            name: 'Marvin Temmen',\r\n            birth: 'M\u00E4rz 1999',\r\n            locationLabel: 'Wohnort',\r\n            locationValue: 'Deutschland',\r\n            jobLabel: 'Beruf',\r\n            jobValue: 'Softwareentwickler',\r\n            employerLabel: 'Arbeitgeber',\r\n            employerValue: 'WinWorker',\r\n            copyright: '\u00A9 2025 Marvin T. \u2014 Alle Rechte vorbehalten.',\r\n        },\r\n        display: {\r\n            title: 'Darstellungsoptionen',\r\n            description: 'Passe an, wie der Desktop mit hellem und dunklem Design umgeht.',\r\n            legend: 'Darkmode',\r\n            options: {\r\n                system: {\r\n                    label: 'System',\r\n                    description: 'Folgt den aktuellen Systemeinstellungen.',\r\n                },\r\n                light: {\r\n                    label: 'Hell',\r\n                    description: 'Bleibt immer im hellen Erscheinungsbild.',\r\n                },\r\n                dark: {\r\n                    label: 'Dunkel',\r\n                    description: 'Bleibt immer im dunklen Erscheinungsbild.',\r\n                },\r\n            },\r\n        },\r\n        language: {\r\n            title: 'Sprache',\r\n            description: 'W\u00E4hle, in welcher Sprache die Oberfl\u00E4che angezeigt wird.',\r\n            legend: 'Bevorzugte Sprache',\r\n            options: {\r\n                system: {\r\n                    label: 'System',\r\n                    description: 'Verwendet automatisch die Sprache deines Systems.',\r\n                },\r\n                de: {\r\n                    label: 'Deutsch',\r\n                    description: 'Zeigt Inhalte immer auf Deutsch.',\r\n                },\r\n                en: {\r\n                    label: 'Englisch',\r\n                    description: 'Zeigt Inhalte immer auf Englisch.',\r\n                },\r\n            },\r\n        },\r\n    },\r\n    projectsPage: {\r\n        title: 'Meine GitHub Projekte',\r\n        empty: 'Keine \u00F6ffentlichen Repositories gefunden.',\r\n        repoUnnamed: 'Unbenanntes Repository',\r\n        noDescription: 'Keine Beschreibung verf\u00FCgbar.',\r\n        error: 'Repos konnten nicht geladen werden. Bitte versuche es sp\u00E4ter erneut.',\r\n    },\r\n    preview: {\r\n        noImage: 'Kein Bild ausgew\u00E4hlt',\r\n        zoomIn: 'Vergr\u00F6\u00DFern',\r\n        zoomOut: 'Verkleinern',\r\n        next: 'N\u00E4chstes Bild',\r\n        prev: 'Vorheriges Bild',\r\n        dragDrop: 'Bild hierher ziehen',\r\n        contextMenu: 'Kontextmen\u00FC',\r\n    },\r\n};\r\n", "/**\r\n * en.ts - English Translations\r\n *\r\n * All English translation strings for the portfolio.\r\n */\r\n\r\nexport const en = {\r\n    context: {\r\n        menuLabel: 'Context menu',\r\n        open: 'Open',\r\n        openFinder: 'Open Finder',\r\n        openTextEditor: 'Open Text editor',\r\n        openProjects: 'Open Projects',\r\n        openSettings: 'System settings\u2026',\r\n        toggleDarkMode: 'Toggle dark mode',\r\n        about: 'About Marvin',\r\n        image: {\r\n            openInTab: 'Open image in new tab',\r\n            save: 'Save image\u2026',\r\n        },\r\n        finder: {\r\n            openItem: 'Open',\r\n            getInfo: 'Get Info',\r\n            refresh: 'Refresh',\r\n            newFolder: 'New Folder',\r\n            viewList: 'View as List',\r\n            viewGrid: 'View as Grid',\r\n            sortByName: 'Sort by Name',\r\n            sortByDate: 'Sort by Date',\r\n            sortBySize: 'Sort by Size',\r\n        },\r\n    },\r\n    common: {\r\n        close: 'Close',\r\n        system: 'System',\r\n        german: 'German',\r\n        english: 'English',\r\n    },\r\n    header: {\r\n        profile: {\r\n            about: 'About Marvin',\r\n            resetLayout: 'Reset windows',\r\n            settings: 'System settings',\r\n            linkedin: 'LinkedIn',\r\n        },\r\n        program: {\r\n            close: 'Close program',\r\n        },\r\n    },\r\n    desktop: {\r\n        finder: 'Finder',\r\n        projects: 'Projects',\r\n        github: 'GitHub Projects',\r\n        text: 'Text editor',\r\n        image: 'Image viewer',\r\n        photos: 'Photos',\r\n        settings: 'System settings',\r\n        about: 'About Marvin',\r\n        launchpad: 'Launchpad',\r\n        terminal: 'Terminal',\r\n    },\r\n    dock: {\r\n        finder: 'Finder',\r\n        projects: 'GitHub Projects',\r\n        text: 'Text editor',\r\n        image: 'Image viewer',\r\n        settings: 'System settings',\r\n        launchpad: 'Apps',\r\n        terminal: 'Terminal',\r\n    },\r\n    menubar: {\r\n        appleMenu: {\r\n            label: 'Apple menu',\r\n        },\r\n        applicationMenus: 'Application menus',\r\n        controlCenter: {\r\n            label: 'Control Center',\r\n            quickActions: 'Quick Actions',\r\n            quickActionsAria: 'Quick Actions',\r\n            brightness: 'Brightness',\r\n            volume: 'Volume',\r\n        },\r\n        toggles: {\r\n            wifi: 'Wi-Fi',\r\n            wifiStatus: 'Wi-Fi status',\r\n            bluetooth: 'Bluetooth',\r\n            bluetoothStatus: 'Bluetooth status',\r\n            focus: 'Focus mode',\r\n            darkMode: 'Dark mode',\r\n        },\r\n        wifi: {\r\n            preferredNetworks: 'Preferred networks',\r\n        },\r\n        bluetooth: {\r\n            devices: 'Devices',\r\n            airpods: \"Marvin's AirPods Pro\",\r\n            keyboard: 'Magic Keyboard',\r\n            speaker: 'HomeSpeaker',\r\n        },\r\n        sound: {\r\n            label: 'Sound',\r\n            outputDevices: 'Output devices',\r\n            devices: {\r\n                speakers: 'MacBook speakers',\r\n                airpods: \"Marvin's AirPods Pro\",\r\n                display: 'External display',\r\n            },\r\n        },\r\n        networks: {\r\n            home: 'HomeLAN',\r\n            office: 'Office',\r\n            hotspot: \"Marvin's iPhone\",\r\n        },\r\n        state: {\r\n            on: 'On',\r\n            off: 'Off',\r\n            active: 'Active',\r\n            connected: 'Connected',\r\n            ready: 'Ready',\r\n            notConnected: 'Not connected',\r\n            hotspot: 'Personal hotspot',\r\n            automatic: 'Automatic',\r\n        },\r\n        actions: {\r\n            networkSettings: 'Network settings\u2026',\r\n            bluetoothSettings: 'Bluetooth settings\u2026',\r\n            soundSettings: 'Sound settings\u2026',\r\n            spotlight: 'Spotlight',\r\n            siri: 'Siri',\r\n        },\r\n        battery: {\r\n            label: 'Battery status',\r\n            fullLabel: 'Battery fully charged',\r\n        },\r\n    },\r\n    modals: {\r\n        projects: {\r\n            title: 'Projects',\r\n            repositories: 'Repositories',\r\n            placeholder: 'Select a repository to browse its files.',\r\n        },\r\n        about: {\r\n            title: 'About Marvin',\r\n            birth: 'March 1999',\r\n            locationLabel: 'Location',\r\n            locationValue: 'Germany',\r\n            jobLabel: 'Occupation',\r\n            jobValue: 'Software engineer',\r\n            employerLabel: 'Employer',\r\n            employerValue: 'WinWorker',\r\n            moreButton: 'More details\u2026',\r\n            copyright: '\u00A9 2025 Marvin T. \u2014 All rights reserved.',\r\n        },\r\n        settings: {\r\n            title: 'System settings',\r\n        },\r\n        text: {\r\n            title: 'Text editor',\r\n        },\r\n        image: {\r\n            title: 'Image viewer',\r\n            placeholder: 'Open an image file from Finder to preview it.',\r\n        },\r\n        finder: {\r\n            title: 'Finder',\r\n        },\r\n        photos: {\r\n            title: 'Photos',\r\n            badge: 'PICSUM CLOUD',\r\n            sidebar: {\r\n                library: 'Library',\r\n                filters: 'Filters',\r\n                refresh: 'Reload',\r\n                sourceNote: 'Source: Lorem Picsum \u2014 curated random photo collections.',\r\n                items: {\r\n                    all: 'All Photos',\r\n                    favorites: 'Favorites',\r\n                    landscape: 'Landscape',\r\n                    portrait: 'Portrait',\r\n                    square: 'Square',\r\n                },\r\n            },\r\n            segments: {\r\n                moments: 'Moments',\r\n                collections: 'Collections',\r\n                years: 'Years',\r\n            },\r\n            search: {\r\n                placeholder: 'Search by author',\r\n                clear: 'Clear search',\r\n            },\r\n            status: {\r\n                countPlaceholder: '\u2013 Photos',\r\n                loading: 'Loading photos\u2026',\r\n                count: '{count} {label} \u2022 {segment}',\r\n            },\r\n            errors: {\r\n                heading: 'Loading error',\r\n                description: 'Please check your connection and try again.',\r\n                detailImage: 'The photo could not be loaded.',\r\n            },\r\n            buttons: {\r\n                retry: 'Try again',\r\n            },\r\n            empty: {\r\n                title: 'No photos found',\r\n                description: 'Adjust search or filters to see more results.',\r\n            },\r\n            placeholder: 'Select a photo to view details.',\r\n            detail: {\r\n                titleFallback: 'Photo',\r\n                favoriteAdd: 'Add to favorites',\r\n                favoriteRemove: 'Remove favorite',\r\n                favoriteUnavailable: 'Unavailable',\r\n                download: 'Download',\r\n                open: 'View on Lorem Picsum',\r\n                loader: 'Loading photo\u2026',\r\n                prev: 'Previous photo',\r\n                next: 'Next photo',\r\n                imageAlt: 'Selected photo',\r\n                unknownPhoto: 'Unknown photo',\r\n                unknownPhotographer: 'Unknown photographer',\r\n                externalLabel: 'External photo',\r\n                dimensions: 'Resolution: {width} \u00D7 {height}px',\r\n                downloadFilename: 'photo-{id}.jpg',\r\n                externalCounter: 'External image',\r\n                counter: '{index} of {total}',\r\n                externalFile: 'External file',\r\n            },\r\n            orientations: {\r\n                landscape: 'Landscape',\r\n                portrait: 'Portrait',\r\n                square: 'Square',\r\n            },\r\n            collections: {\r\n                landscape: 'Landscapes',\r\n                portrait: 'Portraits',\r\n                square: 'Squares',\r\n            },\r\n            labels: {\r\n                photoSingular: 'Photo',\r\n                photoPlural: 'Photos',\r\n            },\r\n            gallery: {\r\n                alt: 'Photo by {author}',\r\n            },\r\n        },\r\n        programInfo: {\r\n            title: 'About this app',\r\n        },\r\n        launchpad: {\r\n            title: 'Launchpad',\r\n            searchPlaceholder: 'Search apps',\r\n        },\r\n        terminal: {\r\n            title: 'Terminal',\r\n        },\r\n    },\r\n    programs: {\r\n        default: {\r\n            label: 'Finder',\r\n            infoLabel: 'About Finder',\r\n            about: {\r\n                name: 'Finder',\r\n                tagline: 'Your personal file manager.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. All rights reserved.',\r\n            },\r\n        },\r\n        finder: {\r\n            label: 'Finder',\r\n            infoLabel: 'About Finder',\r\n            about: {\r\n                name: 'Finder',\r\n                tagline: 'The innovative desktop file manager.',\r\n                version: 'Version 2.0',\r\n                copyright: '\u00A9 Marvin Temmen. All rights reserved.',\r\n            },\r\n        },\r\n        projects: {\r\n            label: 'GitHub Projects',\r\n            infoLabel: 'About GitHub Projects',\r\n            about: {\r\n                name: 'GitHub Projects',\r\n                tagline: 'Browse your GitHub repositories.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. All rights reserved.',\r\n            },\r\n        },\r\n        settings: {\r\n            label: 'System settings',\r\n            infoLabel: 'About System settings',\r\n            about: {\r\n                name: 'System settings',\r\n                tagline: 'Configure appearance, accounts, and more.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. All rights reserved.',\r\n            },\r\n        },\r\n        text: {\r\n            label: 'Text editor',\r\n            infoLabel: 'About Text editor',\r\n            about: {\r\n                name: 'Text editor',\r\n                tagline: 'Lightweight editor for your notes.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. All rights reserved.',\r\n            },\r\n        },\r\n        image: {\r\n            label: 'Image viewer',\r\n            infoLabel: 'About Image viewer',\r\n            about: {\r\n                name: 'Image viewer',\r\n                tagline: 'Preview screenshots and photos with ease.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. All rights reserved.',\r\n            },\r\n        },\r\n        photos: {\r\n            label: 'Photos',\r\n            infoLabel: 'About Photos',\r\n            about: {\r\n                name: 'Photos',\r\n                tagline: 'Your images at a click.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. All rights reserved.',\r\n            },\r\n        },\r\n        about: {\r\n            label: 'About Marvin',\r\n            infoLabel: 'About this window',\r\n            about: {\r\n                name: 'About Marvin',\r\n                tagline: 'Learn more about Marvin Temmen.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. All rights reserved.',\r\n            },\r\n        },\r\n        launchpad: {\r\n            label: 'Launchpad',\r\n            infoLabel: 'About Launchpad',\r\n            about: {\r\n                name: 'Launchpad',\r\n                tagline: 'Launch all your apps.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. All rights reserved.',\r\n            },\r\n        },\r\n        terminal: {\r\n            label: 'Terminal',\r\n            infoLabel: 'About Terminal',\r\n            about: {\r\n                name: 'Terminal',\r\n                tagline: 'Command-line interface for the portfolio.',\r\n                version: 'Version 1.0',\r\n                copyright: '\u00A9 Marvin Temmen. All rights reserved.',\r\n            },\r\n        },\r\n        preview: {\r\n            label: 'Preview',\r\n            infoLabel: 'Image Preview',\r\n            about: {\r\n                name: 'Preview',\r\n                tagline: 'Quick image viewer',\r\n                version: '1.0',\r\n                copyright: '\u00A9 2025 Marormur',\r\n            },\r\n        },\r\n    },\r\n    finder: {\r\n        toolbar: {\r\n            back: 'Back',\r\n            forward: 'Forward',\r\n            listView: 'List view',\r\n            gridView: 'Grid view',\r\n            search: 'Search',\r\n        },\r\n        sidebar: {\r\n            favorites: 'Favorites',\r\n            home: 'Home',\r\n            computer: 'Computer',\r\n            recent: 'Recent',\r\n            locations: 'Locations',\r\n            github: 'GitHub Projects',\r\n            starred: 'Starred',\r\n        },\r\n        back: 'Back',\r\n        imageViewer: 'Image viewer',\r\n        textEditor: 'Text editor',\r\n        loadingFiles: 'Loading files\u2026',\r\n        filesLoadError: 'Files could not be loaded. Please try again later.',\r\n        emptyDirectory: 'No files found in this directory.',\r\n        noRepositories: 'No public repositories found.',\r\n        repositoriesError: 'Repositories could not be loaded. Please try again later.',\r\n        repoDescriptionMissing: 'No description available.',\r\n        repoUnnamed: 'Untitled repository',\r\n        loadingImage: 'Loading {name}\u2026',\r\n        imageLoadError: 'Could not load the image.',\r\n        imageLoadErrorRetry: 'The image could not be loaded. Please try again later.',\r\n        fileLoadError: 'The file could not be loaded. Please try again later.',\r\n        rateLimit: 'GitHub rate limit reached. Please try again later.',\r\n        pathNotFound: 'The selected path is no longer available.',\r\n    },\r\n    textEditor: {\r\n        title: 'Text editor',\r\n        documentTitle: 'Text editor',\r\n        documentTitleWithFile: 'Text editor \u2013 {fileName}',\r\n        toolbar: {\r\n            bold: 'Bold',\r\n            italic: 'Italic',\r\n            underline: 'Underline',\r\n            strikeThrough: 'Strikethrough',\r\n            heading1: 'Heading 1',\r\n            heading2: 'Heading 2',\r\n            heading3: 'Heading 3',\r\n            unorderedList: 'Bullet list',\r\n            orderedList: 'Numbered list',\r\n            alignLeft: 'Align left',\r\n            alignCenter: 'Center',\r\n            alignRight: 'Align right',\r\n            insertLink: 'Insert link',\r\n            findReplace: 'Find & Replace',\r\n            undo: 'Undo',\r\n            redo: 'Redo',\r\n            clear: 'New',\r\n            open: 'Open',\r\n            save: 'Save',\r\n        },\r\n        findReplace: {\r\n            find: 'Find...',\r\n            replace: 'Replace...',\r\n            next: 'Next',\r\n            replaceOne: 'Replace',\r\n            replaceAll: 'Replace all',\r\n            close: 'Close',\r\n            noMatch: 'No match found',\r\n            replacedCount: 'Replaced {count} occurrence(s)',\r\n        },\r\n        status: {\r\n            loading: 'Loading file\u2026',\r\n            loadingWithLabel: '{label} (loading\u2026)',\r\n            loadError: 'The file could not be loaded.',\r\n            rateLimit: 'GitHub rate limit was reached. Please try again later.',\r\n            wordCount: 'Words: {words} | Characters: {chars}',\r\n            position: 'Line {line}, Col {col}',\r\n        },\r\n    },\r\n    menu: {\r\n        sections: {\r\n            file: 'File',\r\n            edit: 'Edit',\r\n            view: 'View',\r\n            window: 'Window',\r\n            help: 'Help',\r\n        },\r\n        finder: {\r\n            newWindow: 'Create Finder Window',\r\n            reload: 'Reload Finder',\r\n            close: 'Close window',\r\n            help: 'Show Finder help',\r\n        },\r\n        settings: {\r\n            close: 'Close window',\r\n            help: 'Show settings help',\r\n        },\r\n        text: {\r\n            newFile: 'New',\r\n            open: 'Open\u2026',\r\n            save: 'Save',\r\n            undo: 'Undo',\r\n            redo: 'Redo',\r\n            cut: 'Cut',\r\n            copy: 'Copy',\r\n            paste: 'Paste',\r\n            selectAll: 'Select all',\r\n            toggleWrap: 'Toggle line wrap',\r\n            help: 'Show text editor help',\r\n        },\r\n        image: {\r\n            openInTab: 'Open image in new tab',\r\n            saveImage: 'Save image\u2026',\r\n            close: 'Close window',\r\n            help: 'Show image viewer help',\r\n        },\r\n        terminal: {\r\n            newWindow: 'New Terminal window',\r\n            clear: 'Clear Terminal',\r\n            close: 'Close window',\r\n            help: 'Show Terminal help',\r\n            newTab: 'New Tab',\r\n            duplicateTab: 'Duplicate Tab',\r\n            closeTab: 'Close Tab',\r\n            closeWindow: 'Close Terminal window',\r\n            copy: 'Copy',\r\n            paste: 'Paste',\r\n            selectAll: 'Select all',\r\n        },\r\n        about: {\r\n            close: 'Close window',\r\n            help: 'About Marvin',\r\n        },\r\n        programInfo: {\r\n            close: 'Close window',\r\n        },\r\n        window: {\r\n            minimize: 'Minimize',\r\n            zoom: 'Zoom',\r\n            bringToFront: 'Bring all to front',\r\n            close: 'Close window',\r\n            closeAll: 'Close All',\r\n            newInstance: 'New Instance',\r\n            newFinder: 'New Finder',\r\n            newTerminal: 'New Terminal',\r\n            newEditor: 'New Editor',\r\n            closeAllConfirm: 'Close all {count} {type} instances?',\r\n        },\r\n        session: {\r\n            export: 'Export Session\u2026',\r\n            import: 'Import Session\u2026',\r\n            exportSuccess: 'Session successfully exported',\r\n            importSuccess: 'Session successfully imported',\r\n            importError: 'Failed to import session',\r\n            noSession: 'No session available to export',\r\n        },\r\n        help: {\r\n            showHelp: 'Show app help',\r\n        },\r\n    },\r\n    settingsPage: {\r\n        title: 'Settings',\r\n        nav: {\r\n            general: '\uD83D\uDC64 General',\r\n            display: '\uD83D\uDDA5\uFE0F Appearance',\r\n            language: '\uD83C\uDF10 Language',\r\n        },\r\n        general: {\r\n            title: 'General',\r\n            name: 'Marvin Temmen',\r\n            birth: 'March 1999',\r\n            locationLabel: 'Location',\r\n            locationValue: 'Germany',\r\n            jobLabel: 'Occupation',\r\n            jobValue: 'Software engineer',\r\n            employerLabel: 'Employer',\r\n            employerValue: 'WinWorker',\r\n            copyright: '\u00A9 2025 Marvin T. \u2014 All rights reserved.',\r\n        },\r\n        display: {\r\n            title: 'Appearance options',\r\n            description: 'Adjust how the desktop handles light and dark mode.',\r\n            legend: 'Dark mode',\r\n            options: {\r\n                system: {\r\n                    label: 'System',\r\n                    description: 'Follows the current system setting.',\r\n                },\r\n                light: {\r\n                    label: 'Light',\r\n                    description: 'Always stays in light appearance.',\r\n                },\r\n                dark: {\r\n                    label: 'Dark',\r\n                    description: 'Always stays in dark appearance.',\r\n                },\r\n            },\r\n        },\r\n        language: {\r\n            title: 'Language',\r\n            description: 'Choose which language the interface uses.',\r\n            legend: 'Preferred language',\r\n            options: {\r\n                system: {\r\n                    label: 'System',\r\n                    description: 'Automatically uses your system language.',\r\n                },\r\n                de: {\r\n                    label: 'German',\r\n                    description: 'Always display content in German.',\r\n                },\r\n                en: {\r\n                    label: 'English',\r\n                    description: 'Always display content in English.',\r\n                },\r\n            },\r\n        },\r\n    },\r\n    projectsPage: {\r\n        title: 'My GitHub projects',\r\n        empty: 'No public repositories found.',\r\n        repoUnnamed: 'Untitled repository',\r\n        noDescription: 'No description available.',\r\n        error: 'Repositories could not be loaded. Please try again later.',\r\n    },\r\n    preview: {\r\n        noImage: 'No image selected',\r\n        zoomIn: 'Zoom in',\r\n        zoomOut: 'Zoom out',\r\n        next: 'Next image',\r\n        prev: 'Previous image',\r\n        dragDrop: 'Drag image here',\r\n        contextMenu: 'Context menu',\r\n    },\r\n};\r\n", "/**\r\n * i18n.ts - Internationalization System\r\n *\r\n * Central translation system - TypeScript implementation.\r\n * Single Source of Truth for all translations in the portfolio.\r\n *\r\n * Translation data is organized in separate language files (de.ts, en.ts)\r\n * to keep this file focused on logic and type definitions.\r\n *\r\n * @module i18n\r\n */\r\n\r\n// ========================================\r\n// Imports\r\n// ========================================\r\n\r\nimport { de } from '../i18n/de';\r\nimport { en } from '../i18n/en';\r\n\r\n// ========================================\r\n// Type Definitions\r\n// ========================================\r\n\r\nexport type LanguageCode = 'de' | 'en';\r\nexport type LanguagePreference = 'system' | LanguageCode;\r\n\r\nexport interface TranslationParams {\r\n    [key: string]: string | number;\r\n}\r\n\r\nexport interface TranslateOptions {\r\n    language?: LanguageCode;\r\n    fallback?: string;\r\n}\r\n\r\ntype TranslationValue = string | TranslationDict;\r\n\r\ninterface TranslationDict {\r\n    [key: string]: TranslationValue;\r\n}\r\n\r\nexport interface AppI18n {\r\n    translate: (key: string, params?: TranslationParams, options?: TranslateOptions) => string;\r\n    applyTranslations: (root?: Document | Element) => void;\r\n    setLanguagePreference: (pref: LanguagePreference) => LanguageCode;\r\n    getLanguagePreference: () => LanguagePreference;\r\n    getActiveLanguage: () => LanguageCode;\r\n    translations: Record<LanguageCode, TranslationDict>;\r\n    supportedLanguages: readonly LanguageCode[];\r\n    languageOptions: readonly LanguagePreference[];\r\n}\r\n\r\ndeclare global {\r\n    interface Window {\r\n        appI18n: AppI18nAPI;\r\n    }\r\n}\r\n\r\n// ========================================\r\n// Constants\r\n// ========================================\r\n\r\nconst LANGUAGE_PREFERENCE_KEY = 'languagePreference';\r\nconst SUPPORTED_LANGUAGES: readonly LanguageCode[] = ['de', 'en'] as const;\r\nconst LANGUAGE_OPTIONS: readonly LanguagePreference[] = ['system', ...SUPPORTED_LANGUAGES] as const;\r\nconst FALLBACK_LANGUAGE: LanguageCode = 'en';\r\n\r\n// ========================================\r\n// Translation Database\r\n// ========================================\r\n\r\nconst translations: Record<LanguageCode, TranslationDict> = {\r\n    de,\r\n    en,\r\n};\r\n\r\n// ========================================\r\n// Language Detection & Management\r\n// ========================================\r\n\r\nfunction normalizeLanguage(input: unknown): LanguageCode | null {\r\n    if (!input) return null;\r\n    const value = String(input).trim().toLowerCase();\r\n    if (!value) return null;\r\n    const base = value.split(/[-_]/)[0] || '';\r\n    return (SUPPORTED_LANGUAGES as readonly string[]).includes(base)\r\n        ? (base as LanguageCode)\r\n        : null;\r\n}\r\n\r\nfunction parsePreference(value: unknown): LanguagePreference {\r\n    if (value === null || value === undefined) return 'system';\r\n    const normalized = String(value).trim();\r\n    return (LANGUAGE_OPTIONS as readonly string[]).includes(normalized)\r\n        ? (normalized as LanguagePreference)\r\n        : 'system';\r\n}\r\n\r\nfunction getBrowserLanguages(): string[] {\r\n    const langs: string[] = [];\r\n    if (Array.isArray(navigator.languages)) {\r\n        langs.push(...navigator.languages);\r\n    }\r\n    if (navigator.language) {\r\n        langs.push(navigator.language);\r\n    }\r\n    // Legacy IE support\r\n    const navWithUserLang = navigator as { userLanguage?: string };\r\n    if (navWithUserLang.userLanguage) {\r\n        langs.push(navWithUserLang.userLanguage);\r\n    }\r\n    return langs.length ? langs : ['en'];\r\n}\r\n\r\nfunction detectSystemLanguage(): LanguageCode {\r\n    const candidates = getBrowserLanguages();\r\n    for (const candidate of candidates) {\r\n        const normalized = normalizeLanguage(candidate);\r\n        if (normalized) {\r\n            return normalized;\r\n        }\r\n    }\r\n    return FALLBACK_LANGUAGE;\r\n}\r\n\r\n// ========================================\r\n// State Management\r\n// ========================================\r\n\r\nlet languagePreference: LanguagePreference = parsePreference(\r\n    typeof localStorage !== 'undefined' ? localStorage.getItem(LANGUAGE_PREFERENCE_KEY) : null\r\n);\r\n\r\nfunction resolveActiveLanguage(pref: LanguagePreference): LanguageCode {\r\n    if (pref === 'system') {\r\n        return detectSystemLanguage();\r\n    }\r\n    return (SUPPORTED_LANGUAGES as readonly string[]).includes(pref)\r\n        ? (pref as LanguageCode)\r\n        : FALLBACK_LANGUAGE;\r\n}\r\n\r\nlet activeLanguage: LanguageCode = resolveActiveLanguage(languagePreference);\r\n\r\nfunction setDocumentLanguage(lang: LanguageCode): void {\r\n    if (typeof document !== 'undefined' && document.documentElement) {\r\n        document.documentElement.lang = lang;\r\n    }\r\n}\r\n\r\n// ========================================\r\n// Translation Functions\r\n// ========================================\r\n\r\nfunction formatTemplate(template: string, params?: TranslationParams): string {\r\n    if (typeof template !== 'string') {\r\n        return template;\r\n    }\r\n    if (!params || typeof params !== 'object') {\r\n        return template;\r\n    }\r\n    return template.replace(/\\{([^}]+)\\}/g, (match, token) => {\r\n        const key = token.trim();\r\n        return Object.prototype.hasOwnProperty.call(params, key) ? String(params[key]) : match;\r\n    });\r\n}\r\n\r\nfunction resolveKey(lang: LanguageCode, key: string): unknown {\r\n    const segments = key.split('.');\r\n    let current: unknown = translations[lang];\r\n    for (const segment of segments) {\r\n        if (!current || typeof current !== 'object' || !(segment in current)) {\r\n            return undefined;\r\n        }\r\n        current = (current as Record<string, unknown>)[segment];\r\n    }\r\n    return current;\r\n}\r\n\r\nexport function translate(\r\n    key: string,\r\n    params: TranslationParams = {},\r\n    options: TranslateOptions = {}\r\n): string {\r\n    if (!key) return '';\r\n    const lang = options.language || activeLanguage;\r\n    let value = resolveKey(lang, key);\r\n    if (value === undefined && lang !== FALLBACK_LANGUAGE) {\r\n        value = resolveKey(FALLBACK_LANGUAGE, key);\r\n    }\r\n    if (value === undefined) {\r\n        return options.fallback !== undefined ? options.fallback : key;\r\n    }\r\n    if (typeof value === 'string') {\r\n        return formatTemplate(value, params);\r\n    }\r\n    return String(value);\r\n}\r\n\r\n// ========================================\r\n// DOM Translation\r\n// ========================================\r\n\r\nfunction parseParams(element: Element): TranslationParams | undefined {\r\n    const paramsAttr = element.getAttribute('data-i18n-params');\r\n    if (!paramsAttr) {\r\n        return undefined;\r\n    }\r\n    try {\r\n        return JSON.parse(paramsAttr) as TranslationParams;\r\n    } catch (err) {\r\n        console.warn('Could not parse data-i18n-params:', err);\r\n        return undefined;\r\n    }\r\n}\r\n\r\nfunction translateElement(element: Element): void {\r\n    if (!(element instanceof Element)) {\r\n        return;\r\n    }\r\n    const params = parseParams(element) || {};\r\n    const textKey = element.getAttribute('data-i18n');\r\n    if (textKey) {\r\n        element.textContent = translate(textKey, params);\r\n    }\r\n    const htmlKey = element.getAttribute('data-i18n-html');\r\n    if (htmlKey) {\r\n        element.innerHTML = translate(htmlKey, params);\r\n    }\r\n    Array.from(element.attributes).forEach(attr => {\r\n        if (!attr.name.startsWith('data-i18n-')) return;\r\n        if (attr.name === 'data-i18n' || attr.name === 'data-i18n-html') return;\r\n        const targetAttr = attr.name.substring('data-i18n-'.length);\r\n        if (!targetAttr) return;\r\n        element.setAttribute(targetAttr, translate(attr.value, params));\r\n    });\r\n}\r\n\r\nexport function applyTranslations(root: Document | Element = document): void {\r\n    if (!root) return;\r\n    const base = root === document ? document.documentElement : root;\r\n    if (!base || !(base instanceof Element)) return;\r\n    translateElement(base);\r\n    const elements = base.querySelectorAll('*');\r\n    elements.forEach(translateElement);\r\n}\r\n\r\n// ========================================\r\n// Language Change Management\r\n// ========================================\r\n\r\nfunction dispatchLanguageEvent(): void {\r\n    if (typeof window === 'undefined') return;\r\n    const event = new CustomEvent('languagePreferenceChange', {\r\n        detail: {\r\n            preference: languagePreference,\r\n            language: activeLanguage,\r\n        },\r\n    });\r\n    window.dispatchEvent(event);\r\n}\r\n\r\nfunction refreshActiveLanguage(emitEvent = true): void {\r\n    const nextLanguage = resolveActiveLanguage(languagePreference);\r\n    const languageChanged = nextLanguage !== activeLanguage;\r\n    activeLanguage = nextLanguage;\r\n    setDocumentLanguage(activeLanguage);\r\n    applyTranslations(document);\r\n    if (emitEvent || languageChanged) {\r\n        dispatchLanguageEvent();\r\n    }\r\n}\r\n\r\nexport function setLanguagePreference(pref: LanguagePreference): LanguageCode {\r\n    const normalized = parsePreference(pref);\r\n    if (normalized === languagePreference) {\r\n        refreshActiveLanguage(true);\r\n        return activeLanguage;\r\n    }\r\n    languagePreference = normalized;\r\n    if (typeof localStorage !== 'undefined') {\r\n        if (normalized === 'system') {\r\n            localStorage.setItem(LANGUAGE_PREFERENCE_KEY, 'system');\r\n        } else {\r\n            localStorage.setItem(LANGUAGE_PREFERENCE_KEY, normalized);\r\n        }\r\n    }\r\n    refreshActiveLanguage(true);\r\n    return activeLanguage;\r\n}\r\n\r\nexport function getLanguagePreference(): LanguagePreference {\r\n    return languagePreference;\r\n}\r\n\r\nexport function getActiveLanguage(): LanguageCode {\r\n    return activeLanguage;\r\n}\r\n\r\n// ========================================\r\n// Browser Event Listeners\r\n// ========================================\r\n\r\nif (typeof window !== 'undefined') {\r\n    window.addEventListener('languagechange', () => {\r\n        if (languagePreference === 'system') {\r\n            refreshActiveLanguage(true);\r\n        }\r\n    });\r\n\r\n    window.addEventListener('storage', (event: StorageEvent) => {\r\n        if (event.key !== LANGUAGE_PREFERENCE_KEY) {\r\n            return;\r\n        }\r\n        const newPreference = parsePreference(event.newValue);\r\n        languagePreference = newPreference;\r\n        refreshActiveLanguage(true);\r\n    });\r\n}\r\n\r\n// ========================================\r\n// Initialization\r\n// ========================================\r\n\r\nif (typeof document !== 'undefined') {\r\n    setDocumentLanguage(activeLanguage);\r\n\r\n    if (document.readyState === 'loading') {\r\n        document.addEventListener('DOMContentLoaded', () => applyTranslations(document));\r\n    } else {\r\n        applyTranslations(document);\r\n    }\r\n}\r\n\r\n// ========================================\r\n// Global API Export\r\n// ========================================\r\n\r\nexport const appI18n: AppI18n = {\r\n    translate,\r\n    applyTranslations,\r\n    setLanguagePreference,\r\n    getLanguagePreference,\r\n    getActiveLanguage,\r\n    translations,\r\n    supportedLanguages: SUPPORTED_LANGUAGES,\r\n    languageOptions: LANGUAGE_OPTIONS,\r\n};\r\n\r\n// Expose to global window object\r\nif (typeof window !== 'undefined') {\r\n    window.appI18n = appI18n;\r\n}\r\n", "/**\r\n * DOM Utility Functions\r\n * Centralized helpers for common DOM manipulations\r\n *\r\n * @module dom-utils\r\n */\r\n\r\n/**\r\n * Show an element by removing the 'hidden' class\r\n * @param element - The element to show (null-safe)\r\n */\r\nexport function show(element: HTMLElement | null): void {\r\n    if (!element) return;\r\n    element.classList.remove('hidden');\r\n}\r\n\r\n/**\r\n * Hide an element by adding the 'hidden' class\r\n * @param element - The element to hide (null-safe)\r\n */\r\nexport function hide(element: HTMLElement | null): void {\r\n    if (!element) return;\r\n    element.classList.add('hidden');\r\n}\r\n\r\n/**\r\n * Toggle element visibility\r\n * @param element - The element to toggle (null-safe)\r\n * @param visible - Optional boolean to force visible (true) or hidden (false)\r\n */\r\nexport function toggle(element: HTMLElement | null, visible?: boolean): void {\r\n    if (!element) return;\r\n    if (visible === undefined) {\r\n        element.classList.toggle('hidden');\r\n    } else {\r\n        element.classList.toggle('hidden', !visible);\r\n    }\r\n}\r\n\r\n/**\r\n * Check if an element is currently visible\r\n * @param element - The element to check (null-safe)\r\n * @returns true if element exists and does not have 'hidden' class\r\n */\r\nexport function isVisible(element: HTMLElement | null): boolean {\r\n    if (!element) return false;\r\n    return !element.classList.contains('hidden');\r\n}\r\n\r\n/**\r\n * Set element visibility explicitly\r\n * @param element - The element to update (null-safe)\r\n * @param visible - true to show, false to hide\r\n */\r\nexport function setVisibility(element: HTMLElement | null, visible: boolean): void {\r\n    if (!element) return;\r\n    element.classList.toggle('hidden', !visible);\r\n}\r\n\r\n/**\r\n * Show multiple elements at once\r\n * @param elements - Array of elements to show\r\n */\r\nexport function showAll(elements: (HTMLElement | null)[]): void {\r\n    elements.forEach(show);\r\n}\r\n\r\n/**\r\n * Hide multiple elements at once\r\n * @param elements - Array of elements to hide\r\n */\r\nexport function hideAll(elements: (HTMLElement | null)[]): void {\r\n    elements.forEach(hide);\r\n}\r\n\r\n/**\r\n * Get element by ID with type safety\r\n * @param id - Element ID\r\n * @returns The element or null if not found\r\n */\r\nexport function getById(id: string): HTMLElement | null {\r\n    return document.getElementById(id);\r\n}\r\n\r\n/**\r\n * Query selector with type assertion\r\n * @param selector - CSS selector\r\n * @param parent - Optional parent element (defaults to document)\r\n * @returns The first matching element or null\r\n */\r\nexport function query<T extends HTMLElement = HTMLElement>(\r\n    selector: string,\r\n    parent: ParentNode = document\r\n): T | null {\r\n    return parent.querySelector<T>(selector);\r\n}\r\n\r\n/**\r\n * Query selector all with type assertion\r\n * @param selector - CSS selector\r\n * @param parent - Optional parent element (defaults to document)\r\n * @returns NodeList of matching elements\r\n */\r\nexport function queryAll<T extends HTMLElement = HTMLElement>(\r\n    selector: string,\r\n    parent: ParentNode = document\r\n): NodeListOf<T> {\r\n    return parent.querySelectorAll<T>(selector);\r\n}\r\n\r\n// Attach to window for compatibility with legacy code\r\nif (typeof window !== 'undefined') {\r\n    (window as Window & { DOMUtils?: typeof import('./dom-utils') }).DOMUtils = {\r\n        show,\r\n        hide,\r\n        toggle,\r\n        isVisible,\r\n        setVisibility,\r\n        showAll,\r\n        hideAll,\r\n        getById,\r\n        query,\r\n        queryAll,\r\n    };\r\n}\r\n\r\nconsole.log('\u2705 DOMUtils loaded');\r\n\r\n", "/**\r\n * src/ts/constants.ts\r\n * Typed constants for the macOS-style portfolio site.\r\n *\r\n * This file is a migration target for the legacy `js/constants.js`.\r\n */\r\n\r\nexport interface AppConstants {\r\n    THEME_PREFERENCE_KEY: string;\r\n    VALID_THEME_PREFERENCES: string[];\r\n    FINDER_STATE_STORAGE_KEY: string;\r\n    OPEN_WINDOWS_KEY: string;\r\n    WINDOW_POSITIONS_KEY: string;\r\n    MODAL_IDS: string[];\r\n    TRANSIENT_MODAL_IDS: Set<string>;\r\n    BASE_Z_INDEX: number;\r\n    MENUBAR_Z_INDEX: number;\r\n    DOCK_Z_INDEX: number;\r\n    MIN_WINDOW_WIDTH: number;\r\n    MIN_WINDOW_HEIGHT: number;\r\n    DEFAULT_WINDOW_WIDTH: number;\r\n    DEFAULT_WINDOW_HEIGHT: number;\r\n    DOCK_MIN_HEIGHT: number;\r\n    DOCK_MAX_HEIGHT: number;\r\n    DOCK_MAGNIFICATION_SCALE: number;\r\n    DOCK_MAGNIFICATION_RANGE: number;\r\n    DESKTOP_ICON_SIZE: number;\r\n    DESKTOP_ICON_SPACING: number;\r\n    RUBBERBAND_MIN_DISTANCE: number;\r\n    WINDOW_ANIMATION_DURATION: number;\r\n    DOCK_ANIMATION_DURATION: number;\r\n    MENU_ANIMATION_DURATION: number;\r\n    GITHUB_CACHE_DURATION: number;\r\n    GITHUB_API_BASE: string;\r\n    SNAP_THRESHOLD: number;\r\n    SNAP_SIDES: string[];\r\n}\r\n\r\nexport const THEME_PREFERENCE_KEY = 'themePreference';\r\nexport const VALID_THEME_PREFERENCES = ['system', 'light', 'dark'];\r\n\r\nexport const FINDER_STATE_STORAGE_KEY = 'finderState';\r\nexport const OPEN_WINDOWS_KEY = 'openWindows';\r\nexport const WINDOW_POSITIONS_KEY = 'windowPositions';\r\n\r\nexport const MODAL_IDS = [\r\n    'projects-modal',\r\n    'about-modal',\r\n    'settings-modal',\r\n    'text-modal',\r\n    'terminal-modal',\r\n    'image-modal',\r\n    'program-info-modal',\r\n];\r\n\r\nexport const TRANSIENT_MODAL_IDS = new Set<string>(['program-info-modal']);\r\n\r\nexport const BASE_Z_INDEX = 1000;\r\nexport const MENUBAR_Z_INDEX = 10000;\r\nexport const DOCK_Z_INDEX = 10000;\r\n\r\nexport const MIN_WINDOW_WIDTH = 240;\r\nexport const MIN_WINDOW_HEIGHT = 160;\r\nexport const DEFAULT_WINDOW_WIDTH = 600;\r\nexport const DEFAULT_WINDOW_HEIGHT = 400;\r\n\r\nexport const DOCK_MIN_HEIGHT = 48;\r\nexport const DOCK_MAX_HEIGHT = 96;\r\nexport const DOCK_MAGNIFICATION_SCALE = 1.5;\r\nexport const DOCK_MAGNIFICATION_RANGE = 100; // px\r\n\r\nexport const DESKTOP_ICON_SIZE = 64;\r\nexport const DESKTOP_ICON_SPACING = 24;\r\nexport const RUBBERBAND_MIN_DISTANCE = 10; // px\r\n\r\nexport const WINDOW_ANIMATION_DURATION = 200; // ms\r\nexport const DOCK_ANIMATION_DURATION = 150; // ms\r\nexport const MENU_ANIMATION_DURATION = 100; // ms\r\n\r\nexport const GITHUB_CACHE_DURATION = 5 * 60 * 1000; // 5 minutes in ms\r\nexport const GITHUB_API_BASE = 'https://api.github.com';\r\n\r\nexport const SNAP_THRESHOLD = 100; // px\r\nexport const SNAP_SIDES = ['left', 'right'];\r\n\r\nexport const APP_CONSTANTS: AppConstants = {\r\n    THEME_PREFERENCE_KEY,\r\n    VALID_THEME_PREFERENCES,\r\n    FINDER_STATE_STORAGE_KEY,\r\n    OPEN_WINDOWS_KEY,\r\n    WINDOW_POSITIONS_KEY,\r\n    MODAL_IDS,\r\n    TRANSIENT_MODAL_IDS,\r\n    BASE_Z_INDEX,\r\n    MENUBAR_Z_INDEX,\r\n    DOCK_Z_INDEX,\r\n    MIN_WINDOW_WIDTH,\r\n    MIN_WINDOW_HEIGHT,\r\n    DEFAULT_WINDOW_WIDTH,\r\n    DEFAULT_WINDOW_HEIGHT,\r\n    DOCK_MIN_HEIGHT,\r\n    DOCK_MAX_HEIGHT,\r\n    DOCK_MAGNIFICATION_SCALE,\r\n    DOCK_MAGNIFICATION_RANGE,\r\n    DESKTOP_ICON_SIZE,\r\n    DESKTOP_ICON_SPACING,\r\n    RUBBERBAND_MIN_DISTANCE,\r\n    WINDOW_ANIMATION_DURATION,\r\n    DOCK_ANIMATION_DURATION,\r\n    MENU_ANIMATION_DURATION,\r\n    GITHUB_CACHE_DURATION,\r\n    GITHUB_API_BASE,\r\n    SNAP_THRESHOLD,\r\n    SNAP_SIDES,\r\n};\r\n\r\n// Attach to window for legacy JS compatibility\r\ndeclare global {\r\n    interface Window {\r\n        APP_CONSTANTS?: AppConstants;\r\n    }\r\n}\r\n\r\nif (typeof window !== 'undefined') {\r\n    window.APP_CONSTANTS = APP_CONSTANTS;\r\n}\r\n\r\nexport default APP_CONSTANTS;\r\n", "/**\r\n * src/ts/logger.ts\r\n * Typed port of the legacy `js/logger.js`.\r\n */\r\n\r\nexport type LogLevelName = 'ERROR' | 'WARN' | 'INFO' | 'DEBUG' | 'TRACE';\r\n\r\nconst LOG_LEVELS: Record<LogLevelName, number> = {\r\n    ERROR: 0,\r\n    WARN: 1,\r\n    INFO: 2,\r\n    DEBUG: 3,\r\n    TRACE: 4,\r\n};\r\n\r\nconst LOG_COLORS: Record<LogLevelName, string> = {\r\n    ERROR: '#ff0000',\r\n    WARN: '#ff9800',\r\n    INFO: '#2196f3',\r\n    DEBUG: '#9c27b0',\r\n    TRACE: '#607d8b',\r\n};\r\n\r\nexport class Logger {\r\n    level: number;\r\n    enabledCategories: Set<string>;\r\n    format: 'compact' | 'detailed';\r\n\r\n    constructor() {\r\n        this.level = this.isDevelopment() ? LOG_LEVELS.TRACE : LOG_LEVELS.WARN;\r\n        this.enabledCategories = new Set(['*']);\r\n        this.format = 'compact';\r\n    }\r\n\r\n    isDevelopment(): boolean {\r\n        try {\r\n            return (\r\n                location.hostname === 'localhost' ||\r\n                location.hostname === '127.0.0.1' ||\r\n                location.port !== ''\r\n            );\r\n        } catch {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    setLevel(level: LogLevelName | number) {\r\n        if (typeof level === 'string') {\r\n            this.level = LOG_LEVELS[level.toUpperCase() as LogLevelName] ?? LOG_LEVELS.INFO;\r\n        } else {\r\n            this.level = level;\r\n        }\r\n    }\r\n\r\n    enableCategory(category: string) {\r\n        if (category === '*') {\r\n            this.enabledCategories.clear();\r\n            this.enabledCategories.add('*');\r\n        } else {\r\n            this.enabledCategories.add(category);\r\n        }\r\n    }\r\n\r\n    disableCategory(category: string) {\r\n        this.enabledCategories.delete(category);\r\n    }\r\n\r\n    isCategoryEnabled(category: string) {\r\n        return this.enabledCategories.has('*') || this.enabledCategories.has(category);\r\n    }\r\n\r\n    private _log(level: LogLevelName, category: string, message?: unknown, ...args: unknown[]) {\r\n        if (LOG_LEVELS[level] > this.level) return;\r\n        if (!this.isCategoryEnabled(category)) return;\r\n\r\n        const color = LOG_COLORS[level];\r\n        const timestamp = new Date().toLocaleTimeString();\r\n\r\n        if (this.format === 'detailed') {\r\n            console.log(\r\n                `%c[${timestamp}] [${level}] [${category}]`,\r\n                `color: ${color}; font-weight: bold`,\r\n                message,\r\n                ...args\r\n            );\r\n        } else {\r\n            console.log(`%c[${category}]`, `color: ${color}`, message, ...args);\r\n        }\r\n    }\r\n\r\n    error(category: string, message?: unknown, ...args: unknown[]) {\r\n        this._log('ERROR', category, message, ...args);\r\n    }\r\n\r\n    warn(category: string, message?: unknown, ...args: unknown[]) {\r\n        this._log('WARN', category, message, ...args);\r\n    }\r\n\r\n    info(category: string, message?: unknown, ...args: unknown[]) {\r\n        this._log('INFO', category, message, ...args);\r\n    }\r\n\r\n    debug(category: string, message?: unknown, ...args: unknown[]) {\r\n        this._log('DEBUG', category, message, ...args);\r\n    }\r\n\r\n    trace(category: string, message?: unknown, ...args: unknown[]) {\r\n        this._log('TRACE', category, message, ...args);\r\n    }\r\n\r\n    group(category: string, title?: string) {\r\n        if (!this.isCategoryEnabled(category)) return;\r\n        console.group(title ?? category);\r\n    }\r\n\r\n    groupEnd() {\r\n        console.groupEnd();\r\n    }\r\n\r\n    time(label: string) {\r\n        console.time(label);\r\n    }\r\n\r\n    timeEnd(label: string) {\r\n        console.timeEnd(label);\r\n    }\r\n}\r\n\r\nconst logger = new Logger();\r\n\r\nexport default logger;\r\n\r\ndeclare global {\r\n    interface Window {\r\n        Logger?: Logger;\r\n    }\r\n}\r\n\r\nif (typeof window !== 'undefined') {\r\n    window.Logger = logger;\r\n}\r\n\r\n// For CommonJS compatibility\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ndeclare const module: any;\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = logger;\r\n}\r\n", "/**\r\n * src/ts/storage-utils.ts\r\n * Small, safe helpers around localStorage with JSON handling.\r\n */\r\n\r\nexport function getString(key: string): string | null {\r\n    try {\r\n        return localStorage.getItem(key);\r\n    } catch {\r\n        return null;\r\n    }\r\n}\r\n\r\nexport function setString(key: string, value: string): void {\r\n    try {\r\n        localStorage.setItem(key, value);\r\n    } catch (err) {\r\n        console.warn(`[storage-utils] setString failed for key=\"${key}\":`, err);\r\n    }\r\n}\r\n\r\nexport function remove(key: string): void {\r\n    try {\r\n        localStorage.removeItem(key);\r\n    } catch (err) {\r\n        console.warn(`[storage-utils] remove failed for key=\"${key}\":`, err);\r\n    }\r\n}\r\n\r\nexport function getJSON<T>(key: string, fallback: T): T {\r\n    try {\r\n        const raw = localStorage.getItem(key);\r\n        if (!raw) return fallback;\r\n        return JSON.parse(raw) as T;\r\n    } catch (err) {\r\n        console.warn(`[storage-utils] getJSON failed for key=\"${key}\":`, err);\r\n        return fallback;\r\n    }\r\n}\r\n\r\nexport function setJSON(key: string, value: unknown): void {\r\n    try {\r\n        localStorage.setItem(key, JSON.stringify(value));\r\n    } catch (err) {\r\n        console.warn(`[storage-utils] setJSON failed for key=\"${key}\":`, err);\r\n    }\r\n}\r\n", "/**\r\n * error-handler.ts\r\n * Global error handler with logging and export capabilities\r\n */\r\n\r\nimport { getJSON, setJSON } from '../services/storage-utils.js';\r\n\r\nconsole.log('ErrorHandler loaded');\r\n\r\n(() => {\r\n    'use strict';\r\n\r\n    const STORAGE_KEY = 'app.errorLogs';\r\n    const MAX_LOGS = 100;\r\n\r\n    // ===== Types =====\r\n\r\n    interface PlainError {\r\n        name: string;\r\n        message: string;\r\n        stack?: string;\r\n    }\r\n\r\n    interface ErrorLogEntry {\r\n        type: 'error' | 'unhandledrejection';\r\n        time: string;\r\n        message?: string;\r\n        source?: string;\r\n        line?: number | null;\r\n        column?: number | null;\r\n        reason?: string;\r\n        error: PlainError;\r\n    }\r\n\r\n    interface ErrorHandlerInstance {\r\n        enabled: boolean;\r\n        enable(): void;\r\n        disable(): void;\r\n        getLogs(): ErrorLogEntry[];\r\n        clearLogs(): void;\r\n        exportLogs(): void;\r\n        _record(entry: ErrorLogEntry): void;\r\n    }\r\n\r\n    // ===== Helper Functions =====\r\n\r\n    function nowISO(): string {\r\n        try {\r\n            return new Date().toISOString();\r\n        } catch (_e) {\r\n            void _e;\r\n            return String(Date.now());\r\n        }\r\n    }\r\n\r\n    function safeStringify(obj: unknown): string {\r\n        try {\r\n            return JSON.stringify(obj);\r\n        } catch (_e) {\r\n            void _e;\r\n            return String(obj);\r\n        }\r\n    }\r\n\r\n    function readLogs(): ErrorLogEntry[] {\r\n        try {\r\n            return getJSON<ErrorLogEntry[]>(STORAGE_KEY, []);\r\n        } catch (_e) {\r\n            void _e;\r\n            return [];\r\n        }\r\n    }\r\n\r\n    function writeLogs(logs: ErrorLogEntry[]): void {\r\n        try {\r\n            setJSON(STORAGE_KEY, logs.slice(-MAX_LOGS));\r\n        } catch (_e) {\r\n            void _e;\r\n            // ignore storage errors (quota, private mode, etc.)\r\n        }\r\n    }\r\n\r\n    function toPlainError(err: unknown): PlainError {\r\n        if (!err) return { name: 'Error', message: 'Unknown error' };\r\n        const error = err as Partial<Error>;\r\n        const plain: PlainError = {\r\n            name: error.name || 'Error',\r\n            message: error.message || String(err),\r\n            stack: error.stack,\r\n        };\r\n        return plain;\r\n    }\r\n\r\n    // ===== ErrorHandler Instance =====\r\n\r\n    const ErrorHandler: ErrorHandlerInstance = {\r\n        enabled: true,\r\n\r\n        enable() {\r\n            if (this.enabled) return;\r\n            this.enabled = true;\r\n        },\r\n\r\n        disable() {\r\n            if (!this.enabled) return;\r\n            this.enabled = false;\r\n        },\r\n\r\n        getLogs() {\r\n            return readLogs();\r\n        },\r\n\r\n        clearLogs() {\r\n            writeLogs([]);\r\n        },\r\n\r\n        exportLogs() {\r\n            try {\r\n                const logs = readLogs();\r\n                const blob = new Blob([safeStringify(logs)], { type: 'application/json' });\r\n                const url = URL.createObjectURL(blob);\r\n                const a = document.createElement('a');\r\n                a.href = url;\r\n                a.download = `error-logs-${Date.now()}.json`;\r\n                document.body.appendChild(a);\r\n                a.click();\r\n                document.body.removeChild(a);\r\n                URL.revokeObjectURL(url);\r\n            } catch (_e) {\r\n                void _e;\r\n                const logger = (window as typeof window & { Logger?: Console }).Logger || console;\r\n                logger.error('ErrorHandler', 'Failed to export logs');\r\n            }\r\n        },\r\n\r\n        _record(entry: ErrorLogEntry) {\r\n            const logs = readLogs();\r\n            logs.push(entry);\r\n            writeLogs(logs);\r\n        },\r\n    };\r\n\r\n    // ===== Error Handlers =====\r\n\r\n    function handleWindowError(\r\n        message: string | Event,\r\n        source?: string,\r\n        lineno?: number,\r\n        colno?: number,\r\n        error?: Error\r\n    ): boolean {\r\n        if (!ErrorHandler.enabled) return false;\r\n        const plain = toPlainError(error || { message });\r\n        const entry: ErrorLogEntry = {\r\n            type: 'error',\r\n            time: nowISO(),\r\n            message: String(message),\r\n            source: String(source || ''),\r\n            line: lineno || null,\r\n            column: colno || null,\r\n            error: plain,\r\n        };\r\n        const logger = (window as typeof window & { Logger?: Console }).Logger || console;\r\n        logger.error('ErrorHandler', 'Unhandled error', entry);\r\n        ErrorHandler._record(entry);\r\n        // Let the browser continue its default handling\r\n        return false;\r\n    }\r\n\r\n    function handleUnhandledRejection(event: PromiseRejectionEvent): void {\r\n        if (!ErrorHandler.enabled) return;\r\n        const reason = event?.reason;\r\n        const plain = toPlainError(\r\n            reason instanceof Error ? reason : { message: safeStringify(reason) }\r\n        );\r\n        const entry: ErrorLogEntry = {\r\n            type: 'unhandledrejection',\r\n            time: nowISO(),\r\n            reason: safeStringify(reason),\r\n            error: plain,\r\n        };\r\n        const logger = (window as typeof window & { Logger?: Console }).Logger || console;\r\n        logger.error('ErrorHandler', 'Unhandled promise rejection', entry);\r\n        ErrorHandler._record(entry);\r\n    }\r\n\r\n    // ===== Initialize =====\r\n\r\n    // Auto-enable in development; in production keep enabled to capture issues\r\n    ErrorHandler.enabled = true;\r\n\r\n    // Register global listeners\r\n    window.addEventListener('error', function (e: ErrorEvent) {\r\n        // Some browsers pass ErrorEvent, others invoke window.onerror\r\n        if (e?.error) {\r\n            handleWindowError(e.message, e.filename, e.lineno, e.colno, e.error);\r\n        }\r\n    });\r\n    window.onerror = handleWindowError;\r\n    window.addEventListener('unhandledrejection', handleUnhandledRejection);\r\n\r\n    // ===== Global Export =====\r\n\r\n    if (typeof window !== 'undefined') {\r\n        (window as typeof window & { ErrorHandler: ErrorHandlerInstance }).ErrorHandler =\r\n            ErrorHandler;\r\n    }\r\n})();\r\n\r\nexport {};\r\n", "/**\r\n * perf-monitor.ts\r\n * Performance monitoring and measurement utility for development\r\n */\r\n\r\nconsole.log('PerfMonitor loaded');\r\n\r\nimport { getString, setString } from '../services/storage-utils.js';\r\n\r\n(() => {\r\n    'use strict';\r\n\r\n    const STORAGE_KEY = 'app.perfMonitor.enabled';\r\n\r\n    // ===== Types =====\r\n\r\n    interface ReportOptions {\r\n        clear?: boolean;\r\n        topN?: number;\r\n    }\r\n\r\n    interface PerfMonitorInstance {\r\n        enabled: boolean;\r\n        marks: Set<string>;\r\n        enable(): void;\r\n        disable(): void;\r\n        toggle(): void;\r\n        mark(name: string): void;\r\n        measure(name: string, startMark?: string, endMark?: string): PerformanceMeasure | null;\r\n        report(options?: ReportOptions): PerformanceMeasure[];\r\n    }\r\n\r\n    // ===== Helper Functions =====\r\n\r\n    function isEnabledByDefault(): boolean {\r\n        try {\r\n            // Enable in development environments by default\r\n            const isDev =\r\n                location.hostname === 'localhost' ||\r\n                location.hostname === '127.0.0.1' ||\r\n                location.port !== '';\r\n            const flag = localStorage.getItem(STORAGE_KEY);\r\n            if (flag === 'true') return true;\r\n            if (flag === 'false') return false;\r\n            return isDev;\r\n        } catch (_e) {\r\n            void _e;\r\n            return false;\r\n        }\r\n    }\r\n\r\n    // ===== PerfMonitor Instance =====\r\n\r\n    const PerfMonitor: PerfMonitorInstance = {\r\n        enabled: isEnabledByDefault(),\r\n        marks: new Set<string>(),\r\n\r\n        enable() {\r\n            this.enabled = true;\r\n            try {\r\n                setString(STORAGE_KEY, 'true');\r\n            } catch (_e) {\r\n                void _e;\r\n            }\r\n            const logger = (window as typeof window & { Logger?: Console }).Logger || console;\r\n            logger.info('PerfMonitor', 'Enabled');\r\n        },\r\n\r\n        disable() {\r\n            this.enabled = false;\r\n            try {\r\n                setString(STORAGE_KEY, 'false');\r\n            } catch (_e) {\r\n                void _e;\r\n            }\r\n            const logger = (window as typeof window & { Logger?: Console }).Logger || console;\r\n            logger.info('PerfMonitor', 'Disabled');\r\n        },\r\n\r\n        toggle() {\r\n            if (this.enabled) {\r\n                this.disable();\r\n            } else {\r\n                this.enable();\r\n            }\r\n        },\r\n\r\n        mark(name: string) {\r\n            if (!this.enabled || !name) return;\r\n            try {\r\n                performance.mark(name);\r\n                this.marks.add(name);\r\n            } catch (_e) {\r\n                void _e;\r\n            }\r\n        },\r\n\r\n        measure(name: string, startMark?: string, endMark?: string): PerformanceMeasure | null {\r\n            if (!this.enabled || !name) return null;\r\n            try {\r\n                if (startMark && endMark) {\r\n                    performance.measure(name, startMark, endMark);\r\n                } else if (startMark) {\r\n                    performance.measure(name, startMark);\r\n                } else {\r\n                    performance.measure(name);\r\n                }\r\n                const entries = performance.getEntriesByName(name, 'measure');\r\n                const lastEntry = entries[entries.length - 1];\r\n                return lastEntry ? (lastEntry as PerformanceMeasure) : null;\r\n            } catch (_e) {\r\n                void _e;\r\n                return null;\r\n            }\r\n        },\r\n\r\n        report(options?: ReportOptions): PerformanceMeasure[] {\r\n            if (!this.enabled) return [];\r\n            const { clear = false, topN = 10 } = options || {};\r\n            const measures = performance\r\n                .getEntriesByType('measure')\r\n                .slice()\r\n                .sort((a, b) => b.duration - a.duration)\r\n                .slice(0, topN) as PerformanceMeasure[];\r\n\r\n            if (measures.length) {\r\n                const logger = (window as typeof window & { Logger?: Console }).Logger || console;\r\n                logger.group('PerfMonitor report');\r\n                for (const m of measures) {\r\n                    logger.info('PerfMonitor', `${m.name}: ${m.duration.toFixed(2)}ms`);\r\n                }\r\n                logger.groupEnd();\r\n            }\r\n            if (clear) {\r\n                performance.clearMeasures();\r\n                try {\r\n                    for (const m of this.marks) performance.clearMarks(m);\r\n                } catch (_e) {\r\n                    void _e;\r\n                }\r\n                this.marks.clear();\r\n            }\r\n            return measures;\r\n        },\r\n    };\r\n\r\n    // ===== Auto Capture Lifecycle Timings =====\r\n\r\n    // Auto capture key lifecycle timings\r\n    if (PerfMonitor.enabled) {\r\n        try {\r\n            PerfMonitor.mark('app:js-start');\r\n            if (document.readyState === 'complete' || document.readyState === 'interactive') {\r\n                // DOM already parsed\r\n                PerfMonitor.mark('app:dom-ready');\r\n            } else {\r\n                document.addEventListener(\r\n                    'DOMContentLoaded',\r\n                    () => PerfMonitor.mark('app:dom-ready'),\r\n                    { once: true }\r\n                );\r\n            }\r\n            window.addEventListener(\r\n                'load',\r\n                () => {\r\n                    PerfMonitor.mark('app:window-load');\r\n                    PerfMonitor.measure('app:domready->load', 'app:dom-ready', 'app:window-load');\r\n                    PerfMonitor.measure('app:start->load', 'app:js-start', 'app:window-load');\r\n                    PerfMonitor.report({ topN: 5 });\r\n                },\r\n                { once: true }\r\n            );\r\n        } catch (_e) {\r\n            void _e;\r\n        }\r\n    }\r\n\r\n    // ===== Global Export =====\r\n\r\n    if (typeof window !== 'undefined') {\r\n        (window as typeof window & { PerfMonitor: PerfMonitorInstance }).PerfMonitor = PerfMonitor;\r\n    }\r\n})();\r\n\r\nexport {};\r\n", "console.log('API loaded');\r\n\r\n(function () {\r\n  'use strict';\r\n\r\n  type ModuleMethod = (...args: unknown[]) => unknown;\r\n\r\n  type ModuleProxy<T extends string[]> = {\r\n    [K in T[number]]: ModuleMethod;\r\n  };\r\n\r\n  // Helper to safely access window properties\r\n  function getWindowProp(propName: string): unknown {\r\n    return (window as unknown as Record<string, unknown>)[propName];\r\n  }\r\n\r\n  // Helper to call a method on a window property\r\n  function callWindowMethod(objName: string, methodName: string, ...args: unknown[]): unknown {\r\n    const obj = getWindowProp(objName);\r\n    if (obj && typeof (obj as Record<string, unknown>)[methodName] === 'function') {\r\n      return ((obj as Record<string, unknown>)[methodName] as ModuleMethod)(...args);\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  function createModuleProxy<T extends string[]>(\r\n    moduleName: string,\r\n    methods: T,\r\n  ): ModuleProxy<T> {\r\n    const proxy = {} as ModuleProxy<T>;\r\n\r\n    methods.forEach((method) => {\r\n      (proxy as Record<string, ModuleMethod>)[method] = function (...args: unknown[]): unknown {\r\n        const module = getWindowProp(moduleName);\r\n        if (module && typeof (module as Record<string, unknown>)[method] === 'function') {\r\n          return ((module as Record<string, unknown>)[method] as ModuleMethod)(...args);\r\n        }\r\n        console.warn(`${moduleName}.${method} ist nicht verf\u00FCgbar`);\r\n        return undefined;\r\n      };\r\n    });\r\n\r\n    return proxy;\r\n  }\r\n\r\n  const API = {\r\n    error: createModuleProxy('ErrorHandler', [\r\n      'enable',\r\n      'disable',\r\n      'getLogs',\r\n      'clearLogs',\r\n      'exportLogs',\r\n    ] as const),\r\n\r\n    performance: createModuleProxy('PerfMonitor', [\r\n      'enable',\r\n      'disable',\r\n      'toggle',\r\n      'mark',\r\n      'measure',\r\n      'report',\r\n    ] as const),\r\n\r\n    theme: createModuleProxy('ThemeSystem', [\r\n      'setThemePreference',\r\n      'getThemePreference',\r\n      'applyTheme',\r\n      'initTheme',\r\n    ] as const),\r\n\r\n    icon: createModuleProxy('IconSystem', [\r\n      'ensureSvgNamespace',\r\n      'getMenuIconSvg',\r\n      'renderIconIntoElement',\r\n    ] as const),\r\n\r\n    dock: createModuleProxy('DockSystem', [\r\n      'getDockReservedBottom',\r\n      'initDockMagnification',\r\n      'updateDockIndicators',\r\n    ] as const),\r\n\r\n    menu: createModuleProxy('MenuSystem', [\r\n      'renderApplicationMenu',\r\n      'handleMenuActionActivation',\r\n      'registerMenuAction',\r\n      'hideMenuDropdowns',\r\n      'toggleMenuDropdown',\r\n      'isAnyDropdownOpen',\r\n    ] as const),\r\n\r\n    desktop: createModuleProxy('DesktopSystem', [\r\n      'initDesktop',\r\n      'openDesktopItemById',\r\n    ] as const),\r\n\r\n    system: createModuleProxy('SystemUI', [\r\n      'initSystemStatusControls',\r\n      'updateAllSystemStatusUI',\r\n      'handleSystemToggle',\r\n      'setConnectedNetwork',\r\n      'setBluetoothDevice',\r\n      'setAudioDevice',\r\n    ] as const),\r\n\r\n    storage: createModuleProxy('StorageSystem', [\r\n      'readFinderState',\r\n      'writeFinderState',\r\n      'clearFinderState',\r\n      'saveOpenModals',\r\n      'restoreOpenModals',\r\n      'saveWindowPositions',\r\n      'restoreWindowPositions',\r\n      'resetWindowLayout',\r\n      'getDialogWindowElement',\r\n    ] as const),\r\n\r\n    finder: createModuleProxy('FinderSystem', ['init', 'openFinder', 'closeFinder'] as const),\r\n\r\n    textEditor: {\r\n      init: (container: unknown) => callWindowMethod('TextEditorSystem', 'init', container),\r\n      loadRemoteFile: (payload: unknown) => callWindowMethod('TextEditorSystem', 'loadRemoteFile', payload),\r\n      showLoading: (payload: unknown) => callWindowMethod('TextEditorSystem', 'showLoading', payload),\r\n      showLoadError: (payload: unknown) => callWindowMethod('TextEditorSystem', 'showLoadError', payload),\r\n      clearEditor: () => callWindowMethod('TextEditorSystem', 'clearEditor'),\r\n      saveFile: () => callWindowMethod('TextEditorSystem', 'saveFile'),\r\n      openFile: () => callWindowMethod('TextEditorSystem', 'openFile'),\r\n      handleMenuAction: (action: unknown) => callWindowMethod('TextEditorSystem', 'handleMenuAction', action),\r\n    },\r\n\r\n    settings: {\r\n      init: (container: unknown) => callWindowMethod('SettingsSystem', 'init', container),\r\n      showSection: (section: unknown) => callWindowMethod('SettingsSystem', 'showSection', section),\r\n      syncThemePreference: () => callWindowMethod('SettingsSystem', 'syncThemePreference'),\r\n      syncLanguagePreference: () => callWindowMethod('SettingsSystem', 'syncLanguagePreference'),\r\n    },\r\n\r\n    window: {\r\n      register: (config: unknown) => callWindowMethod('WindowManager', 'register', config),\r\n      registerAll: (configs: unknown) => callWindowMethod('WindowManager', 'registerAll', configs),\r\n      getConfig: (id: unknown) => callWindowMethod('WindowManager', 'getConfig', id),\r\n      open: (id: unknown) => callWindowMethod('WindowManager', 'open', id),\r\n      close: (id: unknown) => callWindowMethod('WindowManager', 'close', id),\r\n      bringToFront: (id: unknown) => callWindowMethod('WindowManager', 'bringToFront', id),\r\n      getTopWindow: () => callWindowMethod('WindowManager', 'getTopWindow'),\r\n      getProgramInfo: (id: unknown) => callWindowMethod('WindowManager', 'getProgramInfo', id),\r\n      getAllWindowIds: (): string[] => (callWindowMethod('WindowManager', 'getAllWindowIds') as string[]) || [],\r\n      getPersistentWindowIds: (): string[] =>\r\n        (callWindowMethod('WindowManager', 'getPersistentWindowIds') as string[]) || [],\r\n      getDialogInstance: (id: unknown) => callWindowMethod('WindowManager', 'getDialogInstance', id),\r\n      syncZIndexWithDOM: () => callWindowMethod('WindowManager', 'syncZIndexWithDOM'),\r\n    },\r\n\r\n    action: {\r\n      register: (name: unknown, handler: unknown) => callWindowMethod('ActionBus', 'register', name, handler),\r\n      registerAll: (actions: unknown) => callWindowMethod('ActionBus', 'registerAll', actions),\r\n      execute: (name: unknown, params: unknown, element: unknown) =>\r\n        callWindowMethod('ActionBus', 'execute', name, params, element),\r\n    },\r\n\r\n    i18n: {\r\n      translate: (key: string, fallback?: string): string => {\r\n        const appI18n = getWindowProp('appI18n');\r\n        if (appI18n && typeof (appI18n as Record<string, unknown>)['translate'] === 'function') {\r\n          const result = ((appI18n as Record<string, unknown>)['translate'] as (k: string) => string)(key);\r\n          return result === key && fallback ? fallback : result;\r\n        }\r\n        return fallback || key;\r\n      },\r\n      setLanguagePreference: (lang: unknown) => callWindowMethod('appI18n', 'setLanguagePreference', lang),\r\n      getLanguagePreference: (): string => (callWindowMethod('appI18n', 'getLanguagePreference') as string) || 'system',\r\n      getActiveLanguage: (): string => (callWindowMethod('appI18n', 'getActiveLanguage') as string) || 'en',\r\n      applyTranslations: () => callWindowMethod('appI18n', 'applyTranslations'),\r\n    },\r\n\r\n    session: createModuleProxy('SessionManager', [\r\n      'init',\r\n      'saveAll',\r\n      'saveInstanceType',\r\n      'restoreSession',\r\n      'clear',\r\n      'setDebounceDelay',\r\n      'getDebounceDelay',\r\n      'getStats',\r\n    ] as const),\r\n\r\n    helpers: {\r\n      getMenuBarBottom: (): number => {\r\n        const header = document.querySelector('body > header');\r\n        if (!header) return 0;\r\n        return header.getBoundingClientRect().bottom;\r\n      },\r\n\r\n      clampWindowToMenuBar: (target: unknown): unknown => {\r\n        const fn = getWindowProp('clampWindowToMenuBar');\r\n        if (typeof fn === 'function') {\r\n          return (fn as (t: unknown) => unknown)(target);\r\n        }\r\n        return undefined;\r\n      },\r\n\r\n      computeSnapMetrics: (side: unknown): unknown => {\r\n        const fn = getWindowProp('computeSnapMetrics');\r\n        if (typeof fn === 'function') {\r\n          return (fn as (s: unknown) => unknown)(side);\r\n        }\r\n        return undefined;\r\n      },\r\n\r\n      showSnapPreview: (side: unknown): void => {\r\n        const fn = getWindowProp('showSnapPreview');\r\n        if (typeof fn === 'function') {\r\n          (fn as (s: unknown) => void)(side);\r\n        }\r\n      },\r\n\r\n      hideSnapPreview: (): void => {\r\n        const fn = getWindowProp('hideSnapPreview');\r\n        if (typeof fn === 'function') {\r\n          (fn as () => void)();\r\n        }\r\n      },\r\n    },\r\n  } as const;\r\n\r\n  (window as unknown as { API: typeof API }).API = API;\r\n\r\n  // Legacy compatibility wrappers\r\n  const createLegacyWrapper = (apiPath: string): ((...args: unknown[]) => unknown) => {\r\n    return function (...args: unknown[]): unknown {\r\n      const parts = apiPath.split('.');\r\n      let fn: unknown = API;\r\n      for (const part of parts) {\r\n        fn = (fn as Record<string, unknown>)[part];\r\n        if (!fn) {\r\n          console.warn(`Legacy wrapper: ${apiPath} nicht gefunden`);\r\n          return undefined;\r\n        }\r\n      }\r\n      if (typeof fn === 'function') {\r\n        return (fn as (...a: unknown[]) => unknown)(...args);\r\n      }\r\n      return fn;\r\n    };\r\n  };\r\n\r\n  const w = window as unknown as Record<string, unknown>;\r\n\r\n  // Theme\r\n  w.setThemePreference = createLegacyWrapper('theme.setThemePreference');\r\n  w.getThemePreference = createLegacyWrapper('theme.getThemePreference');\r\n\r\n  // Icon\r\n  w.ensureSvgNamespace = createLegacyWrapper('icon.ensureSvgNamespace');\r\n  w.getMenuIconSvg = createLegacyWrapper('icon.getMenuIconSvg');\r\n  w.renderIconIntoElement = createLegacyWrapper('icon.renderIconIntoElement');\r\n\r\n  // Dock\r\n  w.getDockReservedBottom = createLegacyWrapper('dock.getDockReservedBottom');\r\n  w.initDockMagnification = createLegacyWrapper('dock.initDockMagnification');\r\n\r\n  // Menu\r\n  w.renderApplicationMenu = createLegacyWrapper('menu.renderApplicationMenu');\r\n  w.handleMenuActionActivation = createLegacyWrapper('menu.handleMenuActionActivation');\r\n\r\n  // Desktop\r\n  w.initDesktop = createLegacyWrapper('desktop.initDesktop');\r\n  w.openDesktopItemById = createLegacyWrapper('desktop.openDesktopItemById');\r\n\r\n  // System\r\n  w.initSystemStatusControls = createLegacyWrapper('system.initSystemStatusControls');\r\n  w.updateAllSystemStatusUI = createLegacyWrapper('system.updateAllSystemStatusUI');\r\n  w.handleSystemToggle = createLegacyWrapper('system.handleSystemToggle');\r\n  w.setConnectedNetwork = createLegacyWrapper('system.setConnectedNetwork');\r\n  w.setBluetoothDevice = createLegacyWrapper('system.setBluetoothDevice');\r\n  w.setAudioDevice = createLegacyWrapper('system.setAudioDevice');\r\n\r\n  // Storage\r\n  w.readFinderState = createLegacyWrapper('storage.readFinderState');\r\n  w.writeFinderState = createLegacyWrapper('storage.writeFinderState');\r\n  w.clearFinderState = createLegacyWrapper('storage.clearFinderState');\r\n  w.saveOpenModals = createLegacyWrapper('storage.saveOpenModals');\r\n  w.restoreOpenModals = createLegacyWrapper('storage.restoreOpenModals');\r\n  w.saveWindowPositions = createLegacyWrapper('storage.saveWindowPositions');\r\n  w.restoreWindowPositions = createLegacyWrapper('storage.restoreWindowPositions');\r\n  w.resetWindowLayout = createLegacyWrapper('storage.resetWindowLayout');\r\n})();\r\n", "/**\r\n * Centralized z-index and top-window manager shared across legacy modals and the\r\n * multi-window system. This is the single source of truth for stacking order.\r\n *\r\n * Responsibilities:\r\n * - Maintain an ordered window stack (bottom -> top)\r\n * - Assign clamped z-index values to DOM nodes\r\n * - Expose top-window lookup without duplicating logic in WindowManager/Registry\r\n * - Persist a compatible __zIndexManager on window for existing consumers/tests\r\n */\r\n\r\nexport interface ZIndexManager {\r\n    bringToFront(\r\n        windowId: string,\r\n        modal?: HTMLElement | null,\r\n        windowEl?: HTMLElement | null\r\n    ): number;\r\n    removeWindow(windowId: string): void;\r\n    getWindowStack(): string[];\r\n    restoreWindowStack(stack: string[]): void;\r\n    reset(): void;\r\n    getTopWindowId(): string | null;\r\n    getTopWindowElement(): HTMLElement | null;\r\n    getTopZIndex(): number;\r\n    bumpZIndex(): number;\r\n    ensureTopZIndex(z: number): number;\r\n    syncFromDOM(): number;\r\n}\r\n\r\nexport const BASE_Z_INDEX = 1000;\r\nconst MAX_WINDOW_Z_INDEX = 2147483500; // Below Dock (2147483550) and Launchpad (2147483600)\r\n\r\ntype MaybeZIndexManager = Partial<ZIndexManager> & { [key: string]: unknown };\r\n\r\ntype StackAware = {\r\n    windowStack: string[];\r\n    externalTopZ: number;\r\n};\r\n\r\nfunction clamp(z: number): number {\r\n    return Math.min(z, MAX_WINDOW_Z_INDEX);\r\n}\r\n\r\nfunction applyZIndex(\r\n    windowId: string,\r\n    zIndex: number,\r\n    modal?: HTMLElement | null,\r\n    windowEl?: HTMLElement | null\r\n): void {\r\n    const targets: Array<HTMLElement | null> = [];\r\n    if (modal) targets.push(modal);\r\n    if (windowEl && windowEl !== modal) targets.push(windowEl);\r\n\r\n    const element = modal || document.getElementById(windowId);\r\n    if (element && !targets.includes(element)) targets.push(element);\r\n    const autoPointer = element?.querySelector?.('.autopointer') as HTMLElement | null;\r\n    if (autoPointer && !targets.includes(autoPointer)) targets.push(autoPointer);\r\n    const contentEl = element?.querySelector?.('.window-container') as HTMLElement | null;\r\n    if (contentEl && !targets.includes(contentEl)) targets.push(contentEl);\r\n\r\n    targets.forEach(target => {\r\n        if (!target) return;\r\n        target.style.zIndex = zIndex.toString();\r\n    });\r\n}\r\n\r\nfunction pruneHiddenOrMissing(stack: string[]): string[] {\r\n    for (let i = stack.length - 1; i >= 0; i -= 1) {\r\n        const id = stack[i];\r\n        if (!id) {\r\n            stack.splice(i, 1);\r\n            continue;\r\n        }\r\n        const el = document.getElementById(id);\r\n        if (!el || el.classList.contains('hidden')) {\r\n            stack.splice(i, 1);\r\n        }\r\n    }\r\n    return stack;\r\n}\r\n\r\nfunction findTopVisibleModal(): HTMLElement | null {\r\n    let top: HTMLElement | null = null;\r\n    let highest = 0;\r\n    document.querySelectorAll<HTMLElement>('.modal:not(.hidden)').forEach(modal => {\r\n        const z = parseInt(getComputedStyle(modal).zIndex, 10) || 0;\r\n        if (z > highest) {\r\n            highest = z;\r\n            top = modal;\r\n        }\r\n    });\r\n    return top;\r\n}\r\n\r\nfunction getState(existing: MaybeZIndexManager | undefined): StackAware {\r\n    // If an older manager exists, reuse its stack to preserve ordering during hot reloads\r\n    const windowStack = existing?.getWindowStack?.() || [];\r\n    const externalTopZ = BASE_Z_INDEX;\r\n    return { windowStack: [...windowStack], externalTopZ };\r\n}\r\n\r\nexport function getZIndexManager(): ZIndexManager {\r\n    const win = window as unknown as {\r\n        __zIndexManager?: MaybeZIndexManager | ZIndexManager;\r\n        topZIndex?: number;\r\n        __topZIndexRaw?: number;\r\n    };\r\n    const existing = win.__zIndexManager as MaybeZIndexManager | undefined;\r\n    const initialTopZ = existing?.getTopZIndex?.() ?? BASE_Z_INDEX;\r\n    const topZStore = {\r\n        value: clamp(initialTopZ),\r\n    };\r\n    const setTopZStore = (v: number) => {\r\n        topZStore.value = clamp(v);\r\n        // Keep a raw copy without touching the window.topZIndex accessor to avoid recursion\r\n        (win as Record<string, unknown>).__topZIndexRaw = topZStore.value;\r\n    };\r\n    const getTopZStore = () => topZStore.value;\r\n\r\n    if (existing && typeof existing.bringToFront === 'function') {\r\n        // Ensure newer helpers exist on previously created managers\r\n        if (typeof existing.getTopWindowElement !== 'function') {\r\n            (existing as MaybeZIndexManager).getTopWindowElement = () => {\r\n                const topId = (existing as MaybeZIndexManager).getTopWindowId?.() || null;\r\n                return topId ? document.getElementById(topId) : findTopVisibleModal();\r\n            };\r\n        }\r\n        if (typeof existing.getTopWindowId !== 'function') {\r\n            (existing as MaybeZIndexManager).getTopWindowId = () => {\r\n                const stack = (existing as MaybeZIndexManager).getWindowStack?.() || [];\r\n                const pruned = pruneHiddenOrMissing([...stack]);\r\n                if (pruned.length > 0) return pruned[pruned.length - 1] ?? null;\r\n                const fallback = findTopVisibleModal();\r\n                return fallback ? fallback.id : null;\r\n            };\r\n        }\r\n        if (typeof existing.getTopZIndex !== 'function') {\r\n            (existing as MaybeZIndexManager).getTopZIndex = () => getTopZStore();\r\n        }\r\n        if (typeof existing.bumpZIndex !== 'function') {\r\n            (existing as MaybeZIndexManager).bumpZIndex = () => {\r\n                setTopZStore((getTopZStore() || BASE_Z_INDEX) + 1);\r\n                return getTopZStore();\r\n            };\r\n        }\r\n        if (typeof existing.ensureTopZIndex !== 'function') {\r\n            (existing as MaybeZIndexManager).ensureTopZIndex = (z: number) => {\r\n                setTopZStore(Math.max(getTopZStore(), z));\r\n                return getTopZStore();\r\n            };\r\n        }\r\n        if (typeof existing.syncFromDOM !== 'function') {\r\n            (existing as MaybeZIndexManager).syncFromDOM = () =>\r\n                existing.getTopZIndex?.() ?? BASE_Z_INDEX;\r\n        }\r\n        win.__zIndexManager = existing as ZIndexManager;\r\n        return win.__zIndexManager as ZIndexManager;\r\n    }\r\n\r\n    const state = getState(existing);\r\n\r\n    const assignZIndices = (): void => {\r\n        state.windowStack.forEach((id, index) => {\r\n            const zIndex = clamp(BASE_Z_INDEX + index);\r\n            applyZIndex(id, zIndex);\r\n        });\r\n        // Keep topZIndex as \"next available\" to mirror legacy semantics\r\n        const stackTopNext = BASE_Z_INDEX + state.windowStack.length;\r\n        setTopZStore(Math.max(stackTopNext, state.externalTopZ));\r\n    };\r\n\r\n    const manager: ZIndexManager = {\r\n        bringToFront(\r\n            windowId: string,\r\n            modal?: HTMLElement | null,\r\n            windowEl?: HTMLElement | null\r\n        ): number {\r\n            const currentIndex = state.windowStack.indexOf(windowId);\r\n            if (currentIndex !== -1) {\r\n                state.windowStack.splice(currentIndex, 1);\r\n            }\r\n            state.windowStack.push(windowId);\r\n            assignZIndices();\r\n            const assigned = clamp(BASE_Z_INDEX + state.windowStack.length - 1);\r\n            applyZIndex(windowId, assigned, modal, windowEl);\r\n            return manager.getTopZIndex();\r\n        },\r\n\r\n        removeWindow(windowId: string): void {\r\n            const idx = state.windowStack.indexOf(windowId);\r\n            if (idx !== -1) {\r\n                state.windowStack.splice(idx, 1);\r\n                assignZIndices();\r\n            }\r\n        },\r\n\r\n        getWindowStack(): string[] {\r\n            return [...state.windowStack];\r\n        },\r\n\r\n        restoreWindowStack(savedStack: string[]): void {\r\n            state.windowStack.length = 0;\r\n            savedStack.forEach(id => {\r\n                const el = document.getElementById(id);\r\n                if (el) state.windowStack.push(id);\r\n            });\r\n            assignZIndices();\r\n        },\r\n\r\n        reset(): void {\r\n            state.windowStack.length = 0;\r\n            state.externalTopZ = BASE_Z_INDEX;\r\n            setTopZStore(BASE_Z_INDEX);\r\n        },\r\n\r\n        getTopWindowId(): string | null {\r\n            pruneHiddenOrMissing(state.windowStack);\r\n            if (state.windowStack.length > 0)\r\n                return state.windowStack[state.windowStack.length - 1] ?? null;\r\n            const fallback = findTopVisibleModal();\r\n            return fallback ? fallback.id : null;\r\n        },\r\n\r\n        getTopWindowElement(): HTMLElement | null {\r\n            const topId = manager.getTopWindowId();\r\n            if (topId) return document.getElementById(topId);\r\n            return findTopVisibleModal();\r\n        },\r\n\r\n        getTopZIndex(): number {\r\n            const stackNext = BASE_Z_INDEX + state.windowStack.length;\r\n            const value = clamp(Math.max(stackNext, state.externalTopZ));\r\n            setTopZStore(value);\r\n            return value;\r\n        },\r\n\r\n        bumpZIndex(): number {\r\n            // Keep external counter at least in sync with stack-based z-index\r\n            const nextFromStack = BASE_Z_INDEX + state.windowStack.length + 1;\r\n            state.externalTopZ = clamp(Math.max(state.externalTopZ + 1, nextFromStack));\r\n            setTopZStore(state.externalTopZ);\r\n            return state.externalTopZ;\r\n        },\r\n\r\n        ensureTopZIndex(z: number): number {\r\n            state.externalTopZ = clamp(Math.max(state.externalTopZ, z));\r\n            const nextFromStack = BASE_Z_INDEX + state.windowStack.length;\r\n            setTopZStore(Math.max(nextFromStack, state.externalTopZ));\r\n            return getTopZStore();\r\n        },\r\n\r\n        syncFromDOM(): number {\r\n            let maxZ = BASE_Z_INDEX;\r\n            document.querySelectorAll<HTMLElement>('.modal').forEach(modal => {\r\n                const modalZ = parseInt(window.getComputedStyle(modal).zIndex, 10);\r\n                if (!Number.isNaN(modalZ)) maxZ = Math.max(maxZ, modalZ);\r\n                const winEl = modal.querySelector('.autopointer') as HTMLElement | null;\r\n                if (winEl) {\r\n                    const winZ = parseInt(window.getComputedStyle(winEl).zIndex, 10);\r\n                    if (!Number.isNaN(winZ)) maxZ = Math.max(maxZ, winZ);\r\n                }\r\n            });\r\n            state.externalTopZ = clamp(Math.max(state.externalTopZ, maxZ));\r\n            return manager.getTopZIndex();\r\n        },\r\n    };\r\n\r\n    win.__zIndexManager = manager;\r\n    assignZIndices();\r\n    return manager;\r\n}\r\n", "/**\r\n * WindowManager - Central registry for windows/modals with z-index and program metadata (TypeScript).\r\n * Mirrors js/window-manager.js behavior while adding types and preserving global API.\r\n */\r\n\r\nimport { BASE_Z_INDEX, getZIndexManager } from './z-index-manager.js';\r\n\r\n(() => {\r\n    'use strict';\r\n\r\n    type WindowType = 'persistent' | 'transient';\r\n\r\n    type DialogLike = {\r\n        open?: () => void;\r\n        close?: () => void;\r\n        bringToFront?: () => void;\r\n    } | null;\r\n\r\n    type WindowConfigOptions = {\r\n        id: string;\r\n        type?: WindowType;\r\n        programKey?: string;\r\n        icon?: string;\r\n        closeButtonId?: string | null;\r\n        metadata?: Record<string, unknown>;\r\n    };\r\n\r\n    type ProgramInfo = {\r\n        modalId: string | null;\r\n        programLabel: string;\r\n        infoLabel: string;\r\n        fallbackInfoModalId: string;\r\n        icon: string;\r\n        about: Record<string, string>;\r\n    };\r\n\r\n    class WindowConfig {\r\n        id: string;\r\n        type: WindowType;\r\n        programKey: string;\r\n        icon: string;\r\n        closeButtonId: string | null;\r\n        dialogInstance: DialogLike;\r\n        metadata: Record<string, unknown>;\r\n\r\n        constructor(options: WindowConfigOptions) {\r\n            this.id = options.id;\r\n            this.type = options.type || 'persistent';\r\n            this.programKey = options.programKey || 'programs.default';\r\n            this.icon = options.icon || './img/sucher.png';\r\n            this.closeButtonId = options.closeButtonId ?? null;\r\n            this.dialogInstance = null;\r\n            this.metadata = options.metadata || {};\r\n        }\r\n\r\n        isTransient(): boolean {\r\n            return this.type === 'transient';\r\n        }\r\n\r\n        getProgramInfo(): ProgramInfo {\r\n            const w = window as unknown as Record<string, unknown>;\r\n            const i18n =\r\n                (w['appI18n'] as { translate?: (k: string) => string } | undefined) || undefined;\r\n            const translate = i18n?.translate || ((key: string) => key);\r\n\r\n            const aboutFields = ['name', 'tagline', 'version', 'copyright'];\r\n            const info: ProgramInfo = {\r\n                modalId: this.id,\r\n                programLabel: translate(`${this.programKey}.label`),\r\n                infoLabel: translate(`${this.programKey}.infoLabel`),\r\n                fallbackInfoModalId:\r\n                    (this.metadata.fallbackInfoModalId as string) || 'program-info-modal',\r\n                icon: this.icon,\r\n                about: {},\r\n            };\r\n            aboutFields.forEach(field => {\r\n                info.about[field] = translate(`${this.programKey}.about.${field}`);\r\n            });\r\n            return info;\r\n        }\r\n    }\r\n\r\n    const windowRegistry = new Map<string, WindowConfig>();\r\n    const zIndexManager = getZIndexManager();\r\n\r\n    const WindowManager = {\r\n        /**\r\n         * Get current top z-index for synchronization\r\n         */\r\n        getTopZIndex(): number {\r\n            return zIndexManager.getTopZIndex();\r\n        },\r\n\r\n        /**\r\n         * Update top z-index from external source (e.g., WindowRegistry)\r\n         */\r\n        updateTopZIndex(newZIndex: number): void {\r\n            zIndexManager.ensureTopZIndex(newZIndex);\r\n        },\r\n        register(config: WindowConfigOptions): WindowConfig {\r\n            const windowConfig = new WindowConfig(config);\r\n            windowRegistry.set(config.id, windowConfig);\r\n            return windowConfig;\r\n        },\r\n\r\n        registerAll(configs: WindowConfigOptions[]): void {\r\n            configs.forEach(c => this.register(c));\r\n        },\r\n\r\n        getConfig(windowId: string): WindowConfig | null {\r\n            return windowRegistry.get(windowId) || null;\r\n        },\r\n\r\n        getAllWindowIds(): string[] {\r\n            return Array.from(windowRegistry.keys());\r\n        },\r\n\r\n        getPersistentWindowIds(): string[] {\r\n            return this.getAllWindowIds().filter(id => {\r\n                const config = this.getConfig(id);\r\n                return !!config && !config.isTransient();\r\n            });\r\n        },\r\n\r\n        getTransientWindowIds(): string[] {\r\n            return this.getAllWindowIds().filter(id => {\r\n                const config = this.getConfig(id);\r\n                return !!config && config.isTransient();\r\n            });\r\n        },\r\n\r\n        setDialogInstance(windowId: string, instance: DialogLike): void {\r\n            const config = this.getConfig(windowId);\r\n            if (config) {\r\n                config.dialogInstance = instance;\r\n            }\r\n        },\r\n\r\n        getDialogInstance(windowId: string): DialogLike {\r\n            const config = this.getConfig(windowId);\r\n            return (config && config.dialogInstance) || null;\r\n        },\r\n\r\n        getAllDialogInstances(): Record<string, DialogLike> {\r\n            const dialogs: Record<string, DialogLike> = {};\r\n            windowRegistry.forEach((config, id) => {\r\n                if (config.dialogInstance) {\r\n                    dialogs[id] = config.dialogInstance;\r\n                }\r\n            });\r\n            return dialogs;\r\n        },\r\n\r\n        getTopWindow(): HTMLElement | null {\r\n            return zIndexManager.getTopWindowElement();\r\n        },\r\n\r\n        bringToFront(windowId: string): void {\r\n            const instance = this.getDialogInstance(windowId);\r\n            if (instance && typeof instance.bringToFront === 'function') {\r\n                instance.bringToFront();\r\n                return;\r\n            }\r\n\r\n            const modal = document.getElementById(windowId);\r\n            if (!modal) {\r\n                console.warn(`Keine Dialog-Instanz f\u00FCr ${windowId} gefunden.`);\r\n                return;\r\n            }\r\n            const windowEl = this.getDialogWindowElement(modal);\r\n            zIndexManager.bringToFront(windowId, modal, windowEl);\r\n        },\r\n\r\n        open(windowId: string): void {\r\n            const config = this.getConfig(windowId);\r\n            // Run the configured initHandler on every open. Some windows rely on\r\n            // per-open initialization (e.g., Finder multi-instance recreation).\r\n            const g = window as unknown as {\r\n                __SESSION_RESTORE_IN_PROGRESS?: boolean;\r\n            };\r\n            const allowInitDuringRestore = !!(\r\n                config?.metadata &&\r\n                (config.metadata as Record<string, unknown> & { runInitDuringRestore?: boolean })\r\n                    .runInitDuringRestore\r\n            );\r\n\r\n            if (\r\n                config &&\r\n                config.metadata &&\r\n                typeof (config.metadata as Record<string, unknown>).initHandler === 'function' &&\r\n                (!g.__SESSION_RESTORE_IN_PROGRESS || allowInitDuringRestore)\r\n            ) {\r\n                try {\r\n                    const md = config.metadata as Record<string, unknown> & {\r\n                        initHandler?: () => void;\r\n                    };\r\n                    if (typeof md.initHandler === 'function') md.initHandler();\r\n                } catch (e) {\r\n                    console.warn(`Init handler for ${windowId} threw:`, e);\r\n                }\r\n            }\r\n            const instance = this.getDialogInstance(windowId);\r\n            if (instance && typeof instance.open === 'function') {\r\n                instance.open();\r\n            } else {\r\n                const modal = document.getElementById(windowId);\r\n                if (modal) {\r\n                    const domUtils = (window as any).DOMUtils;\r\n                    if (domUtils && typeof domUtils.show === 'function') {\r\n                        domUtils.show(modal);\r\n                    } else {\r\n                        modal.classList.remove('hidden');\r\n                    }\r\n                    this.bringToFront(windowId);\r\n                }\r\n            }\r\n        },\r\n\r\n        close(windowId: string): void {\r\n            const instance = this.getDialogInstance(windowId);\r\n            if (instance && typeof instance.close === 'function') {\r\n                instance.close();\r\n            } else {\r\n                const modal = document.getElementById(windowId);\r\n                if (modal) {\r\n                    const domUtils = (window as any).DOMUtils;\r\n                    if (domUtils && typeof domUtils.hide === 'function') {\r\n                        domUtils.hide(modal);\r\n                    } else {\r\n                        modal.classList.add('hidden');\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        getNextZIndex(): number {\r\n            return zIndexManager.bumpZIndex();\r\n        },\r\n\r\n        syncZIndexWithDOM(): number {\r\n            return zIndexManager.syncFromDOM();\r\n        },\r\n\r\n        getDialogWindowElement(modal: HTMLElement | null): HTMLElement | null {\r\n            if (!modal) return null;\r\n            return (modal.querySelector('.autopointer') as HTMLElement | null) || modal;\r\n        },\r\n\r\n        getProgramInfo(windowId: string): ProgramInfo {\r\n            const config = this.getConfig(windowId);\r\n            if (config) return config.getProgramInfo();\r\n            return this.getDefaultProgramInfo();\r\n        },\r\n\r\n        getDefaultProgramInfo(): ProgramInfo {\r\n            const w = window as unknown as Record<string, unknown>;\r\n            const i18n =\r\n                (w['appI18n'] as { translate?: (k: string) => string } | undefined) || undefined;\r\n            const translate = i18n?.translate || ((key: string) => key);\r\n            const programKey = 'programs.default';\r\n            return {\r\n                modalId: null,\r\n                programLabel: translate(`${programKey}.label`),\r\n                infoLabel: translate(`${programKey}.infoLabel`),\r\n                fallbackInfoModalId: 'program-info-modal',\r\n                icon: './img/sucher.png',\r\n                about: {\r\n                    name: translate(`${programKey}.about.name`),\r\n                    tagline: translate(`${programKey}.about.tagline`),\r\n                    version: translate(`${programKey}.about.version`),\r\n                    copyright: translate(`${programKey}.about.copyright`),\r\n                },\r\n            };\r\n        },\r\n\r\n        get topZIndex(): number {\r\n            return zIndexManager.getTopZIndex();\r\n        },\r\n        set topZIndex(value: number) {\r\n            zIndexManager.ensureTopZIndex(value);\r\n        },\r\n        get baseZIndex(): number {\r\n            return BASE_Z_INDEX;\r\n        },\r\n    };\r\n\r\n    (window as unknown as { WindowManager: typeof WindowManager }).WindowManager = WindowManager;\r\n\r\n    Object.defineProperty(window, 'topZIndex', {\r\n        get: () => WindowManager.topZIndex,\r\n        set: (value: number) => {\r\n            WindowManager.topZIndex = value;\r\n        },\r\n    });\r\n})();\r\n", "/**\r\n * Shared helpers for ActionBus modules\r\n */\r\n\r\nexport type Params = Record<string, string | undefined>;\r\nexport type Handler = (params: Params, element: HTMLElement | null) => void;\r\nexport type ActionMap = Record<string, Handler>;\r\n\r\n/**\r\n * Extract params from a dataset while ignoring ActionBus control keys.\r\n */\r\nexport function extractParams(dataset: DOMStringMap): Params {\r\n    const params: Params = {};\r\n    for (const key in dataset) {\r\n        if (key === 'action' || key === 'actionHover') continue;\r\n        params[key] = dataset[key];\r\n    }\r\n    return params;\r\n}\r\n\r\n/**\r\n * Safe wrapper to log errors without breaking execution flow.\r\n */\r\nexport function safeExecute(label: string, fn: () => void): void {\r\n    try {\r\n        fn();\r\n    } catch (error) {\r\n        console.warn(`${label} failed:`, error);\r\n    }\r\n}\r\n\r\n/**\r\n * Resolve a nested window property via dot-notation.\r\n */\r\nexport function getGlobal<T = unknown>(path: string): T | undefined {\r\n    const parts = path.split('.').filter(Boolean);\r\n    let current: any = window;\r\n    for (const p of parts) {\r\n        if (current && typeof current === 'object' && p in current) {\r\n            current = current[p];\r\n        } else {\r\n            return undefined;\r\n        }\r\n    }\r\n    return current as T | undefined;\r\n}\r\n", "/**\r\n * Finder-related actions\r\n */\r\nimport type { ActionMap, Params } from './helpers.js';\r\nimport { getGlobal } from './helpers.js';\r\n\r\nexport function getFinderActions(): ActionMap {\r\n    return {\r\n        'finder:navigateUp': () => {\r\n            const finder = getGlobal<{ navigateUp?: () => void }>('FinderSystem');\r\n            finder?.navigateUp?.();\r\n        },\r\n\r\n        'finder:goRoot': () => {\r\n            const finder = getGlobal<{\r\n                navigateTo?: (parts: string[], view?: string) => void;\r\n                getState?: () => { currentView: string };\r\n            }>('FinderSystem');\r\n            const view = finder?.getState?.()?.currentView;\r\n            finder?.navigateTo?.([], view);\r\n        },\r\n\r\n        'finder:switchView': (params: Params) => {\r\n            const view = params['finderView'] || params.view;\r\n            if (!view) {\r\n                console.warn('finder:switchView: missing finderView');\r\n                return;\r\n            }\r\n            const finder = getGlobal<{ navigateTo?: (parts: string[], view?: string) => void }>(\r\n                'FinderSystem'\r\n            );\r\n            finder?.navigateTo?.([], view as string);\r\n        },\r\n\r\n        'finder:setViewMode': (params: Params) => {\r\n            const mode = params['viewMode'] || params['mode'];\r\n            if (!mode) {\r\n                console.warn('finder:setViewMode: missing viewMode');\r\n                return;\r\n            }\r\n            const finder = getGlobal<{ setViewMode?: (mode: string) => void }>('FinderSystem');\r\n            finder?.setViewMode?.(mode as string);\r\n        },\r\n\r\n        'finder:setSortBy': (params: Params) => {\r\n            const field = params['sortBy'] || params['field'];\r\n            if (!field) {\r\n                console.warn('finder:setSortBy: missing sortBy');\r\n                return;\r\n            }\r\n            const finder = getGlobal<{ setSortBy?: (field: string) => void }>('FinderSystem');\r\n            finder?.setSortBy?.(field as string);\r\n        },\r\n\r\n        'finder:navigateToPath': (params: Params) => {\r\n            const raw = params.path || '';\r\n            const parts = typeof raw === 'string' && raw.length ? raw.split('/') : [];\r\n            const finder = getGlobal<{ navigateTo?: (parts: string[]) => void }>('FinderSystem');\r\n            finder?.navigateTo?.(parts);\r\n        },\r\n\r\n        'finder:openItem': (params: Params) => {\r\n            const name = params['itemName'] || params['name'];\r\n            const type = params['itemType'] || params['type'];\r\n            if (!name || !type) {\r\n                console.warn('finder:openItem: missing name/type');\r\n                return;\r\n            }\r\n            const finder = getGlobal<{ openItem?: (name: string, type: string) => void }>(\r\n                'FinderSystem'\r\n            );\r\n            finder?.openItem?.(name as string, type as string);\r\n        },\r\n    };\r\n}\r\n", "/**\r\n * Preview-related actions\r\n */\r\nimport type { ActionMap, Params } from './helpers.js';\r\nimport { getGlobal, safeExecute } from './helpers.js';\r\n\r\nexport function getPreviewActions(): ActionMap {\r\n    return {\r\n        openWithPreview: (params: Params) => {\r\n            safeExecute('openWithPreview', () => {\r\n                const single = (params['url'] || params['src'] || params['imageUrl']) as\r\n                    | string\r\n                    | undefined;\r\n                const csv = (params['urls'] || params['images']) as string | undefined;\r\n                const idx = parseInt((params['index'] || '0') as string, 10) || 0;\r\n                const path = (params['path'] || params['imagePath']) as string | undefined;\r\n\r\n                const preview = getGlobal<{\r\n                    openImages?: (list: string[], start: number, path?: string) => void;\r\n                }>('PreviewInstanceManager');\r\n                const finder = getGlobal<{ openItem?: (name: string, type: string) => void }>(\r\n                    'FinderSystem'\r\n                );\r\n\r\n                if (single) {\r\n                    const list = [single];\r\n                    preview?.openImages?.(list, 0, path);\r\n                    return;\r\n                }\r\n\r\n                if (csv) {\r\n                    const list = csv\r\n                        .split(',')\r\n                        .map(s => s.trim())\r\n                        .filter(Boolean);\r\n                    if (list.length) {\r\n                        preview?.openImages?.(\r\n                            list,\r\n                            Math.max(0, Math.min(idx, list.length - 1)),\r\n                            path\r\n                        );\r\n                    }\r\n                    return;\r\n                }\r\n\r\n                const itemName = (params['itemName'] || params['name']) as string | undefined;\r\n                if (itemName) {\r\n                    finder?.openItem?.(itemName, 'file');\r\n                }\r\n            });\r\n        },\r\n    };\r\n}\r\n", "/**\r\n * Session import/export actions\r\n */\r\nimport type { ActionMap } from './helpers.js';\r\nimport { getGlobal } from './helpers.js';\r\n\r\nexport function getSessionActions(): ActionMap {\r\n    return {\r\n        'session:export': () => {\r\n            const W = getGlobal<{\r\n                SessionManager?: { exportSession?: () => string | null };\r\n                appI18n?: { translate?: (key: string) => string };\r\n            }>('');\r\n            const translate = W?.appI18n?.translate || ((k: string) => k);\r\n\r\n            if (!W?.SessionManager?.exportSession) {\r\n                console.error('SessionManager not available');\r\n                return;\r\n            }\r\n\r\n            const json = W.SessionManager.exportSession();\r\n            if (!json) {\r\n                alert(translate('menu.session.noSession'));\r\n                return;\r\n            }\r\n\r\n            const blob = new Blob([json], { type: 'application/json' });\r\n            const url = URL.createObjectURL(blob);\r\n            const a = document.createElement('a');\r\n            a.href = url;\r\n            a.download = `session-${new Date().toISOString().slice(0, 10)}.json`;\r\n            document.body.appendChild(a);\r\n            a.click();\r\n            document.body.removeChild(a);\r\n            URL.revokeObjectURL(url);\r\n\r\n            console.log('Session exported successfully');\r\n        },\r\n\r\n        'session:import': () => {\r\n            const W = getGlobal<{\r\n                SessionManager?: { importSession?: (json: string) => boolean };\r\n                appI18n?: { translate?: (key: string) => string };\r\n            }>('');\r\n            const translate = W?.appI18n?.translate || ((k: string) => k);\r\n\r\n            if (!W?.SessionManager?.importSession) {\r\n                console.error('SessionManager not available');\r\n                return;\r\n            }\r\n\r\n            const input = document.createElement('input');\r\n            input.type = 'file';\r\n            input.accept = 'application/json,.json';\r\n            input.onchange = e => {\r\n                const file = (e.target as HTMLInputElement).files?.[0];\r\n                if (!file) return;\r\n\r\n                const reader = new FileReader();\r\n                reader.onload = event => {\r\n                    const json = event.target?.result;\r\n                    if (typeof json !== 'string') {\r\n                        alert(translate('menu.session.importError'));\r\n                        return;\r\n                    }\r\n\r\n                    const success = W.SessionManager?.importSession?.(json);\r\n                    if (success) {\r\n                        console.log('Session imported successfully');\r\n                    } else {\r\n                        alert(translate('menu.session.importError'));\r\n                    }\r\n                };\r\n                reader.onerror = () => {\r\n                    alert(translate('menu.session.importError'));\r\n                };\r\n                reader.readAsText(file);\r\n            };\r\n            input.click();\r\n        },\r\n    };\r\n}\r\n", "// Desktop icon system for macOS-style portfolio\r\n// TypeScript version. Use this file for new desktop shortcuts.\r\nimport { translate } from '../services/i18n';\r\n\r\n// Access the global API exposed on window (no module export)\r\ntype WindowWithAPI = {\r\n    API?: {\r\n        window: { open: (id: unknown) => unknown };\r\n    };\r\n};\r\nconst API = (window as unknown as WindowWithAPI).API;\r\n\r\nexport interface DesktopShortcut {\r\n    id: string;\r\n    icon?: string;\r\n    emoji?: string;\r\n    labelKey: string;\r\n    fallbackLabel: string;\r\n    onOpen?: () => void;\r\n}\r\n\r\nexport const DESKTOP_SHORTCUTS: DesktopShortcut[] = [\r\n    {\r\n        id: 'projects',\r\n        emoji: '\uD83D\uDCC1',\r\n        labelKey: 'desktop.projects',\r\n        fallbackLabel: 'Projekte',\r\n        onOpen: () => {\r\n            const W = window as any;\r\n            if (W.FinderWindow?.focusOrCreate) {\r\n                W.FinderWindow.focusOrCreate();\r\n            }\r\n            // Navigiere zum Projects-Ordner\r\n            const w = window as unknown as {\r\n                FinderSystem?: { navigateTo?: (path: string) => void };\r\n            };\r\n            if (w.FinderSystem?.navigateTo) {\r\n                w.FinderSystem.navigateTo('projects');\r\n            }\r\n        },\r\n    },\r\n    // {\r\n    //     id: 'settings',\r\n    //     emoji: '\u2699\uFE0F',\r\n    //     labelKey: 'desktop.settings',\r\n    //     fallbackLabel: 'Einstellungen',\r\n    //     onOpen: () => API?.window.open('settings-modal'),\r\n    // },\r\n];\r\n\r\nexport function renderDesktopShortcuts(container: HTMLElement) {\r\n    container.innerHTML = '';\r\n    DESKTOP_SHORTCUTS.forEach(shortcut => {\r\n        const el = document.createElement('button');\r\n        el.className = 'desktop-icon-button';\r\n        el.setAttribute('data-action', 'openDesktopItem');\r\n        el.setAttribute('data-item-id', shortcut.id);\r\n        el.setAttribute(\r\n            'aria-label',\r\n            translate(shortcut.labelKey, {}, { fallback: shortcut.fallbackLabel })\r\n        );\r\n\r\n        // Create the icon/emoji container\r\n        const graphicDiv = document.createElement('div');\r\n        graphicDiv.className = 'desktop-icon-graphic';\r\n\r\n        if (shortcut.icon) {\r\n            const img = document.createElement('img');\r\n            img.src = shortcut.icon;\r\n            img.alt = translate(shortcut.labelKey, {}, { fallback: shortcut.fallbackLabel });\r\n            graphicDiv.appendChild(img);\r\n        } else if (shortcut.emoji) {\r\n            graphicDiv.textContent = shortcut.emoji;\r\n        }\r\n\r\n        el.appendChild(graphicDiv);\r\n\r\n        const label = document.createElement('span');\r\n        label.className = 'desktop-icon-label';\r\n        label.textContent = translate(shortcut.labelKey, {}, { fallback: shortcut.fallbackLabel });\r\n        el.appendChild(label);\r\n\r\n        container.appendChild(el);\r\n    });\r\n}\r\n\r\nexport function handleDesktopShortcutClick(id: string) {\r\n    const shortcut = DESKTOP_SHORTCUTS.find(s => s.id === id);\r\n    if (shortcut && shortcut.onOpen) {\r\n        shortcut.onOpen();\r\n    }\r\n}\r\n\r\n/**\r\n * Initialize desktop shortcuts - called by app-init\r\n */\r\nexport function initDesktop() {\r\n    const container = document.getElementById('desktop-icons');\r\n    if (container) {\r\n        renderDesktopShortcuts(container);\r\n    }\r\n}\r\n\r\n// Export to window for app-init.ts\r\ndeclare global {\r\n    interface Window {\r\n        DesktopSystem?: {\r\n            initDesktop: () => void;\r\n        };\r\n    }\r\n}\r\n\r\nif (typeof window !== 'undefined') {\r\n    window.DesktopSystem = {\r\n        initDesktop,\r\n    };\r\n}\r\n", "/**\r\n * Window-related ActionBus handlers\r\n */\r\nimport type { ActionMap, Params } from './helpers.js';\r\nimport { getGlobal, safeExecute } from './helpers.js';\r\n\r\nexport function getWindowActions(): ActionMap {\r\n    return {\r\n        closeWindow: (params: Params) => {\r\n            const windowId = params.windowId;\r\n            if (!windowId) {\r\n                console.warn('closeWindow: missing windowId');\r\n                return;\r\n            }\r\n\r\n            const wm = getGlobal<{ close?: (id: string) => void }>('WindowManager');\r\n            wm?.close?.(windowId);\r\n\r\n            const g = getGlobal<{\r\n                saveOpenModals?: () => void;\r\n                updateDockIndicators?: () => void;\r\n                updateProgramLabelByTopModal?: () => void;\r\n            }>('');\r\n            g?.saveOpenModals?.();\r\n            g?.updateDockIndicators?.();\r\n            g?.updateProgramLabelByTopModal?.();\r\n        },\r\n\r\n        openWindow: (params: Params) => {\r\n            const windowId = params.windowId;\r\n\r\n            // Close launchpad if it's open (clicking dock icon while launchpad is visible)\r\n            const launchpadModal = document.getElementById('launchpad-modal');\r\n            if (launchpadModal && !launchpadModal.classList.contains('hidden')) {\r\n                const dialogs = getGlobal<Record<string, { close?: () => void }>>('dialogs');\r\n                dialogs?.['launchpad-modal']?.close?.();\r\n            }\r\n\r\n            // SPECIAL: Finder uses Multi-Window system (no windowId needed for dock icon)\r\n            if (!windowId) {\r\n                const finder = getGlobal<{ focusOrCreate?: () => void }>('FinderWindow');\r\n                if (finder?.focusOrCreate) {\r\n                    finder.focusOrCreate();\r\n                    return;\r\n                }\r\n                console.warn(\r\n                    '[ActionBus] openWindow called without windowId and FinderWindow not available'\r\n                );\r\n                return;\r\n            }\r\n\r\n            // SPECIAL: Multi-Window Finder\r\n            if (windowId === 'finder-modal') {\r\n                safeExecute('[ActionBus] openWindow finder-modal', () => {\r\n                    const finder = getGlobal<{ focusOrCreate?: () => void }>('FinderWindow');\r\n                    if (finder?.focusOrCreate) {\r\n                        finder.focusOrCreate();\r\n                        return;\r\n                    }\r\n                    console.warn(\r\n                        '[ActionBus] FinderWindow not available; falling back to WindowManager.open(\"finder-modal\")'\r\n                    );\r\n                });\r\n            }\r\n\r\n            // SPECIAL: Multi-Window Terminal\r\n            if (windowId === 'terminal-modal') {\r\n                safeExecute('[ActionBus] openWindow terminal-modal', () => {\r\n                    const terminal = getGlobal<{ focusOrCreate?: () => void }>('TerminalWindow');\r\n                    if (terminal?.focusOrCreate) {\r\n                        terminal.focusOrCreate();\r\n                        return;\r\n                    }\r\n                    console.warn(\r\n                        '[ActionBus] TerminalWindow not available; falling back to WindowManager.open(\"terminal-modal\")'\r\n                    );\r\n                });\r\n            }\r\n\r\n            const wm = getGlobal<{ open?: (id: string) => void }>('WindowManager');\r\n            wm?.open?.(windowId);\r\n\r\n            const g = getGlobal<{ updateProgramLabelByTopModal?: () => void }>('');\r\n            g?.updateProgramLabelByTopModal?.();\r\n        },\r\n\r\n        closeTopWindow: () => {\r\n            const g = getGlobal<{\r\n                hideMenuDropdowns?: () => void;\r\n                WindowManager?: { getTopWindow?: () => unknown; close?: (id: string) => void };\r\n                saveOpenModals?: () => void;\r\n                updateDockIndicators?: () => void;\r\n                updateProgramLabelByTopModal?: () => void;\r\n            }>('');\r\n            g?.hideMenuDropdowns?.();\r\n\r\n            const maybeTop = g?.WindowManager?.getTopWindow?.();\r\n            let topId: string | null = null;\r\n            if (typeof maybeTop === 'string') {\r\n                topId = maybeTop;\r\n            } else if (maybeTop && typeof maybeTop === 'object') {\r\n                const obj = maybeTop as Record<string, unknown>;\r\n                if (typeof obj.id === 'string') topId = obj.id;\r\n            }\r\n            if (!topId) return;\r\n\r\n            g?.WindowManager?.close?.(topId);\r\n            g?.saveOpenModals?.();\r\n            g?.updateDockIndicators?.();\r\n            g?.updateProgramLabelByTopModal?.();\r\n        },\r\n\r\n        resetWindowLayout: () => {\r\n            const g = getGlobal<{ hideMenuDropdowns?: () => void; resetWindowLayout?: () => void }>(\r\n                ''\r\n            );\r\n            g?.hideMenuDropdowns?.();\r\n            g?.resetWindowLayout?.();\r\n        },\r\n\r\n        openProgramInfo: () => {\r\n            const g = getGlobal<{\r\n                hideMenuDropdowns?: () => void;\r\n                openProgramInfoDialog?: (arg: unknown) => void;\r\n            }>('');\r\n            g?.hideMenuDropdowns?.();\r\n            g?.openProgramInfoDialog?.(null);\r\n        },\r\n\r\n        openAbout: () => {\r\n            const g = getGlobal<{\r\n                hideMenuDropdowns?: () => void;\r\n                dialogs?: Record<string, { open?: () => void }>;\r\n                updateProgramLabelByTopModal?: () => void;\r\n            }>('');\r\n            g?.hideMenuDropdowns?.();\r\n            g?.dialogs?.['about-modal']?.open?.();\r\n            g?.updateProgramLabelByTopModal?.();\r\n        },\r\n\r\n        openSettings: () => {\r\n            const g = getGlobal<{\r\n                hideMenuDropdowns?: () => void;\r\n                dialogs?: Record<string, { open?: () => void }>;\r\n                updateProgramLabelByTopModal?: () => void;\r\n            }>('');\r\n            g?.hideMenuDropdowns?.();\r\n            g?.dialogs?.['settings-modal']?.open?.();\r\n            g?.updateProgramLabelByTopModal?.();\r\n        },\r\n\r\n        openDesktopItem: (params: Params) => {\r\n            const itemId = params.itemId;\r\n            if (!itemId) {\r\n                console.warn('openDesktopItem: missing itemId');\r\n                return;\r\n            }\r\n            // Lazy import to avoid circular dependency\r\n            import('../desktop.js').then(({ DESKTOP_SHORTCUTS }) => {\r\n                const shortcut = DESKTOP_SHORTCUTS.find(s => s.id === itemId);\r\n                if (shortcut?.onOpen) {\r\n                    shortcut.onOpen();\r\n                } else {\r\n                    console.warn(`openDesktopItem: no shortcut found for id \"${itemId}\"`);\r\n                }\r\n            });\r\n        },\r\n    };\r\n}\r\n", "/**\r\n * ActionBus - Declarative event system to wire UI actions via data-action attributes.\r\n *\r\n * Example:\r\n *   <button data-action=\"closeWindow\" data-window-id=\"text-modal\">Close</button>\r\n *   ActionBus.register('closeWindow', (params, el) => { ... })\r\n */\r\nimport { extractParams, type Handler, type Params } from './actions/helpers.js';\r\nimport { getFinderActions } from './actions/finder.js';\r\nimport { getPreviewActions } from './actions/preview.js';\r\nimport { getSessionActions } from './actions/session.js';\r\nimport { getWindowActions } from './actions/windows.js';\r\n\r\nconsole.log('ActionBus loaded');\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    const actionHandlers = new Map<string, Handler>();\r\n    const eventDelegates: Array<{ eventType: string; delegate: (e: Event) => void }> = [];\r\n\r\n    const ActionBus = {\r\n        register(actionName: string, handler: Handler) {\r\n            if (!actionName || typeof handler !== 'function') {\r\n                console.error('Invalid action registration:', actionName);\r\n                return;\r\n            }\r\n            actionHandlers.set(actionName, handler);\r\n        },\r\n\r\n        registerAll(actions: Record<string, Handler>) {\r\n            Object.entries(actions).forEach(([name, handler]) => {\r\n                this.register(name, handler);\r\n            });\r\n        },\r\n\r\n        execute(actionName: string, params: Params = {}, element: HTMLElement | null = null) {\r\n            const handler = actionHandlers.get(actionName);\r\n            if (!handler) {\r\n                console.warn(`No handler registered for action: ${actionName}`);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                handler(params, element);\r\n            } catch (error) {\r\n                console.error(`Error executing action ${actionName}:`, error);\r\n            }\r\n        },\r\n\r\n        init() {\r\n            // Click-Events\r\n            this.delegateEvent('click', '[data-action]', (element, event) => {\r\n                const actionName = element.getAttribute('data-action') as string;\r\n                const params = extractParams(element.dataset);\r\n\r\n                if (element.tagName === 'BUTTON' || element.tagName === 'A') {\r\n                    event.preventDefault();\r\n                }\r\n                event.stopPropagation();\r\n\r\n                this.execute(actionName, params, element);\r\n            });\r\n\r\n            this.delegateEvent('dblclick', '[data-action-dblclick]', (element, event) => {\r\n                const actionName = element.getAttribute('data-action-dblclick') as string;\r\n                const params = extractParams(element.dataset);\r\n                if (element.tagName === 'BUTTON' || element.tagName === 'A') {\r\n                    event.preventDefault();\r\n                }\r\n                event.stopPropagation();\r\n                this.execute(actionName, params, element);\r\n            });\r\n\r\n            this.delegateEvent('mouseenter', '[data-action-hover]', element => {\r\n                const actionName = element.getAttribute('data-action-hover') as string;\r\n                const params = extractParams(element.dataset);\r\n                this.execute(actionName, params, element);\r\n            });\r\n\r\n            console.log('ActionBus initialized');\r\n        },\r\n\r\n        delegateEvent(\r\n            eventType: string,\r\n            selector: string,\r\n            handler: (element: HTMLElement, event: Event) => void\r\n        ) {\r\n            const delegate = (event: Event) => {\r\n                const target = event.target;\r\n                if (!(target instanceof Element)) return;\r\n\r\n                const element = target.closest(selector) as HTMLElement | null;\r\n                if (element) {\r\n                    handler(element, event);\r\n                }\r\n            };\r\n\r\n            document.addEventListener(eventType, delegate as EventListener);\r\n            eventDelegates.push({ eventType, delegate });\r\n        },\r\n\r\n        extractParams(element: HTMLElement): Params {\r\n            return extractParams(element.dataset);\r\n        },\r\n\r\n        destroy() {\r\n            eventDelegates.forEach(({ eventType, delegate }) => {\r\n                document.removeEventListener(eventType, delegate as EventListener);\r\n            });\r\n            eventDelegates.length = 0;\r\n            actionHandlers.clear();\r\n        },\r\n    } as const;\r\n\r\n    ActionBus.registerAll({\r\n        ...getPreviewActions(),\r\n        ...getWindowActions(),\r\n        ...getFinderActions(),\r\n        ...getSessionActions(),\r\n    });\r\n\r\n    (window as unknown as { ActionBus: typeof ActionBus }).ActionBus = ActionBus;\r\n})();\r\n", "/**\r\n * Dialog Utilities Module\r\n * Provides window/dialog z-index management and focus control functions.\r\n *\r\n * This module centralizes dialog utility functions that were previously scattered\r\n * in app.js, providing typed interfaces for better maintainability.\r\n *\r\n * @module dialog-utils\r\n */\r\n\r\n// Export to make this a proper module for global augmentation\r\nexport {};\r\n\r\n/**\r\n * Global window interface extensions for dialog utilities\r\n * Note: APP_CONSTANTS and topZIndex are defined in types/index.d.ts\r\n */\r\ndeclare global {\r\n    interface Window {\r\n        dialogs?: {\r\n            [key: string]: {\r\n                modal?: HTMLElement;\r\n                bringToFront?: () => void;\r\n            };\r\n        };\r\n        syncTopZIndexWithDOM?: () => void;\r\n        bringDialogToFront?: (dialogId: string) => void;\r\n        bringAllWindowsToFront?: () => void;\r\n    }\r\n}\r\n\r\n/**\r\n * Type helper for WindowManager (defined in types/window-manager.d.ts)\r\n */\r\ninterface IWindowManager {\r\n    syncZIndexWithDOM?: () => void;\r\n    getAllWindowIds?: () => string[];\r\n}\r\n\r\n/**\r\n * Get all modal IDs from WindowManager or fallback to APP_CONSTANTS\r\n * @returns Array of modal element IDs\r\n */\r\nfunction getModalIds(): string[] {\r\n    const win = window as Window & { WindowManager?: IWindowManager };\r\n    if (win.WindowManager && typeof win.WindowManager.getAllWindowIds === 'function') {\r\n        return win.WindowManager.getAllWindowIds();\r\n    }\r\n    // Cast window to access APP_CONSTANTS (defined in types/index.d.ts)\r\n    const w = window as Window & { APP_CONSTANTS?: Record<string, unknown> };\r\n    const appConstants = w.APP_CONSTANTS as { MODAL_IDS?: string[] } | undefined;\r\n    return appConstants?.MODAL_IDS || [];\r\n}\r\n\r\n/**\r\n * Synchronize the global topZIndex counter with the actual DOM z-index values.\r\n * Scans all registered modals and updates the topZIndex to match the highest z-index found.\r\n *\r\n * Delegates to WindowManager.syncZIndexWithDOM if available, otherwise uses fallback implementation.\r\n */\r\nfunction syncTopZIndexWithDOM(): void {\r\n    const win = window as Window & { WindowManager?: IWindowManager };\r\n    if (\r\n        win.WindowManager &&\r\n        typeof win.WindowManager.syncZIndexWithDOM === 'function'\r\n    ) {\r\n        win.WindowManager.syncZIndexWithDOM();\r\n        return;\r\n    }\r\n\r\n    // Fallback implementation\r\n    let maxZ = 1000;\r\n    const modalIds = getModalIds();\r\n\r\n    modalIds.forEach((id) => {\r\n        const modal = document.getElementById(id);\r\n        if (!modal) return;\r\n        const modalZ = parseInt(window.getComputedStyle(modal).zIndex, 10);\r\n        if (!Number.isNaN(modalZ)) {\r\n            maxZ = Math.max(maxZ, modalZ);\r\n        }\r\n    });\r\n\r\n    // Cast window to access topZIndex (defined in types/index.d.ts)\r\n    // Note: topZIndex is required in the type definition, but may not exist at runtime\r\n    const w = window as unknown as Window & { topZIndex?: number };\r\n    if (w.topZIndex !== undefined) {\r\n        w.topZIndex = maxZ;\r\n    }\r\n}\r\n\r\n/**\r\n * Bring a specific dialog/window to front by calling its bringToFront method.\r\n * This is the recommended way to change window focus programmatically.\r\n *\r\n * @param dialogId - The ID of the dialog element to bring to front\r\n */\r\nfunction bringDialogToFront(dialogId: string): void {\r\n    if (window.dialogs?.[dialogId]) {\r\n        window.dialogs[dialogId].bringToFront?.();\r\n    } else {\r\n        console.error('Kein Dialog mit der ID ' + dialogId + ' gefunden.');\r\n    }\r\n}\r\n\r\n/**\r\n * Bring all currently visible (non-hidden) windows to front.\r\n * Used by menu system to refresh z-index stack of all open windows.\r\n * Iterates through all registered dialogs and calls bringToFront on visible ones.\r\n */\r\nfunction bringAllWindowsToFront(): void {\r\n    const modalIds = getModalIds();\r\n    if (!window.dialogs || !modalIds || !Array.isArray(modalIds)) return;\r\n\r\n    modalIds.forEach((id) => {\r\n        const dialog = window.dialogs?.[id];\r\n        if (\r\n            dialog &&\r\n            dialog.modal &&\r\n            !dialog.modal.classList.contains('hidden') &&\r\n            typeof dialog.bringToFront === 'function'\r\n        ) {\r\n            dialog.bringToFront();\r\n        }\r\n    });\r\n}\r\n\r\n// ============================================================================\r\n// IIFE Export Pattern - Expose functions globally with guard to prevent redeclaration\r\n// ============================================================================\r\n\r\n(() => {\r\n    if (typeof window.syncTopZIndexWithDOM !== 'function') {\r\n        window.syncTopZIndexWithDOM = syncTopZIndexWithDOM;\r\n    }\r\n    if (typeof window.bringDialogToFront !== 'function') {\r\n        window.bringDialogToFront = bringDialogToFront;\r\n    }\r\n    if (typeof window.bringAllWindowsToFront !== 'function') {\r\n        window.bringAllWindowsToFront = bringAllWindowsToFront;\r\n    }\r\n})();\r\n", "(function () {\r\n    'use strict';\r\n\r\n    // ============================================================================\r\n    // Snap & Window Utilities\r\n    // ============================================================================\r\n\r\n    /**\r\n     * Get the bottom position of the menu bar (header element).\r\n     * @returns The bottom edge of the menu bar in pixels.\r\n     */\r\n    function getMenuBarBottom(): number {\r\n        const header = document.querySelector('body > header');\r\n        if (!header) {\r\n            return 0;\r\n        }\r\n        const rect = header.getBoundingClientRect();\r\n        return rect.bottom;\r\n    }\r\n\r\n    /**\r\n     * Clamp a window element so it doesn't overlap the menu bar.\r\n     * @param target - The element to clamp (e.g., a modal or dialog window).\r\n     */\r\n    function clampWindowToMenuBar(target: HTMLElement | null): void {\r\n        if (!target) return;\r\n        const minTop = getMenuBarBottom();\r\n        if (minTop <= 0) return;\r\n        const computed = window.getComputedStyle(target);\r\n        if (computed.position === 'static') {\r\n            target.style.position = 'fixed';\r\n        }\r\n        const currentTop = parseFloat(target.style.top);\r\n        const numericTop = Number.isNaN(currentTop)\r\n            ? parseFloat(computed.top)\r\n            : currentTop;\r\n        if (!Number.isNaN(numericTop) && numericTop < minTop) {\r\n            target.style.top = `${minTop}px`;\r\n        } else if (Number.isNaN(numericTop)) {\r\n            const rect = target.getBoundingClientRect();\r\n            if (rect.top < minTop) {\r\n                if (!target.style.left) {\r\n                    target.style.left = `${rect.left}px`;\r\n                }\r\n                target.style.top = `${minTop}px`;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Compute snap metrics for window snapping (left or right side).\r\n     * @param side - The side to snap to ('left' or 'right').\r\n     * @returns Snap metrics (left, top, width, height) or null if invalid.\r\n     */\r\n    function computeSnapMetrics(\r\n        side: 'left' | 'right'\r\n    ): { left: number; top: number; width: number; height: number } | null {\r\n        if (side !== 'left' && side !== 'right') return null;\r\n        const minTop = Math.round(getMenuBarBottom());\r\n        const viewportWidth = Math.max(window.innerWidth || 0, 0);\r\n        const viewportHeight = Math.max(window.innerHeight || 0, 0);\r\n        if (viewportWidth <= 0 || viewportHeight <= 0) return null;\r\n        const minWidth = Math.min(320, viewportWidth);\r\n        const halfWidth = Math.round(viewportWidth / 2);\r\n        const width = Math.max(Math.min(halfWidth, viewportWidth), minWidth);\r\n        const left = side === 'left' ? 0 : Math.max(0, viewportWidth - width);\r\n        const top = minTop;\r\n\r\n        // Fetch dock reserved bottom height\r\n        const getDockReservedBottom =\r\n            (window as unknown as { getDockReservedBottom?: () => number }).getDockReservedBottom;\r\n        const dockReserve = typeof getDockReservedBottom === 'function' ? getDockReservedBottom() : 0;\r\n\r\n        const height = Math.max(0, viewportHeight - top - dockReserve);\r\n        return { left, top, width, height };\r\n    }\r\n\r\n    let snapPreviewElement: HTMLElement | null = null;\r\n\r\n    /**\r\n     * Ensure the snap preview overlay element exists in the DOM.\r\n     * @returns The snap preview element or null if DOM is unavailable.\r\n     */\r\n    function ensureSnapPreviewElement(): HTMLElement | null {\r\n        if (snapPreviewElement && snapPreviewElement.isConnected) {\r\n            return snapPreviewElement;\r\n        }\r\n        if (!document || !document.body) {\r\n            return null;\r\n        }\r\n        snapPreviewElement = document.getElementById('snap-preview-overlay');\r\n        if (!snapPreviewElement) {\r\n            snapPreviewElement = document.createElement('div');\r\n            snapPreviewElement.id = 'snap-preview-overlay';\r\n            snapPreviewElement.setAttribute('aria-hidden', 'true');\r\n            document.body.appendChild(snapPreviewElement);\r\n        }\r\n        return snapPreviewElement;\r\n    }\r\n\r\n    /**\r\n     * Show a snap preview overlay on the specified side.\r\n     * @param side - The side to preview snapping ('left' or 'right').\r\n     */\r\n    function showSnapPreview(side: 'left' | 'right'): void {\r\n        const metrics = computeSnapMetrics(side);\r\n        if (!metrics) {\r\n            hideSnapPreview();\r\n            return;\r\n        }\r\n        const el = ensureSnapPreviewElement();\r\n        if (!el) return;\r\n        el.style.left = `${metrics.left}px`;\r\n        el.style.top = `${metrics.top}px`;\r\n        el.style.width = `${metrics.width}px`;\r\n        el.style.height = `${metrics.height}px`;\r\n        el.setAttribute('data-side', side);\r\n        el.classList.add('snap-preview-visible');\r\n    }\r\n\r\n    /**\r\n     * Hide the snap preview overlay.\r\n     */\r\n    function hideSnapPreview(): void {\r\n        if (!snapPreviewElement || !snapPreviewElement.isConnected) {\r\n            return;\r\n        }\r\n        snapPreviewElement.classList.remove('snap-preview-visible');\r\n        snapPreviewElement.removeAttribute('data-side');\r\n    }\r\n\r\n    // ============================================================================\r\n    // Expose globally (guarded to avoid redeclare)\r\n    // ============================================================================\r\n\r\n    type GlobalWindow = typeof window & {\r\n        getMenuBarBottom?: typeof getMenuBarBottom;\r\n        clampWindowToMenuBar?: typeof clampWindowToMenuBar;\r\n        computeSnapMetrics?: typeof computeSnapMetrics;\r\n        showSnapPreview?: typeof showSnapPreview;\r\n        hideSnapPreview?: typeof hideSnapPreview;\r\n    };\r\n\r\n    const g = window as GlobalWindow;\r\n\r\n    if (typeof g.getMenuBarBottom !== 'function') {\r\n        g.getMenuBarBottom = getMenuBarBottom;\r\n    }\r\n    if (typeof g.clampWindowToMenuBar !== 'function') {\r\n        g.clampWindowToMenuBar = clampWindowToMenuBar;\r\n    }\r\n    if (typeof g.computeSnapMetrics !== 'function') {\r\n        g.computeSnapMetrics = computeSnapMetrics;\r\n    }\r\n    if (typeof g.showSnapPreview !== 'function') {\r\n        g.showSnapPreview = showSnapPreview;\r\n    }\r\n    if (typeof g.hideSnapPreview !== 'function') {\r\n        g.hideSnapPreview = hideSnapPreview;\r\n    }\r\n})();\r\n", "(function () {\r\n    'use strict';\r\n\r\n    type EditorMessage = { type: string; command?: string; payload?: unknown };\r\n    type GlobalWindow = {\r\n        dialogs?: Record<string, { modal?: HTMLElement | null } | undefined>;\r\n        postToTextEditor?: (msg: EditorMessage) => void;\r\n        getImageViewerState?: () => { hasImage: boolean; src: string };\r\n        openActiveImageInNewTab?: () => void;\r\n        downloadActiveImage?: () => void;\r\n        sendTextEditorMenuAction?: (command: string) => void;\r\n    } & Window;\r\n\r\n    const gw = (window as unknown as GlobalWindow);\r\n\r\n    // --- Text Editor Menu Action Bridge ---\r\n    function getTextEditorIframe(): HTMLIFrameElement | null {\r\n        const dialogs = gw.dialogs;\r\n        const dialog = dialogs ? dialogs['text-modal'] : null;\r\n        if (!dialog || !dialog.modal) return null;\r\n        return dialog.modal.querySelector('iframe');\r\n    }\r\n\r\n    function postToTextEditor(message: EditorMessage, attempt = 0): void {\r\n        if (!message || typeof message !== 'object') return;\r\n        // Prefer legacy global if available\r\n        const legacy = gw.postToTextEditor;\r\n        if (typeof legacy === 'function') {\r\n            legacy(message);\r\n            return;\r\n        }\r\n        const iframe = getTextEditorIframe();\r\n        if (iframe && iframe.contentWindow) {\r\n            let targetOrigin = '*';\r\n            if (\r\n                window.location &&\r\n                typeof window.location.origin === 'string' &&\r\n                window.location.origin !== 'null'\r\n            ) {\r\n                targetOrigin = window.location.origin;\r\n            }\r\n            iframe.contentWindow.postMessage(message, targetOrigin);\r\n            return;\r\n        }\r\n        if (attempt < 10) {\r\n            setTimeout(() => postToTextEditor(message, attempt + 1), 120);\r\n        } else {\r\n            console.warn('Texteditor iframe nicht verf\u00FCgbar, Nachricht verworfen.', message);\r\n        }\r\n    }\r\n\r\n    function sendTextEditorMenuAction(command: string): void {\r\n        if (!command) return;\r\n        postToTextEditor({ type: 'textEditor:menuAction', command });\r\n    }\r\n\r\n    // --- Image Viewer Helpers ---\r\n    function getImageViewerState(): { hasImage: boolean; src: string } {\r\n        const viewer = document.getElementById('image-viewer') as HTMLImageElement | null;\r\n        if (!viewer) return { hasImage: false, src: '' };\r\n        const hidden = viewer.classList.contains('hidden');\r\n        const src = viewer.getAttribute('src') || viewer.src || '';\r\n        const hasImage = Boolean(src && src.trim() && !hidden);\r\n        return { hasImage, src };\r\n    }\r\n\r\n    function openActiveImageInNewTab(): void {\r\n        const state = getImageViewerState();\r\n        if (!state.hasImage || !state.src) return;\r\n        window.open(state.src, '_blank', 'noopener');\r\n    }\r\n\r\n    function downloadActiveImage(): void {\r\n        const state = getImageViewerState();\r\n        if (!state.hasImage || !state.src) return;\r\n        const link = document.createElement('a');\r\n        link.href = state.src;\r\n        let fileName = 'bild';\r\n        try {\r\n            const url = new URL(state.src, window.location.href);\r\n            fileName = url.pathname.split('/').pop() || fileName;\r\n        } catch {\r\n            fileName = 'bild';\r\n        }\r\n        link.download = fileName || 'bild';\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n    }\r\n\r\n    // Export globals (do not override if already present)\r\n    if (typeof gw.getImageViewerState !== 'function') gw.getImageViewerState = getImageViewerState;\r\n    if (typeof gw.openActiveImageInNewTab !== 'function') gw.openActiveImageInNewTab = openActiveImageInNewTab;\r\n    if (typeof gw.downloadActiveImage !== 'function') gw.downloadActiveImage = downloadActiveImage;\r\n    if (typeof gw.sendTextEditorMenuAction !== 'function') gw.sendTextEditorMenuAction = sendTextEditorMenuAction;\r\n})();\r\n", "(function () {\r\n    'use strict';\r\n\r\n    type ProgramInfo = {\r\n        modalId: string | null;\r\n        programLabel: string;\r\n        infoLabel: string;\r\n        fallbackInfoModalId?: string;\r\n        icon?: string;\r\n        about?: { name?: string; tagline?: string; version?: string; copyright?: string };\r\n    };\r\n\r\n    // Resolve Program Info via WindowManager or fallback\r\n    function resolveProgramInfo(modalId: string | null): ProgramInfo {\r\n        const wm = (window as unknown as { WindowManager?: { getProgramInfo: (id: string | null) => ProgramInfo } }).WindowManager;\r\n        if (wm && typeof wm.getProgramInfo === 'function') {\r\n            return wm.getProgramInfo(modalId);\r\n        }\r\n        const translate = (window as unknown as { translate?: (k: string, fb?: string) => string }).translate;\r\n        const t = (k: string, fb?: string) => (translate ? translate(k, fb) : fb || k);\r\n        return {\r\n            modalId: modalId || null,\r\n            programLabel: t('programs.default.label'),\r\n            infoLabel: t('programs.default.infoLabel'),\r\n            fallbackInfoModalId: 'program-info-modal',\r\n            icon: './img/sucher.png',\r\n            about: {},\r\n        };\r\n    }\r\n\r\n    function updateProgramLabel(newLabel: string): void {\r\n        const programLabel = document.getElementById('program-label');\r\n        if (programLabel) programLabel.textContent = newLabel;\r\n    }\r\n\r\n    function getTopModal(): HTMLElement | null {\r\n        const wm = (window as unknown as { WindowManager?: { getTopWindow: () => HTMLElement | null } }).WindowManager;\r\n        if (wm && typeof wm.getTopWindow === 'function') {\r\n            return wm.getTopWindow();\r\n        }\r\n        let top: HTMLElement | null = null;\r\n        let highest = 0;\r\n        document.querySelectorAll<HTMLElement>('.modal:not(.hidden)').forEach((modal) => {\r\n            const z = parseInt(getComputedStyle(modal).zIndex, 10) || 0;\r\n            if (z > highest) {\r\n                highest = z;\r\n                top = modal;\r\n            }\r\n        });\r\n        return top;\r\n    }\r\n\r\n    function updateProgramInfoMenu(info: ProgramInfo): void {\r\n        const infoLink = document.getElementById('about-program');\r\n        if (!infoLink) return;\r\n        const fallbackInfo = resolveProgramInfo(null);\r\n        infoLink.textContent = info.infoLabel || fallbackInfo.infoLabel;\r\n        const el = infoLink as HTMLElement & { dataset: { fallbackInfoModalId?: string } };\r\n        if (info.fallbackInfoModalId) {\r\n            el.dataset.fallbackInfoModalId = info.fallbackInfoModalId;\r\n        } else if (el.dataset) {\r\n            delete el.dataset.fallbackInfoModalId;\r\n        }\r\n    }\r\n\r\n    function renderProgramInfo(info: ProgramInfo): void {\r\n        const modal = document.getElementById('program-info-modal');\r\n        if (!modal) return;\r\n        (modal as HTMLElement & { dataset: { infoTarget?: string } }).dataset.infoTarget = info.modalId || '';\r\n        const fallbackInfo = resolveProgramInfo(null);\r\n        const about = info.about || fallbackInfo.about || {};\r\n        const iconEl = modal.querySelector('#program-info-icon') as HTMLImageElement | null;\r\n        if (iconEl) {\r\n            if (info.icon) {\r\n                iconEl.src = info.icon;\r\n                iconEl.alt = about.name || info.programLabel || 'Programm';\r\n                iconEl.classList.remove('hidden');\r\n            } else {\r\n                iconEl.classList.add('hidden');\r\n            }\r\n        }\r\n        const nameEl = modal.querySelector('#program-info-name');\r\n        if (nameEl) {\r\n            nameEl.textContent = about.name || info.programLabel || fallbackInfo.programLabel;\r\n        }\r\n        const taglineEl = modal.querySelector('#program-info-tagline');\r\n        if (taglineEl) {\r\n            const tagline = about.tagline || '';\r\n            taglineEl.textContent = tagline;\r\n            taglineEl.classList.toggle('hidden', !tagline);\r\n        }\r\n        const versionEl = modal.querySelector('#program-info-version');\r\n        if (versionEl) {\r\n            const version = about.version || '';\r\n            versionEl.textContent = version;\r\n            versionEl.classList.toggle('hidden', !version);\r\n        }\r\n        const copyrightEl = modal.querySelector('#program-info-copyright');\r\n        if (copyrightEl) {\r\n            const copyright = about.copyright || '';\r\n            copyrightEl.textContent = copyright;\r\n            copyrightEl.classList.toggle('hidden', !copyright);\r\n        }\r\n    }\r\n\r\n    function renderApplicationMenu(modalId: string | null): void {\r\n        const MenuSystem = (window as unknown as { MenuSystem?: { renderApplicationMenu?: (id: string | null) => void } }).MenuSystem;\r\n        if (MenuSystem && typeof MenuSystem.renderApplicationMenu === 'function') {\r\n            MenuSystem.renderApplicationMenu(modalId);\r\n        }\r\n    }\r\n\r\n    function getProgramInfo(modalId: string | null): ProgramInfo {\r\n        return resolveProgramInfo(modalId);\r\n    }\r\n\r\n    function openProgramInfoDialog(event: Event | null, infoOverride?: ProgramInfo): void {\r\n        if (event) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n        }\r\n        const hideMenus = (window as unknown as { hideMenuDropdowns?: () => void }).hideMenuDropdowns;\r\n        if (hideMenus) hideMenus();\r\n        const info = infoOverride || currentProgramInfo || getProgramInfo(null);\r\n        currentProgramInfo = info;\r\n        const infoEvent = new CustomEvent('programInfoRequested', {\r\n            detail: { modalId: info.modalId, info },\r\n            cancelable: true,\r\n        });\r\n        const dispatchResult = window.dispatchEvent(infoEvent);\r\n        if (!dispatchResult) return;\r\n        const fallbackId = info.fallbackInfoModalId;\r\n        if (!fallbackId) return;\r\n        if (fallbackId === 'program-info-modal') {\r\n            renderProgramInfo(info);\r\n        }\r\n        const dialogs = (window as unknown as { dialogs?: Record<string, { open?: () => void }> }).dialogs;\r\n        const dialogInstance = dialogs && dialogs[fallbackId];\r\n        if (dialogInstance && typeof dialogInstance.open === 'function') {\r\n            dialogInstance.open();\r\n        } else {\r\n            const modalElement = document.getElementById(fallbackId);\r\n            if (modalElement) {\r\n                modalElement.classList.remove('hidden');\r\n                const bringToFront = (window as unknown as { dialogs?: Record<string, { bringToFront?: () => void }> }).dialogs?.[fallbackId]?.bringToFront;\r\n                if (bringToFront) bringToFront();\r\n                updateProgramLabelByTopModal();\r\n            }\r\n        }\r\n    }\r\n\r\n    function openProgramInfoFromMenu(targetModalId?: string | null): void {\r\n        const info = resolveProgramInfo(targetModalId || null);\r\n        openProgramInfoDialog(null, info);\r\n    }\r\n\r\n    let currentProgramInfo: ProgramInfo = resolveProgramInfo(null);\r\n\r\n    function updateProgramLabelByTopModal(): ProgramInfo {\r\n        const topModal = getTopModal();\r\n        const wm = (window as unknown as { WindowManager?: { getConfig: (id: string) => { metadata?: { skipMenubarUpdate?: boolean } } | null } }).WindowManager;\r\n        if (topModal && wm) {\r\n            const config = wm.getConfig(topModal.id);\r\n            if (config && config.metadata && config.metadata.skipMenubarUpdate) {\r\n                const all = Array.from(document.querySelectorAll<HTMLElement>('.modal:not(.hidden)'));\r\n                const sorted = all.sort((a, b) => (parseInt(getComputedStyle(b).zIndex, 10) || 0) - (parseInt(getComputedStyle(a).zIndex, 10) || 0));\r\n                let next: HTMLElement | null = null;\r\n                for (const m of sorted) {\r\n                    const mc = wm.getConfig(m.id);\r\n                    if (!mc || !mc.metadata || !mc.metadata.skipMenubarUpdate) {\r\n                        next = m;\r\n                        break;\r\n                    }\r\n                }\r\n                if (next) {\r\n                    const info = getProgramInfo(next.id);\r\n                    currentProgramInfo = info;\r\n                    updateProgramLabel(info.programLabel);\r\n                    updateProgramInfoMenu(info);\r\n                    renderApplicationMenu(next.id);\r\n                    return info;\r\n                }\r\n            }\r\n        }\r\n        let info: ProgramInfo;\r\n        if (topModal && topModal.id === 'program-info-modal' && currentProgramInfo && currentProgramInfo.modalId) {\r\n            info = resolveProgramInfo(currentProgramInfo.modalId);\r\n            currentProgramInfo = info;\r\n        } else {\r\n            info = getProgramInfo(topModal ? topModal.id : null);\r\n            currentProgramInfo = info;\r\n        }\r\n        updateProgramLabel(info.programLabel);\r\n        updateProgramInfoMenu(info);\r\n        renderApplicationMenu(topModal ? topModal.id : null);\r\n        return info;\r\n    }\r\n\r\n    // React to language/theme changes similar to legacy\r\n    // Avoid double-binding if legacy already wired these listeners\r\n    const alreadyWired = (window as unknown as { __programMenuSyncWired?: boolean }).__programMenuSyncWired;\r\n    if (!alreadyWired) {\r\n        (window as unknown as { __programMenuSyncWired?: boolean }).__programMenuSyncWired = true;\r\n    }\r\n\r\n    if (!alreadyWired) window.addEventListener('languagePreferenceChange', () => {\r\n        const info = updateProgramLabelByTopModal();\r\n        const programInfoModal = document.getElementById('program-info-modal') as HTMLElement | null;\r\n        if (programInfoModal && !programInfoModal.classList.contains('hidden')) {\r\n            const ds: DOMStringMap = programInfoModal.dataset;\r\n            const targetId = ds['infoTarget'] || (info ? info.modalId : null) || null;\r\n            const infoForDialog = resolveProgramInfo(targetId);\r\n            renderProgramInfo(infoForDialog);\r\n            if (info && info.modalId === infoForDialog.modalId) {\r\n                currentProgramInfo = infoForDialog;\r\n            }\r\n        }\r\n        const updateAllSystemStatusUI = (window as unknown as { updateAllSystemStatusUI?: () => void }).updateAllSystemStatusUI;\r\n        if (updateAllSystemStatusUI) updateAllSystemStatusUI();\r\n    });\r\n    if (!alreadyWired) window.addEventListener('themePreferenceChange', () => {\r\n        const updateAllSystemStatusUI = (window as unknown as { updateAllSystemStatusUI?: () => void }).updateAllSystemStatusUI;\r\n        if (updateAllSystemStatusUI) updateAllSystemStatusUI();\r\n    });\r\n\r\n    // Export legacy globals for compatibility\r\n    (window as unknown as { updateProgramLabelByTopModal: typeof updateProgramLabelByTopModal }).updateProgramLabelByTopModal = updateProgramLabelByTopModal;\r\n    (window as unknown as { openProgramInfoFromMenu: typeof openProgramInfoFromMenu }).openProgramInfoFromMenu = openProgramInfoFromMenu;\r\n})();\r\n", "/*\r\n * src/ts/menu.ts\r\n * Typed port of js/menu.js\r\n */\r\n\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport { translate } from '../services/i18n';\r\n\r\n// Allow dynamic access on window via string keys for legacy globals\r\ndeclare global {\r\n    interface Window {\r\n        [key: string]: any;\r\n    }\r\n}\r\n\r\ntype MenuHandler = (...args: any[]) => unknown;\r\nconst menuActionHandlers = new Map<string, MenuHandler>();\r\nlet menuActionIdCounter = 0;\r\n\r\ntype MenuContext = {\r\n    modalId?: string;\r\n    dialog?: { close?: () => void; minimize?: () => void; toggleMaximize?: () => void } | null;\r\n} | null;\r\n\r\nexport function registerMenuAction(handler: MenuHandler) {\r\n    if (typeof handler !== 'function') return null;\r\n    const actionId = `menu-action-${++menuActionIdCounter}`;\r\n    menuActionHandlers.set(actionId, handler);\r\n    return actionId;\r\n}\r\n\r\nexport function normalizeMenuItems(items: unknown[], context: MenuContext) {\r\n    if (!Array.isArray(items)) return [];\r\n    const normalized: Record<string, unknown>[] = [];\r\n    let previousWasSeparator = true;\r\n    items.forEach(raw => {\r\n        const item = raw as any;\r\n        if (!item) return;\r\n        if (item.type === 'separator') {\r\n            if (previousWasSeparator) return;\r\n            normalized.push({ type: 'separator' });\r\n            previousWasSeparator = true;\r\n            return;\r\n        }\r\n        const clone = Object.assign({}, item) as Record<string, unknown>;\r\n        if (typeof item.disabled === 'function')\r\n            (clone.disabled as unknown) = (item.disabled as (ctx: MenuContext) => boolean)(context);\r\n        if (typeof item.label === 'function')\r\n            (clone.label as unknown) = (item.label as (ctx: MenuContext) => string)(context);\r\n        if (typeof item.shortcut === 'function')\r\n            (clone.shortcut as unknown) = (item.shortcut as (ctx: MenuContext) => string)(context);\r\n        normalized.push(clone);\r\n        previousWasSeparator = false;\r\n    });\r\n    while (normalized.length && normalized[normalized.length - 1]?.type === 'separator')\r\n        normalized.pop();\r\n    return normalized;\r\n}\r\n\r\n// --- Menu builders (ported functions simplified to reference window helpers) ---\r\nfunction buildDefaultMenuDefinition(context: MenuContext) {\r\n    return buildFinderMenuDefinition(context);\r\n}\r\n\r\nfunction buildFinderMenuDefinition(context: MenuContext) {\r\n    return [\r\n        {\r\n            id: 'file',\r\n            label: () => translate('menu.sections.file'),\r\n            items: [\r\n                {\r\n                    id: 'finder-new-window',\r\n                    label: () => translate('menu.finder.newWindow'),\r\n                    shortcut: '\u2318N',\r\n                    icon: 'new',\r\n                    action: () => {\r\n                        // Create new multi-window Finder\r\n                        if (\r\n                            window['FinderWindow'] &&\r\n                            typeof window['FinderWindow'].create === 'function'\r\n                        ) {\r\n                            const registry = window['WindowRegistry'];\r\n                            const count = registry?.getWindowCount?.('finder') || 0;\r\n                            window['FinderWindow'].create({\r\n                                title: `Finder ${count + 1}`,\r\n                            });\r\n                        } else {\r\n                            // Fallback to legacy instance manager\r\n                            const mgr = window['FinderInstanceManager'];\r\n                            if (mgr && typeof mgr.createInstance === 'function') {\r\n                                const count = mgr.getInstanceCount\r\n                                    ? mgr.getInstanceCount()\r\n                                    : mgr.getAllInstances?.().length || 0;\r\n                                mgr.createInstance({ title: `Finder ${count + 1}` });\r\n                            }\r\n                        }\r\n                    },\r\n                },\r\n                {\r\n                    id: 'finder-reload',\r\n                    label: () => translate('menu.finder.reload'),\r\n                    shortcut: '\u2318R',\r\n                    icon: 'reload',\r\n                    action: () => {\r\n                        if (\r\n                            window['FinderSystem'] &&\r\n                            typeof window['FinderSystem'].navigateTo === 'function'\r\n                        ) {\r\n                            try {\r\n                                const st =\r\n                                    window['FinderSystem'].getState &&\r\n                                    window['FinderSystem'].getState();\r\n                                if (st && Array.isArray(st.githubRepos)) st.githubRepos = [];\r\n                                window['FinderSystem'].navigateTo([], 'github');\r\n                            } catch (e) {\r\n                                console.warn('Finder reload failed', e);\r\n                            }\r\n                        }\r\n                    },\r\n                },\r\n                { type: 'separator' },\r\n                {\r\n                    id: 'session-export',\r\n                    label: () => translate('menu.session.export'),\r\n                    icon: 'save',\r\n                    action: () => {\r\n                        const actionBus = window['ActionBus'];\r\n                        if (actionBus && typeof actionBus.execute === 'function') {\r\n                            actionBus.execute('session:export');\r\n                        }\r\n                    },\r\n                },\r\n                {\r\n                    id: 'session-import',\r\n                    label: () => translate('menu.session.import'),\r\n                    icon: 'open',\r\n                    action: () => {\r\n                        const actionBus = window['ActionBus'];\r\n                        if (actionBus && typeof actionBus.execute === 'function') {\r\n                            actionBus.execute('session:import');\r\n                        }\r\n                    },\r\n                },\r\n                { type: 'separator' },\r\n                {\r\n                    id: 'finder-close',\r\n                    label: () => translate('menu.finder.close'),\r\n                    shortcut: '\u2318W',\r\n                    disabled: () => !(context && context.dialog),\r\n                    icon: 'close',\r\n                    action: () => closeContextWindow(context),\r\n                },\r\n            ],\r\n        },\r\n        createWindowMenuSection(context),\r\n        createHelpMenuSection(context, {\r\n            itemKey: 'menu.finder.help',\r\n            itemIcon: 'help',\r\n        }),\r\n    ];\r\n}\r\n\r\nfunction buildSettingsMenuDefinition(context: MenuContext) {\r\n    return [\r\n        {\r\n            id: 'file',\r\n            label: () => translate('menu.sections.file'),\r\n            items: [\r\n                {\r\n                    id: 'settings-close',\r\n                    label: () => translate('menu.settings.close'),\r\n                    shortcut: '\u2318W',\r\n                    disabled: () => !(context && context.dialog),\r\n                    icon: 'close',\r\n                    action: () => closeContextWindow(context),\r\n                },\r\n            ],\r\n        },\r\n        createWindowMenuSection(context),\r\n        createHelpMenuSection(context, {\r\n            itemKey: 'menu.settings.help',\r\n            infoModalId: 'settings-modal',\r\n            itemIcon: 'help',\r\n        }),\r\n    ];\r\n}\r\n\r\nfunction buildTextEditorMenuDefinition(context: MenuContext) {\r\n    return [\r\n        {\r\n            id: 'file',\r\n            label: () => translate('menu.sections.file'),\r\n            items: [\r\n                {\r\n                    id: 'text-new',\r\n                    label: () => translate('menu.text.newFile'),\r\n                    shortcut: '\u2318N',\r\n                    icon: 'newFile',\r\n                    action: () => {\r\n                        // Create new multi-window TextEditor\r\n                        if (\r\n                            window['TextEditorWindow'] &&\r\n                            typeof window['TextEditorWindow'].create === 'function'\r\n                        ) {\r\n                            const registry = window['WindowRegistry'];\r\n                            const count = registry?.getWindowCount?.('text-editor') || 0;\r\n                            window['TextEditorWindow'].create({\r\n                                title: `Untitled ${count + 1}`,\r\n                            });\r\n                        } else {\r\n                            // Fallback to legacy action\r\n                            sendTextEditorMenuAction('file:new');\r\n                        }\r\n                    },\r\n                },\r\n                {\r\n                    id: 'text-open',\r\n                    label: () => translate('menu.text.open'),\r\n                    shortcut: '\u2318O',\r\n                    icon: 'open',\r\n                    action: () => sendTextEditorMenuAction('file:open'),\r\n                },\r\n                {\r\n                    id: 'text-save',\r\n                    label: () => translate('menu.text.save'),\r\n                    shortcut: '\u2318S',\r\n                    icon: 'save',\r\n                    action: () => sendTextEditorMenuAction('file:save'),\r\n                },\r\n            ],\r\n        },\r\n        {\r\n            id: 'edit',\r\n            label: () => translate('menu.sections.edit'),\r\n            items: [\r\n                {\r\n                    id: 'text-undo',\r\n                    label: () => translate('menu.text.undo'),\r\n                    shortcut: '\u2318Z',\r\n                    icon: 'undo',\r\n                    action: () => sendTextEditorMenuAction('edit:undo'),\r\n                },\r\n                {\r\n                    id: 'text-redo',\r\n                    label: () => translate('menu.text.redo'),\r\n                    shortcut: '\u21E7\u2318Z',\r\n                    icon: 'redo',\r\n                    action: () => sendTextEditorMenuAction('edit:redo'),\r\n                },\r\n                { type: 'separator' },\r\n                {\r\n                    id: 'text-cut',\r\n                    label: () => translate('menu.text.cut'),\r\n                    shortcut: '\u2318X',\r\n                    icon: 'cut',\r\n                    action: () => sendTextEditorMenuAction('edit:cut'),\r\n                },\r\n                {\r\n                    id: 'text-copy',\r\n                    label: () => translate('menu.text.copy'),\r\n                    shortcut: '\u2318C',\r\n                    icon: 'copy',\r\n                    action: () => sendTextEditorMenuAction('edit:copy'),\r\n                },\r\n                {\r\n                    id: 'text-paste',\r\n                    label: () => translate('menu.text.paste'),\r\n                    shortcut: '\u2318V',\r\n                    icon: 'paste',\r\n                    action: () => sendTextEditorMenuAction('edit:paste'),\r\n                },\r\n                { type: 'separator' },\r\n                {\r\n                    id: 'text-select-all',\r\n                    label: () => translate('menu.text.selectAll'),\r\n                    shortcut: '\u2318A',\r\n                    icon: 'selectAll',\r\n                    action: () => sendTextEditorMenuAction('edit:selectAll'),\r\n                },\r\n            ],\r\n        },\r\n        {\r\n            id: 'view',\r\n            label: () => translate('menu.sections.view'),\r\n            items: [\r\n                {\r\n                    id: 'text-toggle-wrap',\r\n                    label: () => translate('menu.text.toggleWrap'),\r\n                    shortcut: '\u2325\u2318W',\r\n                    icon: 'wrap',\r\n                    action: () => sendTextEditorMenuAction('view:toggleWrap'),\r\n                },\r\n            ],\r\n        },\r\n        createWindowMenuSection(context),\r\n        createHelpMenuSection(context, {\r\n            itemKey: 'menu.text.help',\r\n            infoModalId: 'text-modal',\r\n            itemIcon: 'help',\r\n        }),\r\n    ];\r\n}\r\n\r\nfunction buildImageViewerMenuDefinition(context: MenuContext) {\r\n    const state = window['getImageViewerState']\r\n        ? window['getImageViewerState']()\r\n        : { hasImage: false };\r\n    return [\r\n        {\r\n            id: 'file',\r\n            label: () => translate('menu.sections.file'),\r\n            items: [\r\n                {\r\n                    id: 'image-open-tab',\r\n                    label: () => translate('menu.image.openInTab'),\r\n                    disabled: !state.hasImage,\r\n                    icon: 'imageOpen',\r\n                    action: () => {\r\n                        if (window['openActiveImageInNewTab']) window['openActiveImageInNewTab']();\r\n                    },\r\n                },\r\n                {\r\n                    id: 'image-download',\r\n                    label: () => translate('menu.image.saveImage'),\r\n                    disabled: !state.hasImage,\r\n                    icon: 'download',\r\n                    action: () => {\r\n                        if (window['downloadActiveImage']) window['downloadActiveImage']();\r\n                    },\r\n                },\r\n                { type: 'separator' },\r\n                {\r\n                    id: 'image-close',\r\n                    label: () => translate('menu.image.close'),\r\n                    shortcut: '\u2318W',\r\n                    disabled: () => !(context && context.dialog),\r\n                    icon: 'close',\r\n                    action: () => closeContextWindow(context),\r\n                },\r\n            ],\r\n        },\r\n        createWindowMenuSection(context),\r\n        createHelpMenuSection(context, {\r\n            itemKey: 'menu.image.help',\r\n            infoModalId: 'image-modal',\r\n            itemIcon: 'help',\r\n        }),\r\n    ];\r\n}\r\n\r\nfunction buildAboutMenuDefinition(context: MenuContext) {\r\n    return [\r\n        {\r\n            id: 'file',\r\n            label: () => translate('menu.sections.file'),\r\n            items: [\r\n                {\r\n                    id: 'about-close',\r\n                    label: () => translate('menu.about.close'),\r\n                    shortcut: '\u2318W',\r\n                    disabled: () => !(context && context.dialog),\r\n                    icon: 'close',\r\n                    action: () => closeContextWindow(context),\r\n                },\r\n            ],\r\n        },\r\n        createWindowMenuSection(context),\r\n        createHelpMenuSection(context, {\r\n            itemKey: 'menu.about.help',\r\n            infoModalId: 'about-modal',\r\n            itemIcon: 'info',\r\n        }),\r\n    ];\r\n}\r\n\r\nfunction buildProgramInfoMenuDefinition(context: MenuContext) {\r\n    return [\r\n        {\r\n            id: 'file',\r\n            label: () => translate('menu.sections.file'),\r\n            items: [\r\n                {\r\n                    id: 'program-info-close',\r\n                    label: () => translate('menu.programInfo.close'),\r\n                    shortcut: '\u2318W',\r\n                    disabled: () => !(context && context.dialog),\r\n                    icon: 'close',\r\n                    action: () => closeContextWindow(context),\r\n                },\r\n            ],\r\n        },\r\n        createWindowMenuSection(context),\r\n    ];\r\n}\r\n\r\nfunction buildTerminalMenuDefinition(context: any) {\r\n    // Determine active TerminalWindow (multi-window system)\r\n    const registry = window['WindowRegistry'];\r\n    const activeWin = registry?.getActiveWindow?.();\r\n    const isTerminalActive = activeWin?.type === 'terminal';\r\n    const terminalWin = isTerminalActive ? activeWin : null;\r\n\r\n    return [\r\n        {\r\n            id: 'file',\r\n            label: () => translate('menu.sections.file'),\r\n            items: [\r\n                // New Terminal Window\r\n                {\r\n                    id: 'terminal-new-window',\r\n                    label: () => translate('menu.terminal.newWindow'),\r\n                    shortcut: '\u2318N',\r\n                    icon: 'new',\r\n                    action: () => {\r\n                        if (window['TerminalWindow']?.create) {\r\n                            const count = registry?.getWindowCount?.('terminal') || 0;\r\n                            window['TerminalWindow'].create({ title: `Terminal ${count + 1}` });\r\n                        } else if (window['TerminalInstanceManager']?.createInstance) {\r\n                            window['TerminalInstanceManager'].createInstance();\r\n                        }\r\n                    },\r\n                },\r\n                // New Tab in active Terminal window\r\n                {\r\n                    id: 'terminal-new-tab',\r\n                    label: () => translate('menu.terminal.newTab'),\r\n                    shortcut: '\u2318T',\r\n                    icon: 'tabNew',\r\n                    disabled: () => !terminalWin,\r\n                    action: () => {\r\n                        if (terminalWin?.createSession) terminalWin.createSession();\r\n                    },\r\n                },\r\n                // Duplicate current tab\r\n                {\r\n                    id: 'terminal-duplicate-tab',\r\n                    label: () => translate('menu.terminal.duplicateTab'),\r\n                    shortcut: '\u2325\u2318D',\r\n                    icon: 'tabDuplicate',\r\n                    disabled: () => !terminalWin || !terminalWin.activeTabId,\r\n                    action: () => {\r\n                        const activeId = terminalWin?.activeTabId;\r\n                        if (!activeId) return;\r\n                        const tabs = (terminalWin as any).tabs as Map<string, any>;\r\n                        const orig = tabs.get(activeId);\r\n                        if (orig && terminalWin.createSession) {\r\n                            const newSession = terminalWin.createSession(orig.title + ' Copy');\r\n                            // Optionally copy buffer if available\r\n                            if (orig.buffer && newSession && (newSession as any).appendOutput) {\r\n                                (newSession as any).appendOutput(orig.buffer);\r\n                            }\r\n                        }\r\n                    },\r\n                },\r\n                { type: 'separator' },\r\n                // Close current tab (\u2318W). If only one tab: close window.\r\n                {\r\n                    id: 'terminal-close-tab',\r\n                    label: () => translate('menu.terminal.closeTab'),\r\n                    shortcut: '\u2318W',\r\n                    icon: 'tabClose',\r\n                    disabled: () => !terminalWin || !terminalWin.activeTabId,\r\n                    action: () => {\r\n                        if (!terminalWin) return;\r\n                        const tabs: Map<string, any> = (terminalWin as any).tabs;\r\n                        if (tabs.size <= 1) {\r\n                            terminalWin.close?.();\r\n                            return;\r\n                        }\r\n                        const activeId = terminalWin.activeTabId;\r\n                        if (activeId) terminalWin.removeTab(activeId);\r\n                    },\r\n                },\r\n                // Close entire window (\u21E7\u2318W)\r\n                {\r\n                    id: 'terminal-close-window',\r\n                    label: () => translate('menu.terminal.closeWindow'),\r\n                    shortcut: '\u21E7\u2318W',\r\n                    icon: 'close',\r\n                    disabled: () => !(context && context.dialog),\r\n                    action: () => closeContextWindow(context),\r\n                },\r\n            ],\r\n        },\r\n        {\r\n            id: 'edit',\r\n            label: () => translate('menu.sections.edit'),\r\n            items: [\r\n                // Clear terminal scrollback/output\r\n                {\r\n                    id: 'terminal-clear',\r\n                    label: () => translate('menu.terminal.clear'),\r\n                    shortcut: '\u2318K',\r\n                    icon: 'clear',\r\n                    action: () => {\r\n                        if (!terminalWin) return;\r\n                        const activeId = terminalWin.activeTabId;\r\n                        const tabs: Map<string, any> = (terminalWin as any).tabs;\r\n                        const tab = activeId ? tabs.get(activeId) : null;\r\n                        const inst = tab || null;\r\n                        if (inst?.clearOutput) inst.clearOutput();\r\n                    },\r\n                },\r\n                { type: 'separator' },\r\n                // Basic clipboard actions (delegate to focused input)\r\n                {\r\n                    id: 'terminal-copy',\r\n                    label: () => translate('menu.terminal.copy'),\r\n                    shortcut: '\u2318C',\r\n                    icon: 'copy',\r\n                    action: () => {\r\n                        const input = document.querySelector('#terminal-input') as\r\n                            | HTMLInputElement\r\n                            | HTMLTextAreaElement\r\n                            | null;\r\n                        if (input) input.select();\r\n                        document.execCommand?.('copy');\r\n                    },\r\n                },\r\n                {\r\n                    id: 'terminal-paste',\r\n                    label: () => translate('menu.terminal.paste'),\r\n                    shortcut: '\u2318V',\r\n                    icon: 'paste',\r\n                    action: async () => {\r\n                        const input = document.querySelector('#terminal-input') as\r\n                            | HTMLInputElement\r\n                            | HTMLTextAreaElement\r\n                            | null;\r\n                        if (!input) return;\r\n                        try {\r\n                            const text = await navigator.clipboard.readText();\r\n                            input.value += text;\r\n                            input.dispatchEvent(new Event('input'));\r\n                        } catch (e) {\r\n                            console.warn('Clipboard read failed', e);\r\n                        }\r\n                    },\r\n                },\r\n                {\r\n                    id: 'terminal-select-all',\r\n                    label: () => translate('menu.terminal.selectAll'),\r\n                    shortcut: '\u2318A',\r\n                    icon: 'selectAll',\r\n                    action: () => {\r\n                        const input = document.querySelector('#terminal-input') as\r\n                            | HTMLInputElement\r\n                            | HTMLTextAreaElement\r\n                            | null;\r\n                        if (input) input.select();\r\n                    },\r\n                },\r\n            ],\r\n        },\r\n        createWindowMenuSection(context),\r\n        createHelpMenuSection(context, {\r\n            itemKey: 'menu.terminal.help',\r\n            infoModalId: 'terminal-modal',\r\n            itemIcon: 'help',\r\n        }),\r\n    ];\r\n}\r\n\r\nfunction createWindowMenuSection(context: MenuContext) {\r\n    return {\r\n        id: 'window',\r\n        label: () => translate('menu.sections.window'),\r\n        items: getWindowMenuItems(context),\r\n    };\r\n}\r\n\r\nfunction getWindowMenuItems(context: MenuContext) {\r\n    const dialog = context && (context.dialog as any);\r\n    const hasDialog = Boolean(dialog && typeof dialog.close === 'function');\r\n    const items: any[] = [\r\n        {\r\n            id: 'window-minimize',\r\n            label: () => translate('menu.window.minimize'),\r\n            shortcut: '\u2318M',\r\n            disabled: !hasDialog,\r\n            icon: 'windowMinimize',\r\n            action: () => {\r\n                if (dialog && typeof dialog.minimize === 'function') dialog.minimize();\r\n            },\r\n        },\r\n        {\r\n            id: 'window-zoom',\r\n            label: () => translate('menu.window.zoom'),\r\n            shortcut: '\u2303\u2318F',\r\n            disabled: !hasDialog,\r\n            icon: 'windowZoom',\r\n            action: () => {\r\n                if (dialog && typeof dialog.toggleMaximize === 'function') dialog.toggleMaximize();\r\n            },\r\n        },\r\n    ];\r\n    const multiInstanceItems = getMultiInstanceMenuItems(context);\r\n    if (multiInstanceItems.length > 0) {\r\n        items.push({ type: 'separator' });\r\n        items.push(...multiInstanceItems);\r\n    }\r\n    items.push(\r\n        { type: 'separator' },\r\n        {\r\n            id: 'window-all-front',\r\n            label: () => translate('menu.window.bringToFront'),\r\n            disabled: !hasAnyVisibleDialog(),\r\n            icon: 'windowFront',\r\n            action: () => {\r\n                if (window['bringAllWindowsToFront']) window['bringAllWindowsToFront']();\r\n            },\r\n        },\r\n        { type: 'separator' },\r\n        {\r\n            id: 'window-close',\r\n            label: () => translate('menu.window.close'),\r\n            shortcut: '\u2318W',\r\n            disabled: !hasDialog,\r\n            icon: 'close',\r\n            action: () => closeContextWindow(context),\r\n        }\r\n    );\r\n    return items;\r\n}\r\n\r\nfunction getMultiInstanceMenuItems(context: MenuContext) {\r\n    const items: any[] = [];\r\n    let manager: any = null;\r\n    let typeLabel: string | null = null;\r\n    let newInstanceKey: string | null = null;\r\n    const modalId = context?.modalId;\r\n    // Also derive active window type from WindowRegistry for multi-window Terminal\r\n    const registry = window['WindowRegistry'];\r\n    const activeWindowType = registry?.getActiveWindow?.()?.type || null;\r\n\r\n    // Use WindowRegistry for Terminal (modern multi-window system)\r\n    if (modalId === 'terminal-modal' || activeWindowType === 'terminal') {\r\n        const terminalWindow = window['TerminalWindow'];\r\n\r\n        if (registry && terminalWindow) {\r\n            typeLabel = 'Terminal';\r\n            newInstanceKey = 'menu.window.newTerminal';\r\n\r\n            items.push({\r\n                id: 'window-new-instance',\r\n                label: () => translate(newInstanceKey || 'menu.window.newWindow'),\r\n                shortcut: '\u2318N',\r\n                icon: 'new',\r\n                action: () => {\r\n                    const count = registry.getWindowCount?.('terminal') || 0;\r\n                    terminalWindow.create({ title: `Terminal ${count + 1}` });\r\n                },\r\n            });\r\n\r\n            const windows = registry.getAllWindows?.('terminal') || [];\r\n            if (windows.length > 1) {\r\n                items.push({ type: 'separator' });\r\n                windows.forEach((win: any, index: number) => {\r\n                    const isActive = registry.getActiveWindow?.()?.windowId === win.windowId;\r\n                    const numberLabel = `Terminal ${index + 1}`;\r\n                    items.push({\r\n                        id: `window-instance-${win.windowId}`,\r\n                        label: () => `${isActive ? '\u2713 ' : ''}${numberLabel}`,\r\n                        shortcut: index < 9 ? `\u2318${index + 1}` : undefined,\r\n                        action: () => {\r\n                            win.focus?.();\r\n                        },\r\n                    });\r\n                });\r\n                items.push(\r\n                    { type: 'separator' },\r\n                    {\r\n                        id: 'window-close-all',\r\n                        label: () => translate('menu.window.closeAll'),\r\n                        icon: 'close',\r\n                        action: () => {\r\n                            if (confirm(`Alle ${windows.length} Terminal-Fenster schlie\u00DFen?`)) {\r\n                                windows.forEach((w: any) => w.close?.());\r\n                            }\r\n                        },\r\n                    }\r\n                );\r\n            }\r\n            return items;\r\n        }\r\n    }\r\n\r\n    // Legacy fallback for Finder and TextEditor\r\n    if (modalId === 'projects-modal' && window['FinderInstanceManager']) {\r\n        manager = window['FinderInstanceManager'];\r\n        typeLabel = 'Finder';\r\n        newInstanceKey = 'menu.window.newFinder';\r\n    } else if (modalId === 'terminal-modal' && window['TerminalInstanceManager']) {\r\n        manager = window['TerminalInstanceManager'];\r\n        typeLabel = 'Terminal';\r\n        newInstanceKey = 'menu.window.newTerminal';\r\n    } else if (modalId === 'text-modal' && window['TextEditorInstanceManager']) {\r\n        manager = window['TextEditorInstanceManager'];\r\n        typeLabel = 'Editor';\r\n        newInstanceKey = 'menu.window.newEditor';\r\n    }\r\n    if (!manager) return items;\r\n    items.push({\r\n        id: 'window-new-instance',\r\n        label: () => translate(newInstanceKey || 'menu.window.newWindow'),\r\n        shortcut: '\u2318N',\r\n        icon: 'new',\r\n        action: () => {\r\n            const count = manager.getInstanceCount();\r\n            manager.createInstance({ title: `${typeLabel} ${count + 1}` } as any);\r\n        },\r\n    });\r\n    const instances = manager.getAllInstances();\r\n    if (instances.length > 1) {\r\n        items.push({ type: 'separator' });\r\n        instances.forEach((instance: any, index: number) => {\r\n            const isActive = manager.getActiveInstance()?.instanceId === instance.instanceId;\r\n            // Normalize label to always include index-based numbering for stable UI/test selection\r\n            const numberLabel = `${typeLabel} ${index + 1}`;\r\n            items.push({\r\n                id: `window-instance-${instance.instanceId}`,\r\n                label: () => `${isActive ? '\u2713 ' : ''}${numberLabel}`,\r\n                shortcut: index < 9 ? `\u2318${index + 1}` : undefined,\r\n                action: () => {\r\n                    manager.setActiveInstance(instance.instanceId);\r\n                    // Also update visibility via MultiInstanceIntegration\r\n                    const integration = (window as any).multiInstanceIntegration;\r\n                    if (integration && typeof integration.updateInstanceVisibility === 'function') {\r\n                        // Determine type based on manager\r\n                        let type: string | null = null;\r\n                        if (manager === (window as any).FinderInstanceManager) type = 'finder';\r\n                        else if (manager === (window as any).TerminalInstanceManager)\r\n                            type = 'terminal';\r\n                        else if (manager === (window as any).TextEditorInstanceManager)\r\n                            type = 'text-editor';\r\n\r\n                        if (type) {\r\n                            integration.updateInstanceVisibility(type);\r\n                        }\r\n                    }\r\n                },\r\n            });\r\n        });\r\n        items.push(\r\n            { type: 'separator' },\r\n            {\r\n                id: 'window-close-all',\r\n                label: () => translate('menu.window.closeAll'),\r\n                icon: 'close',\r\n                action: () => {\r\n                    const base = translate('menu.window.closeAllConfirm');\r\n                    const confirmMsg =\r\n                        typeof base === 'string' && base !== 'menu.window.closeAllConfirm'\r\n                            ? base\r\n                            : `Close all ${typeLabel} (${instances.length})?`;\r\n                    if (confirm(confirmMsg)) {\r\n                        manager.destroyAllInstances();\r\n                        // If we closed all instances for a modal-backed window, also hide the modal\r\n                        const targetModal = (context as any)?.modalId;\r\n                        if (targetModal) {\r\n                            if (typeof window['API']?.window?.close === 'function') {\r\n                                window['API'].window.close(targetModal);\r\n                            } else {\r\n                                const el = document.getElementById(targetModal);\r\n                                if (el && !el.classList.contains('hidden')) {\r\n                                    const domUtils = (window as any).DOMUtils;\r\n                                    if (domUtils && typeof domUtils.hide === 'function') {\r\n                                        domUtils.hide(el);\r\n                                    } else {\r\n                                        el.classList.add('hidden');\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n            }\r\n        );\r\n    }\r\n    return items;\r\n}\r\n\r\nfunction createHelpMenuSection(context: any, overrides: any = {}) {\r\n    const sectionKey = overrides.sectionKey || 'menu.sections.help';\r\n    const itemKey = overrides.itemKey || 'menu.help.showHelp';\r\n    const infoModalId = overrides.infoModalId || context.modalId || null;\r\n    return {\r\n        id: overrides.id || 'help',\r\n        label: () => translate(sectionKey),\r\n        items: [\r\n            {\r\n                id: 'help-show-info',\r\n                label: () => translate(itemKey),\r\n                icon: overrides.itemIcon || 'help',\r\n                action: () => {\r\n                    if (window['openProgramInfoFromMenu'])\r\n                        window['openProgramInfoFromMenu'](infoModalId);\r\n                },\r\n            },\r\n        ],\r\n    };\r\n}\r\n\r\n// --- Rendering ---\r\nconst menuDefinitions: any = {\r\n    default: buildDefaultMenuDefinition,\r\n    'projects-modal': buildFinderMenuDefinition,\r\n    'settings-modal': buildSettingsMenuDefinition,\r\n    'text-modal': buildTextEditorMenuDefinition,\r\n    'image-modal': buildImageViewerMenuDefinition,\r\n    'about-modal': buildAboutMenuDefinition,\r\n    'program-info-modal': buildProgramInfoMenuDefinition,\r\n    'terminal-modal': buildTerminalMenuDefinition,\r\n};\r\n\r\nlet currentMenuModalId: string | null = null;\r\n\r\nexport function renderApplicationMenu(activeModalId?: string | null) {\r\n    const container = document.getElementById('menubar-links');\r\n    if (!container) return;\r\n    // Detect active window type from WindowRegistry to switch menu dynamically\r\n    const registry = (window as any).WindowRegistry;\r\n    const activeType = registry?.getActiveWindow?.()?.type;\r\n    // If a Terminal window is focused but no explicit terminal-modal passed, force terminal modal key\r\n    if (activeType === 'terminal' && activeModalId !== 'terminal-modal') {\r\n        activeModalId = 'terminal-modal';\r\n    }\r\n    const modalKey = activeModalId && menuDefinitions[activeModalId] ? activeModalId : 'default';\r\n    const builder = menuDefinitions[modalKey] || menuDefinitions.default;\r\n    const context = createMenuContext(activeModalId || null);\r\n    const sections =\r\n        typeof builder === 'function' ? builder(context) : Array.isArray(builder) ? builder : [];\r\n    container.innerHTML = '';\r\n    menuActionHandlers.clear();\r\n    menuActionIdCounter = 0;\r\n    currentMenuModalId = activeModalId || null;\r\n    if (!Array.isArray(sections) || sections.length === 0) return;\r\n    sections.forEach((section: any, sectionIndex: number) => {\r\n        if (!section) return;\r\n        const items = normalizeMenuItems(section.items, context);\r\n        if (!items.length) return;\r\n        const trigger = document.createElement('div');\r\n        trigger.className = 'menubar-trigger';\r\n        const button = document.createElement('button');\r\n        button.type = 'button';\r\n        button.className = 'menubar-item';\r\n        button.dataset.menubarTriggerButton = 'true';\r\n        const label = typeof section.label === 'function' ? section.label(context) : section.label;\r\n        button.textContent = label || '';\r\n        const sectionId = section.id || `section-${sectionIndex}`;\r\n        const buttonId = `menubar-menu-${sectionId}`;\r\n        const dropdownId = `menu-dropdown-${sectionId}`;\r\n        button.id = buttonId;\r\n        button.setAttribute('aria-haspopup', 'menu');\r\n        button.setAttribute('aria-expanded', 'false');\r\n        button.setAttribute('aria-controls', dropdownId);\r\n        const dropdown = document.createElement('ul');\r\n        dropdown.id = dropdownId;\r\n        dropdown.className = 'menu-dropdown hidden';\r\n        dropdown.setAttribute('role', 'menu');\r\n        dropdown.setAttribute('aria-labelledby', buttonId);\r\n        items.forEach(item => {\r\n            if (item.type === 'separator') {\r\n                const separator = document.createElement('li');\r\n                separator.className = 'menu-separator';\r\n                separator.setAttribute('role', 'separator');\r\n                separator.setAttribute('aria-hidden', 'true');\r\n                dropdown.appendChild(separator);\r\n                return;\r\n            }\r\n            const li = document.createElement('li');\r\n            li.setAttribute('role', 'none');\r\n            const tagName = item.href ? 'a' : 'button';\r\n            const actionEl = document.createElement(tagName) as any;\r\n            actionEl.className = 'menu-item';\r\n            if (tagName === 'button') actionEl.type = 'button';\r\n            else {\r\n                actionEl.href = item.href;\r\n                if (item.external) {\r\n                    actionEl.rel = 'noopener noreferrer';\r\n                    actionEl.target = '_blank';\r\n                }\r\n            }\r\n            const itemLabel =\r\n                item.label !== null\r\n                    ? typeof item.label === 'function'\r\n                        ? item.label(context)\r\n                        : item.label\r\n                    : '';\r\n            const labelSpan = document.createElement('span');\r\n            labelSpan.className = 'menu-item-label';\r\n            if (item.icon && (window as any).IconSystem) {\r\n                const iconSpan = document.createElement('span');\r\n                iconSpan.className = 'menu-item-icon';\r\n                const iconSvg = (window as any).IconSystem.getMenuIconSvg\r\n                    ? (window as any).IconSystem.getMenuIconSvg(item.icon)\r\n                    : '';\r\n                if ((window as any).IconSystem.renderIconIntoElement)\r\n                    (window as any).IconSystem.renderIconIntoElement(iconSpan, iconSvg, item.icon);\r\n                labelSpan.appendChild(iconSpan);\r\n            }\r\n            labelSpan.appendChild(document.createTextNode(itemLabel));\r\n            actionEl.appendChild(labelSpan);\r\n            if (item.shortcut) {\r\n                const shortcutSpan = document.createElement('span');\r\n                shortcutSpan.className = 'menu-item-shortcut';\r\n                shortcutSpan.textContent =\r\n                    typeof item.shortcut === 'function' ? item.shortcut() : item.shortcut;\r\n                actionEl.appendChild(shortcutSpan);\r\n            }\r\n            actionEl.setAttribute('role', 'menuitem');\r\n            if (item.title) actionEl.title = item.title;\r\n            const isDisabled = Boolean(item.disabled);\r\n            if (isDisabled) {\r\n                actionEl.setAttribute('aria-disabled', 'true');\r\n                if (tagName === 'button') actionEl.disabled = true;\r\n            } else if (typeof item.action === 'function') {\r\n                const actionId = registerMenuAction(item.action as MenuHandler);\r\n                if (actionId) actionEl.dataset.menuAction = actionId;\r\n            }\r\n            if (item.href && typeof item.onClick === 'function') {\r\n                actionEl.addEventListener('click', (event: Event) => {\r\n                    const result = (item.onClick as (e: Event) => boolean | void)(event);\r\n                    if (result === false) event.preventDefault();\r\n                });\r\n            }\r\n            li.appendChild(actionEl);\r\n            dropdown.appendChild(li);\r\n        });\r\n        if (!dropdown.childElementCount) return;\r\n        trigger.appendChild(button);\r\n        trigger.appendChild(dropdown);\r\n        container.appendChild(trigger);\r\n        if ((window as any).bindDropdownTrigger)\r\n            (window as any).bindDropdownTrigger(button, { hoverRequiresOpen: true });\r\n    });\r\n}\r\n\r\nexport function handleMenuActionActivation(event: Event) {\r\n    const target =\r\n        event.target instanceof Element\r\n            ? (event.target as Element).closest('[data-menu-action]')\r\n            : null;\r\n    if (!target) return;\r\n    const actionId = target.getAttribute('data-menu-action');\r\n    const handler = actionId ? menuActionHandlers.get(actionId) : null;\r\n    if (typeof handler !== 'function') return;\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    if ((window as any).hideMenuDropdowns) (window as any).hideMenuDropdowns();\r\n    try {\r\n        handler();\r\n    } catch (err) {\r\n        console.error('Error executing menu action:', err);\r\n    }\r\n}\r\n\r\nfunction closeContextWindow(context: any) {\r\n    const dialog = context && context.dialog;\r\n    if (dialog && typeof dialog.close === 'function') dialog.close();\r\n}\r\n\r\nfunction hasAnyVisibleDialog() {\r\n    if (!window['dialogs']) return false;\r\n    return Object.values(window['dialogs']).some((d: any) =>\r\n        d && typeof d.isOpen === 'function' ? d.isOpen() : Boolean(d && d.isOpen)\r\n    );\r\n}\r\n\r\nfunction sendTextEditorMenuAction(actionType: string) {\r\n    if ((window as any).sendTextEditorMenuAction)\r\n        (window as any).sendTextEditorMenuAction(actionType);\r\n}\r\n\r\nfunction createMenuContext(modalId: string | null) {\r\n    const w = window as any;\r\n    // Allow external override but avoid self-recursion when this function is\r\n    // hoisted onto window as a global in non-module script context.\r\n    if (w.createMenuContext && w.createMenuContext !== (createMenuContext as any)) {\r\n        try {\r\n            return w.createMenuContext(modalId);\r\n        } catch (e) {\r\n            console.warn('[Menu] createMenuContext override threw; falling back', e);\r\n        }\r\n    }\r\n    return { modalId: modalId, dialog: null };\r\n}\r\n\r\n// translate() wird zentral aus i18n.ts importiert\r\n\r\nexport function refreshCurrentMenu() {\r\n    renderApplicationMenu(currentMenuModalId);\r\n}\r\n\r\nexport function setupInstanceManagerListeners() {\r\n    const managers = [\r\n        window['FinderInstanceManager'],\r\n        window['TerminalInstanceManager'],\r\n        window['TextEditorInstanceManager'],\r\n    ];\r\n    managers.forEach(manager => {\r\n        if (!manager || !manager.getAllInstances) return;\r\n        const originalCreate = manager.createInstance;\r\n        const originalDestroy = manager.destroyInstance;\r\n        const originalDestroyAll = manager.destroyAllInstances;\r\n        if (originalCreate)\r\n            manager.createInstance = function (...args: any[]) {\r\n                const result = originalCreate.apply(this, args);\r\n                if (result) setTimeout(refreshCurrentMenu, 50);\r\n                return result;\r\n            };\r\n        if (originalDestroy)\r\n            manager.destroyInstance = function (...args: any[]) {\r\n                const result = originalDestroy.apply(this, args);\r\n                setTimeout(refreshCurrentMenu, 50);\r\n                return result;\r\n            };\r\n        if (originalDestroyAll)\r\n            manager.destroyAllInstances = function (...args: any[]) {\r\n                const result = originalDestroyAll.apply(this, args);\r\n                setTimeout(refreshCurrentMenu, 50);\r\n                return result;\r\n            };\r\n    });\r\n}\r\n\r\nif (document.readyState === 'loading')\r\n    document.addEventListener('DOMContentLoaded', setupInstanceManagerListeners);\r\nelse setTimeout(setupInstanceManagerListeners, 100);\r\n\r\n// Export\r\ndeclare global {\r\n    interface Window {\r\n        MenuSystem?: any;\r\n    }\r\n}\r\n(window as any).MenuSystem = {\r\n    renderApplicationMenu,\r\n    handleMenuActionActivation,\r\n    menuDefinitions,\r\n    getCurrentMenuModalId: () => currentMenuModalId,\r\n};\r\nconsole.log('\u2705 MenuSystem loaded');\r\n\r\nexport default {};\r\n", "/*\r\n * src/ts/dock.ts\r\n * Typed port of js/dock.js\r\n */\r\n\r\nimport { getJSON, setJSON } from '../services/storage-utils.js';\r\n\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\n// getDockReservedBottom\r\nexport function getDockReservedBottom(): number {\r\n    try {\r\n        const dock = document.getElementById('dock');\r\n        if (!dock || dock.classList.contains('hidden')) return 0;\r\n        const rect = dock.getBoundingClientRect();\r\n        const vh = Math.max(window.innerHeight || 0, 0);\r\n        if (vh <= 0) return 0;\r\n        return Math.round(Math.max(0, vh - rect.top));\r\n    } catch {\r\n        return 0;\r\n    }\r\n}\r\n\r\n// Dock magnification\r\nexport function initDockMagnification(): void {\r\n    const dock = document.getElementById('dock');\r\n    if (!dock) return;\r\n\r\n    const icons = Array.from(dock.querySelectorAll<HTMLElement>('.dock-icon'));\r\n    if (!icons.length) return;\r\n\r\n    const items = icons.map(icon => {\r\n        const parent = icon.parentElement as HTMLElement | null;\r\n        const tooltip = parent\r\n            ? (parent.querySelector('.dock-tooltip') as HTMLElement | null)\r\n            : null;\r\n        return {\r\n            icon,\r\n            tooltip,\r\n            baseHeight: icon.offsetHeight || 0,\r\n        };\r\n    });\r\n\r\n    let rafId: number | null = null;\r\n    let pointerX: number | null = null;\r\n\r\n    const maxScale = 1.6;\r\n    const minScale = 1.0;\r\n    const radius = 120;\r\n    const sigma = radius / 3;\r\n\r\n    const apply = () => {\r\n        rafId = null;\r\n        if (pointerX === null) {\r\n            items.forEach(({ icon, tooltip }) => {\r\n                icon.style.transform = '';\r\n                icon.style.zIndex = '';\r\n                if (tooltip) {\r\n                    tooltip.style.transform = '';\r\n                    tooltip.style.zIndex = '';\r\n                }\r\n            });\r\n            return;\r\n        }\r\n\r\n        items.forEach(({ icon, tooltip, baseHeight }) => {\r\n            const rect = icon.getBoundingClientRect();\r\n            const centerX = rect.left + rect.width / 2;\r\n            const dx = Math.abs(pointerX! - centerX);\r\n            const influence = Math.exp(-(dx * dx) / (2 * sigma * sigma));\r\n            const scale = Math.max(\r\n                minScale,\r\n                Math.min(maxScale, minScale + (maxScale - minScale) * influence)\r\n            );\r\n\r\n            const base = baseHeight || icon.offsetHeight || 0;\r\n            const translateY = Math.max(0, (scale - 1) * base * 0.5);\r\n\r\n            icon.style.transform = `translateY(-${translateY.toFixed(1)}px) scale(${scale.toFixed(3)})`;\r\n            icon.style.zIndex = scale > 1.01 ? '300' : '';\r\n\r\n            if (tooltip) {\r\n                const lift = Math.max(0, base * (scale - 1) - translateY);\r\n                const gap = 12;\r\n                tooltip.style.transform = `translateY(-${(lift + gap).toFixed(1)}px)`;\r\n                tooltip.style.zIndex = '400';\r\n            }\r\n        });\r\n    };\r\n\r\n    const onMove = (e: MouseEvent) => {\r\n        pointerX = e.clientX;\r\n        if (!rafId) rafId = requestAnimationFrame(apply) as unknown as number;\r\n    };\r\n    const onLeave = () => {\r\n        pointerX = null;\r\n        if (!rafId) rafId = requestAnimationFrame(apply) as unknown as number;\r\n    };\r\n\r\n    dock.addEventListener('mousemove', onMove);\r\n    dock.addEventListener('mouseleave', onLeave);\r\n}\r\n\r\n// Dock drag & drop order persistence\r\nconst DOCK_ORDER_STORAGE_KEY = 'dock:order:v1';\r\n\r\nexport function loadDockOrder(): string[] | null {\r\n    try {\r\n        const parsed = getJSON<string[] | null>(DOCK_ORDER_STORAGE_KEY, null);\r\n        return Array.isArray(parsed) ? parsed : null;\r\n    } catch {\r\n        return null;\r\n    }\r\n}\r\n\r\nexport function saveDockOrder(order: string[] | null | undefined): void {\r\n    try {\r\n        setJSON(DOCK_ORDER_STORAGE_KEY, order || []);\r\n    } catch {\r\n        // ignore\r\n    }\r\n}\r\n\r\nexport function getDockItemId(item: Element | null): string | null {\r\n    if (!item) return null;\r\n    return (item.getAttribute('data-window-id') as string) || null;\r\n}\r\n\r\nexport function getCurrentDockOrder(): string[] {\r\n    const tray = document.querySelector('#dock .dock-tray');\r\n    if (!tray) return [];\r\n    return Array.from(tray.querySelectorAll('.dock-item'))\r\n        .map(it => getDockItemId(it))\r\n        .filter(Boolean) as string[];\r\n}\r\n\r\nexport function applyDockOrder(order: string[] | null | undefined): void {\r\n    if (!Array.isArray(order) || !order.length) return;\r\n    const tray = document.querySelector('#dock .dock-tray');\r\n    if (!tray) return;\r\n    const items = Array.from(tray.querySelectorAll<HTMLElement>('.dock-item'));\r\n    const map = new Map(items.map(it => [getDockItemId(it), it]));\r\n    const fragment = document.createDocumentFragment();\r\n    order.forEach(id => {\r\n        const el = map.get(id as unknown as string);\r\n        if (el) {\r\n            fragment.appendChild(el);\r\n            map.delete(id as unknown as string);\r\n        }\r\n    });\r\n    for (const [, el] of map) fragment.appendChild(el);\r\n    tray.appendChild(fragment);\r\n}\r\n\r\nexport function createPlaceholder(width?: number, height?: number): HTMLElement {\r\n    const ph = document.createElement('div');\r\n    ph.className = 'dock-placeholder';\r\n    ph.setAttribute('aria-hidden', 'true');\r\n    ph.style.width = Math.max(1, Math.round(width || 48)) + 'px';\r\n    ph.style.height = Math.max(1, Math.round(height || 48)) + 'px';\r\n    ph.style.opacity = '0';\r\n    ph.style.pointerEvents = 'none';\r\n    return ph;\r\n}\r\n\r\nexport function initDockDragDrop(): void {\r\n    const dock = document.getElementById('dock');\r\n    const tray = dock ? (dock.querySelector('.dock-tray') as HTMLElement | null) : null;\r\n    if (!dock || !tray) return;\r\n\r\n    const persisted = loadDockOrder();\r\n    if (persisted && persisted.length) applyDockOrder(persisted);\r\n\r\n    let draggedItem: HTMLElement | null = null;\r\n    let placeholder: HTMLElement | null = null;\r\n    let prevUserSelect = '';\r\n    let suppressClicksUntil = 0;\r\n\r\n    const updatePlaceholderSize = (ref: HTMLElement | null) => {\r\n        if (!placeholder || !ref) return;\r\n        try {\r\n            const r = ref.getBoundingClientRect();\r\n            placeholder.style.width = r.width + 'px';\r\n            placeholder.style.height = r.height + 'px';\r\n        } catch {\r\n            // ignore\r\n        }\r\n    };\r\n\r\n    const placeRelativeTo = (targetItem: HTMLElement, clientX: number) => {\r\n        if (!tray || !targetItem) return;\r\n        if (!placeholder) placeholder = createPlaceholder();\r\n        updatePlaceholderSize(draggedItem || targetItem);\r\n        const rect = targetItem.getBoundingClientRect();\r\n        const insertBefore = clientX < rect.left + rect.width / 2;\r\n        tray.insertBefore(placeholder, insertBefore ? targetItem : targetItem.nextSibling);\r\n    };\r\n\r\n    const handleTrayDragOver = (e: DragEvent) => {\r\n        if (!draggedItem) return;\r\n        e.preventDefault();\r\n        if (e.dataTransfer) e.dataTransfer.dropEffect = 'move';\r\n        const items = Array.from(tray.querySelectorAll<HTMLElement>('.dock-item')).filter(\r\n            it => it !== draggedItem\r\n        );\r\n        if (!placeholder) placeholder = createPlaceholder();\r\n        if (items.length === 0) {\r\n            tray.appendChild(placeholder);\r\n            return;\r\n        }\r\n        let target: HTMLElement | null = null;\r\n        for (const it of items) {\r\n            const r = it.getBoundingClientRect();\r\n            if (e.clientX < r.left + r.width / 2) {\r\n                target = it;\r\n                break;\r\n            }\r\n        }\r\n        updatePlaceholderSize(draggedItem || items[0]);\r\n        if (target) tray.insertBefore(placeholder, target);\r\n        else tray.appendChild(placeholder);\r\n    };\r\n\r\n    const onDragStart = function (this: HTMLElement, e: DragEvent) {\r\n        const item = (this as HTMLElement).closest('.dock-item') as HTMLElement | null;\r\n        if (!item) return;\r\n        draggedItem = item;\r\n        prevUserSelect = document.body.style.userSelect || '';\r\n        document.body.style.userSelect = 'none';\r\n        suppressClicksUntil = Date.now() + 250;\r\n        try {\r\n            const icon = (item.querySelector('.dock-icon') as HTMLElement) || item;\r\n            const r = icon.getBoundingClientRect();\r\n            if (e.dataTransfer) {\r\n                e.dataTransfer.setData('text/plain', getDockItemId(item) || '');\r\n                e.dataTransfer.effectAllowed = 'move';\r\n                e.dataTransfer.setDragImage(icon as Element, r.width / 2, r.height / 2);\r\n            }\r\n        } catch {\r\n            // ignore\r\n        }\r\n        const r = item.getBoundingClientRect();\r\n        placeholder = createPlaceholder(r.width, r.height);\r\n        tray.insertBefore(placeholder, item.nextSibling);\r\n    };\r\n\r\n    const onDragOver = (e: DragEvent) => {\r\n        if (!draggedItem) return;\r\n        e.preventDefault();\r\n        if (e.dataTransfer) e.dataTransfer.dropEffect = 'move';\r\n        const target = (e.target as Element).closest('.dock-item') as HTMLElement | null;\r\n        if (!target || target === draggedItem) {\r\n            handleTrayDragOver(e);\r\n            return;\r\n        }\r\n        placeRelativeTo(target, e.clientX);\r\n    };\r\n\r\n    const finalizeDrop = () => {\r\n        if (!draggedItem || !placeholder) return;\r\n        tray.insertBefore(draggedItem, placeholder);\r\n        placeholder.remove();\r\n        placeholder = null;\r\n        const order = getCurrentDockOrder();\r\n        saveDockOrder(order);\r\n    };\r\n\r\n    const onDrop = (e: DragEvent) => {\r\n        if (!draggedItem) return;\r\n        e.preventDefault();\r\n        const phDidNotMove =\r\n            placeholder &&\r\n            placeholder.isConnected &&\r\n            (placeholder.previousSibling === draggedItem ||\r\n                placeholder.nextSibling === draggedItem);\r\n        if (!placeholder || !placeholder.isConnected || phDidNotMove) {\r\n            const x = e.clientX;\r\n            const items = Array.from(tray.querySelectorAll<HTMLElement>('.dock-item')).filter(\r\n                it => it !== draggedItem\r\n            );\r\n            let inserted = false;\r\n            for (const it of items) {\r\n                const r = it.getBoundingClientRect();\r\n                if (x < r.left + r.width / 2) {\r\n                    tray.insertBefore(draggedItem, it);\r\n                    inserted = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (!inserted) tray.appendChild(draggedItem);\r\n            const order = getCurrentDockOrder();\r\n            saveDockOrder(order);\r\n            cleanup();\r\n            return;\r\n        }\r\n        finalizeDrop();\r\n    };\r\n\r\n    const cleanup = () => {\r\n        if (placeholder && placeholder.isConnected) placeholder.remove();\r\n        placeholder = null;\r\n        draggedItem = null;\r\n        document.body.style.userSelect = prevUserSelect;\r\n    };\r\n\r\n    const onDragEnd = () => {\r\n        cleanup();\r\n    };\r\n\r\n    dock.addEventListener(\r\n        'click',\r\n        ev => {\r\n            if (Date.now() < suppressClicksUntil || draggedItem) {\r\n                ev.stopPropagation();\r\n                ev.preventDefault();\r\n            }\r\n        },\r\n        true\r\n    );\r\n\r\n    window.addEventListener('blur', cleanup);\r\n\r\n    const enableDraggable = () => {\r\n        tray.querySelectorAll<HTMLElement>('.dock-item').forEach(it => {\r\n            it.setAttribute('draggable', 'true');\r\n            it.addEventListener('dragstart', onDragStart);\r\n        });\r\n    };\r\n    enableDraggable();\r\n\r\n    tray.addEventListener('dragover', onDragOver as EventListener);\r\n    tray.addEventListener('drop', onDrop as EventListener);\r\n    tray.addEventListener('dragend', onDragEnd as EventListener);\r\n}\r\n\r\nexport function updateDockIndicators(): void {\r\n    const W = window as any;\r\n    const domUtils = W.DOMUtils;\r\n\r\n    const indicatorMappings = [\r\n        { indicatorId: 'finder-indicator', windowType: 'finder' },\r\n        { modalId: 'projects-modal', indicatorId: 'projects-indicator' },\r\n        { modalId: 'settings-modal', indicatorId: 'settings-indicator' },\r\n        { modalId: 'text-modal', indicatorId: 'text-indicator', windowType: 'text-editor' },\r\n        { modalId: 'terminal-modal', indicatorId: 'terminal-indicator', windowType: 'terminal' },\r\n    ];\r\n\r\n    indicatorMappings.forEach(mapping => {\r\n        const indicator = document.getElementById(mapping.indicatorId);\r\n        if (!indicator) return;\r\n\r\n        let hasOpenWindow = false;\r\n\r\n        // Check multi-window system first (for finder, terminal, text-editor)\r\n        if (mapping.windowType && W.WindowRegistry) {\r\n            const windows = W.WindowRegistry.getWindowsByType(mapping.windowType);\r\n            hasOpenWindow = windows && windows.length > 0;\r\n        }\r\n\r\n        // Fallback: check legacy modal system\r\n        if (!hasOpenWindow) {\r\n            const modal = mapping.modalId ? document.getElementById(mapping.modalId) : null;\r\n            if (modal) {\r\n                const minimized = modal.dataset && modal.dataset.minimized === 'true';\r\n                hasOpenWindow = !modal.classList.contains('hidden') || minimized;\r\n            }\r\n        }\r\n\r\n        // Update indicator visibility\r\n        if (hasOpenWindow) {\r\n            if (domUtils && typeof domUtils.show === 'function') {\r\n                domUtils.show(indicator);\r\n            } else {\r\n                indicator.classList.remove('hidden');\r\n            }\r\n        } else {\r\n            if (domUtils && typeof domUtils.hide === 'function') {\r\n                domUtils.hide(indicator);\r\n            } else {\r\n                indicator.classList.add('hidden');\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// Global export for legacy compatibility\r\ndeclare global {\r\n    interface Window {\r\n        DockSystem?: any;\r\n        updateDockIndicators?: any;\r\n    }\r\n}\r\nif (typeof window !== 'undefined') {\r\n    (window as any).DockSystem = {\r\n        getDockReservedBottom,\r\n        initDockMagnification,\r\n        initDockDragDrop,\r\n        updateDockIndicators,\r\n        getCurrentDockOrder,\r\n        loadDockOrder,\r\n        saveDockOrder,\r\n        applyDockOrder,\r\n    };\r\n\r\n    if (typeof (window as any).updateDockIndicators !== 'function') {\r\n        (window as any).updateDockIndicators = updateDockIndicators;\r\n    }\r\n}\r\n\r\nexport default {};\r\n", "/*\r\n * src/ts/dialog.ts\r\n * Typed port of js/dialog.js\r\n */\r\n\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport { getZIndexManager } from '../windows/z-index-manager.js';\r\n\r\nexport class Dialog {\r\n    modal: HTMLElement;\r\n    modalId: string;\r\n    windowEl: HTMLElement | null;\r\n    lastDragPointerX: number | null;\r\n\r\n    constructor(modalId: string) {\r\n        this.modalId = modalId;\r\n        const el = document.getElementById(modalId);\r\n        if (!el) {\r\n            console.error(`Dialog: No element found with id \"${modalId}\"`);\r\n            throw new Error(`No dialog with id ${modalId}`);\r\n        }\r\n        this.modal = el as HTMLElement;\r\n        // Legacy helper may provide an element wrapper\r\n        const helper = (window as any).StorageSystem?.getDialogWindowElement;\r\n        this.windowEl = helper\r\n            ? helper(this.modal)\r\n            : (this.modal.querySelector('.autopointer') as HTMLElement) || this.modal;\r\n        this.lastDragPointerX = null;\r\n        this.init();\r\n    }\r\n\r\n    init() {\r\n        this.makeDraggable();\r\n        this.makeResizable();\r\n        const closeButton = this.modal.querySelector(\r\n            '.draggable-header button[id^=\"close-\"]'\r\n        ) as HTMLElement | null;\r\n        if (closeButton) {\r\n            closeButton.style.cursor = 'pointer';\r\n            (closeButton as any).dataset.dialogAction = 'close';\r\n            if (!(closeButton as any).dataset.dialogBoundClose) {\r\n                (closeButton as any).dataset.dialogBoundClose = 'true';\r\n                closeButton.addEventListener('click', e => {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    this.close();\r\n                });\r\n            }\r\n        }\r\n\r\n        const minimizeEl = this.modal.querySelector(\r\n            '.draggable-header .bg-yellow-500.rounded-full'\r\n        ) as HTMLElement | null;\r\n        const maximizeEl = this.modal.querySelector(\r\n            '.draggable-header .bg-green-500.rounded-full'\r\n        ) as HTMLElement | null;\r\n        if (minimizeEl) {\r\n            minimizeEl.style.cursor = 'pointer';\r\n            minimizeEl.title = minimizeEl.title || 'Minimieren';\r\n            (minimizeEl as any).dataset.dialogAction = 'minimize';\r\n            minimizeEl.addEventListener('click', e => {\r\n                e.stopPropagation();\r\n                this.minimize();\r\n            });\r\n        }\r\n        if (maximizeEl) {\r\n            maximizeEl.style.cursor = 'pointer';\r\n            maximizeEl.title = maximizeEl.title || 'Maximieren';\r\n            (maximizeEl as any).dataset.dialogAction = 'maximize';\r\n            maximizeEl.addEventListener('click', e => {\r\n                e.stopPropagation();\r\n                this.toggleMaximize();\r\n            });\r\n        }\r\n    }\r\n\r\n    open() {\r\n        if (!this.modal) {\r\n            console.error(`Cannot open dialog: modal element is undefined (id: ${this.modalId})`);\r\n            return;\r\n        }\r\n\r\n        // Ensure instance creation for windows that need it\r\n        this._ensureInstanceIfNeeded();\r\n\r\n        // preserve original behavior\r\n        (window as any).hideMenuDropdowns?.();\r\n\r\n        // Use DOMUtils if available, fallback to classList\r\n        const domUtils = (window as any).DOMUtils;\r\n        if (domUtils && typeof domUtils.show === 'function') {\r\n            domUtils.show(this.modal);\r\n        } else {\r\n            this.modal.classList.remove('hidden');\r\n        }\r\n\r\n        if (this.modal && this.modal.dataset) delete (this.modal.dataset as any).minimized;\r\n        this.bringToFront();\r\n        this.enforceMenuBarBoundary();\r\n        (window as any).saveOpenModals?.();\r\n        (window as any).updateDockIndicators?.();\r\n        (window as any).updateProgramLabelByTopModal?.();\r\n    }\r\n\r\n    private _ensureInstanceIfNeeded() {\r\n        // Check if this window has the ensureInstanceOnOpen flag\r\n        const win = window as any;\r\n        const config = win.WindowManager?.getConfig?.(this.modalId);\r\n        if (!config || !config.metadata?.ensureInstanceOnOpen) return;\r\n    }\r\n\r\n    close() {\r\n        if (this.modal.classList.contains('hidden')) return;\r\n\r\n        // Use DOMUtils if available, fallback to classList\r\n        const domUtils = (window as any).DOMUtils;\r\n        if (domUtils && typeof domUtils.hide === 'function') {\r\n            domUtils.hide(this.modal);\r\n        } else {\r\n            this.modal.classList.add('hidden');\r\n        }\r\n\r\n        // Remove from z-index manager stack\r\n        const zIndexManager = getZIndexManager();\r\n        zIndexManager.removeWindow(this.modal.id);\r\n\r\n        (window as any).saveOpenModals?.();\r\n        (window as any).updateDockIndicators?.();\r\n        (window as any).updateProgramLabelByTopModal?.();\r\n    }\r\n\r\n    minimize() {\r\n        if (this.modal.dataset) (this.modal.dataset as any).minimized = 'true';\r\n\r\n        // Use DOMUtils if available, fallback to classList\r\n        const domUtils = (window as any).DOMUtils;\r\n        if (domUtils && typeof domUtils.hide === 'function') {\r\n            if (!this.modal.classList.contains('hidden')) {\r\n                domUtils.hide(this.modal);\r\n            }\r\n        } else {\r\n            if (!this.modal.classList.contains('hidden')) {\r\n                this.modal.classList.add('hidden');\r\n            }\r\n        }\r\n\r\n        (window as any).saveOpenModals?.();\r\n        (window as any).updateDockIndicators?.();\r\n        (window as any).updateProgramLabelByTopModal?.();\r\n    }\r\n\r\n    toggleMaximize() {\r\n        const target = this.windowEl || this.modal;\r\n        if (!target) return;\r\n        this.unsnap({ silent: true });\r\n        const ds = (this.modal.dataset as any) || {};\r\n        const isMax = ds.maximized === 'true';\r\n        if (isMax) {\r\n            if (ds.prevLeft !== undefined) target.style.left = ds.prevLeft;\r\n            if (ds.prevTop !== undefined) target.style.top = ds.prevTop;\r\n            if (ds.prevWidth !== undefined) target.style.width = ds.prevWidth;\r\n            if (ds.prevHeight !== undefined) target.style.height = ds.prevHeight;\r\n            if (ds.prevPosition !== undefined) target.style.position = ds.prevPosition;\r\n            delete ds.maximized;\r\n            delete ds.prevLeft;\r\n            delete ds.prevTop;\r\n            delete ds.prevWidth;\r\n            delete ds.prevHeight;\r\n            delete ds.prevPosition;\r\n            this.enforceMenuBarBoundary();\r\n            (window as any).saveWindowPositions?.();\r\n            return;\r\n        }\r\n        const computed = window.getComputedStyle(target);\r\n        (this.modal.dataset as any).prevLeft = target.style.left || computed.left || '';\r\n        (this.modal.dataset as any).prevTop = target.style.top || computed.top || '';\r\n        (this.modal.dataset as any).prevWidth = target.style.width || computed.width || '';\r\n        (this.modal.dataset as any).prevHeight = target.style.height || computed.height || '';\r\n        (this.modal.dataset as any).prevPosition = target.style.position || computed.position || '';\r\n        const minTop = Math.round((window as any).getMenuBarBottom?.() || 0);\r\n        target.style.position = 'fixed';\r\n        target.style.left = '0px';\r\n        target.style.top = `${minTop}px`;\r\n        target.style.width = '100vw';\r\n        target.style.height = `calc(100vh - ${minTop}px)`;\r\n        try {\r\n            const __dockReserve = (window as any).getDockReservedBottom?.() || 0;\r\n            const __maxHeight = Math.max(0, (window.innerHeight || 0) - minTop - __dockReserve);\r\n            target.style.height = `${__maxHeight}px`;\r\n        } catch {}\r\n        (this.modal.dataset as any).maximized = 'true';\r\n        this.bringToFront();\r\n        (window as any).saveWindowPositions?.();\r\n    }\r\n\r\n    snapTo(side: 'left' | 'right', options: any = {}) {\r\n        const target = this.windowEl || this.modal;\r\n        if (!target) return null;\r\n        if (side !== 'left' && side !== 'right') return null;\r\n        const { silent = false } = options;\r\n        const ds = (this.modal.dataset as any) || {};\r\n        const alreadySnapped = ds.snapped;\r\n        if (!alreadySnapped) {\r\n            const computed = window.getComputedStyle(target);\r\n            ds.prevSnapLeft = target.style.left || computed.left || '';\r\n            ds.prevSnapTop = target.style.top || computed.top || '';\r\n            ds.prevSnapWidth = target.style.width || computed.width || '';\r\n            ds.prevSnapHeight = target.style.height || computed.height || '';\r\n            ds.prevSnapPosition = target.style.position || computed.position || '';\r\n            ds.prevSnapRight = target.style.right || computed.right || '';\r\n            ds.prevSnapBottom = target.style.bottom || computed.bottom || '';\r\n        }\r\n        const metrics = (window as any).computeSnapMetrics?.(side);\r\n        if (!metrics) {\r\n            this.unsnap({ silent: true });\r\n            return null;\r\n        }\r\n        target.style.position = 'fixed';\r\n        target.style.top = `${metrics.top}px`;\r\n        target.style.left = `${metrics.left}px`;\r\n        target.style.width = `${metrics.width}px`;\r\n        target.style.height = `${metrics.height}px`;\r\n        target.style.right = '';\r\n        target.style.bottom = '';\r\n        (this.modal.dataset as any).snapped = side;\r\n        this.bringToFront();\r\n        (window as any).hideSnapPreview?.();\r\n        if (!silent) (window as any).saveWindowPositions?.();\r\n        return side;\r\n    }\r\n\r\n    unsnap(options: any = {}) {\r\n        const target = this.windowEl || this.modal;\r\n        if (!target) return false;\r\n        const { silent = false } = options;\r\n        const ds = (this.modal.dataset as any) || {};\r\n        if (!ds.snapped) return false;\r\n        const restore = (key: string, prop: string) => {\r\n            if (Object.prototype.hasOwnProperty.call(ds, key)) {\r\n                const value = ds[key];\r\n                if (value === '') target.style[prop as any] = '';\r\n                else target.style[prop as any] = value;\r\n                delete ds[key];\r\n            } else {\r\n                target.style[prop as any] = '';\r\n            }\r\n        };\r\n        restore('prevSnapLeft', 'left');\r\n        restore('prevSnapTop', 'top');\r\n        restore('prevSnapWidth', 'width');\r\n        restore('prevSnapHeight', 'height');\r\n        restore('prevSnapPosition', 'position');\r\n        restore('prevSnapRight', 'right');\r\n        restore('prevSnapBottom', 'bottom');\r\n        delete ds.snapped;\r\n        (window as any).hideSnapPreview?.();\r\n        this.enforceMenuBarBoundary();\r\n        if (!silent) (window as any).saveWindowPositions?.();\r\n        return true;\r\n    }\r\n\r\n    applySnapAfterDrag(target: HTMLElement | null, pointerX: number | null) {\r\n        if (!target) {\r\n            (window as any).hideSnapPreview?.();\r\n            return null;\r\n        }\r\n        const candidate = this.getSnapCandidate(target, pointerX);\r\n        if (candidate) {\r\n            this.snapTo(candidate, { silent: true });\r\n            (window as any).hideSnapPreview?.();\r\n            return candidate;\r\n        }\r\n        this.unsnap({ silent: true });\r\n        (window as any).hideSnapPreview?.();\r\n        return null;\r\n    }\r\n\r\n    getSnapCandidate(target: HTMLElement | null, pointerX: number | null) {\r\n        if (!target) return null;\r\n        const viewportWidth = Math.max(window.innerWidth || 0, 0);\r\n        if (viewportWidth <= 0) return null;\r\n        const threshold = Math.max(3, Math.min(14, viewportWidth * 0.0035));\r\n        const rect = target.getBoundingClientRect();\r\n        const pointerDistLeft =\r\n            typeof pointerX === 'number' ? Math.max(0, pointerX) : Math.abs(rect.left);\r\n        if (Math.abs(rect.left) <= threshold || pointerDistLeft <= threshold) return 'left';\r\n        const distRight = viewportWidth - rect.right;\r\n        const pointerDistRight =\r\n            typeof pointerX === 'number'\r\n                ? Math.max(0, viewportWidth - pointerX)\r\n                : Math.abs(distRight);\r\n        if (Math.abs(distRight) <= threshold || pointerDistRight <= threshold) return 'right';\r\n        return null;\r\n    }\r\n\r\n    bringToFront() {\r\n        // Use a robust z-index management system that maintains a sorted window stack\r\n        // and reassigns z-indexes to prevent reaching the maximum\r\n        const zIndexManager = getZIndexManager();\r\n        zIndexManager.bringToFront(this.modal.id, this.modal, this.windowEl);\r\n    }\r\n\r\n    refocus() {\r\n        this.bringToFront();\r\n        (window as any).hideMenuDropdowns?.();\r\n        (window as any).saveOpenModals?.();\r\n        (window as any).updateProgramLabelByTopModal?.();\r\n    }\r\n\r\n    makeDraggable() {\r\n        const header = this.modal.querySelector('.draggable-header') as HTMLElement | null;\r\n        const target = this.windowEl || this.modal;\r\n        if (!header || !target) return;\r\n        header.style.cursor = 'move';\r\n        let offsetX = 0,\r\n            offsetY = 0;\r\n        header.addEventListener('mousedown', (e: MouseEvent) => {\r\n            this.refocus();\r\n            if (\r\n                (e.target as Element).closest &&\r\n                (e.target as Element).closest('button[id^=\"close-\"]')\r\n            )\r\n                return;\r\n            if (\r\n                (e.target as Element).closest &&\r\n                (e.target as Element).closest('[data-dialog-action]')\r\n            )\r\n                return;\r\n            if (this.modal.dataset && (this.modal.dataset as any).maximized === 'true') return;\r\n            const pointerX = e.clientX;\r\n            const pointerY = e.clientY;\r\n            const initialSnapSide = this.modal.dataset ? (this.modal.dataset as any).snapped : null;\r\n            let rect = target.getBoundingClientRect();\r\n            let localOffsetX = pointerX - rect.left;\r\n            let localOffsetY = pointerY - rect.top;\r\n            if (initialSnapSide) {\r\n                const preservedOffsetX = localOffsetX;\r\n                const preservedOffsetY = localOffsetY;\r\n                this.unsnap({ silent: true });\r\n                const minTopAfterUnsnap = (window as any).getMenuBarBottom?.() || 0;\r\n                target.style.position = 'fixed';\r\n                target.style.left = `${pointerX - preservedOffsetX}px`;\r\n                target.style.top = `${Math.max(minTopAfterUnsnap, pointerY - preservedOffsetY)}px`;\r\n                rect = target.getBoundingClientRect();\r\n                localOffsetX = pointerX - rect.left;\r\n                localOffsetY = pointerY - rect.top;\r\n            }\r\n            const computedPosition = window.getComputedStyle(target).position;\r\n            if (computedPosition === 'static' || computedPosition === 'relative') {\r\n                target.style.position = 'fixed';\r\n            } else if (!target.style.position) {\r\n                target.style.position = computedPosition;\r\n            }\r\n            const minTop = (window as any).getMenuBarBottom?.() || 0;\r\n            target.style.left = `${pointerX - localOffsetX}px`;\r\n            target.style.top = `${Math.max(minTop, pointerY - localOffsetY)}px`;\r\n            (window as any).clampWindowToMenuBar?.(target);\r\n            const adjustedRect = target.getBoundingClientRect();\r\n            offsetX = pointerX - adjustedRect.left;\r\n            offsetY = pointerY - adjustedRect.top;\r\n            this.lastDragPointerX = pointerX;\r\n            const overlay = document.createElement('div');\r\n            overlay.style.position = 'fixed';\r\n            overlay.style.top = '0';\r\n            overlay.style.left = '0';\r\n            overlay.style.width = '100%';\r\n            overlay.style.height = '100%';\r\n            overlay.style.zIndex = '9999';\r\n            overlay.style.cursor = 'move';\r\n            overlay.style.backgroundColor = 'transparent';\r\n            document.body.appendChild(overlay);\r\n            let isDragging = true;\r\n            let moved = false;\r\n            const cleanup = (shouldSave = true) => {\r\n                if (!isDragging) return;\r\n                isDragging = false;\r\n                overlay.remove();\r\n                overlay.removeEventListener('mousemove', mouseMoveHandler);\r\n                overlay.removeEventListener('mouseup', mouseUpHandler);\r\n                window.removeEventListener('mouseup', mouseUpHandler);\r\n                window.removeEventListener('blur', blurHandler);\r\n                window.removeEventListener('mousemove', mouseMoveHandler);\r\n                (window as any).hideSnapPreview?.();\r\n                if (shouldSave) {\r\n                    if (moved) {\r\n                        this.applySnapAfterDrag(target, this.lastDragPointerX);\r\n                    } else if (initialSnapSide) {\r\n                        this.snapTo(initialSnapSide, { silent: true });\r\n                    }\r\n                    (window as any).saveWindowPositions?.();\r\n                }\r\n                this.lastDragPointerX = null;\r\n            };\r\n            const mouseMoveHandler = (e2: MouseEvent) => {\r\n                moved = true;\r\n                window.requestAnimationFrame(() => {\r\n                    const newLeft = e2.clientX - offsetX;\r\n                    const newTop = e2.clientY - offsetY;\r\n                    const minTop = (window as any).getMenuBarBottom?.() || 0;\r\n                    target.style.left = newLeft + 'px';\r\n                    target.style.top = Math.max(minTop, newTop) + 'px';\r\n                    this.lastDragPointerX = e2.clientX;\r\n                    const candidate = this.getSnapCandidate(target, this.lastDragPointerX);\r\n                    if (candidate) (window as any).showSnapPreview?.(candidate);\r\n                    else (window as any).hideSnapPreview?.();\r\n                });\r\n            };\r\n            const mouseUpHandler = () => cleanup(true);\r\n            const blurHandler = () => cleanup(true);\r\n            overlay.addEventListener('mousemove', mouseMoveHandler);\r\n            overlay.addEventListener('mouseup', mouseUpHandler);\r\n            window.addEventListener('mousemove', mouseMoveHandler);\r\n            window.addEventListener('mouseup', mouseUpHandler);\r\n            window.addEventListener('blur', blurHandler);\r\n            e.preventDefault();\r\n        });\r\n    }\r\n\r\n    makeResizable() {\r\n        if ((this.modal.dataset as any).noResize === 'true') return;\r\n        const target = this.windowEl || this.modal;\r\n        if (!target) return;\r\n        const existingHandles = target.querySelectorAll('.resizer');\r\n        existingHandles.forEach(handle => handle.remove());\r\n        const computedPosition = window.getComputedStyle(target).position;\r\n        if (!computedPosition || computedPosition === 'static') target.style.position = 'relative';\r\n\r\n        const ensureFixedPosition = () => {\r\n            const computed = window.getComputedStyle(target);\r\n            const rect = target.getBoundingClientRect();\r\n            if (computed.position === 'static' || computed.position === 'relative') {\r\n                target.style.position = 'fixed';\r\n                target.style.left = rect.left + 'px';\r\n                target.style.top = rect.top + 'px';\r\n            } else {\r\n                if (!target.style.left) target.style.left = rect.left + 'px';\r\n                if (!target.style.top) target.style.top = rect.top + 'px';\r\n            }\r\n        };\r\n\r\n        const createHandle = (handle: any) => {\r\n            const resizer = document.createElement('div');\r\n            resizer.classList.add('resizer', `resizer-${handle.name}`);\r\n            Object.assign(resizer.style, {\r\n                position: 'absolute',\r\n                zIndex: '9999',\r\n                backgroundColor: 'transparent',\r\n                pointerEvents: 'auto',\r\n                touchAction: 'none',\r\n                cursor: handle.cursor,\r\n                ...(handle.style || {}),\r\n            });\r\n            target.appendChild(resizer);\r\n            const startResize = (event: MouseEvent) => {\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n                this.refocus();\r\n                ensureFixedPosition();\r\n                const startX = event.clientX;\r\n                const startY = event.clientY;\r\n                const rect = target.getBoundingClientRect();\r\n                const computed = window.getComputedStyle(target);\r\n                const minWidth = parseFloat(computed.minWidth as any) || 240;\r\n                const minHeight = parseFloat(computed.minHeight as any) || 160;\r\n                let startLeft = parseFloat(computed.left as any);\r\n                let startTop = parseFloat(computed.top as any);\r\n                if (!Number.isFinite(startLeft)) startLeft = rect.left;\r\n                if (!Number.isFinite(startTop)) startTop = rect.top;\r\n                const startWidth = rect.width;\r\n                const startHeight = rect.height;\r\n                const overlay = document.createElement('div');\r\n                Object.assign(overlay.style, {\r\n                    position: 'fixed',\r\n                    top: '0',\r\n                    left: '0',\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    zIndex: '9999',\r\n                    cursor: handle.cursor,\r\n                    backgroundColor: 'transparent',\r\n                    touchAction: 'none',\r\n                });\r\n                document.body.appendChild(overlay);\r\n                let resizing = true;\r\n                const applySize = (clientX: number, clientY: number) => {\r\n                    if (!resizing) return;\r\n                    window.requestAnimationFrame(() => {\r\n                        const dx = clientX - startX;\r\n                        const dy = clientY - startY;\r\n                        let newWidth = startWidth;\r\n                        let newHeight = startHeight;\r\n                        let newLeft = startLeft;\r\n                        let newTop = startTop;\r\n                        if (handle.directions.includes('e')) newWidth = startWidth + dx;\r\n                        if (handle.directions.includes('s')) newHeight = startHeight + dy;\r\n                        if (handle.directions.includes('w')) {\r\n                            newWidth = startWidth - dx;\r\n                            newLeft = startLeft + dx;\r\n                        }\r\n                        if (handle.directions.includes('n')) {\r\n                            newHeight = startHeight - dy;\r\n                            newTop = startTop + dy;\r\n                        }\r\n                        if (newWidth < minWidth) {\r\n                            const deficit = minWidth - newWidth;\r\n                            if (handle.directions.includes('w')) newLeft -= deficit;\r\n                            newWidth = minWidth;\r\n                        }\r\n                        if (newHeight < minHeight) {\r\n                            const deficit = minHeight - newHeight;\r\n                            if (handle.directions.includes('n')) newTop -= deficit;\r\n                            newHeight = minHeight;\r\n                        }\r\n                        const minTop = (window as any).getMenuBarBottom?.() || 0;\r\n                        if (handle.directions.includes('n') && newTop < minTop) {\r\n                            const overshoot = minTop - newTop;\r\n                            newTop = minTop;\r\n                            newHeight = Math.max(minHeight, newHeight - overshoot);\r\n                        }\r\n                        if (handle.directions.includes('w') || handle.directions.includes('e'))\r\n                            target.style.width = Math.max(minWidth, newWidth) + 'px';\r\n                        if (handle.directions.includes('s') || handle.directions.includes('n'))\r\n                            target.style.height = Math.max(minHeight, newHeight) + 'px';\r\n                        if (handle.directions.includes('w')) target.style.left = newLeft + 'px';\r\n                        if (handle.directions.includes('n')) target.style.top = newTop + 'px';\r\n                    });\r\n                };\r\n                const stopResize = () => {\r\n                    if (!resizing) return;\r\n                    resizing = false;\r\n                    overlay.remove();\r\n                    overlay.removeEventListener('mousemove', overlayMouseMove);\r\n                    overlay.removeEventListener('mouseup', overlayMouseUp);\r\n                    window.removeEventListener('mousemove', windowMouseMove);\r\n                    window.removeEventListener('mouseup', windowMouseUp);\r\n                    window.removeEventListener('blur', onBlur);\r\n                    (window as any).clampWindowToMenuBar?.(target);\r\n                    (window as any).saveWindowPositions?.();\r\n                };\r\n                const overlayMouseMove = (moveEvent: MouseEvent) =>\r\n                    applySize(moveEvent.clientX, moveEvent.clientY);\r\n                const windowMouseMove = (moveEvent: MouseEvent) =>\r\n                    applySize(moveEvent.clientX, moveEvent.clientY);\r\n                const overlayMouseUp = () => stopResize();\r\n                const windowMouseUp = () => stopResize();\r\n                const onBlur = () => stopResize();\r\n                overlay.addEventListener('mousemove', overlayMouseMove);\r\n                overlay.addEventListener('mouseup', overlayMouseUp);\r\n                window.addEventListener('mousemove', windowMouseMove);\r\n                window.addEventListener('mouseup', windowMouseUp);\r\n                window.addEventListener('blur', onBlur);\r\n            };\r\n            resizer.addEventListener('mousedown', startResize);\r\n        };\r\n\r\n        target.style.overflow = 'visible';\r\n        const handles = [\r\n            {\r\n                name: 'top',\r\n                cursor: 'n-resize',\r\n                directions: ['n'],\r\n                style: { top: '-4px', left: '12px', right: '12px', height: '8px' },\r\n            },\r\n            {\r\n                name: 'bottom',\r\n                cursor: 's-resize',\r\n                directions: ['s'],\r\n                style: { bottom: '-4px', left: '12px', right: '12px', height: '8px' },\r\n            },\r\n            {\r\n                name: 'left',\r\n                cursor: 'w-resize',\r\n                directions: ['w'],\r\n                style: { left: '-4px', top: '12px', bottom: '12px', width: '8px' },\r\n            },\r\n            {\r\n                name: 'right',\r\n                cursor: 'e-resize',\r\n                directions: ['e'],\r\n                style: { right: '-4px', top: '12px', bottom: '12px', width: '8px' },\r\n            },\r\n            {\r\n                name: 'top-left',\r\n                cursor: 'nw-resize',\r\n                directions: ['n', 'w'],\r\n                style: { top: '-6px', left: '-6px', width: '14px', height: '14px' },\r\n            },\r\n            {\r\n                name: 'top-right',\r\n                cursor: 'ne-resize',\r\n                directions: ['n', 'e'],\r\n                style: { top: '-6px', right: '-6px', width: '14px', height: '14px' },\r\n            },\r\n            {\r\n                name: 'bottom-left',\r\n                cursor: 'sw-resize',\r\n                directions: ['s', 'w'],\r\n                style: { bottom: '-6px', left: '-6px', width: '14px', height: '14px' },\r\n            },\r\n            {\r\n                name: 'bottom-right',\r\n                cursor: 'se-resize',\r\n                directions: ['s', 'e'],\r\n                style: { bottom: '-6px', right: '-6px', width: '14px', height: '14px' },\r\n            },\r\n        ];\r\n        handles.forEach(createHandle);\r\n    }\r\n\r\n    enforceMenuBarBoundary() {\r\n        (window as any).clampWindowToMenuBar?.(this.windowEl || this.modal);\r\n    }\r\n\r\n    loadIframe(url: string) {\r\n        let contentArea = this.modal.querySelector('.dialog-content') as HTMLElement | null;\r\n        if (!contentArea) {\r\n            contentArea = document.createElement('div');\r\n            contentArea.classList.add('dialog-content');\r\n            contentArea.style.width = '100%';\r\n            contentArea.style.height = '100%';\r\n            this.modal.appendChild(contentArea);\r\n        }\r\n        contentArea.innerHTML = '';\r\n        const iframe = document.createElement('iframe');\r\n        iframe.src = url;\r\n        iframe.style.width = '100%';\r\n        iframe.style.height = '100%';\r\n        iframe.style.border = 'none';\r\n        iframe.setAttribute('allow', 'fullscreen');\r\n        contentArea.appendChild(iframe);\r\n        iframe.addEventListener('load', () => {\r\n            try {\r\n                const cw = (iframe as any).contentWindow as Window | null;\r\n                if (cw && (cw as any).document) {\r\n                    const handler = () =>\r\n                        requestAnimationFrame(() => {\r\n                            this.refocus();\r\n                        });\r\n                    ['mousedown', 'click', 'touchstart'].forEach(evt => {\r\n                        (cw as any).document.addEventListener(evt, handler);\r\n                    });\r\n                } else if (cw) {\r\n                    ['mousedown', 'click', 'touchstart'].forEach(evt => {\r\n                        (cw as any).addEventListener(evt, () =>\r\n                            requestAnimationFrame(() => {\r\n                                this.refocus();\r\n                            })\r\n                        );\r\n                    });\r\n                }\r\n            } catch (err) {\r\n                console.error('Could not attach mousedown event in iframe:', err);\r\n            }\r\n        });\r\n    }\r\n\r\n    saveState() {\r\n        return {\r\n            left: this.modal.style.left,\r\n            top: this.modal.style.top,\r\n            width: this.modal.style.width,\r\n            height: this.modal.style.height,\r\n            zIndex: this.modal.style.zIndex,\r\n        };\r\n    }\r\n\r\n    restoreState(state: any) {\r\n        if (!state) return;\r\n        if (state.left) this.modal.style.left = state.left;\r\n        if (state.top) this.modal.style.top = state.top;\r\n        if (state.width) this.modal.style.width = state.width;\r\n        if (state.height) this.modal.style.height = state.height;\r\n        if (state.zIndex) this.modal.style.zIndex = state.zIndex;\r\n    }\r\n}\r\n// Note: Type declaration is in types/index.d.ts\r\n(window as any).Dialog = Dialog;\r\nexport default Dialog;\r\n", "(function () {\r\n    'use strict';\r\n\r\n    type TriggerOptions = { hoverRequiresOpen?: boolean; forceOpen?: boolean };\r\n\r\n    // Avoid redefining if legacy already provided these\r\n    if (\r\n        (window as unknown as { bindDropdownTrigger?: unknown }).bindDropdownTrigger &&\r\n        (window as unknown as { hideMenuDropdowns?: unknown }).hideMenuDropdowns\r\n    ) {\r\n        return;\r\n    }\r\n\r\n    function hideMenuDropdowns(): void {\r\n        const domUtils = (window as any).DOMUtils;\r\n\r\n        document.querySelectorAll('.menu-dropdown').forEach(dropdown => {\r\n            if (!dropdown.classList.contains('hidden')) {\r\n                if (domUtils && typeof domUtils.hide === 'function') {\r\n                    domUtils.hide(dropdown);\r\n                } else {\r\n                    dropdown.classList.add('hidden');\r\n                }\r\n            }\r\n        });\r\n        document.querySelectorAll('[data-menubar-trigger-button=\"true\"]').forEach(button => {\r\n            (button as HTMLElement).setAttribute('aria-expanded', 'false');\r\n        });\r\n        document.querySelectorAll('[data-system-menu-trigger]').forEach(button => {\r\n            (button as HTMLElement).setAttribute('aria-expanded', 'false');\r\n        });\r\n    }\r\n\r\n    function isAnyDropdownOpen(): boolean {\r\n        return Boolean(document.querySelector('.menu-dropdown:not(.hidden)'));\r\n    }\r\n\r\n    function toggleMenuDropdown(trigger: HTMLElement, options: TriggerOptions = {}): void {\r\n        if (!trigger) return;\r\n        const menuId = trigger.getAttribute('aria-controls');\r\n        if (!menuId) return;\r\n\r\n        const forceOpen = Boolean(options.forceOpen);\r\n        let menu = document.getElementById(menuId);\r\n        if (!menu) return;\r\n\r\n        const wasOpen = !menu.classList.contains('hidden');\r\n        const shouldOpen = forceOpen || !wasOpen;\r\n        hideMenuDropdowns();\r\n\r\n        if (shouldOpen) {\r\n            // Only re-render menu if it was NOT already open (i.e., we're opening it fresh)\r\n            // This prevents re-rendering during hover events when menu is already visible\r\n            if (!wasOpen) {\r\n                const MenuSystem = (\r\n                    window as unknown as {\r\n                        MenuSystem?: { renderApplicationMenu?: (modalId?: string | null) => void };\r\n                    }\r\n                ).MenuSystem;\r\n                if (MenuSystem && typeof MenuSystem.renderApplicationMenu === 'function') {\r\n                    // Get the current active modal to pass to menu renderer\r\n                    const topModal = Array.from(\r\n                        document.querySelectorAll('.modal:not(.hidden)')\r\n                    ).sort((a, b) => {\r\n                        const zA = parseInt(getComputedStyle(a).zIndex, 10) || 0;\r\n                        const zB = parseInt(getComputedStyle(b).zIndex, 10) || 0;\r\n                        return zB - zA;\r\n                    })[0];\r\n                    const activeModalId = topModal?.id || null;\r\n                    MenuSystem.renderApplicationMenu(activeModalId);\r\n                }\r\n\r\n                // Re-get menu element after rendering (it may have been recreated)\r\n                menu = document.getElementById(menuId);\r\n                if (!menu) return;\r\n            }\r\n\r\n            const domUtils = (window as any).DOMUtils;\r\n            if (domUtils && typeof domUtils.show === 'function') {\r\n                domUtils.show(menu);\r\n            } else {\r\n                menu.classList.remove('hidden');\r\n            }\r\n\r\n            trigger.setAttribute('aria-expanded', 'true');\r\n        }\r\n    }\r\n\r\n    function bindDropdownTrigger(el: HTMLElement | null, options: TriggerOptions = {}): void {\r\n        if (!el) return;\r\n        const hoverRequiresExisting =\r\n            options.hoverRequiresOpen !== undefined ? options.hoverRequiresOpen : true;\r\n        let clickJustOccurred = false;\r\n\r\n        el.addEventListener('click', event => {\r\n            event.stopPropagation();\r\n            clickJustOccurred = true;\r\n            const now = Date.now();\r\n            (window as unknown as { __lastMenuInteractionAt?: number }).__lastMenuInteractionAt =\r\n                now;\r\n            const menuId = el.getAttribute('aria-controls');\r\n            const menu = menuId ? document.getElementById(menuId) : null;\r\n            const isOpen = menu ? !menu.classList.contains('hidden') : false;\r\n            const sinceFocus =\r\n                now -\r\n                ((window as unknown as { __lastMenuFocusAt?: number }).__lastMenuFocusAt || 0);\r\n            if (isOpen && sinceFocus > 200) {\r\n                hideMenuDropdowns();\r\n                el.setAttribute('aria-expanded', 'false');\r\n            } else {\r\n                toggleMenuDropdown(el, { forceOpen: true });\r\n            }\r\n            setTimeout(() => {\r\n                clickJustOccurred = false;\r\n            }, 200);\r\n        });\r\n\r\n        el.addEventListener('mouseenter', () => {\r\n            if (clickJustOccurred) return;\r\n            (window as unknown as { __lastMenuInteractionAt?: number }).__lastMenuInteractionAt =\r\n                Date.now();\r\n            if (hoverRequiresExisting && !isAnyDropdownOpen()) return;\r\n            toggleMenuDropdown(el, { forceOpen: true });\r\n        });\r\n\r\n        el.addEventListener('focus', () => {\r\n            const now = Date.now();\r\n            (window as unknown as { __lastMenuInteractionAt?: number }).__lastMenuInteractionAt =\r\n                now;\r\n            (window as unknown as { __lastMenuFocusAt?: number }).__lastMenuFocusAt = now;\r\n            toggleMenuDropdown(el, { forceOpen: true });\r\n        });\r\n    }\r\n\r\n    function handleDocumentClickToCloseMenus(event: Event): void {\r\n        const last = (window as unknown as { __lastMenuInteractionAt?: number })\r\n            .__lastMenuInteractionAt;\r\n        if (last && Date.now() - last < 200) {\r\n            return;\r\n        }\r\n        const target = event.target instanceof Element ? (event.target as Element) : null;\r\n        if (!target) return;\r\n        if (target.closest('.menubar-trigger') || target.closest('.menu-dropdown')) return;\r\n        hideMenuDropdowns();\r\n    }\r\n\r\n    function initMenubarWiring() {\r\n        if ((window as unknown as { __menubarWired?: boolean }).__menubarWired) return;\r\n        (window as unknown as { __menubarWired?: boolean }).__menubarWired = true;\r\n\r\n        const appleMenuTrigger = document.getElementById('apple-menu-trigger');\r\n        const programLabel = document.getElementById('program-label');\r\n        bindDropdownTrigger(appleMenuTrigger, { hoverRequiresOpen: true });\r\n        bindDropdownTrigger(programLabel, { hoverRequiresOpen: true });\r\n\r\n        // Menu action activation from menu.js\r\n        document.addEventListener('click', event => {\r\n            const MenuSystem = (\r\n                window as unknown as {\r\n                    MenuSystem?: { handleMenuActionActivation?: (e: Event) => void };\r\n                }\r\n            ).MenuSystem;\r\n            if (MenuSystem && typeof MenuSystem.handleMenuActionActivation === 'function') {\r\n                MenuSystem.handleMenuActionActivation(event);\r\n            }\r\n        });\r\n\r\n        document.addEventListener('click', handleDocumentClickToCloseMenus);\r\n        document.addEventListener('pointerdown', handleDocumentClickToCloseMenus, {\r\n            capture: true,\r\n        });\r\n        document.addEventListener('keydown', event => {\r\n            if ((event as KeyboardEvent).key === 'Escape') hideMenuDropdowns();\r\n        });\r\n    }\r\n\r\n    // Expose API\r\n    (\r\n        window as unknown as {\r\n            hideMenuDropdowns: typeof hideMenuDropdowns;\r\n            bindDropdownTrigger: typeof bindDropdownTrigger;\r\n        }\r\n    ).hideMenuDropdowns = hideMenuDropdowns;\r\n    (window as unknown as { bindDropdownTrigger: typeof bindDropdownTrigger }).bindDropdownTrigger =\r\n        bindDropdownTrigger;\r\n\r\n    // Initialize on DOMContentLoaded (idempotent)\r\n    if (document.readyState === 'loading') {\r\n        document.addEventListener('DOMContentLoaded', initMenubarWiring, { once: true });\r\n    } else {\r\n        initMenubarWiring();\r\n    }\r\n})();\r\n\r\n", "/*\r\n * src/ts/context-menu.ts\r\n * Typed port of js/context-menu.js\r\n */\r\n\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nconst guardKey = '__customContextMenuInit';\r\nif ((window as any)[guardKey]) {\r\n    // already initialized\r\n} else {\r\n    (window as any)[guardKey] = true;\r\n\r\n    const i18n =\r\n        (window as any).appI18n ||\r\n        ({\r\n            translate: (k: string) => k,\r\n            applyTranslations: (_el?: Element) => {},\r\n        } as { translate: (k: string) => string; applyTranslations: (el?: Element) => void });\r\n\r\n    const hideAllDropdowns =\r\n        typeof (window as any).hideMenuDropdowns === 'function'\r\n            ? (window as any).hideMenuDropdowns\r\n            : () => {\r\n                  const domUtils = (window as any).DOMUtils;\r\n                  document.querySelectorAll('.menu-dropdown').forEach(d => {\r\n                      if (domUtils && typeof domUtils.hide === 'function') {\r\n                          domUtils.hide(d);\r\n                      } else {\r\n                          d.classList.add('hidden');\r\n                      }\r\n                  });\r\n                  document\r\n                      .querySelectorAll('[aria-expanded=\"true\"]')\r\n                      .forEach(b => b.setAttribute('aria-expanded', 'false'));\r\n              };\r\n\r\n    function openModal(id: string) {\r\n        const el = document.getElementById(id);\r\n        if (!el) return;\r\n        if (!(window as any).dialogs) (window as any).dialogs = {};\r\n        if (!(window as any).dialogs[id] && typeof (window as any).Dialog === 'function') {\r\n            try {\r\n                (window as any).dialogs[id] = new (window as any).Dialog(id);\r\n            } catch {\r\n                // noop\r\n            }\r\n        }\r\n        const dlg = (window as any).dialogs[id];\r\n        if (dlg && typeof dlg.open === 'function') {\r\n            dlg.open();\r\n        } else {\r\n            const domUtils = (window as any).DOMUtils;\r\n            if (domUtils && typeof domUtils.show === 'function') {\r\n                domUtils.show(el);\r\n            } else {\r\n                el.classList.remove('hidden');\r\n            }\r\n            if (typeof (window as any).bringDialogToFront === 'function') {\r\n                (window as any).bringDialogToFront(id);\r\n            }\r\n        }\r\n        if (typeof (window as any).updateProgramLabelByTopModal === 'function') {\r\n            (window as any).updateProgramLabelByTopModal();\r\n        }\r\n    }\r\n\r\n    function toggleDarkMode() {\r\n        if (\r\n            (window as any).SystemUI &&\r\n            typeof (window as any).SystemUI.handleSystemToggle === 'function'\r\n        ) {\r\n            (window as any).SystemUI.handleSystemToggle('dark-mode');\r\n        } else {\r\n            const next = !document.documentElement.classList.contains('dark');\r\n            document.documentElement.classList.toggle('dark', next);\r\n            if (\r\n                (window as any).ThemeSystem &&\r\n                typeof (window as any).ThemeSystem.setThemePreference === 'function'\r\n            ) {\r\n                (window as any).ThemeSystem.setThemePreference(next ? 'dark' : 'light');\r\n            }\r\n        }\r\n    }\r\n\r\n    function getMenuItemsForTarget(target: Element | null) {\r\n        const items: Array<any> = [];\r\n        const inDesktop = !!(\r\n            target &&\r\n            (target as Element).closest &&\r\n            (target as Element).closest('#desktop')\r\n        );\r\n        const inDockItem = !!(\r\n            target &&\r\n            (target as Element).closest &&\r\n            (target as Element).closest('#dock .dock-item')\r\n        );\r\n        const inImageModal = !!(\r\n            target &&\r\n            (target as Element).closest &&\r\n            (target as Element).closest('#image-modal')\r\n        );\r\n        const inFinderModal = !!(\r\n            target &&\r\n            (target as Element).closest &&\r\n            (target as Element).closest('[role=\"dialog\"][id*=\"finder\"]')\r\n        );\r\n\r\n        if (inDockItem) {\r\n            const dockItem = (target as Element).closest('#dock .dock-item') as Element | null;\r\n            const winId = dockItem && dockItem.getAttribute('data-window-id');\r\n            if (winId) {\r\n                items.push({\r\n                    id: 'open-dock-window',\r\n                    label: i18n.translate('context.open') || '\u00D6ffnen',\r\n                    action: () => openModal(winId),\r\n                });\r\n                items.push({ type: 'separator' });\r\n            }\r\n        }\r\n\r\n        if (inImageModal && typeof (window as any).getImageViewerState === 'function') {\r\n            const st = (window as any).getImageViewerState();\r\n            if (st && st.hasImage) {\r\n                items.push({\r\n                    id: 'image-open-tab',\r\n                    label:\r\n                        i18n.translate('context.image.openInTab') ||\r\n                        i18n.translate('menu.image.openInTab') ||\r\n                        'Bild in neuem Tab \u00F6ffnen',\r\n                    action: () => {\r\n                        if (typeof (window as any).openActiveImageInNewTab === 'function')\r\n                            (window as any).openActiveImageInNewTab();\r\n                    },\r\n                });\r\n                items.push({\r\n                    id: 'image-save',\r\n                    label:\r\n                        i18n.translate('context.image.save') ||\r\n                        i18n.translate('menu.image.saveImage') ||\r\n                        'Bild sichern \u2026',\r\n                    action: () => {\r\n                        if (typeof (window as any).downloadActiveImage === 'function')\r\n                            (window as any).downloadActiveImage();\r\n                    },\r\n                });\r\n                items.push({ type: 'separator' });\r\n            }\r\n        }\r\n\r\n        if (inFinderModal) {\r\n            const finderItem =\r\n                target &&\r\n                (target as Element).closest &&\r\n                (target as Element).closest('.finder-list-item, .finder-grid-item');\r\n            if (finderItem) {\r\n                const itemName = (finderItem as Element).getAttribute('data-item-name');\r\n                const itemType = (finderItem as Element).getAttribute('data-item-type');\r\n                if (itemName && itemType) {\r\n                    items.push({\r\n                        id: 'finder-open-item',\r\n                        label: i18n.translate('context.finder.openItem') || '\u00D6ffnen',\r\n                        action: () => {\r\n                            if (\r\n                                (window as any).FinderSystem &&\r\n                                typeof (window as any).FinderSystem.openItem === 'function'\r\n                            )\r\n                                (window as any).FinderSystem.openItem(itemName, itemType);\r\n                        },\r\n                    });\r\n\r\n                    // \"Open with Preview\" for image files\r\n                    const isImage = /\\.(png|jpe?g|gif|bmp|webp|svg)$/i.test(itemName);\r\n                    if (isImage && itemType === 'file') {\r\n                        items.push({\r\n                            id: 'finder-open-with-preview',\r\n                            label:\r\n                                i18n.translate('context.finder.openWithPreview') ||\r\n                                '\u00D6ffnen mit Vorschau',\r\n                            action: () => {\r\n                                // Use ActionBus for simplicity\r\n                                const ab = (window as any).ActionBus;\r\n                                if (ab && typeof ab.execute === 'function') {\r\n                                    ab.execute('openWithPreview', { itemName });\r\n                                }\r\n                            },\r\n                        });\r\n                    }\r\n\r\n                    items.push({ type: 'separator' });\r\n                    items.push({\r\n                        id: 'finder-get-info',\r\n                        label: i18n.translate('context.finder.getInfo') || 'Informationen',\r\n                        action: () => {\r\n                            console.log('Get info for:', itemName, itemType);\r\n                        },\r\n                    });\r\n                    return items;\r\n                }\r\n            }\r\n\r\n            items.push({\r\n                id: 'finder-refresh',\r\n                label: i18n.translate('context.finder.refresh') || 'Aktualisieren',\r\n                action: () => {\r\n                    if (\r\n                        (window as any).FinderSystem &&\r\n                        typeof (window as any).FinderSystem.navigateTo === 'function'\r\n                    ) {\r\n                        const state = (window as any).FinderSystem.getState();\r\n                        if (state) {\r\n                            (window as any).FinderSystem.navigateTo(\r\n                                state.currentPath,\r\n                                state.currentView\r\n                            );\r\n                        }\r\n                    }\r\n                },\r\n            });\r\n            items.push({ type: 'separator' });\r\n\r\n            const currentViewMode =\r\n                (window as any).FinderSystem && (window as any).FinderSystem.getState\r\n                    ? (window as any).FinderSystem.getState().viewMode\r\n                    : 'list';\r\n            if (currentViewMode !== 'list') {\r\n                items.push({\r\n                    id: 'finder-view-list',\r\n                    label: i18n.translate('context.finder.viewList') || 'Als Liste',\r\n                    action: () => {\r\n                        if (\r\n                            (window as any).FinderSystem &&\r\n                            typeof (window as any).FinderSystem.setViewMode === 'function'\r\n                        )\r\n                            (window as any).FinderSystem.setViewMode('list');\r\n                    },\r\n                });\r\n            }\r\n            if (currentViewMode !== 'grid') {\r\n                items.push({\r\n                    id: 'finder-view-grid',\r\n                    label: i18n.translate('context.finder.viewGrid') || 'Als Raster',\r\n                    action: () => {\r\n                        if (\r\n                            (window as any).FinderSystem &&\r\n                            typeof (window as any).FinderSystem.setViewMode === 'function'\r\n                        )\r\n                            (window as any).FinderSystem.setViewMode('grid');\r\n                    },\r\n                });\r\n            }\r\n            items.push({ type: 'separator' });\r\n\r\n            items.push({\r\n                id: 'finder-sort-name',\r\n                label: i18n.translate('context.finder.sortByName') || 'Nach Name sortieren',\r\n                action: () => {\r\n                    if (\r\n                        (window as any).FinderSystem &&\r\n                        typeof (window as any).FinderSystem.setSortBy === 'function'\r\n                    )\r\n                        (window as any).FinderSystem.setSortBy('name');\r\n                },\r\n            });\r\n            items.push({\r\n                id: 'finder-sort-date',\r\n                label: i18n.translate('context.finder.sortByDate') || 'Nach Datum sortieren',\r\n                action: () => {\r\n                    if (\r\n                        (window as any).FinderSystem &&\r\n                        typeof (window as any).FinderSystem.setSortBy === 'function'\r\n                    )\r\n                        (window as any).FinderSystem.setSortBy('date');\r\n                },\r\n            });\r\n            items.push({\r\n                id: 'finder-sort-size',\r\n                label: i18n.translate('context.finder.sortBySize') || 'Nach Gr\u00F6\u00DFe sortieren',\r\n                action: () => {\r\n                    if (\r\n                        (window as any).FinderSystem &&\r\n                        typeof (window as any).FinderSystem.setSortBy === 'function'\r\n                    )\r\n                        (window as any).FinderSystem.setSortBy('size');\r\n                },\r\n            });\r\n\r\n            return items;\r\n        }\r\n\r\n        if (inDesktop) {\r\n            items.push({\r\n                id: 'open-finder',\r\n                label: i18n.translate('context.openFinder') || 'Finder \u00F6ffnen',\r\n                action: () => {\r\n                    const W = window as any;\r\n                    W.FinderWindow?.focusOrCreate();\r\n                },\r\n            });\r\n            items.push({\r\n                id: 'open-text',\r\n                label: i18n.translate('context.openTextEditor') || 'Texteditor \u00F6ffnen',\r\n                action: () => openModal('text-modal'),\r\n            });\r\n            items.push({\r\n                id: 'open-projects',\r\n                label: i18n.translate('context.openProjects') || 'Projekte \u00F6ffnen',\r\n                action: () => openModal('projects-modal'),\r\n            });\r\n            items.push({ type: 'separator' });\r\n            items.push({\r\n                id: 'toggle-dark',\r\n                label: i18n.translate('context.toggleDarkMode') || 'Dark Mode umschalten',\r\n                action: toggleDarkMode,\r\n            });\r\n            items.push({\r\n                id: 'open-settings',\r\n                label: i18n.translate('context.openSettings') || 'Systemeinstellungen \u2026',\r\n                action: () => openModal('settings-modal'),\r\n            });\r\n            items.push({ type: 'separator' });\r\n            items.push({\r\n                id: 'about',\r\n                label: i18n.translate('context.about') || '\u00DCber Marvin',\r\n                action: () => openModal('about-modal'),\r\n            });\r\n            return items;\r\n        }\r\n\r\n        items.push({\r\n            id: 'open-finder',\r\n            label: i18n.translate('context.openFinder') || 'Finder \u00F6ffnen',\r\n            action: () => {\r\n                const W = window as any;\r\n                W.FinderWindow?.focusOrCreate();\r\n            },\r\n        });\r\n        items.push({\r\n            id: 'open-text',\r\n            label: i18n.translate('context.openTextEditor') || 'Texteditor \u00F6ffnen',\r\n            action: () => openModal('text-modal'),\r\n        });\r\n        items.push({ type: 'separator' });\r\n        items.push({\r\n            id: 'toggle-dark',\r\n            label: i18n.translate('context.toggleDarkMode') || 'Dark Mode umschalten',\r\n            action: toggleDarkMode,\r\n        });\r\n        items.push({\r\n            id: 'open-settings',\r\n            label: i18n.translate('context.openSettings') || 'Systemeinstellungen \u2026',\r\n            action: () => openModal('settings-modal'),\r\n        });\r\n        items.push({ type: 'separator' });\r\n        items.push({\r\n            id: 'about',\r\n            label: i18n.translate('context.about') || '\u00DCber Marvin',\r\n            action: () => openModal('about-modal'),\r\n        });\r\n        return items;\r\n    }\r\n\r\n    // Create DOM once\r\n    const menu = document.createElement('ul');\r\n    menu.id = 'context-menu';\r\n    menu.className = 'menu-dropdown context-menu hidden';\r\n    menu.setAttribute('role', 'menu');\r\n    menu.setAttribute('aria-label', i18n.translate('context.menuLabel') || 'Kontextmen\u00FC');\r\n\r\n    document.addEventListener('DOMContentLoaded', () => {\r\n        if (!document.body.contains(menu)) document.body.appendChild(menu);\r\n        try {\r\n            i18n.applyTranslations(menu);\r\n        } catch {}\r\n    });\r\n\r\n    function clearMenu() {\r\n        while (menu.firstChild) menu.removeChild(menu.firstChild);\r\n    }\r\n\r\n    function renderMenu(items: Array<any>) {\r\n        clearMenu();\r\n        const fragment = document.createDocumentFragment();\r\n        let firstFocusable: HTMLElement | null = null;\r\n        items.forEach((it: any, idx: number) => {\r\n            if (it.type === 'separator') {\r\n                const sep = document.createElement('li');\r\n                sep.className = 'menu-separator';\r\n                sep.setAttribute('role', 'separator');\r\n                fragment.appendChild(sep);\r\n                return;\r\n            }\r\n            const li = document.createElement('li');\r\n            const btn = document.createElement('button');\r\n            btn.type = 'button';\r\n            btn.className = 'menu-item';\r\n            btn.setAttribute('role', 'menuitem');\r\n            btn.tabIndex = -1;\r\n            btn.dataset.itemId = it.id || 'item-' + idx;\r\n            const labelSpan = document.createElement('span');\r\n            labelSpan.className = 'menu-item-label';\r\n            labelSpan.textContent = it.label || '';\r\n            btn.appendChild(labelSpan);\r\n            btn.addEventListener('click', ev => {\r\n                ev.stopPropagation();\r\n                hideContextMenu();\r\n                try {\r\n                    if (it.action) {\r\n                        it.action();\r\n                    }\r\n                } catch (e) {\r\n                    console.warn('Context action failed', e);\r\n                }\r\n            });\r\n            li.appendChild(btn);\r\n            fragment.appendChild(li);\r\n            if (!firstFocusable) firstFocusable = btn;\r\n        });\r\n        menu.appendChild(fragment);\r\n        try {\r\n            i18n.applyTranslations(menu);\r\n        } catch {}\r\n        return firstFocusable;\r\n    }\r\n\r\n    function clampPosition(x: number, y: number) {\r\n        const rect = menu.getBoundingClientRect();\r\n        const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\r\n        const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\r\n        const margin = 6;\r\n        const nx = Math.min(Math.max(margin, x), Math.max(margin, vw - rect.width - margin));\r\n        const ny = Math.min(Math.max(margin, y), Math.max(margin, vh - rect.height - margin));\r\n        return { x: nx, y: ny };\r\n    }\r\n\r\n    function showContextMenu(ev: MouseEvent) {\r\n        const target = ev.target instanceof Element ? ev.target : null;\r\n        if (!target) return;\r\n        if (target.closest('input, textarea, [contenteditable=\"true\"]')) return;\r\n        ev.preventDefault();\r\n        ev.stopPropagation();\r\n        hideAllDropdowns();\r\n        buildAndOpenAt(ev.clientX, ev.clientY, target);\r\n    }\r\n\r\n    function buildAndOpenAt(x: number, y: number, target: Element | null) {\r\n        const items = getMenuItemsForTarget(target);\r\n        const firstFocusable = renderMenu(items);\r\n        if (document.body && menu.parentElement !== document.body) {\r\n            document.body.appendChild(menu);\r\n        } else if (document.body && document.body.lastElementChild !== menu) {\r\n            document.body.appendChild(menu);\r\n        }\r\n        const domUtils = (window as any).DOMUtils;\r\n        if (domUtils && typeof domUtils.show === 'function') {\r\n            domUtils.show(menu);\r\n        } else {\r\n            menu.classList.remove('hidden');\r\n        }\r\n        menu.style.left = Math.max(0, x) + 'px';\r\n        menu.style.top = Math.max(0, y) + 'px';\r\n        const clamped = clampPosition(x, y);\r\n        menu.style.left = clamped.x + 'px';\r\n        menu.style.top = clamped.y + 'px';\r\n        if (lastInvokeWasKeyboard && firstFocusable) {\r\n            (firstFocusable as HTMLElement).focus();\r\n        }\r\n        bindAutoClose();\r\n    }\r\n\r\n    function hideContextMenu() {\r\n        const domUtils = (window as any).DOMUtils;\r\n        if (!menu.classList.contains('hidden')) {\r\n            if (domUtils && typeof domUtils.hide === 'function') {\r\n                domUtils.hide(menu);\r\n            } else {\r\n                menu.classList.add('hidden');\r\n            }\r\n        }\r\n        unbindAutoClose();\r\n    }\r\n\r\n    let onDocClick: ((e: Event) => void) | null = null;\r\n    let onDocScroll: (() => void) | null = null;\r\n    let onResize: (() => void) | null = null;\r\n    let onKeyDown: ((e: KeyboardEvent) => void) | null = null;\r\n\r\n    function bindAutoClose() {\r\n        unbindAutoClose();\r\n        onDocClick = (e: Event) => {\r\n            const t = e.target instanceof Element ? e.target : null;\r\n            if (!t) {\r\n                hideContextMenu();\r\n                return;\r\n            }\r\n            if (t.closest('#context-menu')) return;\r\n            hideContextMenu();\r\n        };\r\n        onDocScroll = () => hideContextMenu();\r\n        onResize = () => hideContextMenu();\r\n        onKeyDown = (e: KeyboardEvent) => {\r\n            const items = Array.from(menu.querySelectorAll('.menu-item')) as HTMLElement[];\r\n            const focusIdx = items.findIndex(el => el === document.activeElement);\r\n            if (e.key === 'Escape') {\r\n                e.preventDefault();\r\n                hideContextMenu();\r\n                return;\r\n            }\r\n            if (!items.length) return;\r\n            if (e.key === 'ArrowDown') {\r\n                e.preventDefault();\r\n                const next = items[(Math.max(0, focusIdx) + 1) % items.length];\r\n                if (next) next.focus();\r\n            } else if (e.key === 'ArrowUp') {\r\n                e.preventDefault();\r\n                const next = items[(focusIdx > 0 ? focusIdx : items.length) - 1];\r\n                if (next) next.focus();\r\n            } else if (e.key === 'Home') {\r\n                e.preventDefault();\r\n                items[0]?.focus();\r\n            } else if (e.key === 'End') {\r\n                e.preventDefault();\r\n                items[items.length - 1]?.focus();\r\n            } else if (e.key === 'Enter' || e.key === ' ') {\r\n                if (\r\n                    document.activeElement &&\r\n                    (document.activeElement as Element).classList.contains('menu-item')\r\n                ) {\r\n                    e.preventDefault();\r\n                    (document.activeElement as HTMLElement).click();\r\n                }\r\n            }\r\n        };\r\n        document.addEventListener('click', onDocClick as EventListener, { capture: true });\r\n        document.addEventListener('contextmenu', onDocClick as EventListener, { capture: true });\r\n        document.addEventListener('scroll', onDocScroll as EventListener, { capture: true });\r\n        window.addEventListener('resize', onResize as EventListener);\r\n        document.addEventListener('keydown', onKeyDown as EventListener);\r\n    }\r\n\r\n    function unbindAutoClose() {\r\n        if (onDocClick)\r\n            document.removeEventListener('click', onDocClick as EventListener, { capture: true });\r\n        if (onDocClick)\r\n            document.removeEventListener('contextmenu', onDocClick as EventListener, {\r\n                capture: true,\r\n            });\r\n        if (onDocScroll)\r\n            document.removeEventListener('scroll', onDocScroll as EventListener, { capture: true });\r\n        if (onResize) window.removeEventListener('resize', onResize as EventListener);\r\n        if (onKeyDown) document.removeEventListener('keydown', onKeyDown as EventListener);\r\n        onDocClick = onDocScroll = onResize = onKeyDown = null;\r\n    }\r\n\r\n    let lastInvokeWasKeyboard = false;\r\n    document.addEventListener('keydown', e => {\r\n        if (e.key === 'ContextMenu' || (e.shiftKey && e.key === 'F10')) {\r\n            lastInvokeWasKeyboard = true;\r\n        }\r\n    });\r\n    document.addEventListener(\r\n        'keyup',\r\n        () => {\r\n            lastInvokeWasKeyboard = false;\r\n        },\r\n        { capture: true }\r\n    );\r\n\r\n    document.addEventListener('contextmenu', showContextMenu);\r\n\r\n    if (typeof (window as any).bindDropdownTrigger === 'function') {\r\n        document.querySelectorAll('[data-menubar-trigger-button=\"true\"]').forEach(btn => {\r\n            btn.addEventListener('click', () => hideContextMenu());\r\n        });\r\n    }\r\n}\r\n\r\nexport {};\r\n", "// ============================================================================\r\n// src/ts/storage.ts \u2014 Persistence & State Management Module (TypeScript)\r\n// Mirrors js/storage.js API and preserves global export window.StorageSystem\r\n// ============================================================================\r\n\r\nimport { getJSON, setJSON, getString, remove } from '../services/storage-utils.js';\r\n\r\n(() => {\r\n    'use strict';\r\n\r\n    console.log('\u2705 StorageSystem (TS) loaded');\r\n\r\n    // ===== Types =====\r\n    type FinderState = { repo: string; path?: string } | null;\r\n    type Positions = Record<\r\n        string,\r\n        { left: string; top: string; width: string; height: string; position: string }\r\n    >;\r\n\r\n    // ===== Module Dependencies / Constants =====\r\n    const w = window as unknown as Record<string, unknown>;\r\n    const APP_CONSTANTS = (w.APP_CONSTANTS as Record<string, unknown>) || {};\r\n\r\n    const FINDER_STATE_KEY = (APP_CONSTANTS.FINDER_STATE_STORAGE_KEY as string) || 'finderState';\r\n    const OPEN_MODALS_KEY = 'openModals';\r\n    const MODAL_POSITIONS_KEY = 'modalPositions';\r\n\r\n    const getModalIds = (): string[] => {\r\n        const ac = (w.APP_CONSTANTS as Record<string, unknown> | undefined) || undefined;\r\n        const v = ac && (ac['MODAL_IDS'] as unknown);\r\n        return Array.isArray(v) ? (v as string[]) : [];\r\n    };\r\n    const getTransientModalIds = (): Set<string> => {\r\n        const ac = (w.APP_CONSTANTS as Record<string, unknown> | undefined) || undefined;\r\n        const v = ac && (ac['TRANSIENT_MODAL_IDS'] as unknown);\r\n        return v instanceof Set ? (v as Set<string>) : new Set<string>();\r\n    };\r\n\r\n    // ===== Finder State Persistence =====\r\n\r\n    function readFinderState(): FinderState {\r\n        try {\r\n            const parsed = getJSON<Record<string, unknown> | null>(FINDER_STATE_KEY, null);\r\n            if (!parsed || typeof parsed !== 'object') return null;\r\n            const po = parsed as Record<string, unknown>;\r\n            const repo = typeof po.repo === 'string' ? po.repo.trim() : '';\r\n            if (!repo) return null;\r\n            return {\r\n                repo,\r\n                path: typeof po.path === 'string' ? po.path : '',\r\n            };\r\n        } catch (err) {\r\n            console.warn('Finder state konnte nicht gelesen werden:', err);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    function writeFinderState(state: { repo: string; path?: string } | null | undefined): void {\r\n        if (!state || typeof state.repo !== 'string' || !state.repo) {\r\n            clearFinderState();\r\n            return;\r\n        }\r\n        const payload = {\r\n            repo: state.repo,\r\n            path: typeof state.path === 'string' ? state.path : '',\r\n        };\r\n        try {\r\n            setJSON(FINDER_STATE_KEY, payload);\r\n        } catch (err) {\r\n            console.warn('Finder state konnte nicht gespeichert werden:', err);\r\n        }\r\n    }\r\n\r\n    function clearFinderState(): void {\r\n        try {\r\n            remove(FINDER_STATE_KEY);\r\n        } catch (err) {\r\n            console.warn('Finder state konnte nicht gel\u00F6scht werden:', err);\r\n        }\r\n    }\r\n\r\n    // ===== Open Modals Persistence =====\r\n\r\n    function saveOpenModals(): void {\r\n        const modalIds = getModalIds();\r\n        const transientModalIds = getTransientModalIds();\r\n\r\n        const openModals = modalIds.filter(id => {\r\n            if (transientModalIds.has(id)) return false;\r\n            const el = document.getElementById(id) as HTMLElement | null;\r\n            if (!el) return false;\r\n            const minimized = el.dataset && el.dataset.minimized === 'true';\r\n            return !el.classList.contains('hidden') || minimized;\r\n        });\r\n\r\n        try {\r\n            setJSON(OPEN_MODALS_KEY, openModals);\r\n        } catch (err) {\r\n            console.warn('Open modals konnte nicht gespeichert werden:', err);\r\n        }\r\n    }\r\n\r\n    function restoreOpenModals(): void {\r\n        const transientModalIds = getTransientModalIds();\r\n\r\n        // Collect targets from modern key (OPEN_MODALS_KEY) and legacy 'window-session'\r\n        const toRestore = new Set<string>();\r\n        try {\r\n            const arr = getJSON<string[]>(OPEN_MODALS_KEY, []);\r\n            if (Array.isArray(arr)) arr.forEach((id: string) => toRestore.add(id));\r\n        } catch (err) {\r\n            console.warn('Open modals konnte nicht gelesen werden:', err);\r\n        }\r\n\r\n        // Legacy compatibility: support { modalState: { [id]: { visible: boolean, minimized, zIndex } } }\r\n        try {\r\n            const legacy = getJSON<Record<string, unknown> | null>('window-session', null);\r\n            if (legacy) {\r\n                const modalState =\r\n                    legacy && (legacy['modalState'] as Record<string, unknown> | null);\r\n                if (modalState && typeof modalState === 'object') {\r\n                    Object.entries(modalState).forEach(([id, state]) => {\r\n                        try {\r\n                            const visible = !!(\r\n                                state && (state as Record<string, unknown>)['visible']\r\n                            );\r\n                            if (visible) toRestore.add(id);\r\n                        } catch {\r\n                            /* ignore */\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.warn('Legacy window-session konnte nicht gelesen werden:', err);\r\n        }\r\n\r\n        toRestore.forEach(id => {\r\n            // Skip transient modals\r\n            if (transientModalIds.has(id)) return;\r\n\r\n            // Validate modal exists in DOM\r\n            const el = document.getElementById(id);\r\n            if (!el) {\r\n                // Align with legacy expectation in tests\r\n                console.warn(`SessionManager: Modal \"${id}\" not found in DOM`);\r\n                return;\r\n            }\r\n\r\n            // Validate modal is registered in WindowManager (if available)\r\n            const WindowManager = w['WindowManager'] as\r\n                | { getConfig?: (id: string) => unknown }\r\n                | undefined;\r\n            if (WindowManager && typeof WindowManager.getConfig === 'function') {\r\n                const config = WindowManager.getConfig(id);\r\n                if (!config) {\r\n                    console.warn(\r\n                        `Skipping restore of modal \"${id}\": not registered in WindowManager`\r\n                    );\r\n                    return;\r\n                }\r\n            }\r\n\r\n            // Prefer WindowManager.open() to ensure initHandler/openHandler are called\r\n            const wm = w['WindowManager'] as { open?: (id: string) => void } | undefined;\r\n            if (wm && typeof wm.open === 'function') {\r\n                try {\r\n                    wm.open(id);\r\n                } catch (err) {\r\n                    console.warn(`Error restoring modal \"${id}\" via WindowManager:`, err);\r\n                    // Fallback: try direct dialog open\r\n                    const dialogs = w['dialogs'] as Record<string, unknown> | undefined;\r\n                    const dialogInstance =\r\n                        dialogs && (dialogs[id] as Record<string, unknown> | null);\r\n                    const openFn =\r\n                        dialogInstance && (dialogInstance['open'] as (() => void) | undefined);\r\n\r\n                    if (typeof openFn === 'function') {\r\n                        try {\r\n                            openFn();\r\n                        } catch (openErr) {\r\n                            console.warn(\r\n                                `Error restoring modal \"${id}\" via dialog.open():`,\r\n                                openErr\r\n                            );\r\n                            // Final fallback: show element directly\r\n                            const domUtils = (\r\n                                w as unknown as { DOMUtils?: { show?: (el: Element) => void } }\r\n                            ).DOMUtils;\r\n                            if (domUtils && typeof domUtils.show === 'function') {\r\n                                domUtils.show(el);\r\n                            } else {\r\n                                el.classList.remove('hidden');\r\n                            }\r\n                        }\r\n                    } else {\r\n                        // No dialog instance, show element directly\r\n                        const domUtils = (\r\n                            w as unknown as { DOMUtils?: { show?: (el: Element) => void } }\r\n                        ).DOMUtils;\r\n                        if (domUtils && typeof domUtils.show === 'function') {\r\n                            domUtils.show(el);\r\n                        } else {\r\n                            el.classList.remove('hidden');\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                // No WindowManager, fallback to dialog instance\r\n                const dialogs = w['dialogs'] as Record<string, unknown> | undefined;\r\n                const dialogInstance = dialogs && (dialogs[id] as Record<string, unknown> | null);\r\n                const openFn =\r\n                    dialogInstance && (dialogInstance['open'] as (() => void) | undefined);\r\n\r\n                if (typeof openFn === 'function') {\r\n                    try {\r\n                        openFn();\r\n                    } catch (err) {\r\n                        console.warn(`Error restoring modal \"${id}\":`, err);\r\n                        // Fallback: show element directly\r\n                        const domUtils = (\r\n                            w as unknown as { DOMUtils?: { show?: (el: Element) => void } }\r\n                        ).DOMUtils;\r\n                        if (domUtils && typeof domUtils.show === 'function') {\r\n                            domUtils.show(el);\r\n                        } else {\r\n                            el.classList.remove('hidden');\r\n                        }\r\n                    }\r\n                } else {\r\n                    // No dialog instance, show element directly\r\n                    const domUtils = (\r\n                        w as unknown as { DOMUtils?: { show?: (el: Element) => void } }\r\n                    ).DOMUtils;\r\n                    if (domUtils && typeof domUtils.show === 'function') {\r\n                        domUtils.show(el);\r\n                    } else {\r\n                        el.classList.remove('hidden');\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        // Update dock indicators and program label (if available)\r\n        const updateDockIndicators = w['updateDockIndicators'] as (() => void) | undefined;\r\n        if (typeof updateDockIndicators === 'function') updateDockIndicators();\r\n        const updateProgramLabelByTopModal = w['updateProgramLabelByTopModal'] as\r\n            | (() => void)\r\n            | undefined;\r\n        if (typeof updateProgramLabelByTopModal === 'function') updateProgramLabelByTopModal();\r\n    }\r\n\r\n    // ===== Window Positions & Sizes =====\r\n\r\n    function getDialogWindowElement(modal: HTMLElement | null): HTMLElement | null {\r\n        if (!modal) return null;\r\n        return (modal.querySelector('.autopointer') as HTMLElement | null) || modal;\r\n    }\r\n\r\n    function saveWindowPositions(): void {\r\n        const modalIds = getModalIds();\r\n        const transientModalIds = getTransientModalIds();\r\n        const positions: Positions = {};\r\n\r\n        modalIds.forEach(id => {\r\n            if (transientModalIds.has(id)) return;\r\n            const el = document.getElementById(id) as HTMLElement | null;\r\n            const windowEl = getDialogWindowElement(el);\r\n            if (el && windowEl) {\r\n                positions[id] = {\r\n                    left: windowEl.style.left || '',\r\n                    top: windowEl.style.top || '',\r\n                    width: windowEl.style.width || '',\r\n                    height: windowEl.style.height || '',\r\n                    position: windowEl.style.position || '',\r\n                };\r\n            }\r\n        });\r\n\r\n        try {\r\n            setJSON(MODAL_POSITIONS_KEY, positions);\r\n        } catch (err) {\r\n            console.warn('Window positions konnte nicht gespeichert werden:', err);\r\n        }\r\n    }\r\n\r\n    function restoreWindowPositions(): void {\r\n        const transientModalIds = getTransientModalIds();\r\n        let positions: Positions = {};\r\n\r\n        try {\r\n            positions = getJSON<Positions>(MODAL_POSITIONS_KEY, {});\r\n        } catch (err) {\r\n            console.warn('Window positions konnte nicht gelesen werden:', err);\r\n            return;\r\n        }\r\n\r\n        Object.keys(positions).forEach(id => {\r\n            if (transientModalIds.has(id)) return;\r\n            const el = document.getElementById(id) as HTMLElement | null;\r\n            const windowEl = getDialogWindowElement(el);\r\n            if (el && windowEl) {\r\n                const stored = positions[id];\r\n                // noUncheckedIndexedAccess: positions[id] may be undefined\r\n                if (!stored) return;\r\n\r\n                if (stored.position) {\r\n                    windowEl.style.position = stored.position;\r\n                } else if (stored.left || stored.top) {\r\n                    windowEl.style.position = 'fixed';\r\n                }\r\n                if (stored.left) windowEl.style.left = stored.left;\r\n                if (stored.top) windowEl.style.top = stored.top;\r\n                if (stored.width) windowEl.style.width = stored.width;\r\n                if (stored.height) windowEl.style.height = stored.height;\r\n            }\r\n\r\n            const clampWindowToMenuBar = w['clampWindowToMenuBar'] as\r\n                | ((el: HTMLElement | null) => void)\r\n                | undefined;\r\n            if (typeof clampWindowToMenuBar === 'function') {\r\n                clampWindowToMenuBar(windowEl);\r\n            }\r\n        });\r\n    }\r\n\r\n    // ===== Layout Reset =====\r\n\r\n    function resetWindowLayout(): void {\r\n        const modalIds = getModalIds();\r\n\r\n        modalIds.forEach(id => {\r\n            const modal = document.getElementById(id) as HTMLElement | null;\r\n            const windowEl = getDialogWindowElement(modal);\r\n            if (modal) {\r\n                modal.style.zIndex = '';\r\n            }\r\n            if (windowEl) {\r\n                windowEl.style.left = '';\r\n                windowEl.style.top = '';\r\n                windowEl.style.width = '';\r\n                windowEl.style.height = '';\r\n                windowEl.style.position = '';\r\n                windowEl.style.zIndex = '';\r\n            }\r\n        });\r\n\r\n        if (typeof w['topZIndex'] !== 'undefined') {\r\n            w['topZIndex'] = 1000 as unknown;\r\n        }\r\n\r\n        try {\r\n            remove(MODAL_POSITIONS_KEY);\r\n        } catch (err) {\r\n            console.warn('Modal positions konnte nicht gel\u00F6scht werden:', err);\r\n        }\r\n\r\n        const hideMenuDropdowns = w['hideMenuDropdowns'] as (() => void) | undefined;\r\n        if (typeof hideMenuDropdowns === 'function') hideMenuDropdowns();\r\n\r\n        const syncTopZIndexWithDOM = w['syncTopZIndexWithDOM'] as (() => void) | undefined;\r\n        if (typeof syncTopZIndexWithDOM === 'function') syncTopZIndexWithDOM();\r\n\r\n        const dialogs = w['dialogs'] as Record<string, unknown> | undefined;\r\n        if (dialogs) {\r\n            Object.values(dialogs).forEach(dialog => {\r\n                const enforce = (dialog as Record<string, unknown>)['enforceMenuBarBoundary'] as\r\n                    | (() => void)\r\n                    | undefined;\r\n                if (typeof enforce === 'function') enforce();\r\n            });\r\n        }\r\n\r\n        // Clear finder state\r\n        clearFinderState();\r\n\r\n        const updateProgramLabelByTopModal = w['updateProgramLabelByTopModal'] as\r\n            | (() => void)\r\n            | undefined;\r\n        if (typeof updateProgramLabelByTopModal === 'function') updateProgramLabelByTopModal();\r\n    }\r\n\r\n    // ===== Public API (global) =====\r\n\r\n    const api = {\r\n        // Finder state\r\n        readFinderState,\r\n        writeFinderState,\r\n        clearFinderState,\r\n\r\n        // Open modals\r\n        saveOpenModals,\r\n        restoreOpenModals,\r\n\r\n        // Window positions\r\n        saveWindowPositions,\r\n        restoreWindowPositions,\r\n        getDialogWindowElement,\r\n\r\n        // Layout reset\r\n        resetWindowLayout,\r\n    };\r\n\r\n    w['StorageSystem'] = api;\r\n})();\r\n", "/**\r\n * src/ts/theme.ts\r\n * Theme management (dark/light/system) with safe typing and legacy compatibility.\r\n */\r\n\r\nimport { getString, setString } from '../services/storage-utils.js';\r\n\r\n(() => {\r\n    'use strict';\r\n\r\n    type ThemePref = 'system' | 'light' | 'dark';\r\n\r\n    // Constants from global config if available\r\n    const win = window as unknown as Record<string, unknown>;\r\n    const APP_CONSTANTS = (win.APP_CONSTANTS as Record<string, unknown>) || {};\r\n\r\n    const THEME_KEY = (APP_CONSTANTS.THEME_PREFERENCE_KEY as string) || 'themePreference';\r\n\r\n    const validThemePreferences: ThemePref[] = ['system', 'light', 'dark'];\r\n\r\n    const systemDarkQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n\r\n    let themePreference: ThemePref = (() => {\r\n        const fromStorage = getString(THEME_KEY) as ThemePref | null;\r\n        return (\r\n            fromStorage && validThemePreferences.includes(fromStorage) ? fromStorage : 'system'\r\n        ) as ThemePref;\r\n    })();\r\n\r\n    function updateThemeFromPreference(): void {\r\n        const useDark =\r\n            themePreference === 'dark' || (themePreference === 'system' && systemDarkQuery.matches);\r\n        document.documentElement.classList.toggle('dark', useDark);\r\n    }\r\n\r\n    function setThemePreference(pref: ThemePref): void {\r\n        if (!validThemePreferences.includes(pref)) return;\r\n        themePreference = pref;\r\n        setString(THEME_KEY, pref);\r\n        updateThemeFromPreference();\r\n\r\n        // Notify other modules\r\n        window.dispatchEvent(\r\n            new CustomEvent('themePreferenceChange', {\r\n                detail: { preference: pref },\r\n            })\r\n        );\r\n    }\r\n\r\n    function getThemePreference(): ThemePref {\r\n        return themePreference;\r\n    }\r\n\r\n    // Initialize\r\n    updateThemeFromPreference();\r\n\r\n    const handleSystemThemeChange = () => {\r\n        updateThemeFromPreference();\r\n    };\r\n\r\n    type MQLLegacy = MediaQueryList & {\r\n        addListener?: (listener: (this: MediaQueryList, ev: MediaQueryListEvent) => void) => void;\r\n        removeListener?: (\r\n            listener: (this: MediaQueryList, ev: MediaQueryListEvent) => void\r\n        ) => void;\r\n    };\r\n    const mql = systemDarkQuery as MQLLegacy;\r\n    if (typeof mql.addEventListener === 'function') {\r\n        mql.addEventListener('change', handleSystemThemeChange as EventListener);\r\n    } else if (typeof mql.addListener === 'function') {\r\n        mql.addListener(\r\n            handleSystemThemeChange as (this: MediaQueryList, ev: MediaQueryListEvent) => void\r\n        );\r\n    }\r\n\r\n    // Global export\r\n    const w = window as unknown as Record<string, unknown>;\r\n    w['ThemeSystem'] = {\r\n        setThemePreference,\r\n        getThemePreference,\r\n        updateThemeFromPreference,\r\n    };\r\n\r\n    // Legacy wrappers\r\n    w['setThemePreference'] = setThemePreference;\r\n    w['getThemePreference'] = getThemePreference;\r\n})();\r\n", "/**\r\n * src/ts/utils/auto-save-helper.ts\r\n * Shared utility for triggering auto-save via SessionManager\r\n */\r\n\r\n/**\r\n * Triggers auto-save for a specific instance type via SessionManager\r\n * @param type - The instance type to save\r\n */\r\nexport function triggerAutoSave(type: string): void {\r\n    const w = window as unknown as Record<string, unknown>;\r\n    const SessionManager = w.SessionManager as Record<string, unknown> | undefined;\r\n    if (SessionManager && typeof SessionManager.saveInstanceType === 'function') {\r\n        try {\r\n            (SessionManager.saveInstanceType as (type: string) => void)(type);\r\n        } catch (error) {\r\n            console.warn('Failed to trigger auto-save:', error);\r\n        }\r\n    }\r\n}\r\n", "/**\r\n * src/ts/base-window-instance.ts\r\n * Typed port of js/base-window-instance.js\r\n */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport { triggerAutoSave } from '../utils/auto-save-helper.js';\r\n\r\nexport type EventCallback = (data?: any) => void;\r\n\r\nexport interface BaseWindowConfig {\r\n    id?: string;\r\n    type?: string;\r\n    title?: string;\r\n    initialState?: Record<string, any>;\r\n    metadata?: Record<string, any>;\r\n}\r\n\r\nexport class BaseWindowInstance {\r\n    instanceId: string;\r\n    type: string;\r\n    title: string;\r\n    container: HTMLElement | null;\r\n    windowElement: HTMLElement | null;\r\n    state: Record<string, any>;\r\n    eventListeners: Map<string, EventCallback[]>;\r\n    isInitialized: boolean;\r\n    isVisible: boolean;\r\n    metadata: Record<string, any>;\r\n    protected _skipInitialRender: boolean;\r\n\r\n    constructor(config: BaseWindowConfig) {\r\n        this.instanceId = config.id || this._generateId();\r\n        this.type = config.type || 'unknown';\r\n        this.title = config.title || 'Untitled';\r\n        this.container = null;\r\n        this.windowElement = null;\r\n        this.state = this._initializeState(config.initialState || {});\r\n        this.eventListeners = new Map();\r\n        this.isInitialized = false;\r\n        this.isVisible = false;\r\n        this.metadata = config.metadata || {};\r\n        this._skipInitialRender = false;\r\n    }\r\n\r\n    private _generateId(): string {\r\n        return `${this.type}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n    }\r\n\r\n    private _initializeState(initialState: Record<string, any>): Record<string, any> {\r\n        return {\r\n            ...initialState,\r\n            created: Date.now(),\r\n            modified: Date.now(),\r\n        };\r\n    }\r\n\r\n    init(container: HTMLElement) {\r\n        if (this.isInitialized) {\r\n            console.warn(`Instance ${this.instanceId} already initialized`);\r\n            return;\r\n        }\r\n        this.container = container;\r\n        this.render();\r\n        this.attachEventListeners();\r\n        this.isInitialized = true;\r\n        this.emit('initialized');\r\n    }\r\n\r\n    // Subclasses must implement render\r\n    render(): void {\r\n        throw new Error('render() must be implemented by subclass');\r\n    }\r\n\r\n    attachEventListeners(): void {\r\n        // optional override by subclasses\r\n    }\r\n\r\n    show(): void {\r\n        if (this.container) {\r\n            const domUtils = (window as any).DOMUtils;\r\n            if (domUtils && typeof domUtils.show === 'function') {\r\n                domUtils.show(this.container);\r\n            } else {\r\n                this.container.classList.remove('hidden');\r\n            }\r\n            this.isVisible = true;\r\n            this.emit('shown');\r\n        }\r\n    }\r\n\r\n    hide(): void {\r\n        if (this.container) {\r\n            const domUtils = (window as any).DOMUtils;\r\n            if (domUtils && typeof domUtils.hide === 'function') {\r\n                domUtils.hide(this.container);\r\n            } else {\r\n                this.container.classList.add('hidden');\r\n            }\r\n            this.isVisible = false;\r\n            this.emit('hidden');\r\n        }\r\n    }\r\n\r\n    destroy(): void {\r\n        this.emit('beforeDestroy');\r\n        this.removeAllEventListeners();\r\n        if (this.container) {\r\n            try {\r\n                if (typeof (this.container as any).remove === 'function') {\r\n                    (this.container as any).remove();\r\n                } else if (this.container.parentNode) {\r\n                    this.container.parentNode.removeChild(this.container);\r\n                }\r\n            } catch {\r\n                try {\r\n                    this.container.innerHTML = '';\r\n                    this.container.classList.add('hidden');\r\n                } catch {\r\n                    /* ignore */\r\n                }\r\n            }\r\n            this.container = null;\r\n        }\r\n        this.windowElement = null;\r\n        this.isInitialized = false;\r\n        this.emit('destroyed');\r\n    }\r\n\r\n    updateState(updates: Record<string, any>): void {\r\n        const oldState = { ...this.state };\r\n        this.state = {\r\n            ...this.state,\r\n            ...updates,\r\n            modified: Date.now(),\r\n        };\r\n        this.emit('stateChanged', { oldState, newState: this.state });\r\n\r\n        // Trigger auto-save when state changes\r\n        this._triggerAutoSave();\r\n    }\r\n\r\n    private _triggerAutoSave(): void {\r\n        const w = window as any;\r\n        if (w.SessionManager && typeof w.SessionManager.saveInstanceType === 'function') {\r\n            try {\r\n                w.SessionManager.saveInstanceType(this.type);\r\n            } catch (error) {\r\n                console.warn('Failed to trigger auto-save:', error);\r\n            }\r\n        }\r\n    }\r\n\r\n    getState(): Record<string, any> {\r\n        return { ...this.state };\r\n    }\r\n\r\n    serialize() {\r\n        return {\r\n            instanceId: this.instanceId,\r\n            type: this.type,\r\n            title: this.title,\r\n            state: this.getState(),\r\n            metadata: this.metadata,\r\n        };\r\n    }\r\n\r\n    deserialize(data: any) {\r\n        // Setze Flag, um doppeltes Rendern bei Session Restore zu verhindern\r\n        this._skipInitialRender = true;\r\n\r\n        if (data.state) this.state = data.state;\r\n        if (data.title) this.title = data.title;\r\n        if (data.metadata) this.metadata = { ...this.metadata, ...data.metadata };\r\n        this.emit('deserialized');\r\n    }\r\n\r\n    emit(eventName: string, data?: any): void {\r\n        const listeners = this.eventListeners.get(eventName) || [];\r\n        listeners.forEach(callback => {\r\n            try {\r\n                callback.call(this, data);\r\n            } catch (error) {\r\n                console.error(`Error in event listener for ${eventName}:`, error);\r\n            }\r\n        });\r\n    }\r\n\r\n    on(eventName: string, callback: EventCallback): void {\r\n        if (!this.eventListeners.has(eventName)) this.eventListeners.set(eventName, []);\r\n        this.eventListeners.get(eventName)!.push(callback);\r\n    }\r\n\r\n    off(eventName: string, callback: EventCallback): void {\r\n        if (!this.eventListeners.has(eventName)) return;\r\n        const listeners = this.eventListeners.get(eventName)!;\r\n        const index = listeners.indexOf(callback);\r\n        if (index > -1) listeners.splice(index, 1);\r\n    }\r\n\r\n    removeAllEventListeners(): void {\r\n        this.eventListeners.clear();\r\n    }\r\n\r\n    focus(): void {\r\n        if (this.container && this.isVisible) this.emit('focused');\r\n    }\r\n\r\n    blur(): void {\r\n        this.emit('blurred');\r\n    }\r\n}\r\n\r\n// Attach to window for legacy compatibility\r\n// Note: Type declaration is in types/index.d.ts\r\nif (typeof window !== 'undefined') {\r\n    (window as any).BaseWindowInstance = BaseWindowInstance;\r\n}\r\n\r\nexport default BaseWindowInstance;\r\nconsole.log('BaseWindowInstance loaded');\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    type InstanceConfig = {\r\n        id?: string;\r\n        type?: string;\r\n        title?: string;\r\n        initialState?: Record<string, unknown>;\r\n        metadata?: Record<string, unknown>;\r\n    };\r\n\r\n    type StateChangeEvent = {\r\n        oldState: Record<string, unknown>;\r\n        newState: Record<string, unknown>;\r\n    };\r\n\r\n    type SerializedInstance = {\r\n        instanceId: string;\r\n        type: string;\r\n        title: string;\r\n        state: Record<string, unknown>;\r\n        metadata: Record<string, unknown>;\r\n    };\r\n\r\n    type EventCallback = (data?: unknown) => void;\r\n\r\n    class BaseWindowInstance {\r\n        instanceId: string;\r\n        type: string;\r\n        title: string;\r\n        container: HTMLElement | null;\r\n        windowElement: HTMLElement | null;\r\n        state: Record<string, unknown>;\r\n        eventListeners: Map<string, EventCallback[]>;\r\n        isInitialized: boolean;\r\n        isVisible: boolean;\r\n        metadata: Record<string, unknown>;\r\n        protected _skipInitialRender: boolean;\r\n\r\n        constructor(config: InstanceConfig) {\r\n            this.instanceId = config.id || this._generateId();\r\n            this.type = config.type || 'unknown';\r\n            this.title = config.title || 'Untitled';\r\n            this.container = null;\r\n            this.windowElement = null;\r\n            this.state = this._initializeState(config.initialState || {});\r\n            this.eventListeners = new Map();\r\n            this.isInitialized = false;\r\n            this.isVisible = false;\r\n            this.metadata = config.metadata || {};\r\n            this._skipInitialRender = false;\r\n        }\r\n\r\n        protected _generateId(): string {\r\n            return `${this.type}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n        }\r\n\r\n        protected _initializeState(initialState: Record<string, unknown>): Record<string, unknown> {\r\n            return {\r\n                ...initialState,\r\n                created: Date.now(),\r\n                modified: Date.now(),\r\n            };\r\n        }\r\n\r\n        init(container: HTMLElement): void {\r\n            if (this.isInitialized) {\r\n                console.warn(`Instance ${this.instanceId} already initialized`);\r\n                return;\r\n            }\r\n\r\n            this.container = container;\r\n            this.render();\r\n            this.attachEventListeners();\r\n            this.isInitialized = true;\r\n            this.emit('initialized');\r\n        }\r\n\r\n        protected render(): void {\r\n            throw new Error('render() must be implemented by subclass');\r\n        }\r\n\r\n        protected attachEventListeners(): void {\r\n            // To be implemented by subclasses\r\n        }\r\n\r\n        show(): void {\r\n            if (this.container) {\r\n                const domUtils = (window as any).DOMUtils;\r\n                if (domUtils && typeof domUtils.show === 'function') {\r\n                    domUtils.show(this.container);\r\n                } else {\r\n                    this.container.classList.remove('hidden');\r\n                }\r\n            }\r\n        }\r\n\r\n        hide(): void {\r\n            if (this.container) {\r\n                const domUtils = (window as any).DOMUtils;\r\n                if (domUtils && typeof domUtils.hide === 'function') {\r\n                    domUtils.hide(this.container);\r\n                } else {\r\n                    this.container.classList.add('hidden');\r\n                }\r\n                this.isVisible = false;\r\n                this.emit('hidden');\r\n            }\r\n        }\r\n\r\n        destroy(): void {\r\n            this.emit('beforeDestroy');\r\n            this.removeAllEventListeners();\r\n\r\n            if (this.container) {\r\n                try {\r\n                    // Remove container element from DOM to avoid orphaned visible nodes\r\n                    if (typeof (this.container as HTMLElement).remove === 'function') {\r\n                        (this.container as HTMLElement).remove();\r\n                    } else if ((this.container as HTMLElement).parentNode) {\r\n                        (this.container as HTMLElement).parentNode!.removeChild(\r\n                            this.container as HTMLElement\r\n                        );\r\n                    }\r\n                } catch {\r\n                    // Fallback: clear contents and hide\r\n                    try {\r\n                        this.container.innerHTML = '';\r\n                        this.container.classList.add('hidden');\r\n                    } catch {\r\n                        /* ignore */\r\n                    }\r\n                }\r\n                this.container = null;\r\n            }\r\n\r\n            this.windowElement = null;\r\n            this.isInitialized = false;\r\n            this.emit('destroyed');\r\n        }\r\n\r\n        updateState(updates: Record<string, unknown>): void {\r\n            const oldState = { ...this.state };\r\n            this.state = {\r\n                ...this.state,\r\n                ...updates,\r\n                modified: Date.now(),\r\n            };\r\n            this.emit('stateChanged', { oldState, newState: this.state } as StateChangeEvent);\r\n\r\n            // Trigger auto-save when state changes\r\n            this._triggerAutoSave();\r\n        }\r\n\r\n        private _triggerAutoSave(): void {\r\n            triggerAutoSave(this.type);\r\n        }\r\n\r\n        getState(): Record<string, unknown> {\r\n            return { ...this.state };\r\n        }\r\n\r\n        serialize(): SerializedInstance {\r\n            return {\r\n                instanceId: this.instanceId,\r\n                type: this.type,\r\n                title: this.title,\r\n                state: this.getState(),\r\n                metadata: this.metadata,\r\n            };\r\n        }\r\n\r\n        deserialize(data: Partial<SerializedInstance>): void {\r\n            // Setze Flag, um doppeltes Rendern bei Session Restore zu verhindern\r\n            this._skipInitialRender = true;\r\n\r\n            if (data.state) {\r\n                this.state = data.state;\r\n            }\r\n            if (data.title) {\r\n                this.title = data.title;\r\n            }\r\n            if (data.metadata) {\r\n                this.metadata = { ...this.metadata, ...data.metadata };\r\n            }\r\n            this.emit('deserialized');\r\n        }\r\n\r\n        emit(eventName: string, data?: unknown): void {\r\n            const listeners = this.eventListeners.get(eventName) || [];\r\n            listeners.forEach(callback => {\r\n                try {\r\n                    callback.call(this, data);\r\n                } catch (error) {\r\n                    console.error(`Error in event listener for ${eventName}:`, error);\r\n                }\r\n            });\r\n        }\r\n\r\n        on(eventName: string, callback: EventCallback): void {\r\n            if (!this.eventListeners.has(eventName)) {\r\n                this.eventListeners.set(eventName, []);\r\n            }\r\n            this.eventListeners.get(eventName)!.push(callback);\r\n        }\r\n\r\n        off(eventName: string, callback: EventCallback): void {\r\n            if (!this.eventListeners.has(eventName)) return;\r\n\r\n            const listeners = this.eventListeners.get(eventName)!;\r\n            const index = listeners.indexOf(callback);\r\n            if (index > -1) {\r\n                listeners.splice(index, 1);\r\n            }\r\n        }\r\n\r\n        removeAllEventListeners(): void {\r\n            this.eventListeners.clear();\r\n        }\r\n\r\n        focus(): void {\r\n            if (this.container && this.isVisible) {\r\n                this.emit('focused');\r\n            }\r\n        }\r\n\r\n        blur(): void {\r\n            this.emit('blurred');\r\n        }\r\n    }\r\n\r\n    (window as unknown as { BaseWindowInstance: typeof BaseWindowInstance }).BaseWindowInstance =\r\n        BaseWindowInstance;\r\n})();\r\n", "import { triggerAutoSave } from '../utils/auto-save-helper.js';\r\nimport { getJSON, setJSON } from '../services/storage-utils.js';\r\n\r\nconsole.log('InstanceManager loaded');\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    type BaseInstanceLike = {\r\n        instanceId: string;\r\n        init: (container: HTMLElement) => void;\r\n        destroy: () => void;\r\n        blur: () => void;\r\n        focus: () => void;\r\n        serialize: () => Record<string, unknown>;\r\n        deserialize: (data: Record<string, unknown>) => void;\r\n        on: (event: string, callback: (data?: unknown) => void) => void;\r\n    };\r\n\r\n    type InstanceConstructor = new (config: Record<string, unknown>) => BaseInstanceLike;\r\n\r\n    type ManagerConfig = {\r\n        type: string;\r\n        instanceClass: InstanceConstructor;\r\n        maxInstances?: number;\r\n        createContainer?: (instanceId: string) => HTMLElement | null;\r\n    };\r\n\r\n    type CreateInstanceConfig = {\r\n        id?: string;\r\n        title?: string;\r\n        initialState?: Record<string, unknown>;\r\n        metadata?: Record<string, unknown>;\r\n    };\r\n\r\n    class InstanceManager {\r\n        type: string;\r\n        instanceClass: InstanceConstructor;\r\n        maxInstances: number;\r\n        createContainer: (instanceId: string) => HTMLElement | null;\r\n        instances: Map<string, BaseInstanceLike>;\r\n        activeInstanceId: string | null;\r\n        instanceCounter: number;\r\n\r\n        constructor(config: ManagerConfig) {\r\n            this.type = config.type;\r\n            this.instanceClass = config.instanceClass;\r\n            this.maxInstances = config.maxInstances || 0;\r\n            this.createContainer =\r\n                config.createContainer || this._defaultCreateContainer.bind(this);\r\n\r\n            this.instances = new Map();\r\n            this.activeInstanceId = null;\r\n            this.instanceCounter = 0;\r\n        }\r\n\r\n        createInstance(config: CreateInstanceConfig = {}): BaseInstanceLike | null {\r\n            if (this.maxInstances > 0 && this.instances.size >= this.maxInstances) {\r\n                console.warn(`Maximum instances (${this.maxInstances}) reached for ${this.type}`);\r\n                return null;\r\n            }\r\n\r\n            this.instanceCounter++;\r\n            const instanceId = config.id || `${this.type}-${this.instanceCounter}`;\r\n\r\n            // Guard: If an instance with this ID already exists, reuse it instead of creating\r\n            // a new container. This prevents duplicate DOM containers and double-rendering\r\n            // when restore flows or legacy init handlers accidentally create the same ID twice.\r\n            if (config.id && this.instances.has(instanceId)) {\r\n                console.warn(\r\n                    `Instance with id ${instanceId} already exists for ${this.type}; reusing existing instance.`\r\n                );\r\n                const existing = this.instances.get(instanceId)!;\r\n                // Optionally update title/metadata\r\n                try {\r\n                    (existing as any).title = config.title || (existing as any).title;\r\n                    (existing as any).metadata = {\r\n                        ...(existing as any).metadata,\r\n                        ...(config.metadata || {}),\r\n                    };\r\n                } catch {}\r\n                // Make it active to sync with UI\r\n                this.setActiveInstance(instanceId);\r\n                // Trigger auto-save to persist consistency\r\n                this._triggerAutoSave();\r\n                return existing;\r\n            }\r\n\r\n            const container = this.createContainer(instanceId);\r\n            if (!container) {\r\n                console.error('Failed to create container for instance');\r\n                return null;\r\n            }\r\n\r\n            const instanceConfig = {\r\n                id: instanceId,\r\n                type: this.type,\r\n                title: config.title || `${this.type} ${this.instanceCounter}`,\r\n                initialState: config.initialState || {},\r\n                metadata: config.metadata || {},\r\n            };\r\n\r\n            const instance = new this.instanceClass(instanceConfig);\r\n\r\n            try {\r\n                instance.init(container);\r\n                this.instances.set(instanceId, instance);\r\n\r\n                this._setupInstanceEvents(instance);\r\n\r\n                // Set as active instance (triggers focus and events)\r\n                this.setActiveInstance(instanceId);\r\n\r\n                // Trigger auto-save after instance creation\r\n                this._triggerAutoSave();\r\n\r\n                console.log(`Created instance: ${instanceId}`);\r\n                return instance;\r\n            } catch (error) {\r\n                console.error('Failed to initialize instance:', error);\r\n                container.remove();\r\n                return null;\r\n            }\r\n        }\r\n\r\n        getInstance(instanceId: string): BaseInstanceLike | null {\r\n            return this.instances.get(instanceId) || null;\r\n        }\r\n\r\n        getActiveInstance(): BaseInstanceLike | null {\r\n            return this.activeInstanceId ? this.instances.get(this.activeInstanceId) || null : null;\r\n        }\r\n\r\n        setActiveInstance(instanceId: string): void {\r\n            if (this.instances.has(instanceId)) {\r\n                const previousId = this.activeInstanceId;\r\n\r\n                // Guard: avoid recursion if already active\r\n                if (previousId === instanceId) {\r\n                    return;\r\n                }\r\n\r\n                this.activeInstanceId = instanceId;\r\n\r\n                // Blur previous instance\r\n                if (previousId) {\r\n                    const previousInstance = this.instances.get(previousId);\r\n                    if (previousInstance) {\r\n                        previousInstance.blur();\r\n                    }\r\n                }\r\n\r\n                // Focus new instance\r\n                const instance = this.instances.get(instanceId);\r\n                if (instance) {\r\n                    instance.focus();\r\n                }\r\n\r\n                // Persist active tab selection (debounced via SessionManager)\r\n                this._triggerAutoSave();\r\n\r\n                // Additionally persist active selection per type in localStorage for robust restore\r\n                try {\r\n                    const KEY = 'windowActiveInstances';\r\n                    const map = getJSON<Record<string, string | null>>(KEY, {});\r\n                    map[this.type] = this.activeInstanceId;\r\n                    setJSON(KEY, map);\r\n                } catch {\r\n                    // ignore storage failures\r\n                }\r\n            }\r\n        }\r\n\r\n        getAllInstances(): BaseInstanceLike[] {\r\n            return Array.from(this.instances.values());\r\n        }\r\n\r\n        getAllInstanceIds(): string[] {\r\n            return Array.from(this.instances.keys());\r\n        }\r\n\r\n        destroyInstance(instanceId: string): void {\r\n            const instance = this.instances.get(instanceId);\r\n            if (!instance) {\r\n                console.warn(`Instance ${instanceId} not found`);\r\n                return;\r\n            }\r\n\r\n            instance.destroy();\r\n            this.instances.delete(instanceId);\r\n\r\n            // Update active instance if needed\r\n            if (this.activeInstanceId === instanceId) {\r\n                const remainingIds = this.getAllInstanceIds();\r\n                // noUncheckedIndexedAccess: array access returns T | undefined\r\n                const lastId =\r\n                    remainingIds.length > 0 ? remainingIds[remainingIds.length - 1] : undefined;\r\n                this.activeInstanceId = lastId ?? null;\r\n            }\r\n\r\n            // Trigger auto-save after instance destruction\r\n            this._triggerAutoSave();\r\n\r\n            console.log(`Destroyed instance: ${instanceId}`);\r\n        }\r\n\r\n        destroyAllInstances(): void {\r\n            this.instances.forEach(instance => {\r\n                instance.destroy();\r\n            });\r\n            this.instances.clear();\r\n            this.activeInstanceId = null;\r\n\r\n            // Trigger auto-save after destroying all instances\r\n            this._triggerAutoSave();\r\n        }\r\n\r\n        hasInstances(): boolean {\r\n            return this.instances.size > 0;\r\n        }\r\n\r\n        getInstanceCount(): number {\r\n            return this.instances.size;\r\n        }\r\n\r\n        serializeAll(): Record<string, unknown>[] {\r\n            const activeId = this.activeInstanceId;\r\n            return this.getAllInstances().map(instance => {\r\n                const data = instance.serialize();\r\n                try {\r\n                    // Mark the active instance in metadata for robust restoration without schema changes\r\n                    const meta = (data as any).metadata || {};\r\n                    if (instance.instanceId === activeId) {\r\n                        meta.__active = true;\r\n                    }\r\n                    (data as any).metadata = meta;\r\n                } catch {\r\n                    /* ignore */\r\n                }\r\n                return data;\r\n            });\r\n        }\r\n\r\n        deserializeAll(data: unknown): void {\r\n            if (!Array.isArray(data)) return;\r\n            let desiredActiveId: string | null = null;\r\n\r\n            data.forEach((instanceData: Record<string, unknown>) => {\r\n                const instance = this.createInstance({\r\n                    id: instanceData.instanceId as string | undefined,\r\n                    title: instanceData.title as string | undefined,\r\n                    metadata: instanceData.metadata as Record<string, unknown> | undefined,\r\n                });\r\n\r\n                if (instance && instanceData.state) {\r\n                    instance.deserialize(instanceData);\r\n                }\r\n\r\n                // If this instance was marked active previously, remember it for final activation\r\n                try {\r\n                    const meta = instanceData.metadata as Record<string, unknown> | undefined;\r\n                    if (meta && (meta as any).__active) {\r\n                        desiredActiveId = (instanceData.instanceId as string) || null;\r\n                    }\r\n                } catch {\r\n                    /* ignore */\r\n                }\r\n            });\r\n\r\n            // Set active instance and ensure visibility is updated\r\n            if (desiredActiveId) {\r\n                this.setActiveInstance(desiredActiveId);\r\n            } else if (this.instances.size > 0) {\r\n                // If no active instance was marked, activate the first one\r\n                const firstInstance = Array.from(this.instances.values())[0];\r\n                if (firstInstance) {\r\n                    this.setActiveInstance(firstInstance.instanceId);\r\n                }\r\n            }\r\n\r\n            // Trigger visibility update after all instances are restored\r\n            this._updateVisibilityAfterRestore();\r\n        }\r\n\r\n        private _updateVisibilityAfterRestore(): void {\r\n            const w = window as any;\r\n            const integration = w.multiInstanceIntegration || w.MultiInstanceIntegration;\r\n            if (integration && typeof integration.updateInstanceVisibility === 'function') {\r\n                integration.updateInstanceVisibility(this.type);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Reorder instances to match the provided array of instance IDs\r\n         * @param newOrder - Array of instance IDs in the desired order\r\n         */\r\n        reorderInstances(newOrder: string[]): void {\r\n            // Validate that all IDs exist\r\n            const validIds = newOrder.filter(id => this.instances.has(id));\r\n            if (validIds.length !== this.instances.size) {\r\n                console.warn(\r\n                    'Invalid reorder: not all instance IDs provided or some IDs do not exist'\r\n                );\r\n                return;\r\n            }\r\n\r\n            // Create a new Map with the desired order\r\n            const newMap = new Map<string, BaseInstanceLike>();\r\n            validIds.forEach(id => {\r\n                const instance = this.instances.get(id);\r\n                if (instance) {\r\n                    newMap.set(id, instance);\r\n                }\r\n            });\r\n\r\n            // Replace the instances map\r\n            this.instances = newMap;\r\n            console.log('Instances reordered:', validIds);\r\n        }\r\n\r\n        private _triggerAutoSave(): void {\r\n            triggerAutoSave(this.type);\r\n        }\r\n\r\n        private _defaultCreateContainer(instanceId: string): HTMLElement {\r\n            const container = document.createElement('div');\r\n            container.id = `${instanceId}-container`;\r\n            container.className = 'instance-container';\r\n            document.body.appendChild(container);\r\n            return container;\r\n        }\r\n\r\n        private _setupInstanceEvents(instance: BaseInstanceLike): void {\r\n            instance.on('focused', () => {\r\n                this.setActiveInstance(instance.instanceId);\r\n            });\r\n\r\n            instance.on('destroyed', () => {\r\n                this.instances.delete(instance.instanceId);\r\n            });\r\n        }\r\n    }\r\n\r\n    (window as unknown as { InstanceManager: typeof InstanceManager }).InstanceManager =\r\n        InstanceManager;\r\n})();\r\n", "console.log('WindowChrome loaded');\r\n\r\n(function () {\r\n  'use strict';\r\n\r\n  type ControlType = 'close' | 'minimize' | 'maximize';\r\n\r\n  type TitlebarConfig = {\r\n    title?: string;\r\n    icon?: string;\r\n    showClose?: boolean;\r\n    showMinimize?: boolean;\r\n    showMaximize?: boolean;\r\n    onClose?: () => void;\r\n    onMinimize?: () => void;\r\n    onMaximize?: () => void;\r\n  };\r\n\r\n  type ToolbarSeparator = { type: 'separator' };\r\n  type ToolbarButtonCfg = {\r\n    label?: string;\r\n    icon?: string;\r\n    title?: string;\r\n    action?: string;\r\n    onClick?: (e: MouseEvent) => void;\r\n  };\r\n  type ToolbarItem = ToolbarSeparator | ToolbarButtonCfg;\r\n\r\n  type StatusBarConfig = {\r\n    leftContent?: string;\r\n    rightContent?: string;\r\n  };\r\n\r\n  type WindowFrameConfig = TitlebarConfig & {\r\n    toolbar?: ToolbarItem[];\r\n    showStatusBar?: boolean;\r\n    statusBarLeft?: string;\r\n    statusBarRight?: string;\r\n  };\r\n\r\n  type WindowFrameParts = {\r\n    frame: HTMLElement;\r\n    titlebar: HTMLElement;\r\n    content: HTMLElement;\r\n    statusbar: HTMLElement | null;\r\n  };\r\n\r\n  function createControlButton(type: ControlType, symbol: string, callback?: () => void): HTMLButtonElement {\r\n    const btn = document.createElement('button');\r\n    btn.type = 'button';\r\n    btn.className = `window-control-btn window-${type}-btn`;\r\n    btn.innerHTML = symbol;\r\n    btn.style.cssText =\r\n      'width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: background-color 0.2s;';\r\n\r\n    btn.addEventListener('mouseenter', () => {\r\n      if (type === 'close') {\r\n        btn.style.backgroundColor = '#ef4444';\r\n        btn.style.color = '#ffffff';\r\n      } else {\r\n        btn.style.backgroundColor = 'rgba(0, 0, 0, 0.1)';\r\n      }\r\n    });\r\n\r\n    btn.addEventListener('mouseleave', () => {\r\n      btn.style.backgroundColor = 'transparent';\r\n      btn.style.color = '';\r\n    });\r\n\r\n    if (callback) {\r\n      btn.addEventListener('click', () => callback());\r\n    }\r\n\r\n    return btn;\r\n  }\r\n\r\n  function createToolbarButton(config: ToolbarButtonCfg): HTMLButtonElement {\r\n    const btn = document.createElement('button');\r\n    btn.type = 'button';\r\n    btn.className = 'toolbar-btn px-2 py-1 text-sm rounded hover:bg-gray-200 dark:hover:bg-gray-800 transition';\r\n\r\n    if (config.icon) {\r\n      btn.innerHTML = config.icon;\r\n    } else if (config.label) {\r\n      btn.textContent = config.label;\r\n    }\r\n\r\n    if (config.title) btn.title = config.title;\r\n    if (config.action) btn.dataset.action = config.action;\r\n    if (config.onClick) btn.addEventListener('click', config.onClick);\r\n\r\n    return btn;\r\n  }\r\n\r\n  const WindowChrome = {\r\n    createTitlebar(config: TitlebarConfig): HTMLElement {\r\n      const titlebar = document.createElement('div');\r\n      titlebar.className =\r\n        'window-titlebar flex items-center justify-between px-3 py-2 bg-gray-200 dark:bg-gray-800 border-b border-gray-300 dark:border-gray-700';\r\n      titlebar.style.cssText = 'height: 32px; cursor: move; user-select: none;';\r\n\r\n      const leftSide = document.createElement('div');\r\n      leftSide.className = 'flex items-center gap-2';\r\n\r\n      if (config.icon) {\r\n        const iconEl = document.createElement('span');\r\n        iconEl.className = 'window-icon';\r\n\r\n        if (config.icon.startsWith('http') || config.icon.startsWith('./') || config.icon.startsWith('/')) {\r\n          const img = document.createElement('img');\r\n          img.src = config.icon;\r\n          img.alt = '';\r\n          img.style.cssText = 'width: 16px; height: 16px; object-fit: contain;';\r\n          iconEl.appendChild(img);\r\n        } else {\r\n          iconEl.textContent = config.icon;\r\n          iconEl.style.fontSize = '16px';\r\n        }\r\n\r\n        leftSide.appendChild(iconEl);\r\n      }\r\n\r\n      const titleEl = document.createElement('span');\r\n      titleEl.className = 'window-title font-medium text-sm text-gray-800 dark:text-gray-200';\r\n      titleEl.textContent = config.title || 'Untitled';\r\n      (titleEl as HTMLElement).dataset.titleTarget = 'true';\r\n      leftSide.appendChild(titleEl);\r\n\r\n      titlebar.appendChild(leftSide);\r\n\r\n      const rightSide = document.createElement('div');\r\n      rightSide.className = 'flex items-center gap-1';\r\n\r\n      if (config.showMinimize) {\r\n        rightSide.appendChild(createControlButton('minimize', '\u2212', config.onMinimize));\r\n      }\r\n      if (config.showMaximize) {\r\n        rightSide.appendChild(createControlButton('maximize', '\u25A1', config.onMaximize));\r\n      }\r\n      if (config.showClose !== false) {\r\n        rightSide.appendChild(createControlButton('close', '\u00D7', config.onClose));\r\n      }\r\n\r\n      titlebar.appendChild(rightSide);\r\n\r\n      return titlebar;\r\n    },\r\n\r\n    createToolbar(buttons: ToolbarItem[]): HTMLElement {\r\n      const toolbar = document.createElement('div');\r\n      toolbar.className =\r\n        'window-toolbar flex items-center gap-2 px-3 py-2 bg-gray-100 dark:bg-gray-900 border-b border-gray-300 dark:border-gray-700';\r\n\r\n      buttons.forEach((btn) => {\r\n        if ((btn as ToolbarSeparator).type === 'separator') {\r\n          const separator = document.createElement('div');\r\n          separator.className = 'toolbar-separator';\r\n          separator.style.cssText = 'width: 1px; height: 20px; background: currentColor; opacity: 0.2;';\r\n          toolbar.appendChild(separator);\r\n        } else {\r\n          toolbar.appendChild(createToolbarButton(btn as ToolbarButtonCfg));\r\n        }\r\n      });\r\n\r\n      return toolbar;\r\n    },\r\n\r\n    createStatusBar(config: StatusBarConfig): HTMLElement {\r\n      const statusBar = document.createElement('div');\r\n      statusBar.className =\r\n        'window-statusbar flex items-center justify-between px-3 py-1 bg-gray-100 dark:bg-gray-900 border-t border-gray-300 dark:border-gray-700 text-xs text-gray-600 dark:text-gray-400';\r\n      statusBar.style.cssText = 'height: 24px;';\r\n\r\n      const leftEl = document.createElement('span');\r\n      leftEl.className = 'statusbar-left';\r\n      leftEl.textContent = config.leftContent || '';\r\n      statusBar.appendChild(leftEl);\r\n\r\n      const rightEl = document.createElement('span');\r\n      rightEl.className = 'statusbar-right';\r\n      rightEl.textContent = config.rightContent || '';\r\n      statusBar.appendChild(rightEl);\r\n\r\n      return statusBar;\r\n    },\r\n\r\n    updateTitle(titlebar: HTMLElement, newTitle: string): void {\r\n      const titleEl = titlebar.querySelector('[data-title-target=\"true\"]');\r\n      if (titleEl) (titleEl as HTMLElement).textContent = newTitle;\r\n    },\r\n\r\n    updateStatusBar(statusBar: HTMLElement, side: 'left' | 'right', content: string): void {\r\n      const target = statusBar.querySelector(`.statusbar-${side}`);\r\n      if (target) (target as HTMLElement).textContent = content;\r\n    },\r\n\r\n    createWindowFrame(config: WindowFrameConfig): WindowFrameParts {\r\n      const frame = document.createElement('div');\r\n      frame.className = 'window-frame flex flex-col h-full bg-white dark:bg-gray-900 rounded-lg shadow-lg overflow-hidden';\r\n\r\n      const titlebar = this.createTitlebar({\r\n        title: config.title || 'Untitled',\r\n        icon: config.icon,\r\n        showClose: config.showClose,\r\n        showMinimize: config.showMinimize,\r\n        showMaximize: config.showMaximize,\r\n        onClose: config.onClose,\r\n        onMinimize: config.onMinimize,\r\n        onMaximize: config.onMaximize,\r\n      });\r\n      frame.appendChild(titlebar);\r\n\r\n      if (config.toolbar) {\r\n        const toolbar = this.createToolbar(config.toolbar);\r\n        frame.appendChild(toolbar);\r\n      }\r\n\r\n      const content = document.createElement('div');\r\n      content.className = 'window-content flex-1 overflow-auto';\r\n      frame.appendChild(content);\r\n\r\n      let statusbar: HTMLElement | null = null;\r\n      if (config.showStatusBar) {\r\n        statusbar = this.createStatusBar({\r\n          leftContent: config.statusBarLeft || '',\r\n          rightContent: config.statusBarRight || '',\r\n        });\r\n        frame.appendChild(statusbar);\r\n      }\r\n\r\n      return { frame, titlebar, content, statusbar };\r\n    },\r\n  } as const;\r\n\r\n  (window as unknown as { WindowChrome: typeof WindowChrome }).WindowChrome = WindowChrome;\r\n})();\r\n", "/**\r\n * src/ts/base-tab.ts\r\n * Base class for tabs within a window\r\n * Each tab represents a content instance (Terminal Session, Document, etc.)\r\n */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport type { BaseWindow } from '../windows/base-window.js';\r\n\r\nexport interface TabConfig {\r\n    id?: string;\r\n    type: string;\r\n    title?: string;\r\n    icon?: string;\r\n    content?: any;\r\n    metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface TabState {\r\n    id: string;\r\n    type: string;\r\n    title: string;\r\n    icon?: string;\r\n    contentState: any;\r\n    created: number;\r\n    modified: number;\r\n}\r\n\r\n/**\r\n * BaseTab \u2013 Basisklasse f\u00FCr Inhalte innerhalb eines Fensters\r\n *\r\n * Architektur\r\n * -----------\r\n * - Ein Tab geh\u00F6rt immer genau einem Fenster (parentWindow) \u2013 kann aber via\r\n *   Drag&Drop in ein anderes Fenster verschoben werden.\r\n * - Der Inhalt (createDOM/render) ist unabh\u00E4ngig vom Fenstercontainer.\r\n * - Relevanter Zustand wird in contentState gehalten und bei \u00C4nderungen\r\n *   gespeichert (_saveState), damit Session\u2011Restore funktioniert.\r\n *\r\n * Erweiterung\r\n * -----------\r\n * - Subklassen M\u00DCSSEN createDOM() \u00FCberschreiben und k\u00F6nnen onShow/onHide\r\n *   nutzen.\r\n * - setTitle() benachrichtigt das Elternfenster zur Aktualisierung der Tabbar\r\n *   (z. B. wenn sich der Ordnername im Finder \u00E4ndert).\r\n */\r\nexport class BaseTab {\r\n    id: string;\r\n    type: string;\r\n    title: string;\r\n    icon?: string;\r\n    parentWindow: BaseWindow | null;\r\n    element: HTMLElement | null;\r\n    contentState: any;\r\n    metadata: Record<string, any>;\r\n    isVisible: boolean;\r\n\r\n    constructor(config: TabConfig) {\r\n        this.id = config.id || this._generateId();\r\n        this.type = config.type;\r\n        this.title = config.title || 'Untitled';\r\n        this.icon = config.icon;\r\n        this.parentWindow = null;\r\n        this.element = null;\r\n        this.contentState = config.content || {};\r\n        this.metadata = config.metadata || {\r\n            created: Date.now(),\r\n            modified: Date.now(),\r\n        };\r\n        this.isVisible = false;\r\n    }\r\n\r\n    private _generateId(): string {\r\n        return `tab-${this.type}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n    }\r\n\r\n    /**\r\n     * Set parent window (called when tab is added to a window)\r\n     */\r\n    setParentWindow(window: BaseWindow): void {\r\n        this.parentWindow = window;\r\n    }\r\n\r\n    /**\r\n     * Erstellt das DOM des Tabs. Subklassen M\u00DCSSEN \u00FCberschreiben. Der Default\r\n     * liefert nur einen Platzhalter.\r\n     */\r\n    createDOM(): HTMLElement {\r\n        const container = document.createElement('div');\r\n        container.id = `${this.id}-container`;\r\n        container.className = 'tab-content hidden w-full h-full';\r\n        container.textContent = `Tab content for ${this.title}`;\r\n        this.element = container;\r\n        return container;\r\n    }\r\n\r\n    /**\r\n     * Rendering-Hook. Subklassen implementieren hier die eigentliche UI.\r\n     */\r\n    render(): void {\r\n        if (!this.element) {\r\n            this.createDOM();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Tab sichtbar machen und ggf. in die Content\u2011Area des Elternfensters einh\u00E4ngen.\r\n     */\r\n    show(): void {\r\n        if (!this.element) {\r\n            this.render();\r\n\r\n            // Add to parent window's content area\r\n            if (this.parentWindow?.contentElement) {\r\n                this.parentWindow.contentElement.appendChild(this.element!);\r\n            }\r\n        }\r\n\r\n        if (this.element) {\r\n            const domUtils = (window as any).DOMUtils;\r\n            if (domUtils && typeof domUtils.show === 'function') {\r\n                domUtils.show(this.element);\r\n            } else {\r\n                this.element.classList.remove('hidden');\r\n            }\r\n        }\r\n        this.isVisible = true;\r\n        this.onShow();\r\n    }\r\n\r\n    /**\r\n     * Tab verbergen (DOM bleibt erhalten, CSS .hidden).\r\n     */\r\n    hide(): void {\r\n        if (this.element) {\r\n            const domUtils = (window as any).DOMUtils;\r\n            if (domUtils && typeof domUtils.hide === 'function') {\r\n                domUtils.hide(this.element);\r\n            } else {\r\n                this.element.classList.add('hidden');\r\n            }\r\n        }\r\n        this.isVisible = false;\r\n        this.onHide();\r\n    }\r\n\r\n    /**\r\n     * Lifecycle\u2011Hook beim Anzeigen.\r\n     */\r\n    protected onShow(): void {\r\n        // Subclasses can override\r\n    }\r\n\r\n    /**\r\n     * Lifecycle\u2011Hook beim Verbergen.\r\n     */\r\n    protected onHide(): void {\r\n        // Subclasses can override\r\n    }\r\n\r\n    /**\r\n     * Tabtitel aktualisieren und Parent zur Tabbar\u2011Re\u2011Render benachrichtigen.\r\n     */\r\n    setTitle(title: string): void {\r\n        this.title = title;\r\n        this.metadata.modified = Date.now();\r\n\r\n        // Notify parent window to re-render tabs\r\n        if (this.parentWindow) {\r\n            (this.parentWindow as any)._renderTabs?.();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Content\u2011State aktualisieren (z. B. Cursorposition, offene Datei, Sortierung,...)\r\n     */\r\n    updateContentState(updates: any): void {\r\n        this.contentState = {\r\n            ...this.contentState,\r\n            ...updates,\r\n        };\r\n        this.metadata.modified = Date.now();\r\n        this._saveState();\r\n    }\r\n\r\n    /**\r\n     * Serialize tab state for session management\r\n     */\r\n    serialize(): TabState {\r\n        return {\r\n            id: this.id,\r\n            type: this.type,\r\n            title: this.title,\r\n            icon: this.icon,\r\n            contentState: this.contentState,\r\n            created: this.metadata.created,\r\n            modified: this.metadata.modified || Date.now(),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Rehydrierung \u2013 Subklassen \u00FCberschreiben diese Methode meist, um ihren\r\n     * konkreten Zustand zur\u00FCckzusetzen.\r\n     */\r\n    static deserialize(state: TabState): BaseTab {\r\n        return new BaseTab({\r\n            id: state.id,\r\n            type: state.type,\r\n            title: state.title,\r\n            icon: state.icon,\r\n            content: state.contentState,\r\n            metadata: {\r\n                created: state.created,\r\n                modified: state.modified,\r\n            },\r\n        });\r\n    }\r\n\r\n    private _saveState(): void {\r\n        // Save tab state via parent window's session manager\r\n        if (this.parentWindow) {\r\n            // Trigger parent window to save its state (which includes all tabs)\r\n            (this.parentWindow as any)._saveState?.();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Transfer tab to another window\r\n     */\r\n    transferTo(targetWindow: BaseWindow): void {\r\n        if (!this.parentWindow || this.parentWindow === targetWindow) return;\r\n\r\n        // Remove from current window\r\n        this.parentWindow.removeTab(this.id);\r\n\r\n        // Add to target window\r\n        targetWindow.addTab(this);\r\n    }\r\n\r\n    /**\r\n     * Destroy tab and cleanup\r\n     */\r\n    destroy(): void {\r\n        if (this.element) {\r\n            this.element.remove();\r\n            this.element = null;\r\n        }\r\n\r\n        this.parentWindow = null;\r\n        this._saveState();\r\n    }\r\n}\r\n\r\n// Export to window for global access\r\n(window as any).BaseTab = BaseTab;\r\n", "/**\r\n * src/ts/base-window.ts\r\n * Base class for multi-window system\r\n * Each window can contain multiple tabs with drag & drop support\r\n */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport type { BaseTab } from '../windows/base-tab.js';\r\nimport { getZIndexManager } from './z-index-manager.js';\r\n\r\nexport interface WindowPosition {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\nexport interface WindowConfig {\r\n    id?: string;\r\n    type: string; // 'terminal', 'text-editor', 'finder'\r\n    title?: string;\r\n    position?: WindowPosition;\r\n    tabs?: BaseTab[];\r\n    metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface WindowState {\r\n    id: string;\r\n    type: string;\r\n    position: WindowPosition;\r\n    zIndex: number;\r\n    isMinimized: boolean;\r\n    isMaximized: boolean;\r\n    activeTabId: string | null;\r\n    tabs: string[]; // Tab IDs\r\n    created: number;\r\n    modified: number;\r\n}\r\n\r\n/**\r\n * BaseWindow - Fundament des neuen Fenster-Systems\r\n *\r\n * \u00DCberblick\r\n * ---------\r\n * Ein BaseWindow ist ein frei bewegliches, resizables \u201EApp\u2011Fenster\u201C \u2013 kein klassischer\r\n * Fullscreen-Modal. Jedes Fenster besitzt eine eigene Tab-Leiste und kann mehrere\r\n * Inhalts-Tabs (Instanzen von BaseTab) aufnehmen. Tabs lassen sich zwischen Fenstern\r\n * verschieben (Drag&Drop) oder in ein neues Fenster \u201Eherausziehen\u201C.\r\n *\r\n * Ziele\r\n * -----\r\n * - Einheitliche API f\u00FCr Text-Editor, Terminal, Finder etc.\r\n * - Persistenz: Fensterzustand (Position, Gr\u00F6\u00DFe, Tabs, aktiver Tab) wird \u00FCber\r\n *   Session-Manager konserviert.\r\n * - Interop mit alter Infrastruktur: Registrierung im (legacy) WindowManager, damit\r\n *   Men\u00FClLeiste/ProgramLabel korrekt wechseln.\r\n *\r\n * Lebenszyklus\r\n * ------------\r\n * 1) new SubclassOfBaseWindow({...})\r\n * 2) show() -> erzeugt DOM, rendert Tabbar/Content, setzt Fokus/Z\u2011Index\r\n * 3) addTab()/setActiveTab() -> Tabs werden an Content\u2011Area angeh\u00E4ngt\r\n * 4) hide()/close()/destroy()\r\n *\r\n * Erweiterung\r\n * -----------\r\n * - Subklassen \u00FCberschreiben createDOM() und optional _renderTabs(), wenn eine\r\n *   eigene Tabbar (z. B. via WindowTabs) genutzt wird.\r\n * - BaseWindow k\u00FCmmert sich um Drag/Resize/Fokus/Z\u2011Index/Session\u2011Save.\r\n */\r\nexport class BaseWindow {\r\n    id: string;\r\n    type: string;\r\n    element: HTMLElement | null;\r\n    titlebarElement: HTMLElement | null;\r\n    contentElement: HTMLElement | null;\r\n    position: WindowPosition;\r\n    zIndex: number;\r\n    isMinimized: boolean;\r\n    isMaximized: boolean;\r\n    tabs: Map<string, BaseTab>;\r\n    activeTabId: string | null;\r\n    metadata: Record<string, any>;\r\n    private dragState: {\r\n        isDragging: boolean;\r\n        startX: number;\r\n        startY: number;\r\n        offsetX: number;\r\n        offsetY: number;\r\n    };\r\n\r\n    constructor(config: WindowConfig) {\r\n        // Set type FIRST, before generating ID (ID generation uses this.type)\r\n        this.type = config.type;\r\n        this.id = config.id || this._generateId();\r\n        this.element = null;\r\n        this.titlebarElement = null;\r\n        this.contentElement = null;\r\n        this.position = config.position || this._getDefaultPosition();\r\n        this.zIndex = 1000;\r\n        this.isMinimized = false;\r\n        this.isMaximized = false;\r\n        this.tabs = new Map();\r\n        this.activeTabId = null;\r\n        this.metadata = config.metadata || {};\r\n        this.dragState = {\r\n            isDragging: false,\r\n            startX: 0,\r\n            startY: 0,\r\n            offsetX: 0,\r\n            offsetY: 0,\r\n        };\r\n\r\n        // Add initial tabs if provided\r\n        if (config.tabs) {\r\n            config.tabs.forEach(tab => this.addTab(tab));\r\n        }\r\n    }\r\n\r\n    private _generateId(): string {\r\n        return `window-${this.type}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n    }\r\n\r\n    private _getDefaultPosition(): WindowPosition {\r\n        // Center window with slight offset for multiple windows\r\n        const offset = Math.random() * 100 - 50;\r\n        return {\r\n            x: window.innerWidth / 2 - 400 + offset,\r\n            y: window.innerHeight / 2 - 300 + offset,\r\n            width: 800,\r\n            height: 600,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Create the window DOM element.\r\n     * Subklassen k\u00F6nnen \u00FCberschreiben, wenn z. B. eine dedizierte Tabbar\r\n     * oder zus\u00E4tzliche UI\u2011Elemente n\u00F6tig sind. Wichtig: setze this.element,\r\n     * this.titlebarElement und this.contentElement.\r\n     */\r\n    createDOM(): HTMLElement {\r\n        // Create window container (no modal overlay - this is a floating window, not a modal dialog)\r\n        const windowEl = document.createElement('div');\r\n        windowEl.id = this.id;\r\n        // Add 'modal' class for compatibility with existing focus/z-index management\r\n        windowEl.className =\r\n            'modal multi-window hidden fixed bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-lg flex flex-col max-h-[90vh] min-w-[560px] min-h-[360px]';\r\n        windowEl.setAttribute('role', 'dialog');\r\n        windowEl.setAttribute('aria-modal', 'false'); // Not a modal\r\n\r\n        // Override modal pointer-events: none\r\n        windowEl.style.pointerEvents = 'auto';\r\n\r\n        // Set position and size\r\n        windowEl.style.left = `${this.position.x}px`;\r\n        windowEl.style.top = `${this.position.y}px`;\r\n        windowEl.style.width = `${this.position.width}px`;\r\n        windowEl.style.height = `${this.position.height}px`;\r\n        windowEl.style.zIndex = String(this.zIndex);\r\n\r\n        // Titlebar (draggable) \u2013 enth\u00E4lt die drei Mac\u2011Kontrollpunkte und die window\u2011\u00DCberschrift\r\n        this.titlebarElement = this._createTitlebar();\r\n        windowEl.appendChild(this.titlebarElement);\r\n\r\n        // Tab bar container\r\n        const tabBar = document.createElement('div');\r\n        tabBar.id = `${this.id}-tabs`;\r\n        tabBar.className = 'window-tab-bar';\r\n        windowEl.appendChild(tabBar);\r\n\r\n        // Content area\r\n        this.contentElement = document.createElement('div');\r\n        this.contentElement.id = `${this.id}-content`;\r\n        this.contentElement.className = 'flex-1 overflow-hidden';\r\n        windowEl.appendChild(this.contentElement);\r\n\r\n        this.element = windowEl;\r\n\r\n        // Beweglichkeit / Fokus / Gr\u00F6\u00DFe\r\n        this._attachDragHandlers();\r\n        this._attachFocusHandler();\r\n        this._attachResizeHandlers();\r\n\r\n        // Register with legacy WindowManager for menubar integration\r\n        this._registerWithWindowManager();\r\n\r\n        // Apply i18n translations to window elements\r\n        const W = window as any;\r\n        if (W.appI18n && typeof W.appI18n.applyTranslations === 'function') {\r\n            W.appI18n.applyTranslations(windowEl);\r\n        }\r\n\r\n        return windowEl;\r\n    }\r\n\r\n    /**\r\n     * Baut die Titelleiste inklusive Close/Minimize/Maximize \u201EDots\u201C.\r\n     * Events sind an BaseWindow\u2011Methoden gebunden (close/minimize/toggleMaximize).\r\n     */\r\n    private _createTitlebar(): HTMLElement {\r\n        const titlebar = document.createElement('div');\r\n        titlebar.className =\r\n            'window-titlebar flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-t-lg draggable-header cursor-move';\r\n\r\n        // Window controls (macOS style: close, minimize, maximize as dots)\r\n        const controls = document.createElement('div');\r\n        controls.className = 'flex space-x-2';\r\n\r\n        // Close button (red dot)\r\n        const closeBtn = document.createElement('button');\r\n        closeBtn.className = 'ml-auto text-2xl leading-none text-gray-700 dark:text-gray-300';\r\n        closeBtn.title = 'Schlie\u00DFen';\r\n        closeBtn.setAttribute('data-i18n-title', 'common.close');\r\n        closeBtn.innerHTML = '<div class=\"w-3 h-3 bg-red-500 rounded-full\"></div>';\r\n        closeBtn.addEventListener('click', () => this.close());\r\n\r\n        // Minimize button (yellow dot) - clickable div with title\r\n        const minBtn = document.createElement('div');\r\n        minBtn.className = 'w-3 h-3 bg-yellow-500 rounded-full cursor-pointer';\r\n        minBtn.title = 'Minimieren';\r\n        minBtn.setAttribute('data-i18n-title', 'menuItems.window.minimize');\r\n        minBtn.addEventListener('click', () => this.minimize());\r\n\r\n        // Maximize button (green dot) - clickable div with title\r\n        const maxBtn = document.createElement('div');\r\n        maxBtn.className = 'w-3 h-3 bg-green-500 rounded-full cursor-pointer';\r\n        maxBtn.title = 'Zoomen';\r\n        maxBtn.setAttribute('data-i18n-title', 'menuItems.window.zoom');\r\n        maxBtn.addEventListener('click', () => this.toggleMaximize());\r\n\r\n        controls.appendChild(closeBtn);\r\n        controls.appendChild(minBtn);\r\n        controls.appendChild(maxBtn);\r\n\r\n        // Title\r\n        const title = document.createElement('h2');\r\n        title.className = 'ml-4 font-semibold text-gray-700 dark:text-gray-300 no-select';\r\n\r\n        // Set i18n key based on window type\r\n        // Map text-editor to text for i18n key\r\n        const typeKey = this.type === 'text-editor' ? 'text' : this.type;\r\n        const titleKey = `desktop.${typeKey}`;\r\n        title.setAttribute('data-i18n', titleKey);\r\n        title.textContent = this.metadata.title || this.type; // Fallback before i18n\r\n\r\n        titlebar.appendChild(controls);\r\n        titlebar.appendChild(title);\r\n\r\n        return titlebar;\r\n    }\r\n\r\n    /**\r\n     * Erm\u00F6glicht Dragging des Fensters \u00FCber die Titelleiste.\r\n     * Speicherung der Position erfolgt am Ende des Drags via _saveState().\r\n     */\r\n    private _attachDragHandlers(): void {\r\n        if (!this.titlebarElement) return;\r\n\r\n        this.titlebarElement.addEventListener('mousedown', (e: MouseEvent) => {\r\n            if ((e.target as HTMLElement).tagName === 'BUTTON') return; // Ignore control buttons\r\n\r\n            this.dragState.isDragging = true;\r\n            this.dragState.startX = e.clientX;\r\n            this.dragState.startY = e.clientY;\r\n\r\n            const rect = this.element?.getBoundingClientRect();\r\n            if (rect) {\r\n                this.dragState.offsetX = this.dragState.startX - rect.left;\r\n                this.dragState.offsetY = this.dragState.startY - rect.top;\r\n            }\r\n\r\n            e.preventDefault();\r\n        });\r\n\r\n        document.addEventListener('mousemove', (e: MouseEvent) => {\r\n            if (!this.dragState.isDragging || !this.element) return;\r\n\r\n            const newX = e.clientX - this.dragState.offsetX;\r\n            const newY = e.clientY - this.dragState.offsetY;\r\n\r\n            this.position.x = newX;\r\n            this.position.y = newY;\r\n\r\n            this._updatePosition();\r\n        });\r\n\r\n        document.addEventListener('mouseup', () => {\r\n            if (this.dragState.isDragging) {\r\n                this.dragState.isDragging = false;\r\n                this._saveState();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Klick in das Fenster bringt es nach vorne und aktualisiert Menubar\u2011Status.\r\n     */\r\n    private _attachFocusHandler(): void {\r\n        if (!this.element) return;\r\n\r\n        // Bring window to front when clicked anywhere\r\n        this.element.addEventListener('mousedown', () => {\r\n            this.bringToFront();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * F\u00FCgt 8 Resize\u2011Griffe hinzu (N, S, E, W sowie Ecken).\r\n     * W\u00E4hrend des Resizings wird ein Overlay gesetzt, um Mouse\u2011Events zuverl\u00E4ssig\r\n     * zu capturen. Mindestgr\u00F6\u00DFen werden ber\u00FCcksichtigt.\r\n     */\r\n    private _attachResizeHandlers(): void {\r\n        if (!this.element) return;\r\n\r\n        // Remove existing resize handles\r\n        const existingHandles = this.element.querySelectorAll('.resizer');\r\n        existingHandles.forEach(handle => handle.remove());\r\n\r\n        const createHandle = (handle: any) => {\r\n            const resizer = document.createElement('div');\r\n            resizer.classList.add('resizer', `resizer-${handle.name}`);\r\n            Object.assign(resizer.style, {\r\n                position: 'absolute',\r\n                zIndex: '9999',\r\n                backgroundColor: 'transparent',\r\n                pointerEvents: 'auto',\r\n                touchAction: 'none',\r\n                cursor: handle.cursor,\r\n                ...(handle.style || {}),\r\n            });\r\n\r\n            this.element!.appendChild(resizer);\r\n\r\n            const startResize = (event: MouseEvent) => {\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n\r\n                this.bringToFront();\r\n\r\n                const startX = event.clientX;\r\n                const startY = event.clientY;\r\n                const rect = this.element!.getBoundingClientRect();\r\n                const computed = window.getComputedStyle(this.element!);\r\n                const minWidth = parseFloat(computed.minWidth) || 560;\r\n                const minHeight = parseFloat(computed.minHeight) || 360;\r\n\r\n                let startLeft = parseFloat(computed.left);\r\n                let startTop = parseFloat(computed.top);\r\n                if (!Number.isFinite(startLeft)) startLeft = rect.left;\r\n                if (!Number.isFinite(startTop)) startTop = rect.top;\r\n\r\n                const startWidth = rect.width;\r\n                const startHeight = rect.height;\r\n\r\n                // Create overlay to capture mouse events\r\n                const overlay = document.createElement('div');\r\n                Object.assign(overlay.style, {\r\n                    position: 'fixed',\r\n                    top: '0',\r\n                    left: '0',\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    zIndex: '9999',\r\n                    cursor: handle.cursor,\r\n                    backgroundColor: 'transparent',\r\n                    touchAction: 'none',\r\n                });\r\n                document.body.appendChild(overlay);\r\n\r\n                let resizing = true;\r\n\r\n                const applySize = (clientX: number, clientY: number) => {\r\n                    if (!resizing) return;\r\n\r\n                    window.requestAnimationFrame(() => {\r\n                        const dx = clientX - startX;\r\n                        const dy = clientY - startY;\r\n                        let newWidth = startWidth;\r\n                        let newHeight = startHeight;\r\n                        let newLeft = startLeft;\r\n                        let newTop = startTop;\r\n\r\n                        // Apply direction-based changes\r\n                        if (handle.directions.includes('e')) newWidth = startWidth + dx;\r\n                        if (handle.directions.includes('s')) newHeight = startHeight + dy;\r\n                        if (handle.directions.includes('w')) {\r\n                            newWidth = startWidth - dx;\r\n                            newLeft = startLeft + dx;\r\n                        }\r\n                        if (handle.directions.includes('n')) {\r\n                            newHeight = startHeight - dy;\r\n                            newTop = startTop + dy;\r\n                        }\r\n\r\n                        // Enforce minimum size\r\n                        if (newWidth < minWidth) {\r\n                            const deficit = minWidth - newWidth;\r\n                            if (handle.directions.includes('w')) newLeft -= deficit;\r\n                            newWidth = minWidth;\r\n                        }\r\n                        if (newHeight < minHeight) {\r\n                            const deficit = minHeight - newHeight;\r\n                            if (handle.directions.includes('n')) newTop -= deficit;\r\n                            newHeight = minHeight;\r\n                        }\r\n\r\n                        // Enforce menu bar boundary\r\n                        const minTop = (window as any).getMenuBarBottom?.() || 0;\r\n                        if (handle.directions.includes('n') && newTop < minTop) {\r\n                            const overshoot = minTop - newTop;\r\n                            newTop = minTop;\r\n                            newHeight = Math.max(minHeight, newHeight - overshoot);\r\n                        }\r\n\r\n                        // Apply new size and position\r\n                        if (handle.directions.includes('w') || handle.directions.includes('e')) {\r\n                            this.element!.style.width = Math.max(minWidth, newWidth) + 'px';\r\n                            this.position.width = Math.max(minWidth, newWidth);\r\n                        }\r\n                        if (handle.directions.includes('s') || handle.directions.includes('n')) {\r\n                            this.element!.style.height = Math.max(minHeight, newHeight) + 'px';\r\n                            this.position.height = Math.max(minHeight, newHeight);\r\n                        }\r\n                        if (handle.directions.includes('w')) {\r\n                            this.element!.style.left = newLeft + 'px';\r\n                            this.position.x = newLeft;\r\n                        }\r\n                        if (handle.directions.includes('n')) {\r\n                            this.element!.style.top = newTop + 'px';\r\n                            this.position.y = newTop;\r\n                        }\r\n                    });\r\n                };\r\n\r\n                const stopResize = () => {\r\n                    if (!resizing) return;\r\n                    resizing = false;\r\n                    overlay.remove();\r\n                    overlay.removeEventListener('mousemove', overlayMouseMove);\r\n                    overlay.removeEventListener('mouseup', overlayMouseUp);\r\n                    window.removeEventListener('mousemove', windowMouseMove);\r\n                    window.removeEventListener('mouseup', windowMouseUp);\r\n                    window.removeEventListener('blur', onBlur);\r\n\r\n                    // Save state after resize\r\n                    this._saveState();\r\n                };\r\n\r\n                const overlayMouseMove = (moveEvent: MouseEvent) =>\r\n                    applySize(moveEvent.clientX, moveEvent.clientY);\r\n                const windowMouseMove = (moveEvent: MouseEvent) =>\r\n                    applySize(moveEvent.clientX, moveEvent.clientY);\r\n                const overlayMouseUp = () => stopResize();\r\n                const windowMouseUp = () => stopResize();\r\n                const onBlur = () => stopResize();\r\n\r\n                overlay.addEventListener('mousemove', overlayMouseMove);\r\n                overlay.addEventListener('mouseup', overlayMouseUp);\r\n                window.addEventListener('mousemove', windowMouseMove);\r\n                window.addEventListener('mouseup', windowMouseUp);\r\n                window.addEventListener('blur', onBlur);\r\n            };\r\n\r\n            resizer.addEventListener('mousedown', startResize);\r\n        };\r\n\r\n        // Resize handles (8 directions)\r\n        const handles = [\r\n            {\r\n                name: 'top',\r\n                cursor: 'n-resize',\r\n                directions: ['n'],\r\n                style: { top: '-4px', left: '12px', right: '12px', height: '8px' },\r\n            },\r\n            {\r\n                name: 'bottom',\r\n                cursor: 's-resize',\r\n                directions: ['s'],\r\n                style: { bottom: '-4px', left: '12px', right: '12px', height: '8px' },\r\n            },\r\n            {\r\n                name: 'left',\r\n                cursor: 'w-resize',\r\n                directions: ['w'],\r\n                style: { left: '-4px', top: '12px', bottom: '12px', width: '8px' },\r\n            },\r\n            {\r\n                name: 'right',\r\n                cursor: 'e-resize',\r\n                directions: ['e'],\r\n                style: { right: '-4px', top: '12px', bottom: '12px', width: '8px' },\r\n            },\r\n            {\r\n                name: 'top-left',\r\n                cursor: 'nw-resize',\r\n                directions: ['n', 'w'],\r\n                style: { top: '-6px', left: '-6px', width: '14px', height: '14px' },\r\n            },\r\n            {\r\n                name: 'top-right',\r\n                cursor: 'ne-resize',\r\n                directions: ['n', 'e'],\r\n                style: { top: '-6px', right: '-6px', width: '14px', height: '14px' },\r\n            },\r\n            {\r\n                name: 'bottom-left',\r\n                cursor: 'sw-resize',\r\n                directions: ['s', 'w'],\r\n                style: { bottom: '-6px', left: '-6px', width: '14px', height: '14px' },\r\n            },\r\n            {\r\n                name: 'bottom-right',\r\n                cursor: 'se-resize',\r\n                directions: ['s', 'e'],\r\n                style: { bottom: '-6px', right: '-6px', width: '14px', height: '14px' },\r\n            },\r\n        ];\r\n\r\n        handles.forEach(createHandle);\r\n    }\r\n\r\n    private _updatePosition(): void {\r\n        if (!this.element) return;\r\n\r\n        // Update position on the window element itself\r\n        this.element.style.left = `${this.position.x}px`;\r\n        this.element.style.top = `${this.position.y}px`;\r\n    }\r\n\r\n    /**\r\n     * Fenster anzeigen. Erzeugt bei Bedarf das DOM, h\u00E4ngt Tabs an die Content\u2011Area an\r\n     * und ruft bringToFront() + Menubar\u2011Update. Persistiert den Zustand.\r\n     */\r\n    show(): void {\r\n        if (!this.element) {\r\n            this.createDOM();\r\n            document.body.appendChild(this.element!);\r\n\r\n            // Append all existing tabs to content area\r\n            if (this.contentElement) {\r\n                this.tabs.forEach(tab => {\r\n                    if (tab.element && !this.contentElement!.contains(tab.element)) {\r\n                        this.contentElement!.appendChild(tab.element);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        if (this.element) {\r\n            const domUtils = (window as any).DOMUtils;\r\n            if (domUtils && typeof domUtils.show === 'function') {\r\n                domUtils.show(this.element);\r\n            } else {\r\n                this.element.classList.remove('hidden');\r\n            }\r\n        }\r\n        this.bringToFront();\r\n        // Update menubar to reflect new active window\r\n        const W = window as any;\r\n        W.updateProgramLabelByTopModal?.();\r\n        W.updateDockIndicators?.();\r\n        this._saveState();\r\n    }\r\n\r\n    /**\r\n     * Fenster ausblenden und Menubar entsprechend aktualisieren.\r\n     */\r\n    hide(): void {\r\n        this.element?.classList.add('hidden');\r\n        // Update menubar to reflect next top window\r\n        const W = window as any;\r\n        W.updateProgramLabelByTopModal?.();\r\n        const menuSystem = W.MenuSystem;\r\n        if (menuSystem?.renderApplicationMenu) {\r\n            const current = menuSystem.getCurrentMenuModalId?.();\r\n            menuSystem.renderApplicationMenu(current);\r\n        }\r\n        this._saveState();\r\n    }\r\n\r\n    /**\r\n     * Fenster schlie\u00DFen. \u00DCbergibt die endg\u00FCltige Entfernung an den WindowRegistry,\r\n     * sodass dieser Aufr\u00E4umarbeiten \u00FCbernehmen kann.\r\n     */\r\n    close(): void {\r\n        this.hide();\r\n\r\n        // Remove from z-index manager stack\r\n        const W = window as any;\r\n        const zIndexManager = getZIndexManager();\r\n        zIndexManager.removeWindow(this.id);\r\n\r\n        // WindowRegistry will handle cleanup\r\n        if (W.WindowRegistry) {\r\n            W.WindowRegistry.removeWindow(this.id);\r\n        }\r\n\r\n        // Update dock indicators after window is closed\r\n        W.updateDockIndicators?.();\r\n        // Refresh menus after closing in case active app changes\r\n        const menuSystem = W.MenuSystem;\r\n        if (menuSystem?.renderApplicationMenu) {\r\n            const current = menuSystem.getCurrentMenuModalId?.();\r\n            menuSystem.renderApplicationMenu(current);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Fenster minimieren (aktuell nur Hide + Flag). Integration in Dock/Taskbar\r\n     * kann sp\u00E4ter hier erfolgen.\r\n     */\r\n    minimize(): void {\r\n        this.isMinimized = true;\r\n        this.hide();\r\n        // TODO: Add to dock/taskbar\r\n    }\r\n\r\n    /**\r\n     * Maximieren/Restore. Setzt inline\u2011Styles auf das innere Window\u2011Element.\r\n     */\r\n    toggleMaximize(): void {\r\n        this.isMaximized = !this.isMaximized;\r\n\r\n        if (!this.element) return;\r\n        const windowEl = this.element.querySelector('div') as HTMLElement;\r\n        if (!windowEl) return;\r\n\r\n        if (this.isMaximized) {\r\n            windowEl.style.width = '95vw';\r\n            windowEl.style.height = '95vh';\r\n        } else {\r\n            windowEl.style.width = `${this.position.width}px`;\r\n            windowEl.style.height = `${this.position.height}px`;\r\n        }\r\n\r\n        this._saveState();\r\n    }\r\n\r\n    /**\r\n     * Nach vorne holen. Nutzt bevorzugt den (legacy) __zIndexManager, ansonsten\r\n     * WindowRegistry.getNextZIndex(). Aktualisiert die Menubar.\r\n     */\r\n    bringToFront(): void {\r\n        const W = window as any;\r\n        const zIndexManager = getZIndexManager();\r\n        zIndexManager.bringToFront(this.id, this.element, this.element);\r\n        // Sync local zIndex with DOM assignment\r\n        if (this.element) {\r\n            const currentZ = parseInt(this.element.style.zIndex || '0', 10);\r\n            if (!Number.isNaN(currentZ)) this.zIndex = currentZ;\r\n        }\r\n        // Notify menubar about focus change\r\n        // Track active window in WindowRegistry if available\r\n        W.WindowRegistry?.setActiveWindow?.(this.id);\r\n        W.updateProgramLabelByTopModal?.();\r\n        // Refresh dynamic application menu (e.g. switch to Terminal menu)\r\n        const menuSystem = W.MenuSystem;\r\n        if (menuSystem?.renderApplicationMenu) {\r\n            // Pass current menu modal id so sections rebuild with new active context\r\n            const current = menuSystem.getCurrentMenuModalId?.();\r\n            menuSystem.renderApplicationMenu(current);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Tab hinzuf\u00FCgen. Erzeugt bei Bedarf dessen DOM und h\u00E4ngt ihn in die Content\u2011Area.\r\n     * Falls noch kein aktiver Tab existiert, wird dieser gesetzt. Rendert die Tabbar neu\r\n     * und speichert den Zustand.\r\n     */\r\n    addTab(tab: BaseTab): void {\r\n        this.tabs.set(tab.id, tab);\r\n        tab.setParentWindow(this);\r\n\r\n        // Create tab DOM if not exists\r\n        if (!tab.element) {\r\n            tab.element = tab.createDOM();\r\n        }\r\n\r\n        // Append tab content to window content area (only if window DOM exists)\r\n        if (tab.element && this.contentElement) {\r\n            this.contentElement.appendChild(tab.element);\r\n        }\r\n        // If window DOM doesn't exist yet, tab will be added when show() is called\r\n\r\n        if (!this.activeTabId) {\r\n            this.setActiveTab(tab.id);\r\n        }\r\n\r\n        this._renderTabs();\r\n        this._saveState();\r\n    }\r\n\r\n    /**\r\n     * Tab entfernen und ggf. anderen Tab aktivieren. Bei Leere wird das Fenster\r\n     * automatisch geschlossen.\r\n     */\r\n    removeTab(tabId: string): void {\r\n        const tab = this.tabs.get(tabId);\r\n        if (!tab) return;\r\n\r\n        tab.destroy();\r\n        this.tabs.delete(tabId);\r\n\r\n        // If this was the active tab, activate another\r\n        if (this.activeTabId === tabId) {\r\n            const remainingTabs = Array.from(this.tabs.keys());\r\n            this.activeTabId = remainingTabs[0] || null;\r\n            if (this.activeTabId) {\r\n                this.setActiveTab(this.activeTabId);\r\n            }\r\n        }\r\n\r\n        // If no tabs left, close window\r\n        if (this.tabs.size === 0) {\r\n            this.close();\r\n        } else {\r\n            this._renderTabs();\r\n            this._saveState();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Tab abkoppeln (z. B. f\u00FCr Drag&Drop in anderes Fenster). Der Tab bleibt bestehen,\r\n     * wird aber aus diesem Fenster entfernt und versteckt.\r\n     */\r\n    detachTab(tabId: string): BaseTab | null {\r\n        const tab = this.tabs.get(tabId) || null;\r\n        if (!tab) return null;\r\n\r\n        // Hide but do not destroy\r\n        tab.hide();\r\n        tab.setParentWindow(null as unknown as any);\r\n        this.tabs.delete(tabId);\r\n\r\n        // Adjust active tab\r\n        if (this.activeTabId === tabId) {\r\n            const remaining = Array.from(this.tabs.keys());\r\n            this.activeTabId = remaining[0] || null;\r\n            if (this.activeTabId) this.setActiveTab(this.activeTabId);\r\n        }\r\n\r\n        if (this.tabs.size === 0) {\r\n            this.close();\r\n        } else {\r\n            this._renderTabs();\r\n            this._saveState();\r\n        }\r\n\r\n        return tab;\r\n    }\r\n\r\n    /**\r\n     * Tab in ein Ziel\u2011Fenster verschieben.\r\n     */\r\n    transferTabTo(target: BaseWindow, tabId: string): void {\r\n        const tab = this.detachTab(tabId);\r\n        if (tab) {\r\n            target.addTab(tab);\r\n            target.setActiveTab(tab.id);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Aktiven Tab setzen (zeigt diesen und versteckt alle anderen).\r\n     */\r\n    setActiveTab(tabId: string): void {\r\n        const tab = this.tabs.get(tabId);\r\n        if (!tab) return;\r\n\r\n        // Hide all tabs\r\n        this.tabs.forEach(t => t.hide());\r\n\r\n        // Show active tab\r\n        this.activeTabId = tabId;\r\n        tab.show();\r\n\r\n        this._renderTabs();\r\n        this._saveState();\r\n    }\r\n\r\n    /**\r\n     * Einfache Default\u2011Tabbar. Subklassen (z. B. FinderWindow/TextEditorWindow) k\u00F6nnen\r\n     * diese Methode \u00FCberschreiben und die dedizierte WindowTabs\u2011Leiste nutzen.\r\n     */\r\n    protected _renderTabs(): void {\r\n        // Basic implementation - subclasses should override\r\n        const tabBar = this.element?.querySelector(`#${this.id}-tabs`);\r\n        if (!tabBar) return;\r\n\r\n        tabBar.innerHTML = '';\r\n\r\n        this.tabs.forEach(tab => {\r\n            const tabEl = document.createElement('button');\r\n            tabEl.className = `px-3 py-1 text-sm ${tab.id === this.activeTabId ? 'bg-white dark:bg-gray-900' : 'bg-gray-200 dark:bg-gray-800'}`;\r\n            tabEl.textContent = tab.title;\r\n            tabEl.addEventListener('click', () => this.setActiveTab(tab.id));\r\n\r\n            tabBar.appendChild(tabEl);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Serialisierung des Fensterzustands (f\u00FCr Session\u2011Restore).\r\n     */\r\n    serialize(): WindowState {\r\n        return {\r\n            id: this.id,\r\n            type: this.type,\r\n            position: { ...this.position },\r\n            zIndex: this.zIndex,\r\n            isMinimized: this.isMinimized,\r\n            isMaximized: this.isMaximized,\r\n            activeTabId: this.activeTabId,\r\n            tabs: Array.from(this.tabs.keys()),\r\n            created: this.metadata.created || Date.now(),\r\n            modified: Date.now(),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Rehydrierung aus persistiertem Zustand. Subklassen k\u00F6nnen eigene\r\n     * deserialize\u2011Routinen bereitstellen.\r\n     */\r\n    static deserialize(state: WindowState): BaseWindow {\r\n        const window = new BaseWindow({\r\n            id: state.id,\r\n            type: state.type,\r\n            position: state.position,\r\n            metadata: {\r\n                created: state.created,\r\n            },\r\n        });\r\n\r\n        window.zIndex = state.zIndex;\r\n        window.isMinimized = state.isMinimized;\r\n        window.isMaximized = state.isMaximized;\r\n        window.activeTabId = state.activeTabId;\r\n\r\n        return window;\r\n    }\r\n\r\n    private _saveState(): void {\r\n        const W = window as any;\r\n\r\n        // Trigger multi-window session save (debounced)\r\n        if (W.MultiWindowSessionManager) {\r\n            W.MultiWindowSessionManager.saveSession();\r\n        }\r\n\r\n        // Legacy session manager (for backwards compatibility)\r\n        if (W.SessionManager) {\r\n            W.SessionManager.saveWindowState?.(this.serialize());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Vollst\u00E4ndiges Aufr\u00E4umen: Tabs zerst\u00F6ren, DOM entfernen, Menubar aktualisieren\r\n     * und Session speichern.\r\n     */\r\n    destroy(): void {\r\n        // Destroy all tabs\r\n        this.tabs.forEach(tab => tab.destroy());\r\n        this.tabs.clear();\r\n\r\n        // Remove DOM\r\n        if (this.element) {\r\n            this.element.remove();\r\n            this.element = null;\r\n        }\r\n\r\n        this._saveState();\r\n        // Update menubar after destruction\r\n        const W = window as any;\r\n        W.updateProgramLabelByTopModal?.();\r\n    }\r\n\r\n    /**\r\n     * Registrierung im (legacy) WindowManager, damit ProgramLabel/Anwendungsmen\u00FCs\r\n     * korrekt auf das aktive Fenster gemappt werden. Diese Br\u00FCcke h\u00E4lt die neue\r\n     * Multi\u2011Window\u2011Welt kompatibel zur bestehenden Menubar.\r\n     */\r\n    private _registerWithWindowManager(): void {\r\n        const W = window as any;\r\n        const WM = W.WindowManager;\r\n        if (!WM || typeof WM.getConfig !== 'function' || typeof WM.register !== 'function') return;\r\n        if (WM.getConfig(this.id)) return; // already registered\r\n\r\n        // Map window types to programKey/icon used by the menubar\r\n        const map: Record<string, { programKey: string; icon: string }> = {\r\n            finder: { programKey: 'programs.finder', icon: './img/sucher.png' },\r\n            'text-editor': { programKey: 'programs.text', icon: './img/notepad.png' },\r\n            terminal: { programKey: 'programs.terminal', icon: './img/terminal.png' },\r\n        };\r\n        const meta = map[this.type] || { programKey: 'programs.default', icon: './img/sucher.png' };\r\n\r\n        try {\r\n            WM.register({\r\n                id: this.id,\r\n                type: 'persistent',\r\n                programKey: meta.programKey,\r\n                icon: meta.icon,\r\n                closeButtonId: null,\r\n                metadata: {\r\n                    /* dynamic multi-window */\r\n                },\r\n            });\r\n            if (typeof WM.setDialogInstance === 'function') {\r\n                WM.setDialogInstance(this.id, {\r\n                    open: () => this.show(),\r\n                    close: () => this.hide(),\r\n                    bringToFront: () => this.bringToFront(),\r\n                });\r\n            }\r\n        } catch (e) {\r\n            console.warn('[BaseWindow] WM.register failed for', this.id, e);\r\n        }\r\n    }\r\n}\r\n\r\n// Export to window for global access\r\n(window as any).BaseWindow = BaseWindow;\r\n", "/**\r\n * src/ts/window-registry.ts\r\n * Central registry for managing all windows in the multi-window system\r\n */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport type { BaseWindow, WindowState } from '../windows/base-window.js';\r\nimport { BASE_Z_INDEX, getZIndexManager } from './z-index-manager.js';\r\n\r\n/**\r\n * WindowRegistry - Singleton for managing all windows\r\n *\r\n * Responsibilities:\r\n * - Track all open windows\r\n * - Manage z-index stacking\r\n * - Provide window lookup\r\n * - Coordinate window lifecycle\r\n */\r\nclass WindowRegistry {\r\n    private windows: Map<string, BaseWindow>;\r\n    private nextZIndex: number;\r\n    private initialized: boolean;\r\n    private activeWindowId: string | null;\r\n    private zIndexManager = getZIndexManager();\r\n\r\n    constructor() {\r\n        this.windows = new Map();\r\n        // Start with a higher base to avoid conflicts with legacy modals\r\n        // Will sync with WindowManager if available\r\n        this.nextZIndex = BASE_Z_INDEX;\r\n        this.initialized = false;\r\n        this.activeWindowId = null;\r\n    }\r\n\r\n    /**\r\n     * Sync z-index with WindowManager to avoid conflicts\r\n     */\r\n    private _syncZIndexWithWindowManager(): void {\r\n        const W = window as any;\r\n        const legacyTopZ = W.WindowManager?.getTopZIndex?.();\r\n        if (typeof legacyTopZ === 'number') {\r\n            this.nextZIndex = this.zIndexManager.ensureTopZIndex(legacyTopZ);\r\n        } else {\r\n            this.nextZIndex = this.zIndexManager.getTopZIndex();\r\n        }\r\n    }\r\n\r\n    init(): void {\r\n        if (this.initialized) return;\r\n\r\n        // Sync z-index with legacy WindowManager\r\n        this._syncZIndexWithWindowManager();\r\n\r\n        // Listen for clicks to bring windows to front\r\n        document.addEventListener('mousedown', (e: MouseEvent) => {\r\n            const target = e.target as HTMLElement;\r\n            const modal = target.closest('.modal');\r\n            if (modal) {\r\n                const windowId = modal.id;\r\n                const window = this.windows.get(windowId);\r\n                if (window) {\r\n                    window.bringToFront();\r\n                }\r\n            }\r\n        });\r\n\r\n        this.initialized = true;\r\n    }\r\n\r\n    /**\r\n     * Register a window\r\n     */\r\n    registerWindow(window: BaseWindow): void {\r\n        this.windows.set(window.id, window);\r\n        console.log(`[WindowRegistry] Registered window: ${window.id} (type: ${window.type})`);\r\n        // If no active window yet, set the first registered as active\r\n        if (!this.activeWindowId) this.activeWindowId = window.id;\r\n    }\r\n\r\n    /**\r\n     * Remove a window\r\n     */\r\n    removeWindow(windowId: string): void {\r\n        const window = this.windows.get(windowId);\r\n        if (window) {\r\n            window.destroy();\r\n            this.windows.delete(windowId);\r\n            console.log(`[WindowRegistry] Removed window: ${windowId}`);\r\n            // Update active window if needed\r\n            if (this.activeWindowId === windowId) {\r\n                const top = this.getTopWindow();\r\n                this.activeWindowId = top ? top.id : null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get a window by ID\r\n     */\r\n    getWindow(windowId: string): BaseWindow | null {\r\n        return this.windows.get(windowId) || null;\r\n    }\r\n\r\n    /**\r\n     * Get all windows, optionally filtered by type\r\n     * @param type - Optional window type filter (e.g., 'terminal', 'finder', 'text-editor')\r\n     */\r\n    getAllWindows(type?: string): BaseWindow[] {\r\n        const allWindows = Array.from(this.windows.values());\r\n        return type ? allWindows.filter(w => w.type === type) : allWindows;\r\n    }\r\n\r\n    /**\r\n     * Get windows by type\r\n     * @deprecated Use getAllWindows(type) instead\r\n     */\r\n    getWindowsByType(type: string): BaseWindow[] {\r\n        return this.getAllWindows(type);\r\n    }\r\n\r\n    /**\r\n     * Get next z-index for stacking\r\n     */\r\n    getNextZIndex(): number {\r\n        // Sync with WindowManager to ensure we're always on top of legacy modals\r\n        this._syncZIndexWithWindowManager();\r\n        this.nextZIndex = this.zIndexManager.bumpZIndex();\r\n        return this.nextZIndex;\r\n    }\r\n\r\n    /**\r\n     * Get current top z-index without incrementing\r\n     */\r\n    getTopZIndex(): number {\r\n        this.nextZIndex = this.zIndexManager.getTopZIndex();\r\n        return this.nextZIndex;\r\n    }\r\n\r\n    /**\r\n     * Update top z-index from external source (e.g., WindowManager)\r\n     */\r\n    updateTopZIndex(newZIndex: number): void {\r\n        this.nextZIndex = this.zIndexManager.ensureTopZIndex(newZIndex);\r\n    }\r\n\r\n    /**\r\n     * Close all windows of a specific type\r\n     */\r\n    closeAllWindowsOfType(type: string): void {\r\n        const windows = this.getWindowsByType(type);\r\n        windows.forEach(window => window.close());\r\n    }\r\n\r\n    /**\r\n     * Close all windows\r\n     */\r\n    closeAllWindows(): void {\r\n        const windows = Array.from(this.windows.values());\r\n        windows.forEach(window => window.close());\r\n    }\r\n\r\n    /**\r\n     * Get top-most window\r\n     */\r\n    getTopWindow(): BaseWindow | null {\r\n        const topId = this.zIndexManager.getTopWindowId();\r\n        if (topId) {\r\n            const win = this.windows.get(topId);\r\n            if (win) return win;\r\n        }\r\n        const windows = Array.from(this.windows.values());\r\n        if (windows.length === 0) return null;\r\n\r\n        return windows.reduce((top, current) => {\r\n            return current.zIndex > top.zIndex ? current : top;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Mark a window as actively focused. Consumers (menus) can use this\r\n     * to react to focus changes and render the correct application menu.\r\n     */\r\n    setActiveWindow(windowId: string | null): void {\r\n        this.activeWindowId = windowId;\r\n    }\r\n\r\n    /**\r\n     * Retrieve the currently active window, if known.\r\n     */\r\n    getActiveWindow(): BaseWindow | null {\r\n        if (!this.activeWindowId) return null;\r\n        return this.windows.get(this.activeWindowId) || null;\r\n    }\r\n\r\n    /**\r\n     * Serialize all windows for session management\r\n     */\r\n    serializeAll(): WindowState[] {\r\n        return Array.from(this.windows.values()).map(w => w.serialize());\r\n    }\r\n\r\n    /**\r\n     * Restore windows from session\r\n     */\r\n    restoreFromSession(states: WindowState[]): void {\r\n        states.forEach(state => {\r\n            // Window types need to create their specific window classes\r\n            // This will be handled by the session manager with window factories\r\n            console.log(`[WindowRegistry] Restore window ${state.id} (type: ${state.type})`);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get count of windows by type\r\n     */\r\n    getWindowCount(type?: string): number {\r\n        if (type) {\r\n            return this.getWindowsByType(type).length;\r\n        }\r\n        return this.windows.size;\r\n    }\r\n\r\n    /**\r\n     * Check if any windows are open\r\n     */\r\n    hasOpenWindows(): boolean {\r\n        return this.windows.size > 0;\r\n    }\r\n\r\n    /**\r\n     * Find window containing a specific tab\r\n     */\r\n    findWindowByTabId(tabId: string): BaseWindow | null {\r\n        for (const window of this.windows.values()) {\r\n            if (window.tabs.has(tabId)) {\r\n                return window;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Debug: Log all windows\r\n     */\r\n    debugLogWindows(): void {\r\n        console.log('[WindowRegistry] Open windows:', {\r\n            total: this.windows.size,\r\n            windows: Array.from(this.windows.values()).map(w => ({\r\n                id: w.id,\r\n                type: w.type,\r\n                tabs: w.tabs.size,\r\n                zIndex: w.zIndex,\r\n                minimized: w.isMinimized,\r\n                maximized: w.isMaximized,\r\n            })),\r\n        });\r\n    }\r\n}\r\n\r\n// Create and expose singleton\r\nconst registry = new WindowRegistry();\r\n(window as any).WindowRegistry = registry;\r\n\r\n// Initialize registry when DOM is ready\r\nif (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', () => registry.init());\r\n} else {\r\n    registry.init();\r\n}\r\n\r\nexport default registry;\r\n", "/**\r\n * virtual-fs.ts\r\n * Central Virtual File System\r\n *\r\n * Provides a persistent, in-memory file system that can be shared across\r\n * multiple modules (Finder, Terminal, TextEditor, etc.).\r\n *\r\n * Features:\r\n * - CRUD operations (Create, Read, Update, Delete)\r\n * - LocalStorage persistence\r\n * - Path-based navigation\r\n * - File metadata (size, modified, type)\r\n * - Event system for change notifications\r\n */\r\n\r\nimport { getJSON, setJSON } from './storage-utils.js';\r\n\r\n// ============================================================================\r\n// Type Definitions\r\n// ============================================================================\r\n\r\ninterface FileItem {\r\n    type: 'file';\r\n    icon: string;\r\n    content: string;\r\n    size: number;\r\n    created: string;\r\n    modified: string;\r\n}\r\n\r\ninterface FolderItem {\r\n    type: 'folder';\r\n    icon: string;\r\n    children: Record<string, FileItem | FolderItem>;\r\n    created: string;\r\n    modified: string;\r\n}\r\n\r\ntype FSItem = FileItem | FolderItem;\r\n\r\ninterface FileSystemRoot {\r\n    '/': FolderItem;\r\n}\r\n\r\ninterface FSEvent {\r\n    type: 'create' | 'update' | 'delete' | 'rename';\r\n    path: string;\r\n    oldPath?: string;\r\n    item: FSItem;\r\n}\r\n\r\ntype FSListener = (event: FSEvent) => void;\r\n\r\n// ============================================================================\r\n// Virtual File System Manager\r\n// ============================================================================\r\n\r\nclass VirtualFileSystemManager {\r\n    private root: FileSystemRoot;\r\n    private listeners: FSListener[] = [];\r\n    private readonly STORAGE_KEY = 'virtual-file-system';\r\n    private readonly AUTO_SAVE_DELAY = 1000; // 1 second debounce\r\n    private saveTimeout: number | null = null;\r\n\r\n    private getRootContainer(): Record<string, FSItem> {\r\n        return this.root['/'].children;\r\n    }\r\n\r\n    constructor() {\r\n        this.root = this.createDefaultStructure();\r\n        this.load();\r\n    }\r\n\r\n    // ========================================================================\r\n    // Initialization\r\n    // ========================================================================\r\n\r\n    private createDefaultStructure(): FileSystemRoot {\r\n        const now = new Date().toISOString();\r\n\r\n        return {\r\n            '/': {\r\n                type: 'folder',\r\n                icon: '/',\r\n                created: now,\r\n                modified: now,\r\n                children: {\r\n                    home: {\r\n                        type: 'folder',\r\n                        icon: '\uD83C\uDFE0',\r\n                        created: now,\r\n                        modified: now,\r\n                        children: {\r\n                            marvin: {\r\n                                type: 'folder',\r\n                                icon: '\uD83D\uDC64',\r\n                                created: now,\r\n                                modified: now,\r\n                                children: {\r\n                                    '.profile': {\r\n                                        type: 'file',\r\n                                        icon: '\u2699\uFE0F',\r\n                                        content:\r\n                                            '# ~/.profile\\n# User profile configuration\\n\\nexport PATH=$HOME/bin:/usr/local/bin:/usr/bin:/bin\\nexport EDITOR=vim\\n',\r\n                                        size: 112,\r\n                                        created: now,\r\n                                        modified: now,\r\n                                    },\r\n                                    'README.md': {\r\n                                        type: 'file',\r\n                                        icon: '\uD83D\uDCDD',\r\n                                        content:\r\n                                            '# Welcome to your home directory\\n\\nThis is your personal space in the virtual file system.\\n\\n## Structure\\n- Documents: Store your text files and documents\\n- Downloads: Temporary download location\\n- Pictures: Image files\\n- Projects: Your code projects\\n',\r\n                                        size: 248,\r\n                                        created: now,\r\n                                        modified: now,\r\n                                    },\r\n                                    Documents: {\r\n                                        type: 'folder',\r\n                                        icon: '\uD83D\uDCC4',\r\n                                        created: now,\r\n                                        modified: now,\r\n                                        children: {\r\n                                            'notes.txt': {\r\n                                                type: 'file',\r\n                                                icon: '\uD83D\uDCDD',\r\n                                                content: 'Personal notes...',\r\n                                                size: 17,\r\n                                                created: now,\r\n                                                modified: now,\r\n                                            },\r\n                                        },\r\n                                    },\r\n                                    Downloads: {\r\n                                        type: 'folder',\r\n                                        icon: '\u2B07\uFE0F',\r\n                                        created: now,\r\n                                        modified: now,\r\n                                        children: {},\r\n                                    },\r\n                                    Pictures: {\r\n                                        type: 'folder',\r\n                                        icon: '\uD83D\uDDBC\uFE0F',\r\n                                        created: now,\r\n                                        modified: now,\r\n                                        children: {},\r\n                                    },\r\n                                    Projects: {\r\n                                        type: 'folder',\r\n                                        icon: '\uD83D\uDCBC',\r\n                                        created: now,\r\n                                        modified: now,\r\n                                        children: {},\r\n                                    },\r\n                                },\r\n                            },\r\n                        },\r\n                    },\r\n                    etc: {\r\n                        type: 'folder',\r\n                        icon: '\u2699\uFE0F',\r\n                        created: now,\r\n                        modified: now,\r\n                        children: {\r\n                            hosts: {\r\n                                type: 'file',\r\n                                icon: '\uD83C\uDF10',\r\n                                content:\r\n                                    '# /etc/hosts\\n127.0.0.1   localhost\\n::1         localhost\\n',\r\n                                size: 57,\r\n                                created: now,\r\n                                modified: now,\r\n                            },\r\n                        },\r\n                    },\r\n                    usr: {\r\n                        type: 'folder',\r\n                        icon: '\uD83D\uDCE6',\r\n                        created: now,\r\n                        modified: now,\r\n                        children: {\r\n                            bin: {\r\n                                type: 'folder',\r\n                                icon: '\u26A1',\r\n                                created: now,\r\n                                modified: now,\r\n                                children: {},\r\n                            },\r\n                            share: {\r\n                                type: 'folder',\r\n                                icon: '\uD83D\uDCDA',\r\n                                created: now,\r\n                                modified: now,\r\n                                children: {\r\n                                    doc: {\r\n                                        type: 'folder',\r\n                                        icon: '\uD83D\uDCD6',\r\n                                        created: now,\r\n                                        modified: now,\r\n                                        children: {\r\n                                            README: {\r\n                                                type: 'file',\r\n                                                icon: '\uD83D\uDCDD',\r\n                                                content:\r\n                                                    'Virtual File System Documentation\\n\\nThis is a UNIX-like filesystem hierarchy.\\n\\nStandard directories:\\n- /home: User home directories\\n- /etc: System configuration\\n- /usr: User programs and data\\n- /var: Variable data (logs, temp)\\n- /tmp: Temporary files\\n',\r\n                                                size: 252,\r\n                                                created: now,\r\n                                                modified: now,\r\n                                            },\r\n                                        },\r\n                                    },\r\n                                },\r\n                            },\r\n                        },\r\n                    },\r\n                    var: {\r\n                        type: 'folder',\r\n                        icon: '\uD83D\uDCCA',\r\n                        created: now,\r\n                        modified: now,\r\n                        children: {\r\n                            log: {\r\n                                type: 'folder',\r\n                                icon: '\uD83D\uDCDC',\r\n                                created: now,\r\n                                modified: now,\r\n                                children: {},\r\n                            },\r\n                            tmp: {\r\n                                type: 'folder',\r\n                                icon: '\uD83D\uDDC2\uFE0F',\r\n                                created: now,\r\n                                modified: now,\r\n                                children: {},\r\n                            },\r\n                        },\r\n                    },\r\n                    tmp: {\r\n                        type: 'folder',\r\n                        icon: '\uD83D\uDDD1\uFE0F',\r\n                        created: now,\r\n                        modified: now,\r\n                        children: {},\r\n                    },\r\n                },\r\n            },\r\n        };\r\n    }\r\n\r\n    // ========================================================================\r\n    // Persistence\r\n    // ========================================================================\r\n\r\n    load(): void {\r\n        try {\r\n            const stored = getJSON<FileSystemRoot | null>(this.STORAGE_KEY, null);\r\n\r\n            if (stored && Object.keys(stored).length > 0) {\r\n                this.root = stored;\r\n                console.log('[VirtualFS] Loaded from localStorage');\r\n            } else {\r\n                // Use default structure if no valid data in storage\r\n                this.root = this.createDefaultStructure();\r\n                console.log('[VirtualFS] No stored data, initialized with defaults');\r\n            }\r\n        } catch (error) {\r\n            console.error('[VirtualFS] Failed to load:', error);\r\n            // Fallback to defaults on error\r\n            this.root = this.createDefaultStructure();\r\n        }\r\n    }\r\n\r\n    private scheduleSave(): void {\r\n        if (this.saveTimeout !== null) {\r\n            window.clearTimeout(this.saveTimeout);\r\n        }\r\n\r\n        this.saveTimeout = window.setTimeout(() => {\r\n            this.save();\r\n            this.saveTimeout = null;\r\n        }, this.AUTO_SAVE_DELAY);\r\n    }\r\n\r\n    private save(): void {\r\n        try {\r\n            setJSON(this.STORAGE_KEY, this.root);\r\n            console.log('[VirtualFS] Saved to localStorage');\r\n        } catch (error) {\r\n            console.error('[VirtualFS] Failed to save:', error);\r\n        }\r\n    }\r\n\r\n    forceSave(): void {\r\n        if (this.saveTimeout !== null) {\r\n            window.clearTimeout(this.saveTimeout);\r\n            this.saveTimeout = null;\r\n        }\r\n        this.save();\r\n    }\r\n\r\n    // ========================================================================\r\n    // Event System\r\n    // ========================================================================\r\n\r\n    addEventListener(listener: FSListener): void {\r\n        this.listeners.push(listener);\r\n    }\r\n\r\n    removeEventListener(listener: FSListener): void {\r\n        const index = this.listeners.indexOf(listener);\r\n        if (index !== -1) {\r\n            this.listeners.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    private emit(event: FSEvent): void {\r\n        this.listeners.forEach(listener => {\r\n            try {\r\n                listener(event);\r\n            } catch (error) {\r\n                console.error('[VirtualFS] Listener error:', error);\r\n            }\r\n        });\r\n    }\r\n\r\n    // ========================================================================\r\n    // Path Utilities\r\n    // ========================================================================\r\n\r\n    private parsePath(path: string | string[]): string[] {\r\n        if (Array.isArray(path)) {\r\n            return path;\r\n        }\r\n        return path.split('/').filter(p => p.length > 0);\r\n    }\r\n\r\n    normalizePath(path: string | string[]): string {\r\n        return this.parsePath(path).join('/');\r\n    }\r\n\r\n    navigate(path: string | string[]): FSItem | null {\r\n        const parts = this.parsePath(path);\r\n\r\n        // Empty path = root folder\r\n        if (parts.length === 0) {\r\n            return null; // Root is not an item, it's the container\r\n        }\r\n\r\n        // Start navigation from the root folder's children\r\n        const rootFolder = this.root['/'];\r\n        if (!rootFolder || rootFolder.type !== 'folder') {\r\n            return null;\r\n        }\r\n\r\n        let current: Record<string, FSItem> = rootFolder.children;\r\n        let lastItem: FSItem | null = null;\r\n\r\n        for (const part of parts) {\r\n            const item = current[part];\r\n            if (!item) {\r\n                return null;\r\n            }\r\n\r\n            lastItem = item;\r\n\r\n            if (item.type === 'folder') {\r\n                current = item.children;\r\n            } else {\r\n                // File - stop navigation\r\n                return item;\r\n            }\r\n        }\r\n\r\n        return lastItem;\r\n    }\r\n\r\n    // ========================================================================\r\n    // Read Operations\r\n    // ========================================================================\r\n\r\n    exists(path: string | string[]): boolean {\r\n        return this.navigate(path) !== null;\r\n    }\r\n\r\n    get(path: string | string[]): FSItem | null {\r\n        return this.navigate(path);\r\n    }\r\n\r\n    getFolder(path: string | string[]): FolderItem | null {\r\n        const item = this.navigate(path);\r\n        return item?.type === 'folder' ? item : null;\r\n    }\r\n\r\n    getFile(path: string | string[]): FileItem | null {\r\n        const item = this.navigate(path);\r\n        return item?.type === 'file' ? item : null;\r\n    }\r\n\r\n    list(path: string | string[] = []): Record<string, FSItem> {\r\n        const parts = this.parsePath(path);\r\n\r\n        // Empty path = list root folder's children\r\n        if (parts.length === 0) {\r\n            const rootFolder = this.root['/'];\r\n            return rootFolder?.children || {};\r\n        }\r\n\r\n        const folder = this.getFolder(path);\r\n        return folder?.children || {};\r\n    }\r\n\r\n    readFile(path: string | string[]): string | null {\r\n        const file = this.getFile(path);\r\n        return file?.content || null;\r\n    }\r\n\r\n    // ========================================================================\r\n    // Write Operations\r\n    // ========================================================================\r\n\r\n    createFile(path: string | string[], content = '', icon = '\uD83D\uDCDD'): boolean {\r\n        const parts = this.parsePath(path);\r\n\r\n        if (parts.length === 0) {\r\n            return false;\r\n        }\r\n\r\n        const fileName = parts[parts.length - 1]!;\r\n        const parentPath = parts.slice(0, -1);\r\n\r\n        const parent = parentPath.length > 0 ? this.getFolder(parentPath) : null;\r\n        const container: Record<string, FSItem> = parent?.children || this.getRootContainer();\r\n\r\n        if (container[fileName]) {\r\n            console.warn('[VirtualFS] File already exists:', this.normalizePath(path));\r\n            return false;\r\n        }\r\n\r\n        const now = new Date().toISOString();\r\n        const file: FileItem = {\r\n            type: 'file',\r\n            icon,\r\n            content,\r\n            size: content.length,\r\n            created: now,\r\n            modified: now,\r\n        };\r\n\r\n        container[fileName] = file;\r\n\r\n        if (parent) {\r\n            parent.modified = now;\r\n        }\r\n\r\n        this.scheduleSave();\r\n        this.emit({ type: 'create', path: this.normalizePath(path), item: file });\r\n\r\n        return true;\r\n    }\r\n\r\n    createFolder(path: string | string[], icon = '\uD83D\uDCC1'): boolean {\r\n        const parts = this.parsePath(path);\r\n\r\n        if (parts.length === 0) {\r\n            return false;\r\n        }\r\n\r\n        const folderName = parts[parts.length - 1]!;\r\n        const parentPath = parts.slice(0, -1);\r\n\r\n        const parent = parentPath.length > 0 ? this.getFolder(parentPath) : null;\r\n        const container: Record<string, FSItem> = parent?.children || this.getRootContainer();\r\n\r\n        if (container[folderName]) {\r\n            console.warn('[VirtualFS] Folder already exists:', this.normalizePath(path));\r\n            return false;\r\n        }\r\n\r\n        const now = new Date().toISOString();\r\n        const folder: FolderItem = {\r\n            type: 'folder',\r\n            icon,\r\n            children: {},\r\n            created: now,\r\n            modified: now,\r\n        };\r\n\r\n        container[folderName] = folder;\r\n\r\n        if (parent) {\r\n            parent.modified = now;\r\n        }\r\n\r\n        this.scheduleSave();\r\n        this.emit({ type: 'create', path: this.normalizePath(path), item: folder });\r\n\r\n        return true;\r\n    }\r\n\r\n    writeFile(path: string | string[], content: string): boolean {\r\n        const file = this.getFile(path);\r\n\r\n        if (!file) {\r\n            console.warn('[VirtualFS] File not found:', this.normalizePath(path));\r\n            return false;\r\n        }\r\n\r\n        file.content = content;\r\n        file.size = content.length;\r\n        file.modified = new Date().toISOString();\r\n\r\n        this.scheduleSave();\r\n        this.emit({ type: 'update', path: this.normalizePath(path), item: file });\r\n\r\n        return true;\r\n    }\r\n\r\n    delete(path: string | string[]): boolean {\r\n        const parts = this.parsePath(path);\r\n\r\n        if (parts.length === 0) {\r\n            return false;\r\n        }\r\n\r\n        const itemName = parts[parts.length - 1]!;\r\n        const parentPath = parts.slice(0, -1);\r\n\r\n        const parent = parentPath.length > 0 ? this.getFolder(parentPath) : null;\r\n        const container: Record<string, FSItem> = parent?.children || this.getRootContainer();\r\n\r\n        if (!container[itemName]) {\r\n            console.warn('[VirtualFS] Item not found:', this.normalizePath(path));\r\n            return false;\r\n        }\r\n\r\n        const item = container[itemName];\r\n        delete container[itemName];\r\n\r\n        if (parent) {\r\n            parent.modified = new Date().toISOString();\r\n        }\r\n\r\n        this.scheduleSave();\r\n        this.emit({ type: 'delete', path: this.normalizePath(path), item });\r\n\r\n        return true;\r\n    }\r\n\r\n    rename(oldPath: string | string[], newName: string): boolean {\r\n        const parts = this.parsePath(oldPath);\r\n\r\n        if (parts.length === 0) {\r\n            return false;\r\n        }\r\n\r\n        const oldName = parts[parts.length - 1]!;\r\n        const parentPath = parts.slice(0, -1);\r\n\r\n        const parent = parentPath.length > 0 ? this.getFolder(parentPath) : null;\r\n        const container: Record<string, FSItem> = parent?.children || this.getRootContainer();\r\n\r\n        if (!container[oldName]) {\r\n            console.warn('[VirtualFS] Item not found:', this.normalizePath(oldPath));\r\n            return false;\r\n        }\r\n\r\n        if (container[newName]) {\r\n            console.warn('[VirtualFS] Target name already exists:', newName);\r\n            return false;\r\n        }\r\n\r\n        const item = container[oldName];\r\n        container[newName] = item;\r\n        delete container[oldName];\r\n\r\n        if (parent) {\r\n            parent.modified = new Date().toISOString();\r\n        }\r\n\r\n        item.modified = new Date().toISOString();\r\n\r\n        const newPath = [...parentPath, newName].join('/');\r\n\r\n        this.scheduleSave();\r\n        this.emit({\r\n            type: 'rename',\r\n            path: newPath,\r\n            oldPath: this.normalizePath(oldPath),\r\n            item,\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n    // ========================================================================\r\n    // Stats & Utilities\r\n    // ========================================================================\r\n\r\n    getStats(): { totalFiles: number; totalFolders: number; totalSize: number } {\r\n        let totalFiles = 0;\r\n        let totalFolders = 0;\r\n        let totalSize = 0;\r\n\r\n        const traverse = (items: Record<string, FSItem>) => {\r\n            for (const item of Object.values(items)) {\r\n                if (item.type === 'file') {\r\n                    totalFiles++;\r\n                    totalSize += item.size;\r\n                } else if (item.type === 'folder') {\r\n                    totalFolders++;\r\n                    traverse(item.children);\r\n                }\r\n            }\r\n        };\r\n\r\n        traverse(this.root['/'].children);\r\n\r\n        return { totalFiles, totalFolders, totalSize };\r\n    }\r\n\r\n    reset(): void {\r\n        this.root = this.createDefaultStructure();\r\n        this.save();\r\n        console.log('[VirtualFS] Reset to defaults');\r\n    }\r\n\r\n    export(): FileSystemRoot {\r\n        return JSON.parse(JSON.stringify(this.root));\r\n    }\r\n\r\n    import(data: FileSystemRoot): boolean {\r\n        try {\r\n            // Basic validation\r\n            if (!data || typeof data !== 'object') {\r\n                return false;\r\n            }\r\n\r\n            this.root = data;\r\n            this.save();\r\n            console.log('[VirtualFS] Imported successfully');\r\n\r\n            return true;\r\n        } catch (error) {\r\n            console.error('[VirtualFS] Import failed:', error);\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// Singleton Instance\r\n// ============================================================================\r\n\r\nexport const VirtualFS = new VirtualFileSystemManager();\r\nexport default VirtualFS;\r\n\r\n// Expose globally for debugging\r\nif (typeof window !== 'undefined') {\r\n    (window as any).VirtualFS = VirtualFS;\r\n}\r\n", "/**\r\n * src/ts/terminal-session.ts\r\n * Terminal session as a tab within a terminal window\r\n *\r\n * Uses the shared VirtualFS for file system operations.\r\n */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport { BaseTab, type TabConfig } from '../../windows/base-tab.js';\r\nimport { VirtualFS } from '../../services/virtual-fs.js';\r\n\r\n/**\r\n * TerminalSession - Individual terminal session tab\r\n *\r\n * Features:\r\n * - Command execution with VirtualFS integration\r\n * - Shared file system with Finder\r\n * - Command history\r\n * - Path resolution and navigation\r\n */\r\nexport class TerminalSession extends BaseTab {\r\n    outputElement: HTMLElement | null;\r\n    inputElement: HTMLInputElement | null;\r\n    commandHistory: string[];\r\n    historyIndex: number;\r\n    vfsCwd: string;\r\n\r\n    constructor(config?: Partial<TabConfig>) {\r\n        super({\r\n            type: 'terminal-session',\r\n            title: config?.title || 'Terminal',\r\n            ...config,\r\n        });\r\n\r\n        this.outputElement = null;\r\n        this.inputElement = null;\r\n        this.commandHistory = [];\r\n        this.historyIndex = -1;\r\n        this.vfsCwd = '/home/marvin';\r\n\r\n        // Ensure VirtualFS has default structure for tests/dev if storage is empty or corrupted\r\n        try {\r\n            const home = VirtualFS.getFolder('/home/marvin');\r\n            if (!home || !home.children) {\r\n                console.warn('[TerminalSession] VirtualFS missing defaults, resetting');\r\n                VirtualFS.reset();\r\n            }\r\n        } catch (error) {\r\n            console.warn('[TerminalSession] VirtualFS check failed, resetting', error);\r\n            VirtualFS.reset();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create terminal DOM\r\n     */\r\n    createDOM(): HTMLElement {\r\n        const container = document.createElement('div');\r\n        container.id = `${this.id}-container`;\r\n        container.className = 'tab-content hidden w-full h-full';\r\n\r\n        const html = `\r\n            <div class=\"terminal-wrapper h-full flex flex-col bg-gray-900 text-green-400 font-mono text-sm\">\r\n                <div class=\"terminal-output flex-1 overflow-y-auto p-4 space-y-1\" data-terminal-output>\r\n                </div>\r\n                <div class=\"terminal-input-line flex items-center px-4 py-2 border-t border-gray-700\">\r\n                    <span class=\"terminal-prompt text-blue-400\">guest@marvin:${this.vfsCwd}$</span>\r\n                    <input\r\n                        type=\"text\"\r\n                        class=\"flex-1 ml-2 bg-transparent outline-none text-green-400 terminal-input\"\r\n                        autocomplete=\"off\"\r\n                        spellcheck=\"false\"\r\n                        aria-label=\"Terminal input\"\r\n                        data-terminal-input\r\n                    />\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        container.innerHTML = html;\r\n        this.element = container;\r\n\r\n        this.outputElement = container.querySelector('[data-terminal-output]');\r\n        this.inputElement = container.querySelector('[data-terminal-input]');\r\n\r\n        this._attachEventListeners();\r\n        this.showWelcomeMessage();\r\n\r\n        return container;\r\n    }\r\n\r\n    private _attachEventListeners(): void {\r\n        if (!this.inputElement) return;\r\n\r\n        this.inputElement.addEventListener('keydown', (e: KeyboardEvent) => {\r\n            if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                const command = this.inputElement!.value.trim();\r\n                if (command) {\r\n                    this.executeCommand(command);\r\n                    // Note: commandHistory is now updated in executeCommand()\r\n                }\r\n                this.inputElement!.value = '';\r\n                this.inputElement!.focus();\r\n            } else if (e.key === 'ArrowUp') {\r\n                e.preventDefault();\r\n                if (this.historyIndex > 0) {\r\n                    this.historyIndex--;\r\n                    const historyEntry = this.commandHistory[this.historyIndex];\r\n                    if (historyEntry !== undefined) {\r\n                        this.inputElement!.value = historyEntry;\r\n                    }\r\n                }\r\n            } else if (e.key === 'ArrowDown') {\r\n                e.preventDefault();\r\n                if (this.historyIndex < this.commandHistory.length - 1) {\r\n                    this.historyIndex++;\r\n                    const historyEntry = this.commandHistory[this.historyIndex];\r\n                    if (historyEntry !== undefined) {\r\n                        this.inputElement!.value = historyEntry;\r\n                    }\r\n                } else {\r\n                    this.historyIndex = this.commandHistory.length;\r\n                    this.inputElement!.value = '';\r\n                }\r\n            } else if (e.key === 'Tab') {\r\n                // Keep focus and prevent browser focus traversal.\r\n                e.preventDefault();\r\n                this.handleTabCompletion();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Basic tab completion for commands and VirtualFS paths.\r\n     *\r\n     * This is primarily used by Playwright E2E tests (tests/e2e/terminal/terminal-autocomplete.spec.js)\r\n     * and intentionally stays simple:\r\n     * - Completes first token as command\r\n     * - Completes first argument for cd/cat/mkdir/rm\r\n     */\r\n    private handleTabCompletion(): void {\r\n        if (!this.inputElement) return;\r\n\r\n        const input = this.inputElement.value;\r\n        if (input === '') return;\r\n\r\n        const endsWithSpace = input.endsWith(' ');\r\n        const tokens = input.split(' ').filter((t, i, arr) => {\r\n            // Preserve a single empty arg at the end via endsWithSpace; otherwise ignore extra spaces.\r\n            if (t !== '') return true;\r\n            return i === arr.length - 1;\r\n        });\r\n\r\n        const cmd = tokens[0] ?? '';\r\n        const arg1 = tokens[1] ?? '';\r\n\r\n        // Keep in sync with executeCommand() keys.\r\n        const availableCommands = [\r\n            'help',\r\n            'clear',\r\n            'ls',\r\n            'pwd',\r\n            'cd',\r\n            'cat',\r\n            'touch',\r\n            'mkdir',\r\n            'rm',\r\n            'echo',\r\n            'date',\r\n            'whoami',\r\n        ];\r\n\r\n        // Debug: current CWD and raw input\r\n        try {\r\n            console.debug('[TerminalSession] Tab on input', { input, cwd: this.vfsCwd });\r\n        } catch {}\r\n\r\n        // Command completion (first token).\r\n        if (tokens.length <= 1 && !endsWithSpace) {\r\n            const matches = availableCommands.filter(c => c.startsWith(cmd));\r\n            try {\r\n                console.debug('[TerminalSession] Command matches', { cmd, matches });\r\n            } catch {}\r\n            if (matches.length === 1) {\r\n                const match = matches[0];\r\n                if (match !== undefined) this.inputElement.value = match + ' ';\r\n                return;\r\n            }\r\n\r\n            // If already complete command, add a trailing space.\r\n            if (availableCommands.includes(cmd)) {\r\n                this.inputElement.value = cmd + ' ';\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Argument completion (first argument only).\r\n        // If user just typed a full command and pressed Tab, add a space.\r\n        if (tokens.length === 1 && endsWithSpace && availableCommands.includes(cmd)) {\r\n            this.inputElement.value = cmd + ' ';\r\n            return;\r\n        }\r\n\r\n        // Only complete for supported commands.\r\n        const completeForCmd = cmd === 'cd' || cmd === 'cat' || cmd === 'mkdir' || cmd === 'rm';\r\n        if (!completeForCmd) return;\r\n\r\n        // If user hasn't started typing an argument yet, don't change anything.\r\n        if (arg1 === '') return;\r\n\r\n        // mkdir: if argument ends with '/', the tests just expect it to stay stable.\r\n        if (cmd === 'mkdir' && arg1.endsWith('/')) return;\r\n\r\n        const allowFolders = cmd === 'cd' || cmd === 'mkdir';\r\n        const allowFiles = cmd === 'cat' || cmd === 'rm';\r\n        const allowBoth = cmd === 'rm';\r\n\r\n        this.completePathArgument(cmd, arg1, {\r\n            allowFolders: allowBoth ? true : allowFolders,\r\n            allowFiles: allowBoth ? true : allowFiles,\r\n        });\r\n    }\r\n\r\n    private findCommonPrefix(strings: string[]): string {\r\n        if (strings.length === 0) return '';\r\n        const first = strings[0] ?? '';\r\n        if (strings.length === 1) return first;\r\n\r\n        let prefix = first;\r\n        for (let i = 1; i < strings.length; i++) {\r\n            const cur = strings[i];\r\n            if (cur === undefined) continue;\r\n            while (cur.indexOf(prefix) !== 0) {\r\n                prefix = prefix.slice(0, -1);\r\n                if (prefix === '') return '';\r\n            }\r\n        }\r\n        return prefix;\r\n    }\r\n\r\n    private completePathArgument(\r\n        cmd: 'cd' | 'cat' | 'mkdir' | 'rm',\r\n        rawArg: string,\r\n        opts: { allowFolders: boolean; allowFiles: boolean }\r\n    ): void {\r\n        if (!this.inputElement) return;\r\n\r\n        // Split into directory part + basename part (to complete last segment).\r\n        const lastSlashIdx = rawArg.lastIndexOf('/');\r\n        const dirPrefix = lastSlashIdx >= 0 ? rawArg.slice(0, lastSlashIdx + 1) : '';\r\n        const basePrefix = lastSlashIdx >= 0 ? rawArg.slice(lastSlashIdx + 1) : rawArg;\r\n\r\n        // If the user is already inside a directory path (ends with '/'), keep stable.\r\n        if (basePrefix === '' && rawArg.endsWith('/')) return;\r\n\r\n        // Resolve directory context for matching. Accept absolute, relative, and ./ ../ prefixes.\r\n        let dirForResolve: string;\r\n        if (dirPrefix === '') {\r\n            dirForResolve = this.vfsCwd;\r\n        } else {\r\n            const rawDir = dirPrefix.endsWith('/') ? dirPrefix.slice(0, -1) : dirPrefix;\r\n            dirForResolve = this.vfsResolve(rawDir);\r\n        }\r\n\r\n        const folder = VirtualFS.getFolder(dirForResolve);\r\n        try {\r\n            console.debug('[TerminalSession] Dir resolve', {\r\n                rawArg,\r\n                dirPrefix,\r\n                basePrefix,\r\n                dirForResolve,\r\n                folderFound: !!folder,\r\n            });\r\n        } catch {}\r\n        if (!folder) return;\r\n\r\n        const entries = Object.entries(folder.children);\r\n        const matches = entries\r\n            .filter(([name, item]) => {\r\n                if (!name.startsWith(basePrefix)) return false;\r\n                if (item.type === 'folder') return opts.allowFolders;\r\n                return opts.allowFiles;\r\n            })\r\n            .map(([name, item]) => ({ name, item }));\r\n\r\n        try {\r\n            console.debug('[TerminalSession] Path matches', {\r\n                cmd,\r\n                basePrefix,\r\n                count: matches.length,\r\n                names: matches.map(m => m.name),\r\n            });\r\n        } catch {}\r\n        if (matches.length === 0) return;\r\n\r\n        const names = matches.map(m => m.name);\r\n\r\n        if (matches.length === 1) {\r\n            const m = matches[0]!;\r\n            let completed = m.name;\r\n\r\n            // For `cd`, append '/' to folders.\r\n            if (cmd === 'cd' && m.item.type === 'folder' && !completed.endsWith('/')) {\r\n                completed += '/';\r\n            }\r\n\r\n            this.inputElement.value = `${cmd} ${dirPrefix}${completed}`;\r\n            return;\r\n        }\r\n\r\n        // Multiple matches: extend to common prefix if possible.\r\n        const common = this.findCommonPrefix(names);\r\n        if (common.length > basePrefix.length) {\r\n            this.inputElement.value = `${cmd} ${dirPrefix}${common}`;\r\n        } else {\r\n            // If nothing to extend, show the list in output for UX feedback (like typical shells).\r\n            try {\r\n                const formatted = matches.map(\r\n                    m => (m.item.type === 'folder' ? '\uD83D\uDCC1 ' : '\uD83D\uDCC4 ') + m.name\r\n                );\r\n                this.addOutput(\r\n                    `guest@marvin:${this.vfsCwd}$ ${this.inputElement!.value}`,\r\n                    'command'\r\n                );\r\n                this.addOutput(formatted.join('  '), 'info');\r\n            } catch {}\r\n        }\r\n    }\r\n\r\n    showWelcomeMessage(): void {\r\n        this.addOutput('Willkommen im Terminal! Gib \"help\" ein f\u00FCr verf\u00FCgbare Befehle.', 'info');\r\n    }\r\n\r\n    executeCommand(command: string): void {\r\n        this.addOutput(`guest@marvin:${this.vfsCwd}$ ${command}`, 'command');\r\n        const [cmd, ...args] = command.split(' ');\r\n\r\n        if (cmd === undefined) return;\r\n\r\n        const commands: Record<string, () => void> = {\r\n            help: () => this.showHelp(),\r\n            clear: () => this.clearOutput(),\r\n            ls: () => this.listDirectory(args[0]),\r\n            pwd: () => this.printWorkingDirectory(),\r\n            cd: () => this.changeDirectory(args[0]),\r\n            cat: () => this.catFile(args[0]),\r\n            touch: () => this.touch(args[0]),\r\n            mkdir: () => this.mkdir(args[0]),\r\n            rm: () => this.rm(args[0]),\r\n            echo: () => this.echo(args.join(' ')),\r\n            date: () => this.showDate(),\r\n            whoami: () => this.addOutput('guest', 'output'),\r\n        };\r\n\r\n        const commandFn = commands[cmd];\r\n        if (commandFn !== undefined) {\r\n            commandFn();\r\n        } else {\r\n            this.addOutput(\r\n                `Befehl nicht gefunden: ${cmd}. Gib \"help\" ein f\u00FCr verf\u00FCgbare Befehle.`,\r\n                'error'\r\n            );\r\n        }\r\n\r\n        // Add command to history for session persistence\r\n        this.commandHistory.push(command);\r\n        this.historyIndex = this.commandHistory.length;\r\n        this.updateContentState({ commandHistory: this.commandHistory });\r\n    }\r\n\r\n    addOutput(text: string, type: 'command' | 'output' | 'error' | 'info' = 'output'): void {\r\n        if (!this.outputElement) return;\r\n        const line = document.createElement('div');\r\n        line.className = `terminal-line terminal-${type}`;\r\n        const colorMap: Record<string, string> = {\r\n            command: 'text-blue-400',\r\n            output: 'text-green-400',\r\n            error: 'text-red-400',\r\n            info: 'text-yellow-400',\r\n        };\r\n        line.className += ` ${colorMap[type] || 'text-green-400'}`;\r\n        line.textContent = text;\r\n        this.outputElement.appendChild(line);\r\n        this.outputElement.scrollTop = this.outputElement.scrollHeight;\r\n    }\r\n\r\n    clearOutput(): void {\r\n        if (this.outputElement) this.outputElement.innerHTML = '';\r\n    }\r\n\r\n    showHelp(): void {\r\n        const helpText = [\r\n            'Verf\u00FCgbare Befehle:',\r\n            '  help     - Zeige diese Hilfe',\r\n            '  clear    - L\u00F6sche Ausgabe',\r\n            '  ls       - Liste Dateien',\r\n            '  pwd      - Zeige aktuelles Verzeichnis',\r\n            '  cd <dir> - Wechsle Verzeichnis',\r\n            '  cat <f>  - Zeige Dateiinhalt',\r\n            '  touch <f> - Erstelle leere Datei',\r\n            '  mkdir <d> - Erstelle Verzeichnis',\r\n            '  rm <p>    - L\u00F6sche Datei/Verzeichnis',\r\n            '  echo <t> - Gebe Text aus',\r\n            '  date     - Zeige Datum/Zeit',\r\n            '  whoami   - Zeige Benutzername',\r\n        ];\r\n        helpText.forEach(l => this.addOutput(l, 'info'));\r\n    }\r\n\r\n    listDirectory(path?: string): void {\r\n        const target = this.vfsResolve(path);\r\n        const item = VirtualFS.get(target);\r\n        if (!item) {\r\n            this.addOutput(`Verzeichnis/Datei nicht gefunden: ${path || target}`, 'error');\r\n            return;\r\n        }\r\n        if (item.type === 'file') {\r\n            this.addOutput('\uD83D\uDCC4 ' + target.split('/').pop(), 'output');\r\n            return;\r\n        }\r\n        const entries = VirtualFS.list(target);\r\n        const names = Object.keys(entries);\r\n        if (names.length === 0) {\r\n            this.addOutput('(leer)', 'output');\r\n            return;\r\n        }\r\n        names.forEach(name => {\r\n            const child = entries[name];\r\n            if (child) {\r\n                const prefix = child.type === 'folder' ? '\uD83D\uDCC1 ' : '\uD83D\uDCC4 ';\r\n                this.addOutput(prefix + name, 'output');\r\n            }\r\n        });\r\n    }\r\n\r\n    printWorkingDirectory(): void {\r\n        this.addOutput(this.vfsCwd, 'output');\r\n    }\r\n\r\n    changeDirectory(path?: string): void {\r\n        const target = this.vfsResolve(path || '/home/marvin');\r\n        const folder = VirtualFS.getFolder(target);\r\n        if (!folder) {\r\n            this.addOutput(`Verzeichnis nicht gefunden: ${path || target}`, 'error');\r\n            return;\r\n        }\r\n        this.vfsCwd = target;\r\n        this.updatePrompt();\r\n        this.updateContentState({ currentPath: this.vfsCwd });\r\n    }\r\n\r\n    catFile(filename?: string): void {\r\n        if (!filename) {\r\n            this.addOutput('Dateiname fehlt', 'error');\r\n            return;\r\n        }\r\n        const target = this.vfsResolve(filename);\r\n        const file = VirtualFS.getFile(target);\r\n        if (!file) this.addOutput(`Datei nicht gefunden: ${filename}`, 'error');\r\n        else this.addOutput(file.content, 'output');\r\n    }\r\n\r\n    echo(text: string): void {\r\n        this.addOutput(text, 'output');\r\n    }\r\n\r\n    showDate(): void {\r\n        this.addOutput(new Date().toString(), 'output');\r\n    }\r\n\r\n    updatePrompt(): void {\r\n        const prompt = this.element?.querySelector('.terminal-prompt') as HTMLElement | null;\r\n        if (prompt) {\r\n            prompt.textContent = `guest@marvin:${this.vfsCwd}$`;\r\n        }\r\n    }\r\n\r\n    // ---------------------------\r\n    // VirtualFS helpers & cmds\r\n    // ---------------------------\r\n    private vfsResolve(path?: string): string {\r\n        // Default to current folder\r\n        if (!path || path.trim() === '' || path === '.') return this.vfsCwd;\r\n\r\n        // Handle tilde expansion for home directory\r\n        let raw = path.trim();\r\n        if (raw === '~') return '/home/marvin';\r\n        if (raw.startsWith('~/')) raw = '/home/marvin/' + raw.slice(2);\r\n\r\n        // Absolute path starts with /\r\n        if (raw.startsWith('/')) {\r\n            // Resolve '.' and '..'\r\n            const parts = raw.split('/').filter(Boolean);\r\n            const resolved: string[] = [];\r\n            for (const p of parts) {\r\n                if (p === '.') continue;\r\n                if (p === '..') {\r\n                    if (resolved.length > 0) resolved.pop();\r\n                } else {\r\n                    resolved.push(p);\r\n                }\r\n            }\r\n            return '/' + resolved.join('/');\r\n        }\r\n\r\n        // Relative path: append to current directory\r\n        const base = this.vfsCwd.split('/').filter(Boolean);\r\n        const parts = raw.split('/').filter(Boolean);\r\n        const combined = [...base, ...parts];\r\n\r\n        // Resolve '.' and '..'\r\n        const resolved: string[] = [];\r\n        for (const p of combined) {\r\n            if (p === '.') continue;\r\n            if (p === '..') {\r\n                if (resolved.length > 0) resolved.pop();\r\n            } else {\r\n                resolved.push(p);\r\n            }\r\n        }\r\n        return '/' + resolved.join('/');\r\n    }\r\n\r\n    touch(path?: string): void {\r\n        if (!path) {\r\n            this.addOutput('Pfad/Dateiname fehlt', 'error');\r\n            return;\r\n        }\r\n        const target = this.vfsResolve(path);\r\n        const existing = VirtualFS.get(target);\r\n        if (existing) {\r\n            if (existing.type === 'file') {\r\n                this.addOutput(`Datei existiert bereits: ${target}`, 'error');\r\n            } else {\r\n                this.addOutput(`Pfad ist ein Verzeichnis: ${target}`, 'error');\r\n            }\r\n            return;\r\n        }\r\n        // Ensure parent exists\r\n        const parts = target.split('/');\r\n        const name = parts.pop() as string;\r\n        const parentPath = parts.join('/');\r\n        const parent = VirtualFS.getFolder(parentPath);\r\n        if (!parent) {\r\n            this.addOutput(`\u00DCbergeordnetes Verzeichnis nicht gefunden: ${parentPath}`, 'error');\r\n            return;\r\n        }\r\n        const ok = VirtualFS.createFile([...parts, name].join('/'), '');\r\n        if (!ok) this.addOutput(`Konnte Datei nicht erstellen: ${target}`, 'error');\r\n    }\r\n\r\n    mkdir(path?: string): void {\r\n        if (!path) {\r\n            this.addOutput('Verzeichnisname fehlt', 'error');\r\n            return;\r\n        }\r\n        const target = this.vfsResolve(path);\r\n        const parts = target.split('/');\r\n        const name = parts.pop() as string;\r\n        const parentPath = parts.join('/');\r\n        const parent = VirtualFS.getFolder(parentPath);\r\n        if (!parent) {\r\n            this.addOutput(`\u00DCbergeordnetes Verzeichnis nicht gefunden: ${parentPath}`, 'error');\r\n            return;\r\n        }\r\n        const ok = VirtualFS.createFolder([...parts, name].join('/'));\r\n        if (!ok) this.addOutput(`Konnte Verzeichnis nicht erstellen: ${target}`, 'error');\r\n    }\r\n\r\n    rm(path?: string): void {\r\n        if (!path) {\r\n            this.addOutput('Pfad fehlt', 'error');\r\n            return;\r\n        }\r\n        const target = this.vfsResolve(path);\r\n        if (!VirtualFS.get(target)) {\r\n            this.addOutput(`Nicht gefunden: ${target}`, 'error');\r\n            return;\r\n        }\r\n        const ok = VirtualFS.delete(target);\r\n        if (!ok) this.addOutput(`Konnte nicht l\u00F6schen: ${target}`, 'error');\r\n    }\r\n\r\n    /**\r\n     * Get parent path of a given path\r\n     */\r\n    private parentPath(path: string): string {\r\n        const parts = path.split('/').filter(Boolean);\r\n        parts.pop();\r\n        return parts.length > 0 ? '/' + parts.join('/') : '/';\r\n    }\r\n    /**\r\n     * Serialize session state\r\n     */\r\n    serialize(): any {\r\n        return {\r\n            ...super.serialize(),\r\n            currentPath: this.vfsCwd,\r\n            commandHistory: this.commandHistory,\r\n            vfsCwd: this.vfsCwd,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Restore session from state\r\n     */\r\n    static deserialize(state: any): TerminalSession {\r\n        const session = new TerminalSession({\r\n            id: state.id,\r\n            title: state.title,\r\n        });\r\n\r\n        // Use vfsCwd if available, otherwise fall back to currentPath\r\n        // Note: Path migration is handled centrally in MultiWindowSessionManager\r\n        // before this method is called, so paths are already in the correct format\r\n        if (state.vfsCwd) {\r\n            session.vfsCwd = state.vfsCwd;\r\n        } else if (state.currentPath) {\r\n            session.vfsCwd = state.currentPath;\r\n        }\r\n\r\n        if (state.commandHistory) {\r\n            session.commandHistory = state.commandHistory;\r\n            session.historyIndex = session.commandHistory.length;\r\n        }\r\n\r\n        return session;\r\n    }\r\n\r\n    /**\r\n     * Focus terminal input when tab is shown\r\n     */\r\n    protected onShow(): void {\r\n        if (this.inputElement && typeof this.inputElement.focus === 'function') {\r\n            this.inputElement.focus();\r\n        }\r\n    }\r\n}\r\n\r\n// Export to window\r\n(window as any).TerminalSession = TerminalSession;\r\n", "/**\r\n * src/ts/terminal-window.ts\r\n * Terminal-specific multi-window implementation\r\n */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport { BaseWindow, type WindowConfig } from '../../windows/base-window.js';\r\nimport type { BaseTab } from '../../windows/base-tab.js';\r\n\r\n/**\r\n * TerminalWindow - Window for terminal sessions\r\n *\r\n * Features:\r\n * - Multiple terminal tabs per window\r\n * - Terminal-specific toolbar\r\n * - Session management\r\n */\r\nexport class TerminalWindow extends BaseWindow {\r\n    constructor(config?: Partial<WindowConfig>) {\r\n        super({\r\n            type: 'terminal',\r\n            title: 'Terminal',\r\n            ...config,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Accessor for tests: alias tabs as sessions for Terminal nomenclature\r\n     */\r\n    get sessions(): BaseTab[] {\r\n        return Array.from(this.tabs.values());\r\n    }\r\n\r\n    /**\r\n     * Get the currently active session (active tab)\r\n     * This getter provides test compatibility for accessing the active terminal session\r\n     */\r\n    get activeSession(): BaseTab | null {\r\n        if (!this.activeTabId) return null;\r\n        return this.tabs.get(this.activeTabId) || null;\r\n    }\r\n\r\n    /**\r\n     * Create terminal-specific window DOM\r\n     */\r\n    createDOM(): HTMLElement {\r\n        const modal = super.createDOM();\r\n        // Title is now set via i18n in BaseWindow\r\n        return modal;\r\n    }\r\n\r\n    /**\r\n     * Override tab rendering to use WindowTabs system\r\n     */\r\n    protected _renderTabs(): void {\r\n        const W = window as any;\r\n        if (!W.WindowTabs || !this.element) return;\r\n\r\n        const tabBar = this.element.querySelector(`#${this.id}-tabs`);\r\n        if (!tabBar) return;\r\n\r\n        // Create a simple adapter for WindowTabs\r\n        const makeInst = (tab: any) => ({\r\n            instanceId: tab.id,\r\n            title: tab.title,\r\n            metadata: { tabLabel: tab.title },\r\n            __tab: tab,\r\n            show: () => tab.show(),\r\n            hide: () => tab.hide(),\r\n        });\r\n        const adapter = {\r\n            getAllInstances: () => Array.from(this.tabs.values()).map(makeInst),\r\n            getActiveInstance: () => {\r\n                const activeId = this.activeTabId;\r\n                const t = activeId ? this.tabs.get(activeId) : null;\r\n                return t ? makeInst(t) : null;\r\n            },\r\n            getAllInstanceIds: () => Array.from(this.tabs.keys()),\r\n            getInstance: (id: string) => {\r\n                const t = this.tabs.get(id) || null;\r\n                return t ? makeInst(t) : null;\r\n            },\r\n            setActiveInstance: (id: string) => this.setActiveTab(id),\r\n            createInstance: (cfg?: any) => {\r\n                const W = window as any;\r\n                const session = W.TerminalSession\r\n                    ? new W.TerminalSession({\r\n                          title: cfg?.title || `Terminal ${this.tabs.size + 1}`,\r\n                      })\r\n                    : null;\r\n                if (session) {\r\n                    this.addTab(session);\r\n                    return makeInst(session);\r\n                }\r\n                return null;\r\n            },\r\n            destroyInstance: (id: string) => this.removeTab(id),\r\n            getInstanceCount: () => this.tabs.size,\r\n            reorderInstances: (newOrder: string[]) => {\r\n                const old = this.tabs;\r\n                const rebuilt = new Map<string, any>();\r\n                newOrder.forEach(id => {\r\n                    const t = old.get(id);\r\n                    if (t) rebuilt.set(id, t);\r\n                });\r\n                old.forEach((t, id) => {\r\n                    if (!rebuilt.has(id)) rebuilt.set(id, t);\r\n                });\r\n                (this as any).tabs = rebuilt;\r\n                this._renderTabs();\r\n            },\r\n            detachInstance: (id: string) => {\r\n                const t = this.detachTab(id) as any;\r\n                return t ? makeInst(t) : null;\r\n            },\r\n            adoptInstance: (inst: any) => {\r\n                const tab = inst.__tab || inst;\r\n                this.addTab(tab);\r\n                this.setActiveTab(tab.id);\r\n                return makeInst(tab);\r\n            },\r\n        };\r\n\r\n        // Clear existing tab controller if any\r\n        if ((this as any).tabController) {\r\n            (this as any).tabController.destroy();\r\n        }\r\n\r\n        // Create WindowTabs controller\r\n        (this as any).tabController = W.WindowTabs.create(adapter, tabBar as HTMLElement, {\r\n            addButton: true,\r\n            onCreateInstanceTitle: () => `Terminal ${this.tabs.size + 1}`,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new terminal session in this window\r\n     */\r\n    createSession(title?: string): BaseTab | null {\r\n        const W = window as any;\r\n        if (!W.TerminalSession) {\r\n            console.error('TerminalSession class not loaded');\r\n            return null;\r\n        }\r\n\r\n        const session = new W.TerminalSession({\r\n            title: title || `Terminal ${this.tabs.size + 1}`,\r\n        });\r\n\r\n        this.addTab(session);\r\n        return session;\r\n    }\r\n\r\n    /**\r\n     * Static factory method to create a terminal window with one session\r\n     */\r\n    static create(config?: Partial<WindowConfig>): TerminalWindow {\r\n        const window = new TerminalWindow(config);\r\n\r\n        // Create initial session\r\n        window.createSession();\r\n\r\n        // Register window BEFORE showing it, so updateDockIndicators() can find it\r\n        const W = globalThis as any;\r\n        if (W.WindowRegistry) {\r\n            W.WindowRegistry.registerWindow(window);\r\n        }\r\n\r\n        // Show window\r\n        window.show();\r\n\r\n        return window;\r\n    }\r\n\r\n    /**\r\n     * Focus existing Terminal window or create new one (macOS-like Dock behavior)\r\n     * - If no Terminal window exists, create a new one\r\n     * - If Terminal windows exist, focus the most recently active one\r\n     */\r\n    static focusOrCreate(config?: Partial<WindowConfig>): TerminalWindow {\r\n        const W = globalThis as any;\r\n        if (!W.WindowRegistry) {\r\n            // Fallback: create new if registry unavailable\r\n            return TerminalWindow.create(config);\r\n        }\r\n\r\n        // Get all existing Terminal windows\r\n        const terminalWindows = W.WindowRegistry.getWindowsByType('terminal');\r\n\r\n        if (terminalWindows.length === 0) {\r\n            // No Terminal window exists \u2192 create new one\r\n            return TerminalWindow.create(config);\r\n        }\r\n\r\n        // Find the most recently active Terminal window (highest z-index)\r\n        let mostRecentWindow = terminalWindows[0];\r\n        for (const win of terminalWindows) {\r\n            if (win.zIndex > mostRecentWindow.zIndex) {\r\n                mostRecentWindow = win;\r\n            }\r\n        }\r\n        // Ensure the window has at least one session\r\n        if (mostRecentWindow.tabs.size === 0 && W.TerminalSession) {\r\n            mostRecentWindow.createSession();\r\n        }\r\n\r\n        // Focus the most recent Terminal window\r\n        mostRecentWindow.bringToFront();\r\n        return mostRecentWindow;\r\n    }\r\n}\r\n\r\n// Export to window for global access\r\n(window as any).TerminalWindow = TerminalWindow;\r\n", "/**\r\n * src/ts/text-editor-document.ts\r\n * Text editor document as a tab within an editor window\r\n */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport { BaseTab, type TabConfig } from '../../windows/base-tab.js';\r\nimport { getString, setString } from '../../services/storage-utils.js';\r\n\r\ntype WrapMode = 'off' | 'soft';\r\n\r\n/**\r\n * TextEditorDocument - Individual document tab\r\n *\r\n * Features:\r\n * - Text editing with formatting\r\n * - Find & replace\r\n * - Word/character count\r\n * - Line/column tracking\r\n */\r\nexport class TextEditorDocument extends BaseTab {\r\n    editor: HTMLTextAreaElement | null;\r\n    statusBar: HTMLElement | null;\r\n    wordCountDisplay: HTMLElement | null;\r\n    lineColDisplay: HTMLElement | null;\r\n    findReplacePanel: HTMLElement | null;\r\n    findInput: HTMLInputElement | null;\r\n    replaceInput: HTMLInputElement | null;\r\n    fileInput: HTMLInputElement | null;\r\n\r\n    wrapMode: WrapMode;\r\n    filename: string;\r\n    isDirty: boolean;\r\n\r\n    constructor(config?: Partial<TabConfig>) {\r\n        super({\r\n            type: 'text-editor-document',\r\n            title: config?.title || 'Untitled.txt',\r\n            ...config,\r\n        });\r\n\r\n        this.editor = null;\r\n        this.statusBar = null;\r\n        this.wordCountDisplay = null;\r\n        this.lineColDisplay = null;\r\n        this.findReplacePanel = null;\r\n        this.findInput = null;\r\n        this.replaceInput = null;\r\n        this.fileInput = null;\r\n\r\n        this.wrapMode = 'off';\r\n        this.filename = this.title;\r\n        this.isDirty = false;\r\n    }\r\n\r\n    /**\r\n     * Create document DOM\r\n     */\r\n    createDOM(): HTMLElement {\r\n        const container = document.createElement('div');\r\n        container.id = `${this.id}-container`;\r\n        container.className = 'tab-content hidden w-full h-full';\r\n\r\n        const isDark = document.documentElement.classList.contains('dark');\r\n\r\n        container.innerHTML = `\r\n            <div class=\"text-editor-wrapper flex flex-col h-full\" style=\"background: ${isDark ? '#0f172a' : '#fafafa'}; color: ${isDark ? '#e5e7eb' : '#111827'};\">\r\n                <!-- Toolbar -->\r\n                <div class=\"text-editor-toolbar flex-none\" style=\"background: ${isDark ? '#1f2937' : '#f5f5f5'}; padding: 8px 12px; border-bottom: 1px solid ${isDark ? '#374151' : '#d1d5db'}; display: flex; gap: 8px; align-items: center; flex-wrap: wrap;\">\r\n                    <button type=\"button\" class=\"btn-new\" title=\"Neu\">Neu</button>\r\n                    <button type=\"button\" class=\"btn-open\" title=\"\u00D6ffnen\">\u00D6ffnen</button>\r\n                    <button type=\"button\" class=\"btn-save\" title=\"Speichern\">Speichern</button>\r\n                    <div style=\"width: 1px; height: 20px; background: ${isDark ? '#475569' : '#d1d5db'}; margin: 0 4px;\"></div>\r\n                    <button type=\"button\" class=\"btn-bold\" title=\"Fett\" style=\"font-weight: bold;\">B</button>\r\n                    <button type=\"button\" class=\"btn-italic\" title=\"Kursiv\" style=\"font-style: italic;\">I</button>\r\n                    <button type=\"button\" class=\"btn-underline\" title=\"Unterstrichen\" style=\"text-decoration: underline;\">U</button>\r\n                    <div style=\"width: 1px; height: 20px; background: ${isDark ? '#475569' : '#d1d5db'}; margin: 0 4px;\"></div>\r\n                    <button type=\"button\" class=\"btn-find\" title=\"Suchen\">\uD83D\uDD0D</button>\r\n                    <button type=\"button\" class=\"btn-wrap\" title=\"Zeilenumbruch\">\u23CE</button>\r\n                    <input type=\"file\" class=\"file-input\" accept=\".txt,.md,.markdown\" style=\"display:none\">\r\n                </div>\r\n\r\n                <!-- Find/Replace Panel -->\r\n                <div class=\"find-replace-panel\" style=\"background: ${isDark ? '#1f2937' : '#f5f5f5'}; padding: 8px 12px; border-bottom: 1px solid ${isDark ? '#374151' : '#d1d5db'}; display: none; gap: 8px; align-items: center;\">\r\n                    <input type=\"text\" class=\"find-input\" placeholder=\"Suchen...\" style=\"padding: 4px 8px; border: 1px solid ${isDark ? '#475569' : '#d1d5db'}; border-radius: 4px; background: ${isDark ? '#111827' : '#ffffff'}; color: inherit;\">\r\n                    <input type=\"text\" class=\"replace-input\" placeholder=\"Ersetzen...\" style=\"padding: 4px 8px; border: 1px solid ${isDark ? '#475569' : '#d1d5db'}; border-radius: 4px; background: ${isDark ? '#111827' : '#ffffff'}; color: inherit;\">\r\n                    <button type=\"button\" class=\"btn-find-next\">Weiter</button>\r\n                    <button type=\"button\" class=\"btn-replace-one\">Ersetzen</button>\r\n                    <button type=\"button\" class=\"btn-replace-all\">Alle</button>\r\n                    <button type=\"button\" class=\"btn-close-find\">\u2715</button>\r\n                </div>\r\n\r\n                <!-- Status -->\r\n                <div class=\"status-bar\" style=\"padding: 6px 12px; border-bottom: 1px solid ${isDark ? '#374151' : '#d1d5db'}; background: ${isDark ? '#1f2937' : '#f5f5f5'}; font-size: 13px; display: none;\"></div>\r\n\r\n                <!-- Editor -->\r\n                <textarea class=\"text-editor-textarea flex-1 w-full resize-none p-4 border-0 outline-none\"\r\n                    spellcheck=\"false\"\r\n                    wrap=\"off\"\r\n                    style=\"background: ${isDark ? '#111827' : '#ffffff'}; color: inherit; font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, monospace; font-size: 14px; line-height: 1.6;\"\r\n                    placeholder=\"Text eingeben...\"></textarea>\r\n\r\n                <!-- Status Bar -->\r\n                <div class=\"editor-statusbar flex-none\" style=\"background: ${isDark ? '#1f2937' : '#f5f5f5'}; padding: 6px 12px; border-top: 1px solid ${isDark ? '#374151' : '#d1d5db'}; font-size: 12px; display: flex; justify-content: space-between;\">\r\n                    <span class=\"word-count\">W\u00F6rter: 0 | Zeichen: 0</span>\r\n                    <span class=\"line-col\">Zeile 1, Spalte 1</span>\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        this.element = container;\r\n\r\n        // Get element references\r\n        this.editor = container.querySelector('.text-editor-textarea');\r\n        this.statusBar = container.querySelector('.status-bar');\r\n        this.wordCountDisplay = container.querySelector('.word-count');\r\n        this.lineColDisplay = container.querySelector('.line-col');\r\n        this.findReplacePanel = container.querySelector('.find-replace-panel');\r\n        this.findInput = container.querySelector('.find-input');\r\n        this.replaceInput = container.querySelector('.replace-input');\r\n        this.fileInput = container.querySelector('.file-input');\r\n\r\n        this._attachEventListeners();\r\n        this._applyButtonStyles();\r\n        this._loadWrapPreference();\r\n\r\n        // Load initial content if any\r\n        if (this.contentState && this.contentState.content && this.editor) {\r\n            this.editor.value = this.contentState.content;\r\n            this._updateWordCount();\r\n            this._updateCursorPosition();\r\n        }\r\n\r\n        return container;\r\n    }\r\n\r\n    private _attachEventListeners(): void {\r\n        if (!this.element) return;\r\n\r\n        // Editor events\r\n        this.editor?.addEventListener('input', () => this._handleInput());\r\n        this.editor?.addEventListener('click', () => this._updateCursorPosition());\r\n        this.editor?.addEventListener('keyup', () => this._updateCursorPosition());\r\n\r\n        // Toolbar buttons\r\n        this.element\r\n            .querySelector('.btn-new')\r\n            ?.addEventListener('click', () => this.clearContent());\r\n        this.element.querySelector('.btn-open')?.addEventListener('click', () => this.openFile());\r\n        this.element.querySelector('.btn-save')?.addEventListener('click', () => this.saveFile());\r\n        this.element\r\n            .querySelector('.btn-bold')\r\n            ?.addEventListener('click', () => this._wrapSelection('**', '**'));\r\n        this.element\r\n            .querySelector('.btn-italic')\r\n            ?.addEventListener('click', () => this._wrapSelection('*', '*'));\r\n        this.element\r\n            .querySelector('.btn-underline')\r\n            ?.addEventListener('click', () => this._wrapSelection('<u>', '</u>'));\r\n        this.element\r\n            .querySelector('.btn-find')\r\n            ?.addEventListener('click', () => this.toggleFindReplace());\r\n        this.element\r\n            .querySelector('.btn-wrap')\r\n            ?.addEventListener('click', () => this.toggleWrapMode());\r\n\r\n        // Find/Replace buttons\r\n        this.element\r\n            .querySelector('.btn-find-next')\r\n            ?.addEventListener('click', () => this.findNext());\r\n        this.element\r\n            .querySelector('.btn-replace-one')\r\n            ?.addEventListener('click', () => this.replaceOne());\r\n        this.element\r\n            .querySelector('.btn-replace-all')\r\n            ?.addEventListener('click', () => this.replaceAll());\r\n        this.element\r\n            .querySelector('.btn-close-find')\r\n            ?.addEventListener('click', () => this.closeFindReplace());\r\n\r\n        // File input\r\n        this.fileInput?.addEventListener('change', e => this._handleFileOpen(e));\r\n    }\r\n\r\n    private _applyButtonStyles(): void {\r\n        if (!this.element) return;\r\n        const isDark = document.documentElement.classList.contains('dark');\r\n        const buttons = this.element.querySelectorAll('button');\r\n        buttons.forEach(btn => {\r\n            btn.style.cssText = `\r\n                padding: 6px 12px;\r\n                font-size: 13px;\r\n                border: 1px solid ${isDark ? '#475569' : '#d1d5db'};\r\n                background: ${isDark ? '#111827' : '#ffffff'};\r\n                color: inherit;\r\n                border-radius: 6px;\r\n                cursor: pointer;\r\n            `;\r\n        });\r\n    }\r\n\r\n    private _handleInput(): void {\r\n        this.isDirty = true;\r\n        if (this.editor) {\r\n            this.updateContentState({ content: this.editor.value });\r\n            this._updateWordCount();\r\n        }\r\n    }\r\n\r\n    private _updateWordCount(): void {\r\n        if (!this.editor || !this.wordCountDisplay) return;\r\n        const text = this.editor.value;\r\n        const words = text.trim() ? text.trim().split(/\\s+/).length : 0;\r\n        const chars = text.length;\r\n        this.wordCountDisplay.textContent = `W\u00F6rter: ${words} | Zeichen: ${chars}`;\r\n    }\r\n\r\n    private _updateCursorPosition(): void {\r\n        if (!this.editor || !this.lineColDisplay) return;\r\n        const pos = this.editor.selectionStart;\r\n        const textBeforeCursor = this.editor.value.substring(0, pos);\r\n        const line = (textBeforeCursor.match(/\\n/g) || []).length + 1;\r\n        const lastNewline = textBeforeCursor.lastIndexOf('\\n');\r\n        const col = pos - lastNewline;\r\n        this.lineColDisplay.textContent = `Zeile ${line}, Spalte ${col}`;\r\n    }\r\n\r\n    clearContent(): void {\r\n        if (this.isDirty && !confirm('Ungespeicherte \u00C4nderungen gehen verloren. Fortfahren?'))\r\n            return;\r\n        if (this.editor) this.editor.value = '';\r\n        this.filename = 'Untitled.txt';\r\n        this.isDirty = false;\r\n        this.setTitle(this.filename);\r\n        this.updateContentState({ content: '' });\r\n        this._updateWordCount();\r\n    }\r\n\r\n    openFile(): void {\r\n        this.fileInput?.click();\r\n    }\r\n\r\n    private _handleFileOpen(event: Event): void {\r\n        const target = event.target as HTMLInputElement;\r\n        const file = target?.files?.[0];\r\n        if (!file) return;\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = e => {\r\n            const content = (e.target as FileReader).result as string;\r\n            if (this.editor) this.editor.value = content;\r\n            this.filename = file.name;\r\n            this.setTitle(this.filename);\r\n            this.isDirty = false;\r\n            this.updateContentState({ content });\r\n            this._updateWordCount();\r\n            this._showStatus(`Ge\u00F6ffnet: ${file.name}`);\r\n        };\r\n        reader.readAsText(file);\r\n    }\r\n\r\n    saveFile(): void {\r\n        const content = this.editor?.value || '';\r\n        const blob = new Blob([content], { type: 'text/plain' });\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = this.filename;\r\n        a.click();\r\n        URL.revokeObjectURL(url);\r\n        this.isDirty = false;\r\n        this._showStatus(`Gespeichert: ${this.filename}`);\r\n    }\r\n\r\n    private _wrapSelection(before: string, after: string): void {\r\n        if (!this.editor) return;\r\n        const start = this.editor.selectionStart;\r\n        const end = this.editor.selectionEnd;\r\n        const selectedText = this.editor.value.substring(start, end);\r\n        const replacement = before + selectedText + after;\r\n        this.editor.setRangeText(replacement, start, end, 'select');\r\n        this.editor.focus();\r\n        this._handleInput();\r\n    }\r\n\r\n    toggleWrapMode(): void {\r\n        this.wrapMode = this.wrapMode === 'soft' ? 'off' : 'soft';\r\n        if (this.editor) {\r\n            this.editor.wrap = this.wrapMode;\r\n            this.editor.style.whiteSpace = this.wrapMode === 'soft' ? 'pre-wrap' : 'pre';\r\n        }\r\n        try {\r\n            setString(`textEditorWrapMode_${this.id}`, this.wrapMode);\r\n        } catch (e) {\r\n            console.warn('Could not save wrap mode', e);\r\n        }\r\n        this.updateContentState({ wrapMode: this.wrapMode });\r\n    }\r\n\r\n    private _loadWrapPreference(): void {\r\n        try {\r\n            const saved = getString(`textEditorWrapMode_${this.id}`) as WrapMode | null;\r\n            if (saved && this.editor) {\r\n                this.wrapMode = saved;\r\n                this.editor.wrap = this.wrapMode;\r\n                this.editor.style.whiteSpace = this.wrapMode === 'soft' ? 'pre-wrap' : 'pre';\r\n            }\r\n        } catch (e) {\r\n            console.warn('Could not load wrap mode', e);\r\n        }\r\n    }\r\n\r\n    toggleFindReplace(): void {\r\n        if (!this.findReplacePanel) return;\r\n        const isHidden = this.findReplacePanel.style.display === 'none';\r\n        this.findReplacePanel.style.display = isHidden ? 'flex' : 'none';\r\n        if (isHidden && this.findInput) this.findInput.focus();\r\n        else this.editor?.focus();\r\n    }\r\n\r\n    closeFindReplace(): void {\r\n        if (this.findReplacePanel) {\r\n            this.findReplacePanel.style.display = 'none';\r\n            this.editor?.focus();\r\n        }\r\n    }\r\n\r\n    findNext(): void {\r\n        if (!this.findInput || !this.editor) return;\r\n        const searchText = this.findInput.value;\r\n        if (!searchText) return;\r\n        const content = this.editor.value;\r\n        const currentPos = this.editor.selectionEnd;\r\n        const index = content.indexOf(searchText, currentPos);\r\n        if (index !== -1) {\r\n            this.editor.setSelectionRange(index, index + searchText.length);\r\n            this.editor.focus();\r\n        } else {\r\n            const firstIndex = content.indexOf(searchText);\r\n            if (firstIndex !== -1) {\r\n                this.editor.setSelectionRange(firstIndex, firstIndex + searchText.length);\r\n                this.editor.focus();\r\n            }\r\n        }\r\n    }\r\n\r\n    replaceOne(): void {\r\n        if (!this.findInput || !this.replaceInput || !this.editor) return;\r\n        const searchText = this.findInput.value;\r\n        const replaceText = this.replaceInput.value;\r\n        if (!searchText) return;\r\n        const start = this.editor.selectionStart;\r\n        const end = this.editor.selectionEnd;\r\n        const selectedText = this.editor.value.substring(start, end);\r\n        if (selectedText === searchText) {\r\n            this.editor.setRangeText(replaceText, start, end, 'end');\r\n            this._handleInput();\r\n        }\r\n        this.findNext();\r\n    }\r\n\r\n    replaceAll(): void {\r\n        if (!this.findInput || !this.replaceInput || !this.editor) return;\r\n        const searchText = this.findInput.value;\r\n        const replaceText = this.replaceInput.value;\r\n        if (!searchText) return;\r\n        const count = (this.editor.value.match(new RegExp(searchText, 'g')) || []).length;\r\n        this.editor.value = this.editor.value.split(searchText).join(replaceText);\r\n        this._handleInput();\r\n        this._showStatus(`${count} Ersetzungen`);\r\n    }\r\n\r\n    private _showStatus(message: string): void {\r\n        if (!this.statusBar) return;\r\n        this.statusBar.textContent = message;\r\n        this.statusBar.style.display = 'block';\r\n        setTimeout(() => {\r\n            if (this.statusBar) this.statusBar.style.display = 'none';\r\n        }, 3000);\r\n    }\r\n\r\n    /**\r\n     * Serialize document state\r\n     */\r\n    serialize(): any {\r\n        return {\r\n            ...super.serialize(),\r\n            filename: this.filename,\r\n            wrapMode: this.wrapMode,\r\n            isDirty: this.isDirty,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Restore document from state\r\n     */\r\n    static deserialize(state: any): TextEditorDocument {\r\n        const doc = new TextEditorDocument({\r\n            id: state.id,\r\n            title: state.title || state.filename,\r\n            content: state.contentState,\r\n        });\r\n\r\n        if (state.filename) doc.filename = state.filename;\r\n        if (state.wrapMode) doc.wrapMode = state.wrapMode;\r\n        if (state.isDirty !== undefined) doc.isDirty = state.isDirty;\r\n\r\n        return doc;\r\n    }\r\n\r\n    /**\r\n     * Focus editor when tab is shown\r\n     */\r\n    protected onShow(): void {\r\n        if (this.editor && typeof this.editor.focus === 'function') {\r\n            this.editor.focus();\r\n        }\r\n    }\r\n}\r\n\r\n// Export to window\r\n(window as any).TextEditorDocument = TextEditorDocument;\r\n", "/**\r\n * src/ts/text-editor-window.ts\r\n * TextEditor-specific multi-window implementation\r\n */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport { BaseWindow, type WindowConfig } from '../../windows/base-window.js';\r\nimport type { BaseTab } from '../../windows/base-tab.js';\r\n\r\n/**\r\n * TextEditorWindow - Window for text editor documents\r\n *\r\n * Features:\r\n * - Multiple document tabs per window\r\n * - Text editing toolbar\r\n * - Document management\r\n */\r\nexport class TextEditorWindow extends BaseWindow {\r\n    constructor(config?: Partial<WindowConfig>) {\r\n        super({\r\n            type: 'text-editor',\r\n            title: 'TextEditor',\r\n            ...config,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create text-editor-specific window DOM\r\n     */\r\n    createDOM(): HTMLElement {\r\n        const modal = super.createDOM();\r\n        // Title is now set via i18n in BaseWindow\r\n        return modal;\r\n    }\r\n\r\n    /**\r\n     * Override tab rendering to use WindowTabs system\r\n     */\r\n    protected _renderTabs(): void {\r\n        const W = window as any;\r\n        if (!W.WindowTabs || !this.element) return;\r\n\r\n        const tabBar = this.element.querySelector(`#${this.id}-tabs`);\r\n        if (!tabBar) return;\r\n\r\n        // Create a simple adapter for WindowTabs\r\n        const makeInst = (tab: any) => ({\r\n            instanceId: tab.id,\r\n            title: tab.title,\r\n            metadata: { tabLabel: tab.title },\r\n            __tab: tab,\r\n            show: () => tab.show(),\r\n            hide: () => tab.hide(),\r\n        });\r\n        const adapter = {\r\n            getAllInstances: () => Array.from(this.tabs.values()).map(makeInst),\r\n            getActiveInstance: () => {\r\n                const activeId = this.activeTabId;\r\n                const t = activeId ? this.tabs.get(activeId) : null;\r\n                return t ? makeInst(t) : null;\r\n            },\r\n            getAllInstanceIds: () => Array.from(this.tabs.keys()),\r\n            getInstance: (id: string) => {\r\n                const t = this.tabs.get(id) || null;\r\n                return t ? makeInst(t) : null;\r\n            },\r\n            setActiveInstance: (id: string) => this.setActiveTab(id),\r\n            createInstance: (cfg?: any) => {\r\n                const W = window as any;\r\n                const doc = W.TextEditorDocument\r\n                    ? new W.TextEditorDocument({\r\n                          title: cfg?.title || `Editor ${this.tabs.size + 1}`,\r\n                      })\r\n                    : null;\r\n                if (doc) {\r\n                    this.addTab(doc);\r\n                    return makeInst(doc);\r\n                }\r\n                return null;\r\n            },\r\n            destroyInstance: (id: string) => this.removeTab(id),\r\n            getInstanceCount: () => this.tabs.size,\r\n            reorderInstances: (newOrder: string[]) => {\r\n                const old = this.tabs;\r\n                const rebuilt = new Map<string, any>();\r\n                newOrder.forEach(id => {\r\n                    const t = old.get(id);\r\n                    if (t) rebuilt.set(id, t);\r\n                });\r\n                old.forEach((t, id) => {\r\n                    if (!rebuilt.has(id)) rebuilt.set(id, t);\r\n                });\r\n                (this as any).tabs = rebuilt;\r\n                this._renderTabs();\r\n            },\r\n            detachInstance: (id: string) => {\r\n                const t = this.detachTab(id) as any;\r\n                return t ? makeInst(t) : null;\r\n            },\r\n            adoptInstance: (inst: any) => {\r\n                const tab = inst.__tab || inst;\r\n                this.addTab(tab);\r\n                this.setActiveTab(tab.id);\r\n                return makeInst(tab);\r\n            },\r\n        };\r\n\r\n        // Clear existing tab controller if any\r\n        if ((this as any).tabController) {\r\n            (this as any).tabController.destroy();\r\n        }\r\n\r\n        // Create WindowTabs controller\r\n        (this as any).tabController = W.WindowTabs.create(adapter, tabBar as HTMLElement, {\r\n            addButton: true,\r\n            onCreateInstanceTitle: () => `Editor ${this.tabs.size + 1}`,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new document in this window\r\n     */\r\n    createDocument(title?: string, content?: string): BaseTab | null {\r\n        const W = window as any;\r\n        if (!W.TextEditorDocument) {\r\n            console.error('TextEditorDocument class not loaded');\r\n            return null;\r\n        }\r\n\r\n        const doc = new W.TextEditorDocument({\r\n            title: title || `Editor ${this.tabs.size + 1}`,\r\n            content: { content: content || '' },\r\n        });\r\n\r\n        this.addTab(doc);\r\n        return doc;\r\n    }\r\n\r\n    /**\r\n     * Static factory method to create a text editor window with one document\r\n     */\r\n    static create(config?: Partial<WindowConfig>): TextEditorWindow {\r\n        const window = new TextEditorWindow(config);\r\n\r\n        // Create initial document\r\n        window.createDocument();\r\n\r\n        // Show window\r\n        window.show();\r\n\r\n        // Register with WindowRegistry\r\n        const W = globalThis as any;\r\n        if (W.WindowRegistry) {\r\n            W.WindowRegistry.registerWindow(window);\r\n        }\r\n\r\n        return window;\r\n    }\r\n}\r\n\r\n// Export to window for global access\r\n(window as any).TextEditorWindow = TextEditorWindow;\r\n", "console.log('TextEditorInstance (TS) loaded');\r\n\r\nimport { getString, setString } from '../../services/storage-utils.js';\r\n\r\n/**\r\n * TextEditorInstance - Multi-Instance capable text editor\r\n * TypeScript migration preserving global API and behavior.\r\n */\r\n(() => {\r\n    'use strict';\r\n\r\n    type WrapMode = 'off' | 'soft';\r\n\r\n    type BaseLike = {\r\n        container: HTMLElement | null;\r\n        updateState: (u: Record<string, unknown>) => void;\r\n    } & Record<string, unknown>;\r\n    type BaseCtor = new (cfg: Record<string, unknown>) => BaseLike;\r\n    const Base = (window as unknown as { BaseWindowInstance: BaseCtor }).BaseWindowInstance;\r\n\r\n    class TextEditorInstance extends Base {\r\n        editor: HTMLTextAreaElement | null;\r\n        statusBar: HTMLElement | null;\r\n        saveButton: HTMLElement | null;\r\n        fileInput: HTMLInputElement | null;\r\n        wordCountDisplay: HTMLElement | null;\r\n        lineColDisplay: HTMLElement | null;\r\n        findReplacePanel: HTMLElement | null;\r\n        findInput: HTMLInputElement | null;\r\n        replaceInput: HTMLInputElement | null;\r\n\r\n        wrapMode: WrapMode;\r\n        currentRemoteFile: string | null;\r\n        currentFilename: string;\r\n        isDirty: boolean;\r\n\r\n        constructor(config: Record<string, unknown>) {\r\n            super({\r\n                ...config,\r\n                type: 'text-editor',\r\n            });\r\n\r\n            this.editor = null;\r\n            this.statusBar = null;\r\n            this.saveButton = null;\r\n            this.fileInput = null;\r\n            this.wordCountDisplay = null;\r\n            this.lineColDisplay = null;\r\n            this.findReplacePanel = null;\r\n            this.findInput = null;\r\n            this.replaceInput = null;\r\n\r\n            this.wrapMode = 'off';\r\n            this.currentRemoteFile = null;\r\n            this.currentFilename =\r\n                ((config as Record<string, unknown>).filename as string) || 'Untitled.txt';\r\n            this.isDirty = false;\r\n        }\r\n\r\n        protected render(): void {\r\n            if (!this.container) return;\r\n            const isDark = document.documentElement.classList.contains('dark');\r\n            this.container.innerHTML = `\r\n                <div class=\"text-editor-wrapper flex flex-col h-full\" style=\"background: ${isDark ? '#0f172a' : '#fafafa'}; color: ${isDark ? '#e5e7eb' : '#111827'};\">\r\n                    <!-- Toolbar -->\r\n                    <div class=\"text-editor-toolbar flex-none\" style=\"background: ${isDark ? '#1f2937' : '#f5f5f5'}; padding: 8px 12px; border-bottom: 1px solid ${isDark ? '#374151' : '#d1d5db'}; display: flex; gap: 8px; align-items: center; flex-wrap: wrap;\">\r\n                        <button type=\"button\" class=\"text-editor-btn\" data-action=\"clear\" title=\"Neu\">Neu</button>\r\n                        <button type=\"button\" class=\"text-editor-btn\" data-action=\"open\" title=\"\u00D6ffnen\">\u00D6ffnen</button>\r\n                        <button type=\"button\" class=\"text-editor-btn text-save-btn\" data-action=\"save\" title=\"Speichern\">Speichern</button>\r\n                        <div class=\"toolbar-separator\"></div>\r\n                        <button type=\"button\" class=\"text-editor-btn\" data-action=\"bold\" title=\"Fett\" style=\"font-weight: bold;\">B</button>\r\n                        <button type=\"button\" class=\"text-editor-btn\" data-action=\"italic\" title=\"Kursiv\" style=\"font-style: italic;\">I</button>\r\n                        <button type=\"button\" class=\"text-editor-btn\" data-action=\"underline\" title=\"Unterstrichen\" style=\"text-decoration: underline;\">U</button>\r\n                        <div class=\"toolbar-separator\"></div>\r\n                        <button type=\"button\" class=\"text-editor-btn\" data-action=\"find\" title=\"Suchen & Ersetzen\">\uD83D\uDD0D</button>\r\n                        <button type=\"button\" class=\"text-editor-btn\" data-action=\"toggleWrap\" title=\"Zeilenumbruch\">\u23CE</button>\r\n                        <input type=\"file\" class=\"text-file-input\"\r\n                            accept=\".txt,.md,.markdown,.html,.css,.js,.json,.yml,.yaml,.xml\"\r\n                            style=\"display:none\">\r\n                    </div>\r\n\r\n                    <!-- Find/Replace Panel (hidden by default) -->\r\n                    <div class=\"find-replace-panel\" style=\"background: ${isDark ? '#1f2937' : '#f5f5f5'}; padding: 8px 12px; border-bottom: 1px solid ${isDark ? '#374151' : '#d1d5db'}; display: none; gap: 8px; align-items: center;\">\r\n                        <input type=\"text\" class=\"find-input\" placeholder=\"Suchen...\" style=\"padding: 4px 8px; border: 1px solid ${isDark ? '#475569' : '#d1d5db'}; border-radius: 4px; background: ${isDark ? '#111827' : '#ffffff'}; color: inherit;\">\r\n                        <input type=\"text\" class=\"replace-input\" placeholder=\"Ersetzen...\" style=\"padding: 4px 8px; border: 1px solid ${isDark ? '#475569' : '#d1d5db'}; border-radius: 4px; background: ${isDark ? '#111827' : '#ffffff'}; color: inherit;\">\r\n                        <button type=\"button\" class=\"text-editor-btn\" data-action=\"findNext\">Weiter</button>\r\n                        <button type=\"button\" class=\"text-editor-btn\" data-action=\"replaceOne\">Ersetzen</button>\r\n                        <button type=\"button\" class=\"text-editor-btn\" data-action=\"replaceAll\">Alle ersetzen</button>\r\n                        <button type=\"button\" class=\"text-editor-btn\" data-action=\"closeFindReplace\">\u2715</button>\r\n                    </div>\r\n\r\n                    <!-- Status Bar for filename -->\r\n                    <div class=\"text-file-status\" style=\"padding: 6px 12px; border-bottom: 1px solid ${isDark ? '#374151' : '#d1d5db'}; background: ${isDark ? '#1f2937' : '#f5f5f5'}; font-size: 13px; opacity: 0.85; display: none;\"></div>\r\n\r\n                    <!-- Editor Textarea -->\r\n                    <textarea class=\"text-editor-textarea flex-1 w-full resize-none p-4 border-0 outline-none\"\r\n                        spellcheck=\"false\"\r\n                        wrap=\"off\"\r\n                        style=\"background: ${isDark ? '#111827' : '#ffffff'}; color: inherit; font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 14px; line-height: 1.6; tab-size: 4;\"\r\n                        placeholder=\"Text eingeben...\"></textarea>\r\n\r\n                    <!-- Status Bar -->\r\n                    <div class=\"text-editor-statusbar flex-none\" style=\"background: ${isDark ? '#1f2937' : '#f5f5f5'}; padding: 6px 12px; border-top: 1px solid ${isDark ? '#374151' : '#d1d5db'}; font-size: 12px; opacity: 0.75; display: flex; justify-content: space-between;\">\r\n                        <span class=\"word-count-display\">W\u00F6rter: 0 | Zeichen: 0</span>\r\n                        <span class=\"line-col-display\">Zeile 1, Spalte 1</span>\r\n                    </div>\r\n                </div>\r\n            `;\r\n            this._applyButtonStyles();\r\n        }\r\n\r\n        private _applyButtonStyles(): void {\r\n            if (!this.container) return;\r\n            const isDark = document.documentElement.classList.contains('dark');\r\n            const buttons = this.container.querySelectorAll(\r\n                '.text-editor-btn'\r\n            ) as NodeListOf<HTMLButtonElement>;\r\n            buttons.forEach(btn => {\r\n                (btn as HTMLElement).style.cssText = `\r\n                    padding: 6px 12px;\r\n                    font-size: 13px;\r\n                    border: 1px solid ${isDark ? '#475569' : '#d1d5db'};\r\n                    background: ${isDark ? '#111827' : '#ffffff'};\r\n                    color: inherit;\r\n                    border-radius: 6px;\r\n                    cursor: pointer;\r\n                    transition: background 0.2s;\r\n                `;\r\n            });\r\n            const separators = this.container.querySelectorAll('.toolbar-separator');\r\n            separators.forEach(sep => {\r\n                (sep as HTMLElement).style.cssText = `\r\n                    width: 1px;\r\n                    height: 20px;\r\n                    background: ${isDark ? '#475569' : '#d1d5db'};\r\n                    margin: 0 4px;\r\n                `;\r\n            });\r\n        }\r\n\r\n        protected attachEventListeners(): void {\r\n            if (!this.container) return;\r\n            this.editor = this.container.querySelector(\r\n                '.text-editor-textarea'\r\n            ) as HTMLTextAreaElement | null;\r\n            this.statusBar = this.container.querySelector('.text-file-status');\r\n            this.saveButton = this.container.querySelector('[data-action=\"save\"]');\r\n            this.fileInput = this.container.querySelector(\r\n                '.text-file-input'\r\n            ) as HTMLInputElement | null;\r\n            this.wordCountDisplay = this.container.querySelector('.word-count-display');\r\n            this.lineColDisplay = this.container.querySelector('.line-col-display');\r\n            this.findReplacePanel = this.container.querySelector('.find-replace-panel');\r\n            this.findInput = this.container.querySelector('.find-input') as HTMLInputElement | null;\r\n            this.replaceInput = this.container.querySelector(\r\n                '.replace-input'\r\n            ) as HTMLInputElement | null;\r\n\r\n            // Lade gespeicherten Content nur beim ersten Rendern (nicht bei Restore)\r\n            if (\r\n                !this._skipInitialRender &&\r\n                this.state &&\r\n                (this.state as Record<string, unknown>).content &&\r\n                this.editor\r\n            ) {\r\n                this.editor.value = (this.state as Record<string, unknown>).content as string;\r\n            }\r\n\r\n            this.editor?.addEventListener('input', () => this._handleInput());\r\n            this.editor?.addEventListener('click', () => this._updateCursorPosition());\r\n            this.editor?.addEventListener('keyup', () => this._updateCursorPosition());\r\n            this.editor?.addEventListener('select', () => this._updateCursorPosition());\r\n\r\n            this.container.addEventListener('click', e => {\r\n                const target = e.target as HTMLElement | null;\r\n                const btn = target?.closest('[data-action]') as HTMLElement | null;\r\n                if (!btn) return;\r\n                const action = btn.getAttribute('data-action') as string;\r\n                this._handleAction(action);\r\n            });\r\n\r\n            if (this.fileInput) {\r\n                this.fileInput.addEventListener('change', e =>\r\n                    this._handleFileOpen(e as unknown as Event)\r\n                );\r\n            }\r\n\r\n            this._updateWordCount();\r\n            this._updateCursorPosition();\r\n            this._loadWrapPreference();\r\n        }\r\n\r\n        private _handleAction(action: string): void {\r\n            const actions: Record<string, () => void> = {\r\n                clear: () => this.clearContent(),\r\n                open: () => this.openFile(),\r\n                save: () => this.saveFile(),\r\n                bold: () => this._wrapSelection('**', '**'),\r\n                italic: () => this._wrapSelection('*', '*'),\r\n                underline: () => this._wrapSelection('<u>', '</u>'),\r\n                find: () => this.toggleFindReplace(),\r\n                toggleWrap: () => this.toggleWrapMode(),\r\n                findNext: () => this.findNext(),\r\n                replaceOne: () => this.replaceOne(),\r\n                replaceAll: () => this.replaceAll(),\r\n                closeFindReplace: () => this.closeFindReplace(),\r\n            };\r\n            if (actions[action]) actions[action]();\r\n        }\r\n\r\n        private _handleInput(): void {\r\n            this.isDirty = true;\r\n            if (this.editor) {\r\n                this.updateState({ content: this.editor.value });\r\n                this._updateWordCount();\r\n                this._updateSaveButton();\r\n                const emit = (\r\n                    Base.prototype as unknown as {\r\n                        emit: (this: unknown, ev: string, data?: unknown) => void;\r\n                    }\r\n                ).emit;\r\n                emit.call(this, 'contentChanged', { content: this.editor.value });\r\n            }\r\n        }\r\n\r\n        private _updateWordCount(): void {\r\n            if (!this.editor || !this.wordCountDisplay) return;\r\n            const text = this.editor.value;\r\n            const words = text.trim() ? text.trim().split(/\\s+/).length : 0;\r\n            const chars = text.length;\r\n            this.wordCountDisplay.textContent = `W\u00F6rter: ${words} | Zeichen: ${chars}`;\r\n        }\r\n\r\n        private _updateCursorPosition(): void {\r\n            if (!this.editor || !this.lineColDisplay) return;\r\n            const pos = this.editor.selectionStart;\r\n            const textBeforeCursor = this.editor.value.substring(0, pos);\r\n            const line = (textBeforeCursor.match(/\\n/g) || []).length + 1;\r\n            const lastNewline = textBeforeCursor.lastIndexOf('\\n');\r\n            const col = pos - lastNewline;\r\n            this.lineColDisplay.textContent = `Zeile ${line}, Spalte ${col}`;\r\n            this.updateState({ cursorPosition: { line, col } });\r\n        }\r\n\r\n        private _updateSaveButton(): void {\r\n            if (!this.saveButton) return;\r\n            if (this.isDirty) {\r\n                (this.saveButton as HTMLElement).style.fontWeight = 'bold';\r\n                (this.saveButton as HTMLElement).setAttribute('title', '\u00C4nderungen speichern');\r\n            } else {\r\n                (this.saveButton as HTMLElement).style.fontWeight = 'normal';\r\n                (this.saveButton as HTMLElement).setAttribute('title', 'Speichern');\r\n            }\r\n        }\r\n\r\n        clearContent(): void {\r\n            if (this.isDirty && !confirm('Ungespeicherte \u00C4nderungen gehen verloren. Fortfahren?')) {\r\n                return;\r\n            }\r\n            if (this.editor) this.editor.value = '';\r\n            this.currentFilename = 'Untitled.txt';\r\n            this.isDirty = false;\r\n            this.updateState({ content: '', filename: this.currentFilename });\r\n            this._updateWordCount();\r\n            this._updateSaveButton();\r\n            this._hideStatusBar();\r\n            const emit = (\r\n                Base.prototype as unknown as {\r\n                    emit: (this: unknown, ev: string, data?: unknown) => void;\r\n                }\r\n            ).emit;\r\n            emit.call(this, 'contentCleared');\r\n        }\r\n\r\n        openFile(): void {\r\n            this.fileInput?.click();\r\n        }\r\n\r\n        private _handleFileOpen(event: Event): void {\r\n            const target = event.target as HTMLInputElement | null;\r\n            const file = target?.files?.[0];\r\n            if (!file) return;\r\n            const reader = new FileReader();\r\n            reader.onload = e => {\r\n                const result = (e.target as FileReader).result as string;\r\n                if (this.editor) this.editor.value = result;\r\n                this.currentFilename = file.name;\r\n                this.isDirty = false;\r\n                this.updateState({ content: result, filename: file.name });\r\n                this._updateWordCount();\r\n                this._updateSaveButton();\r\n                this._showStatusBar(`Ge\u00F6ffnet: ${file.name}`);\r\n                const emit = (\r\n                    Base.prototype as unknown as {\r\n                        emit: (this: unknown, ev: string, data?: unknown) => void;\r\n                    }\r\n                ).emit;\r\n                emit.call(this, 'fileOpened', { filename: file.name });\r\n            };\r\n            reader.readAsText(file);\r\n        }\r\n\r\n        saveFile(): void {\r\n            const content = this.editor?.value || '';\r\n            const blob = new Blob([content], { type: 'text/plain' });\r\n            const url = URL.createObjectURL(blob);\r\n            const a = document.createElement('a');\r\n            a.href = url;\r\n            a.download = this.currentFilename;\r\n            a.click();\r\n            URL.revokeObjectURL(url);\r\n            this.isDirty = false;\r\n            this._updateSaveButton();\r\n            this._showStatusBar(`Gespeichert: ${this.currentFilename}`);\r\n            const emit = (\r\n                Base.prototype as unknown as {\r\n                    emit: (this: unknown, ev: string, data?: unknown) => void;\r\n                }\r\n            ).emit;\r\n            emit.call(this, 'fileSaved', { filename: this.currentFilename });\r\n        }\r\n\r\n        private _wrapSelection(before: string, after: string): void {\r\n            if (!this.editor) return;\r\n            const start = this.editor.selectionStart;\r\n            const end = this.editor.selectionEnd;\r\n            const selectedText = this.editor.value.substring(start, end);\r\n            const replacement = before + selectedText + after;\r\n            this.editor.setRangeText(replacement, start, end, 'select');\r\n            this.editor.focus();\r\n            this._handleInput();\r\n        }\r\n\r\n        toggleWrapMode(): void {\r\n            this.wrapMode = this.wrapMode === 'soft' ? 'off' : 'soft';\r\n            if (this.editor) {\r\n                this.editor.wrap = this.wrapMode;\r\n                this.editor.style.whiteSpace = this.wrapMode === 'soft' ? 'pre-wrap' : 'pre';\r\n            }\r\n            try {\r\n                setString(\r\n                    `textEditorWrapMode_${(this as unknown as { instanceId: string }).instanceId}`,\r\n                    this.wrapMode\r\n                );\r\n            } catch (e) {\r\n                console.warn('Could not save wrap mode', e);\r\n            }\r\n            this.updateState({ wrapMode: this.wrapMode });\r\n            this._showStatusBar(\r\n                this.wrapMode === 'soft' ? 'Zeilenumbruch aktiviert' : 'Zeilenumbruch deaktiviert'\r\n            );\r\n        }\r\n\r\n        private _loadWrapPreference(): void {\r\n            try {\r\n                const id = (this as unknown as { instanceId: string }).instanceId;\r\n                const saved = getString(`textEditorWrapMode_${id}`) as WrapMode | null;\r\n                if (saved && this.editor) {\r\n                    this.wrapMode = saved;\r\n                    this.editor.wrap = this.wrapMode;\r\n                    this.editor.style.whiteSpace = this.wrapMode === 'soft' ? 'pre-wrap' : 'pre';\r\n                }\r\n            } catch (e) {\r\n                console.warn('Could not load wrap mode', e);\r\n            }\r\n        }\r\n\r\n        toggleFindReplace(): void {\r\n            if (!this.findReplacePanel) return;\r\n            const isHidden = this.findReplacePanel.style.display === 'none';\r\n            this.findReplacePanel.style.display = isHidden ? 'flex' : 'none';\r\n            if (isHidden && this.findInput) this.findInput.focus();\r\n            else this.editor?.focus();\r\n        }\r\n\r\n        closeFindReplace(): void {\r\n            if (this.findReplacePanel) {\r\n                this.findReplacePanel.style.display = 'none';\r\n                this.editor?.focus();\r\n            }\r\n        }\r\n\r\n        findNext(): void {\r\n            if (!this.findInput || !this.editor) return;\r\n            const searchText = this.findInput.value;\r\n            if (!searchText) return;\r\n            const content = this.editor.value;\r\n            const currentPos = this.editor.selectionEnd;\r\n            const index = content.indexOf(searchText, currentPos);\r\n            if (index !== -1) {\r\n                this.editor.setSelectionRange(index, index + searchText.length);\r\n                this.editor.focus();\r\n            } else {\r\n                const firstIndex = content.indexOf(searchText);\r\n                if (firstIndex !== -1) {\r\n                    this.editor.setSelectionRange(firstIndex, firstIndex + searchText.length);\r\n                    this.editor.focus();\r\n                } else {\r\n                    this._showStatusBar('Nicht gefunden');\r\n                }\r\n            }\r\n        }\r\n\r\n        replaceOne(): void {\r\n            if (!this.findInput || !this.replaceInput || !this.editor) return;\r\n            const searchText = this.findInput.value;\r\n            const replaceText = this.replaceInput.value;\r\n            if (!searchText) return;\r\n            const start = this.editor.selectionStart;\r\n            const end = this.editor.selectionEnd;\r\n            const selectedText = this.editor.value.substring(start, end);\r\n            if (selectedText === searchText) {\r\n                this.editor.setRangeText(replaceText, start, end, 'end');\r\n                this._handleInput();\r\n            }\r\n            this.findNext();\r\n        }\r\n\r\n        replaceAll(): void {\r\n            if (!this.findInput || !this.replaceInput || !this.editor) return;\r\n            const searchText = this.findInput.value;\r\n            const replaceText = this.replaceInput.value;\r\n            if (!searchText) return;\r\n            const newContent = this.editor.value.split(searchText).join(replaceText);\r\n            const count = (this.editor.value.match(new RegExp(searchText, 'g')) || []).length;\r\n            this.editor.value = newContent;\r\n            this._handleInput();\r\n            this._showStatusBar(`${count} Ersetzungen vorgenommen`);\r\n        }\r\n\r\n        private _showStatusBar(message: string): void {\r\n            if (!this.statusBar) return;\r\n            this.statusBar.textContent = message;\r\n            this.statusBar.style.display = 'block';\r\n            setTimeout(() => this._hideStatusBar(), 3000);\r\n        }\r\n\r\n        private _hideStatusBar(): void {\r\n            if (this.statusBar) this.statusBar.style.display = 'none';\r\n        }\r\n\r\n        show(): void {\r\n            const baseShow = (Base.prototype as unknown as { show: () => void }).show;\r\n            baseShow.call(this);\r\n\r\n            // Beim Tab-Wechsel die Editor-Referenz neu holen, da jede Instanz ihren eigenen Container hat\r\n            if (this.container) {\r\n                this.editor = this.container.querySelector(\r\n                    '.text-editor-textarea'\r\n                ) as HTMLTextAreaElement | null;\r\n            }\r\n\r\n            // Dann den gespeicherten Content laden\r\n            if (this.editor && this.state && typeof (this.state as any).content === 'string') {\r\n                this.editor.value = (this.state as any).content;\r\n                this._updateWordCount();\r\n                this._updateCursorPosition();\r\n            }\r\n        }\r\n\r\n        focus(): void {\r\n            const baseFocus = (Base.prototype as unknown as { focus: () => void }).focus;\r\n            baseFocus.call(this);\r\n            this.editor?.focus();\r\n        }\r\n\r\n        serialize(): Record<string, unknown> {\r\n            const baseSerialize = (\r\n                Base.prototype as unknown as {\r\n                    serialize: () => Record<string, unknown>;\r\n                }\r\n            ).serialize;\r\n            const baseObj = baseSerialize.call(this) as Record<string, unknown>;\r\n            return {\r\n                ...baseObj,\r\n                content: this.editor?.value || '',\r\n                filename: this.currentFilename,\r\n                wrapMode: this.wrapMode,\r\n                isDirty: this.isDirty,\r\n            };\r\n        }\r\n\r\n        deserialize(data: Record<string, unknown>): void {\r\n            const baseDeserialize = (\r\n                Base.prototype as unknown as {\r\n                    deserialize: (d: Record<string, unknown>) => void;\r\n                }\r\n            ).deserialize;\r\n            baseDeserialize.call(this, data);\r\n\r\n            const d = data as {\r\n                content?: string;\r\n                filename?: string;\r\n                wrapMode?: WrapMode;\r\n                isDirty?: boolean;\r\n            };\r\n            if (d.content && this.editor) {\r\n                this.editor.value = d.content;\r\n                this._updateWordCount();\r\n            }\r\n            if (d.filename) this.currentFilename = d.filename;\r\n            if (d.wrapMode) {\r\n                this.wrapMode = d.wrapMode;\r\n                if (this.editor) {\r\n                    this.editor.wrap = this.wrapMode;\r\n                    this.editor.style.whiteSpace = this.wrapMode === 'soft' ? 'pre-wrap' : 'pre';\r\n                }\r\n            }\r\n            if (typeof d.isDirty !== 'undefined') {\r\n                this.isDirty = d.isDirty;\r\n                this._updateSaveButton();\r\n            }\r\n        }\r\n    }\r\n\r\n    (window as unknown as { TextEditorInstance: typeof TextEditorInstance }).TextEditorInstance =\r\n        TextEditorInstance;\r\n\r\n    // Initialize TextEditorInstanceManager\r\n    // This must happen synchronously to ensure it's available for SessionManager.restoreSession()\r\n    const G = window as unknown as Record<string, unknown>;\r\n    type InstanceManagerCtor = new (cfg: Record<string, unknown>) => unknown;\r\n\r\n    const ensureTextEditorInstanceManager = () => {\r\n        if (G['TextEditorInstanceManager']) return true; // Already created\r\n\r\n        const InstanceManager = G['InstanceManager'] as unknown as InstanceManagerCtor | undefined;\r\n        if (!InstanceManager) {\r\n            return false; // InstanceManager not available\r\n        }\r\n\r\n        try {\r\n            (G['TextEditorInstanceManager'] as unknown) =\r\n                new (InstanceManager as InstanceManagerCtor)({\r\n                    type: 'text-editor',\r\n                    instanceClass: TextEditorInstance,\r\n                    maxInstances: 0,\r\n                    createContainer: function (instanceId: string): HTMLElement | null {\r\n                        const editorModalContainer =\r\n                            document.getElementById('text-editor-container');\r\n                        if (!editorModalContainer) {\r\n                            console.error('Text editor container not found');\r\n                            return null;\r\n                        }\r\n                        const container = document.createElement('div');\r\n                        container.id = `${instanceId}-container`;\r\n                        container.className = 'text-editor-instance-container h-full';\r\n                        // Use DOMUtils if available to hide initially, else fallback\r\n                        const domUtils = (\r\n                            window as unknown as { DOMUtils?: { hide?: (el: Element) => void } }\r\n                        ).DOMUtils;\r\n                        if (domUtils && typeof domUtils.hide === 'function') {\r\n                            domUtils.hide(container);\r\n                        } else {\r\n                            container.classList.add('hidden');\r\n                        }\r\n                        editorModalContainer.appendChild(container);\r\n                        return container;\r\n                    },\r\n                });\r\n            console.log('[TextEditorInstance] TextEditorInstanceManager created');\r\n            return true;\r\n        } catch (err) {\r\n            console.error('[TextEditorInstance] Failed to create TextEditorInstanceManager:', err);\r\n            return false;\r\n        }\r\n    };\r\n\r\n    // Try to initialize immediately\r\n    if (!ensureTextEditorInstanceManager()) {\r\n        // If InstanceManager not ready yet, register a deferred initialization\r\n        // that fires right after all modules are loaded\r\n        const initHook = () => {\r\n            if (ensureTextEditorInstanceManager()) {\r\n                // Successfully created\r\n                return;\r\n            }\r\n            // Still not ready, retry after a short delay\r\n            setTimeout(initHook, 100);\r\n        };\r\n\r\n        // Use a microtask to ensure this runs after module initialization\r\n        Promise.resolve().then(initHook);\r\n    }\r\n})();\r\n", "import BaseWindowInstance, { BaseWindowConfig } from './base-window-instance';\r\n\r\n// Access global WindowChrome helper (no module export)\r\ntype WindowWithChrome = {\r\n    WindowChrome?: {\r\n        createTitlebar: (cfg: {\r\n            title?: string;\r\n            icon?: string;\r\n            showClose?: boolean;\r\n            showMinimize?: boolean;\r\n            showMaximize?: boolean;\r\n            onClose?: () => void;\r\n            onMinimize?: () => void;\r\n            onMaximize?: () => void;\r\n        }) => HTMLElement;\r\n        createToolbar: (\r\n            items: Array<{\r\n                type?: 'separator';\r\n                label?: string;\r\n                icon?: string;\r\n                title?: string;\r\n                action?: string;\r\n                onClick?: (e: MouseEvent) => void;\r\n            }>\r\n        ) => HTMLElement;\r\n        createStatusBar: (cfg: { leftContent?: string; rightContent?: string }) => HTMLElement;\r\n    };\r\n};\r\nconst WindowChrome = (window as unknown as WindowWithChrome).WindowChrome!;\r\n\r\nexport interface PreviewWindowState {\r\n    imageUrl?: string;\r\n    repo?: string;\r\n    path?: string;\r\n    dimensions?: string;\r\n    size?: number;\r\n    zoom?: number;\r\n    images?: string[];\r\n    currentIndex?: number;\r\n}\r\n\r\nexport class PreviewWindowInstance extends BaseWindowInstance {\r\n    private keydownListener?: (e: KeyboardEvent) => void;\r\n    private _prevImages: string[] = [];\r\n\r\n    constructor(config: BaseWindowConfig) {\r\n        super(config);\r\n        // Base ctor initializes state; extend with preview defaults\r\n        this.updateState({\r\n            zoom: 1,\r\n            images: [],\r\n            currentIndex: 0,\r\n        });\r\n    }\r\n\r\n    render(): void {\r\n        if (!this.container) return;\r\n        this.container.innerHTML = '';\r\n        const titlebar = WindowChrome.createTitlebar({\r\n            title: this.title,\r\n            icon: './img/preview.png',\r\n            showClose: true,\r\n            showMinimize: true,\r\n            showMaximize: false,\r\n            onClose: () => this.destroy(),\r\n        });\r\n        this.container.appendChild(titlebar);\r\n\r\n        // Toolbar\r\n        const toolbar = WindowChrome.createToolbar([\r\n            { label: 'Zoom In', icon: '\uD83D\uDD0D+', onClick: () => this.zoomIn() },\r\n            { label: 'Zoom Out', icon: '\uD83D\uDD0D-', onClick: () => this.zoomOut() },\r\n            { type: 'separator' },\r\n            { label: 'Previous', icon: '\u2B05\uFE0F', onClick: () => this.prevImage() },\r\n            { label: 'Next', icon: '\u27A1\uFE0F', onClick: () => this.nextImage() },\r\n        ]);\r\n        this.container.appendChild(toolbar);\r\n\r\n        // Image area\r\n        const imageArea = document.createElement('div');\r\n        imageArea.className = 'preview-image-area flex justify-center items-center';\r\n        imageArea.style.height = 'calc(100% - 80px)';\r\n        imageArea.style.position = 'relative';\r\n        imageArea.ondrop = e => this.handleDrop(e);\r\n        imageArea.ondragover = e => e.preventDefault();\r\n\r\n        const st = this.getState() as unknown as PreviewWindowState;\r\n        const images = st.images || [];\r\n        const idx = st.currentIndex ?? 0;\r\n\r\n        // Revoke previous blob URLs that are no longer used\r\n        try {\r\n            const prev = this._prevImages || [];\r\n            const removed = prev.filter(p => p && p.startsWith('blob:') && !images.includes(p));\r\n            removed.forEach(u => {\r\n                try {\r\n                    URL.revokeObjectURL(u);\r\n                } catch (e) {}\r\n            });\r\n        } catch (e) {}\r\n\r\n        if (images.length > 0 && images[idx]) {\r\n            const img = document.createElement('img');\r\n            img.src = images[idx];\r\n            img.style.maxWidth = '100%';\r\n            img.style.maxHeight = '100%';\r\n            img.style.transform = `scale(${st.zoom ?? 1})`;\r\n            img.style.display = 'block';\r\n            img.style.visibility = 'hidden';\r\n            img.draggable = true;\r\n            img.addEventListener('contextmenu', e => this.showContextMenu(e));\r\n            img.addEventListener('load', () => {\r\n                img.style.visibility = 'visible';\r\n                img.style.opacity = '1';\r\n            });\r\n            img.addEventListener('error', () => {\r\n                /* ignore image load errors for now */\r\n            });\r\n            imageArea.appendChild(img);\r\n        } else {\r\n            // Placeholder UI\r\n            const placeholder = document.createElement('div');\r\n            placeholder.className = 'text-gray-500 dark:text-gray-400 text-center px-6';\r\n            placeholder.textContent = 'No image selected';\r\n            imageArea.appendChild(placeholder);\r\n        }\r\n        this.container.appendChild(imageArea);\r\n\r\n        // Store images to allow revoking blob URLs on next render/destroy\r\n        this._prevImages = images.slice();\r\n\r\n        // Statusbar\r\n        const counter = images.length > 0 ? `${idx + 1} / ${images.length}` : '';\r\n        const statusBar = WindowChrome.createStatusBar({\r\n            leftContent: st.path || '',\r\n            rightContent: `Zoom: ${Math.round((st.zoom || 1) * 100)}% ${counter}`,\r\n        });\r\n        this.container.appendChild(statusBar);\r\n\r\n        // Keyboard shortcuts\r\n        this.attachKeyboardShortcuts();\r\n    }\r\n\r\n    attachKeyboardShortcuts() {\r\n        // Remove previous listener to avoid duplicates\r\n        if (this.keydownListener) {\r\n            document.removeEventListener('keydown', this.keydownListener);\r\n        }\r\n        this.keydownListener = (e: KeyboardEvent) => {\r\n            if (!this.isVisible) return;\r\n            if (e.key === 'ArrowLeft') {\r\n                e.preventDefault();\r\n                this.prevImage();\r\n            } else if (e.key === 'ArrowRight') {\r\n                e.preventDefault();\r\n                this.nextImage();\r\n            }\r\n        };\r\n        document.addEventListener('keydown', this.keydownListener);\r\n    }\r\n\r\n    zoomIn() {\r\n        const st = this.getState() as unknown as PreviewWindowState;\r\n        this.updateState({ zoom: Math.min((st.zoom || 1) + 0.1, 3) });\r\n        this.render();\r\n    }\r\n    zoomOut() {\r\n        const st = this.getState() as unknown as PreviewWindowState;\r\n        this.updateState({ zoom: Math.max((st.zoom || 1) - 0.1, 0.2) });\r\n        this.render();\r\n    }\r\n    nextImage() {\r\n        const st = this.getState() as unknown as PreviewWindowState;\r\n        const images = st.images || [];\r\n        if (images.length === 0) return;\r\n        const next = ((st.currentIndex ?? 0) + 1) % images.length;\r\n        this.updateState({ currentIndex: next });\r\n        this.render();\r\n    }\r\n    prevImage() {\r\n        const st = this.getState() as unknown as PreviewWindowState;\r\n        const images = st.images || [];\r\n        if (images.length === 0) return;\r\n        const prev = ((st.currentIndex ?? 0) - 1 + images.length) % images.length;\r\n        this.updateState({ currentIndex: prev });\r\n        this.render();\r\n    }\r\n    handleDrop(e: DragEvent) {\r\n        e.preventDefault();\r\n        const files = e.dataTransfer?.files;\r\n        if (files && files.length > 0 && files[0]) {\r\n            const url = URL.createObjectURL(files[0]);\r\n            this.updateState({ images: [url], currentIndex: 0 });\r\n            this.render();\r\n        }\r\n    }\r\n    showContextMenu(e: MouseEvent) {\r\n        e.preventDefault();\r\n        // TODO: Implement custom context menu (copy, save, open in new tab)\r\n    }\r\n    destroy() {\r\n        // Clean up keyboard listener before base destroy\r\n        if (this.keydownListener) {\r\n            document.removeEventListener('keydown', this.keydownListener);\r\n        }\r\n        // Revoke any remaining blob URLs we previously created\r\n        try {\r\n            (this._prevImages || []).forEach(u => {\r\n                if (u && u.startsWith('blob:')) {\r\n                    try {\r\n                        URL.revokeObjectURL(u);\r\n                    } catch (e) {}\r\n                }\r\n            });\r\n        } catch (e) {}\r\n\r\n        super.destroy();\r\n    }\r\n}\r\n\r\n// Attach to window (avoid any)\r\ntype WindowWithPreview = { PreviewWindowInstance?: typeof PreviewWindowInstance };\r\n(window as unknown as WindowWithPreview).PreviewWindowInstance = PreviewWindowInstance;\r\nexport default PreviewWindowInstance;\r\n", "import PreviewWindowInstance, { PreviewWindowState } from './preview-window-instance';\r\n\r\nexport class PreviewInstanceManager {\r\n    static type = 'preview';\r\n    static instances: Map<string, PreviewWindowInstance> = new Map();\r\n    static instanceCounter = 0;\r\n    static singletonId = 'preview-single';\r\n\r\n    static createInstance(config: Partial<PreviewWindowState> = {}): PreviewWindowInstance {\r\n        this.instanceCounter++;\r\n        const instanceId = `${this.type}-${this.instanceCounter}`;\r\n        const instance = new PreviewWindowInstance({\r\n            id: instanceId,\r\n            type: this.type,\r\n            title: config.path ? `Preview: ${config.path}` : 'Preview',\r\n            initialState: config,\r\n        });\r\n        this.instances.set(instanceId, instance);\r\n        return instance;\r\n    }\r\n\r\n    /** Ensure a single initialized instance attached to #preview-container */\r\n    static getOrCreateSingleton(): PreviewWindowInstance | null {\r\n        const existing = this.instances.get(this.singletonId);\r\n        if (existing && (existing as any).isInitialized) return existing;\r\n        const containerRoot = document.getElementById('preview-container');\r\n        if (!containerRoot) {\r\n            console.error('Preview container #preview-container not found');\r\n            return null;\r\n        }\r\n        // Create/ensure inner container for the instance\r\n        let instContainer = containerRoot.querySelector(\r\n            '#preview-instance-container'\r\n        ) as HTMLElement | null;\r\n        if (!instContainer) {\r\n            instContainer = document.createElement('div');\r\n            instContainer.id = 'preview-instance-container';\r\n            instContainer.className = 'h-full flex flex-col min-h-0';\r\n            containerRoot.appendChild(instContainer);\r\n        }\r\n        const instance = new PreviewWindowInstance({\r\n            id: this.singletonId,\r\n            type: this.type,\r\n            title: 'Preview',\r\n            initialState: { images: [], currentIndex: 0, zoom: 1 },\r\n        });\r\n        try {\r\n            instance.init(instContainer);\r\n        } catch (e) {\r\n            console.error('Failed to initialize Preview instance:', e);\r\n            return null;\r\n        }\r\n        this.instances.set(this.singletonId, instance);\r\n        return instance;\r\n    }\r\n\r\n    /** Open a list of images in the Preview (ensures modal and instance) */\r\n    static openImages(images: string[], startIndex = 0, path?: string): void {\r\n        if (!Array.isArray(images) || images.length === 0) return;\r\n        // Open preview modal first (if WindowManager / Dialog API is available)\r\n        try {\r\n            const W = window as unknown as Window & { API?: any; WindowManager?: any };\r\n            if (W.API?.window?.open) W.API.window.open('preview-modal');\r\n            else W.WindowManager?.open?.('preview-modal');\r\n        } catch {}\r\n\r\n        // Ensure the preview container is visible so headless tests can detect the image\r\n        try {\r\n            const containerRoot = document.getElementById('preview-container');\r\n            if (containerRoot) {\r\n                const domUtils = (window as any).DOMUtils;\r\n                if (domUtils && typeof domUtils.show === 'function') {\r\n                    domUtils.show(containerRoot);\r\n                } else {\r\n                    containerRoot.classList.remove('hidden');\r\n                }\r\n                containerRoot.style.pointerEvents = 'auto';\r\n            }\r\n        } catch (_) {\r\n            /* ignore */\r\n        }\r\n\r\n        const instance = this.getOrCreateSingleton();\r\n        if (!instance) return;\r\n        const idx = Math.max(0, Math.min(startIndex, images.length - 1));\r\n        instance.updateState({ images, currentIndex: idx, path: path || undefined });\r\n        instance.render();\r\n        // Ensure visible\r\n        (instance as any).show?.();\r\n    }\r\n\r\n    static getInstance(instanceId: string): PreviewWindowInstance | undefined {\r\n        return this.instances.get(instanceId);\r\n    }\r\n\r\n    static destroyInstance(instanceId: string): void {\r\n        const instance = this.instances.get(instanceId);\r\n        if (instance) {\r\n            instance.destroy();\r\n            this.instances.delete(instanceId);\r\n        }\r\n    }\r\n\r\n    static destroyAll(): void {\r\n        this.instances.forEach(instance => instance.destroy());\r\n        this.instances.clear();\r\n    }\r\n}\r\n\r\ntype WindowWithPreviewMgr = { PreviewInstanceManager?: typeof PreviewInstanceManager };\r\n(window as unknown as WindowWithPreviewMgr).PreviewInstanceManager = PreviewInstanceManager;\r\nexport default PreviewInstanceManager;\r\n", "/**\r\n * src/ts/finder-view.ts\r\n * FinderView \u2013 Ein Tab-Typ innerhalb eines Finder-Fensters.\r\n *\r\n * Verantwortlichkeiten\r\n * --------------------\r\n * - Stellt die UI der Dateiansicht bereit (Sidebar, Toolbar, Breadcrumbs, Content).\r\n * - H\u00E4lt lokalen Zustand pro Tab (Quelle/Path, ViewMode, Sortierung, Favoriten, Recent Files).\r\n * - Aktualisiert den Tab\u2011Titel dynamisch, sodass immer der aktuelle Ordner/Context\r\n *   im Tab\u2011Label sichtbar ist.\r\n * - GitHub\u2011Integration: Repositories und deren Inhalte werden mit leichter Caching\u2011Schicht\r\n *   geladen (sowohl \u00FCber interne Map als auch bevorzugt \u00FCber GitHubAPI\u2011Cache, falls vorhanden).\r\n *\r\n * Zusammenspiel mit BaseWindow\r\n * ----------------------------\r\n * - Der FinderWindow\u2011Container rendert die Tab-Leiste via WindowTabs und verwaltet mehrere\r\n *   FinderView\u2011Instanzen (Multi\u2011Tab in einem Fenster \u2013 oder verteilt auf mehrere Fenster).\r\n * - FinderView ruft bei relevanten \u00C4nderungen _persistState() auf, was den Window\u2011State\r\n *   speichert; die Session enth\u00E4lt so alle offenen Finder\u2011Tabs inklusive Pfad/Ansicht.\r\n */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport { BaseTab, type TabConfig } from '../../windows/base-tab.js';\r\nimport { VirtualFS } from '../../services/virtual-fs.js';\r\nimport PreviewInstanceManager from '../../windows/preview-instance-manager.js';\r\n\r\nconst ROOT_FOLDER_NAME = 'Computer';\r\n\r\ntype ViewMode = 'list' | 'grid';\r\n\r\ninterface FileItem {\r\n    name: string;\r\n    type: 'folder' | 'file';\r\n    icon?: string;\r\n    size?: number;\r\n    modified?: string;\r\n    path?: string; // Full path for recent files navigation\r\n}\r\n\r\ninterface RecentFile {\r\n    name: string;\r\n    path: string;\r\n    icon: string;\r\n    modified: string;\r\n}\r\n\r\ntype FinderSource = 'computer' | 'github' | 'recent' | 'starred';\r\n\r\nexport class FinderView extends BaseTab {\r\n    source: FinderSource;\r\n    currentPath: string[];\r\n    viewMode: ViewMode;\r\n    sortBy: 'name' | 'date' | 'size' | 'type';\r\n    sortOrder: 'asc' | 'desc';\r\n    selectedItems: Set<string>;\r\n    _renderedItems: FileItem[];\r\n    _eventHandlersAttached: boolean;\r\n    sidebarWidth: number;\r\n\r\n    // Favorites and Recent Files\r\n    favorites: Set<string>;\r\n    recentFiles: RecentFile[];\r\n    maxRecentFiles: number;\r\n\r\n    // Search\r\n    searchTerm: string;\r\n\r\n    // GitHub Content Cache\r\n    githubContentCache: Map<string, { data: any; timestamp: number }>;\r\n    cacheTTL: number;\r\n\r\n    dom: {\r\n        toolbar: HTMLElement | null;\r\n        breadcrumbs: HTMLElement | null;\r\n        content: HTMLElement | null;\r\n        viewListBtn: HTMLButtonElement | null;\r\n        viewGridBtn: HTMLButtonElement | null;\r\n        sidebar: HTMLElement | null;\r\n        resizer: HTMLElement | null;\r\n    };\r\n\r\n    githubRepos: any[];\r\n    githubError = false;\r\n    githubErrorMessage = '';\r\n    lastGithubItemsMap: Map<string, any>;\r\n\r\n    // Track scroll position to restore after file open/close\r\n    private _savedScrollPosition = 0;\r\n\r\n    constructor(config?: Partial<TabConfig> & { source?: FinderSource }) {\r\n        super({\r\n            type: 'finder-view',\r\n            title: config?.title || 'Computer',\r\n            icon: '\uD83D\uDCBB',\r\n            ...config,\r\n        });\r\n\r\n        this.source = config?.source || 'computer';\r\n        this.currentPath = [];\r\n        this.viewMode = 'list';\r\n        this.sortBy = 'name';\r\n        this.sortOrder = 'asc';\r\n        this.selectedItems = new Set();\r\n        this._renderedItems = [];\r\n        this._eventHandlersAttached = false;\r\n        this.sidebarWidth = config?.content?.sidebarWidth ?? 192; // default 12rem\r\n\r\n        this.githubRepos = [];\r\n        this.lastGithubItemsMap = new Map();\r\n\r\n        // Initialize Favorites from saved state\r\n        const savedFavorites = config?.content?.favorites || [];\r\n        this.favorites = new Set(savedFavorites);\r\n\r\n        // Load recent files from global storage (shared across all tabs/windows)\r\n        this.recentFiles = FinderView.loadRecentFiles();\r\n        this.maxRecentFiles = FinderView.MAX_RECENT_FILES;\r\n\r\n        // Initialize Search\r\n        this.searchTerm = '';\r\n\r\n        // Initialize GitHub Cache\r\n        this.githubContentCache = new Map();\r\n        this.cacheTTL = 5 * 60 * 1000; // 5 minutes\r\n\r\n        this.dom = {\r\n            toolbar: null,\r\n            breadcrumbs: null,\r\n            content: null,\r\n            viewListBtn: null,\r\n            viewGridBtn: null,\r\n            sidebar: null,\r\n            resizer: null,\r\n        };\r\n    }\r\n\r\n    createDOM(): HTMLElement {\r\n        const container = document.createElement('div');\r\n        container.id = `${this.id}-container`;\r\n        container.className = 'tab-content hidden w-full h-full flex flex-col min-h-0';\r\n\r\n        const isGithub = this.source === 'github';\r\n        container.innerHTML = `\r\n            <div class=\"flex-1 flex gap-0 min-h-0 min-w-0 overflow-hidden\">\r\n                <aside id=\"finder-sidebar\" class=\"shrink-0 bg-gray-50 dark:bg-gray-900 border-r border-gray-200 dark:border-gray-700 overflow-y-auto\" style=\"width: ${this.sidebarWidth}px;\">\r\n                    <div class=\"py-2\">\r\n                        <div class=\"px-3 py-1 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide\" data-i18n=\"finder.sidebar.favorites\">FAVORITEN</div>\r\n                        <button class=\"finder-sidebar-item\" id=\"finder-sidebar-home\" data-sidebar-action=\"home\">\r\n                            <span class=\"finder-sidebar-icon\">\uD83C\uDFE0</span>\r\n                            <span data-i18n=\"finder.sidebar.home\">Home</span>\r\n                        </button>\r\n                        <button class=\"finder-sidebar-item finder-sidebar-active\" id=\"finder-sidebar-computer\" data-sidebar-action=\"computer\">\r\n                            <span class=\"finder-sidebar-icon\">\uD83D\uDCBB</span>\r\n                            <span data-i18n=\"finder.sidebar.computer\">Computer</span>\r\n                        </button>\r\n                        <button class=\"finder-sidebar-item\" id=\"finder-sidebar-recent\" data-sidebar-action=\"recent\">\r\n                            <span class=\"finder-sidebar-icon\">\uD83D\uDD52</span>\r\n                            <span data-i18n=\"finder.sidebar.recent\">Zuletzt verwendet</span>\r\n                        </button>\r\n                        <div class=\"px-3 py-1 mt-4 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide\" data-i18n=\"finder.sidebar.locations\">ORTE</div>\r\n                        <button class=\"finder-sidebar-item\" id=\"finder-sidebar-github\" data-sidebar-action=\"github\">\r\n                            <span class=\"finder-sidebar-icon\">\uD83D\uDCC2</span>\r\n                            <span data-i18n=\"finder.sidebar.github\">GitHub Projekte</span>\r\n                        </button>\r\n                        <button class=\"finder-sidebar-item\" id=\"finder-sidebar-starred\" data-sidebar-action=\"starred\">\r\n                            <span class=\"finder-sidebar-icon\">\u2B50</span>\r\n                            <span data-i18n=\"finder.sidebar.starred\">Markiert</span>\r\n                        </button>\r\n                    </div>\r\n                </aside>\r\n                <div class=\"finder-resizer shrink-0 w-1 md:w-1.5 bg-gray-200 dark:bg-gray-700 hover:bg-blue-400 cursor-col-resize\" role=\"separator\" aria-orientation=\"vertical\" title=\"Gr\u00F6\u00DFe \u00E4ndern\"></div>\r\n                <div class=\"flex-1 flex flex-col min-h-0 min-w-0\">\r\n                    <div class=\"finder-toolbar px-4 py-2 border-b border-gray-200 dark:border-gray-700 flex items-center gap-2\">\r\n                        <!-- Back / Root like old Finder -->\r\n                        <button class=\"finder-toolbar-btn\" data-action=\"navigate-up\" data-i18n-title=\"finder.toolbar.back\" title=\"Zur\u00FCck\">\r\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M19 12H5M12 19l-7-7 7-7\" /></svg>\r\n                        </button>\r\n                        <button class=\"finder-toolbar-btn\" data-action=\"navigate-root\" data-i18n-title=\"finder.toolbar.forward\" title=\"Nach vorn\">\r\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M5 12h14M12 5l7 7-7 7\" /></svg>\r\n                        </button>\r\n                        <!-- Breadcrumbs centered/left grow -->\r\n                        <div class=\"flex-1 mx-2 min-w-0\">\r\n                            <div class=\"breadcrumbs text-sm text-gray-600 dark:text-gray-400 flex items-center gap-1 overflow-hidden\"></div>\r\n                        </div>\r\n                        <!-- Optional: sort menu next to view controls -->\r\n                        <div class=\"relative hidden md:block\">\r\n                            <button class=\"finder-toolbar-btn\" data-action=\"toggle-sort\" title=\"Sortierung\">\u21C5</button>\r\n                            <div class=\"finder-sort-menu hidden absolute right-0 mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded shadow-lg z-10\" style=\"width: 180px;\">\r\n                                <button class=\"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700\" data-sort=\"name\" data-i18n=\"context.finder.sortByName\">Nach Name</button>\r\n                                <button class=\"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700\" data-sort=\"date\" data-i18n=\"context.finder.sortByDate\">Nach Datum</button>\r\n                                <button class=\"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700\" data-sort=\"size\" data-i18n=\"context.finder.sortBySize\">Nach Gr\u00F6\u00DFe</button>\r\n                                <div class=\"border-t border-gray-200 dark:border-gray-700 my-1\"></div>\r\n                                <button class=\"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700\" data-order=\"asc\">\u2191 Aufsteigend</button>\r\n                                <button class=\"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700\" data-order=\"desc\">\u2193 Absteigend</button>\r\n                            </div>\r\n                        </div>\r\n                        <button class=\"finder-toolbar-btn\" data-action=\"toggle-favorite\" title=\"Zu Favoriten\" style=\"display: none;\">\u2B50</button>\r\n                        <div class=\"flex gap-1\">\r\n                            <button class=\"finder-toolbar-btn\" data-action=\"view-list\" data-i18n-title=\"finder.toolbar.listView\" title=\"Listenansicht\">\r\n                                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M3 4h18v2H3V4m0 7h18v2H3v-2m0 7h18v2H3v-2Z\" /></svg>\r\n                            </button>\r\n                            <button class=\"finder-toolbar-btn\" data-action=\"view-grid\" data-i18n-title=\"finder.toolbar.gridView\" title=\"Rasteransicht\">\r\n                                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M3 3h8v8H3V3m10 0h8v8h-8V3M3 13h8v8H3v-8m10 0h8v8h-8v-8Z\" /></svg>\r\n                            </button>\r\n                        </div>\r\n                        <input type=\"text\" class=\"finder-search px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 flex-shrink-0 w-28 sm:w-40 md:w-56 lg:w-72 xl:w-80\" data-i18n-placeholder=\"finder.toolbar.search\" placeholder=\"Suchen\" />\r\n                    </div>\r\n                    <div class=\"finder-content flex-1 overflow-auto bg-white dark:bg-gray-800 min-w-0\" data-finder-content></div>\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        this.element = container;\r\n        this.dom.toolbar = container.querySelector('.finder-toolbar');\r\n        this.dom.breadcrumbs = container.querySelector('.breadcrumbs');\r\n        this.dom.content = container.querySelector('.finder-content');\r\n        this.dom.sidebar = container.querySelector('#finder-sidebar');\r\n        this.dom.resizer = container.querySelector('.finder-resizer');\r\n        this.dom.viewListBtn = null;\r\n        this.dom.viewGridBtn = null;\r\n\r\n        // Toolbar/Sidebar/Content Interaktionen anbinden\r\n        this._attachEvents();\r\n        this._attachSidebarEvents();\r\n        this._attachResizeHandlers();\r\n        this._setupContentEventHandlers();\r\n        this._renderAll();\r\n\r\n        // Apply i18n translations\r\n        const w = window as any;\r\n        if (w.appI18n) {\r\n            w.appI18n.applyTranslations(container);\r\n        }\r\n\r\n        return container;\r\n    }\r\n\r\n    private _attachResizeHandlers(): void {\r\n        const sidebar = this.dom.sidebar;\r\n        const resizer = this.dom.resizer;\r\n        const contentArea = this.element?.querySelector(\r\n            '.flex-1.flex.gap-0.min-h-0.overflow-hidden'\r\n        ) as HTMLElement | null;\r\n        if (!sidebar || !resizer) return;\r\n\r\n        const minWidth = 160; // px\r\n        const maxWidth = 480; // px\r\n\r\n        let startX = 0;\r\n        let startWidth = 0;\r\n        let dragging = false;\r\n\r\n        const onMouseMove = (e: MouseEvent) => {\r\n            if (!dragging) return;\r\n            const dx = e.clientX - startX;\r\n            let newWidth = Math.max(minWidth, Math.min(startWidth + dx, maxWidth));\r\n\r\n            // Also ensure there's room for content (min 360px)\r\n            const container = this.element as HTMLElement;\r\n            if (container) {\r\n                const total = container.clientWidth;\r\n                const minContent = 360;\r\n                newWidth = Math.min(newWidth, Math.max(total - minContent, minWidth));\r\n            }\r\n\r\n            sidebar.style.width = `${newWidth}px`;\r\n            this.sidebarWidth = newWidth;\r\n        };\r\n\r\n        const stopDragging = () => {\r\n            if (!dragging) return;\r\n            dragging = false;\r\n            document.removeEventListener('mousemove', onMouseMove);\r\n            document.removeEventListener('mouseup', stopDragging);\r\n            document.body.classList.remove('select-none');\r\n            this._persistState();\r\n        };\r\n\r\n        resizer.addEventListener('mousedown', (e: MouseEvent) => {\r\n            e.preventDefault();\r\n            dragging = true;\r\n            startX = e.clientX;\r\n            startWidth = sidebar.getBoundingClientRect().width;\r\n            document.addEventListener('mousemove', onMouseMove);\r\n            document.addEventListener('mouseup', stopDragging);\r\n            document.body.classList.add('select-none');\r\n        });\r\n    }\r\n\r\n    private _attachEvents(): void {\r\n        if (!this.element) return;\r\n        const upBtn = this.element.querySelector<HTMLButtonElement>('[data-action=\"navigate-up\"]');\r\n        const rootBtn = this.element.querySelector<HTMLButtonElement>(\r\n            '[data-action=\"navigate-root\"]'\r\n        );\r\n        const listBtn = this.element.querySelector<HTMLButtonElement>('[data-action=\"view-list\"]');\r\n        const gridBtn = this.element.querySelector<HTMLButtonElement>('[data-action=\"view-grid\"]');\r\n        const searchInput = this.element.querySelector<HTMLInputElement>('.finder-search');\r\n        const sortToggleBtn = this.element.querySelector<HTMLButtonElement>(\r\n            '[data-action=\"toggle-sort\"]'\r\n        );\r\n        const sortMenu = this.element.querySelector<HTMLElement>('.finder-sort-menu');\r\n        const favoriteBtn = this.element.querySelector<HTMLButtonElement>(\r\n            '[data-action=\"toggle-favorite\"]'\r\n        );\r\n\r\n        upBtn?.addEventListener('click', () => this.navigateUp());\r\n        rootBtn?.addEventListener('click', () => this.goRoot());\r\n        listBtn?.addEventListener('click', () => this.setViewMode('list'));\r\n        gridBtn?.addEventListener('click', () => this.setViewMode('grid'));\r\n\r\n        // Search input\r\n        searchInput?.addEventListener('input', e => {\r\n            this.searchTerm = (e.target as HTMLInputElement).value;\r\n            this.renderContent();\r\n        });\r\n\r\n        // Sort menu toggle\r\n        sortToggleBtn?.addEventListener('click', () => {\r\n            sortMenu?.classList.toggle('hidden');\r\n        });\r\n\r\n        // Sort menu items\r\n        sortMenu?.querySelectorAll<HTMLButtonElement>('[data-sort]').forEach(btn => {\r\n            btn.addEventListener('click', () => {\r\n                const sortBy = btn.dataset.sort as 'name' | 'date' | 'size' | 'type';\r\n                this.setSortBy(sortBy);\r\n                sortMenu.classList.add('hidden');\r\n            });\r\n        });\r\n\r\n        sortMenu?.querySelectorAll<HTMLButtonElement>('[data-order]').forEach(btn => {\r\n            btn.addEventListener('click', () => {\r\n                const order = btn.dataset.order as 'asc' | 'desc';\r\n                this.setSortOrder(order);\r\n                sortMenu.classList.add('hidden');\r\n            });\r\n        });\r\n\r\n        // Close sort menu when clicking outside\r\n        document.addEventListener('click', e => {\r\n            if (\r\n                !sortToggleBtn?.contains(e.target as Node) &&\r\n                !sortMenu?.contains(e.target as Node)\r\n            ) {\r\n                sortMenu?.classList.add('hidden');\r\n            }\r\n        });\r\n\r\n        // Favorite toggle\r\n        favoriteBtn?.addEventListener('click', () => {\r\n            if (this.currentPath.length > 0) {\r\n                this.toggleFavorite(this.currentPath.join('/'));\r\n            }\r\n        });\r\n    }\r\n\r\n    private _attachSidebarEvents(): void {\r\n        if (!this.element) return;\r\n\r\n        // Sidebar navigation\r\n        const sidebarButtons =\r\n            this.element.querySelectorAll<HTMLButtonElement>('[data-sidebar-action]');\r\n        sidebarButtons.forEach(btn => {\r\n            btn.addEventListener('click', () => {\r\n                const action = btn.dataset.sidebarAction;\r\n\r\n                // Handle action\r\n                if (action === 'home') {\r\n                    this.source = 'computer';\r\n                    this.currentPath = ['home', 'marvin'];\r\n                    this._persistState();\r\n                    this._renderAll();\r\n                } else if (action === 'computer') {\r\n                    this.source = 'computer';\r\n                    this.goRoot();\r\n                } else if (action === 'github') {\r\n                    this.source = 'github';\r\n                    this.goRoot();\r\n                } else if (action === 'recent') {\r\n                    this.source = 'recent';\r\n                    this.goRoot();\r\n                } else if (action === 'starred') {\r\n                    this.source = 'starred';\r\n                    this.goRoot();\r\n                }\r\n\r\n                // Stelle sicher, dass das aktive Highlight dem finalen Zustand entspricht\r\n                this._updateSidebarActiveHighlight();\r\n            });\r\n        });\r\n    }\r\n\r\n    private _setupContentEventHandlers(): void {\r\n        if (this._eventHandlersAttached) {\r\n            return;\r\n        }\r\n        // Delegation f\u00FCr Klick/Double\u2011Klick auf List/Grid\u2011Items\r\n        const resolveItemEl = (evt: Event): HTMLElement | null => {\r\n            const node = evt.target as Node | null;\r\n            let el: Element | null = null;\r\n            if (node && (node as Element).closest) {\r\n                el = (node as Element).closest('[data-item-index]');\r\n            } else if (node && (node as any).parentElement) {\r\n                el = ((node as any).parentElement as Element).closest('[data-item-index]');\r\n            }\r\n            return el as HTMLElement | null;\r\n        };\r\n\r\n        this.dom.content?.addEventListener('click', e => {\r\n            const itemEl = resolveItemEl(e);\r\n            if (!itemEl) return;\r\n            const idx = parseInt(itemEl.dataset.itemIndex || '-1', 10);\r\n            const item = this._renderedItems[idx];\r\n            if (!item) return;\r\n            this._selectItem(item.name);\r\n        });\r\n        this.dom.content?.addEventListener('dblclick', e => {\r\n            const itemEl = resolveItemEl(e);\r\n            if (!itemEl) return;\r\n            const idx = parseInt(itemEl.dataset.itemIndex || '-1', 10);\r\n            const item = this._renderedItems[idx];\r\n            if (!item) return;\r\n            void this.openItem(item.name, item.type);\r\n        });\r\n        this._eventHandlersAttached = true;\r\n    }\r\n\r\n    private _renderAll(): void {\r\n        // Save scroll position before re-rendering\r\n        this._saveScrollPosition();\r\n\r\n        this.renderBreadcrumbs();\r\n        this.renderContent();\r\n        this._updateSidebarActiveHighlight();\r\n\r\n        // Restore scroll position after re-rendering with multiple attempts\r\n        // to ensure it works even with async rendering\r\n        this._restoreScrollPosition();\r\n        requestAnimationFrame(() => {\r\n            this._restoreScrollPosition();\r\n        });\r\n        // Additional delayed restore for reliability\r\n        setTimeout(() => {\r\n            this._restoreScrollPosition();\r\n        }, 0);\r\n    }\r\n\r\n    renderBreadcrumbs(): void {\r\n        if (!this.dom.breadcrumbs) return;\r\n        // Ensure the tab title reflects the current folder/view\r\n        this._updateTabLabel();\r\n        const parts: string[] = [];\r\n        const viewLabel = this.source === 'github' ? 'GitHub' : 'Computer';\r\n        parts.push(\r\n            `<button class=\"finder-breadcrumb-item\" data-action=\"goRoot\">${viewLabel}</button>`\r\n        );\r\n        this.currentPath.forEach((part, index) => {\r\n            if (this.source === 'computer' && index === 0 && part === ROOT_FOLDER_NAME) return;\r\n            const pathUpToHere = this.currentPath.slice(0, index + 1).join('/');\r\n            parts.push('<span class=\"finder-breadcrumb-separator\">\u203A</span>');\r\n            parts.push(\r\n                `<button class=\"finder-breadcrumb-item\" data-action=\"goto\" data-path=\"${pathUpToHere}\">${part}</button>`\r\n            );\r\n        });\r\n        this.dom.breadcrumbs.innerHTML = parts.join('');\r\n        this.dom.breadcrumbs\r\n            .querySelectorAll<HTMLButtonElement>('button[data-action=\"goto\"]')\r\n            .forEach(btn => {\r\n                btn.addEventListener('click', () => {\r\n                    const path = btn.dataset.path || '';\r\n                    const parts = path.split('/').filter(Boolean);\r\n                    this.navigateToPath(parts);\r\n                });\r\n            });\r\n        const rootBtn = this.dom.breadcrumbs.querySelector<HTMLButtonElement>(\r\n            'button[data-action=\"goRoot\"]'\r\n        );\r\n        if (rootBtn) rootBtn.addEventListener('click', () => this.goRoot());\r\n    }\r\n\r\n    /**\r\n     * Synchronisiert den aktiven Sidebar-Eintrag mit der aktuellen Quelle/Route.\r\n     * Regeln:\r\n     * - source=github \u2192 GitHub aktiv\r\n     * - source=recent \u2192 Zuletzt verwendet aktiv\r\n     * - source=starred \u2192 Markiert aktiv\r\n     * - source=computer \u2192 Wenn Pfad mit 'home' beginnt \u2192 Home aktiv, sonst Computer\r\n     */\r\n    private _updateSidebarActiveHighlight(): void {\r\n        if (!this.element) return;\r\n\r\n        const sidebarButtons = this.element.querySelectorAll<HTMLElement>('[data-sidebar-action]');\r\n        sidebarButtons.forEach(b => b.classList.remove('finder-sidebar-active'));\r\n\r\n        let toActivate: string | null = null;\r\n        switch (this.source) {\r\n            case 'github':\r\n                toActivate = '#finder-sidebar-github';\r\n                break;\r\n            case 'recent':\r\n                toActivate = '#finder-sidebar-recent';\r\n                break;\r\n            case 'starred':\r\n                toActivate = '#finder-sidebar-starred';\r\n                break;\r\n            case 'computer':\r\n            default: {\r\n                const atHome = this.currentPath.length > 0 && this.currentPath[0] === 'home';\r\n                toActivate = atHome ? '#finder-sidebar-home' : '#finder-sidebar-computer';\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (toActivate) {\r\n            const el = this.element.querySelector(toActivate);\r\n            el?.classList.add('finder-sidebar-active');\r\n        }\r\n    }\r\n\r\n    renderContent(): void {\r\n        if (!this.dom.content) return;\r\n\r\n        let items: FileItem[] = [];\r\n\r\n        if (this.source === 'github') {\r\n            // GitHub wird asynchron gerendert, da ggf. Netzwerk/Caches betroffen sind\r\n            void this.renderGithubContent();\r\n            return;\r\n        } else if (this.source === 'recent') {\r\n            items = this.getRecentItems();\r\n        } else if (this.source === 'starred') {\r\n            items = this.getFavoriteItems();\r\n        } else {\r\n            items = this.getComputerItems();\r\n        }\r\n\r\n        // Apply search filter\r\n        const filtered = this.filterItems(items, this.searchTerm);\r\n\r\n        // Sort only if not in recent view (recent items are already sorted by date, newest first)\r\n        const sorted = this.source === 'recent' ? filtered : this.sortItems(filtered);\r\n\r\n        switch (this.viewMode) {\r\n            case 'list':\r\n                this.renderListView(sorted);\r\n                break;\r\n            case 'grid':\r\n                this.renderGridView(sorted);\r\n                break;\r\n        }\r\n    }\r\n\r\n    getComputerItems(): FileItem[] {\r\n        // VirtualFS root is '/'; currentPath is relative to /\r\n        // For root, pass '/' or [] to VirtualFS.list()\r\n        // For subfolders, pass path parts WITHOUT leading '/'\r\n        const path = this.currentPath.length === 0 ? '/' : this.currentPath;\r\n        const items = VirtualFS.list(path);\r\n        return Object.entries(items).map(([name, item]: [string, any]) => ({\r\n            name,\r\n            type: item.type as 'folder' | 'file',\r\n            icon: item.icon || (item.type === 'folder' ? '\uD83D\uDCC1' : '\uD83D\uDCC4'),\r\n            size: item.size || 0,\r\n            modified: item.modified || new Date().toISOString(),\r\n        }));\r\n    }\r\n\r\n    sortItems(items: FileItem[]): FileItem[] {\r\n        const sorted = [...items];\r\n        sorted.sort((a, b) => {\r\n            if (a.type === 'folder' && b.type !== 'folder') return -1;\r\n            if (a.type !== 'folder' && b.type === 'folder') return 1;\r\n            let comparison = 0;\r\n            switch (this.sortBy) {\r\n                case 'name':\r\n                    comparison = a.name.localeCompare(b.name);\r\n                    break;\r\n                case 'size':\r\n                    comparison = (a.size || 0) - (b.size || 0);\r\n                    break;\r\n                case 'date': {\r\n                    const aTime = a.modified ? Date.parse(a.modified) : 0;\r\n                    const bTime = b.modified ? Date.parse(b.modified) : 0;\r\n                    comparison = bTime - aTime;\r\n                    break;\r\n                }\r\n                case 'type':\r\n                    comparison = (a.type || '').localeCompare(b.type || '');\r\n                    break;\r\n            }\r\n            return this.sortOrder === 'asc' ? comparison : -comparison;\r\n        });\r\n        return sorted;\r\n    }\r\n\r\n    renderListView(items: FileItem[]): void {\r\n        this._renderedItems = items;\r\n        const rows = items\r\n            .map(\r\n                (item, i) => `\r\n            <tr class=\"finder-list-item ${this.selectedItems.has(item.name) ? 'bg-blue-100 dark:bg-blue-900' : ''}\" data-item-index=\"${i}\" data-item-name=\"${item.name}\" data-item-type=\"${item.type}\"${item.path ? ` data-item-path=\"${item.path}\"` : ''}>\r\n                <td class=\"pr-2\">\r\n                  <div class=\"flex items-center gap-2 min-w-0\">\r\n                    <span class=\"finder-item-icon shrink-0\">${item.icon || ''}</span>\r\n                    <span class=\"truncate block min-w-0\">${item.name}</span>\r\n                  </div>\r\n                </td>\r\n                <td class=\"text-right whitespace-nowrap pl-2 pr-2\">${this.formatSize(item.size)}</td>\r\n                <td class=\"text-right text-gray-500 dark:text-gray-400 whitespace-nowrap pl-2\">${this.formatDate(item.modified)}</td>\r\n            </tr>\r\n        `\r\n            )\r\n            .join('');\r\n        this.dom.content!.innerHTML = `\r\n            <div class=\"p-2\">\r\n                <table class=\"finder-list-table table-fixed w-full\">\r\n                    <colgroup>\r\n                        <col />\r\n                        <col class=\"w-28\" />\r\n                        <col class=\"w-40\" />\r\n                    </colgroup>\r\n                    <thead>\r\n                        <tr class=\"text-left\">\r\n                            <th class=\"font-medium\">Name</th>\r\n                            <th class=\"text-right font-medium\">Gr\u00F6\u00DFe</th>\r\n                            <th class=\"text-right font-medium\">Ge\u00E4ndert</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>${rows}</tbody>\r\n                </table>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    renderGridView(items: FileItem[]): void {\r\n        this._renderedItems = items;\r\n        const tiles = items\r\n            .map(\r\n                (item, i) => `\r\n            <div class=\"finder-grid-item ${this.selectedItems.has(item.name) ? 'ring-2 ring-blue-500 ring-offset-2 dark:ring-offset-gray-900 bg-blue-100/60 dark:bg-blue-900/40' : ''} min-w-0 p-3 rounded\" data-item-index=\"${i}\" data-item-name=\"${item.name}\" data-item-type=\"${item.type}\"${item.path ? ` data-item-path=\"${item.path}\"` : ''}>\r\n                <div class=\"finder-grid-icon text-2xl mb-2\">${item.icon || ''}</div>\r\n                <div class=\"finder-grid-name truncate text-sm\">${item.name}</div>\r\n            </div>\r\n        `\r\n            )\r\n            .join('');\r\n        this.dom.content!.innerHTML = `\r\n            <div class=\"finder-grid-container grid grid-cols-[repeat(auto-fill,minmax(160px,1fr))] gap-3 p-3\">${tiles}</div>\r\n        `;\r\n    }\r\n\r\n    formatSize(size?: number): string {\r\n        if (!size) return '-';\r\n        const units = ['B', 'KB', 'MB', 'GB'];\r\n        let idx = 0;\r\n        let val = size;\r\n        while (val > 1024 && idx < units.length - 1) {\r\n            val /= 1024;\r\n            idx++;\r\n        }\r\n        return `${val.toFixed(1)} ${units[idx]}`;\r\n    }\r\n\r\n    formatDate(d?: string): string {\r\n        if (!d) return '-';\r\n        try {\r\n            const dt = new Date(d);\r\n            return dt.toLocaleString();\r\n        } catch {\r\n            return d;\r\n        }\r\n    }\r\n\r\n    _selectItem(name: string): void {\r\n        const wasSelected = this.selectedItems.has(name);\r\n        this.selectedItems.clear();\r\n\r\n        if (!wasSelected) {\r\n            this.selectedItems.add(name);\r\n        }\r\n\r\n        // Update selection styling without full re-render\r\n        // This prevents DOM destruction during double-click sequences\r\n        if (this.dom.content) {\r\n            const allItems = this.dom.content.querySelectorAll('[data-item-name]');\r\n            allItems.forEach(el => {\r\n                const itemName = (el as HTMLElement).dataset.itemName;\r\n                const isSelected = this.selectedItems.has(itemName || '');\r\n\r\n                if (this.viewMode === 'list') {\r\n                    if (isSelected) {\r\n                        el.classList.add('bg-blue-100', 'dark:bg-blue-900');\r\n                    } else {\r\n                        el.classList.remove('bg-blue-100', 'dark:bg-blue-900');\r\n                    }\r\n                } else {\r\n                    // Grid mode\r\n                    if (isSelected) {\r\n                        el.classList.add(\r\n                            'ring-2',\r\n                            'ring-blue-500',\r\n                            'ring-offset-2',\r\n                            'dark:ring-offset-gray-900',\r\n                            'bg-blue-100/60',\r\n                            'dark:bg-blue-900/40'\r\n                        );\r\n                    } else {\r\n                        el.classList.remove(\r\n                            'ring-2',\r\n                            'ring-blue-500',\r\n                            'ring-offset-2',\r\n                            'dark:ring-offset-gray-900',\r\n                            'bg-blue-100/60',\r\n                            'dark:bg-blue-900/40'\r\n                        );\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    async openItem(name: string, type: 'folder' | 'file'): Promise<void> {\r\n        if (type === 'folder') {\r\n            this.navigateToFolder(name);\r\n        } else {\r\n            // Special handling for recent files: navigate to original location\r\n            if (this.source === 'recent') {\r\n                const item = this._renderedItems.find(i => i.name === name);\r\n                if (item?.path) {\r\n                    this.navigateToRecentFile(item.path);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            // Track in recent files (only if not already in recent view)\r\n            if (this.source !== 'recent') {\r\n                this.addToRecent(name);\r\n            }\r\n\r\n            // Save scroll position before opening file\r\n            this._saveScrollPosition();\r\n\r\n            // Track selection first\r\n            this._selectItem(name);\r\n\r\n            // Try to open file in an appropriate program (Text editor for text files)\r\n            const ext = (name.split('.').pop() || '').toLowerCase();\r\n            const textExts = new Set([\r\n                'md',\r\n                'txt',\r\n                'js',\r\n                'ts',\r\n                'json',\r\n                'html',\r\n                'htm',\r\n                'css',\r\n                'py',\r\n                'java',\r\n                'c',\r\n                'cpp',\r\n                'h',\r\n                'cs',\r\n                'rs',\r\n                'go',\r\n                'rb',\r\n                'php',\r\n                'yml',\r\n                'yaml',\r\n                'xml',\r\n                'sh',\r\n                'bash',\r\n            ]);\r\n            const imageExts = new Set([\r\n                'jpg',\r\n                'jpeg',\r\n                'png',\r\n                'gif',\r\n                'webp',\r\n                'svg',\r\n                'bmp',\r\n                'ico',\r\n                'tiff',\r\n            ]);\r\n            const pdfExts = new Set(['pdf']);\r\n\r\n            // Helper to open text content in TextEditorWindow\r\n            const openInTextEditor = (\r\n                fileName: string,\r\n                content: string,\r\n                meta?: { repo?: string; path?: string }\r\n            ) => {\r\n                try {\r\n                    const W = window as any;\r\n                    let editorWindow: any = null;\r\n                    // Prefer existing text-editor window\r\n                    if (\r\n                        W.WindowRegistry &&\r\n                        typeof W.WindowRegistry.getWindowsByType === 'function'\r\n                    ) {\r\n                        const existing = W.WindowRegistry.getWindowsByType('text-editor');\r\n                        if (existing && existing.length > 0) {\r\n                            editorWindow = existing[0];\r\n                        }\r\n                    }\r\n\r\n                    if (\r\n                        !editorWindow &&\r\n                        W.TextEditorWindow &&\r\n                        typeof W.TextEditorWindow.create === 'function'\r\n                    ) {\r\n                        editorWindow = W.TextEditorWindow.create();\r\n                    }\r\n\r\n                    if (editorWindow && typeof editorWindow.createDocument === 'function') {\r\n                        // Check if file is already open in a tab\r\n                        const existingTabs = Array.from(editorWindow.tabs.values()) as any[];\r\n                        const existingTab = existingTabs.find((tab: any) => tab.title === fileName);\r\n\r\n                        if (existingTab) {\r\n                            // File already open, just switch to that tab\r\n                            editorWindow.setActiveTab(existingTab.id);\r\n                            editorWindow.bringToFront?.();\r\n                        } else {\r\n                            // Create new document tab\r\n                            const newDoc = editorWindow.createDocument(fileName, content);\r\n                            // Activate the newly created tab\r\n                            if (newDoc && newDoc.id) {\r\n                                editorWindow.setActiveTab(newDoc.id);\r\n                            }\r\n                            editorWindow.bringToFront?.();\r\n                        }\r\n                        return true;\r\n                    }\r\n\r\n                    // Fallback: if a global TextEditorSystem exists, load remote file there\r\n                    if (\r\n                        W.TextEditorSystem &&\r\n                        typeof W.TextEditorSystem.loadRemoteFile === 'function'\r\n                    ) {\r\n                        W.TextEditorSystem.loadRemoteFile({\r\n                            content,\r\n                            fileName,\r\n                            repo: meta?.repo,\r\n                            path: meta?.path,\r\n                        });\r\n                        return true;\r\n                    }\r\n                } catch (e) {\r\n                    console.warn('[FinderView] Failed to open in text editor:', e);\r\n                }\r\n                return false;\r\n            };\r\n\r\n            // Handle local VirtualFS files\r\n            if (this.source === 'computer') {\r\n                try {\r\n                    // VirtualFS expects path without leading '/' for arrays\r\n                    const pathParts =\r\n                        this.currentPath.length > 0 ? [...this.currentPath, name] : [name];\r\n                    const content = (VirtualFS as any).readFile(pathParts);\r\n                    if (content !== null && textExts.has(ext)) {\r\n                        openInTextEditor(name, content);\r\n                        return;\r\n                    }\r\n                } catch (e) {\r\n                    console.warn('[FinderView] VirtualFS read failed:', e);\r\n                }\r\n            }\r\n\r\n            // Handle GitHub-sourced files (fetch raw content if necessary)\r\n            if (this.source === 'github') {\r\n                const API = this.getAPI();\r\n                const username = this.getGithubUsername();\r\n                const repo = this.currentPath[0];\r\n                const subPath = this.currentPath.slice(1).concat(name).join('/');\r\n                const maybe = this.lastGithubItemsMap.get(name);\r\n\r\n                // If the listing item contains a direct download_url (as our test mocks do), prefer it\r\n                if (maybe && maybe.download_url) {\r\n                    try {\r\n                        if (imageExts.has(ext)) {\r\n                            const url = maybe.download_url;\r\n                            try {\r\n                                // Try to fetch the resource and open as blob URL to avoid runtime 404/cors\r\n                                const resp = await fetch(url);\r\n                                if (resp.ok) {\r\n                                    const blob = await resp.blob();\r\n                                    const obj = URL.createObjectURL(blob);\r\n                                    if (\r\n                                        PreviewInstanceManager &&\r\n                                        typeof PreviewInstanceManager.openImages === 'function'\r\n                                    ) {\r\n                                        PreviewInstanceManager.openImages([obj], 0, subPath);\r\n                                    } else {\r\n                                        window.open(url, '_blank');\r\n                                    }\r\n                                    return;\r\n                                } else {\r\n                                    // fallback to opening the remote URL\r\n                                    window.open(url, '_blank');\r\n                                    this._renderAll();\r\n                                    return;\r\n                                }\r\n                            } catch (efetch) {\r\n                                console.warn(\r\n                                    '[FinderView] fetch of download_url failed, falling back to open:',\r\n                                    efetch\r\n                                );\r\n                                window.open(url, '_blank');\r\n                                this._renderAll();\r\n                                return;\r\n                            }\r\n                            this._renderAll();\r\n                            return;\r\n                        }\r\n                        if (pdfExts.has(ext)) {\r\n                            window.open(maybe.download_url, '_blank');\r\n                            this._renderAll();\r\n                            return;\r\n                        }\r\n                    } catch (eurl) {\r\n                        console.warn('[FinderView] failed to open maybe.download_url:', eurl);\r\n                    }\r\n                }\r\n\r\n                try {\r\n                    // If API object already contains content (rare for listings), decode and open\r\n                    if (maybe && maybe.content) {\r\n                        const raw =\r\n                            maybe.encoding === 'base64'\r\n                                ? atob((maybe.content || '').replace(/\\n/g, ''))\r\n                                : maybe.content;\r\n                        if (textExts.has(ext)) {\r\n                            openInTextEditor(name, raw, { repo, path: subPath });\r\n                            return;\r\n                        }\r\n                        // Try to handle images/pdf embedded in the listing object\r\n                        try {\r\n                            if (imageExts.has(ext)) {\r\n                                const b64 =\r\n                                    maybe.encoding === 'base64'\r\n                                        ? (maybe.content || '').replace(/\\n/g, '')\r\n                                        : '';\r\n                                if (b64) {\r\n                                    const bytes = atob(b64);\r\n                                    const arr = new Uint8Array(bytes.length);\r\n                                    for (let i = 0; i < bytes.length; i++)\r\n                                        arr[i] = bytes.charCodeAt(i);\r\n                                    const mimeMap: Record<string, string> = {\r\n                                        jpg: 'image/jpeg',\r\n                                        jpeg: 'image/jpeg',\r\n                                        png: 'image/png',\r\n                                        gif: 'image/gif',\r\n                                        webp: 'image/webp',\r\n                                        svg: 'image/svg+xml',\r\n                                        bmp: 'image/bmp',\r\n                                        ico: 'image/x-icon',\r\n                                        tiff: 'image/tiff',\r\n                                    };\r\n                                    const mime = mimeMap[ext] || 'application/octet-stream';\r\n                                    const blob = new Blob([arr], { type: mime });\r\n                                    const url = URL.createObjectURL(blob);\r\n                                    if (\r\n                                        PreviewInstanceManager &&\r\n                                        typeof PreviewInstanceManager.openImages === 'function'\r\n                                    ) {\r\n                                        PreviewInstanceManager.openImages([url], 0, subPath);\r\n                                    } else {\r\n                                        window.open(url, '_blank');\r\n                                    }\r\n                                    return;\r\n                                }\r\n                            }\r\n                            if (pdfExts.has(ext)) {\r\n                                const b64 =\r\n                                    maybe.encoding === 'base64'\r\n                                        ? (maybe.content || '').replace(/\\n/g, '')\r\n                                        : '';\r\n                                if (b64) {\r\n                                    const bytes = atob(b64);\r\n                                    const arr = new Uint8Array(bytes.length);\r\n                                    for (let i = 0; i < bytes.length; i++)\r\n                                        arr[i] = bytes.charCodeAt(i);\r\n                                    const blob = new Blob([arr], { type: 'application/pdf' });\r\n                                    const url = URL.createObjectURL(blob);\r\n                                    window.open(url, '_blank');\r\n                                    return;\r\n                                }\r\n                            }\r\n                        } catch (eimg) {\r\n                            console.warn('[FinderView] failed to open embedded object:', eimg);\r\n                        }\r\n                    }\r\n\r\n                    // Otherwise fetch full file object from GitHub API\r\n                    if (API && typeof API.fetchRepoContents === 'function') {\r\n                        // show a lightweight loading state\r\n                        this.dom.content!.innerHTML =\r\n                            '<div class=\"p-4 text-sm opacity-80\">Lade Datei\u2026</div>';\r\n                        const fileObj = await API.fetchRepoContents(username, repo, subPath);\r\n                        // If the API returned a direct download URL (common in mocks), prefer that for binaries\r\n                        if (fileObj && fileObj.download_url) {\r\n                            try {\r\n                                if (imageExts.has(ext)) {\r\n                                    const url = fileObj.download_url;\r\n                                    try {\r\n                                        const resp = await fetch(url);\r\n                                        if (resp.ok) {\r\n                                            const blob = await resp.blob();\r\n                                            const obj = URL.createObjectURL(blob);\r\n                                            PreviewInstanceManager.openImages([obj], 0, subPath);\r\n                                            this._renderAll();\r\n                                            return;\r\n                                        }\r\n                                    } catch (ef) {\r\n                                        console.warn(\r\n                                            '[FinderView] failed to fetch image download_url:',\r\n                                            ef\r\n                                        );\r\n                                    }\r\n                                    window.open(fileObj.download_url, '_blank');\r\n                                    this._renderAll();\r\n                                    return;\r\n                                }\r\n                                if (pdfExts.has(ext)) {\r\n                                    window.open(fileObj.download_url, '_blank');\r\n                                    this._renderAll();\r\n                                    return;\r\n                                }\r\n                            } catch (eurl) {\r\n                                console.warn('[FinderView] failed to open download_url:', eurl);\r\n                            }\r\n                        }\r\n\r\n                        // If fileObj contains base64 content we can handle text, images and pdfs\r\n                        if (fileObj && fileObj.content && fileObj.encoding === 'base64') {\r\n                            const rawBase64 = (fileObj.content || '').replace(/\\n/g, '');\r\n                            const rawText = atob(rawBase64);\r\n                            if (textExts.has(ext)) {\r\n                                openInTextEditor(name, rawText, { repo, path: subPath });\r\n                                this._renderAll();\r\n                                return;\r\n                            }\r\n                            try {\r\n                                if (imageExts.has(ext)) {\r\n                                    const bytes = atob(rawBase64);\r\n                                    const arr = new Uint8Array(bytes.length);\r\n                                    for (let i = 0; i < bytes.length; i++)\r\n                                        arr[i] = bytes.charCodeAt(i);\r\n                                    const mimeMap: Record<string, string> = {\r\n                                        jpg: 'image/jpeg',\r\n                                        jpeg: 'image/jpeg',\r\n                                        png: 'image/png',\r\n                                        gif: 'image/gif',\r\n                                        webp: 'image/webp',\r\n                                        svg: 'image/svg+xml',\r\n                                        bmp: 'image/bmp',\r\n                                        ico: 'image/x-icon',\r\n                                        tiff: 'image/tiff',\r\n                                    };\r\n                                    const mime = mimeMap[ext] || 'application/octet-stream';\r\n                                    const blob = new Blob([arr], { type: mime });\r\n                                    const url = URL.createObjectURL(blob);\r\n                                    if (\r\n                                        PreviewInstanceManager &&\r\n                                        typeof PreviewInstanceManager.openImages === 'function'\r\n                                    ) {\r\n                                        PreviewInstanceManager.openImages([url], 0, subPath);\r\n                                    } else {\r\n                                        window.open(url, '_blank');\r\n                                    }\r\n                                    this._renderAll();\r\n                                    return;\r\n                                }\r\n                                if (pdfExts.has(ext)) {\r\n                                    const bytes = atob(rawBase64);\r\n                                    const arr = new Uint8Array(bytes.length);\r\n                                    for (let i = 0; i < bytes.length; i++)\r\n                                        arr[i] = bytes.charCodeAt(i);\r\n                                    const blob = new Blob([arr], { type: 'application/pdf' });\r\n                                    const url = URL.createObjectURL(blob);\r\n                                    window.open(url, '_blank');\r\n                                    this._renderAll();\r\n                                    return;\r\n                                }\r\n                            } catch (e2) {\r\n                                console.warn('[FinderView] Failed to open binary file:', e2);\r\n                            }\r\n                        } else {\r\n                            const raw = fileObj ? fileObj.content || '' : '';\r\n                            if (textExts.has(ext)) {\r\n                                openInTextEditor(name, raw, { repo, path: subPath });\r\n                                this._renderAll();\r\n                                return;\r\n                            }\r\n                        }\r\n                    }\r\n                } catch (e: any) {\r\n                    console.warn('[FinderView] Failed to load GitHub file:', e);\r\n                    this._renderAll();\r\n                }\r\n            }\r\n\r\n            // If nothing opened, leave selection (future: open images/pdf in viewer)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Navigate to a recent file's original location\r\n     */\r\n    private navigateToRecentFile(fullPath: string): void {\r\n        // Parse path: e.g., \"home/marvin/Documents/notes.txt\"\r\n        const parts = fullPath.split('/').filter(Boolean);\r\n        if (parts.length === 0) return;\r\n\r\n        const fileName = parts[parts.length - 1];\r\n        if (!fileName) return;\r\n\r\n        const folderParts = parts.slice(0, -1);\r\n\r\n        // Switch to computer view and navigate to the folder\r\n        this.source = 'computer';\r\n        this.currentPath = folderParts;\r\n        this._persistState();\r\n        this._renderAll();\r\n\r\n        // Select the file\r\n        this._selectItem(fileName);\r\n    }\r\n\r\n    navigateToFolder(name: string): void {\r\n        if (this.source === 'github') {\r\n            this.currentPath = [...this.currentPath, name];\r\n            this._persistState();\r\n            this._renderAll();\r\n            return;\r\n        }\r\n        // Check VirtualFS if folder exists\r\n        // VirtualFS expects path without leading '/' for arrays, or string path like '/home'\r\n        const targetPath = this.currentPath.length === 0 ? name : [...this.currentPath, name];\r\n        const folder = VirtualFS.getFolder(targetPath);\r\n        if (folder) {\r\n            this.currentPath = [...this.currentPath, name];\r\n            this._persistState();\r\n            this._renderAll();\r\n        }\r\n    }\r\n\r\n    navigateUp(): void {\r\n        if (this.currentPath.length === 0) return;\r\n        this.currentPath = this.currentPath.slice(0, -1);\r\n        this._persistState();\r\n        this._renderAll();\r\n    }\r\n\r\n    goRoot(): void {\r\n        this.currentPath = [];\r\n        this._persistState();\r\n        this._renderAll();\r\n    }\r\n\r\n    navigateToPath(parts: string[]): void {\r\n        this.currentPath = parts;\r\n        this._persistState();\r\n        this._renderAll();\r\n    }\r\n\r\n    setViewMode(mode: ViewMode): void {\r\n        this.viewMode = mode;\r\n        this.updateContentState({ viewMode: this.viewMode });\r\n        this.renderContent();\r\n    }\r\n\r\n    setSortBy(sortBy: 'name' | 'date' | 'size' | 'type'): void {\r\n        this.sortBy = sortBy;\r\n        this._persistState();\r\n        this.renderContent();\r\n    }\r\n\r\n    setSortOrder(order: 'asc' | 'desc'): void {\r\n        this.sortOrder = order;\r\n        this._persistState();\r\n        this.renderContent();\r\n    }\r\n\r\n    // --- Favorites System ---\r\n    toggleFavorite(path: string): void {\r\n        if (this.favorites.has(path)) {\r\n            this.favorites.delete(path);\r\n        } else {\r\n            this.favorites.add(path);\r\n        }\r\n        this._persistState();\r\n        this.renderContent();\r\n    }\r\n\r\n    getFavoriteItems(): FileItem[] {\r\n        const items: FileItem[] = [];\r\n        for (const path of this.favorites) {\r\n            const parts = path.split('/');\r\n            const name = parts[parts.length - 1] || 'Unknown';\r\n            items.push({\r\n                name,\r\n                type: 'folder',\r\n                icon: '\u2B50',\r\n                modified: new Date().toISOString(),\r\n            });\r\n        }\r\n        return items;\r\n    }\r\n\r\n    // --- Recent Files System (Global Shared) ---\r\n    private static RECENT_FILES_KEY = 'finder-recent-files';\r\n    private static MAX_RECENT_FILES = 20;\r\n\r\n    /**\r\n     * Load recent files from global storage\r\n     */\r\n    private static loadRecentFiles(): RecentFile[] {\r\n        try {\r\n            const stored = localStorage.getItem(FinderView.RECENT_FILES_KEY);\r\n            if (stored) {\r\n                return JSON.parse(stored) as RecentFile[];\r\n            }\r\n        } catch (e) {\r\n            console.warn('[FinderView] Failed to load recent files:', e);\r\n        }\r\n        return FinderView.getDefaultRecentFiles();\r\n    }\r\n\r\n    /**\r\n     * Save recent files to global storage\r\n     */\r\n    private static saveRecentFiles(files: RecentFile[]): void {\r\n        try {\r\n            localStorage.setItem(FinderView.RECENT_FILES_KEY, JSON.stringify(files));\r\n        } catch (e) {\r\n            console.warn('[FinderView] Failed to save recent files:', e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get default recent files (with examples)\r\n     */\r\n    private static getDefaultRecentFiles(): RecentFile[] {\r\n        const now = new Date().toISOString();\r\n        const yesterday = new Date(Date.now() - 86400000).toISOString();\r\n        const twoDaysAgo = new Date(Date.now() - 172800000).toISOString();\r\n\r\n        return [\r\n            {\r\n                name: 'README.md',\r\n                path: 'home/marvin/README.md',\r\n                icon: '\uD83D\uDCDD',\r\n                modified: now,\r\n            },\r\n            {\r\n                name: 'notes.txt',\r\n                path: 'home/marvin/Documents/notes.txt',\r\n                icon: '\uD83D\uDCDD',\r\n                modified: yesterday,\r\n            },\r\n            {\r\n                name: 'project-plan.md',\r\n                path: 'home/marvin/Documents/project-plan.md',\r\n                icon: '\uD83D\uDCDD',\r\n                modified: twoDaysAgo,\r\n            },\r\n        ];\r\n    }\r\n\r\n    addToRecent(name: string): void {\r\n        // Build full path from current location\r\n        const pathParts = this.source === 'computer' ? this.currentPath : [];\r\n        const fullPath = pathParts.length > 0 ? pathParts.join('/') + '/' + name : name;\r\n\r\n        // Determine icon based on file extension\r\n        const ext = name.split('.').pop()?.toLowerCase() || '';\r\n        let icon = '\uD83D\uDCC4';\r\n        if (['md', 'txt'].includes(ext)) icon = '\uD83D\uDCDD';\r\n        else if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(ext)) icon = '\uD83D\uDDBC\uFE0F';\r\n        else if (['pdf'].includes(ext)) icon = '\uFFFD';\r\n        else if (['zip', 'tar', 'gz'].includes(ext)) icon = '\uFFFD';\r\n\r\n        const recentFile: RecentFile = {\r\n            name,\r\n            path: fullPath,\r\n            icon,\r\n            modified: new Date().toISOString(),\r\n        };\r\n\r\n        // Load current global list\r\n        const recentFiles = FinderView.loadRecentFiles();\r\n\r\n        // Remove duplicate if exists\r\n        const filtered = recentFiles.filter(f => f.path !== fullPath);\r\n\r\n        // Add to front\r\n        filtered.unshift(recentFile);\r\n\r\n        // Limit to maxRecentFiles\r\n        const limited = filtered.slice(0, FinderView.MAX_RECENT_FILES);\r\n\r\n        // Save back to global storage\r\n        FinderView.saveRecentFiles(limited);\r\n\r\n        // Update local instance reference\r\n        this.recentFiles = limited;\r\n        this._persistState();\r\n    }\r\n\r\n    getRecentItems(): FileItem[] {\r\n        // Always load fresh from global storage\r\n        const recentFiles = FinderView.loadRecentFiles();\r\n        // Note: recentFiles is already sorted with newest first (unshift in addToRecent)\r\n        // So we can return them directly without additional sorting\r\n        return recentFiles.map(rf => ({\r\n            name: rf.name,\r\n            type: 'file' as const,\r\n            icon: rf.icon,\r\n            modified: rf.modified,\r\n            // Store path in a data attribute for navigation\r\n            path: rf.path,\r\n        }));\r\n    }\r\n\r\n    // --- Search Function ---\r\n    filterItems(items: FileItem[], searchTerm: string): FileItem[] {\r\n        if (!searchTerm || searchTerm.trim() === '') {\r\n            return items;\r\n        }\r\n        const term = searchTerm.toLowerCase();\r\n        return items.filter(item => item.name.toLowerCase().includes(term));\r\n    }\r\n\r\n    // --- State Persistence ---\r\n    private _persistState(): void {\r\n        // Update content state without triggering recursion\r\n        this.contentState = {\r\n            currentPath: this.currentPath,\r\n            viewMode: this.viewMode,\r\n            sortBy: this.sortBy,\r\n            sortOrder: this.sortOrder,\r\n            favorites: Array.from(this.favorites),\r\n            recentFiles: this.recentFiles,\r\n            sidebarWidth: this.sidebarWidth,\r\n        };\r\n        this.metadata.modified = Date.now();\r\n\r\n        // Trigger parent window to save its state (which includes all tabs)\r\n        if (this.parentWindow) {\r\n            (this.parentWindow as any)._saveState?.();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Save current scroll position\r\n     */\r\n    private _saveScrollPosition(): void {\r\n        if (this.dom.content) {\r\n            this._savedScrollPosition = this.dom.content.scrollTop;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Restore saved scroll position\r\n     */\r\n    private _restoreScrollPosition(): void {\r\n        if (this.dom.content && this._savedScrollPosition > 0) {\r\n            // Use requestAnimationFrame to ensure DOM is ready\r\n            requestAnimationFrame(() => {\r\n                if (this.dom.content) {\r\n                    this.dom.content.scrollTop = this._savedScrollPosition;\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Override show to restore scroll position\r\n     */\r\n    show(): void {\r\n        super.show();\r\n        this._restoreScrollPosition();\r\n    }\r\n\r\n    /**\r\n     * Override hide to save scroll position\r\n     */\r\n    hide(): void {\r\n        this._saveScrollPosition();\r\n        super.hide();\r\n    }\r\n\r\n    serialize(): any {\r\n        return {\r\n            ...super.serialize(),\r\n            source: this.source,\r\n            currentPath: this.currentPath,\r\n            viewMode: this.viewMode,\r\n            sortBy: this.sortBy,\r\n            sortOrder: this.sortOrder,\r\n            favorites: Array.from(this.favorites),\r\n            recentFiles: this.recentFiles,\r\n        };\r\n    }\r\n\r\n    static deserialize(state: any): FinderView {\r\n        const view = new FinderView({\r\n            id: state.id,\r\n            title: state.title || (state.source === 'github' ? 'GitHub' : 'Computer'),\r\n            icon: state.icon || (state.source === 'github' ? '\uD83D\uDCE6' : '\uD83D\uDCBB'),\r\n            source: (state.source as FinderSource) || 'computer',\r\n            content: {\r\n                ...state.contentState,\r\n                favorites: state.favorites || state.contentState?.favorites || [],\r\n                recentFiles: state.recentFiles || state.contentState?.recentFiles || [],\r\n                sidebarWidth: state.sidebarWidth || state.contentState?.sidebarWidth || 192,\r\n            },\r\n        });\r\n        view.currentPath = state.currentPath || [];\r\n        view.viewMode = state.viewMode || 'list';\r\n        view.sortBy = state.sortBy || 'name';\r\n        view.sortOrder = state.sortOrder || 'asc';\r\n        return view;\r\n    }\r\n\r\n    // --- GitHub Integration ---\r\n    private getGithubUsername(): string {\r\n        const w = window as any;\r\n        return w.GITHUB_USERNAME || 'Marormur';\r\n    }\r\n\r\n    private getAPI(): any {\r\n        const w = window as any;\r\n        return w.GitHubAPI || null;\r\n    }\r\n\r\n    async renderGithubContent(): Promise<void> {\r\n        if (!this.dom.content) return;\r\n        const API = this.getAPI();\r\n        const username = this.getGithubUsername();\r\n        this.dom.content.innerHTML = '<div class=\"p-4 text-sm opacity-80\">Lade GitHub\u2026</div>';\r\n\r\n        if (!API) {\r\n            this.dom.content.innerHTML =\r\n                '<div class=\"p-4 text-sm text-red-500\">GitHubAPI nicht geladen</div>';\r\n            return;\r\n        }\r\n\r\n        try {\r\n            if (this.currentPath.length === 0) {\r\n                // Repos\r\n                const cacheKey = 'repos';\r\n                let repos: any;\r\n\r\n                // Check our internal cache first\r\n                const cached = this._readGithubCache(cacheKey);\r\n                if (cached) {\r\n                    repos = cached;\r\n                } else {\r\n                    // Check API cache\r\n                    const apiCached = API.readCache('repos');\r\n                    repos = apiCached ?? (await API.fetchUserRepos(username));\r\n                    if (!apiCached) API.writeCache('repos', '', '', repos);\r\n                    this._writeGithubCache(cacheKey, repos);\r\n                }\r\n\r\n                this.githubRepos = Array.isArray(repos) ? repos : [];\r\n                const items: FileItem[] = this.githubRepos.map((repo: any) => ({\r\n                    name: repo.name,\r\n                    type: 'folder',\r\n                    icon: '\uD83D\uDCE6',\r\n                }));\r\n                this.lastGithubItemsMap.clear();\r\n                items.forEach(it => this.lastGithubItemsMap.set(it.name, it));\r\n\r\n                // Apply search filter for GitHub too\r\n                const filtered = this.filterItems(items, this.searchTerm);\r\n                this.renderListView(this.sortItems(filtered));\r\n            } else {\r\n                // Repo contents\r\n                const repo = this.currentPath[0];\r\n                const subPath = this.currentPath.slice(1).join('/');\r\n                const cacheKey = `${repo}/${subPath}`;\r\n                let contents: any;\r\n\r\n                // Check our internal cache first\r\n                const cached = this._readGithubCache(cacheKey);\r\n                if (cached) {\r\n                    contents = cached;\r\n                } else {\r\n                    // Check API cache\r\n                    const apiCached = API.readCache('contents', repo, subPath);\r\n                    contents = apiCached ?? (await API.fetchRepoContents(username, repo, subPath));\r\n                    if (!apiCached) API.writeCache('contents', repo, subPath, contents);\r\n                    this._writeGithubCache(cacheKey, contents);\r\n                }\r\n\r\n                const items: FileItem[] = (Array.isArray(contents) ? contents : []).map(\r\n                    (it: any) => ({\r\n                        name: it.name,\r\n                        type: it.type === 'dir' ? 'folder' : 'file',\r\n                        icon: it.type === 'dir' ? '\uD83D\uDCC1' : '\uD83D\uDCC4',\r\n                        size: it.size ?? 0,\r\n                        modified: it.git_url ? undefined : undefined,\r\n                    })\r\n                );\r\n                this.lastGithubItemsMap.clear();\r\n                (Array.isArray(contents) ? contents : []).forEach((it: any) =>\r\n                    this.lastGithubItemsMap.set(it.name, it)\r\n                );\r\n\r\n                // Apply search filter for GitHub too\r\n                const filtered = this.filterItems(items, this.searchTerm);\r\n                this.renderListView(this.sortItems(filtered));\r\n            }\r\n        } catch (e: any) {\r\n            this.githubError = true;\r\n            this.githubErrorMessage = e?.message || 'Unbekannter Fehler';\r\n            this.dom.content.innerHTML = `<div class=\"p-4 text-sm text-red-500\">GitHub Fehler: ${this.githubErrorMessage}</div>`;\r\n        }\r\n    }\r\n\r\n    // --- GitHub Cache Helpers ---\r\n    /**\r\n     * Kleines In\u2011Memory\u2011TTL\u2011Cache pro FinderView. Verhindert \u00FCberm\u00E4\u00DFige Re\u2011Renders\r\n     * und beschleunigt Navigieren zwischen Ordnern/Repos.\r\n     */\r\n    private _readGithubCache(key: string): any | null {\r\n        const cached = this.githubContentCache.get(key);\r\n        if (!cached) return null;\r\n\r\n        const now = Date.now();\r\n        if (now - cached.timestamp > this.cacheTTL) {\r\n            // Cache expired\r\n            this.githubContentCache.delete(key);\r\n            return null;\r\n        }\r\n\r\n        return cached.data;\r\n    }\r\n\r\n    /** Schreibt einen Eintrag in den In\u2011Memory\u2011Cache. */\r\n    private _writeGithubCache(key: string, data: any): void {\r\n        this.githubContentCache.set(key, {\r\n            data,\r\n            timestamp: Date.now(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Ermittelt den sichtbaren Tab\u2011Titel: Am Root z. B. \u201EGitHub\u201C/\u201EComputer\u201C,\r\n     * ansonsten der letzte Pfadteil. Dadurch entspricht der Tab immer dem Kontext.\r\n     */\r\n    private _updateTabLabel(): void {\r\n        const w = window as any;\r\n        const t = (key: string, fb: string) =>\r\n            w.appI18n ? w.appI18n.translate(key, {}, { fallback: fb }) : fb;\r\n\r\n        let label = '';\r\n        const atRoot = this.currentPath.length === 0;\r\n        switch (this.source) {\r\n            case 'computer':\r\n                label = atRoot\r\n                    ? t('finder.sidebar.computer', 'Computer')\r\n                    : this.currentPath[this.currentPath.length - 1];\r\n                break;\r\n            case 'github':\r\n                // At root show generic GitHub view label, otherwise last path segment (repo or folder)\r\n                label = atRoot\r\n                    ? 'GitHub'\r\n                    : this.currentPath[this.currentPath.length - 1] || 'GitHub';\r\n                break;\r\n            case 'recent':\r\n                label = t('finder.sidebar.recent', 'Zuletzt verwendet');\r\n                break;\r\n            case 'starred':\r\n                label = t('finder.sidebar.starred', 'Markiert');\r\n                break;\r\n            default:\r\n                label = this.title || 'Finder';\r\n        }\r\n\r\n        if (this.title !== label) {\r\n            this.setTitle(label);\r\n        }\r\n    }\r\n}\r\n\r\n(window as any).FinderView = FinderView;\r\n", "/**\r\n * src/ts/finder-window.ts\r\n * Finder-specific multi-window implementation\r\n */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport { BaseWindow, type WindowConfig } from '../../windows/base-window.js';\r\nimport type { BaseTab } from '../../windows/base-tab.js';\r\n\r\nexport class FinderWindow extends BaseWindow {\r\n    constructor(config?: Partial<WindowConfig>) {\r\n        super({\r\n            type: 'finder',\r\n            title: 'Finder',\r\n            ...config,\r\n        });\r\n    }\r\n\r\n    createDOM(): HTMLElement {\r\n        const windowEl = super.createDOM();\r\n        // Title is now set via i18n in BaseWindow\r\n\r\n        // Remove BaseWindow's tab bar and content element\r\n        const baseTabBar = windowEl.querySelector('.window-tab-bar');\r\n        if (baseTabBar) {\r\n            baseTabBar.remove();\r\n        }\r\n        if (this.contentElement) {\r\n            this.contentElement.remove();\r\n        }\r\n\r\n        // Tab bar\r\n        const tabBar = document.createElement('div');\r\n        tabBar.id = `${this.id}-tabs`;\r\n        tabBar.className = 'window-tab-bar';\r\n        windowEl.appendChild(tabBar);\r\n\r\n        // Finder Content container (flex-1 to fill remaining space)\r\n        this.contentElement = document.createElement('div');\r\n        this.contentElement.id = `${this.id}-container`;\r\n        this.contentElement.className = 'flex-1 overflow-hidden flex';\r\n        windowEl.appendChild(this.contentElement);\r\n\r\n        return windowEl;\r\n    }\r\n\r\n    show(): void {\r\n        super.show();\r\n        // Render tabs after window is shown and DOM exists\r\n        this._renderTabs();\r\n    }\r\n\r\n    protected _renderTabs(): void {\r\n        this._doRenderTabs();\r\n    }\r\n\r\n    private _doRenderTabs(): void {\r\n        const W = window as any;\r\n        if (!W.WindowTabs || !this.element) {\r\n            return;\r\n        }\r\n        const tabBar = this.element.querySelector(`#${this.id}-tabs`);\r\n        if (!tabBar) {\r\n            return;\r\n        }\r\n\r\n        // Always show tab bar for Finder (unlike Terminal/TextEditor)\r\n        // Tab bar contains navigation and \"+\" button\r\n        (tabBar as HTMLElement).style.display = '';\r\n\r\n        const makeInst = (tab: any) => ({\r\n            instanceId: tab.id,\r\n            title: tab.title,\r\n            metadata: { tabLabel: tab.title },\r\n            __tab: tab,\r\n            show: () => tab.show(),\r\n            hide: () => tab.hide(),\r\n        });\r\n        const adapter = {\r\n            getAllInstances: () => Array.from(this.tabs.values()).map(makeInst),\r\n            getActiveInstance: () => {\r\n                const activeId = this.activeTabId;\r\n                const t = activeId ? this.tabs.get(activeId) : null;\r\n                return t ? makeInst(t) : null;\r\n            },\r\n            getAllInstanceIds: () => Array.from(this.tabs.keys()),\r\n            getInstance: (id: string) => {\r\n                const t = this.tabs.get(id) || null;\r\n                return t ? makeInst(t) : null;\r\n            },\r\n            setActiveInstance: (id: string) => this.setActiveTab(id),\r\n            createInstance: (cfg?: any) => {\r\n                const view = W.FinderView\r\n                    ? new W.FinderView({ title: cfg?.title || `Computer`, source: 'computer' })\r\n                    : null;\r\n                if (view) {\r\n                    this.addTab(view);\r\n                    // Aktiviere den neuen Tab direkt nach dem Erstellen\r\n                    this.setActiveTab(view.id);\r\n                    return makeInst(view);\r\n                }\r\n                return null;\r\n            },\r\n            destroyInstance: (id: string) => this.removeTab(id),\r\n            getInstanceCount: () => this.tabs.size,\r\n            reorderInstances: (newOrder: string[]) => {\r\n                const old = this.tabs;\r\n                const rebuilt = new Map<string, any>();\r\n                newOrder.forEach(id => {\r\n                    const t = old.get(id);\r\n                    if (t) rebuilt.set(id, t);\r\n                });\r\n                old.forEach((t, id) => {\r\n                    if (!rebuilt.has(id)) rebuilt.set(id, t);\r\n                });\r\n                (this as any).tabs = rebuilt;\r\n                this._renderTabs();\r\n            },\r\n            detachInstance: (id: string) => {\r\n                const t = this.detachTab(id) as any;\r\n                return t ? makeInst(t) : null;\r\n            },\r\n            adoptInstance: (inst: any) => {\r\n                const tab = inst.__tab || inst;\r\n                this.addTab(tab);\r\n                this.setActiveTab(tab.id);\r\n                return makeInst(tab);\r\n            },\r\n        };\r\n\r\n        // Destroy existing controller before creating new one\r\n        if ((this as any).tabController) {\r\n            (this as any).tabController.destroy();\r\n        }\r\n        (this as any).tabController = W.WindowTabs.create(adapter, tabBar as HTMLElement, {\r\n            addButton: true,\r\n            onCreateInstanceTitle: () => `Tab ${this.tabs.size + 1}`,\r\n        });\r\n    }\r\n\r\n    createView(title?: string): BaseTab | null {\r\n        const W = window as any;\r\n        if (!W.FinderView) {\r\n            console.error('FinderView class not loaded');\r\n            return null;\r\n        }\r\n        const view = new W.FinderView({ title: title || `Computer`, source: 'computer' });\r\n        this.addTab(view);\r\n        return view;\r\n    }\r\n\r\n    createGithubView(title?: string): BaseTab | null {\r\n        const W = window as any;\r\n        if (!W.FinderView) {\r\n            console.error('FinderView class not loaded');\r\n            return null;\r\n        }\r\n        const view = new W.FinderView({ title: title || `GitHub`, source: 'github', icon: '\uD83D\uDCE6' });\r\n        this.addTab(view);\r\n        return view;\r\n    }\r\n\r\n    static create(config?: Partial<WindowConfig>): FinderWindow {\r\n        const window = new FinderWindow(config);\r\n        window.createView('Computer');\r\n\r\n        // Register window BEFORE showing it, so updateDockIndicators() can find it\r\n        const W = globalThis as any;\r\n        if (W.WindowRegistry) W.WindowRegistry.registerWindow(window);\r\n\r\n        window.show();\r\n        return window;\r\n    }\r\n\r\n    /**\r\n     * Focus existing Finder window or create new one (macOS-like Dock behavior)\r\n     * - If no Finder window exists, create a new one\r\n     * - If Finder windows exist, focus the most recently active one\r\n     */\r\n    static focusOrCreate(config?: Partial<WindowConfig>): FinderWindow {\r\n        const W = globalThis as any;\r\n        if (!W.WindowRegistry) {\r\n            // Fallback: create new if registry unavailable\r\n            return FinderWindow.create(config);\r\n        }\r\n\r\n        // Get all existing Finder windows\r\n        const finderWindows = W.WindowRegistry.getWindowsByType('finder');\r\n\r\n        if (finderWindows.length === 0) {\r\n            // No Finder window exists \u2192 create new one\r\n            return FinderWindow.create(config);\r\n        }\r\n\r\n        // Find the most recently active Finder window (highest z-index)\r\n        let mostRecentWindow = finderWindows[0];\r\n        for (const win of finderWindows) {\r\n            if (win.zIndex > mostRecentWindow.zIndex) {\r\n                mostRecentWindow = win;\r\n            }\r\n        }\r\n\r\n        // Focus the most recent Finder window\r\n        mostRecentWindow.bringToFront();\r\n        return mostRecentWindow;\r\n    }\r\n}\r\n\r\n(window as any).FinderWindow = FinderWindow;\r\n", "/**\r\n * src/ts/multi-window-session.ts\r\n * Multi-Window Session Management\r\n * Handles saving/restoring window layouts and tab states for the new multi-window system\r\n */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport type { BaseWindow } from '../windows/base-window.js';\r\nimport type { TabState } from '../windows/base-tab.js';\r\nimport WindowRegistry from '../windows/window-registry.js';\r\nimport { TerminalWindow } from '../apps/terminal/terminal-window.js';\r\nimport { TextEditorWindow } from '../apps/text-editor/text-editor-window.js';\r\nimport { FinderWindow } from '../apps/finder/finder-window.js';\r\nimport { TerminalSession } from '../apps/terminal/terminal-session.js';\r\nimport { TextEditorDocument } from '../apps/text-editor/text-editor-document.js';\r\nimport { FinderView } from '../apps/finder/finder-view.js';\r\n\r\n/**\r\n * Multi-Window Session Schema v1.0\r\n */\r\nexport interface MultiWindowSession {\r\n    version: string; // Schema version for migration\r\n    timestamp: number;\r\n    windows: WindowSessionData[];\r\n    metadata?: {\r\n        theme?: string;\r\n        language?: string;\r\n        [key: string]: any;\r\n    };\r\n}\r\n\r\nexport interface WindowSessionData {\r\n    id: string;\r\n    type: string; // 'terminal', 'text-editor', 'finder'\r\n    position: {\r\n        x: number;\r\n        y: number;\r\n        width: number;\r\n        height: number;\r\n    };\r\n    zIndex: number;\r\n    isMinimized: boolean;\r\n    isMaximized: boolean;\r\n    activeTabId: string | null;\r\n    tabs: TabState[];\r\n    metadata?: Record<string, any>;\r\n}\r\n\r\n/**\r\n * Legacy Single-Window Session (for migration)\r\n */\r\nexport interface LegacySession {\r\n    version?: string;\r\n    timestamp?: number;\r\n    instances?: Record<string, any[]>; // Old instance manager format\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * MultiWindowSessionManager - Handles multi-window session persistence\r\n *\r\n * Features:\r\n * - Save/restore window positions and tab states\r\n * - Auto-save with debouncing\r\n * - Legacy session migration\r\n * - Export/import session JSON\r\n *\r\n * Note: This coexists with the legacy SessionManager for backwards compatibility\r\n */\r\nclass MultiWindowSessionManager {\r\n    private static STORAGE_KEY = 'multi-window-session';\r\n    private static LEGACY_STORAGE_KEY = 'windowInstancesSession'; // Old SessionManager key\r\n    private static LEGACY_STORAGE_KEY_V1 = 'multiWindowSession_v1'; // Legacy multi-window session key\r\n    private static VERSION = '1.0.0';\r\n    private static AUTO_SAVE_DELAY = 2000; // 2 seconds debounce\r\n\r\n    private autoSaveTimer: number | null = null;\r\n    private isRestoring = false;\r\n    private initialized = false;\r\n\r\n    /**\r\n     * Initialize session manager\r\n     */\r\n    init(): void {\r\n        if (this.initialized) return;\r\n\r\n        console.log('[MultiWindowSessionManager] Initializing...');\r\n\r\n        // Save on window blur\r\n        window.addEventListener('blur', () => {\r\n            this.saveSession({ immediate: true });\r\n        });\r\n\r\n        // Save on beforeunload\r\n        window.addEventListener('beforeunload', () => {\r\n            this.saveSessionImmediate();\r\n        });\r\n\r\n        // Save on visibility change\r\n        document.addEventListener('visibilitychange', () => {\r\n            if (document.hidden) {\r\n                this.saveSession({ immediate: true });\r\n            }\r\n        });\r\n\r\n        this.initialized = true;\r\n        console.log('[MultiWindowSessionManager] Initialized');\r\n    }\r\n\r\n    /**\r\n     * Save current session to localStorage\r\n     */\r\n    saveSession(options: { immediate?: boolean } = {}): void {\r\n        console.log('[MultiWindowSessionManager] saveSession called:', {\r\n            immediate: options.immediate,\r\n            isRestoring: this.isRestoring,\r\n        });\r\n\r\n        if (this.isRestoring) {\r\n            console.log('[MultiWindowSessionManager] Skipping save during restore');\r\n            return;\r\n        }\r\n\r\n        if (options.immediate) {\r\n            this.saveSessionImmediate();\r\n        } else {\r\n            this.scheduleAutoSave();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Save session immediately (bypasses debounce)\r\n     */\r\n    private saveSessionImmediate(): void {\r\n        console.log('[MultiWindowSessionManager] saveSessionImmediate called');\r\n\r\n        if (this.autoSaveTimer !== null) {\r\n            clearTimeout(this.autoSaveTimer);\r\n            this.autoSaveTimer = null;\r\n        }\r\n\r\n        try {\r\n            console.log('[MultiWindowSessionManager] Creating session snapshot...');\r\n            const session = this.createSession();\r\n            console.log('[MultiWindowSessionManager] Session created:', {\r\n                windows: session.windows.length,\r\n                totalTabs: session.windows.reduce((sum, w) => sum + w.tabs.length, 0),\r\n            });\r\n\r\n            const serialized = JSON.stringify(session);\r\n            console.log(\r\n                '[MultiWindowSessionManager] Session serialized, length:',\r\n                serialized.length\r\n            );\r\n\r\n            localStorage.setItem(MultiWindowSessionManager.STORAGE_KEY, serialized);\r\n            console.log('[MultiWindowSessionManager] Session saved to localStorage');\r\n\r\n            console.log('[MultiWindowSessionManager] Session saved:', {\r\n                windows: session.windows.length,\r\n                totalTabs: session.windows.reduce((sum, w) => sum + w.tabs.length, 0),\r\n                isRestoring: this.isRestoring,\r\n            });\r\n        } catch (error) {\r\n            console.error('[MultiWindowSessionManager] Failed to save session:', error);\r\n            if (error instanceof Error) {\r\n                console.error('[MultiWindowSessionManager] Error stack:', error.stack);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Schedule auto-save (debounced)\r\n     */\r\n    private scheduleAutoSave(): void {\r\n        if (this.autoSaveTimer !== null) {\r\n            clearTimeout(this.autoSaveTimer);\r\n        }\r\n\r\n        this.autoSaveTimer = window.setTimeout(() => {\r\n            this.saveSessionImmediate();\r\n        }, MultiWindowSessionManager.AUTO_SAVE_DELAY);\r\n    }\r\n\r\n    /**\r\n     * Create session object from current state\r\n     */\r\n    private createSession(): MultiWindowSession {\r\n        const windows = WindowRegistry.getAllWindows();\r\n\r\n        return {\r\n            version: MultiWindowSessionManager.VERSION,\r\n            timestamp: Date.now(),\r\n            windows: windows.map(window => this.serializeWindow(window)),\r\n            metadata: {\r\n                theme: this.getCurrentTheme(),\r\n                language: this.getCurrentLanguage(),\r\n            },\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Serialize a window and all its tabs\r\n     */\r\n    private serializeWindow(window: BaseWindow): WindowSessionData {\r\n        const tabs = Array.from(window.tabs.values());\r\n\r\n        return {\r\n            id: window.id,\r\n            type: window.type,\r\n            position: { ...window.position },\r\n            zIndex: window.zIndex,\r\n            isMinimized: window.isMinimized,\r\n            isMaximized: window.isMaximized,\r\n            activeTabId: window.activeTabId,\r\n            tabs: tabs.map(tab => this.serializeTab(tab)),\r\n            metadata: window.metadata,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Serialize a tab\r\n     */\r\n    private serializeTab(tab: any): TabState {\r\n        // Use tab's own serialize method if available\r\n        if (typeof tab.serialize === 'function') {\r\n            return tab.serialize();\r\n        }\r\n\r\n        // Fallback to basic serialization\r\n        return {\r\n            id: tab.id,\r\n            type: tab.type,\r\n            title: tab.title,\r\n            icon: tab.icon,\r\n            contentState: tab.contentState || {},\r\n            created: tab.metadata?.created || Date.now(),\r\n            modified: tab.metadata?.modified || Date.now(),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Restore session from localStorage\r\n     */\r\n    async restoreSession(): Promise<boolean> {\r\n        console.log(\r\n            '[MultiWindowSessionManager] restoreSession() called, setting isRestoring=true'\r\n        );\r\n        this.isRestoring = true;\r\n\r\n        try {\r\n            // Try to load multi-window session\r\n            const sessionData = localStorage.getItem(MultiWindowSessionManager.STORAGE_KEY);\r\n\r\n            if (sessionData) {\r\n                console.log('[MultiWindowSessionManager] Found session data, parsing...');\r\n                const session = JSON.parse(sessionData) as MultiWindowSession;\r\n                console.log('[MultiWindowSessionManager] Session parsed:', {\r\n                    windows: session.windows.length,\r\n                    windowTypes: session.windows.map(w => w.type),\r\n                });\r\n                // Apply path migration in case there are legacy paths\r\n                this.migrateSessionPaths(session);\r\n                await this.restoreMultiWindowSession(session);\r\n                console.log('[MultiWindowSessionManager] Session restored successfully');\r\n                return true;\r\n            }\r\n\r\n            // Try to load legacy v1 session (multiWindowSession_v1)\r\n            const legacyV1Data = localStorage.getItem(\r\n                MultiWindowSessionManager.LEGACY_STORAGE_KEY_V1\r\n            );\r\n            if (legacyV1Data) {\r\n                console.log('[MultiWindowSessionManager] Migrating legacy v1 session...');\r\n                const rawSession = JSON.parse(legacyV1Data);\r\n                // Normalize legacy format to current format\r\n                const session = this.normalizeLegacyV1Session(rawSession);\r\n                // Apply path migration\r\n                this.migrateSessionPaths(session);\r\n                await this.restoreMultiWindowSession(session);\r\n                // Clear legacy key and save in new format\r\n                localStorage.removeItem(MultiWindowSessionManager.LEGACY_STORAGE_KEY_V1);\r\n                this.saveSessionImmediate();\r\n                return true;\r\n            }\r\n\r\n            // Try to migrate legacy session\r\n            const legacyData = localStorage.getItem(MultiWindowSessionManager.LEGACY_STORAGE_KEY);\r\n            if (legacyData) {\r\n                console.log('[MultiWindowSessionManager] Migrating legacy session...');\r\n                const legacySession = JSON.parse(legacyData) as LegacySession;\r\n                await this.migrateLegacySession(legacySession);\r\n                return true;\r\n            }\r\n\r\n            console.log('[MultiWindowSessionManager] No session to restore');\r\n            return false;\r\n        } catch (error) {\r\n            console.error('[MultiWindowSessionManager] Failed to restore session:', error);\r\n            return false;\r\n        } finally {\r\n            console.log(\r\n                '[MultiWindowSessionManager] restoreSession() complete, setting isRestoring=false'\r\n            );\r\n            this.isRestoring = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Restore multi-window session\r\n     */\r\n    private async restoreMultiWindowSession(session: MultiWindowSession): Promise<void> {\r\n        console.log('[MultiWindowSessionManager] Restoring session:', {\r\n            version: session.version,\r\n            windows: session.windows.length,\r\n            timestamp: new Date(session.timestamp),\r\n        });\r\n\r\n        // SAFETY: Limit maximum windows to prevent DOM explosion\r\n        // Allow multiple windows per type (e.g., 3 Finder windows, 2 Terminal windows)\r\n        const MAX_WINDOWS_PER_TYPE = 3;\r\n        const MAX_TOTAL_WINDOWS = 10;\r\n\r\n        if (session.windows.length > MAX_TOTAL_WINDOWS) {\r\n            console.warn(\r\n                `[MultiWindowSessionManager] Session has ${session.windows.length} windows (max ${MAX_TOTAL_WINDOWS}). Clearing corrupted session.`\r\n            );\r\n            localStorage.removeItem(MultiWindowSessionManager.STORAGE_KEY);\r\n            return;\r\n        }\r\n\r\n        // Count windows by type - if any type has more than 1, clear the session\r\n        const typeCount = new Map<string, number>();\r\n        session.windows.forEach(w => {\r\n            const count = typeCount.get(w.type) || 0;\r\n            typeCount.set(w.type, count + 1);\r\n        });\r\n\r\n        // Check for duplicates\r\n        for (const [type, count] of typeCount.entries()) {\r\n            if (count > MAX_WINDOWS_PER_TYPE) {\r\n                console.warn(\r\n                    `[MultiWindowSessionManager] Session has ${count} ${type} windows (max ${MAX_WINDOWS_PER_TYPE}). Clearing corrupted session.`\r\n                );\r\n                localStorage.removeItem(MultiWindowSessionManager.STORAGE_KEY);\r\n                return;\r\n            }\r\n        }\r\n\r\n        // Count windows by type and filter excessive ones\r\n        const windowsByType = new Map<string, number>();\r\n        const filteredWindows = session.windows.filter(w => {\r\n            const count = windowsByType.get(w.type) || 0;\r\n            if (count >= MAX_WINDOWS_PER_TYPE) {\r\n                console.warn(\r\n                    `[MultiWindowSessionManager] Skipping ${w.type} window (limit ${MAX_WINDOWS_PER_TYPE} reached)`\r\n                );\r\n                return false;\r\n            }\r\n            windowsByType.set(w.type, count + 1);\r\n            return true;\r\n        });\r\n\r\n        // Sort windows by z-index to restore stacking order\r\n        const sortedWindows = filteredWindows.sort((a, b) => a.zIndex - b.zIndex);\r\n\r\n        // Restore each window\r\n        for (const windowData of sortedWindows) {\r\n            await this.restoreWindow(windowData);\r\n        }\r\n\r\n        // Restore metadata (theme, language, etc.)\r\n        if (session.metadata) {\r\n            this.restoreMetadata(session.metadata);\r\n        }\r\n\r\n        console.log('[MultiWindowSessionManager] Session restored successfully');\r\n\r\n        // Update dock indicators after session restore\r\n        const W = window as any;\r\n        W.updateDockIndicators?.();\r\n    }\r\n\r\n    /**\r\n     * Restore a single window with its tabs\r\n     */\r\n    private async restoreWindow(data: WindowSessionData): Promise<BaseWindow | null> {\r\n        try {\r\n            // Create window based on type (without showing it yet)\r\n            const window = this.createWindowByType(data.type, data);\r\n            if (!window) {\r\n                console.error(`[MultiWindowSessionManager] Unknown window type: ${data.type}`);\r\n                return null;\r\n            }\r\n\r\n            // Restore tabs\r\n            for (const tabData of data.tabs) {\r\n                const tab = this.restoreTab(tabData);\r\n                if (tab) {\r\n                    window.addTab(tab);\r\n                }\r\n            }\r\n\r\n            // Set active tab\r\n            if (data.activeTabId && window.tabs.has(data.activeTabId)) {\r\n                window.setActiveTab(data.activeTabId);\r\n            } else if (window.tabs.size > 0) {\r\n                // Fallback to first tab\r\n                const firstTabId = Array.from(window.tabs.keys())[0];\r\n                if (firstTabId) window.setActiveTab(firstTabId);\r\n            }\r\n\r\n            // Show window and register\r\n            window.show();\r\n            WindowRegistry.registerWindow(window);\r\n\r\n            // Apply window state after DOM is ready\r\n            setTimeout(() => {\r\n                if (window.element) {\r\n                    window.element.style.zIndex = String(data.zIndex);\r\n\r\n                    // Restore position\r\n                    if (data.position && !data.isMaximized) {\r\n                        window.element.style.left = `${data.position.x}px`;\r\n                        window.element.style.top = `${data.position.y}px`;\r\n                        window.element.style.width = `${data.position.width}px`;\r\n                        window.element.style.height = `${data.position.height}px`;\r\n                        // Update internal position tracking\r\n                        window.position = { ...data.position };\r\n                    }\r\n\r\n                    if (data.isMinimized) {\r\n                        window.minimize();\r\n                    } else if (data.isMaximized && !window.isMaximized) {\r\n                        window.toggleMaximize();\r\n                    }\r\n                }\r\n            }, 0);\r\n\r\n            return window;\r\n        } catch (error) {\r\n            console.error('[MultiWindowSessionManager] Failed to restore window:', error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create window by type\r\n     */\r\n    private createWindowByType(type: string, data: WindowSessionData): BaseWindow | null {\r\n        const config = {\r\n            id: data.id,\r\n            type: type,\r\n            position: data.position,\r\n            metadata: data.metadata,\r\n        };\r\n\r\n        switch (type) {\r\n            case 'terminal':\r\n                return new TerminalWindow(config);\r\n\r\n            case 'text-editor':\r\n                return new TextEditorWindow(config);\r\n\r\n            case 'finder':\r\n                return new FinderWindow(config);\r\n\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Restore a single tab\r\n     */\r\n    private restoreTab(data: TabState): any {\r\n        try {\r\n            // Determine tab class based on type\r\n            switch (data.type) {\r\n                case 'terminal-session':\r\n                    return TerminalSession.deserialize(data);\r\n\r\n                case 'text-editor-document':\r\n                    return TextEditorDocument.deserialize(data);\r\n\r\n                case 'finder-view':\r\n                    return FinderView.deserialize(data);\r\n\r\n                default:\r\n                    console.warn(`[MultiWindowSessionManager] Unknown tab type: ${data.type}`);\r\n                    return null;\r\n            }\r\n        } catch (error) {\r\n            console.error('[MultiWindowSessionManager] Failed to restore tab:', error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Migrate legacy path formats (Computer/Home \u2192 /home/marvin)\r\n     */\r\n    private migrateLegacyPath(path: string | undefined | null): string {\r\n        if (!path) return '/home/marvin';\r\n\r\n        // Already in new format\r\n        if (path.startsWith('/')) return path;\r\n\r\n        // Computer/Home \u2192 /home/marvin\r\n        if (path === 'Computer' || path === '~') {\r\n            return '/home/marvin';\r\n        }\r\n\r\n        if (path.startsWith('Computer/Home')) {\r\n            // Computer/Home \u2192 /home/marvin\r\n            // Computer/Home/Documents \u2192 /home/marvin/Documents\r\n            const subPath = path.slice('Computer/Home'.length);\r\n            return subPath ? `/home/marvin${subPath}` : '/home/marvin';\r\n        }\r\n\r\n        if (path.startsWith('Computer/')) {\r\n            // Computer/Documents \u2192 /home/marvin/Documents\r\n            const subPath = path.slice('Computer/'.length);\r\n            return `/home/marvin/${subPath}`;\r\n        }\r\n\r\n        // Handle tilde expansion\r\n        if (path.startsWith('~/')) {\r\n            return '/home/marvin/' + path.slice(2);\r\n        }\r\n\r\n        // Relative path - prepend /home/marvin/\r\n        return `/home/marvin/${path}`;\r\n    }\r\n\r\n    /**\r\n     * Migrate paths in session data\r\n     */\r\n    private migrateSessionPaths(session: any): void {\r\n        if (!session || !session.windows) return;\r\n\r\n        for (const window of session.windows) {\r\n            // Handle legacy format: windows[].sessions[]\r\n            const tabsArray = window.tabs || window.sessions || [];\r\n\r\n            for (const tab of tabsArray) {\r\n                // Migrate vfsCwd for terminal sessions\r\n                if (tab.vfsCwd) {\r\n                    const migrated = this.migrateLegacyPath(tab.vfsCwd);\r\n                    console.log(\r\n                        `[MultiWindowSessionManager] Migrating path: ${tab.vfsCwd} \u2192 ${migrated}`\r\n                    );\r\n                    tab.vfsCwd = migrated;\r\n                }\r\n\r\n                // Also check currentPath (legacy field)\r\n                if (tab.currentPath && !tab.vfsCwd) {\r\n                    const migrated = this.migrateLegacyPath(tab.currentPath);\r\n                    console.log(\r\n                        `[MultiWindowSessionManager] Migrating currentPath: ${tab.currentPath} \u2192 ${migrated}`\r\n                    );\r\n                    tab.vfsCwd = migrated;\r\n                    tab.currentPath = migrated;\r\n                }\r\n\r\n                // Migrate contentState.vfsCwd if it exists\r\n                if (tab.contentState?.vfsCwd) {\r\n                    const migrated = this.migrateLegacyPath(tab.contentState.vfsCwd);\r\n                    tab.contentState.vfsCwd = migrated;\r\n                }\r\n\r\n                // Migrate contentState.currentPath if it exists\r\n                if (tab.contentState?.currentPath) {\r\n                    const migrated = this.migrateLegacyPath(tab.contentState.currentPath);\r\n                    tab.contentState.currentPath = migrated;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Normalize legacy session format to current format\r\n     * Handles old format with windowId/sessions instead of id/tabs\r\n     */\r\n    private normalizeLegacyV1Session(session: any): MultiWindowSession {\r\n        const normalized: MultiWindowSession = {\r\n            version: MultiWindowSessionManager.VERSION,\r\n            timestamp: session.timestamp || Date.now(),\r\n            windows: [],\r\n            metadata: session.metadata || {},\r\n        };\r\n\r\n        for (const window of session.windows || []) {\r\n            const windowData: WindowSessionData = {\r\n                id: window.id || window.windowId || `window-${Date.now()}`,\r\n                type: window.type || session.windowType || 'terminal',\r\n                position: window.position || { x: 100, y: 100, width: 800, height: 600 },\r\n                zIndex: window.zIndex || 100,\r\n                isMinimized: window.isMinimized || false,\r\n                isMaximized: window.isMaximized || false,\r\n                activeTabId: window.activeTabId || null,\r\n                tabs: [],\r\n                metadata: window.metadata || {},\r\n            };\r\n\r\n            // Convert sessions[] to tabs[]\r\n            const tabsSource = window.tabs || window.sessions || [];\r\n            for (const tab of tabsSource) {\r\n                const tabData: any = {\r\n                    id: tab.id || tab.sessionId || `tab-${Date.now()}-${Math.random()}`,\r\n                    type: tab.type || 'terminal-session',\r\n                    title: tab.title || 'Terminal',\r\n                    icon: tab.icon,\r\n                    contentState: tab.contentState || {},\r\n                    created: tab.created || Date.now(),\r\n                    modified: tab.modified || Date.now(),\r\n                };\r\n\r\n                // Copy relevant fields to tab data\r\n                if (tab.vfsCwd) tabData.vfsCwd = tab.vfsCwd;\r\n                if (tab.currentPath) tabData.currentPath = tab.currentPath;\r\n                if (tab.commandHistory) tabData.commandHistory = tab.commandHistory;\r\n\r\n                windowData.tabs.push(tabData);\r\n            }\r\n\r\n            // Set activeTabId if not set\r\n            if (!windowData.activeTabId && windowData.tabs.length > 0) {\r\n                const firstTab = windowData.tabs[0];\r\n                if (firstTab) {\r\n                    windowData.activeTabId = firstTab.id;\r\n                }\r\n            }\r\n\r\n            normalized.windows.push(windowData);\r\n        }\r\n\r\n        return normalized;\r\n    }\r\n\r\n    /**\r\n     * Migrate legacy single-window session to multi-window format\r\n     */\r\n    private async migrateLegacySession(legacy: LegacySession): Promise<void> {\r\n        console.log('[MultiWindowSessionManager] Starting legacy migration...');\r\n\r\n        const instances = legacy.instances || {};\r\n\r\n        // Create terminal window if there are terminal sessions\r\n        if (instances['terminal'] && instances['terminal'].length > 0) {\r\n            const termWindow = TerminalWindow.create();\r\n\r\n            for (const sessionData of instances['terminal']) {\r\n                try {\r\n                    const session = TerminalSession.deserialize(sessionData);\r\n                    termWindow.addTab(session);\r\n                } catch (error) {\r\n                    console.error(\r\n                        '[MultiWindowSessionManager] Failed to migrate terminal session:',\r\n                        error\r\n                    );\r\n                }\r\n            }\r\n\r\n            if (termWindow.tabs.size > 0) {\r\n                const firstTabId = Array.from(termWindow.tabs.keys())[0];\r\n                if (firstTabId) termWindow.setActiveTab(firstTabId);\r\n            }\r\n        }\r\n\r\n        // Create text editor window if there are documents\r\n        if (instances['text-editor'] && instances['text-editor'].length > 0) {\r\n            const editorWindow = TextEditorWindow.create();\r\n\r\n            for (const docData of instances['text-editor']) {\r\n                try {\r\n                    const doc = TextEditorDocument.deserialize(docData);\r\n                    editorWindow.addTab(doc);\r\n                } catch (error) {\r\n                    console.error(\r\n                        '[MultiWindowSessionManager] Failed to migrate text editor document:',\r\n                        error\r\n                    );\r\n                }\r\n            }\r\n\r\n            if (editorWindow.tabs.size > 0) {\r\n                const firstTabId = Array.from(editorWindow.tabs.keys())[0];\r\n                if (firstTabId) editorWindow.setActiveTab(firstTabId);\r\n            }\r\n        }\r\n\r\n        // Create finder window if there are finder instances\r\n        if (instances['finder'] && instances['finder'].length > 0) {\r\n            const finderWindow = FinderWindow.create();\r\n\r\n            for (const viewData of instances['finder']) {\r\n                try {\r\n                    const view = FinderView.deserialize(viewData);\r\n                    finderWindow.addTab(view);\r\n                } catch (error) {\r\n                    console.error(\r\n                        '[MultiWindowSessionManager] Failed to migrate finder view:',\r\n                        error\r\n                    );\r\n                }\r\n            }\r\n\r\n            if (finderWindow.tabs.size > 0) {\r\n                const firstTabId = Array.from(finderWindow.tabs.keys())[0];\r\n                if (firstTabId) finderWindow.setActiveTab(firstTabId);\r\n            }\r\n        }\r\n\r\n        // Save new format and clear legacy\r\n        this.saveSessionImmediate();\r\n        localStorage.removeItem(MultiWindowSessionManager.LEGACY_STORAGE_KEY);\r\n\r\n        console.log('[MultiWindowSessionManager] Legacy migration completed');\r\n    }\r\n\r\n    /**\r\n     * Export session as JSON string\r\n     */\r\n    exportSession(): string {\r\n        const session = this.createSession();\r\n        return JSON.stringify(session, null, 2);\r\n    }\r\n\r\n    /**\r\n     * Import session from JSON string\r\n     */\r\n    async importSession(jsonString: string): Promise<boolean> {\r\n        try {\r\n            const session = JSON.parse(jsonString) as MultiWindowSession;\r\n\r\n            // Validate version\r\n            if (session.version !== MultiWindowSessionManager.VERSION) {\r\n                console.warn(\r\n                    '[MultiWindowSessionManager] Version mismatch, attempting import anyway'\r\n                );\r\n            }\r\n\r\n            // Close all current windows\r\n            WindowRegistry.closeAllWindows();\r\n\r\n            // Restore imported session\r\n            await this.restoreMultiWindowSession(session);\r\n\r\n            return true;\r\n        } catch (error) {\r\n            console.error('[MultiWindowSessionManager] Failed to import session:', error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear current session\r\n     */\r\n    clearSession(): void {\r\n        localStorage.removeItem(MultiWindowSessionManager.STORAGE_KEY);\r\n        console.log('[MultiWindowSessionManager] Session cleared');\r\n    }\r\n\r\n    /**\r\n     * Get current theme preference\r\n     */\r\n    private getCurrentTheme(): string {\r\n        return localStorage.getItem('theme-preference') || 'auto';\r\n    }\r\n\r\n    /**\r\n     * Get current language preference\r\n     */\r\n    private getCurrentLanguage(): string {\r\n        return localStorage.getItem('language-preference') || 'de';\r\n    }\r\n\r\n    /**\r\n     * Restore session metadata\r\n     */\r\n    private restoreMetadata(metadata: Record<string, any>): void {\r\n        // Theme and language are handled by existing systems\r\n        console.log('[MultiWindowSessionManager] Session metadata:', metadata);\r\n    }\r\n\r\n    /**\r\n     * Get session info (for debugging)\r\n     */\r\n    getSessionInfo(): any {\r\n        const sessionData = localStorage.getItem(MultiWindowSessionManager.STORAGE_KEY);\r\n        if (!sessionData) return null;\r\n\r\n        try {\r\n            const session = JSON.parse(sessionData) as MultiWindowSession;\r\n            return {\r\n                version: session.version,\r\n                timestamp: new Date(session.timestamp),\r\n                windowCount: session.windows.length,\r\n                tabCount: session.windows.reduce((sum, w) => sum + w.tabs.length, 0),\r\n                windows: session.windows.map(w => ({\r\n                    type: w.type,\r\n                    tabs: w.tabs.length,\r\n                    activeTab: w.activeTabId,\r\n                    position: w.position,\r\n                })),\r\n            };\r\n        } catch {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Debug log current session state\r\n     */\r\n    debugLog(): void {\r\n        const info = this.getSessionInfo();\r\n        console.log('[MultiWindowSessionManager] Current session:', info);\r\n    }\r\n}\r\n\r\n// Create and expose singleton\r\nconst multiWindowSessionManager = new MultiWindowSessionManager();\r\n(window as any).MultiWindowSessionManager = multiWindowSessionManager;\r\n\r\nexport default multiWindowSessionManager;\r\n", "/**\r\n * SessionManager - Debounced Auto-Save System for Window Instances\r\n *\r\n * Provides centralized, debounced persistence of window instance state to localStorage.\r\n * Handles storage quota limits gracefully and coordinates saves across multiple instances.\r\n */\r\n\r\nconsole.log('SessionManager loaded');\r\n\r\nimport { getJSON, setJSON, remove } from '../services/storage-utils.js';\r\n\r\n(() => {\r\n    'use strict';\r\n\r\n    // ===== Types =====\r\n    type InstanceData = {\r\n        instanceId: string;\r\n        type: string;\r\n        title: string;\r\n        state: Record<string, unknown>;\r\n        metadata: Record<string, unknown>;\r\n    };\r\n\r\n    type SessionData = {\r\n        version: string;\r\n        timestamp: number;\r\n        instances: Record<string, InstanceData[]>; // Keyed by instance type (terminal, text-editor, etc.)\r\n        active?: Record<string, string | null>; // Keyed by type -> active instanceId\r\n        windowStack?: string[]; // Z-index order of windows (bottom to top)\r\n    };\r\n\r\n    type SaveOptions = {\r\n        immediate?: boolean; // Skip debounce and save immediately\r\n    };\r\n\r\n    // ===== Constants =====\r\n    const SESSION_STORAGE_KEY = 'windowInstancesSession';\r\n    const SESSION_VERSION = '1.0';\r\n    const DEFAULT_DEBOUNCE_MS = 750; // Conservative default\r\n    const MAX_STORAGE_SIZE = 5 * 1024 * 1024; // 5MB conservative limit (most browsers allow 5-10MB)\r\n\r\n    // ===== Module Variables =====\r\n    let saveTimer: number | null = null;\r\n    let debounceDelay = DEFAULT_DEBOUNCE_MS;\r\n    let pendingSaveTypes = new Set<string>(); // Track which instance types need saving\r\n    let quotaExceeded = false;\r\n    let saveInProgress = false;\r\n\r\n    // ===== Storage Helpers =====\r\n\r\n    /**\r\n     * Estimate size of data in bytes (rough approximation)\r\n     */\r\n    function estimateSize(data: unknown): number {\r\n        try {\r\n            return JSON.stringify(data).length * 2; // Rough UTF-16 byte estimate\r\n        } catch {\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if storage quota is available\r\n     */\r\n    function checkStorageQuota(dataSize: number): boolean {\r\n        if (quotaExceeded) {\r\n            return false;\r\n        }\r\n        return dataSize < MAX_STORAGE_SIZE;\r\n    }\r\n\r\n    /**\r\n     * Read session from localStorage\r\n     */\r\n    function readSession(): SessionData | null {\r\n        try {\r\n            const parsed = getJSON<SessionData | null>(SESSION_STORAGE_KEY, null);\r\n            if (!parsed || typeof parsed !== 'object') return null;\r\n            if (parsed.version !== SESSION_VERSION) {\r\n                console.warn(\r\n                    `SessionManager: Version mismatch (stored: ${parsed.version}, expected: ${SESSION_VERSION})`\r\n                );\r\n                return null;\r\n            }\r\n            return parsed;\r\n        } catch (err) {\r\n            console.warn('SessionManager: Failed to read session:', err);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Write session to localStorage with quota handling\r\n     */\r\n    function writeSession(session: SessionData): boolean {\r\n        const size = estimateSize(session);\r\n\r\n        if (!checkStorageQuota(size)) {\r\n            if (!quotaExceeded) {\r\n                console.error('SessionManager: Storage quota exceeded. Auto-save disabled.');\r\n                console.error(\r\n                    `Attempted to save ${(size / 1024).toFixed(2)}KB, limit is ${(MAX_STORAGE_SIZE / 1024).toFixed(2)}KB`\r\n                );\r\n                quotaExceeded = true;\r\n            }\r\n            return false;\r\n        }\r\n\r\n        try {\r\n            setJSON(SESSION_STORAGE_KEY, session);\r\n            quotaExceeded = false; // Reset flag on successful save\r\n            return true;\r\n        } catch (err) {\r\n            if (err instanceof Error && err.name === 'QuotaExceededError') {\r\n                console.error('SessionManager: Storage quota exceeded:', err);\r\n                quotaExceeded = true;\r\n            } else {\r\n                console.error('SessionManager: Failed to write session:', err);\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear session from localStorage\r\n     */\r\n    function clearSession(): void {\r\n        try {\r\n            remove(SESSION_STORAGE_KEY);\r\n            console.log('SessionManager: Session cleared');\r\n        } catch (err) {\r\n            console.warn('SessionManager: Failed to clear session:', err);\r\n        }\r\n    }\r\n\r\n    // ===== Instance Manager Integration =====\r\n\r\n    /**\r\n     * Get all instance managers registered globally\r\n     */\r\n    function getInstanceManagers(): Map<string, unknown> {\r\n        const managers = new Map<string, unknown>();\r\n        const w = window as unknown as Record<string, unknown>;\r\n\r\n        // Known instance managers (terminal, text-editor)\r\n        // NOTE: Finder is now handled by MultiWindowSessionManager, not legacy SessionManager\r\n        const knownManagers = ['TerminalInstanceManager', 'TextEditorInstanceManager'];\r\n\r\n        knownManagers.forEach(key => {\r\n            const manager = w[key];\r\n            if (manager && typeof manager === 'object') {\r\n                const mgr = manager as Record<string, unknown>;\r\n                const type =\r\n                    typeof mgr.type === 'string'\r\n                        ? mgr.type\r\n                        : key.replace('InstanceManager', '').toLowerCase();\r\n                managers.set(type, manager);\r\n            }\r\n        });\r\n\r\n        return managers;\r\n    }\r\n\r\n    /**\r\n     * Serialize all instances from all managers\r\n     */\r\n    function serializeAllInstances(): {\r\n        instances: Record<string, InstanceData[]>;\r\n        active: Record<string, string | null>;\r\n    } {\r\n        const result: Record<string, InstanceData[]> = {};\r\n        const active: Record<string, string | null> = {};\r\n        const managers = getInstanceManagers();\r\n\r\n        managers.forEach((manager, type) => {\r\n            const mgr = manager as Record<string, unknown>;\r\n            if (typeof mgr.serializeAll === 'function') {\r\n                try {\r\n                    const instances = (\r\n                        mgr.serializeAll as unknown as (this: unknown) => unknown\r\n                    ).call(mgr);\r\n                    if (Array.isArray(instances)) {\r\n                        result[type] = instances as InstanceData[];\r\n                    }\r\n                } catch (err) {\r\n                    console.error(\r\n                        `SessionManager: Failed to serialize instances for type \"${type}\":`,\r\n                        err\r\n                    );\r\n                }\r\n            }\r\n\r\n            // Capture active instanceId per type if available\r\n            try {\r\n                if (typeof (mgr as any).getActiveInstance === 'function') {\r\n                    const activeInst = (mgr as any).getActiveInstance.call(mgr);\r\n                    active[type] = activeInst?.instanceId || null;\r\n                } else {\r\n                    active[type] = null;\r\n                }\r\n            } catch {\r\n                active[type] = null;\r\n            }\r\n        });\r\n\r\n        return { instances: result, active };\r\n    }\r\n\r\n    // ===== Core Save Logic =====\r\n\r\n    /**\r\n     * Perform the actual save operation\r\n     */\r\n    function performSave(): void {\r\n        if (saveInProgress) {\r\n            console.warn('SessionManager: Save already in progress, skipping');\r\n            return;\r\n        }\r\n\r\n        saveInProgress = true;\r\n\r\n        try {\r\n            const { instances, active } = serializeAllInstances();\r\n\r\n            // Capture current window z-index order from Dialog's __zIndexManager\r\n            const zIndexManager = (window as any).__zIndexManager;\r\n            const windowStack =\r\n                zIndexManager && typeof zIndexManager.getWindowStack === 'function'\r\n                    ? zIndexManager.getWindowStack()\r\n                    : [];\r\n\r\n            const session: SessionData = {\r\n                version: SESSION_VERSION,\r\n                timestamp: Date.now(),\r\n                instances,\r\n                active,\r\n                windowStack,\r\n            };\r\n\r\n            const success = writeSession(session);\r\n            if (success) {\r\n                const instanceCount = Object.values(instances).reduce(\r\n                    (sum, arr) => sum + arr.length,\r\n                    0\r\n                );\r\n                console.log(\r\n                    `SessionManager: Saved ${instanceCount} instances across ${Object.keys(instances).length} types`\r\n                );\r\n            }\r\n\r\n            pendingSaveTypes.clear();\r\n        } catch (err) {\r\n            console.error('SessionManager: Save failed:', err);\r\n        } finally {\r\n            saveInProgress = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Schedule a debounced save\r\n     */\r\n    function scheduleSave(instanceType?: string): void {\r\n        if (instanceType) {\r\n            pendingSaveTypes.add(instanceType);\r\n        }\r\n\r\n        if (saveTimer !== null) {\r\n            clearTimeout(saveTimer);\r\n        }\r\n\r\n        saveTimer = window.setTimeout(() => {\r\n            saveTimer = null;\r\n            performSave();\r\n        }, debounceDelay);\r\n    }\r\n\r\n    // ===== Public API =====\r\n\r\n    /**\r\n     * Save all instances immediately (skip debounce)\r\n     */\r\n    function saveAll(options: SaveOptions = {}): void {\r\n        if (options.immediate) {\r\n            if (saveTimer !== null) {\r\n                clearTimeout(saveTimer);\r\n                saveTimer = null;\r\n            }\r\n            performSave();\r\n        } else {\r\n            scheduleSave();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Save instances of a specific type (debounced by default)\r\n     */\r\n    function saveInstanceType(instanceType: string, options: SaveOptions = {}): void {\r\n        if (options.immediate) {\r\n            if (saveTimer !== null) {\r\n                clearTimeout(saveTimer);\r\n                saveTimer = null;\r\n            }\r\n            performSave();\r\n        } else {\r\n            scheduleSave(instanceType);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Restore session from localStorage\r\n     */\r\n    function restoreSession(): boolean {\r\n        const session = readSession();\r\n        // Debugging: surface session contents and available managers to E2E traces\r\n        try {\r\n            console.info('[SessionManager] restoreSession invoked');\r\n            console.debug('[SessionManager] raw session:', session);\r\n        } catch {\r\n            /* ignore */\r\n        }\r\n        if (!session) {\r\n            console.log('SessionManager: No session to restore');\r\n            return false;\r\n        }\r\n\r\n        const managers = getInstanceManagers();\r\n        try {\r\n            console.info('[SessionManager] discovered managers:', Array.from(managers.keys()));\r\n        } catch {\r\n            /* ignore */\r\n        }\r\n        let restoredCount = 0;\r\n\r\n        const activeMap = (session as SessionData).active || {};\r\n\r\n        Object.entries(session.instances).forEach(([type, instances]) => {\r\n            const manager = managers.get(type);\r\n            if (!manager) {\r\n                console.warn(`SessionManager: No manager found for type \"${type}\"`);\r\n                return;\r\n            }\r\n\r\n            const mgr = manager as Record<string, unknown>;\r\n            if (typeof mgr.deserializeAll === 'function') {\r\n                try {\r\n                    (mgr.deserializeAll as (data: InstanceData[]) => void)(instances);\r\n                    restoredCount += instances.length;\r\n                    console.log(`SessionManager: Restored ${instances.length} \"${type}\" instances`);\r\n                    // Restore previously active instance for this type if present\r\n                    const activeId = activeMap[type] || null;\r\n                    if (activeId && typeof (mgr as any).setActiveInstance === 'function') {\r\n                        try {\r\n                            (mgr as any).setActiveInstance(activeId);\r\n                        } catch (e) {\r\n                            console.warn(\r\n                                `SessionManager: Failed to set active instance for ${type}:`,\r\n                                e\r\n                            );\r\n                        }\r\n                    }\r\n                } catch (err) {\r\n                    console.error(\r\n                        `SessionManager: Failed to restore instances for type \"${type}\":`,\r\n                        err\r\n                    );\r\n                }\r\n            }\r\n        });\r\n\r\n        // Restore z-index order from saved windowStack\r\n        const windowStack = session.windowStack || [];\r\n        if (windowStack.length > 0) {\r\n            const zIndexManager = (window as any).__zIndexManager;\r\n            if (zIndexManager && typeof zIndexManager.restoreWindowStack === 'function') {\r\n                try {\r\n                    zIndexManager.restoreWindowStack(windowStack);\r\n                    console.log(\r\n                        `SessionManager: Restored z-index order for ${windowStack.length} windows`\r\n                    );\r\n                } catch (err) {\r\n                    console.warn('SessionManager: Failed to restore window z-index order:', err);\r\n                }\r\n            }\r\n        }\r\n\r\n        console.log(`SessionManager: Restored ${restoredCount} instances total`);\r\n        return restoredCount > 0;\r\n    }\r\n\r\n    /**\r\n     * Configure debounce delay\r\n     */\r\n    function setDebounceDelay(ms: number): void {\r\n        if (ms < 100 || ms > 5000) {\r\n            console.warn(`SessionManager: Invalid debounce delay ${ms}ms, must be 100-5000ms`);\r\n            return;\r\n        }\r\n        debounceDelay = ms;\r\n        console.log(`SessionManager: Debounce delay set to ${ms}ms`);\r\n    }\r\n\r\n    /**\r\n     * Get current debounce delay\r\n     */\r\n    function getDebounceDelay(): number {\r\n        return debounceDelay;\r\n    }\r\n\r\n    /**\r\n     * Clear all saved session data\r\n     */\r\n    function clear(): void {\r\n        if (saveTimer !== null) {\r\n            clearTimeout(saveTimer);\r\n            saveTimer = null;\r\n        }\r\n        pendingSaveTypes.clear();\r\n        clearSession();\r\n        quotaExceeded = false;\r\n    }\r\n\r\n    /**\r\n     * Get session statistics\r\n     */\r\n    function getStats() {\r\n        const session = readSession();\r\n        if (!session) {\r\n            return {\r\n                hasSession: false,\r\n                instanceCount: 0,\r\n                types: [],\r\n                timestamp: null,\r\n                sizeBytes: 0,\r\n            };\r\n        }\r\n\r\n        const instanceCount = Object.values(session.instances).reduce(\r\n            (sum, arr) => sum + arr.length,\r\n            0\r\n        );\r\n        const types = Object.keys(session.instances);\r\n        const sizeBytes = estimateSize(session);\r\n\r\n        return {\r\n            hasSession: true,\r\n            instanceCount,\r\n            types,\r\n            timestamp: session.timestamp,\r\n            sizeBytes,\r\n            quotaExceeded,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Compatibility: return storage info expected by some legacy tests\r\n     * Mirrors getStats but provides the shape `getStorageInfo` used in tests\r\n     */\r\n    function getStorageInfo() {\r\n        const stats = getStats();\r\n        return {\r\n            hasSession: stats.hasSession,\r\n            instanceCount: stats.instanceCount,\r\n            types: stats.types,\r\n            timestamp: stats.timestamp,\r\n            sizeBytes: stats.sizeBytes,\r\n            quotaExceeded: stats.quotaExceeded,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Export current session as JSON string\r\n     * @returns JSON string of current session or null if no session exists\r\n     */\r\n    function exportSession(): string | null {\r\n        // First save current state to ensure we export the latest\r\n        performSave();\r\n\r\n        const session = readSession();\r\n        if (!session) {\r\n            console.warn('SessionManager: No session to export');\r\n            return null;\r\n        }\r\n\r\n        try {\r\n            // Pretty-print for human readability\r\n            const json = JSON.stringify(session, null, 2);\r\n            console.log(`SessionManager: Exported session (${(json.length / 1024).toFixed(2)}KB)`);\r\n            return json;\r\n        } catch (err) {\r\n            console.error('SessionManager: Failed to export session:', err);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Import session from JSON string\r\n     * @param json - JSON string containing session data\r\n     * @returns true if import successful, false otherwise\r\n     */\r\n    function importSession(json: string): boolean {\r\n        if (!json || typeof json !== 'string') {\r\n            console.error('SessionManager: Invalid import data (must be non-empty string)');\r\n            return false;\r\n        }\r\n\r\n        let session: SessionData;\r\n        try {\r\n            session = JSON.parse(json) as SessionData;\r\n        } catch (err) {\r\n            console.error('SessionManager: Failed to parse import JSON:', err);\r\n            return false;\r\n        }\r\n\r\n        // Validate schema\r\n        if (!session || typeof session !== 'object') {\r\n            console.error('SessionManager: Invalid session data (must be object)');\r\n            return false;\r\n        }\r\n\r\n        if (!session.version || typeof session.version !== 'string') {\r\n            console.error('SessionManager: Missing or invalid version field');\r\n            return false;\r\n        }\r\n\r\n        // Version compatibility check\r\n        if (session.version !== SESSION_VERSION) {\r\n            console.warn(\r\n                `SessionManager: Version mismatch (imported: ${session.version}, current: ${SESSION_VERSION})`\r\n            );\r\n            // For now, we're strict about versions. Future: implement migration logic\r\n            console.error('SessionManager: Cannot import session from different version');\r\n            return false;\r\n        }\r\n\r\n        if (!session.instances || typeof session.instances !== 'object') {\r\n            console.error('SessionManager: Missing or invalid instances field');\r\n            return false;\r\n        }\r\n\r\n        // Write to localStorage (will validate quota)\r\n        const success = writeSession(session);\r\n        if (!success) {\r\n            console.error('SessionManager: Failed to save imported session to storage');\r\n            return false;\r\n        }\r\n\r\n        // Restore the imported session\r\n        const restored = restoreSession();\r\n        if (!restored) {\r\n            console.warn('SessionManager: Imported session saved but restoration failed');\r\n            return false;\r\n        }\r\n\r\n        console.log('SessionManager: Successfully imported and restored session');\r\n        return true;\r\n    }\r\n\r\n    // ===== Lifecycle Hooks =====\r\n\r\n    /**\r\n     * Initialize auto-save system and browser lifecycle hooks\r\n     */\r\n    function init(): void {\r\n        console.log('SessionManager: Initializing auto-save system');\r\n\r\n        // Save on window blur (user switching away)\r\n        window.addEventListener('blur', () => {\r\n            saveAll({ immediate: true });\r\n        });\r\n\r\n        // Save on beforeunload (page closing/refreshing)\r\n        // DISABLED: Causes corrupted session, multi-window-session handles persistence\r\n        // window.addEventListener('beforeunload', () => {\r\n        //     // Must be immediate to complete before page unload\r\n        //     performSave();\r\n        // });\r\n\r\n        // Save on visibility change (tab hidden)\r\n        document.addEventListener('visibilitychange', () => {\r\n            if (document.hidden) {\r\n                saveAll({ immediate: true });\r\n            }\r\n        });\r\n\r\n        console.log(`SessionManager: Initialized with ${debounceDelay}ms debounce`);\r\n    }\r\n\r\n    // ===== Global API =====\r\n\r\n    /**\r\n     * Legacy no-op: Managers are auto-discovered\r\n     * @deprecated Use automatic discovery instead\r\n     */\r\n    function registerManager(_type: string, _manager: unknown): void {\r\n        // No-op: Auto-discovery handles this\r\n        console.log(`SessionManager: registerManager() is deprecated - using auto-discovery`);\r\n    }\r\n\r\n    /**\r\n     * Legacy no-op: Managers are auto-discovered\r\n     * @deprecated Use automatic discovery instead\r\n     */\r\n    function unregisterManager(_type: string): void {\r\n        // No-op: Auto-discovery handles this\r\n    }\r\n\r\n    const SessionManager = {\r\n        init,\r\n        saveAll,\r\n        saveAllSessions: saveAll, // Alias for backwards compatibility with tests\r\n        saveInstanceType,\r\n        restoreSession,\r\n        clear,\r\n        setDebounceDelay,\r\n        getDebounceDelay,\r\n        getStats,\r\n        getStorageInfo,\r\n        exportSession,\r\n        importSession,\r\n        registerManager, // Legacy compatibility\r\n        unregisterManager, // Legacy compatibility\r\n    };\r\n\r\n    (window as unknown as { SessionManager: typeof SessionManager }).SessionManager =\r\n        SessionManager;\r\n})();\r\n", "/**\r\n * WindowTabs \u2013 generische Tab-Leiste f\u00FCr Fenster\r\n *\r\n * Dieses Modul kapselt Rendering und Interaktion einer Tabbar, die an einen\r\n * beliebigen Instanz-Manager gekoppelt wird. Der Manager muss ein schmales\r\n * Interface bereitstellen (getAllInstances, setActiveInstance, destroyInstance, ...).\r\n *\r\n * Features\r\n * --------\r\n * - Reordering der Tabs via Drag&Drop\r\n * - Cross\u2011Window\u2011Drag: Tabs k\u00F6nnen auf eine andere Tabbar gezogen werden\r\n *   (Manager.adoptInstance/detachInstance).\r\n * - Desktop\u2011Drop: Tab auf freien Desktop-Bereich ziehen -> neues Fenster wird\r\n *   erzeugt (FinderWindow/TextEditorWindow/TerminalWindow je nach Typ).\r\n * - Add\u2011Button f\u00FCr neue Instanzen (+)\r\n * - setTitle(instanceId, title) um Tab\u2011Labels dynamisch zu aktualisieren\r\n */\r\n(function () {\r\n    'use strict';\r\n\r\n    // Minimal structural types to avoid runtime coupling\r\n    type Instance = {\r\n        instanceId: string;\r\n        title: string;\r\n        metadata?: Record<string, unknown>;\r\n        focus?: () => void;\r\n        blur?: () => void;\r\n        destroy?: () => void;\r\n        show?: () => void;\r\n        hide?: () => void;\r\n    };\r\n\r\n    type InstanceConfig = {\r\n        id?: string;\r\n        type?: string;\r\n        title?: string;\r\n        initialState?: unknown;\r\n        metadata?: Record<string, unknown>;\r\n    };\r\n\r\n    type Manager = {\r\n        getAllInstances(): Instance[];\r\n        getActiveInstance(): Instance | null;\r\n        getAllInstanceIds(): string[];\r\n        getInstance(id: string): Instance | null;\r\n        setActiveInstance(id: string): void;\r\n        createInstance(config?: Partial<InstanceConfig>): Instance | null;\r\n        destroyInstance(id: string): void;\r\n        getInstanceCount?: () => number;\r\n        reorderInstances?: (newOrder: string[]) => void;\r\n        detachInstance?: (id: string) => Instance | null;\r\n        adoptInstance?: (inst: Instance) => Instance | null;\r\n    };\r\n\r\n    interface WindowTabsOptions {\r\n        addButton?: boolean;\r\n        onCreateInstanceTitle?: () => string | undefined;\r\n    }\r\n\r\n    interface WindowTabsController {\r\n        el: HTMLElement;\r\n        refresh(): void;\r\n        destroy(): void;\r\n        setTitle(instanceId: string, title: string): void;\r\n    }\r\n\r\n    // (reserved) helper could be added later to skip shortcuts in inputs\r\n\r\n    // Drag state for tab reordering and cross-window moves\r\n    let draggedTab: HTMLElement | null = null;\r\n    let draggedInstanceId: string | null = null;\r\n    let draggedManager: Manager | null = null;\r\n    let draggedInstanceObj: Instance | null = null;\r\n\r\n    function createTabEl(instance: Instance, isActive: boolean): HTMLElement {\r\n        const tab = document.createElement('button');\r\n        tab.type = 'button';\r\n        tab.className = [\r\n            'wt-tab',\r\n            'px-3 py-1 text-sm rounded-t-md border border-b-0',\r\n            'transition-colors whitespace-nowrap flex items-center gap-2',\r\n            isActive\r\n                ? 'bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 border-gray-300 dark:border-gray-700'\r\n                : 'bg-gray-200/70 dark:bg-gray-800/70 text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-700 hover:bg-gray-200 dark:hover:bg-gray-800',\r\n        ].join(' ');\r\n        tab.dataset.instanceId = instance.instanceId;\r\n        tab.draggable = true;\r\n\r\n        const title = document.createElement('span');\r\n        title.className = 'wt-tab-title';\r\n        const tabLabel = (instance as any).metadata?.tabLabel as string | undefined;\r\n        title.textContent = tabLabel || instance.title || instance.instanceId;\r\n        tab.appendChild(title);\r\n\r\n        const close = document.createElement('span');\r\n        close.className = 'wt-tab-close ml-1 text-xs opacity-70 hover:opacity-100';\r\n        close.textContent = '\u00D7';\r\n        close.setAttribute('aria-label', 'Tab schlie\u00DFen');\r\n        close.title = 'Tab schlie\u00DFen';\r\n        tab.appendChild(close);\r\n\r\n        return tab;\r\n    }\r\n\r\n    function renderTabs(\r\n        container: HTMLElement,\r\n        manager: Manager,\r\n        options: WindowTabsOptions,\r\n        onSelect: (id: string) => void,\r\n        onClose: (id: string) => void,\r\n        onNew?: () => void\r\n    ): void {\r\n        container.innerHTML = '';\r\n\r\n        const bar = document.createElement('div');\r\n        bar.className = 'window-tabs flex items-center gap-1 px-2 pt-2 select-none';\r\n\r\n        // Allow dropping on bar background (append) and cross-window transfer\r\n        bar.addEventListener('dragover', (e: DragEvent) => {\r\n            if (draggedInstanceId) {\r\n                e.preventDefault();\r\n                if (e.dataTransfer) e.dataTransfer.dropEffect = 'move';\r\n            }\r\n        });\r\n        bar.addEventListener('drop', (e: DragEvent) => {\r\n            if (!draggedInstanceId) return;\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            // Cross-window adopt if source differs\r\n            if (\r\n                draggedManager &&\r\n                draggedManager !== manager &&\r\n                manager.adoptInstance &&\r\n                draggedManager.detachInstance\r\n            ) {\r\n                const inst = draggedManager.detachInstance(draggedInstanceId);\r\n                if (inst) {\r\n                    const adopted = manager.adoptInstance(inst);\r\n                    if (adopted?.instanceId) {\r\n                        manager.setActiveInstance(adopted.instanceId);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        const instances = manager.getAllInstances();\r\n        const active = manager.getActiveInstance();\r\n        const activeId = active?.instanceId ?? null;\r\n\r\n        // Diagnostic: log all instance IDs being rendered as tabs\r\n        console.log(\r\n            '[WindowTabs] Rendering tabs for instance IDs:',\r\n            instances.map(i => i.instanceId)\r\n        );\r\n        instances.forEach((inst: Instance) => {\r\n            const tab = createTabEl(inst, inst.instanceId === activeId);\r\n            // Click handlers\r\n            tab.addEventListener('click', e => {\r\n                const target = e.target as HTMLElement;\r\n                if (target.closest('.wt-tab-close')) {\r\n                    onClose(inst.instanceId);\r\n                } else {\r\n                    onSelect(inst.instanceId);\r\n                }\r\n            });\r\n            // Middle-click closes on supported devices\r\n            tab.addEventListener('auxclick', (e: MouseEvent) => {\r\n                if (e.button === 1) {\r\n                    onClose(inst.instanceId);\r\n                }\r\n            });\r\n            // Drag and drop handlers for tab reordering\r\n            tab.addEventListener('dragstart', (e: DragEvent) => {\r\n                draggedTab = tab;\r\n                draggedInstanceId = inst.instanceId;\r\n                draggedManager = manager;\r\n                draggedInstanceObj = inst;\r\n                if (e.dataTransfer) {\r\n                    e.dataTransfer.effectAllowed = 'move';\r\n                    e.dataTransfer.setData('text/plain', inst.instanceId || '');\r\n                }\r\n                tab.style.opacity = '0.5';\r\n            });\r\n            tab.addEventListener('dragend', () => {\r\n                tab.style.opacity = '1';\r\n                draggedTab = null;\r\n                draggedInstanceId = null;\r\n                draggedManager = null;\r\n                draggedInstanceObj = null;\r\n                // Remove any drop indicators\r\n                const allTabs = bar.querySelectorAll('.wt-tab');\r\n                allTabs.forEach(t => {\r\n                    (t as HTMLElement).classList.remove('border-l-4', 'border-l-blue-500');\r\n                });\r\n            });\r\n            tab.addEventListener('dragover', (e: DragEvent) => {\r\n                e.preventDefault();\r\n                if (e.dataTransfer) {\r\n                    e.dataTransfer.dropEffect = 'move';\r\n                }\r\n                // Don't show indicator on the dragged tab itself\r\n                if (tab === draggedTab) {\r\n                    return;\r\n                }\r\n                // Show visual indicator\r\n                const allTabs = bar.querySelectorAll('.wt-tab');\r\n                allTabs.forEach(t => {\r\n                    (t as HTMLElement).classList.remove('border-l-4', 'border-l-blue-500');\r\n                });\r\n                tab.classList.add('border-l-4', 'border-l-blue-500');\r\n            });\r\n            tab.addEventListener('dragleave', () => {\r\n                tab.classList.remove('border-l-4', 'border-l-blue-500');\r\n            });\r\n            tab.addEventListener('drop', (e: DragEvent) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                // Remove visual indicators\r\n                tab.classList.remove('border-l-4', 'border-l-blue-500');\r\n                if (!draggedInstanceId || draggedInstanceId === inst.instanceId) {\r\n                    return;\r\n                }\r\n                // Get current order\r\n                const currentOrder = manager.getAllInstanceIds();\r\n                const draggedIdx = currentOrder.indexOf(draggedInstanceId);\r\n                const targetIdx = currentOrder.indexOf(inst.instanceId);\r\n                if (draggedIdx === -1 || targetIdx === -1) {\r\n                    return;\r\n                }\r\n                // Create new order by moving dragged item before target\r\n                const newOrder = [...currentOrder];\r\n                newOrder.splice(draggedIdx, 1);\r\n                const newTargetIdx = newOrder.indexOf(inst.instanceId);\r\n                newOrder.splice(newTargetIdx, 0, draggedInstanceId);\r\n                // Update instance order if manager supports it\r\n                if (manager.reorderInstances) {\r\n                    manager.reorderInstances(newOrder);\r\n                    // Re-render tabs to reflect new order\r\n                    renderTabs(container, manager, options, onSelect, onClose, onNew);\r\n                }\r\n            });\r\n            bar.appendChild(tab);\r\n        });\r\n\r\n        if (options.addButton !== false) {\r\n            const addBtn = document.createElement('button');\r\n            addBtn.type = 'button';\r\n            addBtn.className =\r\n                'wt-add px-2 py-1 text-sm rounded-md border bg-gray-100 dark:bg-gray-800 border-gray-300 dark:border-gray-700 hover:bg-gray-200 dark:hover:bg-gray-700';\r\n            addBtn.textContent = '+';\r\n            addBtn.title = 'Neue Instanz';\r\n            addBtn.addEventListener('click', () => {\r\n                if (onNew) {\r\n                    onNew();\r\n                } else {\r\n                    const title = options.onCreateInstanceTitle?.();\r\n                    manager.createInstance({ title });\r\n                }\r\n                // refresh will be triggered by wrapper\r\n            });\r\n            bar.appendChild(addBtn);\r\n        }\r\n\r\n        container.appendChild(bar);\r\n\r\n        // Bottom border under tabs\r\n        const underline = document.createElement('div');\r\n        underline.className = 'h-px bg-gray-300 dark:bg-gray-700';\r\n        container.appendChild(underline);\r\n    }\r\n\r\n    function wrapManager(manager: Manager, onChange: () => void): Manager {\r\n        const createOrig = manager.createInstance.bind(manager);\r\n        const destroyOrig = manager.destroyInstance.bind(manager);\r\n        const setActiveOrig = manager.setActiveInstance.bind(manager);\r\n\r\n        type MutableManager = Manager & { [key: string]: unknown };\r\n        (manager as MutableManager).createInstance = (cfg?: Partial<InstanceConfig>) => {\r\n            const inst = createOrig(cfg);\r\n            onChange();\r\n            return inst;\r\n        };\r\n        (manager as MutableManager).destroyInstance = (id: string) => {\r\n            destroyOrig(id);\r\n            onChange();\r\n        };\r\n        (manager as MutableManager).setActiveInstance = (id: string) => {\r\n            setActiveOrig(id);\r\n            onChange();\r\n        };\r\n        return manager;\r\n    }\r\n\r\n    function createController(\r\n        manager: Manager,\r\n        mountEl: HTMLElement,\r\n        options: WindowTabsOptions = {}\r\n    ): WindowTabsController {\r\n        const wrapped = wrapManager(manager, () => controller.refresh());\r\n\r\n        const controller: WindowTabsController = {\r\n            el: mountEl,\r\n            refresh() {\r\n                renderTabs(\r\n                    mountEl,\r\n                    wrapped,\r\n                    options,\r\n                    id => wrapped.setActiveInstance(id),\r\n                    id => wrapped.destroyInstance(id)\r\n                );\r\n            },\r\n            destroy() {\r\n                mountEl.innerHTML = '';\r\n            },\r\n            setTitle(instanceId: string, title: string) {\r\n                const inst = wrapped.getInstance(instanceId) as any;\r\n                if (inst) {\r\n                    inst.metadata = { ...(inst.metadata || {}), tabLabel: title };\r\n                    this.refresh();\r\n                }\r\n            },\r\n        };\r\n\r\n        controller.refresh();\r\n        return controller;\r\n    }\r\n\r\n    // Desktop-level drop: create a new window when dropped outside any tab bar\r\n    document.addEventListener('dragover', (e: DragEvent) => {\r\n        if (draggedInstanceId) {\r\n            e.preventDefault();\r\n        }\r\n    });\r\n    document.addEventListener('drop', (e: DragEvent) => {\r\n        if (!draggedInstanceId || !draggedManager) return;\r\n        const tgt = e.target as HTMLElement;\r\n        if (tgt.closest('.window-tabs')) return; // handled by bar\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (!draggedManager.detachInstance) return;\r\n        const inst = draggedManager.detachInstance(draggedInstanceId) as any;\r\n        if (!inst) return;\r\n        const tab = (inst as any).__tab || inst;\r\n        const ttype = (tab && tab.type) || '';\r\n        const W = window as any;\r\n        let NewWinCtor: any = null;\r\n        if (ttype.includes('terminal')) NewWinCtor = W.TerminalWindow;\r\n        else if (ttype.includes('text-editor')) NewWinCtor = W.TextEditorWindow;\r\n        else if (ttype.includes('finder')) NewWinCtor = W.FinderWindow;\r\n\r\n        if (!NewWinCtor) return;\r\n        const newWin = new NewWinCtor({ title: (tab?.parentWindow?.type || '').toString() });\r\n        if (typeof newWin.show === 'function') newWin.show();\r\n        if (W.WindowRegistry) W.WindowRegistry.registerWindow(newWin);\r\n        if (typeof newWin.addTab === 'function') {\r\n            newWin.addTab(tab);\r\n            newWin.setActiveTab?.(tab.id);\r\n        }\r\n    });\r\n\r\n    const WindowTabs = {\r\n        /**\r\n         * Create a window tabs bar bound to a specific InstanceManager.\r\n         */\r\n        create(\r\n            manager: Manager,\r\n            mountEl: HTMLElement,\r\n            options?: WindowTabsOptions\r\n        ): WindowTabsController {\r\n            return createController(manager, mountEl, options);\r\n        },\r\n    };\r\n\r\n    (window as unknown as { [k: string]: unknown }).WindowTabs = WindowTabs;\r\n})();\r\n", "console.log('TerminalInstance (TS) loaded');\r\n\r\n/**\r\n * TerminalInstance - Multi-Instance capable terminal implementation\r\n * Ported to TypeScript with preserved global API and behavior.\r\n */\r\n(() => {\r\n    'use strict';\r\n\r\n    type DirEntry = {\r\n        type: 'directory';\r\n        contents: Record<string, FSNode>;\r\n    };\r\n\r\n    type FileEntry = {\r\n        type: 'file';\r\n        content: string;\r\n    };\r\n\r\n    type FSNode = DirEntry | FileEntry;\r\n\r\n    type BaseLike = {\r\n        container: HTMLElement | null;\r\n        updateState: (u: Record<string, unknown>) => void;\r\n    } & Record<string, unknown>;\r\n    type BaseCtor = new (cfg: Record<string, unknown>) => BaseLike & Record<string, unknown>;\r\n\r\n    const Base = (window as unknown as { BaseWindowInstance: BaseCtor }).BaseWindowInstance;\r\n\r\n    class TerminalInstance extends Base {\r\n        outputElement: HTMLElement | null = null;\r\n        inputElement: HTMLInputElement | null = null;\r\n        commandHistory: string[] = [];\r\n        historyIndex = -1;\r\n        currentPath = '~';\r\n        fileSystem: Record<string, FSNode>;\r\n\r\n        constructor(config: Record<string, unknown>) {\r\n            super({\r\n                ...config,\r\n                type: 'terminal',\r\n            });\r\n\r\n            this.fileSystem = {\r\n                '~': {\r\n                    type: 'directory',\r\n                    contents: {\r\n                        Desktop: { type: 'directory', contents: {} },\r\n                        Documents: {\r\n                            type: 'directory',\r\n                            contents: {\r\n                                'readme.txt': {\r\n                                    type: 'file',\r\n                                    content: 'Willkommen im Terminal!',\r\n                                },\r\n                            },\r\n                        },\r\n                        Downloads: { type: 'directory', contents: {} },\r\n                        'welcome.txt': {\r\n                            type: 'file',\r\n                            content:\r\n                                'Willkommen auf Marvins Portfolio-Website!\\n\\nGib \"help\" ein, um eine Liste verf\u00FCgbarer Befehle zu sehen.',\r\n                        },\r\n                    },\r\n                },\r\n            };\r\n        }\r\n\r\n        // No override of _initializeState to avoid type modifier conflicts\r\n\r\n        protected render(): void {\r\n            if (!this.container) return;\r\n\r\n            const html = `\r\n                <div class=\"terminal-wrapper h-full flex flex-col bg-gray-900 text-green-400 font-mono text-sm\">\r\n                    <div class=\"terminal-output flex-1 overflow-y-auto p-4 space-y-1\" data-terminal-output>\r\n                    </div>\r\n                    <div class=\"terminal-input-line flex items-center px-4 py-2 border-t border-gray-700\">\r\n                        <span class=\"terminal-prompt text-blue-400\">guest@marvin:${this.currentPath}$</span>\r\n                        <input\r\n                            type=\"text\"\r\n                            class=\"flex-1 ml-2 bg-transparent outline-none text-green-400 terminal-input\"\r\n                            autocomplete=\"off\"\r\n                            spellcheck=\"false\"\r\n                            aria-label=\"Terminal input\"\r\n                            data-terminal-input\r\n                        />\r\n                    </div>\r\n                </div>\r\n            `;\r\n\r\n            this.container.innerHTML = html;\r\n            this.outputElement = this.container.querySelector('[data-terminal-output]');\r\n            this.inputElement = this.container.querySelector('[data-terminal-input]');\r\n\r\n            try {\r\n                this.showWelcomeMessage();\r\n            } catch {\r\n                /* noop */\r\n            }\r\n            if (this.inputElement && typeof this.inputElement.focus === 'function') {\r\n                this.inputElement.focus();\r\n            }\r\n        }\r\n\r\n        protected attachEventListeners(): void {\r\n            if (!this.inputElement) return;\r\n\r\n            this.inputElement.addEventListener('keydown', (e: KeyboardEvent) => {\r\n                if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    const command = this.inputElement!.value.trim();\r\n                    if (command) {\r\n                        this.executeCommand(command);\r\n                        this.commandHistory.push(command);\r\n                        this.historyIndex = this.commandHistory.length;\r\n                        this.updateState({ commandHistory: this.commandHistory });\r\n                    }\r\n                    this.inputElement!.value = '';\r\n                    this.inputElement!.focus();\r\n                } else if (e.key === 'Tab') {\r\n                    e.preventDefault();\r\n                    this.handleTabCompletion();\r\n                } else if (e.key === 'ArrowUp') {\r\n                    e.preventDefault();\r\n                    if (this.historyIndex > 0) {\r\n                        this.historyIndex--;\r\n                        // noUncheckedIndexedAccess: array access may return undefined\r\n                        const historyEntry = this.commandHistory[this.historyIndex];\r\n                        if (historyEntry !== undefined) {\r\n                            this.inputElement!.value = historyEntry;\r\n                        }\r\n                    }\r\n                } else if (e.key === 'ArrowDown') {\r\n                    e.preventDefault();\r\n                    if (this.historyIndex < this.commandHistory.length - 1) {\r\n                        this.historyIndex++;\r\n                        // noUncheckedIndexedAccess: array access may return undefined\r\n                        const historyEntry = this.commandHistory[this.historyIndex];\r\n                        if (historyEntry !== undefined) {\r\n                            this.inputElement!.value = historyEntry;\r\n                        }\r\n                    } else {\r\n                        this.historyIndex = this.commandHistory.length;\r\n                        this.inputElement!.value = '';\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        showWelcomeMessage(): void {\r\n            this.addOutput(\r\n                'Willkommen im Terminal! Gib \"help\" ein f\u00FCr verf\u00FCgbare Befehle.',\r\n                'info'\r\n            );\r\n        }\r\n\r\n        handleTabCompletion(): void {\r\n            if (!this.inputElement) return;\r\n\r\n            const input = this.inputElement.value;\r\n            const [partialCmd, ...args] = input.split(' ');\r\n\r\n            // noUncheckedIndexedAccess: array destructuring may return undefined\r\n            if (partialCmd === undefined) return;\r\n\r\n            const availableCommands = [\r\n                'help',\r\n                'clear',\r\n                'ls',\r\n                'pwd',\r\n                'cd',\r\n                'cat',\r\n                'echo',\r\n                'date',\r\n                'whoami',\r\n            ];\r\n\r\n            if (args.length === 0) {\r\n                const matches = availableCommands.filter(cmd => cmd.startsWith(partialCmd));\r\n\r\n                if (matches.length === 1) {\r\n                    const match = matches[0];\r\n                    if (match !== undefined) {\r\n                        this.inputElement.value = match + ' ';\r\n                    }\r\n                } else if (matches.length > 1) {\r\n                    this.addOutput(`guest@marvin:${this.currentPath}$ ${input}`, 'command');\r\n                    this.addOutput(matches.join('  '), 'info');\r\n                    const commonPrefix = this.findCommonPrefix(matches);\r\n                    if (commonPrefix.length > partialCmd.length) {\r\n                        this.inputElement.value = commonPrefix;\r\n                    }\r\n                }\r\n            } else {\r\n                if (partialCmd === 'cd' || partialCmd === 'cat') {\r\n                    this.completePathArgument(partialCmd, args[0] || '');\r\n                }\r\n            }\r\n        }\r\n\r\n        findCommonPrefix(strings: string[]): string {\r\n            if (!strings.length) return '';\r\n            // noUncheckedIndexedAccess: array access may return undefined\r\n            const firstString = strings[0];\r\n            if (strings.length === 1) return firstString ?? '';\r\n            if (firstString === undefined) return '';\r\n\r\n            let prefix: string = firstString;\r\n            for (let i = 1; i < strings.length; i++) {\r\n                const currentString = strings[i];\r\n                if (currentString === undefined) continue;\r\n\r\n                while (currentString.indexOf(prefix) !== 0) {\r\n                    prefix = prefix.substring(0, prefix.length - 1);\r\n                    if (!prefix) return '';\r\n                }\r\n            }\r\n            return prefix;\r\n        }\r\n\r\n        completePathArgument(cmd: 'cd' | 'cat', partial: string): void {\r\n            const currentDir = this.resolvePath(this.currentPath);\r\n            if (!currentDir || currentDir.type !== 'directory') return;\r\n\r\n            const items = Object.keys(currentDir.contents);\r\n            let matches: string[];\r\n            if (cmd === 'cd') {\r\n                // Only directories\r\n                matches = items.filter(\r\n                    item =>\r\n                        (currentDir.contents[item] as FSNode).type === 'directory' &&\r\n                        item.startsWith(partial)\r\n                );\r\n            } else {\r\n                // cat: Only files\r\n                matches = items.filter(\r\n                    item =>\r\n                        (currentDir.contents[item] as FSNode).type === 'file' &&\r\n                        item.startsWith(partial)\r\n                );\r\n            }\r\n\r\n            if (matches.length === 1) {\r\n                const match = matches[0];\r\n                if (match !== undefined) {\r\n                    this.inputElement!.value = `${cmd} ${match}`;\r\n                }\r\n            } else if (matches.length > 1) {\r\n                this.addOutput(\r\n                    `guest@marvin:${this.currentPath}$ ${this.inputElement!.value}`,\r\n                    'command'\r\n                );\r\n                const formatted = matches.map(item => {\r\n                    // noUncheckedIndexedAccess: dictionary access may return undefined\r\n                    const itemObj = currentDir.contents[item] as FSNode | undefined;\r\n                    if (!itemObj) return item;\r\n                    const prefix = itemObj.type === 'directory' ? '\uD83D\uDCC1 ' : '\uD83D\uDCC4 ';\r\n                    return prefix + item;\r\n                });\r\n                this.addOutput(formatted.join('  '), 'info');\r\n                const commonPrefix = this.findCommonPrefix(matches);\r\n                if (commonPrefix.length > partial.length) {\r\n                    this.inputElement!.value = `${cmd} ${commonPrefix}`;\r\n                }\r\n            }\r\n        }\r\n\r\n        executeCommand(command: string): void {\r\n            this.addOutput(`guest@marvin:${this.currentPath}$ ${command}`, 'command');\r\n            const [cmd, ...args] = command.split(' ');\r\n\r\n            // noUncheckedIndexedAccess: array destructuring may return undefined\r\n            if (cmd === undefined) return;\r\n\r\n            const commands: Record<string, () => void> = {\r\n                help: () => this.showHelp(),\r\n                clear: () => this.clearOutput(),\r\n                ls: () => this.listDirectory(args[0]),\r\n                pwd: () => this.printWorkingDirectory(),\r\n                cd: () => this.changeDirectory(args[0]),\r\n                cat: () => this.catFile(args[0]),\r\n                echo: () => this.echo(args.join(' ')),\r\n                date: () => this.showDate(),\r\n                whoami: () => this.addOutput('guest', 'output'),\r\n            };\r\n\r\n            const commandFn = commands[cmd];\r\n            if (commandFn !== undefined) {\r\n                commandFn();\r\n            } else {\r\n                this.addOutput(\r\n                    `Befehl nicht gefunden: ${cmd}. Gib \"help\" ein f\u00FCr verf\u00FCgbare Befehle.`,\r\n                    'error'\r\n                );\r\n            }\r\n        }\r\n\r\n        addOutput(text: string, type: 'command' | 'output' | 'error' | 'info' = 'output'): void {\r\n            if (!this.outputElement) return;\r\n            const line = document.createElement('div');\r\n            line.className = `terminal-line terminal-${type}`;\r\n            const colorMap: Record<string, string> = {\r\n                command: 'text-blue-400',\r\n                output: 'text-green-400',\r\n                error: 'text-red-400',\r\n                info: 'text-yellow-400',\r\n            };\r\n            line.className += ` ${colorMap[type] || 'text-green-400'}`;\r\n            line.textContent = text;\r\n            this.outputElement.appendChild(line);\r\n            this.outputElement.scrollTop = this.outputElement.scrollHeight;\r\n        }\r\n\r\n        clearOutput(): void {\r\n            if (this.outputElement) this.outputElement.innerHTML = '';\r\n        }\r\n\r\n        showHelp(): void {\r\n            const helpText = [\r\n                'Verf\u00FCgbare Befehle:',\r\n                '  help         - Zeige diese Hilfe',\r\n                '  clear        - L\u00F6sche Ausgabe',\r\n                '  ls [path]    - Liste Dateien (optional mit Pfad)',\r\n                '  pwd          - Zeige aktuelles Verzeichnis',\r\n                '  cd <dir>     - Wechsle Verzeichnis (., .., ~, relative/absolute Pfade)',\r\n                '  cat <file>   - Zeige Dateiinhalt (auch mit Pfad: cat ./file oder cat dir/file)',\r\n                '  echo <text>  - Gebe Text aus',\r\n                '  date         - Zeige Datum/Zeit',\r\n                '  whoami       - Zeige Benutzername',\r\n                '',\r\n                'Pfad-Beispiele:',\r\n                '  .            - Aktuelles Verzeichnis',\r\n                '  ..           - \u00DCbergeordnetes Verzeichnis',\r\n                '  ~            - Home-Verzeichnis',\r\n                '  ./file       - Datei im aktuellen Verzeichnis',\r\n                '  ../file      - Datei im \u00FCbergeordneten Verzeichnis',\r\n                '  dir/subdir   - Unterverzeichnis (relativ)',\r\n                '',\r\n                'Tipps:',\r\n                '  \u2191/\u2193          - Durchsuche Befehlshistorie',\r\n                '  Tab          - Vervollst\u00E4ndige Befehle und Pfade',\r\n            ];\r\n            helpText.forEach(l => this.addOutput(l, 'info'));\r\n        }\r\n\r\n        listDirectory(path?: string): void {\r\n            const targetPath = path ? this.normalizePath(path) : this.currentPath;\r\n            const targetDir = this.resolvePath(targetPath);\r\n            if (!targetDir) {\r\n                this.addOutput(`Verzeichnis nicht gefunden: ${path || targetPath}`, 'error');\r\n                return;\r\n            }\r\n            if (targetDir.type !== 'directory') {\r\n                this.addOutput(`${path || targetPath} ist kein Verzeichnis`, 'error');\r\n                return;\r\n            }\r\n            const items = Object.keys(targetDir.contents);\r\n            if (items.length === 0) this.addOutput('(leer)', 'output');\r\n            else {\r\n                items.forEach(item => {\r\n                    // noUncheckedIndexedAccess: dictionary access may return undefined\r\n                    const itemObj = targetDir.contents[item];\r\n                    if (!itemObj) return;\r\n                    const prefix = itemObj.type === 'directory' ? '\uD83D\uDCC1 ' : '\uD83D\uDCC4 ';\r\n                    this.addOutput(prefix + item, 'output');\r\n                });\r\n            }\r\n        }\r\n\r\n        printWorkingDirectory(): void {\r\n            this.addOutput(this.currentPath, 'output');\r\n        }\r\n\r\n        changeDirectory(path?: string): void {\r\n            if (!path) {\r\n                this.currentPath = '~';\r\n                this.updatePrompt();\r\n                return;\r\n            }\r\n            const newPath = this.normalizePath(path);\r\n            const resolved = this.resolvePath(newPath);\r\n            if (!resolved) {\r\n                this.addOutput(`Verzeichnis nicht gefunden: ${path}`, 'error');\r\n                return;\r\n            }\r\n            if (resolved.type !== 'directory') {\r\n                this.addOutput(`${path} ist kein Verzeichnis`, 'error');\r\n                return;\r\n            }\r\n            this.currentPath = newPath;\r\n            this.updatePrompt();\r\n            this.updateState({ currentPath: this.currentPath });\r\n        }\r\n\r\n        catFile(filename?: string): void {\r\n            if (!filename) {\r\n                this.addOutput('Dateiname fehlt', 'error');\r\n                return;\r\n            }\r\n            if (filename.includes('/')) {\r\n                const normalizedPath = this.normalizePath(filename);\r\n                const pathParts = normalizedPath.split('/').filter(p => p !== '');\r\n                const fileName = pathParts.pop();\r\n                const dirPath = pathParts.length > 0 ? pathParts.join('/') : '~';\r\n                const dir = this.resolvePath(dirPath);\r\n                if (!dir) {\r\n                    this.addOutput(`Verzeichnis nicht gefunden: ${dirPath}`, 'error');\r\n                    return;\r\n                }\r\n                const file = (dir as DirEntry).contents?.[fileName as string];\r\n                if (!file) this.addOutput(`Datei nicht gefunden: ${filename}`, 'error');\r\n                else if (file.type !== 'file')\r\n                    this.addOutput(`${filename} ist keine Datei`, 'error');\r\n                else this.addOutput(file.content, 'output');\r\n            } else {\r\n                const currentDir = this.resolvePath(this.currentPath) as DirEntry | null;\r\n                const file = currentDir?.contents?.[filename] as FSNode | undefined;\r\n                if (!file) this.addOutput(`Datei nicht gefunden: ${filename}`, 'error');\r\n                else if (file.type !== 'file')\r\n                    this.addOutput(`${filename} ist keine Datei`, 'error');\r\n                else this.addOutput(file.content, 'output');\r\n            }\r\n        }\r\n\r\n        echo(text: string): void {\r\n            this.addOutput(text, 'output');\r\n        }\r\n\r\n        showDate(): void {\r\n            this.addOutput(new Date().toString(), 'output');\r\n        }\r\n\r\n        updatePrompt(): void {\r\n            const prompt = this.container?.querySelector('.terminal-prompt') as HTMLElement | null;\r\n            if (prompt) {\r\n                prompt.textContent = `guest@marvin:${this.currentPath}$`;\r\n            }\r\n        }\r\n\r\n        resolvePath(path: string | undefined | null): FSNode | null {\r\n            if (!path) return null;\r\n            const normalizedPath = this.normalizePath(path);\r\n\r\n            // noUncheckedIndexedAccess: dictionary access may return undefined\r\n            const homeNode = this.fileSystem['~'];\r\n            if (normalizedPath === '~') return homeNode ?? null;\r\n            if (homeNode === undefined) return null;\r\n\r\n            let current: FSNode = homeNode;\r\n            const parts = normalizedPath\r\n                .replace(/^~\\/?/, '')\r\n                .split('/')\r\n                .filter(p => p);\r\n            for (const part of parts) {\r\n                if ((current as DirEntry).type !== 'directory') return null;\r\n                if (!(current as DirEntry).contents || !(current as DirEntry).contents[part])\r\n                    return null;\r\n                // noUncheckedIndexedAccess: dictionary access may return undefined\r\n                const nextNode = (current as DirEntry).contents[part];\r\n                if (nextNode === undefined) return null;\r\n                current = nextNode;\r\n            }\r\n            return current;\r\n        }\r\n\r\n        normalizePath(path: string): string {\r\n            if (!path || path === '~') return '~';\r\n            if (path === '.') return this.currentPath;\r\n            if (path === './') return this.currentPath;\r\n            let workingPath: string;\r\n            if (path.startsWith('~')) workingPath = path;\r\n            else if (path.startsWith('/')) workingPath = '~' + path;\r\n            else\r\n                workingPath =\r\n                    this.currentPath === '~' ? `~/${path}` : `${this.currentPath}/${path}`;\r\n            const parts = workingPath.split('/').filter(p => p !== '' && p !== '.');\r\n            const resolved: string[] = [];\r\n            for (const part of parts) {\r\n                if (part === '..') {\r\n                    if (resolved.length > 0 && resolved[resolved.length - 1] !== '~') {\r\n                        resolved.pop();\r\n                    }\r\n                } else {\r\n                    resolved.push(part);\r\n                }\r\n            }\r\n            if (resolved.length === 0 || (resolved.length === 1 && resolved[0] === '~')) return '~';\r\n            if (resolved[0] !== '~') resolved.unshift('~');\r\n            return resolved.join('/');\r\n        }\r\n\r\n        parentPath(path: string): string {\r\n            const parts = path.split('/').filter(Boolean);\r\n            parts.pop();\r\n            return parts.length > 0 ? '/' + parts.join('/') : '~';\r\n        }\r\n\r\n        serialize(): Record<string, unknown> {\r\n            const baseSerialize = (\r\n                Base.prototype as unknown as {\r\n                    serialize: () => Record<string, unknown>;\r\n                }\r\n            ).serialize;\r\n            const baseObj = baseSerialize.call(this) as Record<string, unknown>;\r\n            return {\r\n                ...baseObj,\r\n                currentPath: this.currentPath,\r\n                commandHistory: this.commandHistory,\r\n                fileSystem: this.fileSystem,\r\n            } as Record<string, unknown>;\r\n        }\r\n\r\n        deserialize(data: Record<string, unknown>): void {\r\n            const baseDeserialize = (\r\n                Base.prototype as unknown as {\r\n                    deserialize: (d: Record<string, unknown>) => void;\r\n                }\r\n            ).deserialize;\r\n            baseDeserialize.call(this, data);\r\n            const d = data as Record<string, unknown> & {\r\n                currentPath?: string;\r\n                commandHistory?: string[];\r\n                fileSystem?: Record<string, FSNode>;\r\n            };\r\n            if (d.currentPath) {\r\n                this.currentPath = d.currentPath;\r\n                this.updatePrompt();\r\n            }\r\n            if (d.commandHistory) {\r\n                this.commandHistory = d.commandHistory;\r\n                this.historyIndex = this.commandHistory.length;\r\n            }\r\n            if (d.fileSystem) {\r\n                this.fileSystem = d.fileSystem;\r\n            }\r\n        }\r\n\r\n        focus(): void {\r\n            const baseFocus = (Base.prototype as unknown as { focus: () => void }).focus;\r\n            baseFocus.call(this);\r\n            if (this.inputElement) this.inputElement.focus();\r\n        }\r\n    }\r\n\r\n    (window as unknown as { TerminalInstance: typeof TerminalInstance }).TerminalInstance =\r\n        TerminalInstance;\r\n\r\n    // Create Terminal Instance Manager\r\n    const G = window as unknown as Record<string, unknown>;\r\n    type InstanceManagerCtor = new (cfg: Record<string, unknown>) => {\r\n        type?: string;\r\n        getInstanceCount?: () => number;\r\n    };\r\n    const InstanceManager = G['InstanceManager'] as unknown as InstanceManagerCtor | undefined;\r\n    if (InstanceManager) {\r\n        (G['TerminalInstanceManager'] as unknown) = new (InstanceManager as InstanceManagerCtor)({\r\n            type: 'terminal',\r\n            instanceClass: TerminalInstance,\r\n            maxInstances: 0,\r\n            createContainer: function (instanceId: string): HTMLElement | null {\r\n                const terminalModalContainer = document.getElementById('terminal-container');\r\n                if (!terminalModalContainer) {\r\n                    console.error('Terminal container not found');\r\n                    return null;\r\n                }\r\n                const container = document.createElement('div');\r\n                container.id = `${instanceId}-container`;\r\n                container.className = 'terminal-instance-container h-full';\r\n                // Use DOMUtils if available to hide initially, else fallback\r\n                const domUtils = (\r\n                    window as unknown as { DOMUtils?: { hide?: (el: Element) => void } }\r\n                ).DOMUtils;\r\n                if (domUtils && typeof domUtils.hide === 'function') {\r\n                    domUtils.hide(container);\r\n                } else {\r\n                    container.classList.add('hidden');\r\n                }\r\n                terminalModalContainer.appendChild(container);\r\n                return container;\r\n            },\r\n        });\r\n\r\n        try {\r\n            console.debug('TerminalInstanceManager created', {\r\n                type: (G['TerminalInstanceManager'] as { type?: string })?.type,\r\n                instanceCount: (\r\n                    G['TerminalInstanceManager'] as { getInstanceCount?: () => number }\r\n                )?.getInstanceCount?.(),\r\n            });\r\n        } catch (error) {\r\n            console.debug('TerminalInstanceManager created (debug log failed)', error);\r\n        }\r\n    }\r\n})();\r\n", "import { getString, setString, remove } from '../../services/storage-utils.js';\r\n\r\n/**\r\n * Text Editor Module\r\n * Replaces text.html iframe with inline text editor\r\n */\r\n\r\ntype WrapMode = 'soft' | 'off';\r\n\r\ninterface FileMeta {\r\n    fileName?: string;\r\n    repo?: string;\r\n    path?: string;\r\n}\r\n\r\ninterface RemoteFilePayload extends FileMeta {\r\n    content: string;\r\n}\r\n\r\ninterface LoadErrorPayload extends FileMeta {\r\n    message?: string;\r\n}\r\n\r\ntype StatusState =\r\n    | { type: 'plain'; text: string }\r\n    | { type: 'i18n'; key: string; params?: Record<string, unknown> };\r\n\r\ninterface TextEditorSystemInternal extends TextEditorSystemAPI {\r\n    container: HTMLElement | null;\r\n    editor: HTMLTextAreaElement | null;\r\n    statusBar: HTMLElement | null;\r\n    saveButton: HTMLButtonElement | null;\r\n    fileInput: HTMLInputElement | null;\r\n    wrapMode: WrapMode;\r\n    currentRemoteFile: RemoteFilePayload | null;\r\n    statusState: StatusState | null;\r\n    wordCountDisplay: HTMLElement | null;\r\n    lineColDisplay: HTMLElement | null;\r\n    findReplacePanel: HTMLElement | null;\r\n    findInput: HTMLInputElement | null;\r\n    replaceInput: HTMLInputElement | null;\r\n    toastContainer: HTMLElement | null;\r\n\r\n    // Internal methods\r\n    init(containerOrId: HTMLElement | string): void;\r\n    render(): void;\r\n    cacheElements(): void;\r\n    loadWrapPreference(): void;\r\n    attachListeners(): void;\r\n    loadSavedContent(): void;\r\n    syncSaveButtonState(): void;\r\n    registerActions(): void;\r\n    updateCSSVariables(): void;\r\n    applyWrapMode(mode?: string): void;\r\n    setStatusPlain(msg: string): void;\r\n    focusEditor(): void;\r\n    handleEditorInput(): void;\r\n    updateWordCount(): void;\r\n    updateCursorPosition(): void;\r\n    handleFileSelect(event: Event): void;\r\n    updateDocumentTitle(): void;\r\n    clearStatus(): void;\r\n    toggleWrapMode(): void;\r\n    execCommand(cmd: string): void;\r\n    handlePaste(e?: Event): void;\r\n    selectAll(): void;\r\n    wrapSelection(before: string, after: string): void;\r\n    insertHeading(level: number): void;\r\n    insertList(type: string): void;\r\n    alignText(align: string): void;\r\n    insertLink(): void;\r\n    toggleFindReplace(): void;\r\n    findNext(): void;\r\n    replaceOne(): void;\r\n    replaceAll(): void;\r\n    closeFindReplace(): void;\r\n    formatFileLabel(meta?: unknown): string;\r\n    setStatusLocalized(key: string, params?: unknown): void;\r\n    resolveTranslation(key: string, params?: unknown): { text: string; translated: boolean };\r\n    showToast(msg: string, type?: string): void;\r\n    insertTextAtCursor(text: string): void;\r\n    showInputModal(\r\n        title: string,\r\n        defaultValue?: string,\r\n        placeholder?: string\r\n    ): Promise<string | null>;\r\n    applyStatusState(state?: StatusState): void;\r\n    clearEditor(): void;\r\n    openFile(): void;\r\n    saveFile(): void;\r\n    loadRemoteFile(payload: Partial<RemoteFilePayload>): void;\r\n    showLoading(payload?: unknown): void;\r\n    showLoadError(payload?: unknown): void;\r\n    handleMenuAction(action: string): void;\r\n    destroy(): void;\r\n}\r\n\r\nconst TextEditorSystem: TextEditorSystemInternal = {\r\n    container: null,\r\n    editor: null,\r\n    statusBar: null,\r\n    saveButton: null,\r\n    fileInput: null,\r\n    wrapMode: 'off',\r\n    currentRemoteFile: null,\r\n    statusState: null,\r\n    wordCountDisplay: null,\r\n    lineColDisplay: null,\r\n    findReplacePanel: null,\r\n    findInput: null,\r\n    replaceInput: null,\r\n    toastContainer: null,\r\n\r\n    /**\r\n     * Initialize text editor in container\r\n     * @param {HTMLElement|string} containerOrId - Container element or ID\r\n     */\r\n    init(containerOrId: HTMLElement | string): void {\r\n        const container =\r\n            typeof containerOrId === 'string'\r\n                ? document.getElementById(containerOrId)\r\n                : containerOrId;\r\n\r\n        if (!container) {\r\n            console.error('Text editor container not found:', containerOrId);\r\n            return;\r\n        }\r\n\r\n        this.container = container;\r\n        this.render();\r\n        this.cacheElements();\r\n        this.loadWrapPreference();\r\n        this.attachListeners();\r\n        this.loadSavedContent();\r\n        this.syncSaveButtonState();\r\n\r\n        // Register text editor actions with ActionBus\r\n        if (window.ActionBus) {\r\n            this.registerActions();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Render text editor UI\r\n     */\r\n    render(): void {\r\n        if (!this.container) return;\r\n\r\n        this.container.innerHTML = `\r\n                <div class=\"dialog-content flex flex-col h-full\" style=\"background: var(--editor-body-bg, #fafafa); color: var(--editor-text, #111827);\">\r\n                    <!-- File Operations Toolbar -->\r\n                    <div id=\"text-toolbar\" class=\"flex-none\" style=\"background: var(--editor-toolbar-bg, #f5f5f5); padding: 8px 12px; border-bottom: 1px solid var(--editor-toolbar-border, #d1d5db); display: flex; gap: 8px; align-items: center; flex-wrap: wrap;\">\r\n                        <button type=\"button\" data-action=\"textEditor:clear\" class=\"text-editor-btn\" data-i18n=\"textEditor.toolbar.clear\" data-i18n-title=\"textEditor.toolbar.clear\">Neu</button>\r\n                        <button type=\"button\" data-action=\"textEditor:open\" class=\"text-editor-btn\" data-i18n=\"textEditor.toolbar.open\" data-i18n-title=\"textEditor.toolbar.open\">\u00D6ffnen</button>\r\n                        <button type=\"button\" data-action=\"textEditor:save\" class=\"text-editor-btn\" id=\"text-save-button\" data-i18n=\"textEditor.toolbar.save\" data-i18n-title=\"textEditor.toolbar.save\">Speichern</button>\r\n                        <div style=\"width: 1px; height: 20px; background: var(--editor-toolbar-border, #d1d5db); margin: 0 4px;\"></div>\r\n                        <button type=\"button\" data-action=\"textEditor:bold\" class=\"text-editor-btn\" data-i18n-title=\"textEditor.toolbar.bold\" style=\"font-weight: bold;\">B</button>\r\n                        <button type=\"button\" data-action=\"textEditor:italic\" class=\"text-editor-btn\" data-i18n-title=\"textEditor.toolbar.italic\" style=\"font-style: italic;\">I</button>\r\n                        <button type=\"button\" data-action=\"textEditor:underline\" class=\"text-editor-btn\" data-i18n-title=\"textEditor.toolbar.underline\" style=\"text-decoration: underline;\">U</button>\r\n                        <button type=\"button\" data-action=\"textEditor:strikethrough\" class=\"text-editor-btn\" data-i18n-title=\"textEditor.toolbar.strikeThrough\" style=\"text-decoration: line-through;\">S</button>\r\n                        <div style=\"width: 1px; height: 20px; background: var(--editor-toolbar-border, #d1d5db); margin: 0 4px;\"></div>\r\n                        <button type=\"button\" data-action=\"textEditor:heading1\" class=\"text-editor-btn\" data-i18n-title=\"textEditor.toolbar.heading1\">H1</button>\r\n                        <button type=\"button\" data-action=\"textEditor:heading2\" class=\"text-editor-btn\" data-i18n-title=\"textEditor.toolbar.heading2\">H2</button>\r\n                        <button type=\"button\" data-action=\"textEditor:heading3\" class=\"text-editor-btn\" data-i18n-title=\"textEditor.toolbar.heading3\">H3</button>\r\n                        <div style=\"width: 1px; height: 20px; background: var(--editor-toolbar-border, #d1d5db); margin: 0 4px;\"></div>\r\n                        <button type=\"button\" data-action=\"textEditor:unorderedList\" class=\"text-editor-btn\" data-i18n-title=\"textEditor.toolbar.unorderedList\">\u2022 List</button>\r\n                        <button type=\"button\" data-action=\"textEditor:orderedList\" class=\"text-editor-btn\" data-i18n-title=\"textEditor.toolbar.orderedList\">1. List</button>\r\n                        <div style=\"width: 1px; height: 20px; background: var(--editor-toolbar-border, #d1d5db); margin: 0 4px;\"></div>\r\n                        <button type=\"button\" data-action=\"textEditor:alignLeft\" class=\"text-editor-btn\" data-i18n-title=\"textEditor.toolbar.alignLeft\">\u21E4</button>\r\n                        <button type=\"button\" data-action=\"textEditor:alignCenter\" class=\"text-editor-btn\" data-i18n-title=\"textEditor.toolbar.alignCenter\">\u2261</button>\r\n                        <button type=\"button\" data-action=\"textEditor:alignRight\" class=\"text-editor-btn\" data-i18n-title=\"textEditor.toolbar.alignRight\">\u21E5</button>\r\n                        <div style=\"width: 1px; height: 20px; background: var(--editor-toolbar-border, #d1d5db); margin: 0 4px;\"></div>\r\n                        <button type=\"button\" data-action=\"textEditor:insertLink\" class=\"text-editor-btn\" data-i18n-title=\"textEditor.toolbar.insertLink\">\uD83D\uDD17</button>\r\n                        <button type=\"button\" data-action=\"textEditor:findReplace\" class=\"text-editor-btn\" data-i18n-title=\"textEditor.toolbar.findReplace\">\uD83D\uDD0D</button>\r\n                        <input type=\"file\" id=\"text-file-input\"\r\n                            accept=\".txt,.md,.markdown,.html,.htm,.css,.scss,.js,.jsx,.ts,.tsx,.json,.yml,.yaml,.xml,.csv,.tsv,.ini,.cfg,.conf,.env,.gitignore,.log,.c,.h,.cpp,.hpp,.java,.kt,.swift,.cs,.py,.rb,.php,.rs,.go,.sh,.bash,.zsh,.fish,.ps1,.bat\"\r\n                            style=\"display:none\">\r\n                    </div>\r\n                    <!-- Find and Replace Panel (Hidden by default) -->\r\n                    <div id=\"find-replace-panel\" class=\"flex-none\" style=\"background: var(--editor-toolbar-bg, #f5f5f5); padding: 8px 12px; border-bottom: 1px solid var(--editor-toolbar-border, #d1d5db); display: none; gap: 8px; align-items: center; flex-wrap: wrap;\">\r\n                        <input type=\"text\" id=\"find-input\" data-i18n-placeholder=\"textEditor.findReplace.find\" placeholder=\"Find...\" style=\"padding: 4px 8px; border: 1px solid var(--editor-toolbar-border, #d1d5db); border-radius: 4px; background: var(--editor-surface-bg, #ffffff); color: var(--editor-text, #111827); font-size: 13px;\">\r\n                        <input type=\"text\" id=\"replace-input\" data-i18n-placeholder=\"textEditor.findReplace.replace\" placeholder=\"Replace...\" style=\"padding: 4px 8px; border: 1px solid var(--editor-toolbar-border, #d1d5db); border-radius: 4px; background: var(--editor-surface-bg, #ffffff); color: var(--editor-text, #111827); font-size: 13px;\">\r\n                        <button type=\"button\" data-action=\"textEditor:findNext\" class=\"text-editor-btn\" data-i18n=\"textEditor.findReplace.next\" data-i18n-title=\"textEditor.findReplace.next\" style=\"font-size: 12px;\">Next</button>\r\n                        <button type=\"button\" data-action=\"textEditor:replaceOne\" class=\"text-editor-btn\" data-i18n=\"textEditor.findReplace.replaceOne\" data-i18n-title=\"textEditor.findReplace.replaceOne\" style=\"font-size: 12px;\">Replace</button>\r\n                        <button type=\"button\" data-action=\"textEditor:replaceAll\" class=\"text-editor-btn\" data-i18n=\"textEditor.findReplace.replaceAll\" data-i18n-title=\"textEditor.findReplace.replaceAll\" style=\"font-size: 12px;\">Replace All</button>\r\n                        <button type=\"button\" data-action=\"textEditor:closeFindReplace\" class=\"text-editor-btn\" data-i18n=\"textEditor.findReplace.close\" data-i18n-title=\"textEditor.findReplace.close\" style=\"font-size: 12px;\">\u2715</button>\r\n                    </div>\r\n                    <div id=\"text-file-status\" class=\"flex-none\" style=\"padding: 8px 16px; border-bottom: 1px solid var(--editor-toolbar-border, #d1d5db); background: var(--editor-body-bg, #fafafa); color: var(--editor-text, #111827); font-size: 14px; opacity: 0.75; display: none;\"></div>\r\n                    <textarea id=\"text-editor-textarea\" spellcheck=\"false\" wrap=\"off\" class=\"flex-1 w-full resize-none p-4 border-0 outline-none\"\r\n                        style=\"background: var(--editor-surface-bg, #ffffff); color: inherit; font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 14px; line-height: 1.6; tab-size: 4;\"\r\n                        title=\"textarea\"></textarea>\r\n                    <!-- Status Bar with Word Count -->\r\n                    <div id=\"word-count-bar\" class=\"flex-none\" style=\"background: var(--editor-toolbar-bg, #f5f5f5); padding: 6px 12px; border-top: 1px solid var(--editor-toolbar-border, #d1d5db); font-size: 12px; color: var(--editor-text, #111827); opacity: 0.75; display: flex; justify-content: space-between;\">\r\n                        <span id=\"word-count-display\" data-i18n=\"textEditor.status.wordCount\" data-i18n-params='{\"words\":0,\"chars\":0}'>Words: 0 | Characters: 0</span>\r\n                        <span id=\"line-col-display\" data-i18n=\"textEditor.status.position\" data-i18n-params='{\"line\":1,\"col\":1}'>Line 1, Col 1</span>\r\n                    </div>\r\n                </div>\r\n            `;\r\n\r\n        // Apply CSS variables for dark mode support\r\n        this.updateCSSVariables();\r\n\r\n        // Apply i18n translations\r\n        if (window.appI18n && typeof window.appI18n.applyTranslations === 'function') {\r\n            window.appI18n.applyTranslations();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Update CSS variables for dark mode\r\n     */\r\n    updateCSSVariables(): void {\r\n        if (!this.container) return;\r\n\r\n        const isDark = document.documentElement.classList.contains('dark');\r\n\r\n        this.container.style.setProperty('--editor-body-bg', isDark ? '#0f172a' : '#fafafa');\r\n        this.container.style.setProperty('--editor-text', isDark ? '#e5e7eb' : '#111827');\r\n        this.container.style.setProperty('--editor-toolbar-bg', isDark ? '#1f2937' : '#f5f5f5');\r\n        this.container.style.setProperty('--editor-toolbar-border', isDark ? '#374151' : '#d1d5db');\r\n        this.container.style.setProperty(\r\n            '--editor-toolbar-button-bg',\r\n            isDark ? '#111827' : '#ffffff'\r\n        );\r\n        this.container.style.setProperty(\r\n            '--editor-toolbar-button-hover',\r\n            isDark ? '#1f2937' : '#e5e7eb'\r\n        );\r\n        this.container.style.setProperty(\r\n            '--editor-toolbar-button-border',\r\n            isDark ? '#475569' : '#d1d5db'\r\n        );\r\n        this.container.style.setProperty('--editor-surface-bg', isDark ? '#111827' : '#ffffff');\r\n\r\n        // Apply button styles\r\n        const buttons = this.container.querySelectorAll<HTMLElement>('.text-editor-btn');\r\n        buttons.forEach(btn => {\r\n            btn.style.margin = '0';\r\n            btn.style.padding = '6px 12px';\r\n            btn.style.fontSize = '14px';\r\n            btn.style.border = `1px solid ${isDark ? '#475569' : '#d1d5db'}`;\r\n            btn.style.background = isDark ? '#111827' : '#ffffff';\r\n            btn.style.cursor = 'pointer';\r\n            btn.style.color = 'inherit';\r\n            btn.style.borderRadius = '6px';\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Cache DOM elements\r\n     */\r\n    cacheElements(): void {\r\n        if (!this.container) return;\r\n\r\n        this.editor = this.container.querySelector<HTMLTextAreaElement>('#text-editor-textarea');\r\n        this.statusBar = this.container.querySelector<HTMLElement>('#text-file-status');\r\n        this.saveButton = this.container.querySelector<HTMLButtonElement>('#text-save-button');\r\n        this.fileInput = this.container.querySelector<HTMLInputElement>('#text-file-input');\r\n        this.wordCountDisplay = this.container.querySelector<HTMLElement>('#word-count-display');\r\n        this.lineColDisplay = this.container.querySelector<HTMLElement>('#line-col-display');\r\n        this.findReplacePanel = this.container.querySelector<HTMLElement>('#find-replace-panel');\r\n        this.findInput = this.container.querySelector<HTMLInputElement>('#find-input');\r\n        this.replaceInput = this.container.querySelector<HTMLInputElement>('#replace-input');\r\n    },\r\n\r\n    /**\r\n     * Load wrap mode preference\r\n     */\r\n    loadWrapPreference(): void {\r\n        const storedWrapMode = getString('textEditorWrapMode');\r\n        this.wrapMode = storedWrapMode === 'soft' ? 'soft' : 'off';\r\n        this.applyWrapMode(this.wrapMode);\r\n    },\r\n\r\n    /**\r\n     * Apply wrap mode\r\n     * @param {string} mode - Wrap mode (soft|off)\r\n     */\r\n    applyWrapMode(mode?: string): void {\r\n        if (!this.editor) return;\r\n        const effective = mode ?? this.wrapMode;\r\n        const normalized = effective === 'soft' ? 'soft' : 'off';\r\n        this.wrapMode = normalized;\r\n        this.editor.wrap = normalized;\r\n        this.editor.style.whiteSpace = normalized === 'soft' ? 'pre-wrap' : 'pre';\r\n\r\n        try {\r\n            setString('textEditorWrapMode', normalized);\r\n        } catch (err) {\r\n            console.warn('Wrap preference could not be stored:', err);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Toggle wrap mode\r\n     */\r\n    toggleWrapMode(): void {\r\n        const next = this.wrapMode === 'soft' ? 'off' : 'soft';\r\n        this.applyWrapMode(next);\r\n        this.setStatusPlain(\r\n            next === 'soft' ? 'Zeilenumbruch aktiviert' : 'Zeilenumbruch deaktiviert'\r\n        );\r\n        this.focusEditor();\r\n    },\r\n\r\n    /**\r\n     * Attach event listeners\r\n     */\r\n    attachListeners(): void {\r\n        if (!this.editor || !this.fileInput) return;\r\n\r\n        // Editor input listener for auto-save and word count\r\n        this.editor.addEventListener('input', () => {\r\n            this.handleEditorInput();\r\n            this.updateWordCount();\r\n        });\r\n\r\n        // Editor selection and cursor listener\r\n        this.editor.addEventListener('click', () => {\r\n            this.updateCursorPosition();\r\n        });\r\n\r\n        this.editor.addEventListener('keyup', () => {\r\n            this.updateCursorPosition();\r\n        });\r\n\r\n        // File input change listener\r\n        this.fileInput.addEventListener('change', event => {\r\n            this.handleFileSelect(event);\r\n        });\r\n\r\n        // Listen for theme changes to update CSS variables\r\n        const themeObserver = new MutationObserver(() => {\r\n            this.updateCSSVariables();\r\n        });\r\n        themeObserver.observe(document.documentElement, {\r\n            attributes: true,\r\n            attributeFilter: ['class'],\r\n        });\r\n\r\n        // Listen for language changes\r\n        window.addEventListener('languagePreferenceChange', () => {\r\n            this.updateDocumentTitle();\r\n            this.applyStatusState();\r\n        });\r\n\r\n        // Initial word count and cursor position\r\n        this.updateWordCount();\r\n        this.updateCursorPosition();\r\n    },\r\n\r\n    /**\r\n     * Register actions with ActionBus\r\n     */\r\n    registerActions(): void {\r\n        if (!window.ActionBus) return;\r\n\r\n        window.ActionBus.registerAll({\r\n            'textEditor:clear': () => this.clearEditor(),\r\n            'textEditor:open': () => this.openFile(),\r\n            'textEditor:save': () => this.saveFile(),\r\n            'textEditor:toggleWrap': () => this.toggleWrapMode(),\r\n            'textEditor:undo': () => this.execCommand('undo'),\r\n            'textEditor:redo': () => this.execCommand('redo'),\r\n            'textEditor:cut': () => this.execCommand('cut'),\r\n            'textEditor:copy': () => this.execCommand('copy'),\r\n            'textEditor:paste': () => this.handlePaste(),\r\n            'textEditor:selectAll': () => this.selectAll(),\r\n            // New formatting actions\r\n            'textEditor:bold': () => this.wrapSelection('**', '**'),\r\n            'textEditor:italic': () => this.wrapSelection('*', '*'),\r\n            'textEditor:underline': () => this.wrapSelection('<u>', '</u>'),\r\n            'textEditor:strikethrough': () => this.wrapSelection('~~', '~~'),\r\n            'textEditor:heading1': () => this.insertHeading(1),\r\n            'textEditor:heading2': () => this.insertHeading(2),\r\n            'textEditor:heading3': () => this.insertHeading(3),\r\n            'textEditor:unorderedList': () => this.insertList('unordered'),\r\n            'textEditor:orderedList': () => this.insertList('ordered'),\r\n            'textEditor:alignLeft': () => this.alignText('left'),\r\n            'textEditor:alignCenter': () => this.alignText('center'),\r\n            'textEditor:alignRight': () => this.alignText('right'),\r\n            'textEditor:insertLink': () => this.insertLink(),\r\n            'textEditor:findReplace': () => this.toggleFindReplace(),\r\n            'textEditor:findNext': () => this.findNext(),\r\n            'textEditor:replaceOne': () => this.replaceOne(),\r\n            'textEditor:replaceAll': () => this.replaceAll(),\r\n            'textEditor:closeFindReplace': () => this.closeFindReplace(),\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Handle editor input\r\n     */\r\n    handleEditorInput(): void {\r\n        if (!this.editor) return;\r\n\r\n        try {\r\n            setString('textEditorContent', this.editor.value);\r\n        } catch (err) {\r\n            console.warn('Could not save editor content to localStorage:', err);\r\n        }\r\n\r\n        this.syncSaveButtonState();\r\n    },\r\n\r\n    /**\r\n     * Handle file selection\r\n     */\r\n    handleFileSelect(event: Event): void {\r\n        const input = event.target as HTMLInputElement | null;\r\n        const file = input?.files?.[0];\r\n        if (!file) return;\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = (e: ProgressEvent<FileReader>) => {\r\n            const content = e.target?.result;\r\n            if (typeof content === 'string' && this.editor) {\r\n                this.editor.value = content;\r\n                this.updateWordCount();\r\n                this.updateCursorPosition();\r\n            }\r\n            this.currentRemoteFile = { fileName: file.name, content: '' };\r\n            this.updateDocumentTitle();\r\n            this.setStatusPlain(file.name);\r\n            this.syncSaveButtonState();\r\n            this.focusEditor();\r\n        };\r\n        reader.readAsText(file);\r\n\r\n        // Reset input for future opens\r\n        if (input) {\r\n            input.value = '';\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Load saved content from localStorage\r\n     */\r\n    loadSavedContent(): void {\r\n        if (!this.editor) return;\r\n\r\n        try {\r\n            const saved = getString('textEditorContent');\r\n            if (saved) {\r\n                this.editor.value = saved;\r\n                this.updateWordCount();\r\n                this.updateCursorPosition();\r\n            }\r\n        } catch (err) {\r\n            console.warn('Could not load saved content:', err);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Sync save button state\r\n     */\r\n    syncSaveButtonState(): void {\r\n        if (!this.saveButton || !this.editor) return;\r\n\r\n        this.saveButton.disabled = this.editor.value.length === 0;\r\n    },\r\n\r\n    /**\r\n     * Focus editor\r\n     */\r\n    focusEditor(): void {\r\n        if (this.editor) {\r\n            this.editor.focus();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Clear editor\r\n     */\r\n    clearEditor(): void {\r\n        if (!this.editor) return;\r\n\r\n        this.editor.value = '';\r\n        this.updateWordCount();\r\n        this.updateCursorPosition();\r\n        remove('textEditorContent');\r\n        this.currentRemoteFile = null;\r\n        this.updateDocumentTitle();\r\n        this.clearStatus();\r\n        this.syncSaveButtonState();\r\n        this.focusEditor();\r\n    },\r\n\r\n    /**\r\n     * Open file picker\r\n     */\r\n    openFile(): void {\r\n        if (this.fileInput) {\r\n            this.fileInput.click();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Save file\r\n     */\r\n    saveFile(): void {\r\n        if (!this.editor) return;\r\n\r\n        const content = this.editor.value;\r\n        const blob = new Blob([content], {\r\n            type: 'text/plain;charset=utf-8',\r\n        });\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n\r\n        const firstLine = content.split('\\n')[0] || 'text';\r\n        const sanitized =\r\n            firstLine\r\n                .trim()\r\n                .substring(0, 20)\r\n                .replace(/[^a-zA-Z0-9-_]/g, '') || 'text';\r\n        a.download = `${sanitized}.txt`;\r\n\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        document.body.removeChild(a);\r\n        URL.revokeObjectURL(url);\r\n    },\r\n\r\n    /**\r\n     * Execute document command\r\n     * @param {string} command - Command to execute\r\n     */\r\n    execCommand(command: string): void {\r\n        this.focusEditor();\r\n        try {\r\n            if (!document.execCommand(command)) {\r\n                this.setStatusPlain(`Command ${command} not available`);\r\n            }\r\n        } catch (err) {\r\n            console.warn(`Command ${command} failed:`, err);\r\n            this.setStatusPlain(`Command ${command} failed`);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Handle paste operation\r\n     */\r\n    handlePaste(e?: Event): void {\r\n        this.focusEditor();\r\n\r\n        if (navigator.clipboard && typeof navigator.clipboard.readText === 'function') {\r\n            navigator.clipboard\r\n                .readText()\r\n                .then(text => {\r\n                    if (text && this.editor) {\r\n                        this.insertTextAtCursor(text);\r\n                    }\r\n                })\r\n                .catch(() => {\r\n                    this.execCommand('paste');\r\n                });\r\n        } else {\r\n            this.execCommand('paste');\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Select all text\r\n     */\r\n    selectAll(): void {\r\n        this.focusEditor();\r\n        if (this.editor) {\r\n            this.editor.select();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Insert text at cursor position\r\n     * @param {string} text - Text to insert\r\n     */\r\n    insertTextAtCursor(text: string): void {\r\n        if (!this.editor || typeof text !== 'string') return;\r\n\r\n        const start =\r\n            typeof this.editor.selectionStart === 'number'\r\n                ? this.editor.selectionStart\r\n                : this.editor.value.length;\r\n        const end = typeof this.editor.selectionEnd === 'number' ? this.editor.selectionEnd : start;\r\n\r\n        this.editor.setRangeText(text, start, end, 'end');\r\n        this.editor.dispatchEvent(new Event('input', { bubbles: true }));\r\n    },\r\n\r\n    /**\r\n     * Update document title\r\n     */\r\n    updateDocumentTitle(): void {\r\n        const titleKey =\r\n            this.currentRemoteFile && this.currentRemoteFile.fileName\r\n                ? 'textEditor.documentTitleWithFile'\r\n                : 'textEditor.documentTitle';\r\n\r\n        const params =\r\n            this.currentRemoteFile && this.currentRemoteFile.fileName\r\n                ? { fileName: this.currentRemoteFile.fileName }\r\n                : undefined;\r\n\r\n        const { text } = this.resolveTranslation(titleKey, params);\r\n        document.title = text;\r\n    },\r\n\r\n    /**\r\n     * Format file label for display\r\n     * @param {Object} meta - File metadata\r\n     * @returns {string} Formatted label\r\n     */\r\n    formatFileLabel(meta: FileMeta = {}): string {\r\n        const parts = [];\r\n        if (meta.repo) parts.push(meta.repo);\r\n        if (meta.path) {\r\n            parts.push(meta.path);\r\n        } else if (meta.fileName) {\r\n            parts.push(meta.fileName);\r\n        }\r\n        return parts.join(' / ');\r\n    },\r\n\r\n    /**\r\n     * Set plain text status\r\n     * @param {string} text - Status text\r\n     */\r\n    setStatusPlain(text: string | null | undefined): void {\r\n        if (!text) {\r\n            this.clearStatus();\r\n            return;\r\n        }\r\n        this.statusState = { type: 'plain', text };\r\n        this.applyStatusState();\r\n    },\r\n\r\n    /**\r\n     * Set localized status\r\n     * @param {string} key - Translation key\r\n     * @param {Object} params - Translation parameters\r\n     */\r\n    setStatusLocalized(key: string, params?: Record<string, unknown>): void {\r\n        this.statusState = {\r\n            type: 'i18n',\r\n            key,\r\n            params: params || undefined,\r\n        };\r\n        this.applyStatusState();\r\n    },\r\n\r\n    /**\r\n     * Clear status\r\n     */\r\n    clearStatus(): void {\r\n        this.statusState = null;\r\n        this.applyStatusState();\r\n    },\r\n\r\n    /**\r\n     * Apply status state to UI\r\n     */\r\n    applyStatusState(): void {\r\n        if (!this.statusBar) return;\r\n\r\n        if (!this.statusState) {\r\n            this.statusBar.textContent = '';\r\n            this.statusBar.style.display = 'none';\r\n            this.statusBar.removeAttribute('data-i18n');\r\n            this.statusBar.removeAttribute('data-i18n-params');\r\n            return;\r\n        }\r\n\r\n        if (this.statusState.type === 'i18n') {\r\n            const { text, translated } = this.resolveTranslation(\r\n                this.statusState.key,\r\n                this.statusState.params\r\n            );\r\n            this.statusBar.textContent = text;\r\n\r\n            if (translated) {\r\n                this.statusBar.setAttribute('data-i18n', this.statusState.key);\r\n                if (this.statusState.params) {\r\n                    this.statusBar.setAttribute(\r\n                        'data-i18n-params',\r\n                        JSON.stringify(this.statusState.params)\r\n                    );\r\n                } else {\r\n                    this.statusBar.removeAttribute('data-i18n-params');\r\n                }\r\n\r\n                if (window.appI18n && typeof window.appI18n.applyTranslations === 'function') {\r\n                    window.appI18n.applyTranslations();\r\n                }\r\n            } else {\r\n                this.statusBar.removeAttribute('data-i18n');\r\n                this.statusBar.removeAttribute('data-i18n-params');\r\n            }\r\n        } else {\r\n            this.statusBar.removeAttribute('data-i18n');\r\n            this.statusBar.removeAttribute('data-i18n-params');\r\n            this.statusBar.textContent = this.statusState.text;\r\n        }\r\n\r\n        this.statusBar.style.display = 'block';\r\n    },\r\n\r\n    /**\r\n     * Resolve translation\r\n     * @param {string} key - Translation key\r\n     * @param {Object} params - Translation parameters\r\n     * @returns {Object} Resolved translation\r\n     */\r\n    resolveTranslation(\r\n        key: string,\r\n        params?: Record<string, unknown>\r\n    ): { text: string; translated: boolean } {\r\n        if (!key) return { text: '', translated: false };\r\n\r\n        const fallbackMessages = {\r\n            'textEditor.documentTitle': () => 'Texteditor',\r\n            'textEditor.documentTitleWithFile': (p: unknown) => {\r\n                const fileName = p && (p as any).fileName ? (p as any).fileName : '';\r\n                return fileName ? `Texteditor \u2013 ${fileName}` : 'Texteditor';\r\n            },\r\n            'textEditor.status.loading': () => 'Lade Datei \u2026',\r\n            'textEditor.status.loadingWithLabel': (p: unknown) => {\r\n                const label = p && (p as any).label ? (p as any).label : '';\r\n                return label ? `${label} (l\u00E4dt \u2026)` : 'Lade Datei \u2026';\r\n            },\r\n            'textEditor.status.loadError': () => 'Datei konnte nicht geladen werden.',\r\n            'textEditor.status.rateLimit': () =>\r\n                'GitHub Rate Limit erreicht. Bitte versuche es sp\u00E4ter erneut.',\r\n            'textEditor.status.wordCount': (p: unknown) => {\r\n                const words = p && typeof (p as any).words === 'number' ? (p as any).words : 0;\r\n                const chars = p && typeof (p as any).chars === 'number' ? (p as any).chars : 0;\r\n                return `Words: ${words} | Characters: ${chars}`;\r\n            },\r\n            'textEditor.status.position': (p: unknown) => {\r\n                const line = p && typeof (p as any).line === 'number' ? (p as any).line : 1;\r\n                const col = p && typeof (p as any).col === 'number' ? (p as any).col : 1;\r\n                return `Line ${line}, Col ${col}`;\r\n            },\r\n            'textEditor.findReplace.noMatch': () => 'No match found',\r\n            'textEditor.findReplace.replacedCount': (p: unknown) => {\r\n                const count = p && typeof (p as any).count === 'number' ? (p as any).count : 0;\r\n                return `Replaced ${count} occurrence(s)`;\r\n            },\r\n        } as Record<string, ((...args: unknown[]) => string) | (() => string)>;\r\n\r\n        try {\r\n            if (window.appI18n && typeof window.appI18n.translate === 'function') {\r\n                const translated = window.appI18n.translate(key);\r\n                if (translated && translated !== key) {\r\n                    return { text: translated, translated: true };\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.warn('Translation failed, falling back:', err);\r\n        }\r\n\r\n        const fallbackFn = fallbackMessages[key];\r\n        if (typeof fallbackFn === 'function') {\r\n            return { text: fallbackFn(params || {}), translated: false };\r\n        }\r\n\r\n        return { text: key, translated: false };\r\n    },\r\n\r\n    // ==================== Public API for Finder Integration ====================\r\n\r\n    /**\r\n     * Load remote file into editor\r\n     * @param {Object} payload - File payload\r\n     * @param {string} payload.content - File content\r\n     * @param {string} [payload.fileName] - File name\r\n     * @param {string} [payload.repo] - Repository name\r\n     * @param {string} [payload.path] - File path\r\n     */\r\n    loadRemoteFile(payload: Partial<RemoteFilePayload>): void {\r\n        if (typeof payload.content !== 'string') {\r\n            console.warn('Invalid payload for loadRemoteFile:', payload);\r\n            return;\r\n        }\r\n\r\n        const remotePayload: RemoteFilePayload = {\r\n            content: payload.content,\r\n            fileName: payload.fileName,\r\n            repo: payload.repo,\r\n            path: payload.path,\r\n        };\r\n\r\n        if (this.editor) {\r\n            this.editor.value = remotePayload.content;\r\n            this.updateWordCount();\r\n            this.updateCursorPosition();\r\n        }\r\n\r\n        this.currentRemoteFile = remotePayload;\r\n        const label = this.formatFileLabel(remotePayload);\r\n        this.updateDocumentTitle();\r\n        this.setStatusPlain(label);\r\n\r\n        try {\r\n            setString('textEditorContent', remotePayload.content);\r\n        } catch (err) {\r\n            console.warn('Could not save to localStorage:', err);\r\n        }\r\n\r\n        this.syncSaveButtonState();\r\n        this.focusEditor();\r\n    },\r\n\r\n    /**\r\n     * Show loading state\r\n     * @param {Object} payload - Loading payload\r\n     * @param {string} [payload.fileName] - File name\r\n     * @param {string} [payload.repo] - Repository name\r\n     * @param {string} [payload.path] - File path\r\n     */\r\n    showLoading(payload: FileMeta = {}): void {\r\n        const label = this.formatFileLabel(payload);\r\n        if (label) {\r\n            this.setStatusLocalized('textEditor.status.loadingWithLabel', {\r\n                label,\r\n            });\r\n        } else {\r\n            this.setStatusLocalized('textEditor.status.loading');\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Show load error\r\n     * @param {Object} payload - Error payload\r\n     * @param {string} [payload.message] - Error message\r\n     * @param {string} [payload.fileName] - File name\r\n     * @param {string} [payload.repo] - Repository name\r\n     * @param {string} [payload.path] - File path\r\n     */\r\n    showLoadError(payload: LoadErrorPayload = {}): void {\r\n        const label = this.formatFileLabel(payload);\r\n        const fallback = this.resolveTranslation('textEditor.status.loadError');\r\n        const message = payload && payload.message ? payload.message : fallback.text;\r\n\r\n        if (label) {\r\n            this.setStatusPlain(`${label} \u2014 ${message}`);\r\n        } else {\r\n            this.setStatusPlain(message);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Handle menu action\r\n     * @param {string} action - Action name\r\n     */\r\n    handleMenuAction(action: string): void {\r\n        if (!action) return;\r\n\r\n        const actionMap: Record<string, string> = {\r\n            'file:new': 'textEditor:clear',\r\n            'file:open': 'textEditor:open',\r\n            'file:save': 'textEditor:save',\r\n            'edit:undo': 'textEditor:undo',\r\n            'edit:redo': 'textEditor:redo',\r\n            'edit:cut': 'textEditor:cut',\r\n            'edit:copy': 'textEditor:copy',\r\n            'edit:paste': 'textEditor:paste',\r\n            'edit:selectAll': 'textEditor:selectAll',\r\n            'view:toggleWrap': 'textEditor:toggleWrap',\r\n        };\r\n\r\n        const mappedAction = actionMap[action];\r\n        if (mappedAction && window.ActionBus) {\r\n            window.ActionBus.execute(mappedAction);\r\n        } else {\r\n            console.warn('Unknown menu action:', action);\r\n        }\r\n    },\r\n\r\n    // ==================== New Formatting Methods ====================\r\n\r\n    /**\r\n     * Wrap selected text with prefix and suffix\r\n     * @param {string} prefix - Text to insert before selection\r\n     * @param {string} suffix - Text to insert after selection\r\n     */\r\n    wrapSelection(prefix: string, suffix: string): void {\r\n        if (!this.editor) return;\r\n\r\n        const start = this.editor.selectionStart;\r\n        const end = this.editor.selectionEnd;\r\n        const selectedText = this.editor.value.substring(start, end);\r\n        const wrappedText = prefix + selectedText + suffix;\r\n\r\n        this.editor.setRangeText(wrappedText, start, end, 'select');\r\n        this.editor.dispatchEvent(new Event('input', { bubbles: true }));\r\n        this.focusEditor();\r\n    },\r\n\r\n    /**\r\n     * Insert heading at current line\r\n     * @param {number} level - Heading level (1-3)\r\n     */\r\n    insertHeading(level: number): void {\r\n        if (!this.editor) return;\r\n\r\n        const start = this.editor.selectionStart;\r\n        const text = this.editor.value;\r\n\r\n        // Find the start of the current line\r\n        const lineStart = text.lastIndexOf('\\n', start - 1) + 1;\r\n        let lineEnd = text.indexOf('\\n', start);\r\n        if (lineEnd === -1) lineEnd = text.length;\r\n\r\n        const currentLine = text.substring(lineStart, lineEnd);\r\n        const prefix = '#'.repeat(level) + ' ';\r\n\r\n        // Check if line already starts with heading markers\r\n        const headingMatch = currentLine.match(/^#+\\s/);\r\n        let newLine;\r\n\r\n        if (headingMatch) {\r\n            // Replace existing heading\r\n            newLine = prefix + currentLine.substring(headingMatch[0].length);\r\n        } else {\r\n            // Add new heading\r\n            newLine = prefix + currentLine;\r\n        }\r\n\r\n        this.editor.setRangeText(newLine, lineStart, lineEnd, 'end');\r\n        this.editor.dispatchEvent(new Event('input', { bubbles: true }));\r\n        this.focusEditor();\r\n    },\r\n\r\n    /**\r\n     * Insert list at current line or for selected lines\r\n     * @param {string} type - List type ('ordered' or 'unordered')\r\n     */\r\n    insertList(type: 'ordered' | 'unordered'): void {\r\n        if (!this.editor) return;\r\n\r\n        const start = this.editor.selectionStart;\r\n        const end = this.editor.selectionEnd;\r\n        const text = this.editor.value;\r\n\r\n        // Find the start and end of affected lines\r\n        const lineStart = text.lastIndexOf('\\n', start - 1) + 1;\r\n        let lineEnd = text.indexOf('\\n', end);\r\n        if (lineEnd === -1) lineEnd = text.length;\r\n\r\n        const selectedLines = text.substring(lineStart, lineEnd).split('\\n');\r\n        const prefix = type === 'ordered' ? null : '- ';\r\n\r\n        const newLines = selectedLines.map((line, index) => {\r\n            // Remove existing list markers\r\n            const cleanLine = line.replace(/^(?:\\d+\\.\\s|-\\s|\\*\\s)/, '');\r\n\r\n            if (type === 'ordered') {\r\n                return `${index + 1}. ${cleanLine}`;\r\n            }\r\n            // use prefix for unordered lists\r\n            return `${prefix}${cleanLine}`;\r\n        });\r\n\r\n        const newText = newLines.join('\\n');\r\n        this.editor.setRangeText(newText, lineStart, lineEnd, 'end');\r\n        this.editor.dispatchEvent(new Event('input', { bubbles: true }));\r\n        this.focusEditor();\r\n    },\r\n\r\n    /**\r\n     * Align text (add HTML alignment tags)\r\n     * @param {string} alignment - Alignment type ('left', 'center', 'right')\r\n     */\r\n    alignText(alignment: 'left' | 'center' | 'right'): void {\r\n        if (!this.editor) return;\r\n\r\n        const start = this.editor.selectionStart;\r\n        const end = this.editor.selectionEnd;\r\n        const text = this.editor.value;\r\n\r\n        // Find the start and end of affected lines\r\n        const lineStart = text.lastIndexOf('\\n', start - 1) + 1;\r\n        let lineEnd = text.indexOf('\\n', end);\r\n        if (lineEnd === -1) lineEnd = text.length;\r\n\r\n        const selectedText = text.substring(lineStart, lineEnd);\r\n        const alignedText = `<div style=\"text-align: ${alignment};\">\\n${selectedText}\\n</div>`;\r\n\r\n        this.editor.setRangeText(alignedText, lineStart, lineEnd, 'end');\r\n        this.editor.dispatchEvent(new Event('input', { bubbles: true }));\r\n        this.focusEditor();\r\n    },\r\n\r\n    /**\r\n     * Insert link at cursor or wrap selection\r\n     */\r\n    insertLink(): void {\r\n        if (!this.editor) return;\r\n\r\n        const start = this.editor.selectionStart;\r\n        const end = this.editor.selectionEnd;\r\n        const selectedText = this.editor.value.substring(start, end);\r\n\r\n        const urlLabel =\r\n            this.resolveTranslation('textEditor.insertLink.enterUrl').text || 'Enter URL:';\r\n        this.showInputModal(urlLabel, 'https://example.com', 'https://').then(\r\n            (url: string | null) => {\r\n                if (!url) return;\r\n\r\n                const linkText = selectedText || 'link text';\r\n                const markdown = `[${linkText}](${url})`;\r\n\r\n                this.editor?.setRangeText(markdown, start, end, 'end');\r\n                this.editor?.dispatchEvent(new Event('input', { bubbles: true }));\r\n                this.focusEditor();\r\n            }\r\n        );\r\n    },\r\n\r\n    /**\r\n     * Update word and character count\r\n     */\r\n    updateWordCount(): void {\r\n        if (!this.editor || !this.wordCountDisplay) return;\r\n\r\n        const text = this.editor.value;\r\n        const chars = text.length;\r\n        const trimmedText = text.trim();\r\n        const words = trimmedText === '' ? 0 : trimmedText.split(/\\s+/).length;\r\n\r\n        // Use internal resolver (handles fallback + params)\r\n        const wc = this.resolveTranslation('textEditor.status.wordCount', { words, chars });\r\n        if (wc.translated) {\r\n            this.wordCountDisplay.textContent = wc.text;\r\n            return;\r\n        }\r\n\r\n        // Fallback to English\r\n        this.wordCountDisplay.textContent = `Words: ${words} | Characters: ${chars}`;\r\n    },\r\n\r\n    /**\r\n     * Update cursor position display\r\n     */\r\n    updateCursorPosition(): void {\r\n        if (!this.editor || !this.lineColDisplay) return;\r\n\r\n        const text = this.editor.value;\r\n        const pos = this.editor.selectionStart;\r\n\r\n        const textBeforeCursor = text.substring(0, pos);\r\n        const lines = textBeforeCursor.split('\\n');\r\n        const line = lines.length;\r\n        const lastLine = lines[lines.length - 1] || '';\r\n        const col = lastLine.length + 1;\r\n\r\n        // Use internal resolver (handles fallback + params)\r\n        const posMsg = this.resolveTranslation('textEditor.status.position', { line, col });\r\n        if (posMsg.translated) {\r\n            this.lineColDisplay.textContent = posMsg.text;\r\n            return;\r\n        }\r\n\r\n        // Fallback to English\r\n        this.lineColDisplay.textContent = `Line ${line}, Col ${col}`;\r\n    },\r\n\r\n    /**\r\n     * Toggle find and replace panel\r\n     */\r\n    toggleFindReplace(): void {\r\n        if (!this.findReplacePanel) return;\r\n\r\n        if (this.findReplacePanel.style.display === 'none') {\r\n            this.findReplacePanel.style.display = 'flex';\r\n            if (this.findInput) {\r\n                this.findInput.focus();\r\n            }\r\n        } else {\r\n            this.findReplacePanel.style.display = 'none';\r\n            this.focusEditor();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Close find and replace panel\r\n     */\r\n    closeFindReplace(): void {\r\n        if (!this.findReplacePanel) return;\r\n        this.findReplacePanel.style.display = 'none';\r\n        this.focusEditor();\r\n    },\r\n\r\n    /**\r\n     * Find next occurrence\r\n     */\r\n    findNext(): void {\r\n        if (!this.editor || !this.findInput) return;\r\n\r\n        const searchText = this.findInput.value;\r\n        if (!searchText) return;\r\n\r\n        const text = this.editor.value;\r\n        const start = this.editor.selectionEnd;\r\n        const index = text.indexOf(searchText, start);\r\n\r\n        if (index !== -1) {\r\n            this.editor.setSelectionRange(index, index + searchText.length);\r\n            this.editor.focus();\r\n        } else {\r\n            // Wrap around to beginning\r\n            const firstIndex = text.indexOf(searchText);\r\n            if (firstIndex !== -1) {\r\n                this.editor.setSelectionRange(firstIndex, firstIndex + searchText.length);\r\n                this.editor.focus();\r\n            } else {\r\n                const message =\r\n                    this.resolveTranslation('textEditor.findReplace.noMatch').text ||\r\n                    'No match found';\r\n                this.showToast(message, 'info');\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Replace one occurrence\r\n     */\r\n    replaceOne(): void {\r\n        if (!this.editor || !this.findInput || !this.replaceInput) return;\r\n\r\n        const searchText = this.findInput.value;\r\n        const replaceText = this.replaceInput.value;\r\n\r\n        if (!searchText) return;\r\n\r\n        const start = this.editor.selectionStart;\r\n        const end = this.editor.selectionEnd;\r\n        const selectedText = this.editor.value.substring(start, end);\r\n\r\n        if (selectedText === searchText) {\r\n            this.editor.setRangeText(replaceText, start, end, 'end');\r\n            this.editor.dispatchEvent(new Event('input', { bubbles: true }));\r\n            this.findNext(); // Find next occurrence\r\n        } else {\r\n            this.findNext(); // Find first occurrence\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Replace all occurrences\r\n     */\r\n    replaceAll(): void {\r\n        if (!this.editor || !this.findInput || !this.replaceInput) return;\r\n\r\n        const searchText = this.findInput.value;\r\n        const replaceText = this.replaceInput.value;\r\n\r\n        if (!searchText) return;\r\n\r\n        const text = this.editor.value;\r\n        const parts = text.split(searchText);\r\n        const count = parts.length - 1;\r\n\r\n        if (count > 0) {\r\n            const newText = parts.join(replaceText);\r\n            this.editor.value = newText;\r\n            this.editor.dispatchEvent(new Event('input', { bubbles: true }));\r\n\r\n            const message =\r\n                this.resolveTranslation('textEditor.findReplace.replacedCount', { count }).text ||\r\n                `Replaced ${count} occurrence(s)`;\r\n            this.showToast(message, 'success');\r\n        } else {\r\n            const message =\r\n                this.resolveTranslation('textEditor.findReplace.noMatch').text || 'No match found';\r\n            this.showToast(message, 'info');\r\n        }\r\n\r\n        this.focusEditor();\r\n    },\r\n\r\n    /**\r\n     * Show toast notification\r\n     * @param {string} message - Message to display\r\n     * @param {string} type - Toast type: 'info', 'success', 'error'\r\n     * @param {number} duration - Display duration in ms (default: 3000)\r\n     */\r\n    showToast(message: string, type: 'info' | 'success' | 'error' = 'info', duration = 3000): void {\r\n        if (!this.container) return;\r\n\r\n        const toast = document.createElement('div');\r\n        toast.className = `text-editor-toast text-editor-toast-${type}`;\r\n        toast.textContent = message;\r\n\r\n        // Add to container\r\n        if (!this.toastContainer) {\r\n            this.toastContainer = document.createElement('div');\r\n            this.toastContainer.className = 'text-editor-toast-container';\r\n            this.container.appendChild(this.toastContainer);\r\n        }\r\n\r\n        this.toastContainer.appendChild(toast);\r\n\r\n        // Trigger animation\r\n        setTimeout(() => toast.classList.add('show'), 10);\r\n\r\n        // Auto-remove\r\n        setTimeout(() => {\r\n            toast.classList.remove('show');\r\n            setTimeout(() => toast.remove(), 300);\r\n        }, duration);\r\n    },\r\n\r\n    /**\r\n     * Show input modal dialog\r\n     * @param {string} title - Modal title\r\n     * @param {string} placeholder - Input placeholder\r\n     * @param {string} defaultValue - Default input value\r\n     * @returns {Promise<string|null>} Resolves with input value or null if cancelled\r\n     */\r\n    showInputModal(title: string, defaultValue = '', placeholder = ''): Promise<string | null> {\r\n        return new Promise(resolve => {\r\n            const modal = document.createElement('div');\r\n            modal.className = 'text-editor-modal-overlay';\r\n\r\n            modal.innerHTML = `\r\n                    <div class=\"text-editor-modal\">\r\n                        <div class=\"text-editor-modal-header\">\r\n                            <h3>${title}</h3>\r\n                        </div>\r\n                        <div class=\"text-editor-modal-body\">\r\n                            <input type=\"text\" class=\"text-editor-modal-input\" placeholder=\"${placeholder}\" value=\"${defaultValue}\">\r\n                        </div>\r\n                        <div class=\"text-editor-modal-footer\">\r\n                            <button class=\"text-editor-modal-btn text-editor-modal-btn-cancel\">Cancel</button>\r\n                            <button class=\"text-editor-modal-btn text-editor-modal-btn-confirm\">OK</button>\r\n                        </div>\r\n                    </div>\r\n                `;\r\n\r\n            document.body.appendChild(modal);\r\n\r\n            const input = modal.querySelector(\r\n                '.text-editor-modal-input'\r\n            ) as HTMLInputElement | null;\r\n            const cancelBtn = modal.querySelector(\r\n                '.text-editor-modal-btn-cancel'\r\n            ) as HTMLButtonElement | null;\r\n            const confirmBtn = modal.querySelector(\r\n                '.text-editor-modal-btn-confirm'\r\n            ) as HTMLButtonElement | null;\r\n\r\n            if (!input || !cancelBtn || !confirmBtn) {\r\n                modal.remove();\r\n                resolve(null);\r\n                return;\r\n            }\r\n\r\n            // Focus input and select text\r\n            setTimeout(() => {\r\n                input?.focus();\r\n                input?.select();\r\n            }, 50);\r\n\r\n            const cleanup = () => {\r\n                modal.classList.add('closing');\r\n                setTimeout(() => modal.remove(), 200);\r\n            };\r\n\r\n            const handleConfirm = () => {\r\n                const value = input?.value.trim();\r\n                cleanup();\r\n                resolve(((value || '') as string) || null);\r\n            };\r\n\r\n            const handleCancel = () => {\r\n                cleanup();\r\n                resolve(null);\r\n            };\r\n\r\n            // Event listeners\r\n            confirmBtn.addEventListener('click', handleConfirm);\r\n            cancelBtn.addEventListener('click', handleCancel);\r\n            input.addEventListener('keydown', (e: KeyboardEvent) => {\r\n                if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    handleConfirm();\r\n                } else if (e.key === 'Escape') {\r\n                    e.preventDefault();\r\n                    handleCancel();\r\n                }\r\n            });\r\n\r\n            // Click outside to close\r\n            modal.addEventListener('click', (e: MouseEvent) => {\r\n                if (e.target === modal) {\r\n                    handleCancel();\r\n                }\r\n            });\r\n\r\n            // Trigger animation\r\n            setTimeout(() => modal.classList.add('show'), 10);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Destroy text editor\r\n     */\r\n    destroy(): void {\r\n        if (this.container) {\r\n            this.container.innerHTML = '';\r\n            this.container = null;\r\n        }\r\n        this.editor = null;\r\n        this.statusBar = null;\r\n        this.saveButton = null;\r\n        this.fileInput = null;\r\n        this.wordCountDisplay = null;\r\n        this.lineColDisplay = null;\r\n        this.findReplacePanel = null;\r\n        this.findInput = null;\r\n        this.replaceInput = null;\r\n        this.toastContainer = null;\r\n    },\r\n};\r\n\r\n// Export to global scope\r\nwindow.TextEditorSystem = TextEditorSystem;\r\n\r\n// Auto-init if container exists on load\r\nif (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', () => {\r\n        const container = document.getElementById('text-editor-container');\r\n        if (container) {\r\n            TextEditorSystem.init(container);\r\n        }\r\n    });\r\n} else {\r\n    const container = document.getElementById('text-editor-container');\r\n    if (container) {\r\n        TextEditorSystem.init(container);\r\n    }\r\n}\r\n// End of TextEditorSystem module\r\n", "/**\r\n * settings.ts\r\n * Settings Module - Inline settings UI with theme and language preferences\r\n */\r\n\r\nconsole.log('Settings Module loaded');\r\n\r\n(() => {\r\n    'use strict';\r\n\r\n    // ===== Types =====\r\n\r\n    type SectionName = 'general' | 'display' | 'language';\r\n\r\n    interface SettingsSystemType {\r\n        currentSection: SectionName;\r\n        container: HTMLElement | null;\r\n        init(containerOrId: HTMLElement | string): void;\r\n        render(): void;\r\n        attachListeners(): void;\r\n        syncThemePreference(): void;\r\n        syncLanguagePreference(): void;\r\n        showSection(section: SectionName): void;\r\n        destroy(): void;\r\n    }\r\n\r\n    // ===== Settings System Implementation =====\r\n\r\n    const SettingsSystem: SettingsSystemType = {\r\n        currentSection: 'general',\r\n        container: null,\r\n\r\n        /**\r\n         * Initialize settings module in container\r\n         */\r\n        init(containerOrId: HTMLElement | string): void {\r\n            const container =\r\n                typeof containerOrId === 'string'\r\n                    ? document.getElementById(containerOrId)\r\n                    : containerOrId;\r\n\r\n            if (!container) {\r\n                console.error('Settings container not found:', containerOrId);\r\n                return;\r\n            }\r\n\r\n            this.container = container;\r\n            this.render();\r\n            this.attachListeners();\r\n            this.syncThemePreference();\r\n            this.syncLanguagePreference();\r\n            this.showSection('general');\r\n        },\r\n\r\n        /**\r\n         * Render settings UI\r\n         */\r\n        render(): void {\r\n            if (!this.container) return;\r\n\r\n            this.container.innerHTML = `\r\n                <div class=\"flex dialog-content settings-panel rounded-b-xl overflow-hidden h-full\">\r\n                    <!-- Linke Seitenleiste -->\r\n                    <div class=\"w-48 bg-gray-100 dark:bg-gray-700 p-4 space-y-1 overflow-auto\">\r\n                        <button type=\"button\" class=\"w-full text-left cursor-pointer px-2 py-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded no-select\"\r\n                            data-action=\"settings:showSection\"\r\n                            data-section=\"general\"\r\n                            data-settings-page=\"general\"\r\n                            data-i18n=\"settingsPage.nav.general\">\r\n                            \uD83D\uDC64 Allgemein\r\n                        </button>\r\n                        <button type=\"button\" class=\"w-full text-left cursor-pointer px-2 py-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded no-select\"\r\n                            data-action=\"settings:showSection\"\r\n                            data-section=\"display\"\r\n                            data-settings-page=\"display\"\r\n                            data-i18n=\"settingsPage.nav.display\">\r\n                            \uD83D\uDDA5\uFE0F Darstellung\r\n                        </button>\r\n                        <button type=\"button\" class=\"w-full text-left cursor-pointer px-2 py-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded no-select\"\r\n                            data-action=\"settings:showSection\"\r\n                            data-section=\"language\"\r\n                            data-settings-page=\"language\"\r\n                            data-i18n=\"settingsPage.nav.language\">\r\n                            \uD83C\uDF10 Sprache\r\n                        </button>\r\n                    </div>\r\n                    <!-- Rechte Hauptansicht -->\r\n                    <div class=\"flex-1 p-6 overflow-auto text-gray-800 dark:text-gray-200\">\r\n                        <!-- Sektion: Allgemein -->\r\n                        <div id=\"settings-general\" class=\"\">\r\n                            <div class=\"flex flex-col items-start text-gray-700 dark:text-gray-200 mt-8 w-full space-y-4\">\r\n                                <img src=\"./img/profil.jpg\" alt=\"Bild\" class=\"w-24 h-24 object-contain mb-2\">\r\n                                <h2 class=\"text-xl font-semibold\" data-i18n=\"settingsPage.general.name\">Marvin Temmen</h2>\r\n                                <p class=\"text-sm\" data-i18n=\"settingsPage.general.birth\">M\u00E4rz 1999</p>\r\n                                <div class=\"bg-gray-200 dark:bg-gray-700 rounded-lg p-4 w-full grid grid-cols-1 sm:grid-cols-2 gap-y-2 gap-x-8\">\r\n                                    <div class=\"text-gray-600 dark:text-gray-300\" data-i18n=\"settingsPage.general.locationLabel\">Wohnort</div>\r\n                                    <div class=\"text-gray-800 dark:text-gray-100\" data-i18n=\"settingsPage.general.locationValue\">Deutschland</div>\r\n                                    <div class=\"text-gray-600 dark:text-gray-300\" data-i18n=\"settingsPage.general.jobLabel\">Beruf</div>\r\n                                    <div class=\"text-gray-800 dark:text-gray-100\" data-i18n=\"settingsPage.general.jobValue\">Softwareentwickler</div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <!-- Sektion: Darstellung -->\r\n                        <div id=\"settings-display\" class=\"hidden\">\r\n                            <div class=\"flex flex-col gap-6 mt-4 w-full\">\r\n                                <div>\r\n                                    <h2 class=\"text-lg font-semibold text-gray-800 dark:text-gray-100\"\r\n                                        data-i18n=\"settingsPage.display.title\">Darstellung</h2>\r\n                                    <p class=\"text-sm text-gray-600 dark:text-gray-300 mt-1\"\r\n                                        data-i18n=\"settingsPage.display.description\">\r\n                                        Passe das visuelle Erscheinungsbild der Oberfl\u00E4che an.\r\n                                    </p>\r\n                                </div>\r\n                                <fieldset class=\"bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 space-y-3\">\r\n                                    <legend class=\"text-sm font-medium text-gray-700 dark:text-gray-200 px-1\"\r\n                                        data-i18n=\"settingsPage.display.legend\">Darkmode</legend>\r\n                                    <label class=\"flex items-center gap-3 cursor-pointer select-none\">\r\n                                        <input type=\"radio\" name=\"theme-mode\" value=\"system\" class=\"h-4 w-4 text-blue-600 focus:ring-blue-500\">\r\n                                        <div>\r\n                                            <span class=\"block text-sm font-medium text-gray-800 dark:text-gray-100\"\r\n                                                data-i18n=\"settingsPage.display.options.system.label\">System</span>\r\n                                            <span class=\"block text-xs text-gray-600 dark:text-gray-300\"\r\n                                                data-i18n=\"settingsPage.display.options.system.description\">Folgt den aktuellen Systemeinstellungen.</span>\r\n                                        </div>\r\n                                    </label>\r\n                                    <label class=\"flex items-center gap-3 cursor-pointer select-none\">\r\n                                        <input type=\"radio\" name=\"theme-mode\" value=\"light\" class=\"h-4 w-4 text-blue-600 focus:ring-blue-500\">\r\n                                        <div>\r\n                                            <span class=\"block text-sm font-medium text-gray-800 dark:text-gray-100\"\r\n                                                data-i18n=\"settingsPage.display.options.light.label\">Hell</span>\r\n                                            <span class=\"block text-xs text-gray-600 dark:text-gray-300\"\r\n                                                data-i18n=\"settingsPage.display.options.light.description\">Bleibt immer im hellen Erscheinungsbild.</span>\r\n                                        </div>\r\n                                    </label>\r\n                                    <label class=\"flex items-center gap-3 cursor-pointer select-none\">\r\n                                        <input type=\"radio\" name=\"theme-mode\" value=\"dark\" class=\"h-4 w-4 text-blue-600 focus:ring-blue-500\">\r\n                                        <div>\r\n                                            <span class=\"block text-sm font-medium text-gray-800 dark:text-gray-100\"\r\n                                                data-i18n=\"settingsPage.display.options.dark.label\">Dunkel</span>\r\n                                            <span class=\"block text-xs text-gray-600 dark:text-gray-300\"\r\n                                                data-i18n=\"settingsPage.display.options.dark.description\">Bleibt immer im dunklen Erscheinungsbild.</span>\r\n                                        </div>\r\n                                    </label>\r\n                                </fieldset>\r\n                            </div>\r\n                        </div>\r\n                        <!-- Sektion: Sprache -->\r\n                        <div id=\"settings-language\" class=\"hidden\">\r\n                            <div class=\"flex flex-col gap-6 mt-4 w-full\">\r\n                                <div>\r\n                                    <h2 class=\"text-lg font-semibold text-gray-800 dark:text-gray-100\"\r\n                                        data-i18n=\"settingsPage.language.title\">Sprache</h2>\r\n                                    <p class=\"text-sm text-gray-600 dark:text-gray-300 mt-1\"\r\n                                        data-i18n=\"settingsPage.language.description\">\r\n                                        W\u00E4hle, in welcher Sprache die Oberfl\u00E4che angezeigt wird.\r\n                                    </p>\r\n                                </div>\r\n                                <fieldset class=\"bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 space-y-3\">\r\n                                    <legend class=\"text-sm font-medium text-gray-700 dark:text-gray-200 px-1\"\r\n                                        data-i18n=\"settingsPage.language.legend\">Bevorzugte Sprache</legend>\r\n                                    <label class=\"flex items-center gap-3 cursor-pointer select-none\">\r\n                                        <input type=\"radio\" name=\"language-preference\" value=\"system\"\r\n                                            class=\"h-4 w-4 text-blue-600 focus:ring-blue-500\">\r\n                                        <div>\r\n                                            <span class=\"block text-sm font-medium text-gray-800 dark:text-gray-100\"\r\n                                                data-i18n=\"settingsPage.language.options.system.label\">System</span>\r\n                                            <span class=\"block text-xs text-gray-600 dark:text-gray-300\"\r\n                                                data-i18n=\"settingsPage.language.options.system.description\">Verwendet automatisch die Sprache deines Systems.</span>\r\n                                        </div>\r\n                                    </label>\r\n                                    <label class=\"flex items-center gap-3 cursor-pointer select-none\">\r\n                                        <input type=\"radio\" name=\"language-preference\" value=\"de\"\r\n                                            class=\"h-4 w-4 text-blue-600 focus:ring-blue-500\">\r\n                                        <div>\r\n                                            <span class=\"block text-sm font-medium text-gray-800 dark:text-gray-100\"\r\n                                                data-i18n=\"settingsPage.language.options.de.label\">Deutsch</span>\r\n                                            <span class=\"block text-xs text-gray-600 dark:text-gray-300\"\r\n                                                data-i18n=\"settingsPage.language.options.de.description\">Zeigt Inhalte immer auf Deutsch.</span>\r\n                                        </div>\r\n                                    </label>\r\n                                    <label class=\"flex items-center gap-3 cursor-pointer select-none\">\r\n                                        <input type=\"radio\" name=\"language-preference\" value=\"en\"\r\n                                            class=\"h-4 w-4 text-blue-600 focus:ring-blue-500\">\r\n                                        <div>\r\n                                            <span class=\"block text-sm font-medium text-gray-800 dark:text-gray-100\"\r\n                                                data-i18n=\"settingsPage.language.options.en.label\">Englisch</span>\r\n                                            <span class=\"block text-xs text-gray-600 dark:text-gray-300\"\r\n                                                data-i18n=\"settingsPage.language.options.en.description\">Zeigt Inhalte immer auf Englisch.</span>\r\n                                        </div>\r\n                                    </label>\r\n                                </fieldset>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            `;\r\n\r\n            // Apply i18n translations\r\n            const appI18n = (window as Window & { appI18n?: { applyTranslations(el: HTMLElement): void } }).appI18n;\r\n            if (appI18n?.applyTranslations) {\r\n                appI18n.applyTranslations(this.container);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Attach event listeners\r\n         */\r\n        attachListeners(): void {\r\n            if (!this.container) return;\r\n\r\n            // Theme preference change listeners\r\n            const themeRadios = this.container.querySelectorAll<HTMLInputElement>('input[name=\"theme-mode\"]');\r\n            themeRadios.forEach(radio => {\r\n                radio.addEventListener('change', () => {\r\n                    if (!radio.checked) return;\r\n\r\n                    const theme = radio.value;\r\n                    // Call global API if available\r\n                    const API = (window as Window & { API?: { theme?: { setThemePreference(mode: string): void } } }).API;\r\n                    if (API?.theme?.setThemePreference) {\r\n                        API.theme.setThemePreference(theme);\r\n                    } else {\r\n                        // Fallback to ThemeSystem\r\n                        const ThemeSystem = (window as Window & { ThemeSystem?: { setThemePreference(mode: string): void } }).ThemeSystem;\r\n                        if (ThemeSystem?.setThemePreference) {\r\n                            ThemeSystem.setThemePreference(theme);\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n\r\n            // Language preference change listeners\r\n            const languageRadios = this.container.querySelectorAll<HTMLInputElement>('input[name=\"language-preference\"]');\r\n            languageRadios.forEach(radio => {\r\n                radio.addEventListener('change', () => {\r\n                    if (!radio.checked) return;\r\n\r\n                    const lang = radio.value;\r\n                    // Call global API if available\r\n                    const API = (window as Window & { API?: { i18n?: { setLanguagePreference(lang: string): void } } }).API;\r\n                    if (API?.i18n?.setLanguagePreference) {\r\n                        API.i18n.setLanguagePreference(lang);\r\n                    } else {\r\n                        // Fallback to appI18n\r\n                        const appI18n = (window as Window & { appI18n?: { setLanguagePreference(lang: string): void } }).appI18n;\r\n                        if (appI18n?.setLanguagePreference) {\r\n                            appI18n.setLanguagePreference(lang);\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Sync theme preference from global state\r\n         */\r\n        syncThemePreference(): void {\r\n            if (!this.container) return;\r\n\r\n            let preference = 'system';\r\n            const API = (window as Window & { API?: { theme?: { getThemePreference(): string } } }).API;\r\n            const ThemeSystem = (window as Window & { ThemeSystem?: { getThemePreference(): string } }).ThemeSystem;\r\n\r\n            if (API?.theme?.getThemePreference) {\r\n                preference = API.theme.getThemePreference();\r\n            } else if (ThemeSystem?.getThemePreference) {\r\n                preference = ThemeSystem.getThemePreference();\r\n            }\r\n\r\n            const themeRadios = this.container.querySelectorAll<HTMLInputElement>('input[name=\"theme-mode\"]');\r\n            themeRadios.forEach(radio => {\r\n                radio.checked = radio.value === preference;\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Sync language preference from global state\r\n         */\r\n        syncLanguagePreference(): void {\r\n            if (!this.container) return;\r\n\r\n            let preference = 'system';\r\n            const API = (window as Window & { API?: { i18n?: { getLanguagePreference(): string } } }).API;\r\n            const appI18n = (window as Window & { appI18n?: { getLanguagePreference(): string } }).appI18n;\r\n\r\n            if (API?.i18n?.getLanguagePreference) {\r\n                preference = API.i18n.getLanguagePreference();\r\n            } else if (appI18n?.getLanguagePreference) {\r\n                preference = appI18n.getLanguagePreference();\r\n            }\r\n\r\n            const languageRadios = this.container.querySelectorAll<HTMLInputElement>('input[name=\"language-preference\"]');\r\n            languageRadios.forEach(radio => {\r\n                radio.checked = radio.value === preference;\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Show specific settings section\r\n         */\r\n        showSection(section: SectionName): void {\r\n            if (!this.container) return;\r\n\r\n            this.currentSection = section;\r\n\r\n            // Hide all sections\r\n            const sections: SectionName[] = ['general', 'display', 'language'];\r\n            sections.forEach(name => {\r\n                const el = this.container?.querySelector(`#settings-${name}`);\r\n                if (el) {\r\n                    el.classList.add('hidden');\r\n                }\r\n            });\r\n\r\n            // Show target section\r\n            const target = this.container.querySelector(`#settings-${section}`);\r\n            if (target) {\r\n                target.classList.remove('hidden');\r\n            }\r\n\r\n            // Update nav highlighting\r\n            const navItems = this.container.querySelectorAll('[data-action=\"settings:showSection\"]');\r\n            navItems.forEach(item => {\r\n                const itemSection = item.getAttribute('data-section');\r\n                if (itemSection === section) {\r\n                    item.classList.add(\r\n                        'bg-white',\r\n                        'dark:bg-gray-600',\r\n                        'text-gray-900',\r\n                        'dark:text-gray-100',\r\n                        'font-medium'\r\n                    );\r\n                } else {\r\n                    item.classList.remove(\r\n                        'bg-white',\r\n                        'dark:bg-gray-600',\r\n                        'text-gray-900',\r\n                        'dark:text-gray-100',\r\n                        'font-medium'\r\n                    );\r\n                }\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Destroy settings module\r\n         */\r\n        destroy(): void {\r\n            if (this.container) {\r\n                this.container.innerHTML = '';\r\n                this.container = null;\r\n            }\r\n        },\r\n    };\r\n\r\n    // Export to global scope\r\n    (window as Window & { SettingsSystem: SettingsSystemType }).SettingsSystem = SettingsSystem;\r\n\r\n    // Auto-init if container exists on load\r\n    if (document.readyState === 'loading') {\r\n        document.addEventListener('DOMContentLoaded', () => {\r\n            const container = document.getElementById('settings-container');\r\n            if (container) {\r\n                SettingsSystem.init(container);\r\n            }\r\n        });\r\n    } else {\r\n        const container = document.getElementById('settings-container');\r\n        if (container) {\r\n            SettingsSystem.init(container);\r\n        }\r\n    }\r\n})();\r\n\r\nexport {};\r\n", "(function () {\r\n    'use strict';\r\n\r\n    type PlaceholderState = { key: string; params?: Record<string, unknown> } | null;\r\n\r\n    function getEl(id: string): HTMLElement | null {\r\n        return document.getElementById(id);\r\n    }\r\n\r\n    function applyTranslations(el: HTMLElement | null): void {\r\n        const w = window as unknown as { appI18n?: { applyTranslations: (n?: Element) => void } };\r\n        if (el && w.appI18n && typeof w.appI18n.applyTranslations === 'function') {\r\n            w.appI18n.applyTranslations(el);\r\n        }\r\n    }\r\n\r\n    function setPlaceholder(messageKey: string, params?: Record<string, unknown>): void {\r\n        const placeholder = getEl('image-placeholder');\r\n        if (!placeholder) return;\r\n        if (typeof messageKey !== 'string' || messageKey.length === 0) {\r\n            placeholder.removeAttribute('data-i18n');\r\n            placeholder.removeAttribute('data-i18n-params');\r\n            placeholder.textContent = '';\r\n\r\n            const domUtils = (window as any).DOMUtils;\r\n            if (domUtils && typeof domUtils.hide === 'function') {\r\n                domUtils.hide(placeholder);\r\n            } else {\r\n                placeholder.classList.add('hidden');\r\n            }\r\n\r\n            state.placeholder = null;\r\n            return;\r\n        }\r\n        placeholder.setAttribute('data-i18n', messageKey);\r\n        if (params && Object.keys(params).length > 0) {\r\n            placeholder.setAttribute('data-i18n-params', JSON.stringify(params));\r\n        } else {\r\n            placeholder.removeAttribute('data-i18n-params');\r\n        }\r\n        state.placeholder = { key: messageKey, params };\r\n        applyTranslations(placeholder);\r\n        {\r\n            const domUtils = (window as unknown as { DOMUtils?: { show?: (el: Element) => void } })\r\n                .DOMUtils;\r\n            if (domUtils && typeof domUtils.show === 'function') {\r\n                domUtils.show(placeholder);\r\n            } else {\r\n                placeholder.classList.remove('hidden');\r\n            }\r\n        }\r\n    }\r\n\r\n    function updateInfo(opts: {\r\n        repo?: string;\r\n        path?: string;\r\n        dimensions?: string;\r\n        size?: number;\r\n    }): void {\r\n        const infoEl = getEl('image-info');\r\n        if (!infoEl) return;\r\n        const parts: string[] = [];\r\n        if (opts.repo) parts.push(opts.repo);\r\n        if (opts.path) parts.push(opts.path);\r\n        const meta: string[] = [];\r\n        if (opts.dimensions) meta.push(opts.dimensions);\r\n        if (typeof opts.size === 'number' && opts.size > 0) {\r\n            const kb = (opts.size / 1024).toFixed(1);\r\n            meta.push(`${kb} KB`);\r\n        }\r\n        const info = [parts.join(' / '), meta.join(' \u2022 ')].filter(Boolean).join(' \u2014 ');\r\n        if (info) {\r\n            infoEl.textContent = info;\r\n            const domUtils = (window as unknown as { DOMUtils?: { show?: (el: Element) => void } })\r\n                .DOMUtils;\r\n            if (domUtils && typeof domUtils.show === 'function') {\r\n                domUtils.show(infoEl);\r\n            } else {\r\n                infoEl.classList.remove('hidden');\r\n            }\r\n        } else {\r\n            infoEl.textContent = '';\r\n            const domUtils = (window as unknown as { DOMUtils?: { hide?: (el: Element) => void } })\r\n                .DOMUtils;\r\n            if (domUtils && typeof domUtils.hide === 'function') {\r\n                domUtils.hide(infoEl);\r\n            } else {\r\n                infoEl.classList.add('hidden');\r\n            }\r\n        }\r\n    }\r\n\r\n    const state: { placeholder: PlaceholderState } = { placeholder: null };\r\n\r\n    // Re-apply placeholder on language change\r\n    const gw = window as unknown as Window & { __imageViewerUtilsWired?: boolean };\r\n    if (!gw.__imageViewerUtilsWired) {\r\n        gw.__imageViewerUtilsWired = true;\r\n        window.addEventListener('languagePreferenceChange', () => {\r\n            if (state.placeholder) {\r\n                setPlaceholder(state.placeholder.key, state.placeholder.params);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Export as globals (namespaced + legacy aliases if free)\r\n    type ImageViewerGlobal = Window & {\r\n        ImageViewerUtils?: {\r\n            setPlaceholder?: typeof setPlaceholder;\r\n            updateInfo?: typeof updateInfo;\r\n        };\r\n        setImagePlaceholder?: typeof setPlaceholder;\r\n        updateImageInfo?: typeof updateInfo;\r\n    };\r\n    const w = window as unknown as ImageViewerGlobal;\r\n    w.ImageViewerUtils = w.ImageViewerUtils || {};\r\n    w.ImageViewerUtils.setPlaceholder = setPlaceholder;\r\n    w.ImageViewerUtils.updateInfo = updateInfo;\r\n    if (typeof w.setImagePlaceholder !== 'function') w.setImagePlaceholder = setPlaceholder;\r\n    if (typeof w.updateImageInfo !== 'function') w.updateImageInfo = updateInfo;\r\n})();\r\n\r\n", "(function () {\r\n    'use strict';\r\n\r\n    type Instance = { instanceId: string };\r\n    type Manager = {\r\n        getAllInstances(): Instance[];\r\n        getActiveInstance(): Instance | null;\r\n        setActiveInstance(id: string): void;\r\n        createInstance(config?: { title?: string }): Instance | null;\r\n        destroyInstance(id: string): void;\r\n    };\r\n\r\n    interface Options {\r\n        scope?: HTMLElement | Document;\r\n        newTitleFactory?: () => string | undefined;\r\n    }\r\n\r\n    type Binding = {\r\n        key: string;\r\n        ctrl?: boolean;\r\n        shift?: boolean;\r\n        handler: () => void;\r\n        description?: string;\r\n        context?: string; // 'global' or a window type like 'finder'\r\n    };\r\n\r\n    const state = {\r\n        bindings: [] as Binding[],\r\n        contextResolver: (() => 'global') as () => string,\r\n        globalListenerAttached: false,\r\n    };\r\n\r\n    // Note: We intentionally do not branch on platform. We accept either Cmd (Meta) or Ctrl as modifier everywhere.\r\n\r\n    function isEditable(target: EventTarget | null): boolean {\r\n        if (!(target instanceof Element)) return false;\r\n        const tag = target.tagName?.toLowerCase();\r\n        if (tag === 'input' || tag === 'textarea' || tag === 'select') return true;\r\n        return (target as HTMLElement).isContentEditable;\r\n    }\r\n\r\n    function nextIndex(current: number, total: number): number {\r\n        return (current + 1) % total;\r\n    }\r\n\r\n    function prevIndex(current: number, total: number): number {\r\n        return (current - 1 + total) % total;\r\n    }\r\n\r\n    function isBinding(x: unknown): x is Binding {\r\n        if (typeof x !== 'object' || x === null) return false;\r\n        const obj = x as { key?: unknown; handler?: unknown };\r\n        return typeof obj.key === 'string' && typeof obj.handler === 'function';\r\n    }\r\n\r\n    // Legacy-friendly register that accepts a binding object (used by MultiInstanceIntegration)\r\n    function register(binding: Binding): () => void;\r\n    // Manager-scoped shortcuts helper (convenience API)\r\n    function register(manager: Manager, options?: Options): () => void;\r\n    function register(arg1: Binding | Manager, arg2: Options = {} as Options): () => void {\r\n        // Binding-style registry\r\n        if (isBinding(arg1)) {\r\n            const b = arg1 as Binding;\r\n            state.bindings.push(b);\r\n            ensureGlobalListener();\r\n            return () => {\r\n                const idx = state.bindings.indexOf(b);\r\n                if (idx >= 0) state.bindings.splice(idx, 1);\r\n            };\r\n        }\r\n\r\n        // Manager-style\r\n        const manager = arg1 as Manager;\r\n        const scope: Document | HTMLElement = arg2.scope || document;\r\n        const handler = (e: KeyboardEvent) => {\r\n            // Cross-platform: accept either Cmd (Meta) or Ctrl as the modifier\r\n            const mod = e.metaKey || e.ctrlKey;\r\n            if (!mod) return;\r\n            if (isEditable(e.target)) return;\r\n            const key = e.key.toLowerCase();\r\n\r\n            if (key === 'n' || key === 't') {\r\n                e.preventDefault();\r\n                const title = arg2.newTitleFactory?.();\r\n                manager.createInstance({ title });\r\n                return;\r\n            }\r\n\r\n            const active = manager.getActiveInstance();\r\n            const instances = manager.getAllInstances();\r\n            const total = instances.length;\r\n            if (total === 0) return;\r\n\r\n            if (key === 'w' && active) {\r\n                e.preventDefault();\r\n                manager.destroyInstance(active.instanceId);\r\n                return;\r\n            }\r\n\r\n            if (key === 'tab') {\r\n                e.preventDefault();\r\n                const currentIndex = active\r\n                    ? instances.findIndex(i => i.instanceId === active.instanceId)\r\n                    : -1;\r\n                const idx = e.shiftKey\r\n                    ? prevIndex(currentIndex, total)\r\n                    : nextIndex(currentIndex, total);\r\n                const target = instances[idx];\r\n                if (target) manager.setActiveInstance(target.instanceId);\r\n                return;\r\n            }\r\n\r\n            if (/^[1-9]$/.test(key)) {\r\n                e.preventDefault();\r\n                const n = parseInt(key, 10);\r\n                const idx = Math.min(n - 1, total - 1);\r\n                const target = instances[idx];\r\n                if (target) manager.setActiveInstance(target.instanceId);\r\n                return;\r\n            }\r\n        };\r\n        scope.addEventListener('keydown', handler as unknown as EventListener);\r\n        return () => scope.removeEventListener('keydown', handler as unknown as EventListener);\r\n    }\r\n\r\n    function ensureGlobalListener() {\r\n        if (state.globalListenerAttached) return;\r\n        const listener = (e: KeyboardEvent) => {\r\n            // Cross-platform: accept either Cmd (Meta) or Ctrl as the modifier\r\n            const mod = e.metaKey || e.ctrlKey;\r\n            if (!mod) return;\r\n            if (isEditable(e.target)) return;\r\n            const key = e.key.toLowerCase();\r\n            const context = state.contextResolver?.() || 'global';\r\n            // Find first matching binding for current context or global\r\n            const binding = state.bindings.find(b => {\r\n                if (b.key.toLowerCase() !== key) return false;\r\n                if (!!b.ctrl !== true) return false; // API expects ctrl/meta always true\r\n                if (!!b.shift !== !!e.shiftKey && b.shift !== undefined) return false;\r\n                if (b.context && b.context !== context) return false;\r\n                return true;\r\n            });\r\n            if (binding) {\r\n                e.preventDefault();\r\n                try {\r\n                    binding.handler();\r\n                } catch {}\r\n            }\r\n        };\r\n        document.addEventListener('keydown', listener as unknown as EventListener);\r\n        state.globalListenerAttached = true;\r\n    }\r\n\r\n    function setContextResolver(resolver: () => string) {\r\n        state.contextResolver = resolver;\r\n        ensureGlobalListener();\r\n    }\r\n\r\n    const KeyboardShortcuts = { register, setContextResolver };\r\n    (window as unknown as { [k: string]: unknown }).KeyboardShortcuts = KeyboardShortcuts;\r\n})();\r\n", "import { getJSON, setJSON, getString } from '../services/storage-utils.js';\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    const GITHUB_CACHE_NS = 'finderGithubCacheV1:';\r\n\r\n    function getCacheTtl(): number {\r\n        const dflt = 5 * 60 * 1000; // 5 minutes\r\n        try {\r\n            const constants =\r\n                (window as unknown as { APP_CONSTANTS?: Record<string, unknown> }).APP_CONSTANTS ||\r\n                {};\r\n            const val = (constants as Record<string, unknown>)['GITHUB_CACHE_DURATION'];\r\n            return typeof val === 'number' ? (val as number) : dflt;\r\n        } catch {\r\n            return dflt;\r\n        }\r\n    }\r\n\r\n    function makeCacheKey(kind: 'repos' | 'contents', repo = '', subPath = ''): string {\r\n        if (kind === 'repos') return GITHUB_CACHE_NS + 'repos';\r\n        return `${GITHUB_CACHE_NS}contents:${repo}:${subPath}`;\r\n    }\r\n\r\n    function writeCache(\r\n        kind: 'repos' | 'contents',\r\n        repo: string,\r\n        subPath: string,\r\n        data: unknown\r\n    ): void {\r\n        const key = makeCacheKey(kind, repo, subPath);\r\n        try {\r\n            const payload = { t: Date.now(), d: data };\r\n            setJSON(key, payload);\r\n        } catch {\r\n            /* ignore */\r\n        }\r\n    }\r\n\r\n    function readCache<T = unknown>(kind: 'repos' | 'contents', repo = '', subPath = ''): T | null {\r\n        const key = makeCacheKey(kind, repo, subPath);\r\n        try {\r\n            const parsed = getJSON<{ t: number; d: T } | null>(key, null);\r\n            if (!parsed || typeof parsed !== 'object') return null;\r\n            const ttl = getCacheTtl();\r\n            if (typeof parsed.t !== 'number' || Date.now() - parsed.t > ttl) return null;\r\n            return (parsed.d as T) ?? null;\r\n        } catch {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    function getHeaders(): Record<string, string> {\r\n        const headers: Record<string, string> = { Accept: 'application/vnd.github.v3+json' };\r\n        try {\r\n            const token = getString('githubToken');\r\n            if (token && token.trim()) {\r\n                headers['Authorization'] = `token ${token.trim()}`;\r\n            }\r\n        } catch {\r\n            /* ignore */\r\n        }\r\n        return headers;\r\n    }\r\n\r\n    async function fetchJSON<T = unknown>(url: string): Promise<T> {\r\n        const res = await fetch(url, { headers: getHeaders() });\r\n        if (!res.ok) {\r\n            throw Object.assign(new Error(`GitHub API error: ${res.status}`), {\r\n                status: res.status,\r\n            });\r\n        }\r\n        return res.json() as Promise<T>;\r\n    }\r\n\r\n    async function fetchUserRepos(\r\n        username: string,\r\n        params?: { per_page?: number; sort?: string }\r\n    ): Promise<unknown[]> {\r\n        const search = new globalThis.URLSearchParams();\r\n        search.set('per_page', String(params?.per_page ?? 100));\r\n        search.set('sort', params?.sort ?? 'updated');\r\n        const url = `https://api.github.com/users/${encodeURIComponent(username)}/repos?${search.toString()}`;\r\n        return fetchJSON<unknown[]>(url);\r\n    }\r\n\r\n    async function fetchRepoContents(\r\n        username: string,\r\n        repo: string,\r\n        subPath = ''\r\n    ): Promise<unknown> {\r\n        const pathPart = subPath ? `/${encodeURIComponent(subPath).replace(/%2F/g, '/')}` : '';\r\n        const url = `https://api.github.com/repos/${encodeURIComponent(username)}/${encodeURIComponent(repo)}/contents${pathPart}`;\r\n        return fetchJSON<unknown>(url);\r\n    }\r\n\r\n    type GitHubAPINamespace = {\r\n        getHeaders: () => Record<string, string>;\r\n        readCache: <T = unknown>(\r\n            kind: 'repos' | 'contents',\r\n            repo?: string,\r\n            subPath?: string\r\n        ) => T | null;\r\n        writeCache: (\r\n            kind: 'repos' | 'contents',\r\n            repo: string,\r\n            subPath: string,\r\n            data: unknown\r\n        ) => void;\r\n        fetchJSON: <T = unknown>(url: string) => Promise<T>;\r\n        fetchUserRepos: (\r\n            username: string,\r\n            params?: { per_page?: number; sort?: string }\r\n        ) => Promise<unknown[]>;\r\n        fetchRepoContents: (username: string, repo: string, subPath?: string) => Promise<unknown>;\r\n    };\r\n\r\n    (window as unknown as { GitHubAPI: GitHubAPINamespace }).GitHubAPI = {\r\n        getHeaders,\r\n        readCache,\r\n        writeCache,\r\n        fetchJSON,\r\n        fetchUserRepos,\r\n        fetchRepoContents,\r\n    };\r\n})();\r\n", "\uFEFF/*\r\n * Fotos-App \u0393\u00C7\u00F4 inspiriert von der macOS Fotos Anwendung.\r\n * L\u251C\u00F1dt Bilder aus der Picsum API, gruppiert sie in verschiedene Ansichten\r\n * und stellt einen Detail-Viewer inklusive Favoritenverwaltung bereit.\r\n */\r\n\r\n type Orientation = 'landscape' | 'portrait' | 'square';\r\n type SidebarFilter = 'all' | 'favorites' | Orientation;\r\n type SegmentView = 'moments' | 'collections' | 'years';\r\n\r\n interface PicsumApiPhoto {\r\n     id: string;\r\n     author: string;\r\n     width: number;\r\n     height: number;\r\n     url: string;\r\n     download_url: string;\r\n }\r\n\r\n interface PhotoLibraryItem {\r\n     id: string;\r\n     author: string;\r\n     width: number;\r\n     height: number;\r\n     orientation: Orientation;\r\n     year: number;\r\n     url: string;\r\n     downloadUrl: string;\r\n     thumbUrl: string;\r\n     largeUrl: string;\r\n }\r\n\r\n interface ExternalPhotoItem {\r\n     id: string;\r\n     author: string;\r\n     downloadUrl: string;\r\n     largeUrl: string;\r\n     url?: string;\r\n     width?: number;\r\n     height?: number;\r\n     orientation?: Orientation;\r\n     sourceName?: string;\r\n     isExternal: true;\r\n }\r\n\r\n type AnyPhotoItem = PhotoLibraryItem | ExternalPhotoItem;\r\n\r\ninterface PhotosElements {\r\n    container: HTMLElement | null;\r\n    sidebar: HTMLElement | null;\r\n    gallery: HTMLElement | null;\r\n    loading: HTMLElement | null;\r\n    error: HTMLElement | null;\r\n    errorRetry: HTMLButtonElement | null;\r\n    empty: HTMLElement | null;\r\n    placeholder: HTMLElement | null;\r\n    photoCount: HTMLElement | null;\r\n    refreshButton: HTMLButtonElement | null;\r\n    searchInput: HTMLInputElement | null;\r\n    searchClear: HTMLButtonElement | null;\r\n    sidebarButtons: HTMLButtonElement[];\r\n    segmentButtons: HTMLButtonElement[];\r\n    overlay: HTMLElement | null;\r\n    detailTitle: HTMLElement | null;\r\n    detailMeta: HTMLElement | null;\r\n    detailDimensions: HTMLElement | null;\r\n    detailCounter: HTMLElement | null;\r\n    detailOpen: HTMLAnchorElement | null;\r\n    detailDownload: HTMLAnchorElement | null;\r\n    detailFavorite: HTMLButtonElement | null;\r\n    detailFavoriteLabel: HTMLElement | null;\r\n    detailFavoriteIcon: HTMLElement | null;\r\n    detailClose: HTMLButtonElement | null;\r\n    detailPrev: HTMLButtonElement | null;\r\n    detailNext: HTMLButtonElement | null;\r\n    image: HTMLImageElement | null;\r\n    imageInfo: HTMLElement | null;\r\n    loader: HTMLElement | null;\r\n    countAll: HTMLElement | null;\r\n    countFavorites: HTMLElement | null;\r\n    countLandscape: HTMLElement | null;\r\n    countPortrait: HTMLElement | null;\r\n    countSquare: HTMLElement | null;\r\n    titlebar: HTMLElement | null;\r\n    statusbar: HTMLElement | null;\r\n} interface PhotosState {\r\n     initialized: boolean;\r\n     photos: PhotoLibraryItem[];\r\n     filteredPhotos: PhotoLibraryItem[];\r\n     filteredIndexMap: Map<string, number>;\r\n     favorites: Set<string>;\r\n     activeFilter: SidebarFilter;\r\n     activeSegment: SegmentView;\r\n     searchTerm: string;\r\n     isLoading: boolean;\r\n     currentPage: number;\r\n     overlayVisible: boolean;\r\n     selectedIndex: number;\r\n     activePhotoId: string | null;\r\n     externalPhoto: ExternalPhotoItem | null;\r\n     pendingImageId: string | null;\r\n     orientationCounts: Record<Orientation, number>;\r\n }\r\n\r\n interface PhotosAppApi {\r\n     init: () => void;\r\n     showExternalImage: (payload: { src: string; name?: string }) => void;\r\n }\r\n\r\ninterface PhotoGroup {\r\n    title: string;\r\n    photos: PhotoLibraryItem[];\r\n}\r\n\r\ntype TranslateFn = (key: string, params?: Record<string, unknown>, options?: { fallback?: string }) => string;\r\n\r\nconst globalWindow = window as typeof window & {\r\n    appI18n?: {\r\n        translate?: TranslateFn;\r\n        applyTranslations?: (root?: Element | Document) => void;\r\n    };\r\n    PhotosApp?: PhotosAppApi;\r\n    WindowChrome?: {\r\n        createWindowFrame: (config: unknown) => {\r\n            frame: HTMLElement;\r\n            titlebar: HTMLElement;\r\n            content: HTMLElement;\r\n            statusbar: HTMLElement | null;\r\n        };\r\n        updateStatusBar: (statusbar: HTMLElement, side: 'left' | 'right', content: string) => void;\r\n    };\r\n    API?: {\r\n        window?: {\r\n            close?: (windowId: string) => void;\r\n        };\r\n    };\r\n};\r\n\r\nfunction t(key: string, fallback: string, params?: Record<string, unknown>): string {\r\n    const translate = globalWindow.appI18n?.translate;\r\n    if (typeof translate === 'function') {\r\n        return translate(key, params, { fallback });\r\n    }\r\n    return fallback;\r\n}\r\n\r\n(function photosAppFactory() {\r\n    const state: PhotosState = {\r\n        initialized: false,\r\n        photos: [],\r\n        filteredPhotos: [],\r\n         filteredIndexMap: new Map(),\r\n         favorites: new Set(),\r\n         activeFilter: 'all',\r\n         activeSegment: 'moments',\r\n         searchTerm: '',\r\n         isLoading: false,\r\n         currentPage: 1,\r\n         overlayVisible: false,\r\n         selectedIndex: -1,\r\n         activePhotoId: null,\r\n         externalPhoto: null,\r\n         pendingImageId: null,\r\n         orientationCounts: { landscape: 0, portrait: 0, square: 0 },\r\n     };\r\n\r\n    const elements: PhotosElements = {\r\n        container: null,\r\n        sidebar: null,\r\n        gallery: null,\r\n        loading: null,\r\n        error: null,\r\n        errorRetry: null,\r\n        empty: null,\r\n        placeholder: null,\r\n        photoCount: null,\r\n        refreshButton: null,\r\n        searchInput: null,\r\n        searchClear: null,\r\n        sidebarButtons: [],\r\n        segmentButtons: [],\r\n        overlay: null,\r\n        detailTitle: null,\r\n        detailMeta: null,\r\n        detailDimensions: null,\r\n        detailCounter: null,\r\n        detailOpen: null,\r\n        detailDownload: null,\r\n        detailFavorite: null,\r\n        detailFavoriteLabel: null,\r\n        detailFavoriteIcon: null,\r\n        detailClose: null,\r\n        detailPrev: null,\r\n        detailNext: null,\r\n        image: null,\r\n        imageInfo: null,\r\n        loader: null,\r\n        countAll: null,\r\n        countFavorites: null,\r\n        countLandscape: null,\r\n        countPortrait: null,\r\n        countSquare: null,\r\n        titlebar: null,\r\n        statusbar: null,\r\n    };    function isExternalPhoto(photo: AnyPhotoItem): photo is ExternalPhotoItem {\r\n        return (photo as ExternalPhotoItem).isExternal === true;\r\n    }\r\n\r\n    function renderWindow(): HTMLElement | null {\r\n        const WindowChrome = globalWindow.WindowChrome;\r\n        if (!WindowChrome) {\r\n            console.error('WindowChrome not available');\r\n            return null;\r\n        }\r\n\r\n        const { frame, titlebar, content, statusbar } = WindowChrome.createWindowFrame({\r\n            title: t('photos.title', 'Fotos'),\r\n            icon: './img/fotos.png',\r\n            showClose: true,\r\n            showMinimize: false,\r\n            showMaximize: false,\r\n            onClose: () => {\r\n                globalWindow.API?.window?.close?.('photos-window');\r\n            },\r\n            toolbar: [\r\n                {\r\n                    label: '',\r\n                    icon: `<div class=\"relative flex-1 sm:flex-initial min-w-[200px]\">\r\n                        <input id=\"photos-search\" type=\"search\" placeholder=\"${t('photos.search.placeholder', 'Nach Autor suchen')}\" \r\n                            class=\"w-full rounded-2xl border border-gray-300 dark:border-gray-700 bg-white/70 dark:bg-gray-900/70 px-4 py-2 text-sm text-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400\" />\r\n                        <button id=\"photos-search-clear\" type=\"button\" class=\"absolute inset-y-0 right-2 flex items-center text-xl text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 invisible pointer-events-none\" \r\n                            title=\"${t('photos.search.clear', 'Suche l\u00F6schen')}\">\u00D7</button>\r\n                    </div>`,\r\n                },\r\n                { type: 'separator' },\r\n                {\r\n                    label: '',\r\n                    icon: `<div class=\"flex bg-gray-200 dark:bg-gray-800 rounded-full p-1 text-sm font-medium text-gray-600 dark:text-gray-300 shadow-inner\" role=\"group\">\r\n                        <button type=\"button\" data-photos-segment=\"moments\" class=\"photos-segment-button\">${t('photos.segments.moments', 'Momente')}</button>\r\n                        <button type=\"button\" data-photos-segment=\"collections\" class=\"photos-segment-button\">${t('photos.segments.collections', 'Sammlungen')}</button>\r\n                        <button type=\"button\" data-photos-segment=\"years\" class=\"photos-segment-button\">${t('photos.segments.years', 'Jahre')}</button>\r\n                    </div>`,\r\n                },\r\n            ],\r\n            showStatusBar: true,\r\n            statusBarLeft: t('photos.status.countPlaceholder', '\u2013 Fotos'),\r\n            statusBarRight: '',\r\n        });\r\n\r\n        // Store references\r\n        elements.titlebar = titlebar;\r\n        elements.statusbar = statusbar;\r\n\r\n        // Build sidebar\r\n        const sidebar = document.createElement('aside');\r\n        sidebar.className = 'hidden md:flex flex-col w-56 border-r border-gray-200 dark:border-gray-800 bg-gray-50/80 dark:bg-gray-900/60';\r\n        sidebar.innerHTML = `\r\n            <div class=\"px-5 pt-6 pb-4\">\r\n                <p class=\"text-xs uppercase tracking-[0.2em] text-gray-400 dark:text-gray-500\">${t('photos.sidebar.library', 'Bibliothek')}</p>\r\n                <nav class=\"mt-4 space-y-1\" id=\"photos-sidebar\">\r\n                    <button type=\"button\" data-photos-filter=\"all\" class=\"photos-sidebar-button\">\r\n                        <span>${t('photos.sidebar.items.all', 'Alle Fotos')}</span>\r\n                        <span id=\"photos-count-all\" class=\"photos-sidebar-count\">\u2013</span>\r\n                    </button>\r\n                    <button type=\"button\" data-photos-filter=\"favorites\" class=\"photos-sidebar-button\">\r\n                        <span>${t('photos.sidebar.items.favorites', 'Favoriten')}</span>\r\n                        <span id=\"photos-count-favorites\" class=\"photos-sidebar-count\">0</span>\r\n                    </button>\r\n                </nav>\r\n                <p class=\"text-xs uppercase tracking-[0.2em] text-gray-400 dark:text-gray-500 mt-6\">${t('photos.sidebar.filters', 'Filter')}</p>\r\n                <nav class=\"mt-4 space-y-1\">\r\n                    <button type=\"button\" data-photos-filter=\"landscape\" class=\"photos-sidebar-button\">\r\n                        <span>${t('photos.sidebar.items.landscape', 'Querformat')}</span>\r\n                        <span id=\"photos-count-landscape\" class=\"photos-sidebar-count\">\u2013</span>\r\n                    </button>\r\n                    <button type=\"button\" data-photos-filter=\"portrait\" class=\"photos-sidebar-button\">\r\n                        <span>${t('photos.sidebar.items.portrait', 'Hochformat')}</span>\r\n                        <span id=\"photos-count-portrait\" class=\"photos-sidebar-count\">\u2013</span>\r\n                    </button>\r\n                    <button type=\"button\" data-photos-filter=\"square\" class=\"photos-sidebar-button\">\r\n                        <span>${t('photos.sidebar.items.square', 'Quadratisch')}</span>\r\n                        <span id=\"photos-count-square\" class=\"photos-sidebar-count\">\u2013</span>\r\n                    </button>\r\n                </nav>\r\n            </div>\r\n            <div class=\"px-5 pb-6 mt-auto\">\r\n                <button id=\"photos-refresh\" type=\"button\" class=\"w-full inline-flex items-center justify-center gap-2 px-3 py-2 text-sm font-medium rounded-2xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-200 transition hover:border-blue-400 hover:text-blue-600 dark:hover:border-blue-400 dark:hover:text-blue-300\">\r\n                    <span aria-hidden=\"true\">\u21BB</span>\r\n                    <span>${t('photos.sidebar.refresh', 'Neu laden')}</span>\r\n                </button>\r\n                <p class=\"text-[11px] text-gray-400 dark:text-gray-500 mt-3 leading-relaxed\">${t('photos.sidebar.sourceNote', 'Quelle: Lorem Picsum \u2013 zuf\u00E4llige kuratierte Fotokollektionen.')}</p>\r\n            </div>\r\n        `;\r\n\r\n        // Build main area\r\n        const mainArea = document.createElement('div');\r\n        mainArea.className = 'flex-1 flex flex-col min-h-0 relative';\r\n        mainArea.innerHTML = `\r\n            <div class=\"flex-1 relative min-h-0\">\r\n                <div id=\"photos-loading\" class=\"absolute inset-0 flex items-center justify-center bg-white/80 dark:bg-gray-900/80 z-20 hidden\">\r\n                    <div class=\"flex flex-col items-center gap-2 text-gray-600 dark:text-gray-300\">\r\n                        <span class=\"h-10 w-10 border-4 border-gray-300 dark:border-gray-700 border-t-blue-500 dark:border-t-blue-400 rounded-full animate-spin\"></span>\r\n                        <span class=\"text-sm font-medium\">${t('photos.status.loading', 'Lade Fotos\u2026')}</span>\r\n                    </div>\r\n                </div>\r\n                <div id=\"photos-error\" class=\"absolute inset-x-0 top-6 mx-auto max-w-lg bg-red-50 dark:bg-red-900/40 text-red-700 dark:text-red-200 rounded-2xl shadow px-5 py-4 hidden\">\r\n                    <p class=\"font-semibold mb-1\">${t('photos.errors.heading', 'Fehler beim Laden')}</p>\r\n                    <p class=\"text-sm\">${t('photos.errors.description', 'Bitte \u00FCberpr\u00FCfe deine Verbindung und versuche es erneut.')}</p>\r\n                    <button id=\"photos-error-retry\" type=\"button\" class=\"mt-3 inline-flex items-center gap-2 text-sm font-medium text-red-700 dark:text-red-100 underline decoration-dotted\">${t('photos.buttons.retry', 'Erneut versuchen')}</button>\r\n                </div>\r\n                <div id=\"photos-gallery\" class=\"absolute inset-0 overflow-y-auto px-5 sm:px-6 py-6 space-y-8\"></div>\r\n                <div id=\"photos-empty\" class=\"absolute inset-0 flex items-center justify-center text-center text-gray-500 dark:text-gray-400 hidden px-6\">\r\n                    <div>\r\n                        <p class=\"text-lg font-semibold\">${t('photos.empty.title', 'Keine Fotos gefunden')}</p>\r\n                        <p class=\"text-sm mt-1\">${t('photos.empty.description', 'Passe Suche oder Filter an, um weitere Ergebnisse zu sehen.')}</p>\r\n                    </div>\r\n                </div>\r\n                <div id=\"image-placeholder\" class=\"absolute inset-0 flex items-center justify-center text-gray-500 dark:text-gray-400 text-center px-6 hidden pointer-events-none\">${t('photos.placeholder', 'W\u00E4hle ein Foto aus, um Details zu sehen.')}</div>\r\n            </div>\r\n        `;\r\n\r\n        // Detail overlay\r\n        const detailOverlay = document.createElement('div');\r\n        detailOverlay.id = 'photo-detail-overlay';\r\n        detailOverlay.className = 'absolute inset-0 hidden items-center justify-center px-4 py-10 bg-black/50 backdrop-blur-sm z-30';\r\n        detailOverlay.innerHTML = `\r\n            <div class=\"bg-white dark:bg-gray-900 rounded-3xl shadow-2xl overflow-hidden max-w-5xl w-full h-full flex flex-col\">\r\n                <div class=\"flex items-center gap-4 px-6 py-4 border-b border-gray-200 dark:border-gray-800\">\r\n                    <div class=\"flex-1 min-w-0\">\r\n                        <p id=\"photo-detail-title\" class=\"text-xl font-semibold text-gray-900 dark:text-gray-100 truncate\">${t('photos.detail.titleFallback', 'Foto')}</p>\r\n                        <p id=\"photo-detail-meta\" class=\"text-sm text-gray-500 dark:text-gray-400 mt-1 truncate\"></p>\r\n                    </div>\r\n                    <div class=\"flex items-center gap-2\">\r\n                        <button id=\"photo-detail-favorite\" type=\"button\" class=\"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200 text-sm font-medium transition hover:bg-gray-200 dark:hover:bg-gray-700\">\r\n                            <span aria-hidden=\"true\">\u2661</span>\r\n                            <span>${t('photos.detail.favoriteAdd', 'Zu Favoriten')}</span>\r\n                        </button>\r\n                        <a id=\"photo-detail-download\" class=\"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-blue-600 text-white text-sm font-medium transition hover:bg-blue-500\" href=\"#\" target=\"_blank\" rel=\"noreferrer\">${t('photos.detail.download', 'Herunterladen')}</a>\r\n                        <button id=\"photo-detail-close\" type=\"button\" class=\"inline-flex items-center justify-center w-9 h-9 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200 text-lg leading-none transition hover:bg-gray-200 dark:hover:bg-gray-700\" title=\"${t('common.close', 'Schlie\u00DFen')}\">\u00D7</button>\r\n                    </div>\r\n                </div>\r\n                <div class=\"flex-1 flex overflow-hidden\">\r\n                    <button id=\"photo-detail-prev\" type=\"button\" class=\"hidden sm:flex items-center justify-center w-14 bg-transparent text-3xl text-gray-400 dark:text-gray-500 hover:text-gray-700 dark:hover:text-gray-200 transition\" title=\"${t('photos.detail.prev', 'Vorheriges Foto')}\">\u2039</button>\r\n                    <div class=\"flex-1 relative bg-gray-50 dark:bg-gray-950 flex items-center justify-center overflow-hidden\">\r\n                        <img id=\"image-viewer\" class=\"max-w-full max-h-full object-contain\" alt=\"${t('photos.detail.imageAlt', 'Ausgew\u00E4hltes Foto')}\" />\r\n                        <div id=\"photo-detail-loader\" class=\"absolute inset-0 flex items-center justify-center bg-gray-900/40 text-white text-sm font-medium hidden\">${t('photos.detail.loader', 'Foto wird geladen\u2026')}</div>\r\n                    </div>\r\n                    <button id=\"photo-detail-next\" type=\"button\" class=\"hidden sm:flex items-center justify-center w-14 bg-transparent text-3xl text-gray-400 dark:text-gray-500 hover:text-gray-700 dark:hover:text-gray-200 transition\" title=\"${t('photos.detail.next', 'N\u00E4chstes Foto')}\">\u203A</button>\r\n                </div>\r\n                <div class=\"px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-gray-600 dark:text-gray-300\">\r\n                    <div class=\"flex-1 min-w-[200px]\">\r\n                        <p id=\"image-info\" class=\"font-medium text-gray-700 dark:text-gray-200\"></p>\r\n                        <p id=\"photo-detail-dimensions\" class=\"text-xs text-gray-500 dark:text-gray-400 mt-1\"></p>\r\n                    </div>\r\n                    <div class=\"flex items-center gap-3\">\r\n                        <span id=\"photo-detail-counter\" class=\"text-xs font-medium\"></span>\r\n                        <a id=\"photo-detail-open\" href=\"#\" target=\"_blank\" rel=\"noreferrer\" class=\"text-blue-600 dark:text-blue-400 hover:underline\">${t('photos.detail.openInBrowser', 'Im Browser \u00F6ffnen')}</a>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        // Combine layout\r\n        const container = document.createElement('div');\r\n        container.className = 'flex h-full';\r\n        container.appendChild(sidebar);\r\n        container.appendChild(mainArea);\r\n\r\n        content.appendChild(container);\r\n        content.appendChild(detailOverlay);\r\n\r\n        return frame;\r\n    }\r\n\r\n    function init(): void {\r\n        if (state.initialized) {\r\n            return;\r\n        }\r\n        state.initialized = true;\r\n\r\n        // Check if we're in WindowChrome mode\r\n        const photosWindow = document.getElementById('photos-window');\r\n        if (!photosWindow) {\r\n            // Create and inject WindowChrome UI\r\n            const frame = renderWindow();\r\n            if (!frame) {\r\n                console.error('Failed to render photos window');\r\n                return;\r\n            }\r\n\r\n            // Find or create container\r\n            let container = document.getElementById('photos-window');\r\n            if (!container) {\r\n                container = document.createElement('div');\r\n                container.id = 'photos-window';\r\n                container.className = 'fixed inset-0 flex items-center justify-center hidden modal relative';\r\n                container.style.zIndex = '1000';\r\n                document.body.appendChild(container);\r\n            }\r\n\r\n            // Inject frame\r\n            const wrapper = document.createElement('div');\r\n            wrapper.className = 'w-[min(90vw,1100px)] h-[min(85vh,780px)]';\r\n            wrapper.appendChild(frame);\r\n            container.appendChild(wrapper);\r\n\r\n            elements.container = container;\r\n        } else {\r\n            elements.container = photosWindow;\r\n        }\r\n\r\n        cacheElements();\r\n        if (!elements.gallery) {\r\n            return;\r\n        }\r\n        wireSidebar();\r\n        wireSegments();\r\n        wireSearch();\r\n        wireGallery();\r\n        wireDetail();\r\n        globalWindow.appI18n?.applyTranslations?.(elements.container ?? undefined);\r\n        void fetchPhotos();\r\n    }\r\n\r\n    function cacheElements(): void {\r\n        if (!elements.container) {\r\n            return;\r\n        }\r\n        elements.sidebar = elements.container.querySelector('#photos-sidebar') ?? null;\r\n        elements.gallery = elements.container.querySelector('#photos-gallery') ?? null;\r\n        elements.loading = elements.container.querySelector('#photos-loading') ?? null;\r\n        elements.error = elements.container.querySelector('#photos-error') ?? null;\r\n        elements.errorRetry = elements.container.querySelector('#photos-error-retry') as HTMLButtonElement | null;\r\n        elements.empty = elements.container.querySelector('#photos-empty') ?? null;\r\n        elements.placeholder = elements.container.querySelector('#image-placeholder') ?? null;\r\n        elements.photoCount = elements.statusbar?.querySelector('.statusbar-left') ?? null;\r\n        elements.refreshButton = elements.container.querySelector('#photos-refresh') as HTMLButtonElement | null;\r\n        elements.searchInput = elements.container.querySelector('#photos-search') as HTMLInputElement | null;\r\n        elements.searchClear = elements.container.querySelector('#photos-search-clear') as HTMLButtonElement | null;\r\n        elements.overlay = elements.container.querySelector('#photo-detail-overlay') ?? null;\r\n        elements.detailTitle = elements.container.querySelector('#photo-detail-title') ?? null;\r\n        elements.detailMeta = elements.container.querySelector('#photo-detail-meta') ?? null;\r\n        elements.detailDimensions = elements.container.querySelector('#photo-detail-dimensions') ?? null;\r\n        elements.detailCounter = elements.container.querySelector('#photo-detail-counter') ?? null;\r\n        elements.detailOpen = elements.container.querySelector('#photo-detail-open') as HTMLAnchorElement | null;\r\n        elements.detailDownload = elements.container.querySelector('#photo-detail-download') as HTMLAnchorElement | null;\r\n        elements.detailFavorite = elements.container.querySelector('#photo-detail-favorite') as HTMLButtonElement | null;\r\n        elements.detailFavoriteLabel = elements.detailFavorite?.querySelector('span:last-child') ?? null;\r\n        elements.detailFavoriteIcon = elements.detailFavorite?.querySelector('span[aria-hidden=\"true\"]') ?? null;\r\n        elements.detailClose = elements.container.querySelector('#photo-detail-close') as HTMLButtonElement | null;\r\n        elements.detailPrev = elements.container.querySelector('#photo-detail-prev') as HTMLButtonElement | null;\r\n        elements.detailNext = elements.container.querySelector('#photo-detail-next') as HTMLButtonElement | null;\r\n        elements.image = elements.container.querySelector('#image-viewer') as HTMLImageElement | null;\r\n        elements.imageInfo = elements.container.querySelector('#image-info') ?? null;\r\n        elements.loader = elements.container.querySelector('#photo-detail-loader') ?? null;\r\n        elements.countAll = elements.container.querySelector('#photos-count-all') ?? null;\r\n        elements.countFavorites = elements.container.querySelector('#photos-count-favorites') ?? null;\r\n        elements.countLandscape = elements.container.querySelector('#photos-count-landscape') ?? null;\r\n        elements.countPortrait = elements.container.querySelector('#photos-count-portrait') ?? null;\r\n        elements.countSquare = elements.container.querySelector('#photos-count-square') ?? null;\r\n\r\n        const sidebarButtons = elements.sidebar?.querySelectorAll<HTMLButtonElement>('button[data-photos-filter]') ?? [];\r\n        elements.sidebarButtons = Array.from(sidebarButtons);\r\n        const segmentButtons = elements.container.querySelectorAll<HTMLButtonElement>('button[data-photos-segment]');\r\n        elements.segmentButtons = Array.from(segmentButtons);\r\n    }\r\n\r\n     function wireSidebar(): void {\r\n         elements.sidebarButtons.forEach(button => {\r\n             button.addEventListener('click', () => {\r\n                 const filter = button.getAttribute('data-photos-filter') as SidebarFilter | null;\r\n                 if (!filter || state.activeFilter === filter) {\r\n                     return;\r\n                 }\r\n                 state.activeFilter = filter;\r\n                 syncSidebarSelection();\r\n                 applyFilters();\r\n             });\r\n         });\r\n         syncSidebarSelection();\r\n         elements.refreshButton?.addEventListener('click', () => {\r\n             void fetchPhotos({ refresh: true });\r\n         });\r\n     }\r\n\r\n     function wireSegments(): void {\r\n         elements.segmentButtons.forEach(button => {\r\n             button.addEventListener('click', () => {\r\n                 const segment = button.getAttribute('data-photos-segment') as SegmentView | null;\r\n                 if (!segment || state.activeSegment === segment) {\r\n                     return;\r\n                 }\r\n                 state.activeSegment = segment;\r\n                 syncSegmentSelection();\r\n                 renderGallery();\r\n             });\r\n         });\r\n         syncSegmentSelection();\r\n     }\r\n\r\n     function wireSearch(): void {\r\n         elements.searchInput?.addEventListener('input', event => {\r\n             const target = event.currentTarget as HTMLInputElement;\r\n             state.searchTerm = target.value;\r\n             toggleSearchClear();\r\n             applyFilters();\r\n         });\r\n         elements.searchClear?.addEventListener('click', () => {\r\n             if (!elements.searchInput) {\r\n                 return;\r\n             }\r\n             elements.searchInput.value = '';\r\n             state.searchTerm = '';\r\n             toggleSearchClear();\r\n             applyFilters();\r\n         });\r\n         toggleSearchClear();\r\n     }\r\n\r\n     function wireGallery(): void {\r\n         elements.gallery?.addEventListener('click', event => {\r\n             const target = event.target as HTMLElement | null;\r\n             if (!target) {\r\n                 return;\r\n             }\r\n             const card = target.closest<HTMLElement>('[data-photo-index]');\r\n             if (!card) {\r\n                 return;\r\n             }\r\n             const rawIndex = card.getAttribute('data-photo-index');\r\n             const index = rawIndex ? Number(rawIndex) : NaN;\r\n             if (Number.isNaN(index) || index < 0) {\r\n                 return;\r\n             }\r\n             openDetail(index);\r\n         });\r\n     }\r\n\r\n     function wireDetail(): void {\r\n         elements.detailClose?.addEventListener('click', closeDetail);\r\n         elements.overlay?.addEventListener('click', event => {\r\n             if (event.target === elements.overlay) {\r\n                 closeDetail();\r\n             }\r\n         });\r\n         elements.detailPrev?.addEventListener('click', () => moveSelection(-1));\r\n         elements.detailNext?.addEventListener('click', () => moveSelection(1));\r\n         elements.detailFavorite?.addEventListener('click', toggleFavorite);\r\n         document.addEventListener('keydown', handleKeyNavigation);\r\n         elements.errorRetry?.addEventListener('click', () => {\r\n             void fetchPhotos({ refresh: true });\r\n         });\r\n         if (elements.image) {\r\n             elements.image.addEventListener('load', handleImageLoaded);\r\n             elements.image.addEventListener('error', handleImageError);\r\n         }\r\n     }\r\n\r\n     function handleImageLoaded(): void {\r\n         setDetailLoading(false);\r\n         if (!elements.image) {\r\n             return;\r\n         }\r\n         if (state.pendingImageId) {\r\n             const width = elements.image.naturalWidth;\r\n             const height = elements.image.naturalHeight;\r\n             const orientation = width === height ? 'square' : width > height ? 'landscape' : 'portrait';\r\n             if (state.externalPhoto && state.externalPhoto.id === state.pendingImageId) {\r\n                 state.externalPhoto.width = width;\r\n                 state.externalPhoto.height = height;\r\n                 state.externalPhoto.orientation = orientation;\r\n             }\r\n            if (state.overlayVisible) {\r\n                const current = getCurrentDetailPhoto();\r\n                if (current) {\r\n                    updateDetailMetadata(current);\r\n                }\r\n            }\r\n         }\r\n         state.pendingImageId = null;\r\n     }\r\n\r\n    function handleImageError(): void {\r\n        setDetailLoading(false);\r\n        if (elements.detailMeta) {\r\n            elements.detailMeta.textContent = t(\r\n                'photos.errors.detailImage',\r\n                'The photo could not be loaded.'\r\n            );\r\n        }\r\n    }\r\n\r\n     async function fetchPhotos(options: { refresh?: boolean } = {}): Promise<void> {\r\n         if (state.isLoading) {\r\n             return;\r\n         }\r\n         setError(false);\r\n         setLoading(true);\r\n         try {\r\n            const shouldRandomize = options.refresh || state.photos.length === 0;\r\n            const page = shouldRandomize ? getRandomPage() : state.currentPage;\r\n             const limit = 60;\r\n             const response = await fetch(`https://picsum.photos/v2/list?page=${page}&limit=${limit}`);\r\n             if (!response.ok) {\r\n                 throw new Error('Picsum request failed');\r\n             }\r\n             const data = (await response.json()) as PicsumApiPhoto[];\r\n             const mapped = data.map(mapPhotoItem);\r\n             state.photos = mapped;\r\n             state.currentPage = page;\r\n             state.favorites.clear();\r\n             state.externalPhoto = null;\r\n             state.orientationCounts = calculateOrientationCounts(mapped);\r\n             applyFilters();\r\n             updateSidebarCounts();\r\n         } catch (error) {\r\n            console.warn('Photos app: failed to load', error);\r\n             setError(true);\r\n         } finally {\r\n             setLoading(false);\r\n         }\r\n     }\r\n\r\n     function mapPhotoItem(item: PicsumApiPhoto, index: number): PhotoLibraryItem {\r\n         const width = Number(item.width) || 0;\r\n         const height = Number(item.height) || 0;\r\n         const orientation: Orientation = width === height ? 'square' : width > height ? 'landscape' : 'portrait';\r\n         const numericId = Number.parseInt(item.id, 10);\r\n         const yearBase = Number.isFinite(numericId) ? numericId : index;\r\n         const year = 2014 + ((yearBase % 10) + 1);\r\n        const sanitizedAuthor =\r\n            item.author && item.author.trim().length > 0\r\n                ? item.author.trim()\r\n                : t('photos.detail.unknownPhotographer', 'Unknown photographer');\r\n         const id = String(item.id);\r\n         return {\r\n             id,\r\n             author: sanitizedAuthor,\r\n             width,\r\n             height,\r\n             orientation,\r\n             year,\r\n             url: item.url,\r\n             downloadUrl: item.download_url,\r\n             thumbUrl: `https://picsum.photos/id/${id}/600/400`,\r\n             largeUrl: `https://picsum.photos/id/${id}/1600/1200`,\r\n         };\r\n     }\r\n\r\n     function calculateOrientationCounts(photos: PhotoLibraryItem[]): Record<Orientation, number> {\r\n         return photos.reduce(\r\n             (acc, photo) => {\r\n                 acc[photo.orientation] += 1;\r\n                 return acc;\r\n             },\r\n             { landscape: 0, portrait: 0, square: 0 } as Record<Orientation, number>,\r\n         );\r\n     }\r\n\r\n     function applyFilters(): void {\r\n         const search = state.searchTerm.trim().toLowerCase();\r\n         const previousActiveId = state.overlayVisible ? state.activePhotoId : null;\r\n         const filtered = state.photos.filter(photo => {\r\n             if (state.activeFilter === 'favorites' && !state.favorites.has(photo.id)) {\r\n                 return false;\r\n             }\r\n             if (state.activeFilter === 'landscape' && photo.orientation !== 'landscape') {\r\n                 return false;\r\n             }\r\n             if (state.activeFilter === 'portrait' && photo.orientation !== 'portrait') {\r\n                 return false;\r\n             }\r\n             if (state.activeFilter === 'square' && photo.orientation !== 'square') {\r\n                 return false;\r\n             }\r\n             if (search && !photo.author.toLowerCase().includes(search)) {\r\n                 return false;\r\n             }\r\n             return true;\r\n         });\r\n         state.filteredPhotos = filtered;\r\n         state.filteredIndexMap = new Map(filtered.map((photo, index) => [photo.id, index]));\r\n         renderGallery();\r\n         updateEmptyState();\r\n         updatePhotoCount();\r\n         updateSidebarCounts();\r\n         if (previousActiveId) {\r\n             const newIndex = state.filteredIndexMap.get(previousActiveId);\r\n             if (typeof newIndex === 'number') {\r\n                 state.selectedIndex = newIndex;\r\n                 updateNavigationButtons();\r\n                 updateCounter();\r\n                 setActiveCard(previousActiveId);\r\n             } else if (!state.externalPhoto) {\r\n                 closeDetail();\r\n             }\r\n         }\r\n     }\r\n\r\n     function renderGallery(): void {\r\n         if (!elements.gallery) {\r\n             return;\r\n         }\r\n         elements.gallery.innerHTML = '';\r\n         if (!state.filteredPhotos.length) {\r\n             return;\r\n         }\r\n         const groups = buildGroups(state.filteredPhotos, state.activeSegment);\r\n         groups.forEach(group => {\r\n             const section = document.createElement('section');\r\n             section.className = 'space-y-3';\r\n\r\n             const heading = document.createElement('div');\r\n             heading.className = 'flex items-baseline justify-between px-2';\r\n            const title = document.createElement('h3');\r\n            title.className = 'text-base font-semibold text-gray-800 dark:text-gray-100 tracking-wide';\r\n            title.textContent = group.title;\r\n            const count = document.createElement('span');\r\n            count.className = 'text-xs text-gray-500 dark:text-gray-400';\r\n            const countKey =\r\n                group.photos.length === 1 ? 'photos.labels.photoSingular' : 'photos.labels.photoPlural';\r\n            const countLabel = t(countKey, group.photos.length === 1 ? 'Photo' : 'Photos');\r\n            count.textContent = `${group.photos.length} ${countLabel}`;\r\n            heading.append(title, count);\r\n            section.append(heading);\r\n\r\n            const grid = document.createElement('div');\r\n            grid.className = 'grid gap-4 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 auto-rows-[minmax(140px,_auto)]';\r\n\r\n             group.photos.forEach(photo => {\r\n                 const index = state.filteredIndexMap.get(photo.id) ?? -1;\r\n                 const card = document.createElement('button');\r\n                 card.type = 'button';\r\n                 card.className = 'photos-card relative group overflow-hidden rounded-2xl bg-gray-200 dark:bg-gray-800 shadow-md hover:-translate-y-0.5 hover:shadow-xl focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-400';\r\n                 card.dataset.photoId = photo.id;\r\n                 card.dataset.photoIndex = String(index);\r\n                 if (state.favorites.has(photo.id)) {\r\n                     card.dataset.favorite = 'true';\r\n                 }\r\n                if (state.activePhotoId === photo.id && state.overlayVisible) {\r\n                    card.dataset.selected = 'true';\r\n                }\r\n\r\n                const image = document.createElement('img');\r\n                image.src = photo.thumbUrl;\r\n                image.alt = t('photos.gallery.alt', 'Photo by {author}', { author: photo.author });\r\n                image.loading = 'lazy';\r\n                image.className = 'w-full h-full object-cover transition duration-300 group-hover:scale-105';\r\n\r\n                 const overlay = document.createElement('div');\r\n                 overlay.className = 'absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent px-3 py-2 text-left';\r\n                 const author = document.createElement('p');\r\n                 author.className = 'text-white text-sm font-medium truncate';\r\n                 author.textContent = photo.author;\r\n                 const meta = document.createElement('p');\r\n                 meta.className = 'text-white/80 text-[11px] uppercase tracking-[0.3em]';\r\n                 meta.textContent = `${photo.year} \u0393\u00C7\u00F3 ${formatOrientation(photo.orientation)}`;\r\n                 overlay.append(author, meta);\r\n\r\n                 card.append(image, overlay);\r\n                 grid.append(card);\r\n             });\r\n\r\n             section.append(grid);\r\n             elements.gallery?.append(section);\r\n         });\r\n     }\r\n\r\n     function buildGroups(photos: PhotoLibraryItem[], segment: SegmentView): PhotoGroup[] {\r\n        if (segment === 'collections') {\r\n            const orientations: Array<{ title: string; key: Orientation }> = [\r\n                { title: t('photos.collections.landscape', 'Landscapes'), key: 'landscape' },\r\n                { title: t('photos.collections.portrait', 'Portraits'), key: 'portrait' },\r\n                { title: t('photos.collections.square', 'Squares'), key: 'square' },\r\n            ];\r\n            return orientations\r\n                .map(item => ({ title: item.title, photos: photos.filter(photo => photo.orientation === item.key) }))\r\n                .filter(group => group.photos.length > 0);\r\n        }\r\n         if (segment === 'years') {\r\n             const byYear = new Map<number, PhotoLibraryItem[]>();\r\n             photos.forEach(photo => {\r\n                 const collection = byYear.get(photo.year) ?? [];\r\n                 collection.push(photo);\r\n                 byYear.set(photo.year, collection);\r\n             });\r\n             return Array.from(byYear.entries())\r\n                 .sort((a, b) => b[0] - a[0])\r\n                 .map(([year, group]) => ({ title: String(year), photos: group }));\r\n         }\r\n         // moments -> group by author\r\n         const byAuthor = new Map<string, PhotoLibraryItem[]>();\r\n         photos.forEach(photo => {\r\n             const key = photo.author;\r\n             const collection = byAuthor.get(key) ?? [];\r\n             collection.push(photo);\r\n             byAuthor.set(key, collection);\r\n         });\r\n         return Array.from(byAuthor.entries())\r\n             .sort((a, b) => {\r\n                 const latestA = Math.max(...a[1].map(item => item.year));\r\n                 const latestB = Math.max(...b[1].map(item => item.year));\r\n                 return latestB - latestA;\r\n             })\r\n             .map(([author, group]) => ({ title: author, photos: group }));\r\n     }\r\n\r\n    function formatOrientation(orientation: Orientation | undefined): string {\r\n        if (orientation === 'portrait') {\r\n            return t('photos.orientations.portrait', 'Portrait');\r\n        }\r\n        if (orientation === 'square') {\r\n            return t('photos.orientations.square', 'Square');\r\n        }\r\n        return t('photos.orientations.landscape', 'Landscape');\r\n    }\r\n\r\n     function setActiveCard(photoId: string): void {\r\n         if (!elements.gallery) {\r\n             return;\r\n         }\r\n         const current = elements.gallery.querySelector<HTMLElement>('.photos-card[data-selected=\"true\"]');\r\n         if (current) {\r\n             current.removeAttribute('data-selected');\r\n         }\r\n         const next = elements.gallery.querySelector<HTMLElement>(`.photos-card[data-photo-id=\"${photoId}\"]`);\r\n         if (next) {\r\n             next.dataset.selected = 'true';\r\n         }\r\n     }\r\n\r\n     function clearActiveCard(): void {\r\n         if (!elements.gallery) {\r\n             return;\r\n         }\r\n         const current = elements.gallery.querySelector<HTMLElement>('.photos-card[data-selected=\"true\"]');\r\n         current?.removeAttribute('data-selected');\r\n     }\r\n\r\n     function updateEmptyState(): void {\r\n         const shouldShow = state.filteredPhotos.length === 0;\r\n         elements.empty?.classList.toggle('hidden', !shouldShow);\r\n     }\r\n\r\n     function updatePhotoCount(): void {\r\n        const total = state.filteredPhotos.length;\r\n        const labelKey = total === 1 ? 'photos.labels.photoSingular' : 'photos.labels.photoPlural';\r\n        const label = t(labelKey, total === 1 ? 'Photo' : 'Photos');\r\n        const segmentKey =\r\n            state.activeSegment === 'collections'\r\n                ? 'photos.segments.collections'\r\n                : state.activeSegment === 'years'\r\n                ? 'photos.segments.years'\r\n                : 'photos.segments.moments';\r\n        const segmentFallback =\r\n            state.activeSegment === 'collections'\r\n                ? 'Collections'\r\n                : state.activeSegment === 'years'\r\n                ? 'Years'\r\n                : 'Moments';\r\n        const segmentLabel = t(segmentKey, segmentFallback);\r\n        const statusText = t(\r\n            'photos.status.count',\r\n            `${total} ${label} \u0393\u00C7\u00F3 ${segmentLabel}`,\r\n            { count: total, label, segment: segmentLabel },\r\n        );\r\n\r\n        // Update statusbar if available\r\n        if (elements.statusbar && globalWindow.WindowChrome) {\r\n            globalWindow.WindowChrome.updateStatusBar(elements.statusbar, 'left', statusText);\r\n        }\r\n\r\n        // Fallback for old photo-count element\r\n        if (elements.photoCount) {\r\n            elements.photoCount.textContent = statusText;\r\n        }\r\n     }\r\n\r\n     function updateSidebarCounts(): void {\r\n         if (elements.countAll) {\r\n             elements.countAll.textContent = String(state.photos.length);\r\n         }\r\n         if (elements.countFavorites) {\r\n             elements.countFavorites.textContent = String(state.favorites.size);\r\n         }\r\n         if (elements.countLandscape) {\r\n             elements.countLandscape.textContent = String(state.orientationCounts.landscape);\r\n         }\r\n         if (elements.countPortrait) {\r\n             elements.countPortrait.textContent = String(state.orientationCounts.portrait);\r\n         }\r\n         if (elements.countSquare) {\r\n             elements.countSquare.textContent = String(state.orientationCounts.square);\r\n         }\r\n     }\r\n\r\n     function syncSidebarSelection(): void {\r\n         elements.sidebarButtons.forEach(button => {\r\n             const filter = button.getAttribute('data-photos-filter') as SidebarFilter | null;\r\n             button.dataset.active = filter === state.activeFilter ? 'true' : 'false';\r\n         });\r\n     }\r\n\r\n     function syncSegmentSelection(): void {\r\n         elements.segmentButtons.forEach(button => {\r\n             const segment = button.getAttribute('data-photos-segment') as SegmentView | null;\r\n             button.dataset.active = segment === state.activeSegment ? 'true' : 'false';\r\n         });\r\n     }\r\n\r\n     function toggleSearchClear(): void {\r\n         if (!elements.searchClear) {\r\n             return;\r\n         }\r\n         const hasValue = Boolean(state.searchTerm.trim());\r\n         elements.searchClear.classList.toggle('invisible', !hasValue);\r\n         elements.searchClear.classList.toggle('pointer-events-none', !hasValue);\r\n     }\r\n\r\n     function setLoading(isLoading: boolean): void {\r\n         state.isLoading = isLoading;\r\n         elements.loading?.classList.toggle('hidden', !isLoading);\r\n     }\r\n\r\n     function setError(hasError: boolean): void {\r\n         elements.error?.classList.toggle('hidden', !hasError);\r\n     }\r\n\r\n     function openDetail(index: number, options: { external?: boolean; photo?: ExternalPhotoItem } = {}): void {\r\n         const overlay = elements.overlay;\r\n         if (!overlay || !elements.image) {\r\n             return;\r\n         }\r\n         let photo: AnyPhotoItem | null = null;\r\n         if (options.external && options.photo) {\r\n             photo = options.photo;\r\n             state.externalPhoto = options.photo;\r\n             state.selectedIndex = -1;\r\n             state.activePhotoId = options.photo.id;\r\n         } else {\r\n             const selected = state.filteredPhotos[index];\r\n             if (!selected) {\r\n                 return;\r\n             }\r\n             photo = selected;\r\n             state.selectedIndex = index;\r\n             state.activePhotoId = selected.id;\r\n             state.externalPhoto = null;\r\n         }\r\n         state.overlayVisible = true;\r\n         overlay.classList.remove('hidden');\r\n         overlay.classList.add('flex');\r\n         if (!photo) {\r\n             return;\r\n         }\r\n         setDetailLoading(true);\r\n         state.pendingImageId = photo.id;\r\n         if ('largeUrl' in photo && photo.largeUrl) {\r\n             elements.image.src = photo.largeUrl;\r\n         } else {\r\n             elements.image.src = photo.downloadUrl;\r\n         }\r\n         updateDetailMetadata(photo);\r\n         updateNavigationButtons();\r\n         updateCounter();\r\n         if (!options.external) {\r\n             setActiveCard(photo.id);\r\n         } else {\r\n             clearActiveCard();\r\n         }\r\n     }\r\n\r\n     function getCurrentDetailPhoto(): AnyPhotoItem | null {\r\n         if (state.externalPhoto) {\r\n             return state.externalPhoto;\r\n         }\r\n         if (state.selectedIndex >= 0) {\r\n             return state.filteredPhotos[state.selectedIndex] ?? null;\r\n         }\r\n         return null;\r\n     }\r\n\r\n     function updateDetailMetadata(photo: AnyPhotoItem): void {\r\n        if (elements.detailTitle) {\r\n            const fallbackTitle = t('photos.detail.unknownPhoto', 'Unknown photo');\r\n            elements.detailTitle.textContent = photo.author || fallbackTitle;\r\n        }\r\n        if (elements.imageInfo) {\r\n            const label = isExternalPhoto(photo) && photo.sourceName ? photo.sourceName : photo.author;\r\n            elements.imageInfo.textContent = label;\r\n        }\r\n        const orientationLabel = formatOrientation(photo.orientation);\r\n        const metaParts: string[] = [];\r\n        if (isExternalPhoto(photo)) {\r\n            metaParts.push(t('photos.detail.externalLabel', 'External photo'));\r\n            if (photo.sourceName) {\r\n                metaParts.push(photo.sourceName);\r\n            }\r\n        } else {\r\n            metaParts.push(String(photo.year));\r\n            metaParts.push(orientationLabel);\r\n        }\r\n        if (elements.detailMeta) {\r\n            elements.detailMeta.textContent = metaParts.join(' \u0393\u00C7\u00F3 ');\r\n        }\r\n        if (elements.detailDimensions) {\r\n            if (photo.width && photo.height) {\r\n                elements.detailDimensions.textContent = t(\r\n                    'photos.detail.dimensions',\r\n                    `Resolution: ${photo.width} \u251C\u00F9 ${photo.height}px`,\r\n                    { width: photo.width, height: photo.height },\r\n                );\r\n            } else {\r\n                elements.detailDimensions.textContent = '';\r\n            }\r\n        }\r\n        if (elements.detailOpen) {\r\n            elements.detailOpen.href = photo.url ?? photo.downloadUrl;\r\n        }\r\n        if (elements.detailDownload) {\r\n            elements.detailDownload.href = photo.downloadUrl;\r\n            elements.detailDownload.download = t(\r\n                'photos.detail.downloadFilename',\r\n                `photo-${photo.id}.jpg`,\r\n                { id: photo.id },\r\n            );\r\n        }\r\n        updateFavoriteButton(photo);\r\n    }\r\n\r\n    function updateFavoriteButton(photo: AnyPhotoItem): void {\r\n        if (!elements.detailFavorite || !elements.detailFavoriteLabel || !elements.detailFavoriteIcon) {\r\n            return;\r\n        }\r\n        if (isExternalPhoto(photo)) {\r\n            elements.detailFavorite.setAttribute('disabled', 'true');\r\n            elements.detailFavorite.classList.add('opacity-40', 'pointer-events-none');\r\n            elements.detailFavoriteLabel.textContent = t(\r\n                'photos.detail.favoriteUnavailable',\r\n                'Unavailable',\r\n            );\r\n            elements.detailFavoriteIcon.textContent = '\u0393\u00C7\u00F4';\r\n            return;\r\n        }\r\n        const isFavorite = state.favorites.has(photo.id);\r\n        elements.detailFavorite.removeAttribute('disabled');\r\n        elements.detailFavorite.classList.remove('opacity-40', 'pointer-events-none');\r\n        const removeLabel = t('photos.detail.favoriteRemove', 'Remove favorite');\r\n        const addLabel = t('photos.detail.favoriteAdd', 'Add to favorites');\r\n        elements.detailFavoriteLabel.textContent = isFavorite ? removeLabel : addLabel;\r\n        elements.detailFavoriteIcon.textContent = isFavorite ? '\u0393\u00D6\u00D1' : '\u0393\u00D6\u00ED';\r\n    }\r\n\r\n     function closeDetail(): void {\r\n         if (!elements.overlay) {\r\n             return;\r\n         }\r\n         elements.overlay.classList.add('hidden');\r\n         elements.overlay.classList.remove('flex');\r\n         state.overlayVisible = false;\r\n         state.selectedIndex = -1;\r\n         state.activePhotoId = null;\r\n         state.externalPhoto = null;\r\n         state.pendingImageId = null;\r\n         clearActiveCard();\r\n         setDetailLoading(false);\r\n     }\r\n\r\n     function moveSelection(delta: number): void {\r\n         if (state.externalPhoto) {\r\n             return;\r\n         }\r\n         const nextIndex = state.selectedIndex + delta;\r\n         if (nextIndex < 0 || nextIndex >= state.filteredPhotos.length) {\r\n             return;\r\n         }\r\n         openDetail(nextIndex);\r\n     }\r\n\r\n     function toggleFavorite(): void {\r\n         if (state.externalPhoto) {\r\n             return;\r\n         }\r\n         const photo = state.filteredPhotos[state.selectedIndex];\r\n         if (!photo) {\r\n             return;\r\n         }\r\n         if (state.favorites.has(photo.id)) {\r\n             state.favorites.delete(photo.id);\r\n         } else {\r\n             state.favorites.add(photo.id);\r\n         }\r\n         updateFavoriteButton(photo);\r\n         updateSidebarCounts();\r\n         updateCardFavoriteState(photo.id);\r\n     }\r\n\r\n     function updateCardFavoriteState(photoId: string): void {\r\n         if (!elements.gallery) {\r\n             return;\r\n         }\r\n         const card = elements.gallery.querySelector<HTMLElement>(`.photos-card[data-photo-id=\"${photoId}\"]`);\r\n         if (!card) {\r\n             return;\r\n         }\r\n         if (state.favorites.has(photoId)) {\r\n             card.dataset.favorite = 'true';\r\n         } else {\r\n             card.removeAttribute('data-favorite');\r\n         }\r\n     }\r\n\r\n     function updateNavigationButtons(): void {\r\n         const hasPrev = state.selectedIndex > 0 && !state.externalPhoto;\r\n         const hasNext =\r\n             state.selectedIndex >= 0 &&\r\n             state.selectedIndex < state.filteredPhotos.length - 1 &&\r\n             !state.externalPhoto;\r\n         if (elements.detailPrev) {\r\n             elements.detailPrev.classList.toggle('opacity-30', !hasPrev);\r\n             elements.detailPrev.classList.toggle('pointer-events-none', !hasPrev);\r\n         }\r\n         if (elements.detailNext) {\r\n             elements.detailNext.classList.toggle('opacity-30', !hasNext);\r\n             elements.detailNext.classList.toggle('pointer-events-none', !hasNext);\r\n         }\r\n     }\r\n\r\n     function updateCounter(): void {\r\n        if (!elements.detailCounter) {\r\n            return;\r\n        }\r\n        if (state.externalPhoto) {\r\n            elements.detailCounter.textContent = t('photos.detail.externalCounter', 'External image');\r\n            return;\r\n        }\r\n        if (state.selectedIndex >= 0) {\r\n            elements.detailCounter.textContent = t(\r\n                'photos.detail.counter',\r\n                `${state.selectedIndex + 1} of ${state.filteredPhotos.length}`,\r\n                { index: state.selectedIndex + 1, total: state.filteredPhotos.length },\r\n            );\r\n        } else {\r\n            elements.detailCounter.textContent = '';\r\n        }\r\n    }\r\n\r\n     function setDetailLoading(isLoading: boolean): void {\r\n         elements.loader?.classList.toggle('hidden', !isLoading);\r\n     }\r\n\r\n    function handleKeyNavigation(event: KeyboardEvent): void {\r\n        if (!state.overlayVisible) {\r\n            return;\r\n        }\r\n        if (event.key === 'Escape') {\r\n            closeDetail();\r\n        } else if (event.key === 'ArrowLeft') {\r\n            moveSelection(-1);\r\n        } else if (event.key === 'ArrowRight') {\r\n            moveSelection(1);\r\n        }\r\n    }\r\n\r\n     function getRandomPage(): number {\r\n         return Math.floor(Math.random() * 10) + 1;\r\n     }\r\n\r\n    function showExternalImage(payload: { src: string; name?: string }): void {\r\n        if (!payload || !payload.src) {\r\n            return;\r\n        }\r\n        if (!state.initialized) {\r\n            init();\r\n        }\r\n        const name =\r\n            payload.name && payload.name.trim().length > 0\r\n                ? payload.name.trim()\r\n                : t('photos.detail.externalFile', 'External file');\r\n        const externalPhoto: ExternalPhotoItem = {\r\n            id: `external-${Date.now()}`,\r\n            author: name,\r\n            downloadUrl: payload.src,\r\n            largeUrl: payload.src,\r\n            url: payload.src,\r\n            sourceName: name,\r\n            isExternal: true,\r\n        };\r\n        openDetail(-1, { external: true, photo: externalPhoto });\r\n    }\r\n\r\n    function handleLanguageChange(): void {\r\n        if (!state.initialized) {\r\n            return;\r\n        }\r\n        renderGallery();\r\n        updateEmptyState();\r\n        updatePhotoCount();\r\n        if (state.overlayVisible) {\r\n            const current = getCurrentDetailPhoto();\r\n            if (current) {\r\n                updateDetailMetadata(current);\r\n            }\r\n            updateNavigationButtons();\r\n            updateCounter();\r\n        } else {\r\n            updateCounter();\r\n        }\r\n        globalWindow.appI18n?.applyTranslations?.(elements.container ?? undefined);\r\n    }\r\n\r\n    const api: PhotosAppApi = {\r\n        init,\r\n        showExternalImage,\r\n    };\r\n\r\n    globalWindow.PhotosApp = api;\r\n\r\n    window.addEventListener('languagePreferenceChange', handleLanguageChange);\r\n\r\n    // Don't auto-init - let WindowManager handle it\r\n    // if (document.readyState === 'loading') {\r\n    //     document.addEventListener('DOMContentLoaded', init, { once: true });\r\n    // } else {\r\n    //     init();\r\n    // }\r\n })();\r\n\r\n", "/*\r\n * src/ts/window-configs.ts\r\n * Single source of truth for all window/modal definitions.\r\n * Replaces legacy src/ts/legacy/window-configs.js\r\n */\r\n\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\ntype WindowType = 'persistent' | 'transient';\r\n\r\nexport interface WindowConfiguration {\r\n    id: string;\r\n    type: WindowType;\r\n    programKey: string; // i18n key root for program label\r\n    icon: string;\r\n    closeButtonId: string;\r\n    // Use a broad shape to align with WindowManager expectations\r\n    metadata?: Record<string, unknown>;\r\n}\r\n\r\ndeclare global {\r\n    interface Window {\r\n        windowConfigurations?: WindowConfiguration[];\r\n    }\r\n}\r\n\r\n// Build the configurations list. Keep order stable; WindowManager load order matters.\r\nexport const windowConfigurations: WindowConfiguration[] = [\r\n    {\r\n        id: 'launchpad-modal',\r\n        type: 'persistent',\r\n        programKey: 'programs.launchpad',\r\n        icon: './img/launchpad.png',\r\n        closeButtonId: 'close-launchpad-modal',\r\n        metadata: {\r\n            // Launchpad darf seinen initHandler auch w\u00E4hrend der Session-Restore-Phase ausf\u00FChren,\r\n            // damit das Grid direkt verf\u00FCgbar ist (Tests klicken oft sehr fr\u00FCh).\r\n            runInitDuringRestore: true,\r\n            skipMenubarUpdate: true,\r\n            initHandler: function () {\r\n                // Initialize Launchpad module if not already\r\n                if (window.LaunchpadSystem && !(window as any).LaunchpadSystem?.container) {\r\n                    const container = document.getElementById('launchpad-container');\r\n                    if (container) window.LaunchpadSystem.init(container);\r\n                }\r\n                // Refresh apps when opening\r\n                if (window.LaunchpadSystem?.refresh) window.LaunchpadSystem.refresh();\r\n            },\r\n        },\r\n    },\r\n    {\r\n        id: 'projects-modal',\r\n        type: 'persistent',\r\n        programKey: 'programs.projects',\r\n        icon: './img/sucher.png',\r\n        closeButtonId: 'close-projects-modal',\r\n    },\r\n    {\r\n        id: 'about-modal',\r\n        type: 'persistent',\r\n        programKey: 'programs.about',\r\n        icon: './img/profil.jpg',\r\n        closeButtonId: 'close-about-modal',\r\n    },\r\n    {\r\n        id: 'settings-modal',\r\n        type: 'persistent',\r\n        programKey: 'programs.settings',\r\n        icon: './img/settings.png',\r\n        closeButtonId: 'close-settings-modal',\r\n        metadata: {\r\n            initHandler: function () {\r\n                if (window.SettingsSystem && !(window as any).SettingsSystem?.container) {\r\n                    const container = document.getElementById('settings-container');\r\n                    if (container) window.SettingsSystem.init(container);\r\n                }\r\n            },\r\n        },\r\n    },\r\n    {\r\n        id: 'text-modal',\r\n        type: 'persistent',\r\n        programKey: 'programs.text',\r\n        icon: './img/notepad.png',\r\n        closeButtonId: 'close-text-modal',\r\n        metadata: {\r\n            initHandler: function () {\r\n                // Primary: Create first TextEditor instance when modal opens if none exist\r\n                if (\r\n                    window.TextEditorInstanceManager &&\r\n                    !window.TextEditorInstanceManager.hasInstances()\r\n                ) {\r\n                    window.TextEditorInstanceManager.createInstance({\r\n                        title: 'Editor',\r\n                    });\r\n                }\r\n                // Fallback: Initialize old editor module if instance manager not available\r\n                else if (\r\n                    !window.TextEditorInstanceManager &&\r\n                    window.TextEditorSystem &&\r\n                    !(window as any).TextEditorSystem?.container\r\n                ) {\r\n                    const container = document.getElementById('text-editor-container');\r\n                    if (container) window.TextEditorSystem.init(container);\r\n                }\r\n            },\r\n        },\r\n    },\r\n    {\r\n        id: 'image-modal',\r\n        type: 'persistent',\r\n        programKey: 'programs.photos',\r\n        icon: './img/photos-app-icon.svg',\r\n        closeButtonId: 'close-image-modal',\r\n        metadata: {\r\n            initHandler: function () {\r\n                if (window.PhotosApp?.init) window.PhotosApp.init();\r\n            },\r\n        },\r\n    },\r\n    {\r\n        id: 'program-info-modal',\r\n        type: 'transient',\r\n        programKey: 'programs.default',\r\n        icon: './img/sucher.png',\r\n        closeButtonId: 'close-program-info-modal',\r\n    },\r\n    {\r\n        id: 'terminal-modal',\r\n        type: 'persistent',\r\n        programKey: 'programs.terminal',\r\n        icon: './img/terminal.png',\r\n        closeButtonId: 'close-terminal-modal',\r\n        metadata: {\r\n            initHandler: function () {\r\n                // Primary: Create first Terminal instance when modal opens if none exist\r\n                if (\r\n                    window.TerminalInstanceManager &&\r\n                    !window.TerminalInstanceManager.hasInstances()\r\n                ) {\r\n                    window.TerminalInstanceManager.createInstance({\r\n                        title: 'Terminal',\r\n                    });\r\n                }\r\n                // Fallback: Initialize old terminal module if instance manager not available\r\n                else if (\r\n                    !window.TerminalInstanceManager &&\r\n                    window.TerminalSystem &&\r\n                    !(window as any).TerminalSystem?.container\r\n                ) {\r\n                    const container = document.getElementById('terminal-container');\r\n                    if (container) window.TerminalSystem.init(container);\r\n                }\r\n            },\r\n        },\r\n    },\r\n];\r\n\r\n// Auto-register with WindowManager when available (module load time)\r\nif (window.WindowManager) {\r\n    window.WindowManager.registerAll(windowConfigurations);\r\n    console.log(`[WindowConfigs] Registered ${windowConfigurations.length} windows`);\r\n} else {\r\n    // Fallback: register after DOMContentLoaded if WindowManager loads later\r\n    document.addEventListener('DOMContentLoaded', () => {\r\n        if (window.WindowManager) {\r\n            window.WindowManager.registerAll(windowConfigurations);\r\n            console.log(\r\n                `[WindowConfigs] Registered ${windowConfigurations.length} windows (delayed)`\r\n            );\r\n        }\r\n    });\r\n}\r\n\r\n// Expose configs for diagnostics and external tools\r\nwindow.windowConfigurations = windowConfigurations;\r\n\r\nexport default windowConfigurations;\r\n", "/*\r\n * DEPRECATED: finder-instance.ts\r\n * -------------------------------\r\n * Die fr\u00FChere Multi\u2011Instance\u2011Finder\u2011Implementierung wurde entfernt.\r\n * Sie wird durch FinderWindow (BaseWindow) + FinderView (BaseTab) ersetzt.\r\n *\r\n * Diese Datei exportiert nichts mehr und registriert KEINE globalen Symbole\r\n * (keine window.FinderInstance / window.FinderInstanceManager), um Legacy\u2011Pfade\r\n * klar abzuschalten. Tests und Aufrufer m\u00FCssen auf die neue BaseWindow\u2011Struktur\r\n * umgestellt werden.\r\n */\r\nexport {};\r\n", "/**\r\n * LaunchpadSystem (TypeScript)\r\n * Displays all registered persistent apps as a grid and opens selected apps.\r\n */\r\n\r\nconsole.log('Launchpad (TS) loaded');\r\n\r\nimport { translate } from '../services/i18n';\r\n\r\n(() => {\r\n    'use strict';\r\n\r\n    type AppEntry = { id: string; name: string; icon: string; programKey?: string | null };\r\n\r\n    let container: HTMLElement | null = null;\r\n    let searchInput: HTMLInputElement | null = null;\r\n    let appsGrid: HTMLElement | null = null;\r\n    let allApps: AppEntry[] = [];\r\n    let filteredApps: AppEntry[] = [];\r\n\r\n    // translate() wird zentral aus i18n.ts importiert\r\n\r\n    function init(containerElement: HTMLElement): void {\r\n        if (!containerElement) {\r\n            console.warn('LaunchpadSystem: No container element provided');\r\n            return;\r\n        }\r\n        if (container) {\r\n            console.warn('LaunchpadSystem: Already initialized');\r\n            return;\r\n        }\r\n        container = containerElement;\r\n        render();\r\n        loadApps();\r\n    }\r\n\r\n    function render(): void {\r\n        if (!container) return;\r\n        container.innerHTML = `\r\n            <div class=\"launchpad-container\">\r\n                <div class=\"launchpad-search\">\r\n                    <input\r\n                        id=\"launchpad-search-input\"\r\n                        type=\"text\"\r\n                        placeholder=\"${translate('modals.launchpad.searchPlaceholder') || 'Search apps'}\"\r\n                        class=\"launchpad-search-input\"\r\n                    />\r\n                </div>\r\n                <div id=\"launchpad-apps-grid\" class=\"launchpad-apps-grid\"></div>\r\n            </div>\r\n        `;\r\n\r\n        searchInput = container.querySelector<HTMLInputElement>('#launchpad-search-input');\r\n        appsGrid = container.querySelector<HTMLElement>('#launchpad-apps-grid');\r\n        if (searchInput) searchInput.addEventListener('input', handleSearch);\r\n    }\r\n\r\n    function loadApps(): void {\r\n        const WM = (window as any).WindowManager;\r\n        if (!WM) {\r\n            console.warn('LaunchpadSystem: WindowManager not available');\r\n            return;\r\n        }\r\n        const windowIds: string[] = WM.getAllWindowIds();\r\n        allApps = [];\r\n        windowIds.forEach(id => {\r\n            const cfg = WM.getConfig(id);\r\n            const info = WM.getProgramInfo(id);\r\n            if (cfg && cfg.type === 'transient') return; // skip transient\r\n            if (id === 'launchpad-modal') return; // skip self\r\n            if (info) {\r\n                allApps.push({\r\n                    id,\r\n                    name: info.programLabel || translate('programs.default.label') || 'App',\r\n                    icon: info.icon || './img/sucher.png',\r\n                    programKey: cfg ? cfg.programKey : null,\r\n                });\r\n            }\r\n        });\r\n        filteredApps = [...allApps];\r\n        renderApps();\r\n    }\r\n\r\n    function handleSearch(e: Event): void {\r\n        const q = (e.target as HTMLInputElement).value.toLowerCase().trim();\r\n        filteredApps = q ? allApps.filter(a => a.name.toLowerCase().includes(q)) : [...allApps];\r\n        renderApps();\r\n    }\r\n\r\n    function renderApps(): void {\r\n        if (!appsGrid) return;\r\n        appsGrid.innerHTML = '';\r\n        if (filteredApps.length === 0) {\r\n            appsGrid.innerHTML = `\r\n                <div class=\"launchpad-empty\">\r\n                    <p>${translate('finder.empty') || 'No apps found'}</p>\r\n                </div>\r\n            `;\r\n            return;\r\n        }\r\n        const grid = appsGrid;\r\n        if (!grid) return;\r\n        filteredApps.forEach(app => {\r\n            const btn = document.createElement('button');\r\n            btn.className = 'launchpad-app-button';\r\n            btn.setAttribute('data-window-id', app.id);\r\n            btn.setAttribute('data-action', 'launchpadOpenWindow');\r\n            btn.title = app.name;\r\n\r\n            const iconWrap = document.createElement('div');\r\n            iconWrap.className = 'launchpad-app-icon';\r\n            const icon = app.icon;\r\n            const isImg = typeof icon === 'string' && /\\.(png|jpg|jpeg|gif|svg|webp)$/i.test(icon);\r\n            if (\r\n                isImg ||\r\n                (typeof icon === 'string' && (icon.startsWith('./') || icon.startsWith('http')))\r\n            ) {\r\n                const img = document.createElement('img');\r\n                img.src = icon;\r\n                img.alt = app.name;\r\n                img.draggable = false;\r\n                iconWrap.appendChild(img);\r\n            } else if (typeof icon === 'string' && icon.trim().length) {\r\n                const emoji = document.createElement('div');\r\n                emoji.className = 'launchpad-app-emoji';\r\n                emoji.textContent = icon;\r\n                iconWrap.appendChild(emoji);\r\n            } else {\r\n                const fallback = document.createElement('img');\r\n                fallback.src = './img/sucher.png';\r\n                fallback.alt = app.name;\r\n                fallback.draggable = false;\r\n                iconWrap.appendChild(fallback);\r\n            }\r\n\r\n            const label = document.createElement('span');\r\n            label.className = 'launchpad-app-label';\r\n            label.textContent = app.name;\r\n\r\n            btn.appendChild(iconWrap);\r\n            btn.appendChild(label);\r\n            grid.appendChild(btn);\r\n        });\r\n    }\r\n\r\n    function openApp(windowId: string): void {\r\n        if (!windowId) return;\r\n        const w: any = window as any;\r\n        const launchpadModal = document.getElementById('launchpad-modal');\r\n        if (launchpadModal && w.dialogs && w.dialogs['launchpad-modal']) {\r\n            w.dialogs['launchpad-modal'].close?.();\r\n        } else if (launchpadModal) {\r\n            launchpadModal.classList.add('hidden');\r\n        }\r\n\r\n        const WM = w.WindowManager;\r\n        if (WM?.open) {\r\n            WM.open(windowId);\r\n            return;\r\n        }\r\n        const dialog = w.dialogs && w.dialogs[windowId];\r\n        if (dialog?.open) dialog.open();\r\n        else {\r\n            const modalElement = document.getElementById(windowId);\r\n            if (modalElement) {\r\n                const domUtils = (window as any).DOMUtils;\r\n                if (domUtils && typeof domUtils.show === 'function') {\r\n                    domUtils.show(modalElement);\r\n                } else {\r\n                    modalElement.classList.remove('hidden');\r\n                }\r\n                w.bringDialogToFront?.(windowId);\r\n                w.updateProgramLabelByTopModal?.();\r\n            }\r\n        }\r\n    }\r\n\r\n    function refresh(): void {\r\n        loadApps();\r\n    }\r\n\r\n    function clearSearch(): void {\r\n        if (searchInput) searchInput.value = '';\r\n        filteredApps = [...allApps];\r\n        renderApps();\r\n    }\r\n\r\n    window.addEventListener('languagePreferenceChange', () => {\r\n        if (container) loadApps();\r\n    });\r\n\r\n    // Register ActionBus action to open window and close launchpad\r\n    const AB = (window as any).ActionBus;\r\n    if (typeof AB?.register === 'function') {\r\n        (AB as any).register('launchpadOpenWindow', (params: any) => {\r\n            const id = params?.windowId || params?.windowid || params?.window || params?.id;\r\n            if (id) openApp(id);\r\n        });\r\n    }\r\n\r\n    (window as any).LaunchpadSystem = {\r\n        init,\r\n        refresh,\r\n        clearSearch,\r\n        get container() {\r\n            return container;\r\n        },\r\n    };\r\n})();\r\n", "/* eslint-disable @typescript-eslint/no-explicit-any */\r\n/**\r\n * Multi-Instance Modal Integration (TypeScript)\r\n * Integrates the tab system with existing modals (Terminal, TextEditor, Finder)\r\n * Wires up keyboard shortcuts and session management\r\n */\r\n\r\nimport { getJSON } from '../services/storage-utils.js';\r\n\r\n(() => {\r\n    'use strict';\r\n\r\n    type Instance = { instanceId: string; show?: () => void; hide?: () => void };\r\n    type Manager = {\r\n        getAllInstances(): Instance[];\r\n        getActiveInstance(): Instance | null;\r\n        getAllInstanceIds?: () => string[];\r\n        getInstanceCount: () => number;\r\n        setActiveInstance(id: string): void;\r\n        createInstance(cfg?: { title?: string }): Instance | null;\r\n        destroyInstance(id: string): void;\r\n    };\r\n\r\n    type IntegrationRecord = {\r\n        manager: Manager;\r\n        tabManager: unknown;\r\n        modalId: string;\r\n        containerId: string;\r\n        unregisterShortcuts?: () => void;\r\n    };\r\n\r\n    type WireOptions = {\r\n        type: string;\r\n        manager: Manager;\r\n        modalId: string | null;\r\n        tabMountId: string;\r\n        containerId: string;\r\n        addButton?: boolean;\r\n        titleFactory?: (manager: Manager) => string;\r\n        onEmpty?: () => void;\r\n    };\r\n\r\n    class MultiInstanceIntegration {\r\n        private integrations: Map<string, IntegrationRecord> = new Map();\r\n        private isInitialized = false;\r\n\r\n        init() {\r\n            if (this.isInitialized) return;\r\n            if (document.readyState === 'loading') {\r\n                document.addEventListener('DOMContentLoaded', () => this.setup());\r\n            } else {\r\n                this.setup();\r\n            }\r\n        }\r\n\r\n        private setup() {\r\n            const W = window as unknown as Record<string, any>;\r\n            if (!W.InstanceManager || !W.WindowTabs || !W.KeyboardShortcuts) {\r\n                console.error('MultiInstanceIntegration: Required dependencies not loaded');\r\n                return;\r\n            }\r\n\r\n            if (W.TerminalInstanceManager)\r\n                this.wireManager({\r\n                    type: 'terminal',\r\n                    manager: W.TerminalInstanceManager,\r\n                    modalId: 'terminal-modal',\r\n                    tabMountId: 'terminal-tabs-container',\r\n                    containerId: 'terminal-container',\r\n                    addButton: true,\r\n                    titleFactory: manager =>\r\n                        `Terminal ${(manager.getInstanceCount?.() || manager.getAllInstances().length) + 1}`,\r\n                    onEmpty: () => this.closeModalOrHide('terminal-modal'),\r\n                });\r\n\r\n            if (W.TextEditorInstanceManager)\r\n                this.wireManager({\r\n                    type: 'text-editor',\r\n                    manager: W.TextEditorInstanceManager,\r\n                    modalId: 'text-modal',\r\n                    tabMountId: 'text-editor-tabs-container',\r\n                    containerId: 'text-editor-container',\r\n                    addButton: true,\r\n                    titleFactory: manager =>\r\n                        `Editor ${(manager.getInstanceCount?.() || manager.getAllInstances().length) + 1}`,\r\n                    onEmpty: () => this.closeModalOrHide('text-modal'),\r\n                });\r\n\r\n            if (W.FinderInstanceManager)\r\n                this.wireManager({\r\n                    type: 'finder',\r\n                    manager: W.FinderInstanceManager,\r\n                    modalId: null, // legacy finder-modal removed\r\n                    tabMountId: 'finder-tabs-container',\r\n                    containerId: 'finder-container',\r\n                    addButton: true,\r\n                    titleFactory: manager =>\r\n                        `Finder ${(manager.getInstanceCount?.() || manager.getAllInstances().length) + 1}`,\r\n                    // onEmpty intentionally no-op for Finder\r\n                });\r\n\r\n            // Ensure tabs/controllers reflect any pre-existing state and show active instance.\r\n            // Session restoration is orchestrated by app-init; we intentionally do not call\r\n            // SessionManager.restoreSession() or init() here to avoid duplicate restores.\r\n            this.integrations.forEach((integration, type) => {\r\n                const { manager, tabManager } = integration;\r\n                // Support both legacy adapter ({controller: {refresh}}) and new controller ({refresh})\r\n                try {\r\n                    const maybe = tabManager as any;\r\n                    const refreshFn =\r\n                        typeof maybe?.refresh === 'function'\r\n                            ? maybe.refresh.bind(maybe)\r\n                            : typeof maybe?.controller?.refresh === 'function'\r\n                              ? maybe.controller.refresh.bind(maybe.controller)\r\n                              : null;\r\n                    if (refreshFn) refreshFn();\r\n                } catch {}\r\n                // Try to restore previously selected tab from a simple localStorage map (fallback)\r\n                try {\r\n                    const map = getJSON<Record<string, string | null>>('windowActiveInstances', {});\r\n                    const wanted = map?.[type] || null;\r\n                    if (wanted && typeof (manager as any).setActiveInstance === 'function') {\r\n                        // Only set if the instance exists to avoid creating new ones\r\n                        const exists = manager.getAllInstances().some(i => i.instanceId === wanted);\r\n                        if (exists) (manager as any).setActiveInstance(wanted);\r\n                    }\r\n                } catch {}\r\n\r\n                const active = manager.getActiveInstance();\r\n                if (active) this.showInstance(type, active.instanceId);\r\n            });\r\n\r\n            // Scope keyboard shortcuts by top window\r\n            if (\r\n                W.KeyboardShortcuts &&\r\n                typeof W.KeyboardShortcuts.setContextResolver === 'function'\r\n            ) {\r\n                W.KeyboardShortcuts.setContextResolver(() => {\r\n                    try {\r\n                        const wm = W.WindowManager;\r\n                        const top =\r\n                            wm && typeof wm.getTopWindow === 'function' ? wm.getTopWindow() : null;\r\n                        const topId = top?.id || '';\r\n                        let match = 'global';\r\n                        this.integrations.forEach((val, key) => {\r\n                            if (val && val.modalId === topId) match = key;\r\n                        });\r\n                        return match;\r\n                    } catch {\r\n                        return 'global';\r\n                    }\r\n                });\r\n            }\r\n\r\n            this.isInitialized = true;\r\n        }\r\n\r\n        /**\r\n         * Generic wiring for an InstanceManager + WindowTabs + keyboard shortcuts\r\n         */\r\n        private wireManager(options: WireOptions) {\r\n            const {\r\n                type,\r\n                manager,\r\n                modalId,\r\n                tabMountId,\r\n                containerId,\r\n                addButton = true,\r\n                titleFactory,\r\n                onEmpty,\r\n            } = options;\r\n\r\n            const W = window as unknown as Record<string, any>;\r\n            const mount = document.getElementById(tabMountId);\r\n            if (!mount) return;\r\n\r\n            const controller = W.WindowTabs.create(manager, mount, {\r\n                addButton,\r\n                onCreateInstanceTitle: () =>\r\n                    titleFactory?.(manager) ||\r\n                    `${type} ${(manager.getInstanceCount?.() || manager.getAllInstances().length) + 1}`,\r\n            });\r\n\r\n            const origSetActive = manager.setActiveInstance.bind(manager);\r\n            manager.setActiveInstance = (id: string) => {\r\n                origSetActive(id);\r\n                this.showInstance(type, id);\r\n            };\r\n\r\n            const origDestroy = manager.destroyInstance.bind(manager);\r\n            manager.destroyInstance = (id: string) => {\r\n                origDestroy(id);\r\n                const remaining = manager.getAllInstances().length;\r\n                if (remaining === 0) {\r\n                    onEmpty?.();\r\n                } else {\r\n                    const active = manager.getActiveInstance();\r\n                    if (active) this.showInstance(type, active.instanceId);\r\n                }\r\n            };\r\n\r\n            this.integrations.set(type, {\r\n                manager,\r\n                tabManager: controller,\r\n                modalId: modalId || '',\r\n                containerId,\r\n            });\r\n\r\n            this.registerShortcutsForType(type, manager, modalId || undefined);\r\n            this.updateInstanceVisibility(type);\r\n            this.setupInstanceListeners(type);\r\n        }\r\n\r\n        /** Close modal via API.window.close or DOM hide fallback */\r\n        private closeModalOrHide(modalId: string) {\r\n            try {\r\n                const API = (window as any).API;\r\n                if (API?.window?.close) {\r\n                    API.window.close(modalId);\r\n                    return;\r\n                }\r\n                const modal = document.getElementById(modalId);\r\n                if (!modal) return;\r\n                const domUtils = (window as any).DOMUtils;\r\n                if (domUtils && typeof domUtils.hide === 'function') {\r\n                    domUtils.hide(modal);\r\n                } else {\r\n                    modal.classList.add('hidden');\r\n                }\r\n            } catch {\r\n                /* ignore */\r\n            }\r\n        }\r\n\r\n        private setupInstanceListeners(type: string) {\r\n            const integration = this.integrations.get(type);\r\n            if (!integration) return;\r\n            const { manager } = integration;\r\n\r\n            const originalCreate = manager.createInstance.bind(manager);\r\n            manager.createInstance = (config?: { title?: string }) => {\r\n                const instance = originalCreate(config);\r\n                // After create, prefer showing the active; otherwise show the created one\r\n                const active = manager.getActiveInstance();\r\n                if (active) {\r\n                    this.showInstance(type, active.instanceId);\r\n                } else if (instance) {\r\n                    this.showInstance(type, instance.instanceId);\r\n                }\r\n                return instance;\r\n            };\r\n        }\r\n\r\n        showInstance(type: string, instanceId: string) {\r\n            const integration = this.integrations.get(type);\r\n            if (!integration) return;\r\n            const instances = integration.manager.getAllInstances();\r\n            instances.forEach(inst => {\r\n                if (inst.instanceId === instanceId) inst.show?.();\r\n                else inst.hide?.();\r\n            });\r\n        }\r\n\r\n        updateInstanceVisibility(type: string) {\r\n            const integration = this.integrations.get(type);\r\n            if (!integration) return;\r\n            const active = integration.manager.getActiveInstance();\r\n            if (active) {\r\n                this.showInstance(type, active.instanceId);\r\n            } else {\r\n                const all = integration.manager.getAllInstances();\r\n                if (all.length > 0) {\r\n                    const firstId = all[0]?.instanceId;\r\n                    if (firstId) {\r\n                        // Ensure a consistent active selection\r\n                        integration.manager.setActiveInstance(firstId);\r\n                        this.showInstance(type, firstId);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        private registerShortcutsForType(type: string, manager: Manager, modalId?: string) {\r\n            const W = window as unknown as Record<string, any>;\r\n            if (modalId) {\r\n                const modalEl = document.getElementById(modalId);\r\n                if (!modalEl) {\r\n                    console.error(\r\n                        `Cannot register shortcuts for ${type}: modal ${modalId} not found`\r\n                    );\r\n                    return;\r\n                }\r\n            }\r\n            const unregister = W.KeyboardShortcuts.register(manager, {\r\n                scope: document,\r\n                newTitleFactory: () => `${type} ${manager.getInstanceCount() + 1}`,\r\n            });\r\n            const rec = this.integrations.get(type);\r\n            if (rec) rec.unregisterShortcuts = unregister;\r\n        }\r\n    }\r\n\r\n    // Create and expose singleton (retain both names for compatibility)\r\n    const integration = new MultiInstanceIntegration();\r\n    (window as any).MultiInstanceIntegration = integration;\r\n    (window as any).multiInstanceIntegration = integration;\r\n    integration.init();\r\n})();\r\n", "/**\r\n * system.ts\r\n * System Status UI Module\r\n *\r\n * Manages:\r\n * - WiFi, Bluetooth, Focus, Dark Mode, Battery status\r\n * - Volume, Brightness sliders\r\n * - Audio device selection\r\n * - Network and Bluetooth device selection\r\n * - Icon updates and UI state synchronization\r\n */\r\n\r\nconsole.log('\u2705 SystemUI loaded');\r\n\r\n(() => {\r\n    'use strict';\r\n\r\n    // ===== Types =====\r\n\r\n    interface I18nSystem {\r\n        translate(key: string): string;\r\n        applyTranslations(): void;\r\n        getActiveLanguage(): string;\r\n    }\r\n\r\n    interface IconSystemType {\r\n        SYSTEM_ICONS?: Record<string, string>;\r\n        ensureSvgNamespace?(svg: string): string;\r\n        renderIconIntoElement?(el: HTMLElement | null, markup: string, fallbackKey: string): void;\r\n    }\r\n\r\n    interface ThemeSystemType {\r\n        setThemePreference?(mode: string): void;\r\n    }\r\n\r\n    interface SystemStatus {\r\n        wifi: boolean;\r\n        bluetooth: boolean;\r\n        focus: boolean;\r\n        darkMode: boolean;\r\n        brightness: number;\r\n        volume: number;\r\n        audioDevice: string;\r\n        network: string;\r\n        battery: number;\r\n        connectedBluetoothDevice: string;\r\n    }\r\n\r\n    interface DeviceOptions {\r\n        silent?: boolean;\r\n        syncAudio?: boolean;\r\n    }\r\n\r\n    interface SystemUI {\r\n        initSystemStatusControls(): void;\r\n        updateAllSystemStatusUI(): void;\r\n        handleSystemToggle(toggleKey: string): void;\r\n        handleSystemAction(actionKey: string): void;\r\n        handleSystemSliderInput(type: string, value: number): void;\r\n        setConnectedNetwork(network: string, options?: DeviceOptions): void;\r\n        setBluetoothDevice(deviceName: string, options?: DeviceOptions): void;\r\n        setAudioDevice(deviceKey: string, options?: DeviceOptions): void;\r\n        getSystemStatus(): SystemStatus;\r\n    }\r\n\r\n    // ===== Module Dependencies =====\r\n    const appI18n: I18nSystem = window.appI18n || {\r\n        translate: key => key,\r\n        applyTranslations: () => {},\r\n        getActiveLanguage: () => 'en',\r\n    };\r\n\r\n    const IconSystem = window.IconSystem || {};\r\n    const SYSTEM_ICONS = IconSystem.SYSTEM_ICONS || {};\r\n    const ensureSvgNamespace = IconSystem.ensureSvgNamespace || ((svg: string) => svg);\r\n    const renderIconIntoElement = IconSystem.renderIconIntoElement || (() => {});\r\n\r\n    const ThemeSystem = window.ThemeSystem || {};\r\n    const setThemePreference = ThemeSystem.setThemePreference || (() => {});\r\n\r\n    // Helper to hide all menu dropdowns\r\n    const hideMenuDropdowns =\r\n        window.hideMenuDropdowns ||\r\n        (() => {\r\n            const domUtils = (window as any).DOMUtils;\r\n            document.querySelectorAll('.menu-dropdown').forEach(dropdown => {\r\n                if (!dropdown.classList.contains('hidden')) {\r\n                    if (domUtils && typeof domUtils.hide === 'function') {\r\n                        domUtils.hide(dropdown as HTMLElement);\r\n                    } else {\r\n                        dropdown.classList.add('hidden');\r\n                    }\r\n                }\r\n            });\r\n            document.querySelectorAll('[data-menubar-trigger-button=\"true\"]').forEach(button => {\r\n                button.setAttribute('aria-expanded', 'false');\r\n            });\r\n            document.querySelectorAll('[data-system-menu-trigger]').forEach(button => {\r\n                button.setAttribute('aria-expanded', 'false');\r\n            });\r\n        });\r\n\r\n    // ===== System State =====\r\n    const systemStatus: SystemStatus = {\r\n        wifi: true,\r\n        bluetooth: true,\r\n        focus: false,\r\n        darkMode: document.documentElement.classList.contains('dark'),\r\n        brightness: 80,\r\n        volume: 65,\r\n        audioDevice: 'speakers',\r\n        network: 'HomeLAN',\r\n        battery: 100,\r\n        connectedBluetoothDevice: 'AirPods',\r\n    };\r\n\r\n    // ===== UI Helper Functions =====\r\n\r\n    function applySystemIcon(iconToken: string, iconKey: string): void {\r\n        const svg = SYSTEM_ICONS[iconKey];\r\n        const markup = svg ? ensureSvgNamespace(svg) : '';\r\n        document.querySelectorAll(`[data-icon=\"${iconToken}\"]`).forEach(el => {\r\n            renderIconIntoElement(el as HTMLElement, markup, iconToken);\r\n        });\r\n    }\r\n\r\n    function updateSystemStateText(\r\n        stateKey: string,\r\n        text: string | number | null | undefined\r\n    ): void {\r\n        document.querySelectorAll(`[data-state=\"${stateKey}\"]`).forEach(el => {\r\n            el.textContent = text !== null && text !== undefined ? String(text) : '';\r\n        });\r\n    }\r\n\r\n    function updateSystemToggleState(toggleKey: string, active: boolean): void {\r\n        const toggle = document.querySelector(`[data-system-toggle=\"${toggleKey}\"]`);\r\n        if (toggle) {\r\n            toggle.classList.toggle('is-active', !!active);\r\n            toggle.setAttribute('aria-pressed', active ? 'true' : 'false');\r\n        }\r\n    }\r\n\r\n    function updateSystemMenuCheckbox(actionKey: string, checked: boolean): void {\r\n        const checkbox = document.querySelector(`[data-system-action=\"${actionKey}\"]`);\r\n        if (checkbox) {\r\n            checkbox.setAttribute('aria-pressed', checked ? 'true' : 'false');\r\n            checkbox.classList.toggle('is-active', !!checked);\r\n        }\r\n    }\r\n\r\n    function updateSystemSliderValue(type: string, value: number): void {\r\n        document\r\n            .querySelectorAll<HTMLInputElement>(`[data-system-slider=\"${type}\"]`)\r\n            .forEach(slider => {\r\n                if (Number(slider.value) !== value) {\r\n                    slider.value = String(value);\r\n                }\r\n            });\r\n        document.querySelectorAll(`[data-state=\"${type}\"]`).forEach(label => {\r\n            label.textContent = `${value}%`;\r\n        });\r\n    }\r\n\r\n    // ===== Status Update Functions =====\r\n\r\n    function updateWifiUI(): void {\r\n        const iconKey = systemStatus.wifi ? 'wifiOn' : 'wifiOff';\r\n        applySystemIcon('wifi', iconKey);\r\n        updateSystemStateText(\r\n            'wifi',\r\n            appI18n.translate(systemStatus.wifi ? 'menubar.state.on' : 'menubar.state.off')\r\n        );\r\n        updateSystemToggleState('wifi', systemStatus.wifi);\r\n        updateSystemMenuCheckbox('toggle-wifi', systemStatus.wifi);\r\n        document.querySelectorAll('#wifi-menu [data-network]').forEach(btn => {\r\n            const disabled = !systemStatus.wifi;\r\n            if (disabled) {\r\n                btn.setAttribute('aria-disabled', 'true');\r\n            } else {\r\n                btn.removeAttribute('aria-disabled');\r\n            }\r\n        });\r\n        setConnectedNetwork(systemStatus.network, { silent: true });\r\n    }\r\n\r\n    function updateBluetoothUI(): void {\r\n        const iconKey = systemStatus.bluetooth ? 'bluetoothOn' : 'bluetoothOff';\r\n        applySystemIcon('bluetooth', iconKey);\r\n        updateSystemStateText(\r\n            'bluetooth',\r\n            appI18n.translate(systemStatus.bluetooth ? 'menubar.state.on' : 'menubar.state.off')\r\n        );\r\n        updateSystemToggleState('bluetooth', systemStatus.bluetooth);\r\n        updateSystemMenuCheckbox('toggle-bluetooth', systemStatus.bluetooth);\r\n        const devices = document.querySelectorAll('#bluetooth-menu [data-device]');\r\n        devices.forEach(btn => {\r\n            const indicator = btn.querySelector('.system-network-indicator');\r\n            if (indicator && !indicator.getAttribute('data-default')) {\r\n                indicator.setAttribute('data-default', indicator.textContent || '');\r\n            }\r\n            const disabled = !systemStatus.bluetooth;\r\n            if (disabled) {\r\n                btn.setAttribute('aria-disabled', 'true');\r\n            } else {\r\n                btn.removeAttribute('aria-disabled');\r\n            }\r\n        });\r\n        setBluetoothDevice(systemStatus.connectedBluetoothDevice, {\r\n            silent: true,\r\n            syncAudio: false,\r\n        });\r\n    }\r\n\r\n    function updateFocusUI(): void {\r\n        updateSystemToggleState('focus', systemStatus.focus);\r\n        updateSystemStateText(\r\n            'focus',\r\n            appI18n.translate(systemStatus.focus ? 'menubar.state.active' : 'menubar.state.off')\r\n        );\r\n    }\r\n\r\n    function updateDarkModeUI(): void {\r\n        const isDark = systemStatus.darkMode;\r\n        updateSystemToggleState('dark-mode', isDark);\r\n        updateSystemStateText(\r\n            'dark-mode',\r\n            appI18n.translate(isDark ? 'menubar.state.active' : 'menubar.state.off')\r\n        );\r\n        applySystemIcon('appearance', isDark ? 'appearanceDark' : 'appearanceLight');\r\n    }\r\n\r\n    function updateVolumeUI(): void {\r\n        const value = Math.max(0, Math.min(100, Number(systemStatus.volume) || 0));\r\n        systemStatus.volume = value;\r\n        let iconKey = 'volumeMute';\r\n        if (value === 0) {\r\n            iconKey = 'volumeMute';\r\n        } else if (value <= 33) {\r\n            iconKey = 'volumeLow';\r\n        } else if (value <= 66) {\r\n            iconKey = 'volumeMedium';\r\n        } else {\r\n            iconKey = 'volumeHigh';\r\n        }\r\n        applySystemIcon('volume', iconKey);\r\n        updateSystemSliderValue('volume', value);\r\n    }\r\n\r\n    function updateBrightnessUI(): void {\r\n        const value = Math.max(0, Math.min(100, Number(systemStatus.brightness) || 0));\r\n        systemStatus.brightness = value;\r\n        updateSystemSliderValue('brightness', value);\r\n    }\r\n\r\n    function updateBatteryUI(): void {\r\n        applySystemIcon('battery', 'batteryFull');\r\n        updateSystemStateText('battery', `${systemStatus.battery}%`);\r\n    }\r\n\r\n    function updateAudioDeviceUI(): void {\r\n        const active = systemStatus.audioDevice;\r\n        document.querySelectorAll('[data-audio-device]').forEach(btn => {\r\n            const isActive = btn.getAttribute('data-audio-device') === active;\r\n            btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');\r\n            btn.classList.toggle('is-active', isActive);\r\n        });\r\n    }\r\n\r\n    // ===== Device Selection Functions =====\r\n\r\n    function setConnectedNetwork(network: string, options: DeviceOptions = {}): void {\r\n        if (network) {\r\n            systemStatus.network = network;\r\n        }\r\n        const activeNetwork = systemStatus.network;\r\n        document.querySelectorAll('#wifi-menu [data-network]').forEach(btn => {\r\n            const indicator = btn.querySelector('.system-network-indicator');\r\n            if (indicator && !indicator.getAttribute('data-default')) {\r\n                indicator.setAttribute('data-default', indicator.textContent || '');\r\n            }\r\n            const isActive =\r\n                !btn.hasAttribute('aria-disabled') &&\r\n                btn.getAttribute('data-network') === activeNetwork &&\r\n                systemStatus.wifi;\r\n            btn.classList.toggle('is-active', isActive);\r\n            btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');\r\n            if (indicator) {\r\n                if (!systemStatus.wifi) {\r\n                    indicator.textContent = indicator.getAttribute('data-default') || '';\r\n                } else if (isActive) {\r\n                    indicator.textContent = appI18n.translate('menubar.state.connected');\r\n                } else {\r\n                    indicator.textContent = indicator.getAttribute('data-default') || '';\r\n                }\r\n            }\r\n        });\r\n        if (!options.silent) {\r\n            hideMenuDropdowns();\r\n        }\r\n    }\r\n\r\n    function setBluetoothDevice(deviceName: string, options: DeviceOptions = {}): void {\r\n        const syncAudio = options.syncAudio !== false;\r\n        if (deviceName) {\r\n            systemStatus.connectedBluetoothDevice = deviceName;\r\n            if (syncAudio && deviceName === 'AirPods') {\r\n                systemStatus.audioDevice = 'airpods';\r\n            }\r\n        }\r\n        const activeDevice = systemStatus.connectedBluetoothDevice;\r\n        document.querySelectorAll('#bluetooth-menu [data-device]').forEach(btn => {\r\n            const indicator = btn.querySelector('.system-network-indicator');\r\n            if (indicator && !indicator.getAttribute('data-default')) {\r\n                indicator.setAttribute('data-default', indicator.textContent || '');\r\n            }\r\n            const isActive =\r\n                systemStatus.bluetooth && btn.getAttribute('data-device') === activeDevice;\r\n            btn.classList.toggle('is-active', isActive);\r\n            btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');\r\n            if (indicator) {\r\n                if (!systemStatus.bluetooth) {\r\n                    indicator.textContent = indicator.getAttribute('data-default') || '';\r\n                } else if (isActive) {\r\n                    indicator.textContent = appI18n.translate('menubar.state.connected');\r\n                } else {\r\n                    indicator.textContent = indicator.getAttribute('data-default') || '';\r\n                }\r\n            }\r\n        });\r\n        updateAudioDeviceUI();\r\n        if (!options.silent) {\r\n            hideMenuDropdowns();\r\n        }\r\n    }\r\n\r\n    function setAudioDevice(deviceKey: string, options: DeviceOptions = {}): void {\r\n        if (!deviceKey) return;\r\n        systemStatus.audioDevice = deviceKey;\r\n        if (deviceKey === 'airpods') {\r\n            systemStatus.connectedBluetoothDevice = 'AirPods';\r\n        }\r\n        updateAudioDeviceUI();\r\n        updateBluetoothUI();\r\n        if (!options.silent) {\r\n            hideMenuDropdowns();\r\n        }\r\n    }\r\n\r\n    // ===== Toggle and Action Handlers =====\r\n\r\n    function handleSystemToggle(toggleKey: string): void {\r\n        switch (toggleKey) {\r\n            case 'wifi':\r\n                systemStatus.wifi = !systemStatus.wifi;\r\n                updateWifiUI();\r\n                break;\r\n            case 'bluetooth':\r\n                systemStatus.bluetooth = !systemStatus.bluetooth;\r\n                updateBluetoothUI();\r\n                break;\r\n            case 'focus':\r\n                systemStatus.focus = !systemStatus.focus;\r\n                updateFocusUI();\r\n                break;\r\n            case 'dark-mode': {\r\n                const next = !document.documentElement.classList.contains('dark');\r\n                systemStatus.darkMode = next;\r\n                if (typeof setThemePreference === 'function') {\r\n                    setThemePreference(next ? 'dark' : 'light');\r\n                } else {\r\n                    document.documentElement.classList.toggle('dark', next);\r\n                }\r\n                updateDarkModeUI();\r\n                break;\r\n            }\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    function handleSystemAction(actionKey: string): void {\r\n        switch (actionKey) {\r\n            case 'toggle-wifi':\r\n                handleSystemToggle('wifi');\r\n                break;\r\n            case 'toggle-bluetooth':\r\n                handleSystemToggle('bluetooth');\r\n                break;\r\n            case 'open-network':\r\n            case 'open-bluetooth':\r\n            case 'open-sound':\r\n                {\r\n                    const dialogs = (\r\n                        window as Window & { dialogs?: Record<string, { open(): void }> }\r\n                    ).dialogs;\r\n                    if (dialogs?.['settings-modal']) {\r\n                        dialogs['settings-modal'].open();\r\n                    } else {\r\n                        console.info(`Aktion \"${actionKey}\" w\u00FCrde Einstellungen \u00F6ffnen.`);\r\n                    }\r\n                    hideMenuDropdowns();\r\n                }\r\n                break;\r\n            case 'open-spotlight':\r\n            case 'open-siri':\r\n                console.info(`Aktion \"${actionKey}\" ausgel\u00F6st.`);\r\n                hideMenuDropdowns();\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    function handleSystemSliderInput(type: string, value: number): void {\r\n        if (!Number.isFinite(value)) return;\r\n        if (type === 'volume') {\r\n            systemStatus.volume = value;\r\n            updateVolumeUI();\r\n        } else if (type === 'brightness') {\r\n            systemStatus.brightness = value;\r\n            updateBrightnessUI();\r\n        }\r\n    }\r\n\r\n    // ===== Main Update Function =====\r\n\r\n    function updateAllSystemStatusUI(): void {\r\n        applySystemIcon('sun', 'sun');\r\n        applySystemIcon('moon', 'moon');\r\n        updateWifiUI();\r\n        updateBluetoothUI();\r\n        updateFocusUI();\r\n        updateDarkModeUI();\r\n        updateVolumeUI();\r\n        updateBrightnessUI();\r\n        updateBatteryUI();\r\n        updateAudioDeviceUI();\r\n    }\r\n\r\n    // ===== Initialization =====\r\n\r\n    function initSystemStatusControls(): void {\r\n        document.querySelectorAll('.system-network-indicator').forEach(indicator => {\r\n            indicator.setAttribute('data-default', indicator.textContent || '');\r\n        });\r\n\r\n        document.querySelectorAll('[data-system-menu-trigger]').forEach(trigger => {\r\n            // bindDropdownTrigger is expected in app.js or global scope\r\n            const bindFunc = (\r\n                window as Window & {\r\n                    bindDropdownTrigger?: (el: Element, opts: Record<string, unknown>) => void;\r\n                }\r\n            ).bindDropdownTrigger;\r\n            if (typeof bindFunc === 'function') {\r\n                bindFunc(trigger, {\r\n                    hoverRequiresOpen: true,\r\n                });\r\n            }\r\n        });\r\n\r\n        // Route toggles through ActionBus\r\n        document.querySelectorAll('[data-system-toggle]').forEach(toggle => {\r\n            toggle.setAttribute('data-action', 'system:toggle');\r\n            // ActionBus will stop propagation and execute\r\n        });\r\n\r\n        document.querySelectorAll('[data-system-slider]').forEach(slider => {\r\n            ['pointerdown', 'mousedown', 'touchstart'].forEach(evt => {\r\n                slider.addEventListener(evt, (e: Event) => e.stopPropagation());\r\n            });\r\n            slider.addEventListener('input', (event: Event) => {\r\n                event.stopPropagation();\r\n                const target = event.target as HTMLInputElement;\r\n                const value = Number(target.value);\r\n                const type = target.getAttribute('data-system-slider');\r\n                if (type) {\r\n                    handleSystemSliderInput(type, value);\r\n                }\r\n            });\r\n        });\r\n\r\n        document.querySelectorAll('[data-system-action]').forEach(btn => {\r\n            btn.setAttribute('data-action', 'system:action');\r\n        });\r\n\r\n        document.querySelectorAll('[data-audio-device]').forEach(btn => {\r\n            btn.setAttribute('data-action', 'system:setAudioDevice');\r\n        });\r\n\r\n        document.querySelectorAll('[data-network]').forEach(btn => {\r\n            btn.setAttribute('data-action', 'system:setNetwork');\r\n        });\r\n\r\n        document.querySelectorAll('[data-device]').forEach(btn => {\r\n            btn.setAttribute('data-action', 'system:setBluetoothDevice');\r\n        });\r\n\r\n        updateAllSystemStatusUI();\r\n    }\r\n\r\n    // ===== Public API =====\r\n\r\n    const SystemUIInstance: SystemUI = {\r\n        initSystemStatusControls,\r\n        updateAllSystemStatusUI,\r\n        handleSystemToggle,\r\n        handleSystemAction,\r\n        handleSystemSliderInput,\r\n        setConnectedNetwork,\r\n        setBluetoothDevice,\r\n        setAudioDevice,\r\n        getSystemStatus: () => Object.assign({}, systemStatus),\r\n    };\r\n\r\n    (window as unknown as Window & { SystemUI: SystemUI }).SystemUI = SystemUIInstance;\r\n})();\r\n\r\nexport {};\r\n", "/**\r\n * Window Menu - macOS-style window management menu for the menubar.\r\n * Dynamically builds menu items based on active window instances (Finder, Terminal, etc.).\r\n * Shows instances, allows switching, creating new instances, and closing all.\r\n */\r\n\r\nimport logger from '../core/logger';\r\nimport type { BaseWindow } from '../windows/base-window.js';\r\n\r\nconst CATEGORY = 'WindowMenu';\r\n\r\ninterface WindowMenuConfig {\r\n    appType: string;\r\n    label: string;\r\n}\r\n\r\ntype ActionParams = Record<string, string | undefined>;\r\ntype ActionBusLike = {\r\n    register: (\r\n        actionName: string,\r\n        handler: (params: ActionParams, element: HTMLElement | null) => void\r\n    ) => void;\r\n};\r\n\r\ntype I18nLike = { translate?: (key: string, fallback?: string) => string };\r\ntype ApiLike = { i18n?: I18nLike };\r\n\r\ntype FinderWindowCtorLike = { create?: () => unknown };\r\n\r\ntype WindowRegistryLike = {\r\n    getAllWindows?: (type?: string) => BaseWindow[];\r\n    getActiveWindow?: () => BaseWindow | null;\r\n    getWindow?: (windowId: string) => BaseWindow | null;\r\n    closeAllWindows?: () => void;\r\n    registerWindow?: (window: BaseWindow) => void;\r\n    removeWindow?: (windowId: string) => void;\r\n    setActiveWindow?: (windowId: string | null) => void;\r\n};\r\n\r\ntype MenubarBindingLike = {\r\n    bindDropdownTrigger?: (\r\n        el: HTMLElement | null,\r\n        options?: { hoverRequiresOpen?: boolean }\r\n    ) => void;\r\n};\r\n\r\nfunction t(key: string, fallback: string): string {\r\n    const api = (window as unknown as { API?: ApiLike }).API;\r\n    return api?.i18n?.translate?.(key, fallback) ?? fallback;\r\n}\r\n\r\n/**\r\n * Build and refresh the Window menu based on currently active windows\r\n */\r\nfunction rebuildWindowMenu(): void {\r\n    try {\r\n        const container = document.getElementById('window-menu-container');\r\n        const dropdown = document.getElementById('window-menu-dropdown') as HTMLUListElement;\r\n\r\n        if (!container || !dropdown) {\r\n            logger.warn(CATEGORY, 'Window menu container not found in DOM');\r\n            return;\r\n        }\r\n\r\n        // Get all active window instances grouped by app type.\r\n        // WindowRegistry stores BaseWindow instances with shape: { id, type, zIndex, ... }\r\n        const windowsByApp = new Map<string, BaseWindow[]>();\r\n        const registry = (window as unknown as { WindowRegistry?: WindowRegistryLike })\r\n            .WindowRegistry;\r\n        const allWindows = registry?.getAllWindows?.() || [];\r\n\r\n        allWindows.forEach((win: BaseWindow) => {\r\n            const type = win?.type;\r\n            if (!type) return;\r\n            if (!windowsByApp.has(type)) {\r\n                windowsByApp.set(type, []);\r\n            }\r\n            windowsByApp.get(type)!.push(win);\r\n        });\r\n\r\n        // Hide menu if no windows exist\r\n        if (windowsByApp.size === 0) {\r\n            container.style.display = 'none';\r\n            return;\r\n        }\r\n\r\n        container.style.display = 'block';\r\n\r\n        // Clear existing items\r\n        dropdown.innerHTML = '';\r\n\r\n        const activeWindow = registry?.getActiveWindow?.();\r\n        const appConfigs: WindowMenuConfig[] = [\r\n            {\r\n                appType: 'finder',\r\n                label: t('apps.finder.label', 'Finder'),\r\n            },\r\n            {\r\n                appType: 'terminal',\r\n                label: t('apps.terminal.label', 'Terminal'),\r\n            },\r\n            {\r\n                appType: 'text-editor',\r\n                label: t('apps.text-editor.label', 'Schreibprogramm'),\r\n            },\r\n            {\r\n                appType: 'photos',\r\n                label: t('apps.photos.label', 'Fotos'),\r\n            },\r\n        ];\r\n\r\n        // Build menu items for each app type\r\n        appConfigs.forEach((config, index) => {\r\n            const instances = windowsByApp.get(config.appType) || [];\r\n            if (instances.length === 0) return;\r\n\r\n            // Add separator before app section (except for first)\r\n            if (index > 0) {\r\n                const separator = document.createElement('li');\r\n                separator.className = 'menu-separator';\r\n                separator.setAttribute('role', 'separator');\r\n                separator.setAttribute('aria-hidden', 'true');\r\n                dropdown.appendChild(separator);\r\n            }\r\n\r\n            // Create menu item for each instance\r\n            // Sort by zIndex to get a stable order that roughly matches on-screen stacking.\r\n            const sorted = [...instances].sort((a, b) => (a?.zIndex || 0) - (b?.zIndex || 0));\r\n            sorted.forEach((instance: BaseWindow, instanceIndex: number) => {\r\n                const isActive = !!activeWindow && activeWindow.id === instance.id;\r\n                const li = document.createElement('li');\r\n                li.setAttribute('role', 'none');\r\n\r\n                const button = document.createElement('button');\r\n                button.type = 'button';\r\n                button.className = 'menu-item';\r\n                button.setAttribute('role', 'menuitem');\r\n                button.setAttribute('tabindex', '-1');\r\n                button.dataset.windowId = instance.id;\r\n                button.dataset.action = 'switchToWindow';\r\n                button.dataset.param = instance.id;\r\n\r\n                // Label: \"App Name 1\", \"App Name 2\", etc.\r\n                const labelSpan = document.createElement('span');\r\n                labelSpan.className = 'menu-item-label';\r\n                labelSpan.textContent = `${config.label} ${instanceIndex + 1}`;\r\n\r\n                button.appendChild(labelSpan);\r\n\r\n                // Add checkmark if active\r\n                if (isActive) {\r\n                    const checkmark = document.createElement('span');\r\n                    checkmark.className = 'menu-item-checkmark';\r\n                    checkmark.textContent = '\u2713';\r\n                    checkmark.style.marginLeft = '12px';\r\n                    button.appendChild(checkmark);\r\n                }\r\n\r\n                li.appendChild(button);\r\n                dropdown.appendChild(li);\r\n            });\r\n        });\r\n\r\n        // Add separator before action items\r\n        const sep = document.createElement('li');\r\n        sep.className = 'menu-separator';\r\n        sep.setAttribute('role', 'separator');\r\n        sep.setAttribute('aria-hidden', 'true');\r\n        dropdown.appendChild(sep);\r\n\r\n        // \"New Window\" submenu (only for apps with instances)\r\n        const newWindowLi = document.createElement('li');\r\n        newWindowLi.setAttribute('role', 'none');\r\n        const newWindowButton = document.createElement('button');\r\n        newWindowButton.type = 'button';\r\n        newWindowButton.className = 'menu-item';\r\n        newWindowButton.setAttribute('role', 'menuitem');\r\n        newWindowButton.setAttribute('tabindex', '-1');\r\n        newWindowButton.dataset.action = 'newFinderWindow';\r\n\r\n        const newWindowLabel = document.createElement('span');\r\n        newWindowLabel.className = 'menu-item-label';\r\n        newWindowLabel.dataset.i18n = 'menubar.window.newFinder';\r\n        newWindowLabel.textContent = t('menubar.window.newFinder', 'Neuer Finder');\r\n\r\n        newWindowButton.appendChild(newWindowLabel);\r\n        newWindowLi.appendChild(newWindowButton);\r\n        dropdown.appendChild(newWindowLi);\r\n\r\n        // \"Close All\" action (only if multiple instances exist)\r\n        const totalInstances = Array.from(windowsByApp.values()).reduce(\r\n            (sum, arr) => sum + arr.length,\r\n            0\r\n        );\r\n        if (totalInstances > 1) {\r\n            const closeAllLi = document.createElement('li');\r\n            closeAllLi.setAttribute('role', 'none');\r\n            const closeAllButton = document.createElement('button');\r\n            closeAllButton.type = 'button';\r\n            closeAllButton.className = 'menu-item';\r\n            closeAllButton.setAttribute('role', 'menuitem');\r\n            closeAllButton.setAttribute('tabindex', '-1');\r\n            closeAllButton.dataset.action = 'closeAllWindows';\r\n\r\n            const closeAllLabel = document.createElement('span');\r\n            closeAllLabel.className = 'menu-item-label';\r\n            closeAllLabel.dataset.i18n = 'menubar.window.closeAll';\r\n            closeAllLabel.textContent = t('menubar.window.closeAll', 'Alle schlie\u00DFen');\r\n\r\n            closeAllButton.appendChild(closeAllLabel);\r\n            closeAllLi.appendChild(closeAllButton);\r\n            dropdown.appendChild(closeAllLi);\r\n        }\r\n\r\n        logger.info(CATEGORY, `Window menu rebuilt with ${allWindows.length} instances`);\r\n    } catch (err) {\r\n        logger.warn(CATEGORY, 'rebuildWindowMenu failed:', err);\r\n        // Don't rethrow - let app continue\r\n    }\r\n}\r\n\r\n/**\r\n * Initialize window menu: register actions and setup observers\r\n */\r\nexport function initializeWindowMenu(): void {\r\n    try {\r\n        const actionBus = (window as unknown as { ActionBus?: ActionBusLike }).ActionBus;\r\n        if (!actionBus) {\r\n            logger.warn(CATEGORY, 'ActionBus not available, delaying initialization');\r\n            setTimeout(initializeWindowMenu, 100);\r\n            return;\r\n        }\r\n\r\n        const W = window as unknown as {\r\n            __windowMenuPatched?: boolean;\r\n            WindowRegistry?: WindowRegistryLike;\r\n            __windowMenuTriggerRetry?: number;\r\n        };\r\n\r\n        // Ensure the trigger is bound even if menubar-utils loads slightly later.\r\n        const bindTriggerWithRetry = () => {\r\n            const trigger = document.getElementById('window-menu-trigger');\r\n            if (!trigger) return;\r\n\r\n            if (trigger.getAttribute('data-window-menu-trigger-bound') === '1') return;\r\n            const binder = window as unknown as MenubarBindingLike;\r\n            if (typeof binder.bindDropdownTrigger === 'function') {\r\n                binder.bindDropdownTrigger(trigger, { hoverRequiresOpen: true });\r\n                trigger.setAttribute('data-window-menu-trigger-bound', '1');\r\n                return;\r\n            }\r\n\r\n            // Retry shortly if menubar-utils was not ready yet.\r\n            W.__windowMenuTriggerRetry = window.setTimeout(bindTriggerWithRetry, 150);\r\n        };\r\n\r\n        // Rebuild on menu open to ensure we never show stale state.\r\n        // (The menubar dropdown animation can race with window creation in tests.)\r\n        bindTriggerWithRetry();\r\n        const trigger = document.getElementById('window-menu-trigger');\r\n        if (trigger && trigger.getAttribute('data-window-menu-hooked') !== '1') {\r\n            trigger.setAttribute('data-window-menu-hooked', '1');\r\n            trigger.addEventListener(\r\n                'click',\r\n                () => {\r\n                    rebuildWindowMenu();\r\n                },\r\n                true\r\n            );\r\n        }\r\n\r\n        // Register action: switch to a specific window\r\n        actionBus.register('switchToWindow', (params: ActionParams) => {\r\n            try {\r\n                const windowId = params?.param || params?.windowId;\r\n                if (!windowId) return;\r\n                const registry = (window as unknown as { WindowRegistry?: WindowRegistryLike })\r\n                    .WindowRegistry;\r\n                const win = registry?.getWindow?.(windowId);\r\n                if (!win) return;\r\n                // BaseWindow exposes bringToFront() which also updates WindowRegistry active window.\r\n                if (typeof win.bringToFront === 'function') {\r\n                    win.bringToFront();\r\n                }\r\n                logger.info(CATEGORY, `Switched to window ${windowId}`);\r\n                rebuildWindowMenu();\r\n            } catch (err) {\r\n                logger.warn(CATEGORY, 'switchToWindow action failed:', err);\r\n            }\r\n        });\r\n\r\n        // Register action: create new Finder window\r\n        actionBus.register('newFinderWindow', () => {\r\n            try {\r\n                // The multi-window Finder implementation exposes FinderWindow.create().\r\n                const FW = (window as unknown as { FinderWindow?: FinderWindowCtorLike })\r\n                    .FinderWindow;\r\n                if (FW && typeof FW.create === 'function') {\r\n                    FW.create();\r\n                    logger.info(CATEGORY, 'Created new Finder window');\r\n                    setTimeout(rebuildWindowMenu, 50);\r\n                    return;\r\n                }\r\n                logger.warn(\r\n                    CATEGORY,\r\n                    'FinderWindow.create() not available; cannot create new Finder window'\r\n                );\r\n            } catch (err) {\r\n                logger.warn(CATEGORY, 'newFinderWindow action failed:', err);\r\n            }\r\n        });\r\n\r\n        // Register action: close all windows\r\n        actionBus.register('closeAllWindows', () => {\r\n            try {\r\n                const confirmed = confirm(\r\n                    t('menubar.window.closeAllConfirm', 'Wirklich alle Fenster schlie\u00DFen?')\r\n                );\r\n                if (!confirmed) return;\r\n\r\n                const registry = (window as unknown as { WindowRegistry?: WindowRegistryLike })\r\n                    .WindowRegistry;\r\n                if (registry && typeof registry.closeAllWindows === 'function') {\r\n                    registry.closeAllWindows();\r\n                }\r\n                logger.info(CATEGORY, 'Closed all windows');\r\n                rebuildWindowMenu();\r\n            } catch (err) {\r\n                logger.warn(CATEGORY, 'closeAllWindows action failed:', err);\r\n            }\r\n        });\r\n\r\n        // Initial build\r\n        rebuildWindowMenu();\r\n\r\n        // Patch WindowRegistry to schedule rebuilds when windows are created/destroyed/focused.\r\n        // We keep this lightweight and idempotent (guarded by a global flag).\r\n        if (W.WindowRegistry && !W.__windowMenuPatched) {\r\n            W.__windowMenuPatched = true;\r\n\r\n            let scheduled = false;\r\n            const schedule = () => {\r\n                if (scheduled) return;\r\n                scheduled = true;\r\n                setTimeout(() => {\r\n                    scheduled = false;\r\n                    rebuildWindowMenu();\r\n                }, 50);\r\n            };\r\n\r\n            try {\r\n                const origRegisterWindow = W.WindowRegistry.registerWindow?.bind(W.WindowRegistry);\r\n                if (origRegisterWindow) {\r\n                    W.WindowRegistry.registerWindow = (win: BaseWindow) => {\r\n                        origRegisterWindow(win);\r\n                        schedule();\r\n                    };\r\n                }\r\n            } catch (err) {\r\n                logger.debug(CATEGORY, 'Could not patch WindowRegistry.registerWindow:', err);\r\n            }\r\n\r\n            try {\r\n                const origRemoveWindow = W.WindowRegistry.removeWindow?.bind(W.WindowRegistry);\r\n                if (origRemoveWindow) {\r\n                    W.WindowRegistry.removeWindow = (windowId: string) => {\r\n                        origRemoveWindow(windowId);\r\n                        schedule();\r\n                    };\r\n                }\r\n            } catch (err) {\r\n                logger.debug(CATEGORY, 'Could not patch WindowRegistry.removeWindow:', err);\r\n            }\r\n\r\n            try {\r\n                const origSetActive = W.WindowRegistry.setActiveWindow?.bind(W.WindowRegistry);\r\n                if (origSetActive) {\r\n                    W.WindowRegistry.setActiveWindow = (windowId: string | null) => {\r\n                        origSetActive(windowId);\r\n                        schedule();\r\n                    };\r\n                }\r\n            } catch (err) {\r\n                logger.debug(CATEGORY, 'Could not patch WindowRegistry.setActiveWindow:', err);\r\n            }\r\n        }\r\n\r\n        logger.info(CATEGORY, 'Window menu initialized');\r\n    } catch (err) {\r\n        logger.error(CATEGORY, 'Window menu initialization failed:', err);\r\n        // Don't rethrow - let app continue even if window menu fails\r\n    }\r\n}\r\n\r\n/**\r\n * Expose rebuildWindowMenu for external calls\r\n */\r\nexport function refreshWindowMenu(): void {\r\n    rebuildWindowMenu();\r\n}\r\n", "/**\r\n * Session Guard: centralized validation and clearing for legacy and multi-window sessions.\r\n * Keeps existing heuristics: too many windows/instances (>10) or too many per type (>3) \u2192 clear.\r\n */\r\n\r\nexport type MultiWindowSession = { windows?: Array<{ type?: string; id?: string }> };\r\nexport type LegacySession = { instances?: Array<{ type?: string; id?: string }> };\r\n\r\ntype ValidationResult<T> = {\r\n    parsed: T | null;\r\n    shouldClear: boolean;\r\n    reason?: string;\r\n};\r\n\r\nconst MULTI_KEY = 'multi-window-session';\r\nconst LEGACY_KEY = 'windowInstancesSession';\r\n\r\nexport function validateMultiWindowSession(\r\n    storage: Storage = localStorage\r\n): ValidationResult<MultiWindowSession> {\r\n    const raw = storage.getItem(MULTI_KEY);\r\n    if (!raw) return { parsed: null, shouldClear: false };\r\n    try {\r\n        const session = JSON.parse(raw) as MultiWindowSession;\r\n        logFound('multi-window', session?.windows?.length || 0, session?.windows);\r\n        if (isCountTooHigh(session?.windows)) {\r\n            warnTooMany('multi-window');\r\n            return { parsed: session, shouldClear: true, reason: 'too-many-windows' };\r\n        }\r\n        if (hasTypeOverflow(session?.windows)) {\r\n            warnTypeOverflow('multi-window');\r\n            return { parsed: session, shouldClear: true, reason: 'type-overflow' };\r\n        }\r\n        return { parsed: session, shouldClear: false };\r\n    } catch (err) {\r\n        console.warn('[SESSION-GUARD] Multi-window session invalid JSON:', err);\r\n        return { parsed: null, shouldClear: true, reason: 'invalid-json' };\r\n    }\r\n}\r\n\r\nexport function validateLegacySession(\r\n    storage: Storage = localStorage\r\n): ValidationResult<LegacySession> {\r\n    const raw = storage.getItem(LEGACY_KEY);\r\n    if (!raw) {\r\n        console.log('[SESSION-GUARD] Legacy session exists? false');\r\n        return { parsed: null, shouldClear: false };\r\n    }\r\n    try {\r\n        const session = JSON.parse(raw) as LegacySession;\r\n        logFound('legacy', session?.instances?.length || 0, session?.instances);\r\n        if (isCountTooHigh(session?.instances)) {\r\n            warnTooMany('legacy');\r\n            return { parsed: session, shouldClear: true, reason: 'too-many-instances' };\r\n        }\r\n        if (hasTypeOverflow(session?.instances)) {\r\n            warnTypeOverflow('legacy');\r\n            return { parsed: session, shouldClear: true, reason: 'type-overflow' };\r\n        }\r\n        return { parsed: session, shouldClear: false };\r\n    } catch (err) {\r\n        console.warn('[SESSION-GUARD] Legacy session invalid JSON:', err);\r\n        return { parsed: null, shouldClear: true, reason: 'invalid-json' };\r\n    }\r\n}\r\n\r\nexport function clearSessionKey(key: string, storage: Storage = localStorage): void {\r\n    try {\r\n        storage.removeItem(key);\r\n    } catch (err) {\r\n        console.warn(`[SESSION-GUARD] Failed to clear ${key}:`, err);\r\n    }\r\n}\r\n\r\nfunction isCountTooHigh(items?: Array<unknown>): boolean {\r\n    if (!Array.isArray(items)) return false;\r\n    return items.length > 10; // existing heuristic\r\n}\r\n\r\nfunction hasTypeOverflow(items?: Array<{ type?: string }>): boolean {\r\n    if (!Array.isArray(items)) return false;\r\n    const typeCount = new Map<string, number>();\r\n    for (const item of items) {\r\n        const t = (item?.type as string) || '';\r\n        if (!t) continue;\r\n        const count = (typeCount.get(t) || 0) + 1;\r\n        typeCount.set(t, count);\r\n        if (count > 3) return true; // existing heuristic\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction logFound(\r\n    label: 'legacy' | 'multi-window',\r\n    count: number,\r\n    items?: Array<{ type?: string; id?: string }>\r\n): void {\r\n    const plural = label === 'legacy' ? 'instances' : 'windows';\r\n    console.log(`[SESSION-GUARD] Found ${label} session:`, {\r\n        [`${label}Count`]: count,\r\n        items: items?.map(i => ({ type: i?.type, id: i?.id })) || [],\r\n        label,\r\n        plural,\r\n    });\r\n}\r\n\r\nfunction warnTooMany(label: 'legacy' | 'multi-window'): void {\r\n    const noun = label === 'legacy' ? 'instances' : 'windows';\r\n    console.warn(`[SESSION-GUARD] ${label} session corrupted (too many ${noun})`);\r\n}\r\n\r\nfunction warnTypeOverflow(label: 'legacy' | 'multi-window'): void {\r\n    const noun = label === 'legacy' ? 'instances' : 'windows';\r\n    console.warn(`[SESSION-GUARD] ${label} session has too many ${noun} per type (>3)`);\r\n}\r\n", "/**\r\n * Compatibility shim factory for legacy InstanceManager APIs.\r\n * Bridges old window.*InstanceManager callers to new multi-window/tab architecture.\r\n */\r\n\r\nexport type ShimOptions = {\r\n    legacyName:\r\n        | 'FinderInstanceManager'\r\n        | 'TerminalInstanceManager'\r\n        | 'TextEditorInstanceManager'\r\n        | string;\r\n    registryType: string;\r\n    createInstance: (opts?: {\r\n        title?: string;\r\n    }) => { instanceId: string; type: string; title?: string } | null;\r\n    getInstanceCount: () => number;\r\n    getAllInstances: () => Array<{\r\n        instanceId: string;\r\n        type: string;\r\n        title?: string;\r\n        show?: () => void;\r\n        hide?: () => void;\r\n    }>;\r\n    getActiveInstance: () => { instanceId: string; type: string; title?: string } | null;\r\n    setActiveInstance: (id: string) => void;\r\n};\r\n\r\nexport function installShim(opts: ShimOptions, win: any): void {\r\n    if (typeof win[opts.legacyName] !== 'undefined') return; // already exists\r\n    try {\r\n        win[opts.legacyName] = {\r\n            createInstance: opts.createInstance,\r\n            getInstanceCount: opts.getInstanceCount,\r\n            getAllInstances: opts.getAllInstances,\r\n            getActiveInstance: opts.getActiveInstance,\r\n            setActiveInstance: opts.setActiveInstance,\r\n        };\r\n        console.info(`[COMPAT] ${opts.legacyName} shim installed`);\r\n    } catch (err) {\r\n        console.warn(`[COMPAT] ${opts.legacyName} shim failed:`, err);\r\n    }\r\n}\r\n", "/**\r\n * Application Initialization Module\r\n * Handles DOMContentLoaded setup and modal initialization.\r\n *\r\n * This module centralizes application bootstrap logic that was previously\r\n * in the DOMContentLoaded handler in app.js.\r\n *\r\n * @module app-init\r\n */\r\n\r\n// Export to make this a proper module for global augmentation\r\nexport {};\r\n\r\n// Import window menu module for initialization\r\nimport { initializeWindowMenu } from '../ui/window-menu';\r\nimport {\r\n    clearSessionKey,\r\n    validateLegacySession,\r\n    validateMultiWindowSession,\r\n} from '../services/session-guard';\r\nimport { installShim } from '../compat/instance-shims';\r\n\r\n/**\r\n * Global window interface extensions for app initialization\r\n */\r\ndeclare global {\r\n    interface Window {\r\n        initApp?: () => void;\r\n    }\r\n}\r\n\r\n/**\r\n * Type helper for WindowManager\r\n */\r\ninterface IWindowManager {\r\n    getAllWindowIds?: () => string[];\r\n    getTransientWindowIds?: () => string[];\r\n    setDialogInstance?: (id: string, instance: unknown) => void;\r\n}\r\n\r\n/**\r\n * Type helper for Dialog class\r\n */\r\ninterface IDialog {\r\n    new (id: string): unknown;\r\n}\r\n\r\n/**\r\n * Type helper for external module functions\r\n */\r\ninterface GlobalModules {\r\n    ActionBus?: {\r\n        init?: () => void;\r\n    };\r\n    DesktopSystem?: {\r\n        initDesktop?: () => void;\r\n    };\r\n    Dialog?: IDialog;\r\n    FinderSystem?: {\r\n        init?: () => void;\r\n    };\r\n    SettingsSystem?: {\r\n        init?: (container: HTMLElement) => void;\r\n    };\r\n    TextEditorSystem?: {\r\n        init?: (container: HTMLElement) => void;\r\n    };\r\n    TerminalSystem?: {\r\n        init?: (container: HTMLElement) => void;\r\n    };\r\n    TerminalInstanceManager?: unknown;\r\n    DockSystem?: {\r\n        initDockDragDrop?: () => void;\r\n    };\r\n    SessionManager?: {\r\n        init?: () => void;\r\n        restoreSession?: () => boolean;\r\n    };\r\n    MultiWindowSessionManager?: {\r\n        init?: () => void;\r\n        restoreSession?: () => Promise<boolean>;\r\n    };\r\n    WindowRegistry?: {\r\n        init?: () => void;\r\n    };\r\n}\r\n\r\n/**\r\n * Initialize modal IDs from WindowManager or fallback to default list\r\n * @returns Object containing modalIds array and transientModalIds set\r\n */\r\nfunction initModalIds(): { modalIds: string[]; transientModalIds: Set<string> } {\r\n    const win = window as Window & {\r\n        WindowManager?: IWindowManager;\r\n        APP_CONSTANTS?: { MODAL_IDS?: string[]; TRANSIENT_MODAL_IDS?: Set<string> };\r\n    };\r\n\r\n    if (win.WindowManager) {\r\n        const modalIds = win.WindowManager.getAllWindowIds?.() || [];\r\n        const transientIds = win.WindowManager.getTransientWindowIds?.() || [];\r\n        return {\r\n            modalIds,\r\n            transientModalIds: new Set(transientIds),\r\n        };\r\n    } else {\r\n        // Fallback\r\n        const modalIds = win.APP_CONSTANTS?.MODAL_IDS || [\r\n            'projects-modal',\r\n            'about-modal',\r\n            'settings-modal',\r\n            'text-modal',\r\n            'terminal-modal',\r\n            'image-modal',\r\n            'program-info-modal',\r\n        ];\r\n        const transientModalIds =\r\n            win.APP_CONSTANTS?.TRANSIENT_MODAL_IDS || new Set(['program-info-modal']);\r\n        return { modalIds, transientModalIds };\r\n    }\r\n}\r\n\r\n/**\r\n * Main application initialization function.\r\n * Called automatically on DOMContentLoaded.\r\n * Sets up dialog instances, ActionBus, and initializes all subsystems.\r\n */\r\nfunction initApp(): void {\r\n    const win = window as Window & GlobalModules & { WindowManager?: IWindowManager };\r\n    const funcs = window as Window & {\r\n        hideMenuDropdowns?: () => void;\r\n        bringDialogToFront?: (id: string) => void;\r\n        updateProgramLabelByTopModal?: () => void;\r\n        syncTopZIndexWithDOM?: () => void;\r\n        restoreWindowPositions?: () => void;\r\n        restoreOpenModals?: () => void;\r\n        initSystemStatusControls?: () => void;\r\n        initDesktop?: () => void;\r\n        initDockMagnification?: () => void;\r\n    };\r\n\r\n    // Modal-IDs initialisieren\r\n    const { modalIds } = initModalIds();\r\n\r\n    // ActionBus initialisieren\r\n    if (win.ActionBus) {\r\n        win.ActionBus.init?.();\r\n    }\r\n\r\n    // Wenn auf einen sichtbaren Modalcontainer geklickt wird, hole das Fenster in den Vordergrund\r\n    document.querySelectorAll('.modal').forEach(modal => {\r\n        modal.addEventListener('click', function (e) {\r\n            // Verhindere, dass Klicks auf interaktive Elemente im Modal den Fokuswechsel st\u00F6ren.\r\n            const target = e.target as Node;\r\n            if (e.target === modal || modal.contains(target)) {\r\n                funcs.hideMenuDropdowns?.();\r\n                funcs.bringDialogToFront?.(modal.id);\r\n                funcs.updateProgramLabelByTopModal?.();\r\n            }\r\n        });\r\n    });\r\n\r\n    // Dialog-Instanzen erstellen und im WindowManager registrieren\r\n    const dialogs = window.dialogs || {};\r\n    window.dialogs = dialogs;\r\n    if (modalIds && Array.isArray(modalIds)) {\r\n        modalIds.forEach(id => {\r\n            const modal = document.getElementById(id);\r\n            if (!modal || !win.Dialog) return;\r\n\r\n            try {\r\n                const dialogInstance = new win.Dialog(id);\r\n                dialogs[id] = dialogInstance as unknown as Record<string, unknown>;\r\n\r\n                // Im WindowManager registrieren\r\n                if (win.WindowManager) {\r\n                    win.WindowManager.setDialogInstance?.(id, dialogInstance);\r\n                }\r\n            } catch (err) {\r\n                console.error(`Failed to create dialog instance for \"${id}\":`, err);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Add click-outside-to-close functionality for launchpad\r\n    const launchpadModal = document.getElementById('launchpad-modal');\r\n    if (launchpadModal) {\r\n        // Primary: close when clicking outside the inner content within the modal wrapper.\r\n        launchpadModal.addEventListener('click', function (e) {\r\n            try {\r\n                const inner = launchpadModal.querySelector('.launchpad-modal-inner');\r\n                const target = e.target as Node;\r\n                if (inner ? !inner.contains(target) : target === launchpadModal) {\r\n                    const launchpadDialog = dialogs['launchpad-modal'] as { close?: () => void };\r\n                    launchpadDialog?.close?.();\r\n                }\r\n            } catch {\r\n                /* ignore */\r\n            }\r\n        });\r\n\r\n        // Fallback: capture-phase handler to close even when the wrapper has pointer-events:none\r\n        // and clicks are dispatched to underlying elements (e.g., tests using page.mouse.click).\r\n        document.addEventListener(\r\n            'click',\r\n            function (e) {\r\n                try {\r\n                    // Only act if launchpad is currently visible\r\n                    if (launchpadModal.classList.contains('hidden')) return;\r\n                    const inner = launchpadModal.querySelector('.launchpad-modal-inner');\r\n                    const target = e.target as Node;\r\n                    if (inner && inner.contains(target)) return; // clicked inside \u2192 ignore\r\n                    const launchpadDialog = dialogs['launchpad-modal'] as { close?: () => void };\r\n                    launchpadDialog?.close?.();\r\n                } catch {\r\n                    /* ignore */\r\n                }\r\n            },\r\n            true\r\n        );\r\n    }\r\n\r\n    funcs.syncTopZIndexWithDOM?.();\r\n    funcs.restoreWindowPositions?.();\r\n    // Suppress default init handlers while we restore previously open modals\r\n    (\r\n        window as unknown as { __SESSION_RESTORE_IN_PROGRESS?: boolean }\r\n    ).__SESSION_RESTORE_IN_PROGRESS = true;\r\n    funcs.restoreOpenModals?.();\r\n    funcs.initSystemStatusControls?.();\r\n\r\n    // Initialize desktop icons\r\n    if (win.DesktopSystem) {\r\n        win.DesktopSystem.initDesktop?.();\r\n    }\r\n\r\n    // Finder initialisieren nach Dialog-Setup\r\n    // DISABLED: Using Multi-Window FinderWindow instead of legacy FinderSystem\r\n    // if (win.FinderSystem && typeof win.FinderSystem.init === 'function') {\r\n    //     win.FinderSystem.init();\r\n    // }\r\n\r\n    // Initialize settings module\r\n    if (win.SettingsSystem) {\r\n        const settingsContainer = document.getElementById('settings-container');\r\n        if (settingsContainer) {\r\n            win.SettingsSystem.init?.(settingsContainer);\r\n        }\r\n    }\r\n\r\n    // Initialize text editor module\r\n    if (win.TextEditorSystem) {\r\n        const textEditorContainer = document.getElementById('text-editor-container');\r\n        if (textEditorContainer) {\r\n            win.TextEditorSystem.init?.(textEditorContainer);\r\n        }\r\n    }\r\n\r\n    // Initialize terminal module (legacy) only when multi\u2011instance is not available\r\n    // Prevents duplicate inputs causing E2E strict-mode locator conflicts\r\n    if (!win.TerminalInstanceManager && win.TerminalSystem) {\r\n        const terminalContainer = document.getElementById('terminal-container');\r\n        if (terminalContainer) {\r\n            win.TerminalSystem.init?.(terminalContainer);\r\n        }\r\n    }\r\n\r\n    funcs.initDockMagnification?.();\r\n    if (win.DockSystem && typeof win.DockSystem.initDockDragDrop === 'function') {\r\n        win.DockSystem.initDockDragDrop();\r\n    }\r\n\r\n    // Initialize WindowRegistry for multi-window system\r\n    if (win.WindowRegistry) {\r\n        win.WindowRegistry.init?.();\r\n    }\r\n\r\n    // Initialize Window menu (macOS-style menu for window management)\r\n    try {\r\n        initializeWindowMenu();\r\n    } catch (err) {\r\n        console.warn('[APP-INIT] Window menu initialization failed:', err);\r\n    }\r\n\r\n    // Initialize Multi-Window SessionManager\r\n    // Create a promise to track session restore completion (even if no session manager)\r\n    let sessionRestoreComplete: () => void = () => {};\r\n    const sessionRestorePromise = new Promise<void>(resolve => {\r\n        sessionRestoreComplete = resolve;\r\n    });\r\n    (window as any).__sessionRestorePromise = sessionRestorePromise;\r\n\r\n    if (win.MultiWindowSessionManager) {\r\n        try {\r\n            const multiCheck = validateMultiWindowSession();\r\n            const legacyCheck = validateLegacySession();\r\n\r\n            if (legacyCheck.shouldClear) {\r\n                console.warn('[APP-INIT] Clearing ONLY legacy session (corrupted)');\r\n                clearSessionKey('windowInstancesSession');\r\n            }\r\n\r\n            if (multiCheck.shouldClear) {\r\n                console.warn('[APP-INIT] Clearing multi-window session (corrupted)');\r\n                clearSessionKey('multi-window-session');\r\n            }\r\n\r\n            win.MultiWindowSessionManager.init?.();\r\n            console.log('[APP-INIT] MultiWindowSessionManager initialized');\r\n\r\n            // Attempt to restore multi-window session\r\n            setTimeout(async () => {\r\n                try {\r\n                    if (win.MultiWindowSessionManager?.restoreSession) {\r\n                        const restored = await win.MultiWindowSessionManager.restoreSession();\r\n                        if (restored) {\r\n                            console.log('[APP-INIT] Multi-window session restored');\r\n                        }\r\n                    }\r\n                } catch (err) {\r\n                    console.warn('[APP-INIT] Multi-window session restore failed:', err);\r\n                } finally {\r\n                    // Mark session restore as complete\r\n                    sessionRestoreComplete();\r\n                }\r\n            }, 150); // Delay to ensure all managers are ready\r\n        } catch (err) {\r\n            console.warn('[APP-INIT] MultiWindowSessionManager initialization failed:', err);\r\n            // Mark session restore as complete even on error\r\n            sessionRestoreComplete();\r\n        }\r\n    } else {\r\n        // No MultiWindowSessionManager, mark as complete immediately\r\n        sessionRestoreComplete();\r\n    }\r\n\r\n    // Initialize legacy SessionManager for auto-save and restore session if available\r\n    if (win.SessionManager) {\r\n        try {\r\n            win.SessionManager.init?.();\r\n            // Attempt to restore session after all managers are initialized\r\n            // This happens after Terminal/TextEditor managers are ready\r\n            setTimeout(() => {\r\n                try {\r\n                    if (win.SessionManager?.restoreSession) {\r\n                        win.SessionManager.restoreSession();\r\n                    }\r\n                } finally {\r\n                    // Mark restore finished so initHandlers can run normally again\r\n                    (\r\n                        window as unknown as {\r\n                            __SESSION_RESTORE_IN_PROGRESS?: boolean;\r\n                            __SESSION_RESTORE_DONE?: boolean;\r\n                        }\r\n                    ).__SESSION_RESTORE_IN_PROGRESS = false;\r\n                    (\r\n                        window as unknown as { __SESSION_RESTORE_DONE?: boolean }\r\n                    ).__SESSION_RESTORE_DONE = true;\r\n                }\r\n            }, 100); // Small delay to ensure all managers are ready\r\n        } catch (err) {\r\n            console.warn('SessionManager initialization failed:', err);\r\n        }\r\n    }\r\n\r\n    // Defensive: ensure the dock is visible. Some environments or timing races\r\n    // can leave the dock with hidden/display styles that make it \"invisible\"\r\n    // to Playwright checks. Remove any accidental 'hidden' class and reset\r\n    // inline visibility/display so tests can interact reliably.\r\n    try {\r\n        const dockEl = document.getElementById('dock');\r\n        if (dockEl) {\r\n            if (dockEl.classList.contains('hidden')) dockEl.classList.remove('hidden');\r\n            // Reset common inline properties that may hide the element\r\n            dockEl.style.display = dockEl.style.display || '';\r\n            dockEl.style.visibility = dockEl.style.visibility || 'visible';\r\n        }\r\n    } catch {\r\n        // non-fatal; continue startup\r\n    }\r\n\r\n    // Defensive DOM fix: if the dock has been accidentally placed inside a\r\n    // modal wrapper (for example due to malformed HTML or runtime reparenting),\r\n    // move it to document.body so it isn't affected by ancestor display:none\r\n    // which makes it invisible to Playwright. This is a low-risk, idempotent\r\n    // operation and keeps tests deterministic while the underlying HTML is\r\n    // corrected.\r\n    try {\r\n        const dockEl = document.getElementById('dock');\r\n        if (dockEl && dockEl.parentElement && dockEl.parentElement !== document.body) {\r\n            document.body.appendChild(dockEl);\r\n            console.info('[APP-INIT] moved #dock to document.body to avoid hidden ancestor(s)');\r\n        }\r\n    } catch {\r\n        /* ignore */\r\n    }\r\n\r\n    // Defensive: ensure all modal wrappers are direct children of <body>.\r\n    // This helps when malformed HTML accidentally nests modal wrappers\r\n    // inside each other which in turn causes computed display:none on\r\n    // ancestors and zero-sized geometry for centered content.\r\n    try {\r\n        const ensureModalsInBody = () => {\r\n            try {\r\n                const modals = Array.from(document.querySelectorAll('.modal')) as HTMLElement[];\r\n                let moved = false;\r\n                modals.forEach(m => {\r\n                    if (m.parentElement && m.parentElement !== document.body) {\r\n                        document.body.appendChild(m);\r\n                        moved = true;\r\n                    }\r\n                });\r\n                if (moved)\r\n                    console.info(\r\n                        '[APP-INIT] reparented misplaced .modal elements to document.body'\r\n                    );\r\n                return moved;\r\n            } catch {\r\n                return false;\r\n            }\r\n        };\r\n\r\n        ensureModalsInBody();\r\n        setTimeout(ensureModalsInBody, 50);\r\n        setTimeout(ensureModalsInBody, 200);\r\n        setTimeout(ensureModalsInBody, 500);\r\n    } catch {\r\n        /* ignore */\r\n    }\r\n\r\n    // Debugging: log some runtime info about the dock so E2E traces show why\r\n    // Playwright may mark it hidden; include computed styles and dimensions.\r\n    try {\r\n        const dockEl = document.getElementById('dock');\r\n        if (dockEl) {\r\n            const rect = dockEl.getBoundingClientRect();\r\n            const cs = window.getComputedStyle(dockEl);\r\n            console.info('[APP-INIT] Dock debug:', {\r\n                className: dockEl.className,\r\n                display: cs.display,\r\n                visibility: cs.visibility,\r\n                opacity: cs.opacity,\r\n                width: rect.width,\r\n                height: rect.height,\r\n                top: rect.top,\r\n                left: rect.left,\r\n                inViewport: rect.top < (window.innerHeight || 0) && rect.bottom > 0,\r\n            });\r\n            // Also write these values into a data attribute so E2E snapshots and\r\n            // traces (which may not include console output) can inspect the\r\n            // runtime state of the dock element.\r\n            try {\r\n                const dbg = JSON.stringify({\r\n                    className: dockEl.className,\r\n                    display: cs.display,\r\n                    visibility: cs.visibility,\r\n                    opacity: cs.opacity,\r\n                    width: Math.round(rect.width),\r\n                    height: Math.round(rect.height),\r\n                    top: Math.round(rect.top),\r\n                    left: Math.round(rect.left),\r\n                    inViewport: rect.top < (window.innerHeight || 0) && rect.bottom > 0,\r\n                });\r\n                dockEl.setAttribute('data-dock-debug', dbg);\r\n            } catch {\r\n                /* swallow */\r\n            }\r\n        } else {\r\n            console.info('[APP-INIT] Dock debug: element not found');\r\n        }\r\n    } catch (e) {\r\n        console.warn('[APP-INIT] Dock debug failed', e);\r\n    }\r\n\r\n    // Signal that the app is ready for E2E tests.\r\n    // Important: delay setting __APP_READY until the full page load event\r\n    // so that later scripts (for example the legacy `app.js` included\r\n    // after this file) have a chance to run and not hide UI elements\r\n    // after tests consider the app ready.\r\n    const gw = window as Window & { __APP_READY?: boolean };\r\n    async function markReady() {\r\n        try {\r\n            // Wait for session restore to complete before marking ready\r\n            const sessionRestorePromise = (window as any).__sessionRestorePromise;\r\n            if (sessionRestorePromise) {\r\n                try {\r\n                    await sessionRestorePromise;\r\n                    console.log('[APP-INIT] Waited for session restore before marking ready');\r\n                } catch (e) {\r\n                    console.warn('[APP-INIT] Session restore wait failed:', e);\r\n                }\r\n            }\r\n\r\n            // At load time, ensure the dock is placed under document.body so\r\n            // any legacy scripts that reparent early don't leave it inside a\r\n            // hidden modal. Do this right before signaling readiness so tests\r\n            // observe the final DOM state.\r\n            const ensureDockInBody = () => {\r\n                try {\r\n                    const dockEl = document.getElementById('dock');\r\n                    if (dockEl && dockEl.parentElement && dockEl.parentElement !== document.body) {\r\n                        document.body.appendChild(dockEl);\r\n                        console.info('[APP-INIT] moved #dock to document.body (ensured at load)');\r\n                        return true;\r\n                    }\r\n                } catch {\r\n                    /* ignore */\r\n                }\r\n                return false;\r\n            };\r\n\r\n            // Try immediately and a few times after small delays to survive other\r\n            // scripts that may reparent DOM nodes during startup.\r\n            ensureDockInBody();\r\n            setTimeout(ensureDockInBody, 50);\r\n            setTimeout(ensureDockInBody, 200);\r\n            setTimeout(ensureDockInBody, 500);\r\n\r\n            // =====================================================================\r\n            // PHASE 1: Expose system singletons for E2E tests and inter-module access\r\n            // =====================================================================\r\n            // Make core system objects globally available so:\r\n            // 1. E2E tests can query application state\r\n            // 2. Legacy JS modules can access new TS systems\r\n            // 3. Debugging and introspection becomes possible\r\n\r\n            const gw2 = window as any;\r\n\r\n            // VirtualFS - Expose for terminal and finder state introspection\r\n            if (typeof gw2.VirtualFS === 'undefined' && gw2.__VirtualFS === undefined) {\r\n                try {\r\n                    // VirtualFS is imported in terminal-session.ts, but we need a global reference\r\n                    // Try to locate it through existing systems\r\n                    const getVFS = () => {\r\n                        // Check if any TerminalSession has VirtualFS accessible\r\n                        if (gw2.TerminalInstanceManager?.getActiveSession?.()) {\r\n                            // VirtualFS will be available through the session context\r\n                            return true;\r\n                        }\r\n                        return false;\r\n                    };\r\n                    // Mark that VirtualFS should be accessible\r\n                    gw2.__VirtualFS_Ready = getVFS();\r\n                    console.info('[APP-INIT] VirtualFS state made queryable');\r\n                } catch (e) {\r\n                    console.debug('[APP-INIT] VirtualFS exposure skipped:', (e as Error).message);\r\n                }\r\n            }\r\n\r\n            // WindowRegistry - Expose for window/tab introspection\r\n            if (gw2.WindowRegistry) {\r\n                gw2.__WindowRegistry = gw2.WindowRegistry;\r\n                console.info('[APP-INIT] WindowRegistry exposed as __WindowRegistry');\r\n            }\r\n\r\n            // FinderSystem - Expose for finder operations\r\n            if (gw2.FinderSystem) {\r\n                gw2.__FinderSystem = gw2.FinderSystem;\r\n                console.info('[APP-INIT] FinderSystem exposed as __FinderSystem');\r\n            }\r\n\r\n            // TerminalSystem - Expose for terminal operations\r\n            if (gw2.TerminalSystem) {\r\n                gw2.__TerminalSystem = gw2.TerminalSystem;\r\n                console.info('[APP-INIT] TerminalSystem exposed as __TerminalSystem');\r\n            }\r\n\r\n            // LaunchpadSystem - Expose for launchpad operations\r\n            if (gw2.LaunchpadSystem) {\r\n                gw2.__LaunchpadSystem = gw2.LaunchpadSystem;\r\n                console.info('[APP-INIT] LaunchpadSystem exposed as __LaunchpadSystem');\r\n            }\r\n\r\n            // SettingsSystem - Expose for settings operations\r\n            if (gw2.SettingsSystem) {\r\n                gw2.__SettingsSystem = gw2.SettingsSystem;\r\n                console.info('[APP-INIT] SettingsSystem exposed as __SettingsSystem');\r\n            }\r\n\r\n            // SessionManager - Already exposed by legacy JS, but ensure it's available\r\n            if (gw2.SessionManager) {\r\n                console.info('[APP-INIT] SessionManager available (legacy)');\r\n            }\r\n\r\n            // DockSystem - Expose for dock operations\r\n            if (gw2.DockSystem) {\r\n                gw2.__DockSystem = gw2.DockSystem;\r\n                console.info('[APP-INIT] DockSystem exposed as __DockSystem');\r\n            }\r\n\r\n            // ActionBus - Expose for action dispatch\r\n            if (gw2.ActionBus) {\r\n                gw2.__ActionBus = gw2.ActionBus;\r\n                console.info('[APP-INIT] ActionBus exposed as __ActionBus');\r\n            }\r\n\r\n            // =====================================================================\r\n            // PHASE 2: Legacy InstanceManager Compatibility Shims (Finder)\r\n            // =====================================================================\r\n            if (typeof gw2.FinderInstanceManager === 'undefined') {\r\n                try {\r\n                    const registry = gw2.WindowRegistry;\r\n                    installShim(\r\n                        {\r\n                            legacyName: 'FinderInstanceManager',\r\n                            registryType: 'finder',\r\n                            createInstance(opts?: { title?: string }) {\r\n                                try {\r\n                                    const windows = registry.getAllWindows('finder') || [];\r\n                                    const firstWindow = windows[0];\r\n                                    if (firstWindow && typeof firstWindow.addTab === 'function') {\r\n                                        const tabView = gw2.FinderView\r\n                                            ? new gw2.FinderView({\r\n                                                  title: opts?.title || 'Computer',\r\n                                                  source: 'computer',\r\n                                              })\r\n                                            : null;\r\n                                        if (tabView) {\r\n                                            firstWindow.addTab(tabView);\r\n                                            return {\r\n                                                instanceId: tabView.id,\r\n                                                type: 'finder',\r\n                                                title: tabView.title,\r\n                                            };\r\n                                        }\r\n                                    }\r\n                                    return null;\r\n                                } catch (e) {\r\n                                    console.warn(\r\n                                        '[FinderInstanceManager shim] createInstance failed:',\r\n                                        e\r\n                                    );\r\n                                    return null;\r\n                                }\r\n                            },\r\n                            getInstanceCount() {\r\n                                try {\r\n                                    const windows = registry.getAllWindows('finder') || [];\r\n                                    let totalTabs = 0;\r\n                                    windows.forEach((win: any) => {\r\n                                        if (win.tabs && typeof win.tabs.size === 'number') {\r\n                                            totalTabs += win.tabs.size;\r\n                                        }\r\n                                    });\r\n                                    return totalTabs;\r\n                                } catch {\r\n                                    return 0;\r\n                                }\r\n                            },\r\n                            getAllInstances() {\r\n                                try {\r\n                                    const windows = registry.getAllWindows('finder') || [];\r\n                                    const allTabs: any[] = [];\r\n                                    windows.forEach((win: any) => {\r\n                                        if (win.tabs && typeof win.tabs.values === 'function') {\r\n                                            const tabs = Array.from(win.tabs.values());\r\n                                            tabs.forEach((tab: any) => {\r\n                                                allTabs.push({\r\n                                                    instanceId: tab.id,\r\n                                                    type: 'finder',\r\n                                                    title: tab.title || 'Finder',\r\n                                                    show: () => tab.show?.(),\r\n                                                    hide: () => tab.hide?.(),\r\n                                                });\r\n                                            });\r\n                                        }\r\n                                    });\r\n                                    return allTabs;\r\n                                } catch {\r\n                                    return [];\r\n                                }\r\n                            },\r\n                            getActiveInstance() {\r\n                                try {\r\n                                    const activeWindow = registry.getActiveWindow();\r\n                                    if (activeWindow && activeWindow.type === 'finder') {\r\n                                        const finderWindow = activeWindow as any;\r\n                                        if (finderWindow.activeTabId && finderWindow.tabs) {\r\n                                            const activeTab = finderWindow.tabs.get(\r\n                                                finderWindow.activeTabId\r\n                                            );\r\n                                            if (activeTab) {\r\n                                                return {\r\n                                                    instanceId: activeTab.id,\r\n                                                    type: 'finder',\r\n                                                    title: activeTab.title || 'Finder',\r\n                                                };\r\n                                            }\r\n                                        }\r\n                                    }\r\n\r\n                                    const windows = registry.getAllWindows('finder') || [];\r\n                                    for (const win of windows) {\r\n                                        const w = win as any;\r\n                                        if (w.isVisible && w.isVisible()) {\r\n                                            if (w.activeTabId && w.tabs) {\r\n                                                const activeTab = w.tabs.get(w.activeTabId);\r\n                                                if (activeTab) {\r\n                                                    return {\r\n                                                        instanceId: activeTab.id,\r\n                                                        type: 'finder',\r\n                                                        title: activeTab.title || 'Finder',\r\n                                                    };\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                    }\r\n\r\n                                    if (windows.length > 0) {\r\n                                        const firstWindow = windows[0] as any;\r\n                                        if (firstWindow.activeTabId && firstWindow.tabs) {\r\n                                            const activeTab = firstWindow.tabs.get(\r\n                                                firstWindow.activeTabId\r\n                                            );\r\n                                            if (activeTab) {\r\n                                                return {\r\n                                                    instanceId: activeTab.id,\r\n                                                    type: 'finder',\r\n                                                    title: activeTab.title || 'Finder',\r\n                                                };\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                    return null;\r\n                                } catch (e) {\r\n                                    console.warn(\r\n                                        '[FinderInstanceManager shim] getActiveInstance failed:',\r\n                                        e\r\n                                    );\r\n                                    return null;\r\n                                }\r\n                            },\r\n                            setActiveInstance(instanceId: string) {\r\n                                try {\r\n                                    const windows = registry.getAllWindows('finder') || [];\r\n                                    for (const win of windows) {\r\n                                        if ((win as any).tabs?.has(instanceId)) {\r\n                                            (win as any).setActiveTab?.(instanceId);\r\n                                            registry.setActiveWindow(win.id);\r\n                                            return;\r\n                                        }\r\n                                    }\r\n                                } catch (e) {\r\n                                    console.warn(\r\n                                        '[FinderInstanceManager shim] setActiveInstance failed:',\r\n                                        e\r\n                                    );\r\n                                }\r\n                            },\r\n                        },\r\n                        gw2\r\n                    );\r\n                } catch (e) {\r\n                    console.warn('[APP-INIT] FinderInstanceManager shim failed:', e);\r\n                }\r\n            }\r\n\r\n            gw.__APP_READY = true;\r\n            console.info('[APP-INIT] __APP_READY=true');\r\n            // After marking ready, some systems may initialize a few ticks later\r\n            // (race with other scripts). Retry exposing singletons a few times so\r\n            // E2E tests can reliably find them even if they appear slightly\r\n            // after load. This is intentionally conservative and idempotent.\r\n            (function scheduleExposureRetries() {\r\n                const attempts = [50, 200, 500, 1000, 2000];\r\n                const exposeOnce = () => {\r\n                    try {\r\n                        const g = window as any;\r\n                        const ensureAlias = (name: string, legacyName?: string) => {\r\n                            try {\r\n                                const real = g[name] || g[legacyName || name];\r\n                                if (real) {\r\n                                    // expose as both legacy and __ alias\r\n                                    if (typeof g[legacyName || name] === 'undefined') {\r\n                                        g[legacyName || name] = real;\r\n                                    }\r\n                                    const alias = `__${name}`;\r\n                                    if (typeof g[alias] === 'undefined') {\r\n                                        g[alias] = real;\r\n                                    }\r\n                                }\r\n                            } catch {\r\n                                /* ignore */\r\n                            }\r\n                        };\r\n\r\n                        // List of systems to ensure exposure for\r\n                        [\r\n                            'WindowRegistry',\r\n                            'FinderSystem',\r\n                            'TerminalSystem',\r\n                            'LaunchpadSystem',\r\n                            'SettingsSystem',\r\n                            'DockSystem',\r\n                            'ActionBus',\r\n                            'SessionManager',\r\n                        ].forEach(n => ensureAlias(n));\r\n                    } catch {\r\n                        /* swallow */\r\n                    }\r\n                };\r\n\r\n                // Run initial attempt synchronously then schedule retries\r\n                exposeOnce();\r\n                attempts.forEach(t => setTimeout(exposeOnce, t));\r\n            })();\r\n        } catch {\r\n            /* swallow */\r\n        }\r\n    }\r\n\r\n    if (document.readyState === 'complete') {\r\n        // load already fired\r\n        markReady();\r\n    } else {\r\n        window.addEventListener('load', markReady, { once: true });\r\n        // Fallback: if the load event doesn't fire (e.g., due to a blocked resource)\r\n        // make sure tests can proceed by marking ready after a short grace period.\r\n        setTimeout(() => {\r\n            if (!gw.__APP_READY) {\r\n                console.warn(\r\n                    '[APP-INIT] load event not observed within timeout; forcing __APP_READY'\r\n                );\r\n                markReady();\r\n            }\r\n        }, 4000);\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// IIFE Export Pattern - Expose initApp globally and auto-attach to DOMContentLoaded\r\n// ============================================================================\r\n\r\n(() => {\r\n    if (typeof window.initApp !== 'function') {\r\n        window.initApp = initApp;\r\n    }\r\n\r\n    // Auto-attach to DOMContentLoaded\r\n    if (document.readyState === 'loading') {\r\n        document.addEventListener('DOMContentLoaded', initApp);\r\n    } else {\r\n        // DOMContentLoaded already fired, run immediately\r\n        initApp();\r\n    }\r\n})();\r\n", "/*\r\n * src/ts/compat/expose-globals.ts\r\n * Central adapter to expose modern TS modules on window for legacy consumers.\r\n * This file is used as the single esbuild entry to produce an IIFE bundle.\r\n */\r\n\r\nconsole.log('[BUNDLE] expose-globals.ts loading...');\r\n\r\n// i18n must load FIRST - provides window.appI18n for all modules\r\nimport '../services/i18n';\r\n\r\n// Import the modern module(s) we want to expose explicitly\r\nimport * as DOMUtils from '../ui/dom-utils';\r\n\r\n// Import core constants first (needed by storage, app-init, etc.)\r\nimport '../core/constants';\r\n\r\n// Import core observability systems (error handling, performance monitoring)\r\nimport '../core/logger';\r\nimport '../core/error-handler';\r\nimport '../core/perf-monitor';\r\n\r\n// Import legacy/global modules for their side effects so they register on window.*\r\nimport '../core/api';\r\nimport '../windows/window-manager';\r\nimport '../ui/action-bus';\r\nimport '../ui/dialog-utils';\r\nimport '../ui/snap-utils';\r\nimport '../services/program-actions';\r\nimport '../services/program-menu-sync';\r\nimport '../ui/menu';\r\nimport '../ui/dock';\r\nimport '../ui/dialog';\r\nimport '../ui/menubar-utils';\r\nimport '../ui/context-menu';\r\nimport '../services/storage';\r\nimport '../services/theme';\r\nimport '../windows/base-window-instance'; // Must come before instance types\r\nimport '../windows/instance-manager';\r\nimport '../windows/window-chrome';\r\n\r\n// Multi-window system (Phase 1: Foundation)\r\nimport '../windows/base-tab'; // Base class for tab content\r\nimport '../windows/base-window'; // Base class for windows\r\nimport '../windows/window-registry'; // Central window management\r\n\r\n// Multi-window system (Phase 2: Terminal)\r\nimport '../apps/terminal/terminal-session'; // Terminal session tab\r\nimport { TerminalWindow as __TerminalWindow__ } from '../apps/terminal/terminal-window'; // Terminal window\r\n\r\n// Multi-window system (Phase 3: TextEditor)\r\nimport '../apps/text-editor/text-editor-document'; // Text editor document tab\r\nimport '../apps/text-editor/text-editor-window'; // Text editor window\r\nimport '../apps/text-editor/text-editor-instance'; // Text editor instance manager\r\n\r\n// Multi-window system (Phase 4: Finder)\r\n// Import both side-effect and named to ensure symbols are retained and exposed\r\nimport { FinderView as __FinderView__ } from '../apps/finder/finder-view'; // Finder view tab\r\nimport { FinderWindow as __FinderWindow__ } from '../apps/finder/finder-window'; // Finder window\r\n\r\n// Multi-window system (Phase 6: Session Management)\r\nimport '../services/multi-window-session'; // Multi-window session persistence\r\nimport '../services/session-manager'; // Auto-save system for instances - MUST come AFTER all instance managers\r\n\r\nimport '../windows/window-tabs';\r\nimport '../apps/terminal/terminal-instance';\r\nimport '../apps/text-editor/text-editor';\r\nimport '../services/settings';\r\nimport '../apps/photos/image-viewer-utils';\r\nimport '../core/logger';\r\nimport '../ui/keyboard-shortcuts';\r\nimport '../services/github-api';\r\n// Include compiled Photos App JS into the bundle to expose window.PhotosApp\r\n// Using the compiled JS avoids TS encoding issues and ensures identical runtime behavior\r\nimport '../apps/photos/photos-app';\r\n\r\n// Window configurations (now in TypeScript)\r\nimport '../windows/window-configs'; // Must load before windows are registered\r\n// Remaining legacy JS modules (to be ported)\r\nimport '../apps/finder/finder-instance';\r\nimport '../ui/launchpad';\r\nimport '../windows/multi-instance-integration';\r\nimport '../ui/desktop'; // Now in TypeScript\r\n// Use modern TypeScript module instead of legacy JS\r\nimport '../services/system';\r\n\r\n// Finally, include the TypeScript app initialization to bootstrap and signal readiness\r\n// This sets window.__APP_READY = true when the app finishes loading. It must come\r\n// AFTER all side-effect imports above so that globals like WindowManager/Dialog exist.\r\nimport '../core/app-init';\r\n\r\n// Guarded attach for modern modules not yet on window\r\ntype WindowWithBundle = Window & { __BUNDLE_READY__?: boolean; initApp?: () => void } & Record<\r\n        string,\r\n        unknown\r\n    >;\r\nconst w = window as unknown as WindowWithBundle;\r\n\r\nif (!('DOMUtils' in w)) {\r\n    w['DOMUtils'] = DOMUtils;\r\n}\r\n\r\n// Ensure critical classes are attached on window and not eliminated by tree-shaking\r\ntry {\r\n    if (!(w as any).FinderView) (w as any).FinderView = __FinderView__;\r\n    if (!(w as any).FinderWindow) (w as any).FinderWindow = __FinderWindow__;\r\n    if (!(w as any).TerminalWindow) (w as any).TerminalWindow = __TerminalWindow__;\r\n} catch {\r\n    /* ignore */\r\n}\r\n\r\ntry {\r\n    console.log('[BUNDLE] Globals present:', {\r\n        FinderView: !!(w as any).FinderView,\r\n        FinderWindow: !!(w as any).FinderWindow,\r\n        TerminalWindow: !!(w as any).TerminalWindow,\r\n        WindowRegistry: !!(w as any).WindowRegistry,\r\n        ActionBus: !!(w as any).ActionBus,\r\n    });\r\n} catch {\r\n    /* ignore */\r\n}\r\n\r\n// Trigger app initialization manually since the IIFE in app-init.ts\r\n// runs in module scope and may not execute due to esbuild bundling\r\nif (typeof w.initApp === 'function') {\r\n    console.log('[BUNDLE] Triggering initApp; readyState:', document.readyState);\r\n    if (document.readyState === 'loading') {\r\n        document.addEventListener('DOMContentLoaded', w.initApp);\r\n    } else {\r\n        w.initApp();\r\n    }\r\n} else {\r\n    console.error('[BUNDLE] window.initApp is not defined; app initialization failed');\r\n}\r\n\r\n// Optional ready flag for tests\r\nw.__BUNDLE_READY__ = true;\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAMa;AANb;AAAA;AAAA;AAMO,MAAM,KAAK;AAAA,QACd,SAAS;AAAA,UACL,WAAW;AAAA,UACX,MAAM;AAAA,UACN,YAAY;AAAA,UACZ,gBAAgB;AAAA,UAChB,cAAc;AAAA,UACd,cAAc;AAAA,UACd,gBAAgB;AAAA,UAChB,OAAO;AAAA,UACP,OAAO;AAAA,YACH,WAAW;AAAA,YACX,MAAM;AAAA,UACV;AAAA,UACA,QAAQ;AAAA,YACJ,UAAU;AAAA,YACV,SAAS;AAAA,YACT,SAAS;AAAA,YACT,WAAW;AAAA,YACX,UAAU;AAAA,YACV,UAAU;AAAA,YACV,YAAY;AAAA,YACZ,YAAY;AAAA,YACZ,YAAY;AAAA,UAChB;AAAA,QACJ;AAAA,QACA,QAAQ;AAAA,UACJ,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,QAAQ;AAAA,UACR,SAAS;AAAA,QACb;AAAA,QACA,QAAQ;AAAA,UACJ,SAAS;AAAA,YACL,OAAO;AAAA,YACP,aAAa;AAAA,YACb,UAAU;AAAA,YACV,UAAU;AAAA,UACd;AAAA,UACA,SAAS;AAAA,YACL,OAAO;AAAA,UACX;AAAA,QACJ;AAAA,QACA,SAAS;AAAA,UACL,QAAQ;AAAA,UACR,UAAU;AAAA,UACV,QAAQ;AAAA,UACR,MAAM;AAAA,UACN,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,UAAU;AAAA,UACV,OAAO;AAAA,UACP,WAAW;AAAA,UACX,UAAU;AAAA,QACd;AAAA,QACA,MAAM;AAAA,UACF,QAAQ;AAAA,UACR,UAAU;AAAA,UACV,MAAM;AAAA,UACN,OAAO;AAAA,UACP,UAAU;AAAA,UACV,WAAW;AAAA,UACX,UAAU;AAAA,QACd;AAAA,QACA,SAAS;AAAA,UACL,WAAW;AAAA,YACP,OAAO;AAAA,UACX;AAAA,UACA,kBAAkB;AAAA,UAClB,eAAe;AAAA,YACX,OAAO;AAAA,YACP,cAAc;AAAA,YACd,kBAAkB;AAAA,YAClB,YAAY;AAAA,YACZ,QAAQ;AAAA,UACZ;AAAA,UACA,SAAS;AAAA,YACL,MAAM;AAAA,YACN,YAAY;AAAA,YACZ,WAAW;AAAA,YACX,iBAAiB;AAAA,YACjB,OAAO;AAAA,YACP,UAAU;AAAA,UACd;AAAA,UACA,MAAM;AAAA,YACF,mBAAmB;AAAA,UACvB;AAAA,UACA,WAAW;AAAA,YACP,SAAS;AAAA,YACT,SAAS;AAAA,YACT,UAAU;AAAA,YACV,SAAS;AAAA,UACb;AAAA,UACA,OAAO;AAAA,YACH,OAAO;AAAA,YACP,eAAe;AAAA,YACf,SAAS;AAAA,cACL,UAAU;AAAA,cACV,SAAS;AAAA,cACT,SAAS;AAAA,YACb;AAAA,UACJ;AAAA,UACA,UAAU;AAAA,YACN,MAAM;AAAA,YACN,QAAQ;AAAA,YACR,SAAS;AAAA,UACb;AAAA,UACA,OAAO;AAAA,YACH,IAAI;AAAA,YACJ,KAAK;AAAA,YACL,QAAQ;AAAA,YACR,WAAW;AAAA,YACX,OAAO;AAAA,YACP,cAAc;AAAA,YACd,SAAS;AAAA,YACT,WAAW;AAAA,UACf;AAAA,UACA,SAAS;AAAA,YACL,iBAAiB;AAAA,YACjB,mBAAmB;AAAA,YACnB,eAAe;AAAA,YACf,WAAW;AAAA,YACX,MAAM;AAAA,UACV;AAAA,UACA,SAAS;AAAA,YACL,OAAO;AAAA,YACP,WAAW;AAAA,UACf;AAAA,QACJ;AAAA,QACA,QAAQ;AAAA,UACJ,UAAU;AAAA,YACN,OAAO;AAAA,YACP,cAAc;AAAA,YACd,aAAa;AAAA,UACjB;AAAA,UACA,OAAO;AAAA,YACH,OAAO;AAAA,YACP,OAAO;AAAA,YACP,eAAe;AAAA,YACf,eAAe;AAAA,YACf,UAAU;AAAA,YACV,UAAU;AAAA,YACV,eAAe;AAAA,YACf,eAAe;AAAA,YACf,YAAY;AAAA,YACZ,WAAW;AAAA,UACf;AAAA,UACA,UAAU;AAAA,YACN,OAAO;AAAA,UACX;AAAA,UACA,MAAM;AAAA,YACF,OAAO;AAAA,UACX;AAAA,UACA,OAAO;AAAA,YACH,OAAO;AAAA,YACP,aAAa;AAAA,UACjB;AAAA,UACA,QAAQ;AAAA,YACJ,OAAO;AAAA,UACX;AAAA,UACA,aAAa;AAAA,YACT,OAAO;AAAA,UACX;AAAA,UACA,WAAW;AAAA,YACP,OAAO;AAAA,YACP,mBAAmB;AAAA,UACvB;AAAA,UACA,UAAU;AAAA,YACN,OAAO;AAAA,UACX;AAAA,QACJ;AAAA,QACA,QAAQ;AAAA,UACJ,OAAO;AAAA,UACP,OAAO;AAAA,UACP,SAAS;AAAA,YACL,SAAS;AAAA,YACT,SAAS;AAAA,YACT,SAAS;AAAA,YACT,YAAY;AAAA,YACZ,OAAO;AAAA,cACH,KAAK;AAAA,cACL,WAAW;AAAA,cACX,WAAW;AAAA,cACX,UAAU;AAAA,cACV,QAAQ;AAAA,YACZ;AAAA,UACJ;AAAA,UACA,UAAU;AAAA,YACN,SAAS;AAAA,YACT,aAAa;AAAA,YACb,OAAO;AAAA,UACX;AAAA,UACA,QAAQ;AAAA,YACJ,aAAa;AAAA,YACb,OAAO;AAAA,UACX;AAAA,UACA,QAAQ;AAAA,YACJ,kBAAkB;AAAA,YAClB,SAAS;AAAA,YACT,OAAO;AAAA,UACX;AAAA,UACA,QAAQ;AAAA,YACJ,SAAS;AAAA,YACT,aAAa;AAAA,YACb,aAAa;AAAA,UACjB;AAAA,UACA,SAAS;AAAA,YACL,OAAO;AAAA,UACX;AAAA,UACA,OAAO;AAAA,YACH,OAAO;AAAA,YACP,aAAa;AAAA,UACjB;AAAA,UACA,aAAa;AAAA,UACb,QAAQ;AAAA,YACJ,eAAe;AAAA,YACf,aAAa;AAAA,YACb,gBAAgB;AAAA,YAChB,qBAAqB;AAAA,YACrB,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ;AAAA,YACR,MAAM;AAAA,YACN,MAAM;AAAA,YACN,UAAU;AAAA,YACV,cAAc;AAAA,YACd,qBAAqB;AAAA,YACrB,eAAe;AAAA,YACf,YAAY;AAAA,YACZ,kBAAkB;AAAA,YAClB,iBAAiB;AAAA,YACjB,SAAS;AAAA,YACT,cAAc;AAAA,UAClB;AAAA,UACA,cAAc;AAAA,YACV,WAAW;AAAA,YACX,UAAU;AAAA,YACV,QAAQ;AAAA,UACZ;AAAA,UACA,aAAa;AAAA,YACT,WAAW;AAAA,YACX,UAAU;AAAA,YACV,QAAQ;AAAA,UACZ;AAAA,UACA,QAAQ;AAAA,YACJ,eAAe;AAAA,YACf,aAAa;AAAA,UACjB;AAAA,UACA,SAAS;AAAA,YACL,KAAK;AAAA,UACT;AAAA,QACJ;AAAA,QACA,QAAQ;AAAA,UACJ,SAAS;AAAA,YACL,MAAM;AAAA,YACN,SAAS;AAAA,YACT,UAAU;AAAA,YACV,UAAU;AAAA,YACV,QAAQ;AAAA,UACZ;AAAA,UACA,SAAS;AAAA,YACL,WAAW;AAAA,YACX,MAAM;AAAA,YACN,UAAU;AAAA,YACV,QAAQ;AAAA,YACR,WAAW;AAAA,YACX,QAAQ;AAAA,YACR,SAAS;AAAA,UACb;AAAA,UACA,MAAM;AAAA,UACN,aAAa;AAAA,UACb,YAAY;AAAA,UACZ,cAAc;AAAA,UACd,gBAAgB;AAAA,UAChB,gBAAgB;AAAA,UAChB,gBAAgB;AAAA,UAChB,mBAAmB;AAAA,UACnB,wBAAwB;AAAA,UACxB,aAAa;AAAA,UACb,cAAc;AAAA,UACd,gBAAgB;AAAA,UAChB,qBACI;AAAA,UACJ,eAAe;AAAA,UACf,WAAW;AAAA,UACX,cAAc;AAAA,QAClB;AAAA,QACA,UAAU;AAAA,UACN,SAAS;AAAA,YACL,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,QAAQ;AAAA,YACJ,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,UAAU;AAAA,YACN,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,UAAU;AAAA,YACN,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,MAAM;AAAA,YACF,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,OAAO;AAAA,YACH,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,QAAQ;AAAA,YACJ,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,OAAO;AAAA,YACH,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,WAAW;AAAA,YACP,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,UAAU;AAAA,YACN,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,SAAS;AAAA,YACL,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,QACJ;AAAA,QACA,YAAY;AAAA,UACR,OAAO;AAAA,UACP,eAAe;AAAA,UACf,uBAAuB;AAAA,UACvB,SAAS;AAAA,YACL,MAAM;AAAA,YACN,QAAQ;AAAA,YACR,WAAW;AAAA,YACX,eAAe;AAAA,YACf,UAAU;AAAA,YACV,UAAU;AAAA,YACV,UAAU;AAAA,YACV,eAAe;AAAA,YACf,aAAa;AAAA,YACb,WAAW;AAAA,YACX,aAAa;AAAA,YACb,YAAY;AAAA,YACZ,YAAY;AAAA,YACZ,aAAa;AAAA,YACb,MAAM;AAAA,YACN,MAAM;AAAA,YACN,OAAO;AAAA,YACP,MAAM;AAAA,YACN,MAAM;AAAA,UACV;AAAA,UACA,aAAa;AAAA,YACT,MAAM;AAAA,YACN,SAAS;AAAA,YACT,MAAM;AAAA,YACN,YAAY;AAAA,YACZ,YAAY;AAAA,YACZ,OAAO;AAAA,YACP,SAAS;AAAA,YACT,eAAe;AAAA,UACnB;AAAA,UACA,QAAQ;AAAA,YACJ,SAAS;AAAA,YACT,kBAAkB;AAAA,YAClB,WAAW;AAAA,YACX,WAAW;AAAA,YACX,WAAW;AAAA,YACX,UAAU;AAAA,UACd;AAAA,QACJ;AAAA,QACA,MAAM;AAAA,UACF,UAAU;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,QAAQ;AAAA,YACR,MAAM;AAAA,UACV;AAAA,UACA,QAAQ;AAAA,YACJ,WAAW;AAAA,YACX,QAAQ;AAAA,YACR,OAAO;AAAA,YACP,MAAM;AAAA,UACV;AAAA,UACA,UAAU;AAAA,YACN,OAAO;AAAA,YACP,MAAM;AAAA,UACV;AAAA,UACA,MAAM;AAAA,YACF,SAAS;AAAA,YACT,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,KAAK;AAAA,YACL,MAAM;AAAA,YACN,OAAO;AAAA,YACP,WAAW;AAAA,YACX,YAAY;AAAA,YACZ,MAAM;AAAA,UACV;AAAA,UACA,OAAO;AAAA,YACH,WAAW;AAAA,YACX,WAAW;AAAA,YACX,OAAO;AAAA,YACP,MAAM;AAAA,UACV;AAAA,UACA,UAAU;AAAA,YACN,WAAW;AAAA,YACX,OAAO;AAAA,YACP,OAAO;AAAA,YACP,MAAM;AAAA,YACN,QAAQ;AAAA,YACR,cAAc;AAAA,YACd,UAAU;AAAA,YACV,aAAa;AAAA,YACb,MAAM;AAAA,YACN,OAAO;AAAA,YACP,WAAW;AAAA,UACf;AAAA,UACA,OAAO;AAAA,YACH,OAAO;AAAA,YACP,MAAM;AAAA,UACV;AAAA,UACA,aAAa;AAAA,YACT,OAAO;AAAA,UACX;AAAA,UACA,QAAQ;AAAA,YACJ,UAAU;AAAA,YACV,MAAM;AAAA,YACN,cAAc;AAAA,YACd,OAAO;AAAA,YACP,UAAU;AAAA,YACV,aAAa;AAAA,YACb,WAAW;AAAA,YACX,aAAa;AAAA,YACb,WAAW;AAAA,YACX,iBAAiB;AAAA,UACrB;AAAA,UACA,SAAS;AAAA,YACL,QAAQ;AAAA,YACR,QAAQ;AAAA,YACR,eAAe;AAAA,YACf,eAAe;AAAA,YACf,aAAa;AAAA,YACb,WAAW;AAAA,UACf;AAAA,UACA,MAAM;AAAA,YACF,UAAU;AAAA,UACd;AAAA,QACJ;AAAA,QACA,cAAc;AAAA,UACV,OAAO;AAAA,UACP,KAAK;AAAA,YACD,SAAS;AAAA,YACT,SAAS;AAAA,YACT,UAAU;AAAA,UACd;AAAA,UACA,SAAS;AAAA,YACL,OAAO;AAAA,YACP,MAAM;AAAA,YACN,OAAO;AAAA,YACP,eAAe;AAAA,YACf,eAAe;AAAA,YACf,UAAU;AAAA,YACV,UAAU;AAAA,YACV,eAAe;AAAA,YACf,eAAe;AAAA,YACf,WAAW;AAAA,UACf;AAAA,UACA,SAAS;AAAA,YACL,OAAO;AAAA,YACP,aAAa;AAAA,YACb,QAAQ;AAAA,YACR,SAAS;AAAA,cACL,QAAQ;AAAA,gBACJ,OAAO;AAAA,gBACP,aAAa;AAAA,cACjB;AAAA,cACA,OAAO;AAAA,gBACH,OAAO;AAAA,gBACP,aAAa;AAAA,cACjB;AAAA,cACA,MAAM;AAAA,gBACF,OAAO;AAAA,gBACP,aAAa;AAAA,cACjB;AAAA,YACJ;AAAA,UACJ;AAAA,UACA,UAAU;AAAA,YACN,OAAO;AAAA,YACP,aAAa;AAAA,YACb,QAAQ;AAAA,YACR,SAAS;AAAA,cACL,QAAQ;AAAA,gBACJ,OAAO;AAAA,gBACP,aAAa;AAAA,cACjB;AAAA,cACA,IAAI;AAAA,gBACA,OAAO;AAAA,gBACP,aAAa;AAAA,cACjB;AAAA,cACA,IAAI;AAAA,gBACA,OAAO;AAAA,gBACP,aAAa;AAAA,cACjB;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ;AAAA,QACA,cAAc;AAAA,UACV,OAAO;AAAA,UACP,OAAO;AAAA,UACP,aAAa;AAAA,UACb,eAAe;AAAA,UACf,OAAO;AAAA,QACX;AAAA,QACA,SAAS;AAAA,UACL,SAAS;AAAA,UACT,QAAQ;AAAA,UACR,SAAS;AAAA,UACT,MAAM;AAAA,UACN,MAAM;AAAA,UACN,UAAU;AAAA,UACV,aAAa;AAAA,QACjB;AAAA,MACJ;AAAA;AAAA;;;AC5lBA,MAMa;AANb;AAAA;AAAA;AAMO,MAAM,KAAK;AAAA,QACd,SAAS;AAAA,UACL,WAAW;AAAA,UACX,MAAM;AAAA,UACN,YAAY;AAAA,UACZ,gBAAgB;AAAA,UAChB,cAAc;AAAA,UACd,cAAc;AAAA,UACd,gBAAgB;AAAA,UAChB,OAAO;AAAA,UACP,OAAO;AAAA,YACH,WAAW;AAAA,YACX,MAAM;AAAA,UACV;AAAA,UACA,QAAQ;AAAA,YACJ,UAAU;AAAA,YACV,SAAS;AAAA,YACT,SAAS;AAAA,YACT,WAAW;AAAA,YACX,UAAU;AAAA,YACV,UAAU;AAAA,YACV,YAAY;AAAA,YACZ,YAAY;AAAA,YACZ,YAAY;AAAA,UAChB;AAAA,QACJ;AAAA,QACA,QAAQ;AAAA,UACJ,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,QAAQ;AAAA,UACR,SAAS;AAAA,QACb;AAAA,QACA,QAAQ;AAAA,UACJ,SAAS;AAAA,YACL,OAAO;AAAA,YACP,aAAa;AAAA,YACb,UAAU;AAAA,YACV,UAAU;AAAA,UACd;AAAA,UACA,SAAS;AAAA,YACL,OAAO;AAAA,UACX;AAAA,QACJ;AAAA,QACA,SAAS;AAAA,UACL,QAAQ;AAAA,UACR,UAAU;AAAA,UACV,QAAQ;AAAA,UACR,MAAM;AAAA,UACN,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,UAAU;AAAA,UACV,OAAO;AAAA,UACP,WAAW;AAAA,UACX,UAAU;AAAA,QACd;AAAA,QACA,MAAM;AAAA,UACF,QAAQ;AAAA,UACR,UAAU;AAAA,UACV,MAAM;AAAA,UACN,OAAO;AAAA,UACP,UAAU;AAAA,UACV,WAAW;AAAA,UACX,UAAU;AAAA,QACd;AAAA,QACA,SAAS;AAAA,UACL,WAAW;AAAA,YACP,OAAO;AAAA,UACX;AAAA,UACA,kBAAkB;AAAA,UAClB,eAAe;AAAA,YACX,OAAO;AAAA,YACP,cAAc;AAAA,YACd,kBAAkB;AAAA,YAClB,YAAY;AAAA,YACZ,QAAQ;AAAA,UACZ;AAAA,UACA,SAAS;AAAA,YACL,MAAM;AAAA,YACN,YAAY;AAAA,YACZ,WAAW;AAAA,YACX,iBAAiB;AAAA,YACjB,OAAO;AAAA,YACP,UAAU;AAAA,UACd;AAAA,UACA,MAAM;AAAA,YACF,mBAAmB;AAAA,UACvB;AAAA,UACA,WAAW;AAAA,YACP,SAAS;AAAA,YACT,SAAS;AAAA,YACT,UAAU;AAAA,YACV,SAAS;AAAA,UACb;AAAA,UACA,OAAO;AAAA,YACH,OAAO;AAAA,YACP,eAAe;AAAA,YACf,SAAS;AAAA,cACL,UAAU;AAAA,cACV,SAAS;AAAA,cACT,SAAS;AAAA,YACb;AAAA,UACJ;AAAA,UACA,UAAU;AAAA,YACN,MAAM;AAAA,YACN,QAAQ;AAAA,YACR,SAAS;AAAA,UACb;AAAA,UACA,OAAO;AAAA,YACH,IAAI;AAAA,YACJ,KAAK;AAAA,YACL,QAAQ;AAAA,YACR,WAAW;AAAA,YACX,OAAO;AAAA,YACP,cAAc;AAAA,YACd,SAAS;AAAA,YACT,WAAW;AAAA,UACf;AAAA,UACA,SAAS;AAAA,YACL,iBAAiB;AAAA,YACjB,mBAAmB;AAAA,YACnB,eAAe;AAAA,YACf,WAAW;AAAA,YACX,MAAM;AAAA,UACV;AAAA,UACA,SAAS;AAAA,YACL,OAAO;AAAA,YACP,WAAW;AAAA,UACf;AAAA,QACJ;AAAA,QACA,QAAQ;AAAA,UACJ,UAAU;AAAA,YACN,OAAO;AAAA,YACP,cAAc;AAAA,YACd,aAAa;AAAA,UACjB;AAAA,UACA,OAAO;AAAA,YACH,OAAO;AAAA,YACP,OAAO;AAAA,YACP,eAAe;AAAA,YACf,eAAe;AAAA,YACf,UAAU;AAAA,YACV,UAAU;AAAA,YACV,eAAe;AAAA,YACf,eAAe;AAAA,YACf,YAAY;AAAA,YACZ,WAAW;AAAA,UACf;AAAA,UACA,UAAU;AAAA,YACN,OAAO;AAAA,UACX;AAAA,UACA,MAAM;AAAA,YACF,OAAO;AAAA,UACX;AAAA,UACA,OAAO;AAAA,YACH,OAAO;AAAA,YACP,aAAa;AAAA,UACjB;AAAA,UACA,QAAQ;AAAA,YACJ,OAAO;AAAA,UACX;AAAA,UACA,QAAQ;AAAA,YACJ,OAAO;AAAA,YACP,OAAO;AAAA,YACP,SAAS;AAAA,cACL,SAAS;AAAA,cACT,SAAS;AAAA,cACT,SAAS;AAAA,cACT,YAAY;AAAA,cACZ,OAAO;AAAA,gBACH,KAAK;AAAA,gBACL,WAAW;AAAA,gBACX,WAAW;AAAA,gBACX,UAAU;AAAA,gBACV,QAAQ;AAAA,cACZ;AAAA,YACJ;AAAA,YACA,UAAU;AAAA,cACN,SAAS;AAAA,cACT,aAAa;AAAA,cACb,OAAO;AAAA,YACX;AAAA,YACA,QAAQ;AAAA,cACJ,aAAa;AAAA,cACb,OAAO;AAAA,YACX;AAAA,YACA,QAAQ;AAAA,cACJ,kBAAkB;AAAA,cAClB,SAAS;AAAA,cACT,OAAO;AAAA,YACX;AAAA,YACA,QAAQ;AAAA,cACJ,SAAS;AAAA,cACT,aAAa;AAAA,cACb,aAAa;AAAA,YACjB;AAAA,YACA,SAAS;AAAA,cACL,OAAO;AAAA,YACX;AAAA,YACA,OAAO;AAAA,cACH,OAAO;AAAA,cACP,aAAa;AAAA,YACjB;AAAA,YACA,aAAa;AAAA,YACb,QAAQ;AAAA,cACJ,eAAe;AAAA,cACf,aAAa;AAAA,cACb,gBAAgB;AAAA,cAChB,qBAAqB;AAAA,cACrB,UAAU;AAAA,cACV,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,MAAM;AAAA,cACN,MAAM;AAAA,cACN,UAAU;AAAA,cACV,cAAc;AAAA,cACd,qBAAqB;AAAA,cACrB,eAAe;AAAA,cACf,YAAY;AAAA,cACZ,kBAAkB;AAAA,cAClB,iBAAiB;AAAA,cACjB,SAAS;AAAA,cACT,cAAc;AAAA,YAClB;AAAA,YACA,cAAc;AAAA,cACV,WAAW;AAAA,cACX,UAAU;AAAA,cACV,QAAQ;AAAA,YACZ;AAAA,YACA,aAAa;AAAA,cACT,WAAW;AAAA,cACX,UAAU;AAAA,cACV,QAAQ;AAAA,YACZ;AAAA,YACA,QAAQ;AAAA,cACJ,eAAe;AAAA,cACf,aAAa;AAAA,YACjB;AAAA,YACA,SAAS;AAAA,cACL,KAAK;AAAA,YACT;AAAA,UACJ;AAAA,UACA,aAAa;AAAA,YACT,OAAO;AAAA,UACX;AAAA,UACA,WAAW;AAAA,YACP,OAAO;AAAA,YACP,mBAAmB;AAAA,UACvB;AAAA,UACA,UAAU;AAAA,YACN,OAAO;AAAA,UACX;AAAA,QACJ;AAAA,QACA,UAAU;AAAA,UACN,SAAS;AAAA,YACL,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,QAAQ;AAAA,YACJ,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,UAAU;AAAA,YACN,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,UAAU;AAAA,YACN,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,MAAM;AAAA,YACF,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,OAAO;AAAA,YACH,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,QAAQ;AAAA,YACJ,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,OAAO;AAAA,YACH,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,WAAW;AAAA,YACP,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,UAAU;AAAA,YACN,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,UACA,SAAS;AAAA,YACL,OAAO;AAAA,YACP,WAAW;AAAA,YACX,OAAO;AAAA,cACH,MAAM;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,WAAW;AAAA,YACf;AAAA,UACJ;AAAA,QACJ;AAAA,QACA,QAAQ;AAAA,UACJ,SAAS;AAAA,YACL,MAAM;AAAA,YACN,SAAS;AAAA,YACT,UAAU;AAAA,YACV,UAAU;AAAA,YACV,QAAQ;AAAA,UACZ;AAAA,UACA,SAAS;AAAA,YACL,WAAW;AAAA,YACX,MAAM;AAAA,YACN,UAAU;AAAA,YACV,QAAQ;AAAA,YACR,WAAW;AAAA,YACX,QAAQ;AAAA,YACR,SAAS;AAAA,UACb;AAAA,UACA,MAAM;AAAA,UACN,aAAa;AAAA,UACb,YAAY;AAAA,UACZ,cAAc;AAAA,UACd,gBAAgB;AAAA,UAChB,gBAAgB;AAAA,UAChB,gBAAgB;AAAA,UAChB,mBAAmB;AAAA,UACnB,wBAAwB;AAAA,UACxB,aAAa;AAAA,UACb,cAAc;AAAA,UACd,gBAAgB;AAAA,UAChB,qBAAqB;AAAA,UACrB,eAAe;AAAA,UACf,WAAW;AAAA,UACX,cAAc;AAAA,QAClB;AAAA,QACA,YAAY;AAAA,UACR,OAAO;AAAA,UACP,eAAe;AAAA,UACf,uBAAuB;AAAA,UACvB,SAAS;AAAA,YACL,MAAM;AAAA,YACN,QAAQ;AAAA,YACR,WAAW;AAAA,YACX,eAAe;AAAA,YACf,UAAU;AAAA,YACV,UAAU;AAAA,YACV,UAAU;AAAA,YACV,eAAe;AAAA,YACf,aAAa;AAAA,YACb,WAAW;AAAA,YACX,aAAa;AAAA,YACb,YAAY;AAAA,YACZ,YAAY;AAAA,YACZ,aAAa;AAAA,YACb,MAAM;AAAA,YACN,MAAM;AAAA,YACN,OAAO;AAAA,YACP,MAAM;AAAA,YACN,MAAM;AAAA,UACV;AAAA,UACA,aAAa;AAAA,YACT,MAAM;AAAA,YACN,SAAS;AAAA,YACT,MAAM;AAAA,YACN,YAAY;AAAA,YACZ,YAAY;AAAA,YACZ,OAAO;AAAA,YACP,SAAS;AAAA,YACT,eAAe;AAAA,UACnB;AAAA,UACA,QAAQ;AAAA,YACJ,SAAS;AAAA,YACT,kBAAkB;AAAA,YAClB,WAAW;AAAA,YACX,WAAW;AAAA,YACX,WAAW;AAAA,YACX,UAAU;AAAA,UACd;AAAA,QACJ;AAAA,QACA,MAAM;AAAA,UACF,UAAU;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,QAAQ;AAAA,YACR,MAAM;AAAA,UACV;AAAA,UACA,QAAQ;AAAA,YACJ,WAAW;AAAA,YACX,QAAQ;AAAA,YACR,OAAO;AAAA,YACP,MAAM;AAAA,UACV;AAAA,UACA,UAAU;AAAA,YACN,OAAO;AAAA,YACP,MAAM;AAAA,UACV;AAAA,UACA,MAAM;AAAA,YACF,SAAS;AAAA,YACT,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,KAAK;AAAA,YACL,MAAM;AAAA,YACN,OAAO;AAAA,YACP,WAAW;AAAA,YACX,YAAY;AAAA,YACZ,MAAM;AAAA,UACV;AAAA,UACA,OAAO;AAAA,YACH,WAAW;AAAA,YACX,WAAW;AAAA,YACX,OAAO;AAAA,YACP,MAAM;AAAA,UACV;AAAA,UACA,UAAU;AAAA,YACN,WAAW;AAAA,YACX,OAAO;AAAA,YACP,OAAO;AAAA,YACP,MAAM;AAAA,YACN,QAAQ;AAAA,YACR,cAAc;AAAA,YACd,UAAU;AAAA,YACV,aAAa;AAAA,YACb,MAAM;AAAA,YACN,OAAO;AAAA,YACP,WAAW;AAAA,UACf;AAAA,UACA,OAAO;AAAA,YACH,OAAO;AAAA,YACP,MAAM;AAAA,UACV;AAAA,UACA,aAAa;AAAA,YACT,OAAO;AAAA,UACX;AAAA,UACA,QAAQ;AAAA,YACJ,UAAU;AAAA,YACV,MAAM;AAAA,YACN,cAAc;AAAA,YACd,OAAO;AAAA,YACP,UAAU;AAAA,YACV,aAAa;AAAA,YACb,WAAW;AAAA,YACX,aAAa;AAAA,YACb,WAAW;AAAA,YACX,iBAAiB;AAAA,UACrB;AAAA,UACA,SAAS;AAAA,YACL,QAAQ;AAAA,YACR,QAAQ;AAAA,YACR,eAAe;AAAA,YACf,eAAe;AAAA,YACf,aAAa;AAAA,YACb,WAAW;AAAA,UACf;AAAA,UACA,MAAM;AAAA,YACF,UAAU;AAAA,UACd;AAAA,QACJ;AAAA,QACA,cAAc;AAAA,UACV,OAAO;AAAA,UACP,KAAK;AAAA,YACD,SAAS;AAAA,YACT,SAAS;AAAA,YACT,UAAU;AAAA,UACd;AAAA,UACA,SAAS;AAAA,YACL,OAAO;AAAA,YACP,MAAM;AAAA,YACN,OAAO;AAAA,YACP,eAAe;AAAA,YACf,eAAe;AAAA,YACf,UAAU;AAAA,YACV,UAAU;AAAA,YACV,eAAe;AAAA,YACf,eAAe;AAAA,YACf,WAAW;AAAA,UACf;AAAA,UACA,SAAS;AAAA,YACL,OAAO;AAAA,YACP,aAAa;AAAA,YACb,QAAQ;AAAA,YACR,SAAS;AAAA,cACL,QAAQ;AAAA,gBACJ,OAAO;AAAA,gBACP,aAAa;AAAA,cACjB;AAAA,cACA,OAAO;AAAA,gBACH,OAAO;AAAA,gBACP,aAAa;AAAA,cACjB;AAAA,cACA,MAAM;AAAA,gBACF,OAAO;AAAA,gBACP,aAAa;AAAA,cACjB;AAAA,YACJ;AAAA,UACJ;AAAA,UACA,UAAU;AAAA,YACN,OAAO;AAAA,YACP,aAAa;AAAA,YACb,QAAQ;AAAA,YACR,SAAS;AAAA,cACL,QAAQ;AAAA,gBACJ,OAAO;AAAA,gBACP,aAAa;AAAA,cACjB;AAAA,cACA,IAAI;AAAA,gBACA,OAAO;AAAA,gBACP,aAAa;AAAA,cACjB;AAAA,cACA,IAAI;AAAA,gBACA,OAAO;AAAA,gBACP,aAAa;AAAA,cACjB;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ;AAAA,QACA,cAAc;AAAA,UACV,OAAO;AAAA,UACP,OAAO;AAAA,UACP,aAAa;AAAA,UACb,eAAe;AAAA,UACf,OAAO;AAAA,QACX;AAAA,QACA,SAAS;AAAA,UACL,SAAS;AAAA,UACT,QAAQ;AAAA,UACR,SAAS;AAAA,UACT,MAAM;AAAA,UACN,MAAM;AAAA,UACN,UAAU;AAAA,UACV,aAAa;AAAA,QACjB;AAAA,MACJ;AAAA;AAAA;;;AC3gBA,WAAS,kBAAkB,OAAqC;AAC5D,QAAI,CAAC,MAAO,QAAO;AACnB,UAAM,QAAQ,OAAO,KAAK,EAAE,KAAK,EAAE,YAAY;AAC/C,QAAI,CAAC,MAAO,QAAO;AACnB,UAAM,OAAO,MAAM,MAAM,MAAM,EAAE,CAAC,KAAK;AACvC,WAAQ,oBAA0C,SAAS,IAAI,IACxD,OACD;AAAA,EACV;AAEA,WAAS,gBAAgB,OAAoC;AACzD,QAAI,UAAU,QAAQ,UAAU,OAAW,QAAO;AAClD,UAAM,aAAa,OAAO,KAAK,EAAE,KAAK;AACtC,WAAQ,iBAAuC,SAAS,UAAU,IAC3D,aACD;AAAA,EACV;AAEA,WAAS,sBAAgC;AACrC,UAAM,QAAkB,CAAC;AACzB,QAAI,MAAM,QAAQ,UAAU,SAAS,GAAG;AACpC,YAAM,KAAK,GAAG,UAAU,SAAS;AAAA,IACrC;AACA,QAAI,UAAU,UAAU;AACpB,YAAM,KAAK,UAAU,QAAQ;AAAA,IACjC;AAEA,UAAM,kBAAkB;AACxB,QAAI,gBAAgB,cAAc;AAC9B,YAAM,KAAK,gBAAgB,YAAY;AAAA,IAC3C;AACA,WAAO,MAAM,SAAS,QAAQ,CAAC,IAAI;AAAA,EACvC;AAEA,WAAS,uBAAqC;AAC1C,UAAM,aAAa,oBAAoB;AACvC,eAAW,aAAa,YAAY;AAChC,YAAM,aAAa,kBAAkB,SAAS;AAC9C,UAAI,YAAY;AACZ,eAAO;AAAA,MACX;AAAA,IACJ;AACA,WAAO;AAAA,EACX;AAUA,WAAS,sBAAsB,MAAwC;AACnE,QAAI,SAAS,UAAU;AACnB,aAAO,qBAAqB;AAAA,IAChC;AACA,WAAQ,oBAA0C,SAAS,IAAI,IACxD,OACD;AAAA,EACV;AAIA,WAAS,oBAAoB,MAA0B;AACnD,QAAI,OAAO,aAAa,eAAe,SAAS,iBAAiB;AAC7D,eAAS,gBAAgB,OAAO;AAAA,IACpC;AAAA,EACJ;AAMA,WAAS,eAAe,UAAkB,QAAoC;AAC1E,QAAI,OAAO,aAAa,UAAU;AAC9B,aAAO;AAAA,IACX;AACA,QAAI,CAAC,UAAU,OAAO,WAAW,UAAU;AACvC,aAAO;AAAA,IACX;AACA,WAAO,SAAS,QAAQ,gBAAgB,CAAC,OAAO,UAAU;AACtD,YAAM,MAAM,MAAM,KAAK;AACvB,aAAO,OAAO,UAAU,eAAe,KAAK,QAAQ,GAAG,IAAI,OAAO,OAAO,GAAG,CAAC,IAAI;AAAA,IACrF,CAAC;AAAA,EACL;AAEA,WAAS,WAAW,MAAoB,KAAsB;AAC1D,UAAM,WAAW,IAAI,MAAM,GAAG;AAC9B,QAAI,UAAmB,aAAa,IAAI;AACxC,eAAW,WAAW,UAAU;AAC5B,UAAI,CAAC,WAAW,OAAO,YAAY,YAAY,EAAE,WAAW,UAAU;AAClE,eAAO;AAAA,MACX;AACA,gBAAW,QAAoC,OAAO;AAAA,IAC1D;AACA,WAAO;AAAA,EACX;AAEO,WAAS,UACZ,KACA,SAA4B,CAAC,GAC7B,UAA4B,CAAC,GACvB;AACN,QAAI,CAAC,IAAK,QAAO;AACjB,UAAM,OAAO,QAAQ,YAAY;AACjC,QAAI,QAAQ,WAAW,MAAM,GAAG;AAChC,QAAI,UAAU,UAAa,SAAS,mBAAmB;AACnD,cAAQ,WAAW,mBAAmB,GAAG;AAAA,IAC7C;AACA,QAAI,UAAU,QAAW;AACrB,aAAO,QAAQ,aAAa,SAAY,QAAQ,WAAW;AAAA,IAC/D;AACA,QAAI,OAAO,UAAU,UAAU;AAC3B,aAAO,eAAe,OAAO,MAAM;AAAA,IACvC;AACA,WAAO,OAAO,KAAK;AAAA,EACvB;AAMA,WAAS,YAAY,SAAiD;AAClE,UAAM,aAAa,QAAQ,aAAa,kBAAkB;AAC1D,QAAI,CAAC,YAAY;AACb,aAAO;AAAA,IACX;AACA,QAAI;AACA,aAAO,KAAK,MAAM,UAAU;AAAA,IAChC,SAAS,KAAK;AACV,cAAQ,KAAK,qCAAqC,GAAG;AACrD,aAAO;AAAA,IACX;AAAA,EACJ;AAEA,WAAS,iBAAiB,SAAwB;AAC9C,QAAI,EAAE,mBAAmB,UAAU;AAC/B;AAAA,IACJ;AACA,UAAM,SAAS,YAAY,OAAO,KAAK,CAAC;AACxC,UAAM,UAAU,QAAQ,aAAa,WAAW;AAChD,QAAI,SAAS;AACT,cAAQ,cAAc,UAAU,SAAS,MAAM;AAAA,IACnD;AACA,UAAM,UAAU,QAAQ,aAAa,gBAAgB;AACrD,QAAI,SAAS;AACT,cAAQ,YAAY,UAAU,SAAS,MAAM;AAAA,IACjD;AACA,UAAM,KAAK,QAAQ,UAAU,EAAE,QAAQ,UAAQ;AAC3C,UAAI,CAAC,KAAK,KAAK,WAAW,YAAY,EAAG;AACzC,UAAI,KAAK,SAAS,eAAe,KAAK,SAAS,iBAAkB;AACjE,YAAM,aAAa,KAAK,KAAK,UAAU,aAAa,MAAM;AAC1D,UAAI,CAAC,WAAY;AACjB,cAAQ,aAAa,YAAY,UAAU,KAAK,OAAO,MAAM,CAAC;AAAA,IAClE,CAAC;AAAA,EACL;AAEO,WAAS,kBAAkB,OAA2B,UAAgB;AACzE,QAAI,CAAC,KAAM;AACX,UAAM,OAAO,SAAS,WAAW,SAAS,kBAAkB;AAC5D,QAAI,CAAC,QAAQ,EAAE,gBAAgB,SAAU;AACzC,qBAAiB,IAAI;AACrB,UAAM,WAAW,KAAK,iBAAiB,GAAG;AAC1C,aAAS,QAAQ,gBAAgB;AAAA,EACrC;AAMA,WAAS,wBAA8B;AACnC,QAAI,OAAO,WAAW,YAAa;AACnC,UAAM,QAAQ,IAAI,YAAY,4BAA4B;AAAA,MACtD,QAAQ;AAAA,QACJ,YAAY;AAAA,QACZ,UAAU;AAAA,MACd;AAAA,IACJ,CAAC;AACD,WAAO,cAAc,KAAK;AAAA,EAC9B;AAEA,WAAS,sBAAsB,YAAY,MAAY;AACnD,UAAM,eAAe,sBAAsB,kBAAkB;AAC7D,UAAM,kBAAkB,iBAAiB;AACzC,qBAAiB;AACjB,wBAAoB,cAAc;AAClC,sBAAkB,QAAQ;AAC1B,QAAI,aAAa,iBAAiB;AAC9B,4BAAsB;AAAA,IAC1B;AAAA,EACJ;AAEO,WAAS,sBAAsB,MAAwC;AAC1E,UAAM,aAAa,gBAAgB,IAAI;AACvC,QAAI,eAAe,oBAAoB;AACnC,4BAAsB,IAAI;AAC1B,aAAO;AAAA,IACX;AACA,yBAAqB;AACrB,QAAI,OAAO,iBAAiB,aAAa;AACrC,UAAI,eAAe,UAAU;AACzB,qBAAa,QAAQ,yBAAyB,QAAQ;AAAA,MAC1D,OAAO;AACH,qBAAa,QAAQ,yBAAyB,UAAU;AAAA,MAC5D;AAAA,IACJ;AACA,0BAAsB,IAAI;AAC1B,WAAO;AAAA,EACX;AAEO,WAAS,wBAA4C;AACxD,WAAO;AAAA,EACX;AAEO,WAAS,oBAAkC;AAC9C,WAAO;AAAA,EACX;AAzSA,MA8DM,yBACA,qBACA,kBACA,mBAMA,cA0DF,oBAaA,gBAoMS;AAlVb;AAAA;AAAA;AAgBA;AACA;AA6CA,MAAM,0BAA0B;AAChC,MAAM,sBAA+C,CAAC,MAAM,IAAI;AAChE,MAAM,mBAAkD,CAAC,UAAU,GAAG,mBAAmB;AACzF,MAAM,oBAAkC;AAMxC,MAAM,eAAsD;AAAA,QACxD;AAAA,QACA;AAAA,MACJ;AAuDA,MAAI,qBAAyC;AAAA,QACzC,OAAO,iBAAiB,cAAc,aAAa,QAAQ,uBAAuB,IAAI;AAAA,MAC1F;AAWA,MAAI,iBAA+B,sBAAsB,kBAAkB;AAiK3E,UAAI,OAAO,WAAW,aAAa;AAC/B,eAAO,iBAAiB,kBAAkB,MAAM;AAC5C,cAAI,uBAAuB,UAAU;AACjC,kCAAsB,IAAI;AAAA,UAC9B;AAAA,QACJ,CAAC;AAED,eAAO,iBAAiB,WAAW,CAAC,UAAwB;AACxD,cAAI,MAAM,QAAQ,yBAAyB;AACvC;AAAA,UACJ;AACA,gBAAM,gBAAgB,gBAAgB,MAAM,QAAQ;AACpD,+BAAqB;AACrB,gCAAsB,IAAI;AAAA,QAC9B,CAAC;AAAA,MACL;AAMA,UAAI,OAAO,aAAa,aAAa;AACjC,4BAAoB,cAAc;AAElC,YAAI,SAAS,eAAe,WAAW;AACnC,mBAAS,iBAAiB,oBAAoB,MAAM,kBAAkB,QAAQ,CAAC;AAAA,QACnF,OAAO;AACH,4BAAkB,QAAQ;AAAA,QAC9B;AAAA,MACJ;AAMO,MAAM,UAAmB;AAAA,QAC5B;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,oBAAoB;AAAA,QACpB,iBAAiB;AAAA,MACrB;AAGA,UAAI,OAAO,WAAW,aAAa;AAC/B,eAAO,UAAU;AAAA,MACrB;AAAA;AAAA;;;AChWA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWO,WAAS,KAAK,SAAmC;AACpD,QAAI,CAAC,QAAS;AACd,YAAQ,UAAU,OAAO,QAAQ;AAAA,EACrC;AAMO,WAAS,KAAK,SAAmC;AACpD,QAAI,CAAC,QAAS;AACd,YAAQ,UAAU,IAAI,QAAQ;AAAA,EAClC;AAOO,WAAS,OAAO,SAA6B,SAAyB;AACzE,QAAI,CAAC,QAAS;AACd,QAAI,YAAY,QAAW;AACvB,cAAQ,UAAU,OAAO,QAAQ;AAAA,IACrC,OAAO;AACH,cAAQ,UAAU,OAAO,UAAU,CAAC,OAAO;AAAA,IAC/C;AAAA,EACJ;AAOO,WAAS,UAAU,SAAsC;AAC5D,QAAI,CAAC,QAAS,QAAO;AACrB,WAAO,CAAC,QAAQ,UAAU,SAAS,QAAQ;AAAA,EAC/C;AAOO,WAAS,cAAc,SAA6B,SAAwB;AAC/E,QAAI,CAAC,QAAS;AACd,YAAQ,UAAU,OAAO,UAAU,CAAC,OAAO;AAAA,EAC/C;AAMO,WAAS,QAAQ,UAAwC;AAC5D,aAAS,QAAQ,IAAI;AAAA,EACzB;AAMO,WAAS,QAAQ,UAAwC;AAC5D,aAAS,QAAQ,IAAI;AAAA,EACzB;AAOO,WAAS,QAAQ,IAAgC;AACpD,WAAO,SAAS,eAAe,EAAE;AAAA,EACrC;AAQO,WAAS,MACZ,UACA,SAAqB,UACb;AACR,WAAO,OAAO,cAAiB,QAAQ;AAAA,EAC3C;AAQO,WAAS,SACZ,UACA,SAAqB,UACR;AACb,WAAO,OAAO,iBAAoB,QAAQ;AAAA,EAC9C;AA5GA;AAAA;AAAA;AA+GA,UAAI,OAAO,WAAW,aAAa;AAC/B,QAAC,OAAgE,WAAW;AAAA,UACxE;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACJ;AAAA,MACJ;AAEA,cAAQ,IAAI,wBAAmB;AAAA;AAAA;;;AC9H/B,MAsCa,sBACA,yBAEA,0BACA,kBACA,sBAEA,WAUA,qBAEA,cACA,iBACA,cAEA,kBACA,mBACA,sBACA,uBAEA,iBACA,iBACA,0BACA,0BAEA,mBACA,sBACA,yBAEA,2BACA,yBACA,yBAEA,uBACA,iBAEA,gBACA,YAEA;AArFb;AAAA;AAAA;AAsCO,MAAM,uBAAuB;AAC7B,MAAM,0BAA0B,CAAC,UAAU,SAAS,MAAM;AAE1D,MAAM,2BAA2B;AACjC,MAAM,mBAAmB;AACzB,MAAM,uBAAuB;AAE7B,MAAM,YAAY;AAAA,QACrB;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACJ;AAEO,MAAM,sBAAsB,oBAAI,IAAY,CAAC,oBAAoB,CAAC;AAElE,MAAM,eAAe;AACrB,MAAM,kBAAkB;AACxB,MAAM,eAAe;AAErB,MAAM,mBAAmB;AACzB,MAAM,oBAAoB;AAC1B,MAAM,uBAAuB;AAC7B,MAAM,wBAAwB;AAE9B,MAAM,kBAAkB;AACxB,MAAM,kBAAkB;AACxB,MAAM,2BAA2B;AACjC,MAAM,2BAA2B;AAEjC,MAAM,oBAAoB;AAC1B,MAAM,uBAAuB;AAC7B,MAAM,0BAA0B;AAEhC,MAAM,4BAA4B;AAClC,MAAM,0BAA0B;AAChC,MAAM,0BAA0B;AAEhC,MAAM,wBAAwB,IAAI,KAAK;AACvC,MAAM,kBAAkB;AAExB,MAAM,iBAAiB;AACvB,MAAM,aAAa,CAAC,QAAQ,OAAO;AAEnC,MAAM,gBAA8B;AAAA,QACvC;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACJ;AASA,UAAI,OAAO,WAAW,aAAa;AAC/B,eAAO,gBAAgB;AAAA,MAC3B;AAAA;AAAA;;;AC7HA,MAOM,YAQA,YAQO,QAyGP,QAEC;AAlIP;AAAA;AAAA;AAOA,MAAM,aAA2C;AAAA,QAC7C,OAAO;AAAA,QACP,MAAM;AAAA,QACN,MAAM;AAAA,QACN,OAAO;AAAA,QACP,OAAO;AAAA,MACX;AAEA,MAAM,aAA2C;AAAA,QAC7C,OAAO;AAAA,QACP,MAAM;AAAA,QACN,MAAM;AAAA,QACN,OAAO;AAAA,QACP,OAAO;AAAA,MACX;AAEO,MAAM,SAAN,MAAa;AAAA,QAKhB,cAAc;AACV,eAAK,QAAQ,KAAK,cAAc,IAAI,WAAW,QAAQ,WAAW;AAClE,eAAK,oBAAoB,oBAAI,IAAI,CAAC,GAAG,CAAC;AACtC,eAAK,SAAS;AAAA,QAClB;AAAA,QAEA,gBAAyB;AACrB,cAAI;AACA,mBACI,SAAS,aAAa,eACtB,SAAS,aAAa,eACtB,SAAS,SAAS;AAAA,UAE1B,QAAQ;AACJ,mBAAO;AAAA,UACX;AAAA,QACJ;AAAA,QAEA,SAAS,OAA8B;AA9C3C;AA+CQ,cAAI,OAAO,UAAU,UAAU;AAC3B,iBAAK,SAAQ,gBAAW,MAAM,YAAY,CAAiB,MAA9C,YAAmD,WAAW;AAAA,UAC/E,OAAO;AACH,iBAAK,QAAQ;AAAA,UACjB;AAAA,QACJ;AAAA,QAEA,eAAe,UAAkB;AAC7B,cAAI,aAAa,KAAK;AAClB,iBAAK,kBAAkB,MAAM;AAC7B,iBAAK,kBAAkB,IAAI,GAAG;AAAA,UAClC,OAAO;AACH,iBAAK,kBAAkB,IAAI,QAAQ;AAAA,UACvC;AAAA,QACJ;AAAA,QAEA,gBAAgB,UAAkB;AAC9B,eAAK,kBAAkB,OAAO,QAAQ;AAAA,QAC1C;AAAA,QAEA,kBAAkB,UAAkB;AAChC,iBAAO,KAAK,kBAAkB,IAAI,GAAG,KAAK,KAAK,kBAAkB,IAAI,QAAQ;AAAA,QACjF;AAAA,QAEQ,KAAK,OAAqB,UAAkB,YAAsB,MAAiB;AACvF,cAAI,WAAW,KAAK,IAAI,KAAK,MAAO;AACpC,cAAI,CAAC,KAAK,kBAAkB,QAAQ,EAAG;AAEvC,gBAAM,QAAQ,WAAW,KAAK;AAC9B,gBAAM,aAAY,oBAAI,KAAK,GAAE,mBAAmB;AAEhD,cAAI,KAAK,WAAW,YAAY;AAC5B,oBAAQ;AAAA,cACJ,MAAM,SAAS,MAAM,KAAK,MAAM,QAAQ;AAAA,cACxC,UAAU,KAAK;AAAA,cACf;AAAA,cACA,GAAG;AAAA,YACP;AAAA,UACJ,OAAO;AACH,oBAAQ,IAAI,MAAM,QAAQ,KAAK,UAAU,KAAK,IAAI,SAAS,GAAG,IAAI;AAAA,UACtE;AAAA,QACJ;AAAA,QAEA,MAAM,UAAkB,YAAsB,MAAiB;AAC3D,eAAK,KAAK,SAAS,UAAU,SAAS,GAAG,IAAI;AAAA,QACjD;AAAA,QAEA,KAAK,UAAkB,YAAsB,MAAiB;AAC1D,eAAK,KAAK,QAAQ,UAAU,SAAS,GAAG,IAAI;AAAA,QAChD;AAAA,QAEA,KAAK,UAAkB,YAAsB,MAAiB;AAC1D,eAAK,KAAK,QAAQ,UAAU,SAAS,GAAG,IAAI;AAAA,QAChD;AAAA,QAEA,MAAM,UAAkB,YAAsB,MAAiB;AAC3D,eAAK,KAAK,SAAS,UAAU,SAAS,GAAG,IAAI;AAAA,QACjD;AAAA,QAEA,MAAM,UAAkB,YAAsB,MAAiB;AAC3D,eAAK,KAAK,SAAS,UAAU,SAAS,GAAG,IAAI;AAAA,QACjD;AAAA,QAEA,MAAM,UAAkB,OAAgB;AACpC,cAAI,CAAC,KAAK,kBAAkB,QAAQ,EAAG;AACvC,kBAAQ,MAAM,wBAAS,QAAQ;AAAA,QACnC;AAAA,QAEA,WAAW;AACP,kBAAQ,SAAS;AAAA,QACrB;AAAA,QAEA,KAAK,OAAe;AAChB,kBAAQ,KAAK,KAAK;AAAA,QACtB;AAAA,QAEA,QAAQ,OAAe;AACnB,kBAAQ,QAAQ,KAAK;AAAA,QACzB;AAAA,MACJ;AAEA,MAAM,SAAS,IAAI,OAAO;AAE1B,MAAO,iBAAQ;AAQf,UAAI,OAAO,WAAW,aAAa;AAC/B,eAAO,SAAS;AAAA,MACpB;AAKA,UAAI,OAAO,WAAW,eAAe,OAAO,SAAS;AACjD,eAAO,UAAU;AAAA,MACrB;AAAA;AAAA;;;AC9IO,WAAS,UAAU,KAA4B;AAClD,QAAI;AACA,aAAO,aAAa,QAAQ,GAAG;AAAA,IACnC,QAAQ;AACJ,aAAO;AAAA,IACX;AAAA,EACJ;AAEO,WAAS,UAAU,KAAa,OAAqB;AACxD,QAAI;AACA,mBAAa,QAAQ,KAAK,KAAK;AAAA,IACnC,SAAS,KAAK;AACV,cAAQ,KAAK,6CAA6C,GAAG,MAAM,GAAG;AAAA,IAC1E;AAAA,EACJ;AAEO,WAAS,OAAO,KAAmB;AACtC,QAAI;AACA,mBAAa,WAAW,GAAG;AAAA,IAC/B,SAAS,KAAK;AACV,cAAQ,KAAK,0CAA0C,GAAG,MAAM,GAAG;AAAA,IACvE;AAAA,EACJ;AAEO,WAAS,QAAW,KAAa,UAAgB;AACpD,QAAI;AACA,YAAM,MAAM,aAAa,QAAQ,GAAG;AACpC,UAAI,CAAC,IAAK,QAAO;AACjB,aAAO,KAAK,MAAM,GAAG;AAAA,IACzB,SAAS,KAAK;AACV,cAAQ,KAAK,2CAA2C,GAAG,MAAM,GAAG;AACpE,aAAO;AAAA,IACX;AAAA,EACJ;AAEO,WAAS,QAAQ,KAAa,OAAsB;AACvD,QAAI;AACA,mBAAa,QAAQ,KAAK,KAAK,UAAU,KAAK,CAAC;AAAA,IACnD,SAAS,KAAK;AACV,cAAQ,KAAK,2CAA2C,GAAG,MAAM,GAAG;AAAA,IACxE;AAAA,EACJ;AA9CA;AAAA;AAAA;AAAA;AAAA;;;ACAA;AAAA;AAAA;AAKA;AAEA,cAAQ,IAAI,qBAAqB;AAEjC,OAAC,MAAM;AACH;AAEA,cAAM,cAAc;AACpB,cAAM,WAAW;AAiCjB,iBAAS,SAAiB;AACtB,cAAI;AACA,oBAAO,oBAAI,KAAK,GAAE,YAAY;AAAA,UAClC,SAAS,IAAI;AACT,iBAAK;AACL,mBAAO,OAAO,KAAK,IAAI,CAAC;AAAA,UAC5B;AAAA,QACJ;AAEA,iBAAS,cAAc,KAAsB;AACzC,cAAI;AACA,mBAAO,KAAK,UAAU,GAAG;AAAA,UAC7B,SAAS,IAAI;AACT,iBAAK;AACL,mBAAO,OAAO,GAAG;AAAA,UACrB;AAAA,QACJ;AAEA,iBAAS,WAA4B;AACjC,cAAI;AACA,mBAAO,QAAyB,aAAa,CAAC,CAAC;AAAA,UACnD,SAAS,IAAI;AACT,iBAAK;AACL,mBAAO,CAAC;AAAA,UACZ;AAAA,QACJ;AAEA,iBAAS,UAAU,MAA6B;AAC5C,cAAI;AACA,oBAAQ,aAAa,KAAK,MAAM,CAAC,QAAQ,CAAC;AAAA,UAC9C,SAAS,IAAI;AACT,iBAAK;AAAA,UAET;AAAA,QACJ;AAEA,iBAAS,aAAa,KAA0B;AAC5C,cAAI,CAAC,IAAK,QAAO,EAAE,MAAM,SAAS,SAAS,gBAAgB;AAC3D,gBAAM,QAAQ;AACd,gBAAM,QAAoB;AAAA,YACtB,MAAM,MAAM,QAAQ;AAAA,YACpB,SAAS,MAAM,WAAW,OAAO,GAAG;AAAA,YACpC,OAAO,MAAM;AAAA,UACjB;AACA,iBAAO;AAAA,QACX;AAIA,cAAM,eAAqC;AAAA,UACvC,SAAS;AAAA,UAET,SAAS;AACL,gBAAI,KAAK,QAAS;AAClB,iBAAK,UAAU;AAAA,UACnB;AAAA,UAEA,UAAU;AACN,gBAAI,CAAC,KAAK,QAAS;AACnB,iBAAK,UAAU;AAAA,UACnB;AAAA,UAEA,UAAU;AACN,mBAAO,SAAS;AAAA,UACpB;AAAA,UAEA,YAAY;AACR,sBAAU,CAAC,CAAC;AAAA,UAChB;AAAA,UAEA,aAAa;AACT,gBAAI;AACA,oBAAM,OAAO,SAAS;AACtB,oBAAM,OAAO,IAAI,KAAK,CAAC,cAAc,IAAI,CAAC,GAAG,EAAE,MAAM,mBAAmB,CAAC;AACzE,oBAAM,MAAM,IAAI,gBAAgB,IAAI;AACpC,oBAAM,IAAI,SAAS,cAAc,GAAG;AACpC,gBAAE,OAAO;AACT,gBAAE,WAAW,cAAc,KAAK,IAAI,CAAC;AACrC,uBAAS,KAAK,YAAY,CAAC;AAC3B,gBAAE,MAAM;AACR,uBAAS,KAAK,YAAY,CAAC;AAC3B,kBAAI,gBAAgB,GAAG;AAAA,YAC3B,SAAS,IAAI;AACT,mBAAK;AACL,oBAAMA,UAAU,OAAgD,UAAU;AAC1E,cAAAA,QAAO,MAAM,gBAAgB,uBAAuB;AAAA,YACxD;AAAA,UACJ;AAAA,UAEA,QAAQ,OAAsB;AAC1B,kBAAM,OAAO,SAAS;AACtB,iBAAK,KAAK,KAAK;AACf,sBAAU,IAAI;AAAA,UAClB;AAAA,QACJ;AAIA,iBAAS,kBACL,SACA,QACA,QACA,OACA,OACO;AACP,cAAI,CAAC,aAAa,QAAS,QAAO;AAClC,gBAAM,QAAQ,aAAa,SAAS,EAAE,QAAQ,CAAC;AAC/C,gBAAM,QAAuB;AAAA,YACzB,MAAM;AAAA,YACN,MAAM,OAAO;AAAA,YACb,SAAS,OAAO,OAAO;AAAA,YACvB,QAAQ,OAAO,UAAU,EAAE;AAAA,YAC3B,MAAM,UAAU;AAAA,YAChB,QAAQ,SAAS;AAAA,YACjB,OAAO;AAAA,UACX;AACA,gBAAMA,UAAU,OAAgD,UAAU;AAC1E,UAAAA,QAAO,MAAM,gBAAgB,mBAAmB,KAAK;AACrD,uBAAa,QAAQ,KAAK;AAE1B,iBAAO;AAAA,QACX;AAEA,iBAAS,yBAAyB,OAAoC;AAClE,cAAI,CAAC,aAAa,QAAS;AAC3B,gBAAM,SAAS,+BAAO;AACtB,gBAAM,QAAQ;AAAA,YACV,kBAAkB,QAAQ,SAAS,EAAE,SAAS,cAAc,MAAM,EAAE;AAAA,UACxE;AACA,gBAAM,QAAuB;AAAA,YACzB,MAAM;AAAA,YACN,MAAM,OAAO;AAAA,YACb,QAAQ,cAAc,MAAM;AAAA,YAC5B,OAAO;AAAA,UACX;AACA,gBAAMA,UAAU,OAAgD,UAAU;AAC1E,UAAAA,QAAO,MAAM,gBAAgB,+BAA+B,KAAK;AACjE,uBAAa,QAAQ,KAAK;AAAA,QAC9B;AAKA,qBAAa,UAAU;AAGvB,eAAO,iBAAiB,SAAS,SAAU,GAAe;AAEtD,cAAI,uBAAG,OAAO;AACV,8BAAkB,EAAE,SAAS,EAAE,UAAU,EAAE,QAAQ,EAAE,OAAO,EAAE,KAAK;AAAA,UACvE;AAAA,QACJ,CAAC;AACD,eAAO,UAAU;AACjB,eAAO,iBAAiB,sBAAsB,wBAAwB;AAItE,YAAI,OAAO,WAAW,aAAa;AAC/B,UAAC,OAAkE,eAC/D;AAAA,QACR;AAAA,MACJ,GAAG;AAAA;AAAA;;;AC/MH;AAAA;AAAA;AAOA;AAFA,cAAQ,IAAI,oBAAoB;AAIhC,OAAC,MAAM;AACH;AAEA,cAAM,cAAc;AAsBpB,iBAAS,qBAA8B;AACnC,cAAI;AAEA,kBAAM,QACF,SAAS,aAAa,eACtB,SAAS,aAAa,eACtB,SAAS,SAAS;AACtB,kBAAM,OAAO,aAAa,QAAQ,WAAW;AAC7C,gBAAI,SAAS,OAAQ,QAAO;AAC5B,gBAAI,SAAS,QAAS,QAAO;AAC7B,mBAAO;AAAA,UACX,SAAS,IAAI;AACT,iBAAK;AACL,mBAAO;AAAA,UACX;AAAA,QACJ;AAIA,cAAM,cAAmC;AAAA,UACrC,SAAS,mBAAmB;AAAA,UAC5B,OAAO,oBAAI,IAAY;AAAA,UAEvB,SAAS;AACL,iBAAK,UAAU;AACf,gBAAI;AACA,wBAAU,aAAa,MAAM;AAAA,YACjC,SAAS,IAAI;AACT,mBAAK;AAAA,YACT;AACA,kBAAMC,UAAU,OAAgD,UAAU;AAC1E,YAAAA,QAAO,KAAK,eAAe,SAAS;AAAA,UACxC;AAAA,UAEA,UAAU;AACN,iBAAK,UAAU;AACf,gBAAI;AACA,wBAAU,aAAa,OAAO;AAAA,YAClC,SAAS,IAAI;AACT,mBAAK;AAAA,YACT;AACA,kBAAMA,UAAU,OAAgD,UAAU;AAC1E,YAAAA,QAAO,KAAK,eAAe,UAAU;AAAA,UACzC;AAAA,UAEA,SAAS;AACL,gBAAI,KAAK,SAAS;AACd,mBAAK,QAAQ;AAAA,YACjB,OAAO;AACH,mBAAK,OAAO;AAAA,YAChB;AAAA,UACJ;AAAA,UAEA,KAAK,MAAc;AACf,gBAAI,CAAC,KAAK,WAAW,CAAC,KAAM;AAC5B,gBAAI;AACA,0BAAY,KAAK,IAAI;AACrB,mBAAK,MAAM,IAAI,IAAI;AAAA,YACvB,SAAS,IAAI;AACT,mBAAK;AAAA,YACT;AAAA,UACJ;AAAA,UAEA,QAAQ,MAAc,WAAoB,SAA6C;AACnF,gBAAI,CAAC,KAAK,WAAW,CAAC,KAAM,QAAO;AACnC,gBAAI;AACA,kBAAI,aAAa,SAAS;AACtB,4BAAY,QAAQ,MAAM,WAAW,OAAO;AAAA,cAChD,WAAW,WAAW;AAClB,4BAAY,QAAQ,MAAM,SAAS;AAAA,cACvC,OAAO;AACH,4BAAY,QAAQ,IAAI;AAAA,cAC5B;AACA,oBAAM,UAAU,YAAY,iBAAiB,MAAM,SAAS;AAC5D,oBAAM,YAAY,QAAQ,QAAQ,SAAS,CAAC;AAC5C,qBAAO,YAAa,YAAmC;AAAA,YAC3D,SAAS,IAAI;AACT,mBAAK;AACL,qBAAO;AAAA,YACX;AAAA,UACJ;AAAA,UAEA,OAAO,SAA+C;AAClD,gBAAI,CAAC,KAAK,QAAS,QAAO,CAAC;AAC3B,kBAAM,EAAE,QAAQ,OAAO,OAAO,GAAG,IAAI,WAAW,CAAC;AACjD,kBAAM,WAAW,YACZ,iBAAiB,SAAS,EAC1B,MAAM,EACN,KAAK,CAAC,GAAG,MAAM,EAAE,WAAW,EAAE,QAAQ,EACtC,MAAM,GAAG,IAAI;AAElB,gBAAI,SAAS,QAAQ;AACjB,oBAAMA,UAAU,OAAgD,UAAU;AAC1E,cAAAA,QAAO,MAAM,oBAAoB;AACjC,yBAAW,KAAK,UAAU;AACtB,gBAAAA,QAAO,KAAK,eAAe,GAAG,EAAE,IAAI,KAAK,EAAE,SAAS,QAAQ,CAAC,CAAC,IAAI;AAAA,cACtE;AACA,cAAAA,QAAO,SAAS;AAAA,YACpB;AACA,gBAAI,OAAO;AACP,0BAAY,cAAc;AAC1B,kBAAI;AACA,2BAAW,KAAK,KAAK,MAAO,aAAY,WAAW,CAAC;AAAA,cACxD,SAAS,IAAI;AACT,qBAAK;AAAA,cACT;AACA,mBAAK,MAAM,MAAM;AAAA,YACrB;AACA,mBAAO;AAAA,UACX;AAAA,QACJ;AAKA,YAAI,YAAY,SAAS;AACrB,cAAI;AACA,wBAAY,KAAK,cAAc;AAC/B,gBAAI,SAAS,eAAe,cAAc,SAAS,eAAe,eAAe;AAE7E,0BAAY,KAAK,eAAe;AAAA,YACpC,OAAO;AACH,uBAAS;AAAA,gBACL;AAAA,gBACA,MAAM,YAAY,KAAK,eAAe;AAAA,gBACtC,EAAE,MAAM,KAAK;AAAA,cACjB;AAAA,YACJ;AACA,mBAAO;AAAA,cACH;AAAA,cACA,MAAM;AACF,4BAAY,KAAK,iBAAiB;AAClC,4BAAY,QAAQ,sBAAsB,iBAAiB,iBAAiB;AAC5E,4BAAY,QAAQ,mBAAmB,gBAAgB,iBAAiB;AACxE,4BAAY,OAAO,EAAE,MAAM,EAAE,CAAC;AAAA,cAClC;AAAA,cACA,EAAE,MAAM,KAAK;AAAA,YACjB;AAAA,UACJ,SAAS,IAAI;AACT,iBAAK;AAAA,UACT;AAAA,QACJ;AAIA,YAAI,OAAO,WAAW,aAAa;AAC/B,UAAC,OAAgE,cAAc;AAAA,QACnF;AAAA,MACJ,GAAG;AAAA;AAAA;;;ACtLH;AAAA;AAAA;AAAA,cAAQ,IAAI,YAAY;AAExB,OAAC,WAAY;AACX;AASA,iBAAS,cAAc,UAA2B;AAChD,iBAAQ,OAA8C,QAAQ;AAAA,QAChE;AAGA,iBAAS,iBAAiB,SAAiB,eAAuB,MAA0B;AAC1F,gBAAM,MAAM,cAAc,OAAO;AACjC,cAAI,OAAO,OAAQ,IAAgC,UAAU,MAAM,YAAY;AAC7E,mBAAS,IAAgC,UAAU,EAAmB,GAAG,IAAI;AAAA,UAC/E;AACA,iBAAO;AAAA,QACT;AAEA,iBAAS,kBACP,YACA,SACgB;AAChB,gBAAM,QAAQ,CAAC;AAEf,kBAAQ,QAAQ,CAAC,WAAW;AAC1B,YAAC,MAAuC,MAAM,IAAI,YAAa,MAA0B;AACvF,oBAAMC,UAAS,cAAc,UAAU;AACvC,kBAAIA,WAAU,OAAQA,QAAmC,MAAM,MAAM,YAAY;AAC/E,uBAASA,QAAmC,MAAM,EAAmB,GAAG,IAAI;AAAA,cAC9E;AACA,sBAAQ,KAAK,GAAG,UAAU,IAAI,MAAM,yBAAsB;AAC1D,qBAAO;AAAA,YACT;AAAA,UACF,CAAC;AAED,iBAAO;AAAA,QACT;AAEA,cAAMC,OAAM;AAAA,UACV,OAAO,kBAAkB,gBAAgB;AAAA,YACvC;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACF,CAAU;AAAA,UAEV,aAAa,kBAAkB,eAAe;AAAA,YAC5C;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACF,CAAU;AAAA,UAEV,OAAO,kBAAkB,eAAe;AAAA,YACtC;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACF,CAAU;AAAA,UAEV,MAAM,kBAAkB,cAAc;AAAA,YACpC;AAAA,YACA;AAAA,YACA;AAAA,UACF,CAAU;AAAA,UAEV,MAAM,kBAAkB,cAAc;AAAA,YACpC;AAAA,YACA;AAAA,YACA;AAAA,UACF,CAAU;AAAA,UAEV,MAAM,kBAAkB,cAAc;AAAA,YACpC;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACF,CAAU;AAAA,UAEV,SAAS,kBAAkB,iBAAiB;AAAA,YAC1C;AAAA,YACA;AAAA,UACF,CAAU;AAAA,UAEV,QAAQ,kBAAkB,YAAY;AAAA,YACpC;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACF,CAAU;AAAA,UAEV,SAAS,kBAAkB,iBAAiB;AAAA,YAC1C;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACF,CAAU;AAAA,UAEV,QAAQ,kBAAkB,gBAAgB,CAAC,QAAQ,cAAc,aAAa,CAAU;AAAA,UAExF,YAAY;AAAA,YACV,MAAM,CAAC,cAAuB,iBAAiB,oBAAoB,QAAQ,SAAS;AAAA,YACpF,gBAAgB,CAAC,YAAqB,iBAAiB,oBAAoB,kBAAkB,OAAO;AAAA,YACpG,aAAa,CAAC,YAAqB,iBAAiB,oBAAoB,eAAe,OAAO;AAAA,YAC9F,eAAe,CAAC,YAAqB,iBAAiB,oBAAoB,iBAAiB,OAAO;AAAA,YAClG,aAAa,MAAM,iBAAiB,oBAAoB,aAAa;AAAA,YACrE,UAAU,MAAM,iBAAiB,oBAAoB,UAAU;AAAA,YAC/D,UAAU,MAAM,iBAAiB,oBAAoB,UAAU;AAAA,YAC/D,kBAAkB,CAAC,WAAoB,iBAAiB,oBAAoB,oBAAoB,MAAM;AAAA,UACxG;AAAA,UAEA,UAAU;AAAA,YACR,MAAM,CAAC,cAAuB,iBAAiB,kBAAkB,QAAQ,SAAS;AAAA,YAClF,aAAa,CAAC,YAAqB,iBAAiB,kBAAkB,eAAe,OAAO;AAAA,YAC5F,qBAAqB,MAAM,iBAAiB,kBAAkB,qBAAqB;AAAA,YACnF,wBAAwB,MAAM,iBAAiB,kBAAkB,wBAAwB;AAAA,UAC3F;AAAA,UAEA,QAAQ;AAAA,YACN,UAAU,CAAC,WAAoB,iBAAiB,iBAAiB,YAAY,MAAM;AAAA,YACnF,aAAa,CAAC,YAAqB,iBAAiB,iBAAiB,eAAe,OAAO;AAAA,YAC3F,WAAW,CAAC,OAAgB,iBAAiB,iBAAiB,aAAa,EAAE;AAAA,YAC7E,MAAM,CAAC,OAAgB,iBAAiB,iBAAiB,QAAQ,EAAE;AAAA,YACnE,OAAO,CAAC,OAAgB,iBAAiB,iBAAiB,SAAS,EAAE;AAAA,YACrE,cAAc,CAAC,OAAgB,iBAAiB,iBAAiB,gBAAgB,EAAE;AAAA,YACnF,cAAc,MAAM,iBAAiB,iBAAiB,cAAc;AAAA,YACpE,gBAAgB,CAAC,OAAgB,iBAAiB,iBAAiB,kBAAkB,EAAE;AAAA,YACvF,iBAAiB,MAAiB,iBAAiB,iBAAiB,iBAAiB,KAAkB,CAAC;AAAA,YACxG,wBAAwB,MACrB,iBAAiB,iBAAiB,wBAAwB,KAAkB,CAAC;AAAA,YAChF,mBAAmB,CAAC,OAAgB,iBAAiB,iBAAiB,qBAAqB,EAAE;AAAA,YAC7F,mBAAmB,MAAM,iBAAiB,iBAAiB,mBAAmB;AAAA,UAChF;AAAA,UAEA,QAAQ;AAAA,YACN,UAAU,CAAC,MAAe,YAAqB,iBAAiB,aAAa,YAAY,MAAM,OAAO;AAAA,YACtG,aAAa,CAAC,YAAqB,iBAAiB,aAAa,eAAe,OAAO;AAAA,YACvF,SAAS,CAAC,MAAe,QAAiB,YACxC,iBAAiB,aAAa,WAAW,MAAM,QAAQ,OAAO;AAAA,UAClE;AAAA,UAEA,MAAM;AAAA,YACJ,WAAW,CAAC,KAAa,aAA8B;AACrD,oBAAMC,WAAU,cAAc,SAAS;AACvC,kBAAIA,YAAW,OAAQA,SAAoC,WAAW,MAAM,YAAY;AACtF,sBAAM,SAAWA,SAAoC,WAAW,EAA4B,GAAG;AAC/F,uBAAO,WAAW,OAAO,WAAW,WAAW;AAAA,cACjD;AACA,qBAAO,YAAY;AAAA,YACrB;AAAA,YACA,uBAAuB,CAAC,SAAkB,iBAAiB,WAAW,yBAAyB,IAAI;AAAA,YACnG,uBAAuB,MAAe,iBAAiB,WAAW,uBAAuB,KAAgB;AAAA,YACzG,mBAAmB,MAAe,iBAAiB,WAAW,mBAAmB,KAAgB;AAAA,YACjG,mBAAmB,MAAM,iBAAiB,WAAW,mBAAmB;AAAA,UAC1E;AAAA,UAEA,SAAS,kBAAkB,kBAAkB;AAAA,YAC3C;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACF,CAAU;AAAA,UAEV,SAAS;AAAA,YACP,kBAAkB,MAAc;AAC9B,oBAAM,SAAS,SAAS,cAAc,eAAe;AACrD,kBAAI,CAAC,OAAQ,QAAO;AACpB,qBAAO,OAAO,sBAAsB,EAAE;AAAA,YACxC;AAAA,YAEA,sBAAsB,CAAC,WAA6B;AAClD,oBAAM,KAAK,cAAc,sBAAsB;AAC/C,kBAAI,OAAO,OAAO,YAAY;AAC5B,uBAAQ,GAA+B,MAAM;AAAA,cAC/C;AACA,qBAAO;AAAA,YACT;AAAA,YAEA,oBAAoB,CAAC,SAA2B;AAC9C,oBAAM,KAAK,cAAc,oBAAoB;AAC7C,kBAAI,OAAO,OAAO,YAAY;AAC5B,uBAAQ,GAA+B,IAAI;AAAA,cAC7C;AACA,qBAAO;AAAA,YACT;AAAA,YAEA,iBAAiB,CAAC,SAAwB;AACxC,oBAAM,KAAK,cAAc,iBAAiB;AAC1C,kBAAI,OAAO,OAAO,YAAY;AAC5B,gBAAC,GAA4B,IAAI;AAAA,cACnC;AAAA,YACF;AAAA,YAEA,iBAAiB,MAAY;AAC3B,oBAAM,KAAK,cAAc,iBAAiB;AAC1C,kBAAI,OAAO,OAAO,YAAY;AAC5B,gBAAC,GAAkB;AAAA,cACrB;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAEA,QAAC,OAA0C,MAAMD;AAGjD,cAAM,sBAAsB,CAAC,YAAuD;AAClF,iBAAO,YAAa,MAA0B;AAC5C,kBAAM,QAAQ,QAAQ,MAAM,GAAG;AAC/B,gBAAI,KAAcA;AAClB,uBAAW,QAAQ,OAAO;AACxB,mBAAM,GAA+B,IAAI;AACzC,kBAAI,CAAC,IAAI;AACP,wBAAQ,KAAK,mBAAmB,OAAO,iBAAiB;AACxD,uBAAO;AAAA,cACT;AAAA,YACF;AACA,gBAAI,OAAO,OAAO,YAAY;AAC5B,qBAAQ,GAAoC,GAAG,IAAI;AAAA,YACrD;AACA,mBAAO;AAAA,UACT;AAAA,QACF;AAEA,cAAM,IAAI;AAGV,UAAE,qBAAqB,oBAAoB,0BAA0B;AACrE,UAAE,qBAAqB,oBAAoB,0BAA0B;AAGrE,UAAE,qBAAqB,oBAAoB,yBAAyB;AACpE,UAAE,iBAAiB,oBAAoB,qBAAqB;AAC5D,UAAE,wBAAwB,oBAAoB,4BAA4B;AAG1E,UAAE,wBAAwB,oBAAoB,4BAA4B;AAC1E,UAAE,wBAAwB,oBAAoB,4BAA4B;AAG1E,UAAE,wBAAwB,oBAAoB,4BAA4B;AAC1E,UAAE,6BAA6B,oBAAoB,iCAAiC;AAGpF,UAAE,cAAc,oBAAoB,qBAAqB;AACzD,UAAE,sBAAsB,oBAAoB,6BAA6B;AAGzE,UAAE,2BAA2B,oBAAoB,iCAAiC;AAClF,UAAE,0BAA0B,oBAAoB,gCAAgC;AAChF,UAAE,qBAAqB,oBAAoB,2BAA2B;AACtE,UAAE,sBAAsB,oBAAoB,4BAA4B;AACxE,UAAE,qBAAqB,oBAAoB,2BAA2B;AACtE,UAAE,iBAAiB,oBAAoB,uBAAuB;AAG9D,UAAE,kBAAkB,oBAAoB,yBAAyB;AACjE,UAAE,mBAAmB,oBAAoB,0BAA0B;AACnE,UAAE,mBAAmB,oBAAoB,0BAA0B;AACnE,UAAE,iBAAiB,oBAAoB,wBAAwB;AAC/D,UAAE,oBAAoB,oBAAoB,2BAA2B;AACrE,UAAE,sBAAsB,oBAAoB,6BAA6B;AACzE,UAAE,yBAAyB,oBAAoB,gCAAgC;AAC/E,UAAE,oBAAoB,oBAAoB,2BAA2B;AAAA,MACvE,GAAG;AAAA;AAAA;;;ACvPH,WAAS,MAAM,GAAmB;AAC9B,WAAO,KAAK,IAAI,GAAG,kBAAkB;AAAA,EACzC;AAEA,WAAS,YACL,UACA,QACA,OACA,UACI;AAhDR;AAiDI,UAAM,UAAqC,CAAC;AAC5C,QAAI,MAAO,SAAQ,KAAK,KAAK;AAC7B,QAAI,YAAY,aAAa,MAAO,SAAQ,KAAK,QAAQ;AAEzD,UAAM,UAAU,SAAS,SAAS,eAAe,QAAQ;AACzD,QAAI,WAAW,CAAC,QAAQ,SAAS,OAAO,EAAG,SAAQ,KAAK,OAAO;AAC/D,UAAM,eAAc,wCAAS,kBAAT,iCAAyB;AAC7C,QAAI,eAAe,CAAC,QAAQ,SAAS,WAAW,EAAG,SAAQ,KAAK,WAAW;AAC3E,UAAM,aAAY,wCAAS,kBAAT,iCAAyB;AAC3C,QAAI,aAAa,CAAC,QAAQ,SAAS,SAAS,EAAG,SAAQ,KAAK,SAAS;AAErE,YAAQ,QAAQ,YAAU;AACtB,UAAI,CAAC,OAAQ;AACb,aAAO,MAAM,SAAS,OAAO,SAAS;AAAA,IAC1C,CAAC;AAAA,EACL;AAEA,WAAS,qBAAqB,OAA2B;AACrD,aAAS,IAAI,MAAM,SAAS,GAAG,KAAK,GAAG,KAAK,GAAG;AAC3C,YAAM,KAAK,MAAM,CAAC;AAClB,UAAI,CAAC,IAAI;AACL,cAAM,OAAO,GAAG,CAAC;AACjB;AAAA,MACJ;AACA,YAAM,KAAK,SAAS,eAAe,EAAE;AACrC,UAAI,CAAC,MAAM,GAAG,UAAU,SAAS,QAAQ,GAAG;AACxC,cAAM,OAAO,GAAG,CAAC;AAAA,MACrB;AAAA,IACJ;AACA,WAAO;AAAA,EACX;AAEA,WAAS,sBAA0C;AAC/C,QAAI,MAA0B;AAC9B,QAAI,UAAU;AACd,aAAS,iBAA8B,qBAAqB,EAAE,QAAQ,WAAS;AAC3E,YAAM,IAAI,SAAS,iBAAiB,KAAK,EAAE,QAAQ,EAAE,KAAK;AAC1D,UAAI,IAAI,SAAS;AACb,kBAAU;AACV,cAAM;AAAA,MACV;AAAA,IACJ,CAAC;AACD,WAAO;AAAA,EACX;AAEA,WAAS,SAAS,UAAsD;AA9FxE;AAgGI,UAAM,gBAAc,0CAAU,mBAAV,sCAAgC,CAAC;AACrD,UAAM,eAAeE;AACrB,WAAO,EAAE,aAAa,CAAC,GAAG,WAAW,GAAG,aAAa;AAAA,EACzD;AAEO,WAAS,mBAAkC;AArGlD;AAsGI,UAAM,MAAM;AAKZ,UAAM,WAAW,IAAI;AACrB,UAAM,eAAc,gDAAU,iBAAV,kDAA8BA;AAClD,UAAM,YAAY;AAAA,MACd,OAAO,MAAM,WAAW;AAAA,IAC5B;AACA,UAAM,eAAe,CAAC,MAAc;AAChC,gBAAU,QAAQ,MAAM,CAAC;AAEzB,MAAC,IAAgC,iBAAiB,UAAU;AAAA,IAChE;AACA,UAAM,eAAe,MAAM,UAAU;AAErC,QAAI,YAAY,OAAO,SAAS,iBAAiB,YAAY;AAEzD,UAAI,OAAO,SAAS,wBAAwB,YAAY;AACpD,QAAC,SAAgC,sBAAsB,MAAM;AA1HzE,cAAAC;AA2HgB,gBAAM,UAASA,MAAA,SAAgC,mBAAhC,gBAAAA,IAAA,mBAAsD;AACrE,iBAAO,QAAQ,SAAS,eAAe,KAAK,IAAI,oBAAoB;AAAA,QACxE;AAAA,MACJ;AACA,UAAI,OAAO,SAAS,mBAAmB,YAAY;AAC/C,QAAC,SAAgC,iBAAiB,MAAM;AAhIpE,cAAAA,KAAAC;AAiIgB,gBAAM,UAASD,MAAA,SAAgC,mBAAhC,gBAAAA,IAAA,mBAAsD,CAAC;AACtE,gBAAM,SAAS,qBAAqB,CAAC,GAAG,KAAK,CAAC;AAC9C,cAAI,OAAO,SAAS,EAAG,SAAOC,MAAA,OAAO,OAAO,SAAS,CAAC,MAAxB,OAAAA,MAA6B;AAC3D,gBAAM,WAAW,oBAAoB;AACrC,iBAAO,WAAW,SAAS,KAAK;AAAA,QACpC;AAAA,MACJ;AACA,UAAI,OAAO,SAAS,iBAAiB,YAAY;AAC7C,QAAC,SAAgC,eAAe,MAAM,aAAa;AAAA,MACvE;AACA,UAAI,OAAO,SAAS,eAAe,YAAY;AAC3C,QAAC,SAAgC,aAAa,MAAM;AAChD,wBAAc,aAAa,KAAKF,iBAAgB,CAAC;AACjD,iBAAO,aAAa;AAAA,QACxB;AAAA,MACJ;AACA,UAAI,OAAO,SAAS,oBAAoB,YAAY;AAChD,QAAC,SAAgC,kBAAkB,CAAC,MAAc;AAC9D,uBAAa,KAAK,IAAI,aAAa,GAAG,CAAC,CAAC;AACxC,iBAAO,aAAa;AAAA,QACxB;AAAA,MACJ;AACA,UAAI,OAAO,SAAS,gBAAgB,YAAY;AAC5C,QAAC,SAAgC,cAAc,MAAG;AAxJ9D,cAAAC,KAAAC;AAyJgB,kBAAAA,OAAAD,MAAA,SAAS,iBAAT,gBAAAA,IAAA,0BAAAC,MAA6BF;AAAA;AAAA,MACrC;AACA,UAAI,kBAAkB;AACtB,aAAO,IAAI;AAAA,IACf;AAEA,UAAM,QAAQ,SAAS,QAAQ;AAE/B,UAAM,iBAAiB,MAAY;AAC/B,YAAM,YAAY,QAAQ,CAAC,IAAI,UAAU;AACrC,cAAM,SAAS,MAAMA,gBAAe,KAAK;AACzC,oBAAY,IAAI,MAAM;AAAA,MAC1B,CAAC;AAED,YAAM,eAAeA,gBAAe,MAAM,YAAY;AACtD,mBAAa,KAAK,IAAI,cAAc,MAAM,YAAY,CAAC;AAAA,IAC3D;AAEA,UAAM,UAAyB;AAAA,MAC3B,aACI,UACA,OACA,UACM;AACN,cAAM,eAAe,MAAM,YAAY,QAAQ,QAAQ;AACvD,YAAI,iBAAiB,IAAI;AACrB,gBAAM,YAAY,OAAO,cAAc,CAAC;AAAA,QAC5C;AACA,cAAM,YAAY,KAAK,QAAQ;AAC/B,uBAAe;AACf,cAAM,WAAW,MAAMA,gBAAe,MAAM,YAAY,SAAS,CAAC;AAClE,oBAAY,UAAU,UAAU,OAAO,QAAQ;AAC/C,eAAO,QAAQ,aAAa;AAAA,MAChC;AAAA,MAEA,aAAa,UAAwB;AACjC,cAAM,MAAM,MAAM,YAAY,QAAQ,QAAQ;AAC9C,YAAI,QAAQ,IAAI;AACZ,gBAAM,YAAY,OAAO,KAAK,CAAC;AAC/B,yBAAe;AAAA,QACnB;AAAA,MACJ;AAAA,MAEA,iBAA2B;AACvB,eAAO,CAAC,GAAG,MAAM,WAAW;AAAA,MAChC;AAAA,MAEA,mBAAmB,YAA4B;AAC3C,cAAM,YAAY,SAAS;AAC3B,mBAAW,QAAQ,QAAM;AACrB,gBAAM,KAAK,SAAS,eAAe,EAAE;AACrC,cAAI,GAAI,OAAM,YAAY,KAAK,EAAE;AAAA,QACrC,CAAC;AACD,uBAAe;AAAA,MACnB;AAAA,MAEA,QAAc;AACV,cAAM,YAAY,SAAS;AAC3B,cAAM,eAAeA;AACrB,qBAAaA,aAAY;AAAA,MAC7B;AAAA,MAEA,iBAAgC;AAvNxC,YAAAC;AAwNY,6BAAqB,MAAM,WAAW;AACtC,YAAI,MAAM,YAAY,SAAS;AAC3B,kBAAOA,MAAA,MAAM,YAAY,MAAM,YAAY,SAAS,CAAC,MAA9C,OAAAA,MAAmD;AAC9D,cAAM,WAAW,oBAAoB;AACrC,eAAO,WAAW,SAAS,KAAK;AAAA,MACpC;AAAA,MAEA,sBAA0C;AACtC,cAAM,QAAQ,QAAQ,eAAe;AACrC,YAAI,MAAO,QAAO,SAAS,eAAe,KAAK;AAC/C,eAAO,oBAAoB;AAAA,MAC/B;AAAA,MAEA,eAAuB;AACnB,cAAM,YAAYD,gBAAe,MAAM,YAAY;AACnD,cAAM,QAAQ,MAAM,KAAK,IAAI,WAAW,MAAM,YAAY,CAAC;AAC3D,qBAAa,KAAK;AAClB,eAAO;AAAA,MACX;AAAA,MAEA,aAAqB;AAEjB,cAAM,gBAAgBA,gBAAe,MAAM,YAAY,SAAS;AAChE,cAAM,eAAe,MAAM,KAAK,IAAI,MAAM,eAAe,GAAG,aAAa,CAAC;AAC1E,qBAAa,MAAM,YAAY;AAC/B,eAAO,MAAM;AAAA,MACjB;AAAA,MAEA,gBAAgB,GAAmB;AAC/B,cAAM,eAAe,MAAM,KAAK,IAAI,MAAM,cAAc,CAAC,CAAC;AAC1D,cAAM,gBAAgBA,gBAAe,MAAM,YAAY;AACvD,qBAAa,KAAK,IAAI,eAAe,MAAM,YAAY,CAAC;AACxD,eAAO,aAAa;AAAA,MACxB;AAAA,MAEA,cAAsB;AAClB,YAAI,OAAOA;AACX,iBAAS,iBAA8B,QAAQ,EAAE,QAAQ,WAAS;AAC9D,gBAAM,SAAS,SAAS,OAAO,iBAAiB,KAAK,EAAE,QAAQ,EAAE;AACjE,cAAI,CAAC,OAAO,MAAM,MAAM,EAAG,QAAO,KAAK,IAAI,MAAM,MAAM;AACvD,gBAAM,QAAQ,MAAM,cAAc,cAAc;AAChD,cAAI,OAAO;AACP,kBAAM,OAAO,SAAS,OAAO,iBAAiB,KAAK,EAAE,QAAQ,EAAE;AAC/D,gBAAI,CAAC,OAAO,MAAM,IAAI,EAAG,QAAO,KAAK,IAAI,MAAM,IAAI;AAAA,UACvD;AAAA,QACJ,CAAC;AACD,cAAM,eAAe,MAAM,KAAK,IAAI,MAAM,cAAc,IAAI,CAAC;AAC7D,eAAO,QAAQ,aAAa;AAAA,MAChC;AAAA,IACJ;AAEA,QAAI,kBAAkB;AACtB,mBAAe;AACf,WAAO;AAAA,EACX;AA9QA,MA6BaA,eACP;AA9BN;AAAA;AAAA;AA6BO,MAAMA,gBAAe;AAC5B,MAAM,qBAAqB;AAAA;AAAA;;;AC9B3B;AAAA;AAAA;AAKA;AAEA,OAAC,MAAM;AACH;AAAA,QA4BA,MAAM,aAAa;AAAA,UASf,YAAY,SAA8B;AA7ClD;AA8CY,iBAAK,KAAK,QAAQ;AAClB,iBAAK,OAAO,QAAQ,QAAQ;AAC5B,iBAAK,aAAa,QAAQ,cAAc;AACxC,iBAAK,OAAO,QAAQ,QAAQ;AAC5B,iBAAK,iBAAgB,aAAQ,kBAAR,YAAyB;AAC9C,iBAAK,iBAAiB;AACtB,iBAAK,WAAW,QAAQ,YAAY,CAAC;AAAA,UACzC;AAAA,UAEA,cAAuB;AACnB,mBAAO,KAAK,SAAS;AAAA,UACzB;AAAA,UAEA,iBAA8B;AAC1B,kBAAM,IAAI;AACV,kBAAM,OACD,EAAE,SAAS,KAA2D;AAC3E,kBAAMG,cAAY,6BAAM,eAAc,CAAC,QAAgB;AAEvD,kBAAM,cAAc,CAAC,QAAQ,WAAW,WAAW,WAAW;AAC9D,kBAAM,OAAoB;AAAA,cACtB,SAAS,KAAK;AAAA,cACd,cAAcA,WAAU,GAAG,KAAK,UAAU,QAAQ;AAAA,cAClD,WAAWA,WAAU,GAAG,KAAK,UAAU,YAAY;AAAA,cACnD,qBACK,KAAK,SAAS,uBAAkC;AAAA,cACrD,MAAM,KAAK;AAAA,cACX,OAAO,CAAC;AAAA,YACZ;AACA,wBAAY,QAAQ,WAAS;AACzB,mBAAK,MAAM,KAAK,IAAIA,WAAU,GAAG,KAAK,UAAU,UAAU,KAAK,EAAE;AAAA,YACrE,CAAC;AACD,mBAAO;AAAA,UACX;AAAA,QACJ;AAEA,cAAM,iBAAiB,oBAAI,IAA0B;AACrD,cAAM,gBAAgB,iBAAiB;AAEvC,cAAM,gBAAgB;AAAA;AAAA;AAAA;AAAA,UAIlB,eAAuB;AACnB,mBAAO,cAAc,aAAa;AAAA,UACtC;AAAA;AAAA;AAAA;AAAA,UAKA,gBAAgB,WAAyB;AACrC,0BAAc,gBAAgB,SAAS;AAAA,UAC3C;AAAA,UACA,SAAS,QAA2C;AAChD,kBAAM,eAAe,IAAI,aAAa,MAAM;AAC5C,2BAAe,IAAI,OAAO,IAAI,YAAY;AAC1C,mBAAO;AAAA,UACX;AAAA,UAEA,YAAY,SAAsC;AAC9C,oBAAQ,QAAQ,OAAK,KAAK,SAAS,CAAC,CAAC;AAAA,UACzC;AAAA,UAEA,UAAU,UAAuC;AAC7C,mBAAO,eAAe,IAAI,QAAQ,KAAK;AAAA,UAC3C;AAAA,UAEA,kBAA4B;AACxB,mBAAO,MAAM,KAAK,eAAe,KAAK,CAAC;AAAA,UAC3C;AAAA,UAEA,yBAAmC;AAC/B,mBAAO,KAAK,gBAAgB,EAAE,OAAO,QAAM;AACvC,oBAAM,SAAS,KAAK,UAAU,EAAE;AAChC,qBAAO,CAAC,CAAC,UAAU,CAAC,OAAO,YAAY;AAAA,YAC3C,CAAC;AAAA,UACL;AAAA,UAEA,wBAAkC;AAC9B,mBAAO,KAAK,gBAAgB,EAAE,OAAO,QAAM;AACvC,oBAAM,SAAS,KAAK,UAAU,EAAE;AAChC,qBAAO,CAAC,CAAC,UAAU,OAAO,YAAY;AAAA,YAC1C,CAAC;AAAA,UACL;AAAA,UAEA,kBAAkB,UAAkB,UAA4B;AAC5D,kBAAM,SAAS,KAAK,UAAU,QAAQ;AACtC,gBAAI,QAAQ;AACR,qBAAO,iBAAiB;AAAA,YAC5B;AAAA,UACJ;AAAA,UAEA,kBAAkB,UAA8B;AAC5C,kBAAM,SAAS,KAAK,UAAU,QAAQ;AACtC,mBAAQ,UAAU,OAAO,kBAAmB;AAAA,UAChD;AAAA,UAEA,wBAAoD;AAChD,kBAAM,UAAsC,CAAC;AAC7C,2BAAe,QAAQ,CAAC,QAAQ,OAAO;AACnC,kBAAI,OAAO,gBAAgB;AACvB,wBAAQ,EAAE,IAAI,OAAO;AAAA,cACzB;AAAA,YACJ,CAAC;AACD,mBAAO;AAAA,UACX;AAAA,UAEA,eAAmC;AAC/B,mBAAO,cAAc,oBAAoB;AAAA,UAC7C;AAAA,UAEA,aAAa,UAAwB;AACjC,kBAAM,WAAW,KAAK,kBAAkB,QAAQ;AAChD,gBAAI,YAAY,OAAO,SAAS,iBAAiB,YAAY;AACzD,uBAAS,aAAa;AACtB;AAAA,YACJ;AAEA,kBAAM,QAAQ,SAAS,eAAe,QAAQ;AAC9C,gBAAI,CAAC,OAAO;AACR,sBAAQ,KAAK,+BAA4B,QAAQ,YAAY;AAC7D;AAAA,YACJ;AACA,kBAAM,WAAW,KAAK,uBAAuB,KAAK;AAClD,0BAAc,aAAa,UAAU,OAAO,QAAQ;AAAA,UACxD;AAAA,UAEA,KAAK,UAAwB;AACzB,kBAAM,SAAS,KAAK,UAAU,QAAQ;AAGtC,kBAAM,IAAI;AAGV,kBAAM,yBAAyB,CAAC,GAC5B,iCAAQ,aACP,OAAO,SACH;AAGT,gBACI,UACA,OAAO,YACP,OAAQ,OAAO,SAAqC,gBAAgB,eACnE,CAAC,EAAE,iCAAiC,yBACvC;AACE,kBAAI;AACA,sBAAM,KAAK,OAAO;AAGlB,oBAAI,OAAO,GAAG,gBAAgB,WAAY,IAAG,YAAY;AAAA,cAC7D,SAAS,GAAG;AACR,wBAAQ,KAAK,oBAAoB,QAAQ,WAAW,CAAC;AAAA,cACzD;AAAA,YACJ;AACA,kBAAM,WAAW,KAAK,kBAAkB,QAAQ;AAChD,gBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,uBAAS,KAAK;AAAA,YAClB,OAAO;AACH,oBAAM,QAAQ,SAAS,eAAe,QAAQ;AAC9C,kBAAI,OAAO;AACP,sBAAM,WAAY,OAAe;AACjC,oBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,2BAAS,KAAK,KAAK;AAAA,gBACvB,OAAO;AACH,wBAAM,UAAU,OAAO,QAAQ;AAAA,gBACnC;AACA,qBAAK,aAAa,QAAQ;AAAA,cAC9B;AAAA,YACJ;AAAA,UACJ;AAAA,UAEA,MAAM,UAAwB;AAC1B,kBAAM,WAAW,KAAK,kBAAkB,QAAQ;AAChD,gBAAI,YAAY,OAAO,SAAS,UAAU,YAAY;AAClD,uBAAS,MAAM;AAAA,YACnB,OAAO;AACH,oBAAM,QAAQ,SAAS,eAAe,QAAQ;AAC9C,kBAAI,OAAO;AACP,sBAAM,WAAY,OAAe;AACjC,oBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,2BAAS,KAAK,KAAK;AAAA,gBACvB,OAAO;AACH,wBAAM,UAAU,IAAI,QAAQ;AAAA,gBAChC;AAAA,cACJ;AAAA,YACJ;AAAA,UACJ;AAAA,UAEA,gBAAwB;AACpB,mBAAO,cAAc,WAAW;AAAA,UACpC;AAAA,UAEA,oBAA4B;AACxB,mBAAO,cAAc,YAAY;AAAA,UACrC;AAAA,UAEA,uBAAuB,OAA+C;AAClE,gBAAI,CAAC,MAAO,QAAO;AACnB,mBAAQ,MAAM,cAAc,cAAc,KAA4B;AAAA,UAC1E;AAAA,UAEA,eAAe,UAA+B;AAC1C,kBAAM,SAAS,KAAK,UAAU,QAAQ;AACtC,gBAAI,OAAQ,QAAO,OAAO,eAAe;AACzC,mBAAO,KAAK,sBAAsB;AAAA,UACtC;AAAA,UAEA,wBAAqC;AACjC,kBAAM,IAAI;AACV,kBAAM,OACD,EAAE,SAAS,KAA2D;AAC3E,kBAAMA,cAAY,6BAAM,eAAc,CAAC,QAAgB;AACvD,kBAAM,aAAa;AACnB,mBAAO;AAAA,cACH,SAAS;AAAA,cACT,cAAcA,WAAU,GAAG,UAAU,QAAQ;AAAA,cAC7C,WAAWA,WAAU,GAAG,UAAU,YAAY;AAAA,cAC9C,qBAAqB;AAAA,cACrB,MAAM;AAAA,cACN,OAAO;AAAA,gBACH,MAAMA,WAAU,GAAG,UAAU,aAAa;AAAA,gBAC1C,SAASA,WAAU,GAAG,UAAU,gBAAgB;AAAA,gBAChD,SAASA,WAAU,GAAG,UAAU,gBAAgB;AAAA,gBAChD,WAAWA,WAAU,GAAG,UAAU,kBAAkB;AAAA,cACxD;AAAA,YACJ;AAAA,UACJ;AAAA,UAEA,IAAI,YAAoB;AACpB,mBAAO,cAAc,aAAa;AAAA,UACtC;AAAA,UACA,IAAI,UAAU,OAAe;AACzB,0BAAc,gBAAgB,KAAK;AAAA,UACvC;AAAA,UACA,IAAI,aAAqB;AACrB,mBAAOC;AAAA,UACX;AAAA,QACJ;AAEA,QAAC,OAA8D,gBAAgB;AAE/E,eAAO,eAAe,QAAQ,aAAa;AAAA,UACvC,KAAK,MAAM,cAAc;AAAA,UACzB,KAAK,CAAC,UAAkB;AACpB,0BAAc,YAAY;AAAA,UAC9B;AAAA,QACJ,CAAC;AAAA,MACL,GAAG;AAAA;AAAA;;;AC3RI,WAAS,cAAc,SAA+B;AACzD,UAAM,SAAiB,CAAC;AACxB,eAAW,OAAO,SAAS;AACvB,UAAI,QAAQ,YAAY,QAAQ,cAAe;AAC/C,aAAO,GAAG,IAAI,QAAQ,GAAG;AAAA,IAC7B;AACA,WAAO;AAAA,EACX;AAKO,WAAS,YAAY,OAAe,IAAsB;AAC7D,QAAI;AACA,SAAG;AAAA,IACP,SAAS,OAAO;AACZ,cAAQ,KAAK,GAAG,KAAK,YAAY,KAAK;AAAA,IAC1C;AAAA,EACJ;AAKO,WAAS,UAAuB,MAA6B;AAChE,UAAM,QAAQ,KAAK,MAAM,GAAG,EAAE,OAAO,OAAO;AAC5C,QAAI,UAAe;AACnB,eAAW,KAAK,OAAO;AACnB,UAAI,WAAW,OAAO,YAAY,YAAY,KAAK,SAAS;AACxD,kBAAU,QAAQ,CAAC;AAAA,MACvB,OAAO;AACH,eAAO;AAAA,MACX;AAAA,IACJ;AACA,WAAO;AAAA,EACX;AA7CA;AAAA;AAAA;AAAA;AAAA;;;ACMO,WAAS,mBAA8B;AAC1C,WAAO;AAAA,MACH,qBAAqB,MAAM;AARnC;AASY,cAAM,SAAS,UAAuC,cAAc;AACpE,+CAAQ,eAAR;AAAA,MACJ;AAAA,MAEA,iBAAiB,MAAM;AAb/B;AAcY,cAAM,SAAS,UAGZ,cAAc;AACjB,cAAM,QAAO,4CAAQ,aAAR,uDAAsB;AACnC,+CAAQ,eAAR,gCAAqB,CAAC,GAAG;AAAA,MAC7B;AAAA,MAEA,qBAAqB,CAAC,WAAmB;AAtBjD;AAuBY,cAAM,OAAO,OAAO,YAAY,KAAK,OAAO;AAC5C,YAAI,CAAC,MAAM;AACP,kBAAQ,KAAK,uCAAuC;AACpD;AAAA,QACJ;AACA,cAAM,SAAS;AAAA,UACX;AAAA,QACJ;AACA,+CAAQ,eAAR,gCAAqB,CAAC,GAAG;AAAA,MAC7B;AAAA,MAEA,sBAAsB,CAAC,WAAmB;AAlClD;AAmCY,cAAM,OAAO,OAAO,UAAU,KAAK,OAAO,MAAM;AAChD,YAAI,CAAC,MAAM;AACP,kBAAQ,KAAK,sCAAsC;AACnD;AAAA,QACJ;AACA,cAAM,SAAS,UAAoD,cAAc;AACjF,+CAAQ,gBAAR,gCAAsB;AAAA,MAC1B;AAAA,MAEA,oBAAoB,CAAC,WAAmB;AA5ChD;AA6CY,cAAM,QAAQ,OAAO,QAAQ,KAAK,OAAO,OAAO;AAChD,YAAI,CAAC,OAAO;AACR,kBAAQ,KAAK,kCAAkC;AAC/C;AAAA,QACJ;AACA,cAAM,SAAS,UAAmD,cAAc;AAChF,+CAAQ,cAAR,gCAAoB;AAAA,MACxB;AAAA,MAEA,yBAAyB,CAAC,WAAmB;AAtDrD;AAuDY,cAAM,MAAM,OAAO,QAAQ;AAC3B,cAAM,QAAQ,OAAO,QAAQ,YAAY,IAAI,SAAS,IAAI,MAAM,GAAG,IAAI,CAAC;AACxE,cAAM,SAAS,UAAsD,cAAc;AACnF,+CAAQ,eAAR,gCAAqB;AAAA,MACzB;AAAA,MAEA,mBAAmB,CAAC,WAAmB;AA7D/C;AA8DY,cAAM,OAAO,OAAO,UAAU,KAAK,OAAO,MAAM;AAChD,cAAM,OAAO,OAAO,UAAU,KAAK,OAAO,MAAM;AAChD,YAAI,CAAC,QAAQ,CAAC,MAAM;AAChB,kBAAQ,KAAK,oCAAoC;AACjD;AAAA,QACJ;AACA,cAAM,SAAS;AAAA,UACX;AAAA,QACJ;AACA,+CAAQ,aAAR,gCAAmB,MAAgB;AAAA,MACvC;AAAA,IACJ;AAAA,EACJ;AA1EA;AAAA;AAAA;AAIA;AAAA;AAAA;;;ACEO,WAAS,oBAA+B;AAC3C,WAAO;AAAA,MACH,iBAAiB,CAAC,WAAmB;AACjC,oBAAY,mBAAmB,MAAM;AATjD;AAUgB,gBAAM,SAAU,OAAO,KAAK,KAAK,OAAO,KAAK,KAAK,OAAO,UAAU;AAGnE,gBAAM,MAAO,OAAO,MAAM,KAAK,OAAO,QAAQ;AAC9C,gBAAM,MAAM,SAAU,OAAO,OAAO,KAAK,KAAgB,EAAE,KAAK;AAChE,gBAAM,OAAQ,OAAO,MAAM,KAAK,OAAO,WAAW;AAElD,gBAAM,UAAU,UAEb,wBAAwB;AAC3B,gBAAM,SAAS;AAAA,YACX;AAAA,UACJ;AAEA,cAAI,QAAQ;AACR,kBAAM,OAAO,CAAC,MAAM;AACpB,qDAAS,eAAT,iCAAsB,MAAM,GAAG;AAC/B;AAAA,UACJ;AAEA,cAAI,KAAK;AACL,kBAAM,OAAO,IACR,MAAM,GAAG,EACT,IAAI,OAAK,EAAE,KAAK,CAAC,EACjB,OAAO,OAAO;AACnB,gBAAI,KAAK,QAAQ;AACb,uDAAS,eAAT;AAAA;AAAA,gBACI;AAAA,gBACA,KAAK,IAAI,GAAG,KAAK,IAAI,KAAK,KAAK,SAAS,CAAC,CAAC;AAAA,gBAC1C;AAAA;AAAA,YAER;AACA;AAAA,UACJ;AAEA,gBAAM,WAAY,OAAO,UAAU,KAAK,OAAO,MAAM;AACrD,cAAI,UAAU;AACV,mDAAQ,aAAR,gCAAmB,UAAU;AAAA,UACjC;AAAA,QACJ,CAAC;AAAA,MACL;AAAA,IACJ;AAAA,EACJ;AApDA;AAAA;AAAA;AAIA;AAAA;AAAA;;;ACEO,WAAS,oBAA+B;AAC3C,WAAO;AAAA,MACH,kBAAkB,MAAM;AARhC;AASY,cAAM,IAAI,UAGP,EAAE;AACL,cAAMC,eAAY,4BAAG,YAAH,mBAAY,eAAc,CAAC,MAAc;AAE3D,YAAI,GAAC,4BAAG,mBAAH,mBAAmB,gBAAe;AACnC,kBAAQ,MAAM,8BAA8B;AAC5C;AAAA,QACJ;AAEA,cAAM,OAAO,EAAE,eAAe,cAAc;AAC5C,YAAI,CAAC,MAAM;AACP,gBAAMA,WAAU,wBAAwB,CAAC;AACzC;AAAA,QACJ;AAEA,cAAM,OAAO,IAAI,KAAK,CAAC,IAAI,GAAG,EAAE,MAAM,mBAAmB,CAAC;AAC1D,cAAM,MAAM,IAAI,gBAAgB,IAAI;AACpC,cAAM,IAAI,SAAS,cAAc,GAAG;AACpC,UAAE,OAAO;AACT,UAAE,WAAW,YAAW,oBAAI,KAAK,GAAE,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC;AAC7D,iBAAS,KAAK,YAAY,CAAC;AAC3B,UAAE,MAAM;AACR,iBAAS,KAAK,YAAY,CAAC;AAC3B,YAAI,gBAAgB,GAAG;AAEvB,gBAAQ,IAAI,+BAA+B;AAAA,MAC/C;AAAA,MAEA,kBAAkB,MAAM;AAvChC;AAwCY,cAAM,IAAI,UAGP,EAAE;AACL,cAAMA,eAAY,4BAAG,YAAH,mBAAY,eAAc,CAAC,MAAc;AAE3D,YAAI,GAAC,4BAAG,mBAAH,mBAAmB,gBAAe;AACnC,kBAAQ,MAAM,8BAA8B;AAC5C;AAAA,QACJ;AAEA,cAAM,QAAQ,SAAS,cAAc,OAAO;AAC5C,cAAM,OAAO;AACb,cAAM,SAAS;AACf,cAAM,WAAW,OAAK;AAtDlC,cAAAC;AAuDgB,gBAAM,QAAQA,MAAA,EAAE,OAA4B,UAA9B,gBAAAA,IAAsC;AACpD,cAAI,CAAC,KAAM;AAEX,gBAAM,SAAS,IAAI,WAAW;AAC9B,iBAAO,SAAS,WAAS;AA3DzC,gBAAAA,KAAAC,KAAA;AA4DoB,kBAAM,QAAOD,MAAA,MAAM,WAAN,gBAAAA,IAAc;AAC3B,gBAAI,OAAO,SAAS,UAAU;AAC1B,oBAAMD,WAAU,0BAA0B,CAAC;AAC3C;AAAA,YACJ;AAEA,kBAAM,WAAU,MAAAE,MAAA,EAAE,mBAAF,gBAAAA,IAAkB,kBAAlB,wBAAAA,KAAkC;AAClD,gBAAI,SAAS;AACT,sBAAQ,IAAI,+BAA+B;AAAA,YAC/C,OAAO;AACH,oBAAMF,WAAU,0BAA0B,CAAC;AAAA,YAC/C;AAAA,UACJ;AACA,iBAAO,UAAU,MAAM;AACnB,kBAAMA,WAAU,0BAA0B,CAAC;AAAA,UAC/C;AACA,iBAAO,WAAW,IAAI;AAAA,QAC1B;AACA,cAAM,MAAM;AAAA,MAChB;AAAA,IACJ;AAAA,EACJ;AAjFA;AAAA;AAAA;AAIA;AAAA;AAAA;;;ACJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAkDO,WAAS,uBAAuB,WAAwB;AAC3D,cAAU,YAAY;AACtB,sBAAkB,QAAQ,cAAY;AAClC,YAAM,KAAK,SAAS,cAAc,QAAQ;AAC1C,SAAG,YAAY;AACf,SAAG,aAAa,eAAe,iBAAiB;AAChD,SAAG,aAAa,gBAAgB,SAAS,EAAE;AAC3C,SAAG;AAAA,QACC;AAAA,QACA,UAAU,SAAS,UAAU,CAAC,GAAG,EAAE,UAAU,SAAS,cAAc,CAAC;AAAA,MACzE;AAGA,YAAM,aAAa,SAAS,cAAc,KAAK;AAC/C,iBAAW,YAAY;AAEvB,UAAI,SAAS,MAAM;AACf,cAAM,MAAM,SAAS,cAAc,KAAK;AACxC,YAAI,MAAM,SAAS;AACnB,YAAI,MAAM,UAAU,SAAS,UAAU,CAAC,GAAG,EAAE,UAAU,SAAS,cAAc,CAAC;AAC/E,mBAAW,YAAY,GAAG;AAAA,MAC9B,WAAW,SAAS,OAAO;AACvB,mBAAW,cAAc,SAAS;AAAA,MACtC;AAEA,SAAG,YAAY,UAAU;AAEzB,YAAM,QAAQ,SAAS,cAAc,MAAM;AAC3C,YAAM,YAAY;AAClB,YAAM,cAAc,UAAU,SAAS,UAAU,CAAC,GAAG,EAAE,UAAU,SAAS,cAAc,CAAC;AACzF,SAAG,YAAY,KAAK;AAEpB,gBAAU,YAAY,EAAE;AAAA,IAC5B,CAAC;AAAA,EACL;AAEO,WAAS,2BAA2B,IAAY;AACnD,UAAM,WAAW,kBAAkB,KAAK,OAAK,EAAE,OAAO,EAAE;AACxD,QAAI,YAAY,SAAS,QAAQ;AAC7B,eAAS,OAAO;AAAA,IACpB;AAAA,EACJ;AAKO,WAAS,cAAc;AAC1B,UAAM,YAAY,SAAS,eAAe,eAAe;AACzD,QAAI,WAAW;AACX,6BAAuB,SAAS;AAAA,IACpC;AAAA,EACJ;AArGA,MAUM,KAWO;AArBb;AAAA;AAAA;AAEA;AAQA,MAAM,MAAO,OAAoC;AAW1C,MAAM,oBAAuC;AAAA,QAChD;AAAA,UACI,IAAI;AAAA,UACJ,OAAO;AAAA,UACP,UAAU;AAAA,UACV,eAAe;AAAA,UACf,QAAQ,MAAM;AA3BtB;AA4BY,kBAAM,IAAI;AACV,iBAAI,OAAE,iBAAF,mBAAgB,eAAe;AAC/B,gBAAE,aAAa,cAAc;AAAA,YACjC;AAEA,kBAAM,IAAI;AAGV,iBAAI,OAAE,iBAAF,mBAAgB,YAAY;AAC5B,gBAAE,aAAa,WAAW,UAAU;AAAA,YACxC;AAAA,UACJ;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAQJ;AAgEA,UAAI,OAAO,WAAW,aAAa;AAC/B,eAAO,gBAAgB;AAAA,UACnB;AAAA,QACJ;AAAA,MACJ;AAAA;AAAA;;;AC9GO,WAAS,mBAA8B;AAC1C,WAAO;AAAA,MACH,aAAa,CAAC,WAAmB;AARzC;AASY,cAAM,WAAW,OAAO;AACxB,YAAI,CAAC,UAAU;AACX,kBAAQ,KAAK,+BAA+B;AAC5C;AAAA,QACJ;AAEA,cAAM,KAAK,UAA4C,eAAe;AACtE,uCAAI,UAAJ,4BAAY;AAEZ,cAAM,IAAI,UAIP,EAAE;AACL,qCAAG,mBAAH;AACA,qCAAG,yBAAH;AACA,qCAAG,iCAAH;AAAA,MACJ;AAAA,MAEA,YAAY,CAAC,WAAmB;AA5BxC;AA6BY,cAAM,WAAW,OAAO;AAGxB,cAAM,iBAAiB,SAAS,eAAe,iBAAiB;AAChE,YAAI,kBAAkB,CAAC,eAAe,UAAU,SAAS,QAAQ,GAAG;AAChE,gBAAM,UAAU,UAAkD,SAAS;AAC3E,yDAAU,uBAAV,mBAA8B,UAA9B;AAAA,QACJ;AAGA,YAAI,CAAC,UAAU;AACX,gBAAM,SAAS,UAA0C,cAAc;AACvE,cAAI,iCAAQ,eAAe;AACvB,mBAAO,cAAc;AACrB;AAAA,UACJ;AACA,kBAAQ;AAAA,YACJ;AAAA,UACJ;AACA;AAAA,QACJ;AAGA,YAAI,aAAa,gBAAgB;AAC7B,sBAAY,uCAAuC,MAAM;AACrD,kBAAM,SAAS,UAA0C,cAAc;AACvE,gBAAI,iCAAQ,eAAe;AACvB,qBAAO,cAAc;AACrB;AAAA,YACJ;AACA,oBAAQ;AAAA,cACJ;AAAA,YACJ;AAAA,UACJ,CAAC;AAAA,QACL;AAGA,YAAI,aAAa,kBAAkB;AAC/B,sBAAY,yCAAyC,MAAM;AACvD,kBAAM,WAAW,UAA0C,gBAAgB;AAC3E,gBAAI,qCAAU,eAAe;AACzB,uBAAS,cAAc;AACvB;AAAA,YACJ;AACA,oBAAQ;AAAA,cACJ;AAAA,YACJ;AAAA,UACJ,CAAC;AAAA,QACL;AAEA,cAAM,KAAK,UAA2C,eAAe;AACrE,uCAAI,SAAJ,4BAAW;AAEX,cAAM,IAAI,UAAyD,EAAE;AACrE,qCAAG,iCAAH;AAAA,MACJ;AAAA,MAEA,gBAAgB,MAAM;AAtF9B;AAuFY,cAAM,IAAI,UAMP,EAAE;AACL,qCAAG,sBAAH;AAEA,cAAM,YAAW,kCAAG,kBAAH,mBAAkB,iBAAlB;AACjB,YAAI,QAAuB;AAC3B,YAAI,OAAO,aAAa,UAAU;AAC9B,kBAAQ;AAAA,QACZ,WAAW,YAAY,OAAO,aAAa,UAAU;AACjD,gBAAM,MAAM;AACZ,cAAI,OAAO,IAAI,OAAO,SAAU,SAAQ,IAAI;AAAA,QAChD;AACA,YAAI,CAAC,MAAO;AAEZ,2CAAG,kBAAH,mBAAkB,UAAlB,4BAA0B;AAC1B,qCAAG,mBAAH;AACA,qCAAG,yBAAH;AACA,qCAAG,iCAAH;AAAA,MACJ;AAAA,MAEA,mBAAmB,MAAM;AAhHjC;AAiHY,cAAM,IAAI;AAAA,UACN;AAAA,QACJ;AACA,qCAAG,sBAAH;AACA,qCAAG,sBAAH;AAAA,MACJ;AAAA,MAEA,iBAAiB,MAAM;AAxH/B;AAyHY,cAAM,IAAI,UAGP,EAAE;AACL,qCAAG,sBAAH;AACA,qCAAG,0BAAH,2BAA2B;AAAA,MAC/B;AAAA,MAEA,WAAW,MAAM;AAjIzB;AAkIY,cAAM,IAAI,UAIP,EAAE;AACL,qCAAG,sBAAH;AACA,iDAAG,YAAH,mBAAa,mBAAb,mBAA6B,SAA7B;AACA,qCAAG,iCAAH;AAAA,MACJ;AAAA,MAEA,cAAc,MAAM;AA5I5B;AA6IY,cAAM,IAAI,UAIP,EAAE;AACL,qCAAG,sBAAH;AACA,iDAAG,YAAH,mBAAa,sBAAb,mBAAgC,SAAhC;AACA,qCAAG,iCAAH;AAAA,MACJ;AAAA,MAEA,iBAAiB,CAAC,WAAmB;AACjC,cAAM,SAAS,OAAO;AACtB,YAAI,CAAC,QAAQ;AACT,kBAAQ,KAAK,iCAAiC;AAC9C;AAAA,QACJ;AAEA,wEAAwB,KAAK,CAAC,EAAE,mBAAAG,mBAAkB,MAAM;AACpD,gBAAM,WAAWA,mBAAkB,KAAK,OAAK,EAAE,OAAO,MAAM;AAC5D,cAAI,qCAAU,QAAQ;AAClB,qBAAS,OAAO;AAAA,UACpB,OAAO;AACH,oBAAQ,KAAK,8CAA8C,MAAM,GAAG;AAAA,UACxE;AAAA,QACJ,CAAC;AAAA,MACL;AAAA,IACJ;AAAA,EACJ;AAxKA;AAAA;AAAA;AAIA;AAAA;AAAA;;;ACJA;AAAA;AAAA;AAOA;AACA;AACA;AACA;AACA;AAEA,cAAQ,IAAI,kBAAkB;AAE9B,OAAC,WAAY;AACT;AAEA,cAAM,iBAAiB,oBAAI,IAAqB;AAChD,cAAM,iBAA6E,CAAC;AAEpF,cAAM,YAAY;AAAA,UACd,SAAS,YAAoB,SAAkB;AAC3C,gBAAI,CAAC,cAAc,OAAO,YAAY,YAAY;AAC9C,sBAAQ,MAAM,gCAAgC,UAAU;AACxD;AAAA,YACJ;AACA,2BAAe,IAAI,YAAY,OAAO;AAAA,UAC1C;AAAA,UAEA,YAAY,SAAkC;AAC1C,mBAAO,QAAQ,OAAO,EAAE,QAAQ,CAAC,CAAC,MAAM,OAAO,MAAM;AACjD,mBAAK,SAAS,MAAM,OAAO;AAAA,YAC/B,CAAC;AAAA,UACL;AAAA,UAEA,QAAQ,YAAoB,SAAiB,CAAC,GAAG,UAA8B,MAAM;AACjF,kBAAM,UAAU,eAAe,IAAI,UAAU;AAC7C,gBAAI,CAAC,SAAS;AACV,sBAAQ,KAAK,qCAAqC,UAAU,EAAE;AAC9D;AAAA,YACJ;AAEA,gBAAI;AACA,sBAAQ,QAAQ,OAAO;AAAA,YAC3B,SAAS,OAAO;AACZ,sBAAQ,MAAM,0BAA0B,UAAU,KAAK,KAAK;AAAA,YAChE;AAAA,UACJ;AAAA,UAEA,OAAO;AAEH,iBAAK,cAAc,SAAS,iBAAiB,CAAC,SAAS,UAAU;AAC7D,oBAAM,aAAa,QAAQ,aAAa,aAAa;AACrD,oBAAM,SAAS,cAAc,QAAQ,OAAO;AAE5C,kBAAI,QAAQ,YAAY,YAAY,QAAQ,YAAY,KAAK;AACzD,sBAAM,eAAe;AAAA,cACzB;AACA,oBAAM,gBAAgB;AAEtB,mBAAK,QAAQ,YAAY,QAAQ,OAAO;AAAA,YAC5C,CAAC;AAED,iBAAK,cAAc,YAAY,0BAA0B,CAAC,SAAS,UAAU;AACzE,oBAAM,aAAa,QAAQ,aAAa,sBAAsB;AAC9D,oBAAM,SAAS,cAAc,QAAQ,OAAO;AAC5C,kBAAI,QAAQ,YAAY,YAAY,QAAQ,YAAY,KAAK;AACzD,sBAAM,eAAe;AAAA,cACzB;AACA,oBAAM,gBAAgB;AACtB,mBAAK,QAAQ,YAAY,QAAQ,OAAO;AAAA,YAC5C,CAAC;AAED,iBAAK,cAAc,cAAc,uBAAuB,aAAW;AAC/D,oBAAM,aAAa,QAAQ,aAAa,mBAAmB;AAC3D,oBAAM,SAAS,cAAc,QAAQ,OAAO;AAC5C,mBAAK,QAAQ,YAAY,QAAQ,OAAO;AAAA,YAC5C,CAAC;AAED,oBAAQ,IAAI,uBAAuB;AAAA,UACvC;AAAA,UAEA,cACI,WACA,UACA,SACF;AACE,kBAAM,WAAW,CAAC,UAAiB;AAC/B,oBAAM,SAAS,MAAM;AACrB,kBAAI,EAAE,kBAAkB,SAAU;AAElC,oBAAM,UAAU,OAAO,QAAQ,QAAQ;AACvC,kBAAI,SAAS;AACT,wBAAQ,SAAS,KAAK;AAAA,cAC1B;AAAA,YACJ;AAEA,qBAAS,iBAAiB,WAAW,QAAyB;AAC9D,2BAAe,KAAK,EAAE,WAAW,SAAS,CAAC;AAAA,UAC/C;AAAA,UAEA,cAAc,SAA8B;AACxC,mBAAO,cAAc,QAAQ,OAAO;AAAA,UACxC;AAAA,UAEA,UAAU;AACN,2BAAe,QAAQ,CAAC,EAAE,WAAW,SAAS,MAAM;AAChD,uBAAS,oBAAoB,WAAW,QAAyB;AAAA,YACrE,CAAC;AACD,2BAAe,SAAS;AACxB,2BAAe,MAAM;AAAA,UACzB;AAAA,QACJ;AAEA,kBAAU,YAAY;AAAA,UAClB,GAAG,kBAAkB;AAAA,UACrB,GAAG,iBAAiB;AAAA,UACpB,GAAG,iBAAiB;AAAA,UACpB,GAAG,kBAAkB;AAAA,QACzB,CAAC;AAED,QAAC,OAAsD,YAAY;AAAA,MACvE,GAAG;AAAA;AAAA;;;AChFH,WAAS,cAAwB;AAC7B,UAAM,MAAM;AACZ,QAAI,IAAI,iBAAiB,OAAO,IAAI,cAAc,oBAAoB,YAAY;AAC9E,aAAO,IAAI,cAAc,gBAAgB;AAAA,IAC7C;AAEA,UAAM,IAAI;AACV,UAAM,eAAe,EAAE;AACvB,YAAO,6CAAc,cAAa,CAAC;AAAA,EACvC;AAQA,WAAS,uBAA6B;AAClC,UAAM,MAAM;AACZ,QACI,IAAI,iBACJ,OAAO,IAAI,cAAc,sBAAsB,YACjD;AACE,UAAI,cAAc,kBAAkB;AACpC;AAAA,IACJ;AAGA,QAAI,OAAO;AACX,UAAM,WAAW,YAAY;AAE7B,aAAS,QAAQ,CAAC,OAAO;AACrB,YAAM,QAAQ,SAAS,eAAe,EAAE;AACxC,UAAI,CAAC,MAAO;AACZ,YAAM,SAAS,SAAS,OAAO,iBAAiB,KAAK,EAAE,QAAQ,EAAE;AACjE,UAAI,CAAC,OAAO,MAAM,MAAM,GAAG;AACvB,eAAO,KAAK,IAAI,MAAM,MAAM;AAAA,MAChC;AAAA,IACJ,CAAC;AAID,UAAM,IAAI;AACV,QAAI,EAAE,cAAc,QAAW;AAC3B,QAAE,YAAY;AAAA,IAClB;AAAA,EACJ;AAQA,WAAS,mBAAmB,UAAwB;AAjGpD;AAkGI,SAAI,YAAO,YAAP,mBAAiB,WAAW;AAC5B,yBAAO,QAAQ,QAAQ,GAAE,iBAAzB;AAAA,IACJ,OAAO;AACH,cAAQ,MAAM,4BAA4B,WAAW,YAAY;AAAA,IACrE;AAAA,EACJ;AAOA,WAAS,yBAA+B;AACpC,UAAM,WAAW,YAAY;AAC7B,QAAI,CAAC,OAAO,WAAW,CAAC,YAAY,CAAC,MAAM,QAAQ,QAAQ,EAAG;AAE9D,aAAS,QAAQ,CAAC,OAAO;AAlH7B;AAmHQ,YAAM,UAAS,YAAO,YAAP,mBAAiB;AAChC,UACI,UACA,OAAO,SACP,CAAC,OAAO,MAAM,UAAU,SAAS,QAAQ,KACzC,OAAO,OAAO,iBAAiB,YACjC;AACE,eAAO,aAAa;AAAA,MACxB;AAAA,IACJ,CAAC;AAAA,EACL;AA7HA;AAAA;AAAA;AAmIA,OAAC,MAAM;AACH,YAAI,OAAO,OAAO,yBAAyB,YAAY;AACnD,iBAAO,uBAAuB;AAAA,QAClC;AACA,YAAI,OAAO,OAAO,uBAAuB,YAAY;AACjD,iBAAO,qBAAqB;AAAA,QAChC;AACA,YAAI,OAAO,OAAO,2BAA2B,YAAY;AACrD,iBAAO,yBAAyB;AAAA,QACpC;AAAA,MACJ,GAAG;AAAA;AAAA;;;AC7IH;AAAA;AAAA;AAAA,OAAC,WAAY;AACT;AAUA,iBAAS,mBAA2B;AAChC,gBAAM,SAAS,SAAS,cAAc,eAAe;AACrD,cAAI,CAAC,QAAQ;AACT,mBAAO;AAAA,UACX;AACA,gBAAM,OAAO,OAAO,sBAAsB;AAC1C,iBAAO,KAAK;AAAA,QAChB;AAMA,iBAAS,qBAAqB,QAAkC;AAC5D,cAAI,CAAC,OAAQ;AACb,gBAAM,SAAS,iBAAiB;AAChC,cAAI,UAAU,EAAG;AACjB,gBAAM,WAAW,OAAO,iBAAiB,MAAM;AAC/C,cAAI,SAAS,aAAa,UAAU;AAChC,mBAAO,MAAM,WAAW;AAAA,UAC5B;AACA,gBAAM,aAAa,WAAW,OAAO,MAAM,GAAG;AAC9C,gBAAM,aAAa,OAAO,MAAM,UAAU,IACpC,WAAW,SAAS,GAAG,IACvB;AACN,cAAI,CAAC,OAAO,MAAM,UAAU,KAAK,aAAa,QAAQ;AAClD,mBAAO,MAAM,MAAM,GAAG,MAAM;AAAA,UAChC,WAAW,OAAO,MAAM,UAAU,GAAG;AACjC,kBAAM,OAAO,OAAO,sBAAsB;AAC1C,gBAAI,KAAK,MAAM,QAAQ;AACnB,kBAAI,CAAC,OAAO,MAAM,MAAM;AACpB,uBAAO,MAAM,OAAO,GAAG,KAAK,IAAI;AAAA,cACpC;AACA,qBAAO,MAAM,MAAM,GAAG,MAAM;AAAA,YAChC;AAAA,UACJ;AAAA,QACJ;AAOA,iBAAS,mBACL,MACmE;AACnE,cAAI,SAAS,UAAU,SAAS,QAAS,QAAO;AAChD,gBAAM,SAAS,KAAK,MAAM,iBAAiB,CAAC;AAC5C,gBAAM,gBAAgB,KAAK,IAAI,OAAO,cAAc,GAAG,CAAC;AACxD,gBAAM,iBAAiB,KAAK,IAAI,OAAO,eAAe,GAAG,CAAC;AAC1D,cAAI,iBAAiB,KAAK,kBAAkB,EAAG,QAAO;AACtD,gBAAM,WAAW,KAAK,IAAI,KAAK,aAAa;AAC5C,gBAAM,YAAY,KAAK,MAAM,gBAAgB,CAAC;AAC9C,gBAAM,QAAQ,KAAK,IAAI,KAAK,IAAI,WAAW,aAAa,GAAG,QAAQ;AACnE,gBAAM,OAAO,SAAS,SAAS,IAAI,KAAK,IAAI,GAAG,gBAAgB,KAAK;AACpE,gBAAM,MAAM;AAGZ,gBAAMC,yBACD,OAA+D;AACpE,gBAAM,cAAc,OAAOA,2BAA0B,aAAaA,uBAAsB,IAAI;AAE5F,gBAAM,SAAS,KAAK,IAAI,GAAG,iBAAiB,MAAM,WAAW;AAC7D,iBAAO,EAAE,MAAM,KAAK,OAAO,OAAO;AAAA,QACtC;AAEA,YAAI,qBAAyC;AAM7C,iBAAS,2BAA+C;AACpD,cAAI,sBAAsB,mBAAmB,aAAa;AACtD,mBAAO;AAAA,UACX;AACA,cAAI,CAAC,YAAY,CAAC,SAAS,MAAM;AAC7B,mBAAO;AAAA,UACX;AACA,+BAAqB,SAAS,eAAe,sBAAsB;AACnE,cAAI,CAAC,oBAAoB;AACrB,iCAAqB,SAAS,cAAc,KAAK;AACjD,+BAAmB,KAAK;AACxB,+BAAmB,aAAa,eAAe,MAAM;AACrD,qBAAS,KAAK,YAAY,kBAAkB;AAAA,UAChD;AACA,iBAAO;AAAA,QACX;AAMA,iBAAS,gBAAgB,MAA8B;AACnD,gBAAM,UAAU,mBAAmB,IAAI;AACvC,cAAI,CAAC,SAAS;AACV,4BAAgB;AAChB;AAAA,UACJ;AACA,gBAAM,KAAK,yBAAyB;AACpC,cAAI,CAAC,GAAI;AACT,aAAG,MAAM,OAAO,GAAG,QAAQ,IAAI;AAC/B,aAAG,MAAM,MAAM,GAAG,QAAQ,GAAG;AAC7B,aAAG,MAAM,QAAQ,GAAG,QAAQ,KAAK;AACjC,aAAG,MAAM,SAAS,GAAG,QAAQ,MAAM;AACnC,aAAG,aAAa,aAAa,IAAI;AACjC,aAAG,UAAU,IAAI,sBAAsB;AAAA,QAC3C;AAKA,iBAAS,kBAAwB;AAC7B,cAAI,CAAC,sBAAsB,CAAC,mBAAmB,aAAa;AACxD;AAAA,UACJ;AACA,6BAAmB,UAAU,OAAO,sBAAsB;AAC1D,6BAAmB,gBAAgB,WAAW;AAAA,QAClD;AAcA,cAAM,IAAI;AAEV,YAAI,OAAO,EAAE,qBAAqB,YAAY;AAC1C,YAAE,mBAAmB;AAAA,QACzB;AACA,YAAI,OAAO,EAAE,yBAAyB,YAAY;AAC9C,YAAE,uBAAuB;AAAA,QAC7B;AACA,YAAI,OAAO,EAAE,uBAAuB,YAAY;AAC5C,YAAE,qBAAqB;AAAA,QAC3B;AACA,YAAI,OAAO,EAAE,oBAAoB,YAAY;AACzC,YAAE,kBAAkB;AAAA,QACxB;AACA,YAAI,OAAO,EAAE,oBAAoB,YAAY;AACzC,YAAE,kBAAkB;AAAA,QACxB;AAAA,MACJ,GAAG;AAAA;AAAA;;;AChKH;AAAA;AAAA;AAAA,OAAC,WAAY;AACT;AAYA,cAAM,KAAM;AAGZ,iBAAS,sBAAgD;AACrD,gBAAM,UAAU,GAAG;AACnB,gBAAM,SAAS,UAAU,QAAQ,YAAY,IAAI;AACjD,cAAI,CAAC,UAAU,CAAC,OAAO,MAAO,QAAO;AACrC,iBAAO,OAAO,MAAM,cAAc,QAAQ;AAAA,QAC9C;AAEA,iBAAS,iBAAiB,SAAwB,UAAU,GAAS;AACjE,cAAI,CAAC,WAAW,OAAO,YAAY,SAAU;AAE7C,gBAAM,SAAS,GAAG;AAClB,cAAI,OAAO,WAAW,YAAY;AAC9B,mBAAO,OAAO;AACd;AAAA,UACJ;AACA,gBAAM,SAAS,oBAAoB;AACnC,cAAI,UAAU,OAAO,eAAe;AAChC,gBAAI,eAAe;AACnB,gBACI,OAAO,YACP,OAAO,OAAO,SAAS,WAAW,YAClC,OAAO,SAAS,WAAW,QAC7B;AACE,6BAAe,OAAO,SAAS;AAAA,YACnC;AACA,mBAAO,cAAc,YAAY,SAAS,YAAY;AACtD;AAAA,UACJ;AACA,cAAI,UAAU,IAAI;AACd,uBAAW,MAAM,iBAAiB,SAAS,UAAU,CAAC,GAAG,GAAG;AAAA,UAChE,OAAO;AACH,oBAAQ,KAAK,8DAA2D,OAAO;AAAA,UACnF;AAAA,QACJ;AAEA,iBAASC,0BAAyB,SAAuB;AACrD,cAAI,CAAC,QAAS;AACd,2BAAiB,EAAE,MAAM,yBAAyB,QAAQ,CAAC;AAAA,QAC/D;AAGA,iBAAS,sBAA0D;AAC/D,gBAAM,SAAS,SAAS,eAAe,cAAc;AACrD,cAAI,CAAC,OAAQ,QAAO,EAAE,UAAU,OAAO,KAAK,GAAG;AAC/C,gBAAM,SAAS,OAAO,UAAU,SAAS,QAAQ;AACjD,gBAAM,MAAM,OAAO,aAAa,KAAK,KAAK,OAAO,OAAO;AACxD,gBAAM,WAAW,QAAQ,OAAO,IAAI,KAAK,KAAK,CAAC,MAAM;AACrD,iBAAO,EAAE,UAAU,IAAI;AAAA,QAC3B;AAEA,iBAAS,0BAAgC;AACrC,gBAAM,QAAQ,oBAAoB;AAClC,cAAI,CAAC,MAAM,YAAY,CAAC,MAAM,IAAK;AACnC,iBAAO,KAAK,MAAM,KAAK,UAAU,UAAU;AAAA,QAC/C;AAEA,iBAAS,sBAA4B;AACjC,gBAAM,QAAQ,oBAAoB;AAClC,cAAI,CAAC,MAAM,YAAY,CAAC,MAAM,IAAK;AACnC,gBAAM,OAAO,SAAS,cAAc,GAAG;AACvC,eAAK,OAAO,MAAM;AAClB,cAAI,WAAW;AACf,cAAI;AACA,kBAAM,MAAM,IAAI,IAAI,MAAM,KAAK,OAAO,SAAS,IAAI;AACnD,uBAAW,IAAI,SAAS,MAAM,GAAG,EAAE,IAAI,KAAK;AAAA,UAChD,QAAQ;AACJ,uBAAW;AAAA,UACf;AACA,eAAK,WAAW,YAAY;AAC5B,mBAAS,KAAK,YAAY,IAAI;AAC9B,eAAK,MAAM;AACX,mBAAS,KAAK,YAAY,IAAI;AAAA,QAClC;AAGA,YAAI,OAAO,GAAG,wBAAwB,WAAY,IAAG,sBAAsB;AAC3E,YAAI,OAAO,GAAG,4BAA4B,WAAY,IAAG,0BAA0B;AACnF,YAAI,OAAO,GAAG,wBAAwB,WAAY,IAAG,sBAAsB;AAC3E,YAAI,OAAO,GAAG,6BAA6B,WAAY,IAAG,2BAA2BA;AAAA,MACzF,GAAG;AAAA;AAAA;;;AC/FH;AAAA;AAAA;AAAA,OAAC,WAAY;AACT;AAYA,iBAAS,mBAAmB,SAAqC;AAC7D,gBAAM,KAAM,OAAiG;AAC7G,cAAI,MAAM,OAAO,GAAG,mBAAmB,YAAY;AAC/C,mBAAO,GAAG,eAAe,OAAO;AAAA,UACpC;AACA,gBAAMC,aAAa,OAAyE;AAC5F,gBAAMC,KAAI,CAAC,GAAW,OAAiBD,aAAYA,WAAU,GAAG,EAAE,IAAI,MAAM;AAC5E,iBAAO;AAAA,YACH,SAAS,WAAW;AAAA,YACpB,cAAcC,GAAE,wBAAwB;AAAA,YACxC,WAAWA,GAAE,4BAA4B;AAAA,YACzC,qBAAqB;AAAA,YACrB,MAAM;AAAA,YACN,OAAO,CAAC;AAAA,UACZ;AAAA,QACJ;AAEA,iBAAS,mBAAmB,UAAwB;AAChD,gBAAM,eAAe,SAAS,eAAe,eAAe;AAC5D,cAAI,aAAc,cAAa,cAAc;AAAA,QACjD;AAEA,iBAAS,cAAkC;AACvC,gBAAM,KAAM,OAAqF;AACjG,cAAI,MAAM,OAAO,GAAG,iBAAiB,YAAY;AAC7C,mBAAO,GAAG,aAAa;AAAA,UAC3B;AACA,cAAI,MAA0B;AAC9B,cAAI,UAAU;AACd,mBAAS,iBAA8B,qBAAqB,EAAE,QAAQ,CAAC,UAAU;AAC7E,kBAAM,IAAI,SAAS,iBAAiB,KAAK,EAAE,QAAQ,EAAE,KAAK;AAC1D,gBAAI,IAAI,SAAS;AACb,wBAAU;AACV,oBAAM;AAAA,YACV;AAAA,UACJ,CAAC;AACD,iBAAO;AAAA,QACX;AAEA,iBAAS,sBAAsB,MAAyB;AACpD,gBAAM,WAAW,SAAS,eAAe,eAAe;AACxD,cAAI,CAAC,SAAU;AACf,gBAAM,eAAe,mBAAmB,IAAI;AAC5C,mBAAS,cAAc,KAAK,aAAa,aAAa;AACtD,gBAAM,KAAK;AACX,cAAI,KAAK,qBAAqB;AAC1B,eAAG,QAAQ,sBAAsB,KAAK;AAAA,UAC1C,WAAW,GAAG,SAAS;AACnB,mBAAO,GAAG,QAAQ;AAAA,UACtB;AAAA,QACJ;AAEA,iBAAS,kBAAkB,MAAyB;AAChD,gBAAM,QAAQ,SAAS,eAAe,oBAAoB;AAC1D,cAAI,CAAC,MAAO;AACZ,UAAC,MAA6D,QAAQ,aAAa,KAAK,WAAW;AACnG,gBAAM,eAAe,mBAAmB,IAAI;AAC5C,gBAAM,QAAQ,KAAK,SAAS,aAAa,SAAS,CAAC;AACnD,gBAAM,SAAS,MAAM,cAAc,oBAAoB;AACvD,cAAI,QAAQ;AACR,gBAAI,KAAK,MAAM;AACX,qBAAO,MAAM,KAAK;AAClB,qBAAO,MAAM,MAAM,QAAQ,KAAK,gBAAgB;AAChD,qBAAO,UAAU,OAAO,QAAQ;AAAA,YACpC,OAAO;AACH,qBAAO,UAAU,IAAI,QAAQ;AAAA,YACjC;AAAA,UACJ;AACA,gBAAM,SAAS,MAAM,cAAc,oBAAoB;AACvD,cAAI,QAAQ;AACR,mBAAO,cAAc,MAAM,QAAQ,KAAK,gBAAgB,aAAa;AAAA,UACzE;AACA,gBAAM,YAAY,MAAM,cAAc,uBAAuB;AAC7D,cAAI,WAAW;AACX,kBAAM,UAAU,MAAM,WAAW;AACjC,sBAAU,cAAc;AACxB,sBAAU,UAAU,OAAO,UAAU,CAAC,OAAO;AAAA,UACjD;AACA,gBAAM,YAAY,MAAM,cAAc,uBAAuB;AAC7D,cAAI,WAAW;AACX,kBAAM,UAAU,MAAM,WAAW;AACjC,sBAAU,cAAc;AACxB,sBAAU,UAAU,OAAO,UAAU,CAAC,OAAO;AAAA,UACjD;AACA,gBAAM,cAAc,MAAM,cAAc,yBAAyB;AACjE,cAAI,aAAa;AACb,kBAAM,YAAY,MAAM,aAAa;AACrC,wBAAY,cAAc;AAC1B,wBAAY,UAAU,OAAO,UAAU,CAAC,SAAS;AAAA,UACrD;AAAA,QACJ;AAEA,iBAASC,uBAAsB,SAA8B;AACzD,gBAAM,aAAc,OAA+F;AACnH,cAAI,cAAc,OAAO,WAAW,0BAA0B,YAAY;AACtE,uBAAW,sBAAsB,OAAO;AAAA,UAC5C;AAAA,QACJ;AAEA,iBAAS,eAAe,SAAqC;AACzD,iBAAO,mBAAmB,OAAO;AAAA,QACrC;AAEA,iBAAS,sBAAsB,OAAqB,cAAkC;AApH1F;AAqHQ,cAAI,OAAO;AACP,kBAAM,eAAe;AACrB,kBAAM,gBAAgB;AAAA,UAC1B;AACA,gBAAM,YAAa,OAAyD;AAC5E,cAAI,UAAW,WAAU;AACzB,gBAAM,OAAO,gBAAgB,sBAAsB,eAAe,IAAI;AACtE,+BAAqB;AACrB,gBAAM,YAAY,IAAI,YAAY,wBAAwB;AAAA,YACtD,QAAQ,EAAE,SAAS,KAAK,SAAS,KAAK;AAAA,YACtC,YAAY;AAAA,UAChB,CAAC;AACD,gBAAM,iBAAiB,OAAO,cAAc,SAAS;AACrD,cAAI,CAAC,eAAgB;AACrB,gBAAM,aAAa,KAAK;AACxB,cAAI,CAAC,WAAY;AACjB,cAAI,eAAe,sBAAsB;AACrC,8BAAkB,IAAI;AAAA,UAC1B;AACA,gBAAM,UAAW,OAA0E;AAC3F,gBAAM,iBAAiB,WAAW,QAAQ,UAAU;AACpD,cAAI,kBAAkB,OAAO,eAAe,SAAS,YAAY;AAC7D,2BAAe,KAAK;AAAA,UACxB,OAAO;AACH,kBAAM,eAAe,SAAS,eAAe,UAAU;AACvD,gBAAI,cAAc;AACd,2BAAa,UAAU,OAAO,QAAQ;AACtC,oBAAM,gBAAgB,kBAAkF,YAAlF,mBAA4F,gBAA5F,mBAAyG;AAC/H,kBAAI,aAAc,cAAa;AAC/B,2CAA6B;AAAA,YACjC;AAAA,UACJ;AAAA,QACJ;AAEA,iBAAS,wBAAwB,eAAqC;AAClE,gBAAM,OAAO,mBAAmB,iBAAiB,IAAI;AACrD,gCAAsB,MAAM,IAAI;AAAA,QACpC;AAEA,YAAI,qBAAkC,mBAAmB,IAAI;AAE7D,iBAAS,+BAA4C;AACjD,gBAAM,WAAW,YAAY;AAC7B,gBAAM,KAAM,OAA+H;AAC3I,cAAI,YAAY,IAAI;AAChB,kBAAM,SAAS,GAAG,UAAU,SAAS,EAAE;AACvC,gBAAI,UAAU,OAAO,YAAY,OAAO,SAAS,mBAAmB;AAChE,oBAAM,MAAM,MAAM,KAAK,SAAS,iBAA8B,qBAAqB,CAAC;AACpF,oBAAM,SAAS,IAAI,KAAK,CAAC,GAAG,OAAO,SAAS,iBAAiB,CAAC,EAAE,QAAQ,EAAE,KAAK,MAAM,SAAS,iBAAiB,CAAC,EAAE,QAAQ,EAAE,KAAK,EAAE;AACnI,kBAAI,OAA2B;AAC/B,yBAAW,KAAK,QAAQ;AACpB,sBAAM,KAAK,GAAG,UAAU,EAAE,EAAE;AAC5B,oBAAI,CAAC,MAAM,CAAC,GAAG,YAAY,CAAC,GAAG,SAAS,mBAAmB;AACvD,yBAAO;AACP;AAAA,gBACJ;AAAA,cACJ;AACA,kBAAI,MAAM;AACN,sBAAMC,QAAO,eAAe,KAAK,EAAE;AACnC,qCAAqBA;AACrB,mCAAmBA,MAAK,YAAY;AACpC,sCAAsBA,KAAI;AAC1B,gBAAAD,uBAAsB,KAAK,EAAE;AAC7B,uBAAOC;AAAA,cACX;AAAA,YACJ;AAAA,UACJ;AACA,cAAI;AACJ,cAAI,YAAY,SAAS,OAAO,wBAAwB,sBAAsB,mBAAmB,SAAS;AACtG,mBAAO,mBAAmB,mBAAmB,OAAO;AACpD,iCAAqB;AAAA,UACzB,OAAO;AACH,mBAAO,eAAe,WAAW,SAAS,KAAK,IAAI;AACnD,iCAAqB;AAAA,UACzB;AACA,6BAAmB,KAAK,YAAY;AACpC,gCAAsB,IAAI;AAC1B,UAAAD,uBAAsB,WAAW,SAAS,KAAK,IAAI;AACnD,iBAAO;AAAA,QACX;AAIA,cAAM,eAAgB,OAA2D;AACjF,YAAI,CAAC,cAAc;AACf,UAAC,OAA2D,yBAAyB;AAAA,QACzF;AAEA,YAAI,CAAC,aAAc,QAAO,iBAAiB,4BAA4B,MAAM;AACzE,gBAAM,OAAO,6BAA6B;AAC1C,gBAAM,mBAAmB,SAAS,eAAe,oBAAoB;AACrE,cAAI,oBAAoB,CAAC,iBAAiB,UAAU,SAAS,QAAQ,GAAG;AACpE,kBAAM,KAAmB,iBAAiB;AAC1C,kBAAM,WAAW,GAAG,YAAY,MAAM,OAAO,KAAK,UAAU,SAAS;AACrE,kBAAM,gBAAgB,mBAAmB,QAAQ;AACjD,8BAAkB,aAAa;AAC/B,gBAAI,QAAQ,KAAK,YAAY,cAAc,SAAS;AAChD,mCAAqB;AAAA,YACzB;AAAA,UACJ;AACA,gBAAM,0BAA2B,OAA+D;AAChG,cAAI,wBAAyB,yBAAwB;AAAA,QACzD,CAAC;AACD,YAAI,CAAC,aAAc,QAAO,iBAAiB,yBAAyB,MAAM;AACtE,gBAAM,0BAA2B,OAA+D;AAChG,cAAI,wBAAyB,yBAAwB;AAAA,QACzD,CAAC;AAGD,QAAC,OAA4F,+BAA+B;AAC5H,QAAC,OAAkF,0BAA0B;AAAA,MACjH,GAAG;AAAA;AAAA;;;AC3MI,WAAS,mBAAmB,SAAsB;AACrD,QAAI,OAAO,YAAY,WAAY,QAAO;AAC1C,UAAM,WAAW,eAAe,EAAE,mBAAmB;AACrD,uBAAmB,IAAI,UAAU,OAAO;AACxC,WAAO;AAAA,EACX;AAEO,WAAS,mBAAmB,OAAkB,SAAsB;AAhC3E;AAiCI,QAAI,CAAC,MAAM,QAAQ,KAAK,EAAG,QAAO,CAAC;AACnC,UAAM,aAAwC,CAAC;AAC/C,QAAI,uBAAuB;AAC3B,UAAM,QAAQ,SAAO;AACjB,YAAM,OAAO;AACb,UAAI,CAAC,KAAM;AACX,UAAI,KAAK,SAAS,aAAa;AAC3B,YAAI,qBAAsB;AAC1B,mBAAW,KAAK,EAAE,MAAM,YAAY,CAAC;AACrC,+BAAuB;AACvB;AAAA,MACJ;AACA,YAAM,QAAQ,OAAO,OAAO,CAAC,GAAG,IAAI;AACpC,UAAI,OAAO,KAAK,aAAa;AACzB,QAAC,MAAM,WAAwB,KAAK,SAA2C,OAAO;AAC1F,UAAI,OAAO,KAAK,UAAU;AACtB,QAAC,MAAM,QAAqB,KAAK,MAAuC,OAAO;AACnF,UAAI,OAAO,KAAK,aAAa;AACzB,QAAC,MAAM,WAAwB,KAAK,SAA0C,OAAO;AACzF,iBAAW,KAAK,KAAK;AACrB,6BAAuB;AAAA,IAC3B,CAAC;AACD,WAAO,WAAW,YAAU,gBAAW,WAAW,SAAS,CAAC,MAAhC,mBAAmC,UAAS;AACpE,iBAAW,IAAI;AACnB,WAAO;AAAA,EACX;AAGA,WAAS,2BAA2B,SAAsB;AACtD,WAAO,0BAA0B,OAAO;AAAA,EAC5C;AAEA,WAAS,0BAA0B,SAAsB;AACrD,WAAO;AAAA,MACH;AAAA,QACI,IAAI;AAAA,QACJ,OAAO,MAAM,UAAU,oBAAoB;AAAA,QAC3C,OAAO;AAAA,UACH;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,uBAAuB;AAAA,YAC9C,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM;AA5ElC;AA8EwB,kBACI,OAAO,cAAc,KACrB,OAAO,OAAO,cAAc,EAAE,WAAW,YAC3C;AACE,sBAAME,YAAW,OAAO,gBAAgB;AACxC,sBAAM,UAAQ,KAAAA,aAAA,gBAAAA,UAAU,mBAAV,wBAAAA,WAA2B,cAAa;AACtD,uBAAO,cAAc,EAAE,OAAO;AAAA,kBAC1B,OAAO,UAAU,QAAQ,CAAC;AAAA,gBAC9B,CAAC;AAAA,cACL,OAAO;AAEH,sBAAM,MAAM,OAAO,uBAAuB;AAC1C,oBAAI,OAAO,OAAO,IAAI,mBAAmB,YAAY;AACjD,wBAAM,QAAQ,IAAI,mBACZ,IAAI,iBAAiB,MACrB,SAAI,oBAAJ,6BAAwB,WAAU;AACxC,sBAAI,eAAe,EAAE,OAAO,UAAU,QAAQ,CAAC,GAAG,CAAC;AAAA,gBACvD;AAAA,cACJ;AAAA,YACJ;AAAA,UACJ;AAAA,UACA;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,oBAAoB;AAAA,YAC3C,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM;AACV,kBACI,OAAO,cAAc,KACrB,OAAO,OAAO,cAAc,EAAE,eAAe,YAC/C;AACE,oBAAI;AACA,wBAAM,KACF,OAAO,cAAc,EAAE,YACvB,OAAO,cAAc,EAAE,SAAS;AACpC,sBAAI,MAAM,MAAM,QAAQ,GAAG,WAAW,EAAG,IAAG,cAAc,CAAC;AAC3D,yBAAO,cAAc,EAAE,WAAW,CAAC,GAAG,QAAQ;AAAA,gBAClD,SAAS,GAAG;AACR,0BAAQ,KAAK,wBAAwB,CAAC;AAAA,gBAC1C;AAAA,cACJ;AAAA,YACJ;AAAA,UACJ;AAAA,UACA,EAAE,MAAM,YAAY;AAAA,UACpB;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,qBAAqB;AAAA,YAC5C,MAAM;AAAA,YACN,QAAQ,MAAM;AACV,oBAAM,YAAY,OAAO,WAAW;AACpC,kBAAI,aAAa,OAAO,UAAU,YAAY,YAAY;AACtD,0BAAU,QAAQ,gBAAgB;AAAA,cACtC;AAAA,YACJ;AAAA,UACJ;AAAA,UACA;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,qBAAqB;AAAA,YAC5C,MAAM;AAAA,YACN,QAAQ,MAAM;AACV,oBAAM,YAAY,OAAO,WAAW;AACpC,kBAAI,aAAa,OAAO,UAAU,YAAY,YAAY;AACtD,0BAAU,QAAQ,gBAAgB;AAAA,cACtC;AAAA,YACJ;AAAA,UACJ;AAAA,UACA,EAAE,MAAM,YAAY;AAAA,UACpB;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,mBAAmB;AAAA,YAC1C,UAAU;AAAA,YACV,UAAU,MAAM,EAAE,WAAW,QAAQ;AAAA,YACrC,MAAM;AAAA,YACN,QAAQ,MAAM,mBAAmB,OAAO;AAAA,UAC5C;AAAA,QACJ;AAAA,MACJ;AAAA,MACA,wBAAwB,OAAO;AAAA,MAC/B,sBAAsB,SAAS;AAAA,QAC3B,SAAS;AAAA,QACT,UAAU;AAAA,MACd,CAAC;AAAA,IACL;AAAA,EACJ;AAEA,WAAS,4BAA4B,SAAsB;AACvD,WAAO;AAAA,MACH;AAAA,QACI,IAAI;AAAA,QACJ,OAAO,MAAM,UAAU,oBAAoB;AAAA,QAC3C,OAAO;AAAA,UACH;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,qBAAqB;AAAA,YAC5C,UAAU;AAAA,YACV,UAAU,MAAM,EAAE,WAAW,QAAQ;AAAA,YACrC,MAAM;AAAA,YACN,QAAQ,MAAM,mBAAmB,OAAO;AAAA,UAC5C;AAAA,QACJ;AAAA,MACJ;AAAA,MACA,wBAAwB,OAAO;AAAA,MAC/B,sBAAsB,SAAS;AAAA,QAC3B,SAAS;AAAA,QACT,aAAa;AAAA,QACb,UAAU;AAAA,MACd,CAAC;AAAA,IACL;AAAA,EACJ;AAEA,WAAS,8BAA8B,SAAsB;AACzD,WAAO;AAAA,MACH;AAAA,QACI,IAAI;AAAA,QACJ,OAAO,MAAM,UAAU,oBAAoB;AAAA,QAC3C,OAAO;AAAA,UACH;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,mBAAmB;AAAA,YAC1C,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM;AAvMlC;AAyMwB,kBACI,OAAO,kBAAkB,KACzB,OAAO,OAAO,kBAAkB,EAAE,WAAW,YAC/C;AACE,sBAAMA,YAAW,OAAO,gBAAgB;AACxC,sBAAM,UAAQ,KAAAA,aAAA,gBAAAA,UAAU,mBAAV,wBAAAA,WAA2B,mBAAkB;AAC3D,uBAAO,kBAAkB,EAAE,OAAO;AAAA,kBAC9B,OAAO,YAAY,QAAQ,CAAC;AAAA,gBAChC,CAAC;AAAA,cACL,OAAO;AAEH,yCAAyB,UAAU;AAAA,cACvC;AAAA,YACJ;AAAA,UACJ;AAAA,UACA;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,gBAAgB;AAAA,YACvC,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM,yBAAyB,WAAW;AAAA,UACtD;AAAA,UACA;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,gBAAgB;AAAA,YACvC,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM,yBAAyB,WAAW;AAAA,UACtD;AAAA,QACJ;AAAA,MACJ;AAAA,MACA;AAAA,QACI,IAAI;AAAA,QACJ,OAAO,MAAM,UAAU,oBAAoB;AAAA,QAC3C,OAAO;AAAA,UACH;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,gBAAgB;AAAA,YACvC,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM,yBAAyB,WAAW;AAAA,UACtD;AAAA,UACA;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,gBAAgB;AAAA,YACvC,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM,yBAAyB,WAAW;AAAA,UACtD;AAAA,UACA,EAAE,MAAM,YAAY;AAAA,UACpB;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,eAAe;AAAA,YACtC,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM,yBAAyB,UAAU;AAAA,UACrD;AAAA,UACA;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,gBAAgB;AAAA,YACvC,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM,yBAAyB,WAAW;AAAA,UACtD;AAAA,UACA;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,iBAAiB;AAAA,YACxC,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM,yBAAyB,YAAY;AAAA,UACvD;AAAA,UACA,EAAE,MAAM,YAAY;AAAA,UACpB;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,qBAAqB;AAAA,YAC5C,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM,yBAAyB,gBAAgB;AAAA,UAC3D;AAAA,QACJ;AAAA,MACJ;AAAA,MACA;AAAA,QACI,IAAI;AAAA,QACJ,OAAO,MAAM,UAAU,oBAAoB;AAAA,QAC3C,OAAO;AAAA,UACH;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,sBAAsB;AAAA,YAC7C,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM,yBAAyB,iBAAiB;AAAA,UAC5D;AAAA,QACJ;AAAA,MACJ;AAAA,MACA,wBAAwB,OAAO;AAAA,MAC/B,sBAAsB,SAAS;AAAA,QAC3B,SAAS;AAAA,QACT,aAAa;AAAA,QACb,UAAU;AAAA,MACd,CAAC;AAAA,IACL;AAAA,EACJ;AAEA,WAAS,+BAA+B,SAAsB;AAC1D,UAAM,QAAQ,OAAO,qBAAqB,IACpC,OAAO,qBAAqB,EAAE,IAC9B,EAAE,UAAU,MAAM;AACxB,WAAO;AAAA,MACH;AAAA,QACI,IAAI;AAAA,QACJ,OAAO,MAAM,UAAU,oBAAoB;AAAA,QAC3C,OAAO;AAAA,UACH;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,sBAAsB;AAAA,YAC7C,UAAU,CAAC,MAAM;AAAA,YACjB,MAAM;AAAA,YACN,QAAQ,MAAM;AACV,kBAAI,OAAO,yBAAyB,EAAG,QAAO,yBAAyB,EAAE;AAAA,YAC7E;AAAA,UACJ;AAAA,UACA;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,sBAAsB;AAAA,YAC7C,UAAU,CAAC,MAAM;AAAA,YACjB,MAAM;AAAA,YACN,QAAQ,MAAM;AACV,kBAAI,OAAO,qBAAqB,EAAG,QAAO,qBAAqB,EAAE;AAAA,YACrE;AAAA,UACJ;AAAA,UACA,EAAE,MAAM,YAAY;AAAA,UACpB;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,kBAAkB;AAAA,YACzC,UAAU;AAAA,YACV,UAAU,MAAM,EAAE,WAAW,QAAQ;AAAA,YACrC,MAAM;AAAA,YACN,QAAQ,MAAM,mBAAmB,OAAO;AAAA,UAC5C;AAAA,QACJ;AAAA,MACJ;AAAA,MACA,wBAAwB,OAAO;AAAA,MAC/B,sBAAsB,SAAS;AAAA,QAC3B,SAAS;AAAA,QACT,aAAa;AAAA,QACb,UAAU;AAAA,MACd,CAAC;AAAA,IACL;AAAA,EACJ;AAEA,WAAS,yBAAyB,SAAsB;AACpD,WAAO;AAAA,MACH;AAAA,QACI,IAAI;AAAA,QACJ,OAAO,MAAM,UAAU,oBAAoB;AAAA,QAC3C,OAAO;AAAA,UACH;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,kBAAkB;AAAA,YACzC,UAAU;AAAA,YACV,UAAU,MAAM,EAAE,WAAW,QAAQ;AAAA,YACrC,MAAM;AAAA,YACN,QAAQ,MAAM,mBAAmB,OAAO;AAAA,UAC5C;AAAA,QACJ;AAAA,MACJ;AAAA,MACA,wBAAwB,OAAO;AAAA,MAC/B,sBAAsB,SAAS;AAAA,QAC3B,SAAS;AAAA,QACT,aAAa;AAAA,QACb,UAAU;AAAA,MACd,CAAC;AAAA,IACL;AAAA,EACJ;AAEA,WAAS,+BAA+B,SAAsB;AAC1D,WAAO;AAAA,MACH;AAAA,QACI,IAAI;AAAA,QACJ,OAAO,MAAM,UAAU,oBAAoB;AAAA,QAC3C,OAAO;AAAA,UACH;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,wBAAwB;AAAA,YAC/C,UAAU;AAAA,YACV,UAAU,MAAM,EAAE,WAAW,QAAQ;AAAA,YACrC,MAAM;AAAA,YACN,QAAQ,MAAM,mBAAmB,OAAO;AAAA,UAC5C;AAAA,QACJ;AAAA,MACJ;AAAA,MACA,wBAAwB,OAAO;AAAA,IACnC;AAAA,EACJ;AAEA,WAAS,4BAA4B,SAAc;AA5YnD;AA8YI,UAAMA,YAAW,OAAO,gBAAgB;AACxC,UAAM,aAAY,KAAAA,aAAA,gBAAAA,UAAU,oBAAV,wBAAAA;AAClB,UAAM,oBAAmB,uCAAW,UAAS;AAC7C,UAAM,cAAc,mBAAmB,YAAY;AAEnD,WAAO;AAAA,MACH;AAAA,QACI,IAAI;AAAA,QACJ,OAAO,MAAM,UAAU,oBAAoB;AAAA,QAC3C,OAAO;AAAA;AAAA,UAEH;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,yBAAyB;AAAA,YAChD,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM;AA9ZlC,kBAAAC,KAAA;AA+ZwB,mBAAIA,MAAA,OAAO,gBAAgB,MAAvB,gBAAAA,IAA0B,QAAQ;AAClC,sBAAM,UAAQ,KAAAD,aAAA,gBAAAA,UAAU,mBAAV,wBAAAA,WAA2B,gBAAe;AACxD,uBAAO,gBAAgB,EAAE,OAAO,EAAE,OAAO,YAAY,QAAQ,CAAC,GAAG,CAAC;AAAA,cACtE,YAAW,YAAO,yBAAyB,MAAhC,mBAAmC,gBAAgB;AAC1D,uBAAO,yBAAyB,EAAE,eAAe;AAAA,cACrD;AAAA,YACJ;AAAA,UACJ;AAAA;AAAA,UAEA;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,sBAAsB;AAAA,YAC7C,UAAU;AAAA,YACV,MAAM;AAAA,YACN,UAAU,MAAM,CAAC;AAAA,YACjB,QAAQ,MAAM;AACV,kBAAI,2CAAa,cAAe,aAAY,cAAc;AAAA,YAC9D;AAAA,UACJ;AAAA;AAAA,UAEA;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,4BAA4B;AAAA,YACnD,UAAU;AAAA,YACV,MAAM;AAAA,YACN,UAAU,MAAM,CAAC,eAAe,CAAC,YAAY;AAAA,YAC7C,QAAQ,MAAM;AACV,oBAAM,WAAW,2CAAa;AAC9B,kBAAI,CAAC,SAAU;AACf,oBAAM,OAAQ,YAAoB;AAClC,oBAAM,OAAO,KAAK,IAAI,QAAQ;AAC9B,kBAAI,QAAQ,YAAY,eAAe;AACnC,sBAAM,aAAa,YAAY,cAAc,KAAK,QAAQ,OAAO;AAEjE,oBAAI,KAAK,UAAU,cAAe,WAAmB,cAAc;AAC/D,kBAAC,WAAmB,aAAa,KAAK,MAAM;AAAA,gBAChD;AAAA,cACJ;AAAA,YACJ;AAAA,UACJ;AAAA,UACA,EAAE,MAAM,YAAY;AAAA;AAAA,UAEpB;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,wBAAwB;AAAA,YAC/C,UAAU;AAAA,YACV,MAAM;AAAA,YACN,UAAU,MAAM,CAAC,eAAe,CAAC,YAAY;AAAA,YAC7C,QAAQ,MAAM;AA/clC,kBAAAC;AAgdwB,kBAAI,CAAC,YAAa;AAClB,oBAAM,OAA0B,YAAoB;AACpD,kBAAI,KAAK,QAAQ,GAAG;AAChB,iBAAAA,MAAA,YAAY,UAAZ,gBAAAA,IAAA;AACA;AAAA,cACJ;AACA,oBAAM,WAAW,YAAY;AAC7B,kBAAI,SAAU,aAAY,UAAU,QAAQ;AAAA,YAChD;AAAA,UACJ;AAAA;AAAA,UAEA;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,2BAA2B;AAAA,YAClD,UAAU;AAAA,YACV,MAAM;AAAA,YACN,UAAU,MAAM,EAAE,WAAW,QAAQ;AAAA,YACrC,QAAQ,MAAM,mBAAmB,OAAO;AAAA,UAC5C;AAAA,QACJ;AAAA,MACJ;AAAA,MACA;AAAA,QACI,IAAI;AAAA,QACJ,OAAO,MAAM,UAAU,oBAAoB;AAAA,QAC3C,OAAO;AAAA;AAAA,UAEH;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,qBAAqB;AAAA,YAC5C,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM;AACV,kBAAI,CAAC,YAAa;AAClB,oBAAM,WAAW,YAAY;AAC7B,oBAAM,OAA0B,YAAoB;AACpD,oBAAM,MAAM,WAAW,KAAK,IAAI,QAAQ,IAAI;AAC5C,oBAAM,OAAO,OAAO;AACpB,kBAAI,6BAAM,YAAa,MAAK,YAAY;AAAA,YAC5C;AAAA,UACJ;AAAA,UACA,EAAE,MAAM,YAAY;AAAA;AAAA,UAEpB;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,oBAAoB;AAAA,YAC3C,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM;AA/flC,kBAAAA;AAggBwB,oBAAM,QAAQ,SAAS,cAAc,iBAAiB;AAItD,kBAAI,MAAO,OAAM,OAAO;AACxB,eAAAA,MAAA,SAAS,gBAAT,gBAAAA,IAAA,eAAuB;AAAA,YAC3B;AAAA,UACJ;AAAA,UACA;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,qBAAqB;AAAA,YAC5C,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,YAAY;AAChB,oBAAM,QAAQ,SAAS,cAAc,iBAAiB;AAItD,kBAAI,CAAC,MAAO;AACZ,kBAAI;AACA,sBAAM,OAAO,MAAM,UAAU,UAAU,SAAS;AAChD,sBAAM,SAAS;AACf,sBAAM,cAAc,IAAI,MAAM,OAAO,CAAC;AAAA,cAC1C,SAAS,GAAG;AACR,wBAAQ,KAAK,yBAAyB,CAAC;AAAA,cAC3C;AAAA,YACJ;AAAA,UACJ;AAAA,UACA;AAAA,YACI,IAAI;AAAA,YACJ,OAAO,MAAM,UAAU,yBAAyB;AAAA,YAChD,UAAU;AAAA,YACV,MAAM;AAAA,YACN,QAAQ,MAAM;AACV,oBAAM,QAAQ,SAAS,cAAc,iBAAiB;AAItD,kBAAI,MAAO,OAAM,OAAO;AAAA,YAC5B;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ;AAAA,MACA,wBAAwB,OAAO;AAAA,MAC/B,sBAAsB,SAAS;AAAA,QAC3B,SAAS;AAAA,QACT,aAAa;AAAA,QACb,UAAU;AAAA,MACd,CAAC;AAAA,IACL;AAAA,EACJ;AAEA,WAAS,wBAAwB,SAAsB;AACnD,WAAO;AAAA,MACH,IAAI;AAAA,MACJ,OAAO,MAAM,UAAU,sBAAsB;AAAA,MAC7C,OAAO,mBAAmB,OAAO;AAAA,IACrC;AAAA,EACJ;AAEA,WAAS,mBAAmB,SAAsB;AAC9C,UAAM,SAAS,WAAY,QAAQ;AACnC,UAAM,YAAY,QAAQ,UAAU,OAAO,OAAO,UAAU,UAAU;AACtE,UAAM,QAAe;AAAA,MACjB;AAAA,QACI,IAAI;AAAA,QACJ,OAAO,MAAM,UAAU,sBAAsB;AAAA,QAC7C,UAAU;AAAA,QACV,UAAU,CAAC;AAAA,QACX,MAAM;AAAA,QACN,QAAQ,MAAM;AACV,cAAI,UAAU,OAAO,OAAO,aAAa,WAAY,QAAO,SAAS;AAAA,QACzE;AAAA,MACJ;AAAA,MACA;AAAA,QACI,IAAI;AAAA,QACJ,OAAO,MAAM,UAAU,kBAAkB;AAAA,QACzC,UAAU;AAAA,QACV,UAAU,CAAC;AAAA,QACX,MAAM;AAAA,QACN,QAAQ,MAAM;AACV,cAAI,UAAU,OAAO,OAAO,mBAAmB,WAAY,QAAO,eAAe;AAAA,QACrF;AAAA,MACJ;AAAA,IACJ;AACA,UAAM,qBAAqB,0BAA0B,OAAO;AAC5D,QAAI,mBAAmB,SAAS,GAAG;AAC/B,YAAM,KAAK,EAAE,MAAM,YAAY,CAAC;AAChC,YAAM,KAAK,GAAG,kBAAkB;AAAA,IACpC;AACA,UAAM;AAAA,MACF,EAAE,MAAM,YAAY;AAAA,MACpB;AAAA,QACI,IAAI;AAAA,QACJ,OAAO,MAAM,UAAU,0BAA0B;AAAA,QACjD,UAAU,CAAC,oBAAoB;AAAA,QAC/B,MAAM;AAAA,QACN,QAAQ,MAAM;AACV,cAAI,OAAO,wBAAwB,EAAG,QAAO,wBAAwB,EAAE;AAAA,QAC3E;AAAA,MACJ;AAAA,MACA,EAAE,MAAM,YAAY;AAAA,MACpB;AAAA,QACI,IAAI;AAAA,QACJ,OAAO,MAAM,UAAU,mBAAmB;AAAA,QAC1C,UAAU;AAAA,QACV,UAAU,CAAC;AAAA,QACX,MAAM;AAAA,QACN,QAAQ,MAAM,mBAAmB,OAAO;AAAA,MAC5C;AAAA,IACJ;AACA,WAAO;AAAA,EACX;AAEA,WAAS,0BAA0B,SAAsB;AAlnBzD;AAmnBI,UAAM,QAAe,CAAC;AACtB,QAAI,UAAe;AACnB,QAAI,YAA2B;AAC/B,QAAI,iBAAgC;AACpC,UAAM,UAAU,mCAAS;AAEzB,UAAMD,YAAW,OAAO,gBAAgB;AACxC,UAAM,qBAAmB,WAAAA,aAAA,gBAAAA,UAAU,oBAAV,wBAAAA,eAAA,mBAA+B,SAAQ;AAGhE,QAAI,YAAY,oBAAoB,qBAAqB,YAAY;AACjE,YAAM,iBAAiB,OAAO,gBAAgB;AAE9C,UAAIA,aAAY,gBAAgB;AAC5B,oBAAY;AACZ,yBAAiB;AAEjB,cAAM,KAAK;AAAA,UACP,IAAI;AAAA,UACJ,OAAO,MAAM,UAAU,kBAAkB,uBAAuB;AAAA,UAChE,UAAU;AAAA,UACV,MAAM;AAAA,UACN,QAAQ,MAAM;AAzoB9B,gBAAAC;AA0oBoB,kBAAM,UAAQA,MAAAD,UAAS,mBAAT,gBAAAC,IAAA,KAAAD,WAA0B,gBAAe;AACvD,2BAAe,OAAO,EAAE,OAAO,YAAY,QAAQ,CAAC,GAAG,CAAC;AAAA,UAC5D;AAAA,QACJ,CAAC;AAED,cAAM,YAAU,KAAAA,UAAS,kBAAT,wBAAAA,WAAyB,gBAAe,CAAC;AACzD,YAAI,QAAQ,SAAS,GAAG;AACpB,gBAAM,KAAK,EAAE,MAAM,YAAY,CAAC;AAChC,kBAAQ,QAAQ,CAAC,KAAU,UAAkB;AAlpB7D,gBAAAC,KAAAC;AAmpBoB,kBAAM,aAAWA,OAAAD,MAAAD,UAAS,oBAAT,gBAAAC,IAAA,KAAAD,eAAA,gBAAAE,IAA8B,cAAa,IAAI;AAChE,kBAAM,cAAc,YAAY,QAAQ,CAAC;AACzC,kBAAM,KAAK;AAAA,cACP,IAAI,mBAAmB,IAAI,QAAQ;AAAA,cACnC,OAAO,MAAM,GAAG,WAAW,YAAO,EAAE,GAAG,WAAW;AAAA,cAClD,UAAU,QAAQ,IAAI,SAAI,QAAQ,CAAC,KAAK;AAAA,cACxC,QAAQ,MAAM;AAzpBtC,oBAAAD;AA0pB4B,iBAAAA,MAAA,IAAI,UAAJ,gBAAAA,IAAA;AAAA,cACJ;AAAA,YACJ,CAAC;AAAA,UACL,CAAC;AACD,gBAAM;AAAA,YACF,EAAE,MAAM,YAAY;AAAA,YACpB;AAAA,cACI,IAAI;AAAA,cACJ,OAAO,MAAM,UAAU,sBAAsB;AAAA,cAC7C,MAAM;AAAA,cACN,QAAQ,MAAM;AACV,oBAAI,QAAQ,QAAQ,QAAQ,MAAM,iCAA8B,GAAG;AAC/D,0BAAQ,QAAQ,CAAC,MAAQ;AAtqBzD,wBAAAA;AAsqB4D,4BAAAA,MAAA,EAAE,UAAF,gBAAAA,IAAA;AAAA,mBAAW;AAAA,gBAC3C;AAAA,cACJ;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ;AACA,eAAO;AAAA,MACX;AAAA,IACJ;AAGA,QAAI,YAAY,oBAAoB,OAAO,uBAAuB,GAAG;AACjE,gBAAU,OAAO,uBAAuB;AACxC,kBAAY;AACZ,uBAAiB;AAAA,IACrB,WAAW,YAAY,oBAAoB,OAAO,yBAAyB,GAAG;AAC1E,gBAAU,OAAO,yBAAyB;AAC1C,kBAAY;AACZ,uBAAiB;AAAA,IACrB,WAAW,YAAY,gBAAgB,OAAO,2BAA2B,GAAG;AACxE,gBAAU,OAAO,2BAA2B;AAC5C,kBAAY;AACZ,uBAAiB;AAAA,IACrB;AACA,QAAI,CAAC,QAAS,QAAO;AACrB,UAAM,KAAK;AAAA,MACP,IAAI;AAAA,MACJ,OAAO,MAAM,UAAU,kBAAkB,uBAAuB;AAAA,MAChE,UAAU;AAAA,MACV,MAAM;AAAA,MACN,QAAQ,MAAM;AACV,cAAM,QAAQ,QAAQ,iBAAiB;AACvC,gBAAQ,eAAe,EAAE,OAAO,GAAG,SAAS,IAAI,QAAQ,CAAC,GAAG,CAAQ;AAAA,MACxE;AAAA,IACJ,CAAC;AACD,UAAM,YAAY,QAAQ,gBAAgB;AAC1C,QAAI,UAAU,SAAS,GAAG;AACtB,YAAM,KAAK,EAAE,MAAM,YAAY,CAAC;AAChC,gBAAU,QAAQ,CAAC,UAAe,UAAkB;AA5sB5D,YAAAA;AA6sBY,cAAM,aAAWA,MAAA,QAAQ,kBAAkB,MAA1B,gBAAAA,IAA6B,gBAAe,SAAS;AAEtE,cAAM,cAAc,GAAG,SAAS,IAAI,QAAQ,CAAC;AAC7C,cAAM,KAAK;AAAA,UACP,IAAI,mBAAmB,SAAS,UAAU;AAAA,UAC1C,OAAO,MAAM,GAAG,WAAW,YAAO,EAAE,GAAG,WAAW;AAAA,UAClD,UAAU,QAAQ,IAAI,SAAI,QAAQ,CAAC,KAAK;AAAA,UACxC,QAAQ,MAAM;AACV,oBAAQ,kBAAkB,SAAS,UAAU;AAE7C,kBAAM,cAAe,OAAe;AACpC,gBAAI,eAAe,OAAO,YAAY,6BAA6B,YAAY;AAE3E,kBAAI,OAAsB;AAC1B,kBAAI,YAAa,OAAe,sBAAuB,QAAO;AAAA,uBACrD,YAAa,OAAe;AACjC,uBAAO;AAAA,uBACF,YAAa,OAAe;AACjC,uBAAO;AAEX,kBAAI,MAAM;AACN,4BAAY,yBAAyB,IAAI;AAAA,cAC7C;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ,CAAC;AAAA,MACL,CAAC;AACD,YAAM;AAAA,QACF,EAAE,MAAM,YAAY;AAAA,QACpB;AAAA,UACI,IAAI;AAAA,UACJ,OAAO,MAAM,UAAU,sBAAsB;AAAA,UAC7C,MAAM;AAAA,UACN,QAAQ,MAAM;AA9uB9B,gBAAAA,KAAAC;AA+uBoB,kBAAM,OAAO,UAAU,6BAA6B;AACpD,kBAAM,aACF,OAAO,SAAS,YAAY,SAAS,gCAC/B,OACA,aAAa,SAAS,KAAK,UAAU,MAAM;AACrD,gBAAI,QAAQ,UAAU,GAAG;AACrB,sBAAQ,oBAAoB;AAE5B,oBAAM,cAAe,mCAAiB;AACtC,kBAAI,aAAa;AACb,oBAAI,SAAOA,OAAAD,MAAA,OAAO,KAAK,MAAZ,gBAAAA,IAAe,WAAf,gBAAAC,IAAuB,WAAU,YAAY;AACpD,yBAAO,KAAK,EAAE,OAAO,MAAM,WAAW;AAAA,gBAC1C,OAAO;AACH,wBAAM,KAAK,SAAS,eAAe,WAAW;AAC9C,sBAAI,MAAM,CAAC,GAAG,UAAU,SAAS,QAAQ,GAAG;AACxC,0BAAM,WAAY,OAAe;AACjC,wBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,+BAAS,KAAK,EAAE;AAAA,oBACpB,OAAO;AACH,yBAAG,UAAU,IAAI,QAAQ;AAAA,oBAC7B;AAAA,kBACJ;AAAA,gBACJ;AAAA,cACJ;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ;AACA,WAAO;AAAA,EACX;AAEA,WAAS,sBAAsB,SAAc,YAAiB,CAAC,GAAG;AAC9D,UAAM,aAAa,UAAU,cAAc;AAC3C,UAAM,UAAU,UAAU,WAAW;AACrC,UAAM,cAAc,UAAU,eAAe,QAAQ,WAAW;AAChE,WAAO;AAAA,MACH,IAAI,UAAU,MAAM;AAAA,MACpB,OAAO,MAAM,UAAU,UAAU;AAAA,MACjC,OAAO;AAAA,QACH;AAAA,UACI,IAAI;AAAA,UACJ,OAAO,MAAM,UAAU,OAAO;AAAA,UAC9B,MAAM,UAAU,YAAY;AAAA,UAC5B,QAAQ,MAAM;AACV,gBAAI,OAAO,yBAAyB;AAChC,qBAAO,yBAAyB,EAAE,WAAW;AAAA,UACrD;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAgBO,WAAS,sBAAsB,eAA+B;AAlzBrE;AAmzBI,UAAM,YAAY,SAAS,eAAe,eAAe;AACzD,QAAI,CAAC,UAAW;AAEhB,UAAMF,YAAY,OAAe;AACjC,UAAM,cAAa,WAAAA,aAAA,gBAAAA,UAAU,oBAAV,wBAAAA,eAAA,mBAA+B;AAElD,QAAI,eAAe,cAAc,kBAAkB,kBAAkB;AACjE,sBAAgB;AAAA,IACpB;AACA,UAAM,WAAW,iBAAiB,gBAAgB,aAAa,IAAI,gBAAgB;AACnF,UAAM,UAAU,gBAAgB,QAAQ,KAAK,gBAAgB;AAC7D,UAAM,UAAU,kBAAkB,iBAAiB,IAAI;AACvD,UAAM,WACF,OAAO,YAAY,aAAa,QAAQ,OAAO,IAAI,MAAM,QAAQ,OAAO,IAAI,UAAU,CAAC;AAC3F,cAAU,YAAY;AACtB,uBAAmB,MAAM;AACzB,0BAAsB;AACtB,yBAAqB,iBAAiB;AACtC,QAAI,CAAC,MAAM,QAAQ,QAAQ,KAAK,SAAS,WAAW,EAAG;AACvD,aAAS,QAAQ,CAAC,SAAc,iBAAyB;AACrD,UAAI,CAAC,QAAS;AACd,YAAM,QAAQ,mBAAmB,QAAQ,OAAO,OAAO;AACvD,UAAI,CAAC,MAAM,OAAQ;AACnB,YAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,cAAQ,YAAY;AACpB,YAAM,SAAS,SAAS,cAAc,QAAQ;AAC9C,aAAO,OAAO;AACd,aAAO,YAAY;AACnB,aAAO,QAAQ,uBAAuB;AACtC,YAAM,QAAQ,OAAO,QAAQ,UAAU,aAAa,QAAQ,MAAM,OAAO,IAAI,QAAQ;AACrF,aAAO,cAAc,SAAS;AAC9B,YAAM,YAAY,QAAQ,MAAM,WAAW,YAAY;AACvD,YAAM,WAAW,gBAAgB,SAAS;AAC1C,YAAM,aAAa,iBAAiB,SAAS;AAC7C,aAAO,KAAK;AACZ,aAAO,aAAa,iBAAiB,MAAM;AAC3C,aAAO,aAAa,iBAAiB,OAAO;AAC5C,aAAO,aAAa,iBAAiB,UAAU;AAC/C,YAAM,WAAW,SAAS,cAAc,IAAI;AAC5C,eAAS,KAAK;AACd,eAAS,YAAY;AACrB,eAAS,aAAa,QAAQ,MAAM;AACpC,eAAS,aAAa,mBAAmB,QAAQ;AACjD,YAAM,QAAQ,UAAQ;AAClB,YAAI,KAAK,SAAS,aAAa;AAC3B,gBAAM,YAAY,SAAS,cAAc,IAAI;AAC7C,oBAAU,YAAY;AACtB,oBAAU,aAAa,QAAQ,WAAW;AAC1C,oBAAU,aAAa,eAAe,MAAM;AAC5C,mBAAS,YAAY,SAAS;AAC9B;AAAA,QACJ;AACA,cAAM,KAAK,SAAS,cAAc,IAAI;AACtC,WAAG,aAAa,QAAQ,MAAM;AAC9B,cAAM,UAAU,KAAK,OAAO,MAAM;AAClC,cAAM,WAAW,SAAS,cAAc,OAAO;AAC/C,iBAAS,YAAY;AACrB,YAAI,YAAY,SAAU,UAAS,OAAO;AAAA,aACrC;AACD,mBAAS,OAAO,KAAK;AACrB,cAAI,KAAK,UAAU;AACf,qBAAS,MAAM;AACf,qBAAS,SAAS;AAAA,UACtB;AAAA,QACJ;AACA,cAAM,YACF,KAAK,UAAU,OACT,OAAO,KAAK,UAAU,aAClB,KAAK,MAAM,OAAO,IAClB,KAAK,QACT;AACV,cAAM,YAAY,SAAS,cAAc,MAAM;AAC/C,kBAAU,YAAY;AACtB,YAAI,KAAK,QAAS,OAAe,YAAY;AACzC,gBAAM,WAAW,SAAS,cAAc,MAAM;AAC9C,mBAAS,YAAY;AACrB,gBAAM,UAAW,OAAe,WAAW,iBACpC,OAAe,WAAW,eAAe,KAAK,IAAI,IACnD;AACN,cAAK,OAAe,WAAW;AAC3B,YAAC,OAAe,WAAW,sBAAsB,UAAU,SAAS,KAAK,IAAI;AACjF,oBAAU,YAAY,QAAQ;AAAA,QAClC;AACA,kBAAU,YAAY,SAAS,eAAe,SAAS,CAAC;AACxD,iBAAS,YAAY,SAAS;AAC9B,YAAI,KAAK,UAAU;AACf,gBAAM,eAAe,SAAS,cAAc,MAAM;AAClD,uBAAa,YAAY;AACzB,uBAAa,cACT,OAAO,KAAK,aAAa,aAAa,KAAK,SAAS,IAAI,KAAK;AACjE,mBAAS,YAAY,YAAY;AAAA,QACrC;AACA,iBAAS,aAAa,QAAQ,UAAU;AACxC,YAAI,KAAK,MAAO,UAAS,QAAQ,KAAK;AACtC,cAAM,aAAa,QAAQ,KAAK,QAAQ;AACxC,YAAI,YAAY;AACZ,mBAAS,aAAa,iBAAiB,MAAM;AAC7C,cAAI,YAAY,SAAU,UAAS,WAAW;AAAA,QAClD,WAAW,OAAO,KAAK,WAAW,YAAY;AAC1C,gBAAM,WAAW,mBAAmB,KAAK,MAAqB;AAC9D,cAAI,SAAU,UAAS,QAAQ,aAAa;AAAA,QAChD;AACA,YAAI,KAAK,QAAQ,OAAO,KAAK,YAAY,YAAY;AACjD,mBAAS,iBAAiB,SAAS,CAAC,UAAiB;AACjD,kBAAM,SAAU,KAAK,QAAyC,KAAK;AACnE,gBAAI,WAAW,MAAO,OAAM,eAAe;AAAA,UAC/C,CAAC;AAAA,QACL;AACA,WAAG,YAAY,QAAQ;AACvB,iBAAS,YAAY,EAAE;AAAA,MAC3B,CAAC;AACD,UAAI,CAAC,SAAS,kBAAmB;AACjC,cAAQ,YAAY,MAAM;AAC1B,cAAQ,YAAY,QAAQ;AAC5B,gBAAU,YAAY,OAAO;AAC7B,UAAK,OAAe;AAChB,QAAC,OAAe,oBAAoB,QAAQ,EAAE,mBAAmB,KAAK,CAAC;AAAA,IAC/E,CAAC;AAAA,EACL;AAEO,WAAS,2BAA2B,OAAc;AACrD,UAAM,SACF,MAAM,kBAAkB,UACjB,MAAM,OAAmB,QAAQ,oBAAoB,IACtD;AACV,QAAI,CAAC,OAAQ;AACb,UAAM,WAAW,OAAO,aAAa,kBAAkB;AACvD,UAAM,UAAU,WAAW,mBAAmB,IAAI,QAAQ,IAAI;AAC9D,QAAI,OAAO,YAAY,WAAY;AACnC,UAAM,eAAe;AACrB,UAAM,gBAAgB;AACtB,QAAK,OAAe,kBAAmB,CAAC,OAAe,kBAAkB;AACzE,QAAI;AACA,cAAQ;AAAA,IACZ,SAAS,KAAK;AACV,cAAQ,MAAM,gCAAgC,GAAG;AAAA,IACrD;AAAA,EACJ;AAEA,WAAS,mBAAmB,SAAc;AACtC,UAAM,SAAS,WAAW,QAAQ;AAClC,QAAI,UAAU,OAAO,OAAO,UAAU,WAAY,QAAO,MAAM;AAAA,EACnE;AAEA,WAAS,sBAAsB;AAC3B,QAAI,CAAC,OAAO,SAAS,EAAG,QAAO;AAC/B,WAAO,OAAO,OAAO,OAAO,SAAS,CAAC,EAAE;AAAA,MAAK,CAAC,MAC1C,KAAK,OAAO,EAAE,WAAW,aAAa,EAAE,OAAO,IAAI,QAAQ,KAAK,EAAE,MAAM;AAAA,IAC5E;AAAA,EACJ;AAEA,WAAS,yBAAyB,YAAoB;AAClD,QAAK,OAAe;AAChB,MAAC,OAAe,yBAAyB,UAAU;AAAA,EAC3D;AAEA,WAAS,kBAAkB,SAAwB;AAC/C,UAAM,IAAI;AAGV,QAAI,EAAE,qBAAqB,EAAE,sBAAuB,mBAA2B;AAC3E,UAAI;AACA,eAAO,EAAE,kBAAkB,OAAO;AAAA,MACtC,SAAS,GAAG;AACR,gBAAQ,KAAK,yDAAyD,CAAC;AAAA,MAC3E;AAAA,IACJ;AACA,WAAO,EAAE,SAAkB,QAAQ,KAAK;AAAA,EAC5C;AAIO,WAAS,qBAAqB;AACjC,0BAAsB,kBAAkB;AAAA,EAC5C;AAEO,WAAS,gCAAgC;AAC5C,UAAM,WAAW;AAAA,MACb,OAAO,uBAAuB;AAAA,MAC9B,OAAO,yBAAyB;AAAA,MAChC,OAAO,2BAA2B;AAAA,IACtC;AACA,aAAS,QAAQ,aAAW;AACxB,UAAI,CAAC,WAAW,CAAC,QAAQ,gBAAiB;AAC1C,YAAM,iBAAiB,QAAQ;AAC/B,YAAM,kBAAkB,QAAQ;AAChC,YAAM,qBAAqB,QAAQ;AACnC,UAAI;AACA,gBAAQ,iBAAiB,YAAa,MAAa;AAC/C,gBAAM,SAAS,eAAe,MAAM,MAAM,IAAI;AAC9C,cAAI,OAAQ,YAAW,oBAAoB,EAAE;AAC7C,iBAAO;AAAA,QACX;AACJ,UAAI;AACA,gBAAQ,kBAAkB,YAAa,MAAa;AAChD,gBAAM,SAAS,gBAAgB,MAAM,MAAM,IAAI;AAC/C,qBAAW,oBAAoB,EAAE;AACjC,iBAAO;AAAA,QACX;AACJ,UAAI;AACA,gBAAQ,sBAAsB,YAAa,MAAa;AACpD,gBAAM,SAAS,mBAAmB,MAAM,MAAM,IAAI;AAClD,qBAAW,oBAAoB,EAAE;AACjC,iBAAO;AAAA,QACX;AAAA,IACR,CAAC;AAAA,EACL;AAjgCA,MAiBM,oBACF,qBAmxBE,iBAWF;AAhzBJ;AAAA;AAAA;AAOA;AAUA,MAAM,qBAAqB,oBAAI,IAAyB;AACxD,MAAI,sBAAsB;AAmxB1B,MAAM,kBAAuB;AAAA,QACzB,SAAS;AAAA,QACT,kBAAkB;AAAA,QAClB,kBAAkB;AAAA,QAClB,cAAc;AAAA,QACd,eAAe;AAAA,QACf,eAAe;AAAA,QACf,sBAAsB;AAAA,QACtB,kBAAkB;AAAA,MACtB;AAEA,MAAI,qBAAoC;AAmNxC,UAAI,SAAS,eAAe;AACxB,iBAAS,iBAAiB,oBAAoB,6BAA6B;AAAA,UAC1E,YAAW,+BAA+B,GAAG;AAQlD,MAAC,OAAe,aAAa;AAAA,QACzB;AAAA,QACA;AAAA,QACA;AAAA,QACA,uBAAuB,MAAM;AAAA,MACjC;AACA,cAAQ,IAAI,0BAAqB;AAAA;AAAA;;;ACzgC1B,WAAS,wBAAgC;AAC5C,QAAI;AACA,YAAM,OAAO,SAAS,eAAe,MAAM;AAC3C,UAAI,CAAC,QAAQ,KAAK,UAAU,SAAS,QAAQ,EAAG,QAAO;AACvD,YAAM,OAAO,KAAK,sBAAsB;AACxC,YAAM,KAAK,KAAK,IAAI,OAAO,eAAe,GAAG,CAAC;AAC9C,UAAI,MAAM,EAAG,QAAO;AACpB,aAAO,KAAK,MAAM,KAAK,IAAI,GAAG,KAAK,KAAK,GAAG,CAAC;AAAA,IAChD,QAAQ;AACJ,aAAO;AAAA,IACX;AAAA,EACJ;AAGO,WAAS,wBAA8B;AAC1C,UAAM,OAAO,SAAS,eAAe,MAAM;AAC3C,QAAI,CAAC,KAAM;AAEX,UAAM,QAAQ,MAAM,KAAK,KAAK,iBAA8B,YAAY,CAAC;AACzE,QAAI,CAAC,MAAM,OAAQ;AAEnB,UAAM,QAAQ,MAAM,IAAI,UAAQ;AAC5B,YAAM,SAAS,KAAK;AACpB,YAAM,UAAU,SACT,OAAO,cAAc,eAAe,IACrC;AACN,aAAO;AAAA,QACH;AAAA,QACA;AAAA,QACA,YAAY,KAAK,gBAAgB;AAAA,MACrC;AAAA,IACJ,CAAC;AAED,QAAI,QAAuB;AAC3B,QAAI,WAA0B;AAE9B,UAAM,WAAW;AACjB,UAAM,WAAW;AACjB,UAAM,SAAS;AACf,UAAM,QAAQ,SAAS;AAEvB,UAAM,QAAQ,MAAM;AAChB,cAAQ;AACR,UAAI,aAAa,MAAM;AACnB,cAAM,QAAQ,CAAC,EAAE,MAAM,QAAQ,MAAM;AACjC,eAAK,MAAM,YAAY;AACvB,eAAK,MAAM,SAAS;AACpB,cAAI,SAAS;AACT,oBAAQ,MAAM,YAAY;AAC1B,oBAAQ,MAAM,SAAS;AAAA,UAC3B;AAAA,QACJ,CAAC;AACD;AAAA,MACJ;AAEA,YAAM,QAAQ,CAAC,EAAE,MAAM,SAAS,WAAW,MAAM;AAC7C,cAAM,OAAO,KAAK,sBAAsB;AACxC,cAAM,UAAU,KAAK,OAAO,KAAK,QAAQ;AACzC,cAAM,KAAK,KAAK,IAAI,WAAY,OAAO;AACvC,cAAM,YAAY,KAAK,IAAI,EAAE,KAAK,OAAO,IAAI,QAAQ,MAAM;AAC3D,cAAM,QAAQ,KAAK;AAAA,UACf;AAAA,UACA,KAAK,IAAI,UAAU,YAAY,WAAW,YAAY,SAAS;AAAA,QACnE;AAEA,cAAM,OAAO,cAAc,KAAK,gBAAgB;AAChD,cAAM,aAAa,KAAK,IAAI,IAAI,QAAQ,KAAK,OAAO,GAAG;AAEvD,aAAK,MAAM,YAAY,eAAe,WAAW,QAAQ,CAAC,CAAC,aAAa,MAAM,QAAQ,CAAC,CAAC;AACxF,aAAK,MAAM,SAAS,QAAQ,OAAO,QAAQ;AAE3C,YAAI,SAAS;AACT,gBAAM,OAAO,KAAK,IAAI,GAAG,QAAQ,QAAQ,KAAK,UAAU;AACxD,gBAAM,MAAM;AACZ,kBAAQ,MAAM,YAAY,gBAAgB,OAAO,KAAK,QAAQ,CAAC,CAAC;AAChE,kBAAQ,MAAM,SAAS;AAAA,QAC3B;AAAA,MACJ,CAAC;AAAA,IACL;AAEA,UAAM,SAAS,CAAC,MAAkB;AAC9B,iBAAW,EAAE;AACb,UAAI,CAAC,MAAO,SAAQ,sBAAsB,KAAK;AAAA,IACnD;AACA,UAAM,UAAU,MAAM;AAClB,iBAAW;AACX,UAAI,CAAC,MAAO,SAAQ,sBAAsB,KAAK;AAAA,IACnD;AAEA,SAAK,iBAAiB,aAAa,MAAM;AACzC,SAAK,iBAAiB,cAAc,OAAO;AAAA,EAC/C;AAKO,WAAS,gBAAiC;AAC7C,QAAI;AACA,YAAM,SAAS,QAAyB,wBAAwB,IAAI;AACpE,aAAO,MAAM,QAAQ,MAAM,IAAI,SAAS;AAAA,IAC5C,QAAQ;AACJ,aAAO;AAAA,IACX;AAAA,EACJ;AAEO,WAAS,cAAc,OAA0C;AACpE,QAAI;AACA,cAAQ,wBAAwB,SAAS,CAAC,CAAC;AAAA,IAC/C,QAAQ;AAAA,IAER;AAAA,EACJ;AAEO,WAAS,cAAc,MAAqC;AAC/D,QAAI,CAAC,KAAM,QAAO;AAClB,WAAQ,KAAK,aAAa,gBAAgB,KAAgB;AAAA,EAC9D;AAEO,WAAS,sBAAgC;AAC5C,UAAM,OAAO,SAAS,cAAc,kBAAkB;AACtD,QAAI,CAAC,KAAM,QAAO,CAAC;AACnB,WAAO,MAAM,KAAK,KAAK,iBAAiB,YAAY,CAAC,EAChD,IAAI,QAAM,cAAc,EAAE,CAAC,EAC3B,OAAO,OAAO;AAAA,EACvB;AAEO,WAAS,eAAe,OAA0C;AACrE,QAAI,CAAC,MAAM,QAAQ,KAAK,KAAK,CAAC,MAAM,OAAQ;AAC5C,UAAM,OAAO,SAAS,cAAc,kBAAkB;AACtD,QAAI,CAAC,KAAM;AACX,UAAM,QAAQ,MAAM,KAAK,KAAK,iBAA8B,YAAY,CAAC;AACzE,UAAM,MAAM,IAAI,IAAI,MAAM,IAAI,QAAM,CAAC,cAAc,EAAE,GAAG,EAAE,CAAC,CAAC;AAC5D,UAAM,WAAW,SAAS,uBAAuB;AACjD,UAAM,QAAQ,QAAM;AAChB,YAAM,KAAK,IAAI,IAAI,EAAuB;AAC1C,UAAI,IAAI;AACJ,iBAAS,YAAY,EAAE;AACvB,YAAI,OAAO,EAAuB;AAAA,MACtC;AAAA,IACJ,CAAC;AACD,eAAW,CAAC,EAAE,EAAE,KAAK,IAAK,UAAS,YAAY,EAAE;AACjD,SAAK,YAAY,QAAQ;AAAA,EAC7B;AAEO,WAAS,kBAAkB,OAAgB,QAA8B;AAC5E,UAAM,KAAK,SAAS,cAAc,KAAK;AACvC,OAAG,YAAY;AACf,OAAG,aAAa,eAAe,MAAM;AACrC,OAAG,MAAM,QAAQ,KAAK,IAAI,GAAG,KAAK,MAAM,SAAS,EAAE,CAAC,IAAI;AACxD,OAAG,MAAM,SAAS,KAAK,IAAI,GAAG,KAAK,MAAM,UAAU,EAAE,CAAC,IAAI;AAC1D,OAAG,MAAM,UAAU;AACnB,OAAG,MAAM,gBAAgB;AACzB,WAAO;AAAA,EACX;AAEO,WAAS,mBAAyB;AACrC,UAAM,OAAO,SAAS,eAAe,MAAM;AAC3C,UAAM,OAAO,OAAQ,KAAK,cAAc,YAAY,IAA2B;AAC/E,QAAI,CAAC,QAAQ,CAAC,KAAM;AAEpB,UAAM,YAAY,cAAc;AAChC,QAAI,aAAa,UAAU,OAAQ,gBAAe,SAAS;AAE3D,QAAI,cAAkC;AACtC,QAAI,cAAkC;AACtC,QAAI,iBAAiB;AACrB,QAAI,sBAAsB;AAE1B,UAAM,wBAAwB,CAAC,QAA4B;AACvD,UAAI,CAAC,eAAe,CAAC,IAAK;AAC1B,UAAI;AACA,cAAM,IAAI,IAAI,sBAAsB;AACpC,oBAAY,MAAM,QAAQ,EAAE,QAAQ;AACpC,oBAAY,MAAM,SAAS,EAAE,SAAS;AAAA,MAC1C,QAAQ;AAAA,MAER;AAAA,IACJ;AAEA,UAAM,kBAAkB,CAAC,YAAyB,YAAoB;AAClE,UAAI,CAAC,QAAQ,CAAC,WAAY;AAC1B,UAAI,CAAC,YAAa,eAAc,kBAAkB;AAClD,4BAAsB,eAAe,UAAU;AAC/C,YAAM,OAAO,WAAW,sBAAsB;AAC9C,YAAM,eAAe,UAAU,KAAK,OAAO,KAAK,QAAQ;AACxD,WAAK,aAAa,aAAa,eAAe,aAAa,WAAW,WAAW;AAAA,IACrF;AAEA,UAAM,qBAAqB,CAAC,MAAiB;AACzC,UAAI,CAAC,YAAa;AAClB,QAAE,eAAe;AACjB,UAAI,EAAE,aAAc,GAAE,aAAa,aAAa;AAChD,YAAM,QAAQ,MAAM,KAAK,KAAK,iBAA8B,YAAY,CAAC,EAAE;AAAA,QACvE,QAAM,OAAO;AAAA,MACjB;AACA,UAAI,CAAC,YAAa,eAAc,kBAAkB;AAClD,UAAI,MAAM,WAAW,GAAG;AACpB,aAAK,YAAY,WAAW;AAC5B;AAAA,MACJ;AACA,UAAI,SAA6B;AACjC,iBAAW,MAAM,OAAO;AACpB,cAAM,IAAI,GAAG,sBAAsB;AACnC,YAAI,EAAE,UAAU,EAAE,OAAO,EAAE,QAAQ,GAAG;AAClC,mBAAS;AACT;AAAA,QACJ;AAAA,MACJ;AACA,4BAAsB,eAAe,MAAM,CAAC,CAAC;AAC7C,UAAI,OAAQ,MAAK,aAAa,aAAa,MAAM;AAAA,UAC5C,MAAK,YAAY,WAAW;AAAA,IACrC;AAEA,UAAM,cAAc,SAA6B,GAAc;AAC3D,YAAM,OAAQ,KAAqB,QAAQ,YAAY;AACvD,UAAI,CAAC,KAAM;AACX,oBAAc;AACd,uBAAiB,SAAS,KAAK,MAAM,cAAc;AACnD,eAAS,KAAK,MAAM,aAAa;AACjC,4BAAsB,KAAK,IAAI,IAAI;AACnC,UAAI;AACA,cAAM,OAAQ,KAAK,cAAc,YAAY,KAAqB;AAClE,cAAMG,KAAI,KAAK,sBAAsB;AACrC,YAAI,EAAE,cAAc;AAChB,YAAE,aAAa,QAAQ,cAAc,cAAc,IAAI,KAAK,EAAE;AAC9D,YAAE,aAAa,gBAAgB;AAC/B,YAAE,aAAa,aAAa,MAAiBA,GAAE,QAAQ,GAAGA,GAAE,SAAS,CAAC;AAAA,QAC1E;AAAA,MACJ,QAAQ;AAAA,MAER;AACA,YAAM,IAAI,KAAK,sBAAsB;AACrC,oBAAc,kBAAkB,EAAE,OAAO,EAAE,MAAM;AACjD,WAAK,aAAa,aAAa,KAAK,WAAW;AAAA,IACnD;AAEA,UAAM,aAAa,CAAC,MAAiB;AACjC,UAAI,CAAC,YAAa;AAClB,QAAE,eAAe;AACjB,UAAI,EAAE,aAAc,GAAE,aAAa,aAAa;AAChD,YAAM,SAAU,EAAE,OAAmB,QAAQ,YAAY;AACzD,UAAI,CAAC,UAAU,WAAW,aAAa;AACnC,2BAAmB,CAAC;AACpB;AAAA,MACJ;AACA,sBAAgB,QAAQ,EAAE,OAAO;AAAA,IACrC;AAEA,UAAM,eAAe,MAAM;AACvB,UAAI,CAAC,eAAe,CAAC,YAAa;AAClC,WAAK,aAAa,aAAa,WAAW;AAC1C,kBAAY,OAAO;AACnB,oBAAc;AACd,YAAM,QAAQ,oBAAoB;AAClC,oBAAc,KAAK;AAAA,IACvB;AAEA,UAAM,SAAS,CAAC,MAAiB;AAC7B,UAAI,CAAC,YAAa;AAClB,QAAE,eAAe;AACjB,YAAM,eACF,eACA,YAAY,gBACX,YAAY,oBAAoB,eAC7B,YAAY,gBAAgB;AACpC,UAAI,CAAC,eAAe,CAAC,YAAY,eAAe,cAAc;AAC1D,cAAM,IAAI,EAAE;AACZ,cAAM,QAAQ,MAAM,KAAK,KAAK,iBAA8B,YAAY,CAAC,EAAE;AAAA,UACvE,QAAM,OAAO;AAAA,QACjB;AACA,YAAI,WAAW;AACf,mBAAW,MAAM,OAAO;AACpB,gBAAM,IAAI,GAAG,sBAAsB;AACnC,cAAI,IAAI,EAAE,OAAO,EAAE,QAAQ,GAAG;AAC1B,iBAAK,aAAa,aAAa,EAAE;AACjC,uBAAW;AACX;AAAA,UACJ;AAAA,QACJ;AACA,YAAI,CAAC,SAAU,MAAK,YAAY,WAAW;AAC3C,cAAM,QAAQ,oBAAoB;AAClC,sBAAc,KAAK;AACnB,gBAAQ;AACR;AAAA,MACJ;AACA,mBAAa;AAAA,IACjB;AAEA,UAAM,UAAU,MAAM;AAClB,UAAI,eAAe,YAAY,YAAa,aAAY,OAAO;AAC/D,oBAAc;AACd,oBAAc;AACd,eAAS,KAAK,MAAM,aAAa;AAAA,IACrC;AAEA,UAAM,YAAY,MAAM;AACpB,cAAQ;AAAA,IACZ;AAEA,SAAK;AAAA,MACD;AAAA,MACA,QAAM;AACF,YAAI,KAAK,IAAI,IAAI,uBAAuB,aAAa;AACjD,aAAG,gBAAgB;AACnB,aAAG,eAAe;AAAA,QACtB;AAAA,MACJ;AAAA,MACA;AAAA,IACJ;AAEA,WAAO,iBAAiB,QAAQ,OAAO;AAEvC,UAAM,kBAAkB,MAAM;AAC1B,WAAK,iBAA8B,YAAY,EAAE,QAAQ,QAAM;AAC3D,WAAG,aAAa,aAAa,MAAM;AACnC,WAAG,iBAAiB,aAAa,WAAW;AAAA,MAChD,CAAC;AAAA,IACL;AACA,oBAAgB;AAEhB,SAAK,iBAAiB,YAAY,UAA2B;AAC7D,SAAK,iBAAiB,QAAQ,MAAuB;AACrD,SAAK,iBAAiB,WAAW,SAA0B;AAAA,EAC/D;AAEO,WAAS,uBAA6B;AACzC,UAAM,IAAI;AACV,UAAM,WAAW,EAAE;AAEnB,UAAM,oBAAoB;AAAA,MACtB,EAAE,aAAa,oBAAoB,YAAY,SAAS;AAAA,MACxD,EAAE,SAAS,kBAAkB,aAAa,qBAAqB;AAAA,MAC/D,EAAE,SAAS,kBAAkB,aAAa,qBAAqB;AAAA,MAC/D,EAAE,SAAS,cAAc,aAAa,kBAAkB,YAAY,cAAc;AAAA,MAClF,EAAE,SAAS,kBAAkB,aAAa,sBAAsB,YAAY,WAAW;AAAA,IAC3F;AAEA,sBAAkB,QAAQ,aAAW;AACjC,YAAM,YAAY,SAAS,eAAe,QAAQ,WAAW;AAC7D,UAAI,CAAC,UAAW;AAEhB,UAAI,gBAAgB;AAGpB,UAAI,QAAQ,cAAc,EAAE,gBAAgB;AACxC,cAAM,UAAU,EAAE,eAAe,iBAAiB,QAAQ,UAAU;AACpE,wBAAgB,WAAW,QAAQ,SAAS;AAAA,MAChD;AAGA,UAAI,CAAC,eAAe;AAChB,cAAM,QAAQ,QAAQ,UAAU,SAAS,eAAe,QAAQ,OAAO,IAAI;AAC3E,YAAI,OAAO;AACP,gBAAM,YAAY,MAAM,WAAW,MAAM,QAAQ,cAAc;AAC/D,0BAAgB,CAAC,MAAM,UAAU,SAAS,QAAQ,KAAK;AAAA,QAC3D;AAAA,MACJ;AAGA,UAAI,eAAe;AACf,YAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,mBAAS,KAAK,SAAS;AAAA,QAC3B,OAAO;AACH,oBAAU,UAAU,OAAO,QAAQ;AAAA,QACvC;AAAA,MACJ,OAAO;AACH,YAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,mBAAS,KAAK,SAAS;AAAA,QAC3B,OAAO;AACH,oBAAU,UAAU,IAAI,QAAQ;AAAA,QACpC;AAAA,MACJ;AAAA,IACJ,CAAC;AAAA,EACL;AA/XA,MAwGM;AAxGN;AAAA;AAAA;AAKA;AAmGA,MAAM,yBAAyB;AAgS/B,UAAI,OAAO,WAAW,aAAa;AAC/B,QAAC,OAAe,aAAa;AAAA,UACzB;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACJ;AAEA,YAAI,OAAQ,OAAe,yBAAyB,YAAY;AAC5D,UAAC,OAAe,uBAAuB;AAAA,QAC3C;AAAA,MACJ;AAAA;AAAA;;;ACvZA,MASa;AATb;AAAA;AAAA;AAOA;AAEO,MAAM,SAAN,MAAa;AAAA,QAMhB,YAAY,SAAiB;AAfjC;AAgBQ,eAAK,UAAU;AACf,gBAAM,KAAK,SAAS,eAAe,OAAO;AAC1C,cAAI,CAAC,IAAI;AACL,oBAAQ,MAAM,qCAAqC,OAAO,GAAG;AAC7D,kBAAM,IAAI,MAAM,qBAAqB,OAAO,EAAE;AAAA,UAClD;AACA,eAAK,QAAQ;AAEb,gBAAM,UAAU,YAAe,kBAAf,mBAA8B;AAC9C,eAAK,WAAW,SACV,OAAO,KAAK,KAAK,IAChB,KAAK,MAAM,cAAc,cAAc,KAAqB,KAAK;AACxE,eAAK,mBAAmB;AACxB,eAAK,KAAK;AAAA,QACd;AAAA,QAEA,OAAO;AACH,eAAK,cAAc;AACnB,eAAK,cAAc;AACnB,gBAAM,cAAc,KAAK,MAAM;AAAA,YAC3B;AAAA,UACJ;AACA,cAAI,aAAa;AACb,wBAAY,MAAM,SAAS;AAC3B,YAAC,YAAoB,QAAQ,eAAe;AAC5C,gBAAI,CAAE,YAAoB,QAAQ,kBAAkB;AAChD,cAAC,YAAoB,QAAQ,mBAAmB;AAChD,0BAAY,iBAAiB,SAAS,OAAK;AACvC,kBAAE,eAAe;AACjB,kBAAE,gBAAgB;AAClB,qBAAK,MAAM;AAAA,cACf,CAAC;AAAA,YACL;AAAA,UACJ;AAEA,gBAAM,aAAa,KAAK,MAAM;AAAA,YAC1B;AAAA,UACJ;AACA,gBAAM,aAAa,KAAK,MAAM;AAAA,YAC1B;AAAA,UACJ;AACA,cAAI,YAAY;AACZ,uBAAW,MAAM,SAAS;AAC1B,uBAAW,QAAQ,WAAW,SAAS;AACvC,YAAC,WAAmB,QAAQ,eAAe;AAC3C,uBAAW,iBAAiB,SAAS,OAAK;AACtC,gBAAE,gBAAgB;AAClB,mBAAK,SAAS;AAAA,YAClB,CAAC;AAAA,UACL;AACA,cAAI,YAAY;AACZ,uBAAW,MAAM,SAAS;AAC1B,uBAAW,QAAQ,WAAW,SAAS;AACvC,YAAC,WAAmB,QAAQ,eAAe;AAC3C,uBAAW,iBAAiB,SAAS,OAAK;AACtC,gBAAE,gBAAgB;AAClB,mBAAK,eAAe;AAAA,YACxB,CAAC;AAAA,UACL;AAAA,QACJ;AAAA,QAEA,OAAO;AA7EX;AA8EQ,cAAI,CAAC,KAAK,OAAO;AACb,oBAAQ,MAAM,uDAAuD,KAAK,OAAO,GAAG;AACpF;AAAA,UACJ;AAGA,eAAK,wBAAwB;AAG7B,WAAC,YAAe,sBAAf;AAGD,gBAAM,WAAY,OAAe;AACjC,cAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,qBAAS,KAAK,KAAK,KAAK;AAAA,UAC5B,OAAO;AACH,iBAAK,MAAM,UAAU,OAAO,QAAQ;AAAA,UACxC;AAEA,cAAI,KAAK,SAAS,KAAK,MAAM,QAAS,QAAQ,KAAK,MAAM,QAAgB;AACzE,eAAK,aAAa;AAClB,eAAK,uBAAuB;AAC5B,WAAC,YAAe,mBAAf;AACD,WAAC,YAAe,yBAAf;AACD,WAAC,YAAe,iCAAf;AAAA,QACL;AAAA,QAEQ,0BAA0B;AAzGtC;AA2GQ,gBAAM,MAAM;AACZ,gBAAM,UAAS,eAAI,kBAAJ,mBAAmB,cAAnB,4BAA+B,KAAK;AACnD,cAAI,CAAC,UAAU,GAAC,YAAO,aAAP,mBAAiB,sBAAsB;AAAA,QAC3D;AAAA,QAEA,QAAQ;AAhHZ;AAiHQ,cAAI,KAAK,MAAM,UAAU,SAAS,QAAQ,EAAG;AAG7C,gBAAM,WAAY,OAAe;AACjC,cAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,qBAAS,KAAK,KAAK,KAAK;AAAA,UAC5B,OAAO;AACH,iBAAK,MAAM,UAAU,IAAI,QAAQ;AAAA,UACrC;AAGA,gBAAM,gBAAgB,iBAAiB;AACvC,wBAAc,aAAa,KAAK,MAAM,EAAE;AAExC,WAAC,YAAe,mBAAf;AACD,WAAC,YAAe,yBAAf;AACD,WAAC,YAAe,iCAAf;AAAA,QACL;AAAA,QAEA,WAAW;AApIf;AAqIQ,cAAI,KAAK,MAAM,QAAS,CAAC,KAAK,MAAM,QAAgB,YAAY;AAGhE,gBAAM,WAAY,OAAe;AACjC,cAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,gBAAI,CAAC,KAAK,MAAM,UAAU,SAAS,QAAQ,GAAG;AAC1C,uBAAS,KAAK,KAAK,KAAK;AAAA,YAC5B;AAAA,UACJ,OAAO;AACH,gBAAI,CAAC,KAAK,MAAM,UAAU,SAAS,QAAQ,GAAG;AAC1C,mBAAK,MAAM,UAAU,IAAI,QAAQ;AAAA,YACrC;AAAA,UACJ;AAEA,WAAC,YAAe,mBAAf;AACD,WAAC,YAAe,yBAAf;AACD,WAAC,YAAe,iCAAf;AAAA,QACL;AAAA,QAEA,iBAAiB;AAxJrB;AAyJQ,gBAAM,SAAS,KAAK,YAAY,KAAK;AACrC,cAAI,CAAC,OAAQ;AACb,eAAK,OAAO,EAAE,QAAQ,KAAK,CAAC;AAC5B,gBAAM,KAAM,KAAK,MAAM,WAAmB,CAAC;AAC3C,gBAAM,QAAQ,GAAG,cAAc;AAC/B,cAAI,OAAO;AACP,gBAAI,GAAG,aAAa,OAAW,QAAO,MAAM,OAAO,GAAG;AACtD,gBAAI,GAAG,YAAY,OAAW,QAAO,MAAM,MAAM,GAAG;AACpD,gBAAI,GAAG,cAAc,OAAW,QAAO,MAAM,QAAQ,GAAG;AACxD,gBAAI,GAAG,eAAe,OAAW,QAAO,MAAM,SAAS,GAAG;AAC1D,gBAAI,GAAG,iBAAiB,OAAW,QAAO,MAAM,WAAW,GAAG;AAC9D,mBAAO,GAAG;AACV,mBAAO,GAAG;AACV,mBAAO,GAAG;AACV,mBAAO,GAAG;AACV,mBAAO,GAAG;AACV,mBAAO,GAAG;AACV,iBAAK,uBAAuB;AAC5B,aAAC,YAAe,wBAAf;AACD;AAAA,UACJ;AACA,gBAAM,WAAW,OAAO,iBAAiB,MAAM;AAC/C,UAAC,KAAK,MAAM,QAAgB,WAAW,OAAO,MAAM,QAAQ,SAAS,QAAQ;AAC7E,UAAC,KAAK,MAAM,QAAgB,UAAU,OAAO,MAAM,OAAO,SAAS,OAAO;AAC1E,UAAC,KAAK,MAAM,QAAgB,YAAY,OAAO,MAAM,SAAS,SAAS,SAAS;AAChF,UAAC,KAAK,MAAM,QAAgB,aAAa,OAAO,MAAM,UAAU,SAAS,UAAU;AACnF,UAAC,KAAK,MAAM,QAAgB,eAAe,OAAO,MAAM,YAAY,SAAS,YAAY;AACzF,gBAAM,SAAS,KAAK,QAAO,YAAe,qBAAf,oCAAuC,CAAC;AACnE,iBAAO,MAAM,WAAW;AACxB,iBAAO,MAAM,OAAO;AACpB,iBAAO,MAAM,MAAM,GAAG,MAAM;AAC5B,iBAAO,MAAM,QAAQ;AACrB,iBAAO,MAAM,SAAS,gBAAgB,MAAM;AAC5C,cAAI;AACA,kBAAM,kBAAiB,YAAe,0BAAf,oCAA4C;AACnE,kBAAM,cAAc,KAAK,IAAI,IAAI,OAAO,eAAe,KAAK,SAAS,aAAa;AAClF,mBAAO,MAAM,SAAS,GAAG,WAAW;AAAA,UACxC,QAAQ;AAAA,UAAC;AACT,UAAC,KAAK,MAAM,QAAgB,YAAY;AACxC,eAAK,aAAa;AAClB,WAAC,YAAe,wBAAf;AAAA,QACL;AAAA,QAEA,OAAO,MAAwB,UAAe,CAAC,GAAG;AApMtD;AAqMQ,gBAAM,SAAS,KAAK,YAAY,KAAK;AACrC,cAAI,CAAC,OAAQ,QAAO;AACpB,cAAI,SAAS,UAAU,SAAS,QAAS,QAAO;AAChD,gBAAM,EAAE,SAAS,MAAM,IAAI;AAC3B,gBAAM,KAAM,KAAK,MAAM,WAAmB,CAAC;AAC3C,gBAAM,iBAAiB,GAAG;AAC1B,cAAI,CAAC,gBAAgB;AACjB,kBAAM,WAAW,OAAO,iBAAiB,MAAM;AAC/C,eAAG,eAAe,OAAO,MAAM,QAAQ,SAAS,QAAQ;AACxD,eAAG,cAAc,OAAO,MAAM,OAAO,SAAS,OAAO;AACrD,eAAG,gBAAgB,OAAO,MAAM,SAAS,SAAS,SAAS;AAC3D,eAAG,iBAAiB,OAAO,MAAM,UAAU,SAAS,UAAU;AAC9D,eAAG,mBAAmB,OAAO,MAAM,YAAY,SAAS,YAAY;AACpE,eAAG,gBAAgB,OAAO,MAAM,SAAS,SAAS,SAAS;AAC3D,eAAG,iBAAiB,OAAO,MAAM,UAAU,SAAS,UAAU;AAAA,UAClE;AACA,gBAAM,WAAW,YAAe,uBAAf,gCAAoC;AACrD,cAAI,CAAC,SAAS;AACV,iBAAK,OAAO,EAAE,QAAQ,KAAK,CAAC;AAC5B,mBAAO;AAAA,UACX;AACA,iBAAO,MAAM,WAAW;AACxB,iBAAO,MAAM,MAAM,GAAG,QAAQ,GAAG;AACjC,iBAAO,MAAM,OAAO,GAAG,QAAQ,IAAI;AACnC,iBAAO,MAAM,QAAQ,GAAG,QAAQ,KAAK;AACrC,iBAAO,MAAM,SAAS,GAAG,QAAQ,MAAM;AACvC,iBAAO,MAAM,QAAQ;AACrB,iBAAO,MAAM,SAAS;AACtB,UAAC,KAAK,MAAM,QAAgB,UAAU;AACtC,eAAK,aAAa;AAClB,WAAC,YAAe,oBAAf;AACD,cAAI,CAAC,OAAQ,EAAC,YAAe,wBAAf;AACd,iBAAO;AAAA,QACX;AAAA,QAEA,OAAO,UAAe,CAAC,GAAG;AAxO9B;AAyOQ,gBAAM,SAAS,KAAK,YAAY,KAAK;AACrC,cAAI,CAAC,OAAQ,QAAO;AACpB,gBAAM,EAAE,SAAS,MAAM,IAAI;AAC3B,gBAAM,KAAM,KAAK,MAAM,WAAmB,CAAC;AAC3C,cAAI,CAAC,GAAG,QAAS,QAAO;AACxB,gBAAM,UAAU,CAAC,KAAa,SAAiB;AAC3C,gBAAI,OAAO,UAAU,eAAe,KAAK,IAAI,GAAG,GAAG;AAC/C,oBAAM,QAAQ,GAAG,GAAG;AACpB,kBAAI,UAAU,GAAI,QAAO,MAAM,IAAW,IAAI;AAAA,kBACzC,QAAO,MAAM,IAAW,IAAI;AACjC,qBAAO,GAAG,GAAG;AAAA,YACjB,OAAO;AACH,qBAAO,MAAM,IAAW,IAAI;AAAA,YAChC;AAAA,UACJ;AACA,kBAAQ,gBAAgB,MAAM;AAC9B,kBAAQ,eAAe,KAAK;AAC5B,kBAAQ,iBAAiB,OAAO;AAChC,kBAAQ,kBAAkB,QAAQ;AAClC,kBAAQ,oBAAoB,UAAU;AACtC,kBAAQ,iBAAiB,OAAO;AAChC,kBAAQ,kBAAkB,QAAQ;AAClC,iBAAO,GAAG;AACV,WAAC,YAAe,oBAAf;AACD,eAAK,uBAAuB;AAC5B,cAAI,CAAC,OAAQ,EAAC,YAAe,wBAAf;AACd,iBAAO;AAAA,QACX;AAAA,QAEA,mBAAmB,QAA4B,UAAyB;AAtQ5E;AAuQQ,cAAI,CAAC,QAAQ;AACT,aAAC,YAAe,oBAAf;AACD,mBAAO;AAAA,UACX;AACA,gBAAM,YAAY,KAAK,iBAAiB,QAAQ,QAAQ;AACxD,cAAI,WAAW;AACX,iBAAK,OAAO,WAAW,EAAE,QAAQ,KAAK,CAAC;AACvC,aAAC,YAAe,oBAAf;AACD,mBAAO;AAAA,UACX;AACA,eAAK,OAAO,EAAE,QAAQ,KAAK,CAAC;AAC5B,WAAC,YAAe,oBAAf;AACD,iBAAO;AAAA,QACX;AAAA,QAEA,iBAAiB,QAA4B,UAAyB;AAClE,cAAI,CAAC,OAAQ,QAAO;AACpB,gBAAM,gBAAgB,KAAK,IAAI,OAAO,cAAc,GAAG,CAAC;AACxD,cAAI,iBAAiB,EAAG,QAAO;AAC/B,gBAAM,YAAY,KAAK,IAAI,GAAG,KAAK,IAAI,IAAI,gBAAgB,KAAM,CAAC;AAClE,gBAAM,OAAO,OAAO,sBAAsB;AAC1C,gBAAM,kBACF,OAAO,aAAa,WAAW,KAAK,IAAI,GAAG,QAAQ,IAAI,KAAK,IAAI,KAAK,IAAI;AAC7E,cAAI,KAAK,IAAI,KAAK,IAAI,KAAK,aAAa,mBAAmB,UAAW,QAAO;AAC7E,gBAAM,YAAY,gBAAgB,KAAK;AACvC,gBAAM,mBACF,OAAO,aAAa,WACd,KAAK,IAAI,GAAG,gBAAgB,QAAQ,IACpC,KAAK,IAAI,SAAS;AAC5B,cAAI,KAAK,IAAI,SAAS,KAAK,aAAa,oBAAoB,UAAW,QAAO;AAC9E,iBAAO;AAAA,QACX;AAAA,QAEA,eAAe;AAGX,gBAAM,gBAAgB,iBAAiB;AACvC,wBAAc,aAAa,KAAK,MAAM,IAAI,KAAK,OAAO,KAAK,QAAQ;AAAA,QACvE;AAAA,QAEA,UAAU;AA/Sd;AAgTQ,eAAK,aAAa;AAClB,WAAC,YAAe,sBAAf;AACD,WAAC,YAAe,mBAAf;AACD,WAAC,YAAe,iCAAf;AAAA,QACL;AAAA,QAEA,gBAAgB;AACZ,gBAAM,SAAS,KAAK,MAAM,cAAc,mBAAmB;AAC3D,gBAAM,SAAS,KAAK,YAAY,KAAK;AACrC,cAAI,CAAC,UAAU,CAAC,OAAQ;AACxB,iBAAO,MAAM,SAAS;AACtB,cAAI,UAAU,GACV,UAAU;AACd,iBAAO,iBAAiB,aAAa,CAAC,MAAkB;AA7ThE;AA8TY,iBAAK,QAAQ;AACb,gBACK,EAAE,OAAmB,WACrB,EAAE,OAAmB,QAAQ,sBAAsB;AAEpD;AACJ,gBACK,EAAE,OAAmB,WACrB,EAAE,OAAmB,QAAQ,sBAAsB;AAEpD;AACJ,gBAAI,KAAK,MAAM,WAAY,KAAK,MAAM,QAAgB,cAAc,OAAQ;AAC5E,kBAAM,WAAW,EAAE;AACnB,kBAAM,WAAW,EAAE;AACnB,kBAAM,kBAAkB,KAAK,MAAM,UAAW,KAAK,MAAM,QAAgB,UAAU;AACnF,gBAAI,OAAO,OAAO,sBAAsB;AACxC,gBAAI,eAAe,WAAW,KAAK;AACnC,gBAAI,eAAe,WAAW,KAAK;AACnC,gBAAI,iBAAiB;AACjB,oBAAM,mBAAmB;AACzB,oBAAM,mBAAmB;AACzB,mBAAK,OAAO,EAAE,QAAQ,KAAK,CAAC;AAC5B,oBAAM,sBAAqB,YAAe,qBAAf,oCAAuC;AAClE,qBAAO,MAAM,WAAW;AACxB,qBAAO,MAAM,OAAO,GAAG,WAAW,gBAAgB;AAClD,qBAAO,MAAM,MAAM,GAAG,KAAK,IAAI,mBAAmB,WAAW,gBAAgB,CAAC;AAC9E,qBAAO,OAAO,sBAAsB;AACpC,6BAAe,WAAW,KAAK;AAC/B,6BAAe,WAAW,KAAK;AAAA,YACnC;AACA,kBAAM,mBAAmB,OAAO,iBAAiB,MAAM,EAAE;AACzD,gBAAI,qBAAqB,YAAY,qBAAqB,YAAY;AAClE,qBAAO,MAAM,WAAW;AAAA,YAC5B,WAAW,CAAC,OAAO,MAAM,UAAU;AAC/B,qBAAO,MAAM,WAAW;AAAA,YAC5B;AACA,kBAAM,WAAU,YAAe,qBAAf,oCAAuC;AACvD,mBAAO,MAAM,OAAO,GAAG,WAAW,YAAY;AAC9C,mBAAO,MAAM,MAAM,GAAG,KAAK,IAAI,QAAQ,WAAW,YAAY,CAAC;AAC/D,aAAC,YAAe,yBAAf,gCAAsC;AACvC,kBAAM,eAAe,OAAO,sBAAsB;AAClD,sBAAU,WAAW,aAAa;AAClC,sBAAU,WAAW,aAAa;AAClC,iBAAK,mBAAmB;AACxB,kBAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,oBAAQ,MAAM,WAAW;AACzB,oBAAQ,MAAM,MAAM;AACpB,oBAAQ,MAAM,OAAO;AACrB,oBAAQ,MAAM,QAAQ;AACtB,oBAAQ,MAAM,SAAS;AACvB,oBAAQ,MAAM,SAAS;AACvB,oBAAQ,MAAM,SAAS;AACvB,oBAAQ,MAAM,kBAAkB;AAChC,qBAAS,KAAK,YAAY,OAAO;AACjC,gBAAI,aAAa;AACjB,gBAAI,QAAQ;AACZ,kBAAM,UAAU,CAAC,aAAa,SAAS;AAtXnD,kBAAAC,KAAAC;AAuXgB,kBAAI,CAAC,WAAY;AACjB,2BAAa;AACb,sBAAQ,OAAO;AACf,sBAAQ,oBAAoB,aAAa,gBAAgB;AACzD,sBAAQ,oBAAoB,WAAW,cAAc;AACrD,qBAAO,oBAAoB,WAAW,cAAc;AACpD,qBAAO,oBAAoB,QAAQ,WAAW;AAC9C,qBAAO,oBAAoB,aAAa,gBAAgB;AACxD,eAACD,MAAA,OAAe,oBAAf,gBAAAA,IAAA;AACD,kBAAI,YAAY;AACZ,oBAAI,OAAO;AACP,uBAAK,mBAAmB,QAAQ,KAAK,gBAAgB;AAAA,gBACzD,WAAW,iBAAiB;AACxB,uBAAK,OAAO,iBAAiB,EAAE,QAAQ,KAAK,CAAC;AAAA,gBACjD;AACA,iBAACC,MAAA,OAAe,wBAAf,gBAAAA,IAAA;AAAA,cACL;AACA,mBAAK,mBAAmB;AAAA,YAC5B;AACA,kBAAM,mBAAmB,CAAC,OAAmB;AACzC,sBAAQ;AACR,qBAAO,sBAAsB,MAAM;AA5YnD,oBAAAD,KAAAC,KAAAC;AA6YoB,sBAAM,UAAU,GAAG,UAAU;AAC7B,sBAAM,SAAS,GAAG,UAAU;AAC5B,sBAAMC,YAAUH,MAAA,OAAe,qBAAf,gBAAAA,IAAA,iBAAuC;AACvD,uBAAO,MAAM,OAAO,UAAU;AAC9B,uBAAO,MAAM,MAAM,KAAK,IAAIG,SAAQ,MAAM,IAAI;AAC9C,qBAAK,mBAAmB,GAAG;AAC3B,sBAAM,YAAY,KAAK,iBAAiB,QAAQ,KAAK,gBAAgB;AACrE,oBAAI,UAAW,EAACF,MAAA,OAAe,oBAAf,gBAAAA,IAAA,aAAiC;AAAA,oBAC5C,EAACC,MAAA,OAAe,oBAAf,gBAAAA,IAAA;AAAA,cACV,CAAC;AAAA,YACL;AACA,kBAAM,iBAAiB,MAAM,QAAQ,IAAI;AACzC,kBAAM,cAAc,MAAM,QAAQ,IAAI;AACtC,oBAAQ,iBAAiB,aAAa,gBAAgB;AACtD,oBAAQ,iBAAiB,WAAW,cAAc;AAClD,mBAAO,iBAAiB,aAAa,gBAAgB;AACrD,mBAAO,iBAAiB,WAAW,cAAc;AACjD,mBAAO,iBAAiB,QAAQ,WAAW;AAC3C,cAAE,eAAe;AAAA,UACrB,CAAC;AAAA,QACL;AAAA,QAEA,gBAAgB;AACZ,cAAK,KAAK,MAAM,QAAgB,aAAa,OAAQ;AACrD,gBAAM,SAAS,KAAK,YAAY,KAAK;AACrC,cAAI,CAAC,OAAQ;AACb,gBAAM,kBAAkB,OAAO,iBAAiB,UAAU;AAC1D,0BAAgB,QAAQ,YAAU,OAAO,OAAO,CAAC;AACjD,gBAAM,mBAAmB,OAAO,iBAAiB,MAAM,EAAE;AACzD,cAAI,CAAC,oBAAoB,qBAAqB,SAAU,QAAO,MAAM,WAAW;AAEhF,gBAAM,sBAAsB,MAAM;AAC9B,kBAAM,WAAW,OAAO,iBAAiB,MAAM;AAC/C,kBAAM,OAAO,OAAO,sBAAsB;AAC1C,gBAAI,SAAS,aAAa,YAAY,SAAS,aAAa,YAAY;AACpE,qBAAO,MAAM,WAAW;AACxB,qBAAO,MAAM,OAAO,KAAK,OAAO;AAChC,qBAAO,MAAM,MAAM,KAAK,MAAM;AAAA,YAClC,OAAO;AACH,kBAAI,CAAC,OAAO,MAAM,KAAM,QAAO,MAAM,OAAO,KAAK,OAAO;AACxD,kBAAI,CAAC,OAAO,MAAM,IAAK,QAAO,MAAM,MAAM,KAAK,MAAM;AAAA,YACzD;AAAA,UACJ;AAEA,gBAAM,eAAe,CAAC,WAAgB;AAClC,kBAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,oBAAQ,UAAU,IAAI,WAAW,WAAW,OAAO,IAAI,EAAE;AACzD,mBAAO,OAAO,QAAQ,OAAO;AAAA,cACzB,UAAU;AAAA,cACV,QAAQ;AAAA,cACR,iBAAiB;AAAA,cACjB,eAAe;AAAA,cACf,aAAa;AAAA,cACb,QAAQ,OAAO;AAAA,cACf,GAAI,OAAO,SAAS,CAAC;AAAA,YACzB,CAAC;AACD,mBAAO,YAAY,OAAO;AAC1B,kBAAM,cAAc,CAAC,UAAsB;AACvC,oBAAM,eAAe;AACrB,oBAAM,gBAAgB;AACtB,mBAAK,QAAQ;AACb,kCAAoB;AACpB,oBAAM,SAAS,MAAM;AACrB,oBAAM,SAAS,MAAM;AACrB,oBAAM,OAAO,OAAO,sBAAsB;AAC1C,oBAAM,WAAW,OAAO,iBAAiB,MAAM;AAC/C,oBAAM,WAAW,WAAW,SAAS,QAAe,KAAK;AACzD,oBAAM,YAAY,WAAW,SAAS,SAAgB,KAAK;AAC3D,kBAAI,YAAY,WAAW,SAAS,IAAW;AAC/C,kBAAI,WAAW,WAAW,SAAS,GAAU;AAC7C,kBAAI,CAAC,OAAO,SAAS,SAAS,EAAG,aAAY,KAAK;AAClD,kBAAI,CAAC,OAAO,SAAS,QAAQ,EAAG,YAAW,KAAK;AAChD,oBAAM,aAAa,KAAK;AACxB,oBAAM,cAAc,KAAK;AACzB,oBAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,qBAAO,OAAO,QAAQ,OAAO;AAAA,gBACzB,UAAU;AAAA,gBACV,KAAK;AAAA,gBACL,MAAM;AAAA,gBACN,OAAO;AAAA,gBACP,QAAQ;AAAA,gBACR,QAAQ;AAAA,gBACR,QAAQ,OAAO;AAAA,gBACf,iBAAiB;AAAA,gBACjB,aAAa;AAAA,cACjB,CAAC;AACD,uBAAS,KAAK,YAAY,OAAO;AACjC,kBAAI,WAAW;AACf,oBAAM,YAAY,CAAC,SAAiB,YAAoB;AACpD,oBAAI,CAAC,SAAU;AACf,uBAAO,sBAAsB,MAAM;AAvevD;AAwewB,wBAAM,KAAK,UAAU;AACrB,wBAAM,KAAK,UAAU;AACrB,sBAAI,WAAW;AACf,sBAAI,YAAY;AAChB,sBAAI,UAAU;AACd,sBAAI,SAAS;AACb,sBAAI,OAAO,WAAW,SAAS,GAAG,EAAG,YAAW,aAAa;AAC7D,sBAAI,OAAO,WAAW,SAAS,GAAG,EAAG,aAAY,cAAc;AAC/D,sBAAI,OAAO,WAAW,SAAS,GAAG,GAAG;AACjC,+BAAW,aAAa;AACxB,8BAAU,YAAY;AAAA,kBAC1B;AACA,sBAAI,OAAO,WAAW,SAAS,GAAG,GAAG;AACjC,gCAAY,cAAc;AAC1B,6BAAS,WAAW;AAAA,kBACxB;AACA,sBAAI,WAAW,UAAU;AACrB,0BAAM,UAAU,WAAW;AAC3B,wBAAI,OAAO,WAAW,SAAS,GAAG,EAAG,YAAW;AAChD,+BAAW;AAAA,kBACf;AACA,sBAAI,YAAY,WAAW;AACvB,0BAAM,UAAU,YAAY;AAC5B,wBAAI,OAAO,WAAW,SAAS,GAAG,EAAG,WAAU;AAC/C,gCAAY;AAAA,kBAChB;AACA,wBAAM,WAAU,YAAe,qBAAf,oCAAuC;AACvD,sBAAI,OAAO,WAAW,SAAS,GAAG,KAAK,SAAS,QAAQ;AACpD,0BAAM,YAAY,SAAS;AAC3B,6BAAS;AACT,gCAAY,KAAK,IAAI,WAAW,YAAY,SAAS;AAAA,kBACzD;AACA,sBAAI,OAAO,WAAW,SAAS,GAAG,KAAK,OAAO,WAAW,SAAS,GAAG;AACjE,2BAAO,MAAM,QAAQ,KAAK,IAAI,UAAU,QAAQ,IAAI;AACxD,sBAAI,OAAO,WAAW,SAAS,GAAG,KAAK,OAAO,WAAW,SAAS,GAAG;AACjE,2BAAO,MAAM,SAAS,KAAK,IAAI,WAAW,SAAS,IAAI;AAC3D,sBAAI,OAAO,WAAW,SAAS,GAAG,EAAG,QAAO,MAAM,OAAO,UAAU;AACnE,sBAAI,OAAO,WAAW,SAAS,GAAG,EAAG,QAAO,MAAM,MAAM,SAAS;AAAA,gBACrE,CAAC;AAAA,cACL;AACA,oBAAM,aAAa,MAAM;AAhhBzC;AAihBoB,oBAAI,CAAC,SAAU;AACf,2BAAW;AACX,wBAAQ,OAAO;AACf,wBAAQ,oBAAoB,aAAa,gBAAgB;AACzD,wBAAQ,oBAAoB,WAAW,cAAc;AACrD,uBAAO,oBAAoB,aAAa,eAAe;AACvD,uBAAO,oBAAoB,WAAW,aAAa;AACnD,uBAAO,oBAAoB,QAAQ,MAAM;AACzC,iBAAC,YAAe,yBAAf,gCAAsC;AACvC,iBAAC,YAAe,wBAAf;AAAA,cACL;AACA,oBAAM,mBAAmB,CAAC,cACtB,UAAU,UAAU,SAAS,UAAU,OAAO;AAClD,oBAAM,kBAAkB,CAAC,cACrB,UAAU,UAAU,SAAS,UAAU,OAAO;AAClD,oBAAM,iBAAiB,MAAM,WAAW;AACxC,oBAAM,gBAAgB,MAAM,WAAW;AACvC,oBAAM,SAAS,MAAM,WAAW;AAChC,sBAAQ,iBAAiB,aAAa,gBAAgB;AACtD,sBAAQ,iBAAiB,WAAW,cAAc;AAClD,qBAAO,iBAAiB,aAAa,eAAe;AACpD,qBAAO,iBAAiB,WAAW,aAAa;AAChD,qBAAO,iBAAiB,QAAQ,MAAM;AAAA,YAC1C;AACA,oBAAQ,iBAAiB,aAAa,WAAW;AAAA,UACrD;AAEA,iBAAO,MAAM,WAAW;AACxB,gBAAM,UAAU;AAAA,YACZ;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,GAAG;AAAA,cAChB,OAAO,EAAE,KAAK,QAAQ,MAAM,QAAQ,OAAO,QAAQ,QAAQ,MAAM;AAAA,YACrE;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,GAAG;AAAA,cAChB,OAAO,EAAE,QAAQ,QAAQ,MAAM,QAAQ,OAAO,QAAQ,QAAQ,MAAM;AAAA,YACxE;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,GAAG;AAAA,cAChB,OAAO,EAAE,MAAM,QAAQ,KAAK,QAAQ,QAAQ,QAAQ,OAAO,MAAM;AAAA,YACrE;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,GAAG;AAAA,cAChB,OAAO,EAAE,OAAO,QAAQ,KAAK,QAAQ,QAAQ,QAAQ,OAAO,MAAM;AAAA,YACtE;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,KAAK,GAAG;AAAA,cACrB,OAAO,EAAE,KAAK,QAAQ,MAAM,QAAQ,OAAO,QAAQ,QAAQ,OAAO;AAAA,YACtE;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,KAAK,GAAG;AAAA,cACrB,OAAO,EAAE,KAAK,QAAQ,OAAO,QAAQ,OAAO,QAAQ,QAAQ,OAAO;AAAA,YACvE;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,KAAK,GAAG;AAAA,cACrB,OAAO,EAAE,QAAQ,QAAQ,MAAM,QAAQ,OAAO,QAAQ,QAAQ,OAAO;AAAA,YACzE;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,KAAK,GAAG;AAAA,cACrB,OAAO,EAAE,QAAQ,QAAQ,OAAO,QAAQ,OAAO,QAAQ,QAAQ,OAAO;AAAA,YAC1E;AAAA,UACJ;AACA,kBAAQ,QAAQ,YAAY;AAAA,QAChC;AAAA,QAEA,yBAAyB;AAlmB7B;AAmmBQ,WAAC,YAAe,yBAAf,gCAAsC,KAAK,YAAY,KAAK;AAAA,QACjE;AAAA,QAEA,WAAW,KAAa;AACpB,cAAI,cAAc,KAAK,MAAM,cAAc,iBAAiB;AAC5D,cAAI,CAAC,aAAa;AACd,0BAAc,SAAS,cAAc,KAAK;AAC1C,wBAAY,UAAU,IAAI,gBAAgB;AAC1C,wBAAY,MAAM,QAAQ;AAC1B,wBAAY,MAAM,SAAS;AAC3B,iBAAK,MAAM,YAAY,WAAW;AAAA,UACtC;AACA,sBAAY,YAAY;AACxB,gBAAM,SAAS,SAAS,cAAc,QAAQ;AAC9C,iBAAO,MAAM;AACb,iBAAO,MAAM,QAAQ;AACrB,iBAAO,MAAM,SAAS;AACtB,iBAAO,MAAM,SAAS;AACtB,iBAAO,aAAa,SAAS,YAAY;AACzC,sBAAY,YAAY,MAAM;AAC9B,iBAAO,iBAAiB,QAAQ,MAAM;AAClC,gBAAI;AACA,oBAAM,KAAM,OAAe;AAC3B,kBAAI,MAAO,GAAW,UAAU;AAC5B,sBAAM,UAAU,MACZ,sBAAsB,MAAM;AACxB,uBAAK,QAAQ;AAAA,gBACjB,CAAC;AACL,iBAAC,aAAa,SAAS,YAAY,EAAE,QAAQ,SAAO;AAChD,kBAAC,GAAW,SAAS,iBAAiB,KAAK,OAAO;AAAA,gBACtD,CAAC;AAAA,cACL,WAAW,IAAI;AACX,iBAAC,aAAa,SAAS,YAAY,EAAE,QAAQ,SAAO;AAChD,kBAAC,GAAW;AAAA,oBAAiB;AAAA,oBAAK,MAC9B,sBAAsB,MAAM;AACxB,2BAAK,QAAQ;AAAA,oBACjB,CAAC;AAAA,kBACL;AAAA,gBACJ,CAAC;AAAA,cACL;AAAA,YACJ,SAAS,KAAK;AACV,sBAAQ,MAAM,+CAA+C,GAAG;AAAA,YACpE;AAAA,UACJ,CAAC;AAAA,QACL;AAAA,QAEA,YAAY;AACR,iBAAO;AAAA,YACH,MAAM,KAAK,MAAM,MAAM;AAAA,YACvB,KAAK,KAAK,MAAM,MAAM;AAAA,YACtB,OAAO,KAAK,MAAM,MAAM;AAAA,YACxB,QAAQ,KAAK,MAAM,MAAM;AAAA,YACzB,QAAQ,KAAK,MAAM,MAAM;AAAA,UAC7B;AAAA,QACJ;AAAA,QAEA,aAAa,OAAY;AACrB,cAAI,CAAC,MAAO;AACZ,cAAI,MAAM,KAAM,MAAK,MAAM,MAAM,OAAO,MAAM;AAC9C,cAAI,MAAM,IAAK,MAAK,MAAM,MAAM,MAAM,MAAM;AAC5C,cAAI,MAAM,MAAO,MAAK,MAAM,MAAM,QAAQ,MAAM;AAChD,cAAI,MAAM,OAAQ,MAAK,MAAM,MAAM,SAAS,MAAM;AAClD,cAAI,MAAM,OAAQ,MAAK,MAAM,MAAM,SAAS,MAAM;AAAA,QACtD;AAAA,MACJ;AAEA,MAAC,OAAe,SAAS;AAAA;AAAA;;;ACrqBzB;AAAA;AAAA;AAAA,OAAC,WAAY;AACT;AAKA,YACK,OAAwD,uBACxD,OAAsD,mBACzD;AACE;AAAA,QACJ;AAEA,iBAAS,oBAA0B;AAC/B,gBAAM,WAAY,OAAe;AAEjC,mBAAS,iBAAiB,gBAAgB,EAAE,QAAQ,cAAY;AAC5D,gBAAI,CAAC,SAAS,UAAU,SAAS,QAAQ,GAAG;AACxC,kBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,yBAAS,KAAK,QAAQ;AAAA,cAC1B,OAAO;AACH,yBAAS,UAAU,IAAI,QAAQ;AAAA,cACnC;AAAA,YACJ;AAAA,UACJ,CAAC;AACD,mBAAS,iBAAiB,sCAAsC,EAAE,QAAQ,YAAU;AAChF,YAAC,OAAuB,aAAa,iBAAiB,OAAO;AAAA,UACjE,CAAC;AACD,mBAAS,iBAAiB,4BAA4B,EAAE,QAAQ,YAAU;AACtE,YAAC,OAAuB,aAAa,iBAAiB,OAAO;AAAA,UACjE,CAAC;AAAA,QACL;AAEA,iBAAS,oBAA6B;AAClC,iBAAO,QAAQ,SAAS,cAAc,6BAA6B,CAAC;AAAA,QACxE;AAEA,iBAAS,mBAAmB,SAAsB,UAA0B,CAAC,GAAS;AAClF,cAAI,CAAC,QAAS;AACd,gBAAM,SAAS,QAAQ,aAAa,eAAe;AACnD,cAAI,CAAC,OAAQ;AAEb,gBAAM,YAAY,QAAQ,QAAQ,SAAS;AAC3C,cAAI,OAAO,SAAS,eAAe,MAAM;AACzC,cAAI,CAAC,KAAM;AAEX,gBAAM,UAAU,CAAC,KAAK,UAAU,SAAS,QAAQ;AACjD,gBAAM,aAAa,aAAa,CAAC;AACjC,4BAAkB;AAElB,cAAI,YAAY;AAGZ,gBAAI,CAAC,SAAS;AACV,oBAAM,aACF,OAGF;AACF,kBAAI,cAAc,OAAO,WAAW,0BAA0B,YAAY;AAEtE,sBAAM,WAAW,MAAM;AAAA,kBACnB,SAAS,iBAAiB,qBAAqB;AAAA,gBACnD,EAAE,KAAK,CAAC,GAAG,MAAM;AACb,wBAAM,KAAK,SAAS,iBAAiB,CAAC,EAAE,QAAQ,EAAE,KAAK;AACvD,wBAAM,KAAK,SAAS,iBAAiB,CAAC,EAAE,QAAQ,EAAE,KAAK;AACvD,yBAAO,KAAK;AAAA,gBAChB,CAAC,EAAE,CAAC;AACJ,sBAAM,iBAAgB,qCAAU,OAAM;AACtC,2BAAW,sBAAsB,aAAa;AAAA,cAClD;AAGA,qBAAO,SAAS,eAAe,MAAM;AACrC,kBAAI,CAAC,KAAM;AAAA,YACf;AAEA,kBAAM,WAAY,OAAe;AACjC,gBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,uBAAS,KAAK,IAAI;AAAA,YACtB,OAAO;AACH,mBAAK,UAAU,OAAO,QAAQ;AAAA,YAClC;AAEA,oBAAQ,aAAa,iBAAiB,MAAM;AAAA,UAChD;AAAA,QACJ;AAEA,iBAAS,oBAAoB,IAAwB,UAA0B,CAAC,GAAS;AACrF,cAAI,CAAC,GAAI;AACT,gBAAM,wBACF,QAAQ,sBAAsB,SAAY,QAAQ,oBAAoB;AAC1E,cAAI,oBAAoB;AAExB,aAAG,iBAAiB,SAAS,WAAS;AAClC,kBAAM,gBAAgB;AACtB,gCAAoB;AACpB,kBAAM,MAAM,KAAK,IAAI;AACrB,YAAC,OAA2D,0BACxD;AACJ,kBAAM,SAAS,GAAG,aAAa,eAAe;AAC9C,kBAAM,OAAO,SAAS,SAAS,eAAe,MAAM,IAAI;AACxD,kBAAM,SAAS,OAAO,CAAC,KAAK,UAAU,SAAS,QAAQ,IAAI;AAC3D,kBAAM,aACF,OACE,OAAqD,qBAAqB;AAChF,gBAAI,UAAU,aAAa,KAAK;AAC5B,gCAAkB;AAClB,iBAAG,aAAa,iBAAiB,OAAO;AAAA,YAC5C,OAAO;AACH,iCAAmB,IAAI,EAAE,WAAW,KAAK,CAAC;AAAA,YAC9C;AACA,uBAAW,MAAM;AACb,kCAAoB;AAAA,YACxB,GAAG,GAAG;AAAA,UACV,CAAC;AAED,aAAG,iBAAiB,cAAc,MAAM;AACpC,gBAAI,kBAAmB;AACvB,YAAC,OAA2D,0BACxD,KAAK,IAAI;AACb,gBAAI,yBAAyB,CAAC,kBAAkB,EAAG;AACnD,+BAAmB,IAAI,EAAE,WAAW,KAAK,CAAC;AAAA,UAC9C,CAAC;AAED,aAAG,iBAAiB,SAAS,MAAM;AAC/B,kBAAM,MAAM,KAAK,IAAI;AACrB,YAAC,OAA2D,0BACxD;AACJ,YAAC,OAAqD,oBAAoB;AAC1E,+BAAmB,IAAI,EAAE,WAAW,KAAK,CAAC;AAAA,UAC9C,CAAC;AAAA,QACL;AAEA,iBAAS,gCAAgC,OAAoB;AACzD,gBAAM,OAAQ,OACT;AACL,cAAI,QAAQ,KAAK,IAAI,IAAI,OAAO,KAAK;AACjC;AAAA,UACJ;AACA,gBAAM,SAAS,MAAM,kBAAkB,UAAW,MAAM,SAAqB;AAC7E,cAAI,CAAC,OAAQ;AACb,cAAI,OAAO,QAAQ,kBAAkB,KAAK,OAAO,QAAQ,gBAAgB,EAAG;AAC5E,4BAAkB;AAAA,QACtB;AAEA,iBAAS,oBAAoB;AACzB,cAAK,OAAmD,eAAgB;AACxE,UAAC,OAAmD,iBAAiB;AAErE,gBAAM,mBAAmB,SAAS,eAAe,oBAAoB;AACrE,gBAAM,eAAe,SAAS,eAAe,eAAe;AAC5D,8BAAoB,kBAAkB,EAAE,mBAAmB,KAAK,CAAC;AACjE,8BAAoB,cAAc,EAAE,mBAAmB,KAAK,CAAC;AAG7D,mBAAS,iBAAiB,SAAS,WAAS;AACxC,kBAAM,aACF,OAGF;AACF,gBAAI,cAAc,OAAO,WAAW,+BAA+B,YAAY;AAC3E,yBAAW,2BAA2B,KAAK;AAAA,YAC/C;AAAA,UACJ,CAAC;AAED,mBAAS,iBAAiB,SAAS,+BAA+B;AAClE,mBAAS,iBAAiB,eAAe,iCAAiC;AAAA,YACtE,SAAS;AAAA,UACb,CAAC;AACD,mBAAS,iBAAiB,WAAW,WAAS;AAC1C,gBAAK,MAAwB,QAAQ,SAAU,mBAAkB;AAAA,UACrE,CAAC;AAAA,QACL;AAGA,QACI,OAIF,oBAAoB;AACtB,QAAC,OAA0E,sBACvE;AAGJ,YAAI,SAAS,eAAe,WAAW;AACnC,mBAAS,iBAAiB,oBAAoB,mBAAmB,EAAE,MAAM,KAAK,CAAC;AAAA,QACnF,OAAO;AACH,4BAAkB;AAAA,QACtB;AAAA,MACJ,GAAG;AAAA;AAAA;;;AChMH,MAOM,UA8BOE,YA8BAC,iBAkBAC,wBAmSAC,YAIAC,aA6CAC,gBAUAC,kBAUAC,iBAyBAC,kBAiBAC,gBAqDAC;AA5hBb;AAAA;AAAA;AAOA,MAAM,WAAW;AACjB,UAAK,OAAe,QAAQ,GAAG;AAAA,MAE/B,OAAO;AA2BH,YAAS,YAAT,SAAmB,IAAY;AAC3B,gBAAM,KAAK,SAAS,eAAe,EAAE;AACrC,cAAI,CAAC,GAAI;AACT,cAAI,CAAE,OAAe,QAAS,CAAC,OAAe,UAAU,CAAC;AACzD,cAAI,CAAE,OAAe,QAAQ,EAAE,KAAK,OAAQ,OAAe,WAAW,YAAY;AAC9E,gBAAI;AACA,cAAC,OAAe,QAAQ,EAAE,IAAI,IAAK,OAAe,OAAO,EAAE;AAAA,YAC/D,QAAQ;AAAA,YAER;AAAA,UACJ;AACA,gBAAM,MAAO,OAAe,QAAQ,EAAE;AACtC,cAAI,OAAO,OAAO,IAAI,SAAS,YAAY;AACvC,gBAAI,KAAK;AAAA,UACb,OAAO;AACH,kBAAM,WAAY,OAAe;AACjC,gBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,uBAAS,KAAK,EAAE;AAAA,YACpB,OAAO;AACH,iBAAG,UAAU,OAAO,QAAQ;AAAA,YAChC;AACA,gBAAI,OAAQ,OAAe,uBAAuB,YAAY;AAC1D,cAAC,OAAe,mBAAmB,EAAE;AAAA,YACzC;AAAA,UACJ;AACA,cAAI,OAAQ,OAAe,iCAAiC,YAAY;AACpE,YAAC,OAAe,6BAA6B;AAAA,UACjD;AAAA,QACJ,GAES,iBAAT,WAA0B;AACtB,cACK,OAAe,YAChB,OAAQ,OAAe,SAAS,uBAAuB,YACzD;AACE,YAAC,OAAe,SAAS,mBAAmB,WAAW;AAAA,UAC3D,OAAO;AACH,kBAAM,OAAO,CAAC,SAAS,gBAAgB,UAAU,SAAS,MAAM;AAChE,qBAAS,gBAAgB,UAAU,OAAO,QAAQ,IAAI;AACtD,gBACK,OAAe,eAChB,OAAQ,OAAe,YAAY,uBAAuB,YAC5D;AACE,cAAC,OAAe,YAAY,mBAAmB,OAAO,SAAS,OAAO;AAAA,YAC1E;AAAA,UACJ;AAAA,QACJ,GAES,wBAAT,SAA+B,QAAwB;AACnD,gBAAM,QAAoB,CAAC;AAC3B,gBAAM,YAAY,CAAC,EACf,UACC,OAAmB,WACnB,OAAmB,QAAQ,UAAU;AAE1C,gBAAM,aAAa,CAAC,EAChB,UACC,OAAmB,WACnB,OAAmB,QAAQ,kBAAkB;AAElD,gBAAM,eAAe,CAAC,EAClB,UACC,OAAmB,WACnB,OAAmB,QAAQ,cAAc;AAE9C,gBAAM,gBAAgB,CAAC,EACnB,UACC,OAAmB,WACnB,OAAmB,QAAQ,+BAA+B;AAG/D,cAAI,YAAY;AACZ,kBAAM,WAAY,OAAmB,QAAQ,kBAAkB;AAC/D,kBAAM,QAAQ,YAAY,SAAS,aAAa,gBAAgB;AAChE,gBAAI,OAAO;AACP,oBAAM,KAAK;AAAA,gBACP,IAAI;AAAA,gBACJ,OAAO,KAAK,UAAU,cAAc,KAAK;AAAA,gBACzC,QAAQ,MAAM,UAAU,KAAK;AAAA,cACjC,CAAC;AACD,oBAAM,KAAK,EAAE,MAAM,YAAY,CAAC;AAAA,YACpC;AAAA,UACJ;AAEA,cAAI,gBAAgB,OAAQ,OAAe,wBAAwB,YAAY;AAC3E,kBAAM,KAAM,OAAe,oBAAoB;AAC/C,gBAAI,MAAM,GAAG,UAAU;AACnB,oBAAM,KAAK;AAAA,gBACP,IAAI;AAAA,gBACJ,OACI,KAAK,UAAU,yBAAyB,KACxC,KAAK,UAAU,sBAAsB,KACrC;AAAA,gBACJ,QAAQ,MAAM;AACV,sBAAI,OAAQ,OAAe,4BAA4B;AACnD,oBAAC,OAAe,wBAAwB;AAAA,gBAChD;AAAA,cACJ,CAAC;AACD,oBAAM,KAAK;AAAA,gBACP,IAAI;AAAA,gBACJ,OACI,KAAK,UAAU,oBAAoB,KACnC,KAAK,UAAU,sBAAsB,KACrC;AAAA,gBACJ,QAAQ,MAAM;AACV,sBAAI,OAAQ,OAAe,wBAAwB;AAC/C,oBAAC,OAAe,oBAAoB;AAAA,gBAC5C;AAAA,cACJ,CAAC;AACD,oBAAM,KAAK,EAAE,MAAM,YAAY,CAAC;AAAA,YACpC;AAAA,UACJ;AAEA,cAAI,eAAe;AACf,kBAAM,aACF,UACC,OAAmB,WACnB,OAAmB,QAAQ,sCAAsC;AACtE,gBAAI,YAAY;AACZ,oBAAM,WAAY,WAAuB,aAAa,gBAAgB;AACtE,oBAAM,WAAY,WAAuB,aAAa,gBAAgB;AACtE,kBAAI,YAAY,UAAU;AACtB,sBAAM,KAAK;AAAA,kBACP,IAAI;AAAA,kBACJ,OAAO,KAAK,UAAU,yBAAyB,KAAK;AAAA,kBACpD,QAAQ,MAAM;AACV,wBACK,OAAe,gBAChB,OAAQ,OAAe,aAAa,aAAa;AAEjD,sBAAC,OAAe,aAAa,SAAS,UAAU,QAAQ;AAAA,kBAChE;AAAA,gBACJ,CAAC;AAGD,sBAAM,UAAU,mCAAmC,KAAK,QAAQ;AAChE,oBAAI,WAAW,aAAa,QAAQ;AAChC,wBAAM,KAAK;AAAA,oBACP,IAAI;AAAA,oBACJ,OACI,KAAK,UAAU,gCAAgC,KAC/C;AAAA,oBACJ,QAAQ,MAAM;AAEV,4BAAM,KAAM,OAAe;AAC3B,0BAAI,MAAM,OAAO,GAAG,YAAY,YAAY;AACxC,2BAAG,QAAQ,mBAAmB,EAAE,SAAS,CAAC;AAAA,sBAC9C;AAAA,oBACJ;AAAA,kBACJ,CAAC;AAAA,gBACL;AAEA,sBAAM,KAAK,EAAE,MAAM,YAAY,CAAC;AAChC,sBAAM,KAAK;AAAA,kBACP,IAAI;AAAA,kBACJ,OAAO,KAAK,UAAU,wBAAwB,KAAK;AAAA,kBACnD,QAAQ,MAAM;AACV,4BAAQ,IAAI,iBAAiB,UAAU,QAAQ;AAAA,kBACnD;AAAA,gBACJ,CAAC;AACD,uBAAO;AAAA,cACX;AAAA,YACJ;AAEA,kBAAM,KAAK;AAAA,cACP,IAAI;AAAA,cACJ,OAAO,KAAK,UAAU,wBAAwB,KAAK;AAAA,cACnD,QAAQ,MAAM;AACV,oBACK,OAAe,gBAChB,OAAQ,OAAe,aAAa,eAAe,YACrD;AACE,wBAAM,QAAS,OAAe,aAAa,SAAS;AACpD,sBAAI,OAAO;AACP,oBAAC,OAAe,aAAa;AAAA,sBACzB,MAAM;AAAA,sBACN,MAAM;AAAA,oBACV;AAAA,kBACJ;AAAA,gBACJ;AAAA,cACJ;AAAA,YACJ,CAAC;AACD,kBAAM,KAAK,EAAE,MAAM,YAAY,CAAC;AAEhC,kBAAM,kBACD,OAAe,gBAAiB,OAAe,aAAa,WACtD,OAAe,aAAa,SAAS,EAAE,WACxC;AACV,gBAAI,oBAAoB,QAAQ;AAC5B,oBAAM,KAAK;AAAA,gBACP,IAAI;AAAA,gBACJ,OAAO,KAAK,UAAU,yBAAyB,KAAK;AAAA,gBACpD,QAAQ,MAAM;AACV,sBACK,OAAe,gBAChB,OAAQ,OAAe,aAAa,gBAAgB;AAEpD,oBAAC,OAAe,aAAa,YAAY,MAAM;AAAA,gBACvD;AAAA,cACJ,CAAC;AAAA,YACL;AACA,gBAAI,oBAAoB,QAAQ;AAC5B,oBAAM,KAAK;AAAA,gBACP,IAAI;AAAA,gBACJ,OAAO,KAAK,UAAU,yBAAyB,KAAK;AAAA,gBACpD,QAAQ,MAAM;AACV,sBACK,OAAe,gBAChB,OAAQ,OAAe,aAAa,gBAAgB;AAEpD,oBAAC,OAAe,aAAa,YAAY,MAAM;AAAA,gBACvD;AAAA,cACJ,CAAC;AAAA,YACL;AACA,kBAAM,KAAK,EAAE,MAAM,YAAY,CAAC;AAEhC,kBAAM,KAAK;AAAA,cACP,IAAI;AAAA,cACJ,OAAO,KAAK,UAAU,2BAA2B,KAAK;AAAA,cACtD,QAAQ,MAAM;AACV,oBACK,OAAe,gBAChB,OAAQ,OAAe,aAAa,cAAc;AAElD,kBAAC,OAAe,aAAa,UAAU,MAAM;AAAA,cACrD;AAAA,YACJ,CAAC;AACD,kBAAM,KAAK;AAAA,cACP,IAAI;AAAA,cACJ,OAAO,KAAK,UAAU,2BAA2B,KAAK;AAAA,cACtD,QAAQ,MAAM;AACV,oBACK,OAAe,gBAChB,OAAQ,OAAe,aAAa,cAAc;AAElD,kBAAC,OAAe,aAAa,UAAU,MAAM;AAAA,cACrD;AAAA,YACJ,CAAC;AACD,kBAAM,KAAK;AAAA,cACP,IAAI;AAAA,cACJ,OAAO,KAAK,UAAU,2BAA2B,KAAK;AAAA,cACtD,QAAQ,MAAM;AACV,oBACK,OAAe,gBAChB,OAAQ,OAAe,aAAa,cAAc;AAElD,kBAAC,OAAe,aAAa,UAAU,MAAM;AAAA,cACrD;AAAA,YACJ,CAAC;AAED,mBAAO;AAAA,UACX;AAEA,cAAI,WAAW;AACX,kBAAM,KAAK;AAAA,cACP,IAAI;AAAA,cACJ,OAAO,KAAK,UAAU,oBAAoB,KAAK;AAAA,cAC/C,QAAQ,MAAM;AAtS9B;AAuSoB,sBAAM,IAAI;AACV,wBAAE,iBAAF,mBAAgB;AAAA,cACpB;AAAA,YACJ,CAAC;AACD,kBAAM,KAAK;AAAA,cACP,IAAI;AAAA,cACJ,OAAO,KAAK,UAAU,wBAAwB,KAAK;AAAA,cACnD,QAAQ,MAAM,UAAU,YAAY;AAAA,YACxC,CAAC;AACD,kBAAM,KAAK;AAAA,cACP,IAAI;AAAA,cACJ,OAAO,KAAK,UAAU,sBAAsB,KAAK;AAAA,cACjD,QAAQ,MAAM,UAAU,gBAAgB;AAAA,YAC5C,CAAC;AACD,kBAAM,KAAK,EAAE,MAAM,YAAY,CAAC;AAChC,kBAAM,KAAK;AAAA,cACP,IAAI;AAAA,cACJ,OAAO,KAAK,UAAU,wBAAwB,KAAK;AAAA,cACnD,QAAQ;AAAA,YACZ,CAAC;AACD,kBAAM,KAAK;AAAA,cACP,IAAI;AAAA,cACJ,OAAO,KAAK,UAAU,sBAAsB,KAAK;AAAA,cACjD,QAAQ,MAAM,UAAU,gBAAgB;AAAA,YAC5C,CAAC;AACD,kBAAM,KAAK,EAAE,MAAM,YAAY,CAAC;AAChC,kBAAM,KAAK;AAAA,cACP,IAAI;AAAA,cACJ,OAAO,KAAK,UAAU,eAAe,KAAK;AAAA,cAC1C,QAAQ,MAAM,UAAU,aAAa;AAAA,YACzC,CAAC;AACD,mBAAO;AAAA,UACX;AAEA,gBAAM,KAAK;AAAA,YACP,IAAI;AAAA,YACJ,OAAO,KAAK,UAAU,oBAAoB,KAAK;AAAA,YAC/C,QAAQ,MAAM;AA5U1B;AA6UgB,oBAAM,IAAI;AACV,sBAAE,iBAAF,mBAAgB;AAAA,YACpB;AAAA,UACJ,CAAC;AACD,gBAAM,KAAK;AAAA,YACP,IAAI;AAAA,YACJ,OAAO,KAAK,UAAU,wBAAwB,KAAK;AAAA,YACnD,QAAQ,MAAM,UAAU,YAAY;AAAA,UACxC,CAAC;AACD,gBAAM,KAAK,EAAE,MAAM,YAAY,CAAC;AAChC,gBAAM,KAAK;AAAA,YACP,IAAI;AAAA,YACJ,OAAO,KAAK,UAAU,wBAAwB,KAAK;AAAA,YACnD,QAAQ;AAAA,UACZ,CAAC;AACD,gBAAM,KAAK;AAAA,YACP,IAAI;AAAA,YACJ,OAAO,KAAK,UAAU,sBAAsB,KAAK;AAAA,YACjD,QAAQ,MAAM,UAAU,gBAAgB;AAAA,UAC5C,CAAC;AACD,gBAAM,KAAK,EAAE,MAAM,YAAY,CAAC;AAChC,gBAAM,KAAK;AAAA,YACP,IAAI;AAAA,YACJ,OAAO,KAAK,UAAU,eAAe,KAAK;AAAA,YAC1C,QAAQ,MAAM,UAAU,aAAa;AAAA,UACzC,CAAC;AACD,iBAAO;AAAA,QACX,GAgBS,YAAT,WAAqB;AACjB,iBAAO,KAAK,WAAY,MAAK,YAAY,KAAK,UAAU;AAAA,QAC5D,GAES,aAAT,SAAoB,OAAmB;AACnC,oBAAU;AACV,gBAAM,WAAW,SAAS,uBAAuB;AACjD,cAAI,iBAAqC;AACzC,gBAAM,QAAQ,CAAC,IAAS,QAAgB;AACpC,gBAAI,GAAG,SAAS,aAAa;AACzB,oBAAM,MAAM,SAAS,cAAc,IAAI;AACvC,kBAAI,YAAY;AAChB,kBAAI,aAAa,QAAQ,WAAW;AACpC,uBAAS,YAAY,GAAG;AACxB;AAAA,YACJ;AACA,kBAAM,KAAK,SAAS,cAAc,IAAI;AACtC,kBAAM,MAAM,SAAS,cAAc,QAAQ;AAC3C,gBAAI,OAAO;AACX,gBAAI,YAAY;AAChB,gBAAI,aAAa,QAAQ,UAAU;AACnC,gBAAI,WAAW;AACf,gBAAI,QAAQ,SAAS,GAAG,MAAM,UAAU;AACxC,kBAAM,YAAY,SAAS,cAAc,MAAM;AAC/C,sBAAU,YAAY;AACtB,sBAAU,cAAc,GAAG,SAAS;AACpC,gBAAI,YAAY,SAAS;AACzB,gBAAI,iBAAiB,SAAS,QAAM;AAChC,iBAAG,gBAAgB;AACnB,8BAAgB;AAChB,kBAAI;AACA,oBAAI,GAAG,QAAQ;AACX,qBAAG,OAAO;AAAA,gBACd;AAAA,cACJ,SAAS,GAAG;AACR,wBAAQ,KAAK,yBAAyB,CAAC;AAAA,cAC3C;AAAA,YACJ,CAAC;AACD,eAAG,YAAY,GAAG;AAClB,qBAAS,YAAY,EAAE;AACvB,gBAAI,CAAC,eAAgB,kBAAiB;AAAA,UAC1C,CAAC;AACD,eAAK,YAAY,QAAQ;AACzB,cAAI;AACA,iBAAK,kBAAkB,IAAI;AAAA,UAC/B,QAAQ;AAAA,UAAC;AACT,iBAAO;AAAA,QACX,GAES,gBAAT,SAAuB,GAAW,GAAW;AACzC,gBAAM,OAAO,KAAK,sBAAsB;AACxC,gBAAM,KAAK,KAAK,IAAI,SAAS,gBAAgB,aAAa,OAAO,cAAc,CAAC;AAChF,gBAAM,KAAK,KAAK,IAAI,SAAS,gBAAgB,cAAc,OAAO,eAAe,CAAC;AAClF,gBAAM,SAAS;AACf,gBAAM,KAAK,KAAK,IAAI,KAAK,IAAI,QAAQ,CAAC,GAAG,KAAK,IAAI,QAAQ,KAAK,KAAK,QAAQ,MAAM,CAAC;AACnF,gBAAM,KAAK,KAAK,IAAI,KAAK,IAAI,QAAQ,CAAC,GAAG,KAAK,IAAI,QAAQ,KAAK,KAAK,SAAS,MAAM,CAAC;AACpF,iBAAO,EAAE,GAAG,IAAI,GAAG,GAAG;AAAA,QAC1B,GAES,kBAAT,SAAyB,IAAgB;AACrC,gBAAM,SAAS,GAAG,kBAAkB,UAAU,GAAG,SAAS;AAC1D,cAAI,CAAC,OAAQ;AACb,cAAI,OAAO,QAAQ,2CAA2C,EAAG;AACjE,aAAG,eAAe;AAClB,aAAG,gBAAgB;AACnB,2BAAiB;AACjB,yBAAe,GAAG,SAAS,GAAG,SAAS,MAAM;AAAA,QACjD,GAES,iBAAT,SAAwB,GAAW,GAAW,QAAwB;AAClE,gBAAM,QAAQ,sBAAsB,MAAM;AAC1C,gBAAM,iBAAiB,WAAW,KAAK;AACvC,cAAI,SAAS,QAAQ,KAAK,kBAAkB,SAAS,MAAM;AACvD,qBAAS,KAAK,YAAY,IAAI;AAAA,UAClC,WAAW,SAAS,QAAQ,SAAS,KAAK,qBAAqB,MAAM;AACjE,qBAAS,KAAK,YAAY,IAAI;AAAA,UAClC;AACA,gBAAM,WAAY,OAAe;AACjC,cAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,qBAAS,KAAK,IAAI;AAAA,UACtB,OAAO;AACH,iBAAK,UAAU,OAAO,QAAQ;AAAA,UAClC;AACA,eAAK,MAAM,OAAO,KAAK,IAAI,GAAG,CAAC,IAAI;AACnC,eAAK,MAAM,MAAM,KAAK,IAAI,GAAG,CAAC,IAAI;AAClC,gBAAM,UAAU,cAAc,GAAG,CAAC;AAClC,eAAK,MAAM,OAAO,QAAQ,IAAI;AAC9B,eAAK,MAAM,MAAM,QAAQ,IAAI;AAC7B,cAAI,yBAAyB,gBAAgB;AACzC,YAAC,eAA+B,MAAM;AAAA,UAC1C;AACA,wBAAc;AAAA,QAClB,GAES,kBAAT,WAA2B;AACvB,gBAAM,WAAY,OAAe;AACjC,cAAI,CAAC,KAAK,UAAU,SAAS,QAAQ,GAAG;AACpC,gBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,uBAAS,KAAK,IAAI;AAAA,YACtB,OAAO;AACH,mBAAK,UAAU,IAAI,QAAQ;AAAA,YAC/B;AAAA,UACJ;AACA,0BAAgB;AAAA,QACpB,GAOS,gBAAT,WAAyB;AACrB,0BAAgB;AAChB,uBAAa,CAAC,MAAa;AACvB,kBAAMC,KAAI,EAAE,kBAAkB,UAAU,EAAE,SAAS;AACnD,gBAAI,CAACA,IAAG;AACJ,8BAAgB;AAChB;AAAA,YACJ;AACA,gBAAIA,GAAE,QAAQ,eAAe,EAAG;AAChC,4BAAgB;AAAA,UACpB;AACA,wBAAc,MAAM,gBAAgB;AACpC,qBAAW,MAAM,gBAAgB;AACjC,sBAAY,CAAC,MAAqB;AApf1C;AAqfY,kBAAM,QAAQ,MAAM,KAAK,KAAK,iBAAiB,YAAY,CAAC;AAC5D,kBAAM,WAAW,MAAM,UAAU,QAAM,OAAO,SAAS,aAAa;AACpE,gBAAI,EAAE,QAAQ,UAAU;AACpB,gBAAE,eAAe;AACjB,8BAAgB;AAChB;AAAA,YACJ;AACA,gBAAI,CAAC,MAAM,OAAQ;AACnB,gBAAI,EAAE,QAAQ,aAAa;AACvB,gBAAE,eAAe;AACjB,oBAAM,OAAO,OAAO,KAAK,IAAI,GAAG,QAAQ,IAAI,KAAK,MAAM,MAAM;AAC7D,kBAAI,KAAM,MAAK,MAAM;AAAA,YACzB,WAAW,EAAE,QAAQ,WAAW;AAC5B,gBAAE,eAAe;AACjB,oBAAM,OAAO,OAAO,WAAW,IAAI,WAAW,MAAM,UAAU,CAAC;AAC/D,kBAAI,KAAM,MAAK,MAAM;AAAA,YACzB,WAAW,EAAE,QAAQ,QAAQ;AACzB,gBAAE,eAAe;AACjB,0BAAM,CAAC,MAAP,mBAAU;AAAA,YACd,WAAW,EAAE,QAAQ,OAAO;AACxB,gBAAE,eAAe;AACjB,0BAAM,MAAM,SAAS,CAAC,MAAtB,mBAAyB;AAAA,YAC7B,WAAW,EAAE,QAAQ,WAAW,EAAE,QAAQ,KAAK;AAC3C,kBACI,SAAS,iBACR,SAAS,cAA0B,UAAU,SAAS,WAAW,GACpE;AACE,kBAAE,eAAe;AACjB,gBAAC,SAAS,cAA8B,MAAM;AAAA,cAClD;AAAA,YACJ;AAAA,UACJ;AACA,mBAAS,iBAAiB,SAAS,YAA6B,EAAE,SAAS,KAAK,CAAC;AACjF,mBAAS,iBAAiB,eAAe,YAA6B,EAAE,SAAS,KAAK,CAAC;AACvF,mBAAS,iBAAiB,UAAU,aAA8B,EAAE,SAAS,KAAK,CAAC;AACnF,iBAAO,iBAAiB,UAAU,QAAyB;AAC3D,mBAAS,iBAAiB,WAAW,SAA0B;AAAA,QACnE,GAES,kBAAT,WAA2B;AACvB,cAAI;AACA,qBAAS,oBAAoB,SAAS,YAA6B,EAAE,SAAS,KAAK,CAAC;AACxF,cAAI;AACA,qBAAS,oBAAoB,eAAe,YAA6B;AAAA,cACrE,SAAS;AAAA,YACb,CAAC;AACL,cAAI;AACA,qBAAS,oBAAoB,UAAU,aAA8B,EAAE,SAAS,KAAK,CAAC;AAC1F,cAAI,SAAU,QAAO,oBAAoB,UAAU,QAAyB;AAC5E,cAAI,UAAW,UAAS,oBAAoB,WAAW,SAA0B;AACjF,uBAAa,cAAc,WAAW,YAAY;AAAA,QACtD;AAngBS,QAAAX,aAAA,WA8BAC,kBAAA,gBAkBAC,yBAAA,uBAmSAC,aAAA,WAIAC,cAAA,YA6CAC,iBAAA,eAUAC,mBAAA,iBAUAC,kBAAA,gBAyBAC,mBAAA,iBAiBAC,iBAAA,eAqDAC,mBAAA;AAjhBT,QAAC,OAAe,QAAQ,IAAI;AAE5B,cAAM,OACD,OAAe,WACf;AAAA,UACG,WAAW,CAAC,MAAc;AAAA,UAC1B,mBAAmB,CAAC,QAAkB;AAAA,UAAC;AAAA,QAC3C;AAEJ,cAAM,mBACF,OAAQ,OAAe,sBAAsB,aACtC,OAAe,oBAChB,MAAM;AACF,gBAAM,WAAY,OAAe;AACjC,mBAAS,iBAAiB,gBAAgB,EAAE,QAAQ,OAAK;AACrD,gBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,uBAAS,KAAK,CAAC;AAAA,YACnB,OAAO;AACH,gBAAE,UAAU,IAAI,QAAQ;AAAA,YAC5B;AAAA,UACJ,CAAC;AACD,mBACK,iBAAiB,wBAAwB,EACzC,QAAQ,OAAK,EAAE,aAAa,iBAAiB,OAAO,CAAC;AAAA,QAC9D;AAwUV,cAAM,OAAO,SAAS,cAAc,IAAI;AACxC,aAAK,KAAK;AACV,aAAK,YAAY;AACjB,aAAK,aAAa,QAAQ,MAAM;AAChC,aAAK,aAAa,cAAc,KAAK,UAAU,mBAAmB,KAAK,gBAAa;AAEpF,iBAAS,iBAAiB,oBAAoB,MAAM;AAChD,cAAI,CAAC,SAAS,KAAK,SAAS,IAAI,EAAG,UAAS,KAAK,YAAY,IAAI;AACjE,cAAI;AACA,iBAAK,kBAAkB,IAAI;AAAA,UAC/B,QAAQ;AAAA,UAAC;AAAA,QACb,CAAC;AA4GD,YAAI,aAA0C;AAC9C,YAAI,cAAmC;AACvC,YAAI,WAAgC;AACpC,YAAI,YAAiD;AAqErD,YAAI,wBAAwB;AAC5B,iBAAS,iBAAiB,WAAW,OAAK;AACtC,cAAI,EAAE,QAAQ,iBAAkB,EAAE,YAAY,EAAE,QAAQ,OAAQ;AAC5D,oCAAwB;AAAA,UAC5B;AAAA,QACJ,CAAC;AACD,iBAAS;AAAA,UACL;AAAA,UACA,MAAM;AACF,oCAAwB;AAAA,UAC5B;AAAA,UACA,EAAE,SAAS,KAAK;AAAA,QACpB;AAEA,iBAAS,iBAAiB,eAAe,eAAe;AAExD,YAAI,OAAQ,OAAe,wBAAwB,YAAY;AAC3D,mBAAS,iBAAiB,sCAAsC,EAAE,QAAQ,SAAO;AAC7E,gBAAI,iBAAiB,SAAS,MAAM,gBAAgB,CAAC;AAAA,UACzD,CAAC;AAAA,QACL;AAAA,MACJ;AAAA;AAAA;;;AC/jBA;AAAA;AAAA;AAKA;AAEA,OAAC,MAAM;AACH;AAEA,gBAAQ,IAAI,kCAA6B;AAUzC,cAAM,IAAI;AACV,cAAME,iBAAiB,EAAE,iBAA6C,CAAC;AAEvE,cAAM,mBAAoBA,eAAc,4BAAuC;AAC/E,cAAM,kBAAkB;AACxB,cAAM,sBAAsB;AAE5B,cAAMC,eAAc,MAAgB;AAChC,gBAAM,KAAM,EAAE,iBAAyD;AACvE,gBAAM,IAAI,MAAO,GAAG,WAAW;AAC/B,iBAAO,MAAM,QAAQ,CAAC,IAAK,IAAiB,CAAC;AAAA,QACjD;AACA,cAAM,uBAAuB,MAAmB;AAC5C,gBAAM,KAAM,EAAE,iBAAyD;AACvE,gBAAM,IAAI,MAAO,GAAG,qBAAqB;AACzC,iBAAO,aAAa,MAAO,IAAoB,oBAAI,IAAY;AAAA,QACnE;AAIA,iBAAS,kBAA+B;AACpC,cAAI;AACA,kBAAM,SAAS,QAAwC,kBAAkB,IAAI;AAC7E,gBAAI,CAAC,UAAU,OAAO,WAAW,SAAU,QAAO;AAClD,kBAAM,KAAK;AACX,kBAAM,OAAO,OAAO,GAAG,SAAS,WAAW,GAAG,KAAK,KAAK,IAAI;AAC5D,gBAAI,CAAC,KAAM,QAAO;AAClB,mBAAO;AAAA,cACH;AAAA,cACA,MAAM,OAAO,GAAG,SAAS,WAAW,GAAG,OAAO;AAAA,YAClD;AAAA,UACJ,SAAS,KAAK;AACV,oBAAQ,KAAK,6CAA6C,GAAG;AAC7D,mBAAO;AAAA,UACX;AAAA,QACJ;AAEA,iBAAS,iBAAiB,OAAiE;AACvF,cAAI,CAAC,SAAS,OAAO,MAAM,SAAS,YAAY,CAAC,MAAM,MAAM;AACzD,6BAAiB;AACjB;AAAA,UACJ;AACA,gBAAM,UAAU;AAAA,YACZ,MAAM,MAAM;AAAA,YACZ,MAAM,OAAO,MAAM,SAAS,WAAW,MAAM,OAAO;AAAA,UACxD;AACA,cAAI;AACA,oBAAQ,kBAAkB,OAAO;AAAA,UACrC,SAAS,KAAK;AACV,oBAAQ,KAAK,iDAAiD,GAAG;AAAA,UACrE;AAAA,QACJ;AAEA,iBAAS,mBAAyB;AAC9B,cAAI;AACA,mBAAO,gBAAgB;AAAA,UAC3B,SAAS,KAAK;AACV,oBAAQ,KAAK,iDAA8C,GAAG;AAAA,UAClE;AAAA,QACJ;AAIA,iBAAS,iBAAuB;AAC5B,gBAAM,WAAWA,aAAY;AAC7B,gBAAM,oBAAoB,qBAAqB;AAE/C,gBAAM,aAAa,SAAS,OAAO,QAAM;AACrC,gBAAI,kBAAkB,IAAI,EAAE,EAAG,QAAO;AACtC,kBAAM,KAAK,SAAS,eAAe,EAAE;AACrC,gBAAI,CAAC,GAAI,QAAO;AAChB,kBAAM,YAAY,GAAG,WAAW,GAAG,QAAQ,cAAc;AACzD,mBAAO,CAAC,GAAG,UAAU,SAAS,QAAQ,KAAK;AAAA,UAC/C,CAAC;AAED,cAAI;AACA,oBAAQ,iBAAiB,UAAU;AAAA,UACvC,SAAS,KAAK;AACV,oBAAQ,KAAK,gDAAgD,GAAG;AAAA,UACpE;AAAA,QACJ;AAEA,iBAAS,oBAA0B;AAC/B,gBAAM,oBAAoB,qBAAqB;AAG/C,gBAAM,YAAY,oBAAI,IAAY;AAClC,cAAI;AACA,kBAAM,MAAM,QAAkB,iBAAiB,CAAC,CAAC;AACjD,gBAAI,MAAM,QAAQ,GAAG,EAAG,KAAI,QAAQ,CAAC,OAAe,UAAU,IAAI,EAAE,CAAC;AAAA,UACzE,SAAS,KAAK;AACV,oBAAQ,KAAK,4CAA4C,GAAG;AAAA,UAChE;AAGA,cAAI;AACA,kBAAM,SAAS,QAAwC,kBAAkB,IAAI;AAC7E,gBAAI,QAAQ;AACR,oBAAM,aACF,UAAW,OAAO,YAAY;AAClC,kBAAI,cAAc,OAAO,eAAe,UAAU;AAC9C,uBAAO,QAAQ,UAAU,EAAE,QAAQ,CAAC,CAAC,IAAI,KAAK,MAAM;AAChD,sBAAI;AACA,0BAAM,UAAU,CAAC,EACb,SAAU,MAAkC,SAAS;AAEzD,wBAAI,QAAS,WAAU,IAAI,EAAE;AAAA,kBACjC,QAAQ;AAAA,kBAER;AAAA,gBACJ,CAAC;AAAA,cACL;AAAA,YACJ;AAAA,UACJ,SAAS,KAAK;AACV,oBAAQ,KAAK,sDAAsD,GAAG;AAAA,UAC1E;AAEA,oBAAU,QAAQ,QAAM;AAEpB,gBAAI,kBAAkB,IAAI,EAAE,EAAG;AAG/B,kBAAM,KAAK,SAAS,eAAe,EAAE;AACrC,gBAAI,CAAC,IAAI;AAEL,sBAAQ,KAAK,0BAA0B,EAAE,oBAAoB;AAC7D;AAAA,YACJ;AAGA,kBAAM,gBAAgB,EAAE,eAAe;AAGvC,gBAAI,iBAAiB,OAAO,cAAc,cAAc,YAAY;AAChE,oBAAM,SAAS,cAAc,UAAU,EAAE;AACzC,kBAAI,CAAC,QAAQ;AACT,wBAAQ;AAAA,kBACJ,8BAA8B,EAAE;AAAA,gBACpC;AACA;AAAA,cACJ;AAAA,YACJ;AAGA,kBAAM,KAAK,EAAE,eAAe;AAC5B,gBAAI,MAAM,OAAO,GAAG,SAAS,YAAY;AACrC,kBAAI;AACA,mBAAG,KAAK,EAAE;AAAA,cACd,SAAS,KAAK;AACV,wBAAQ,KAAK,0BAA0B,EAAE,wBAAwB,GAAG;AAEpE,sBAAM,UAAU,EAAE,SAAS;AAC3B,sBAAM,iBACF,WAAY,QAAQ,EAAE;AAC1B,sBAAM,SACF,kBAAmB,eAAe,MAAM;AAE5C,oBAAI,OAAO,WAAW,YAAY;AAC9B,sBAAI;AACA,2BAAO;AAAA,kBACX,SAAS,SAAS;AACd,4BAAQ;AAAA,sBACJ,0BAA0B,EAAE;AAAA,sBAC5B;AAAA,oBACJ;AAEA,0BAAM,WACF,EACF;AACF,wBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,+BAAS,KAAK,EAAE;AAAA,oBACpB,OAAO;AACH,yBAAG,UAAU,OAAO,QAAQ;AAAA,oBAChC;AAAA,kBACJ;AAAA,gBACJ,OAAO;AAEH,wBAAM,WACF,EACF;AACF,sBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,6BAAS,KAAK,EAAE;AAAA,kBACpB,OAAO;AACH,uBAAG,UAAU,OAAO,QAAQ;AAAA,kBAChC;AAAA,gBACJ;AAAA,cACJ;AAAA,YACJ,OAAO;AAEH,oBAAM,UAAU,EAAE,SAAS;AAC3B,oBAAM,iBAAiB,WAAY,QAAQ,EAAE;AAC7C,oBAAM,SACF,kBAAmB,eAAe,MAAM;AAE5C,kBAAI,OAAO,WAAW,YAAY;AAC9B,oBAAI;AACA,yBAAO;AAAA,gBACX,SAAS,KAAK;AACV,0BAAQ,KAAK,0BAA0B,EAAE,MAAM,GAAG;AAElD,wBAAM,WACF,EACF;AACF,sBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,6BAAS,KAAK,EAAE;AAAA,kBACpB,OAAO;AACH,uBAAG,UAAU,OAAO,QAAQ;AAAA,kBAChC;AAAA,gBACJ;AAAA,cACJ,OAAO;AAEH,sBAAM,WACF,EACF;AACF,oBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,2BAAS,KAAK,EAAE;AAAA,gBACpB,OAAO;AACH,qBAAG,UAAU,OAAO,QAAQ;AAAA,gBAChC;AAAA,cACJ;AAAA,YACJ;AAAA,UACJ,CAAC;AAGD,gBAAMC,wBAAuB,EAAE,sBAAsB;AACrD,cAAI,OAAOA,0BAAyB,WAAY,CAAAA,sBAAqB;AACrE,gBAAM,+BAA+B,EAAE,8BAA8B;AAGrE,cAAI,OAAO,iCAAiC,WAAY,8BAA6B;AAAA,QACzF;AAIA,iBAAS,uBAAuB,OAA+C;AAC3E,cAAI,CAAC,MAAO,QAAO;AACnB,iBAAQ,MAAM,cAAc,cAAc,KAA4B;AAAA,QAC1E;AAEA,iBAAS,sBAA4B;AACjC,gBAAM,WAAWD,aAAY;AAC7B,gBAAM,oBAAoB,qBAAqB;AAC/C,gBAAM,YAAuB,CAAC;AAE9B,mBAAS,QAAQ,QAAM;AACnB,gBAAI,kBAAkB,IAAI,EAAE,EAAG;AAC/B,kBAAM,KAAK,SAAS,eAAe,EAAE;AACrC,kBAAM,WAAW,uBAAuB,EAAE;AAC1C,gBAAI,MAAM,UAAU;AAChB,wBAAU,EAAE,IAAI;AAAA,gBACZ,MAAM,SAAS,MAAM,QAAQ;AAAA,gBAC7B,KAAK,SAAS,MAAM,OAAO;AAAA,gBAC3B,OAAO,SAAS,MAAM,SAAS;AAAA,gBAC/B,QAAQ,SAAS,MAAM,UAAU;AAAA,gBACjC,UAAU,SAAS,MAAM,YAAY;AAAA,cACzC;AAAA,YACJ;AAAA,UACJ,CAAC;AAED,cAAI;AACA,oBAAQ,qBAAqB,SAAS;AAAA,UAC1C,SAAS,KAAK;AACV,oBAAQ,KAAK,qDAAqD,GAAG;AAAA,UACzE;AAAA,QACJ;AAEA,iBAAS,yBAA+B;AACpC,gBAAM,oBAAoB,qBAAqB;AAC/C,cAAI,YAAuB,CAAC;AAE5B,cAAI;AACA,wBAAY,QAAmB,qBAAqB,CAAC,CAAC;AAAA,UAC1D,SAAS,KAAK;AACV,oBAAQ,KAAK,iDAAiD,GAAG;AACjE;AAAA,UACJ;AAEA,iBAAO,KAAK,SAAS,EAAE,QAAQ,QAAM;AACjC,gBAAI,kBAAkB,IAAI,EAAE,EAAG;AAC/B,kBAAM,KAAK,SAAS,eAAe,EAAE;AACrC,kBAAM,WAAW,uBAAuB,EAAE;AAC1C,gBAAI,MAAM,UAAU;AAChB,oBAAM,SAAS,UAAU,EAAE;AAE3B,kBAAI,CAAC,OAAQ;AAEb,kBAAI,OAAO,UAAU;AACjB,yBAAS,MAAM,WAAW,OAAO;AAAA,cACrC,WAAW,OAAO,QAAQ,OAAO,KAAK;AAClC,yBAAS,MAAM,WAAW;AAAA,cAC9B;AACA,kBAAI,OAAO,KAAM,UAAS,MAAM,OAAO,OAAO;AAC9C,kBAAI,OAAO,IAAK,UAAS,MAAM,MAAM,OAAO;AAC5C,kBAAI,OAAO,MAAO,UAAS,MAAM,QAAQ,OAAO;AAChD,kBAAI,OAAO,OAAQ,UAAS,MAAM,SAAS,OAAO;AAAA,YACtD;AAEA,kBAAM,uBAAuB,EAAE,sBAAsB;AAGrD,gBAAI,OAAO,yBAAyB,YAAY;AAC5C,mCAAqB,QAAQ;AAAA,YACjC;AAAA,UACJ,CAAC;AAAA,QACL;AAIA,iBAAS,oBAA0B;AAC/B,gBAAM,WAAWA,aAAY;AAE7B,mBAAS,QAAQ,QAAM;AACnB,kBAAM,QAAQ,SAAS,eAAe,EAAE;AACxC,kBAAM,WAAW,uBAAuB,KAAK;AAC7C,gBAAI,OAAO;AACP,oBAAM,MAAM,SAAS;AAAA,YACzB;AACA,gBAAI,UAAU;AACV,uBAAS,MAAM,OAAO;AACtB,uBAAS,MAAM,MAAM;AACrB,uBAAS,MAAM,QAAQ;AACvB,uBAAS,MAAM,SAAS;AACxB,uBAAS,MAAM,WAAW;AAC1B,uBAAS,MAAM,SAAS;AAAA,YAC5B;AAAA,UACJ,CAAC;AAED,cAAI,OAAO,EAAE,WAAW,MAAM,aAAa;AACvC,cAAE,WAAW,IAAI;AAAA,UACrB;AAEA,cAAI;AACA,mBAAO,mBAAmB;AAAA,UAC9B,SAAS,KAAK;AACV,oBAAQ,KAAK,oDAAiD,GAAG;AAAA,UACrE;AAEA,gBAAM,oBAAoB,EAAE,mBAAmB;AAC/C,cAAI,OAAO,sBAAsB,WAAY,mBAAkB;AAE/D,gBAAME,wBAAuB,EAAE,sBAAsB;AACrD,cAAI,OAAOA,0BAAyB,WAAY,CAAAA,sBAAqB;AAErE,gBAAM,UAAU,EAAE,SAAS;AAC3B,cAAI,SAAS;AACT,mBAAO,OAAO,OAAO,EAAE,QAAQ,YAAU;AACrC,oBAAM,UAAW,OAAmC,wBAAwB;AAG5E,kBAAI,OAAO,YAAY,WAAY,SAAQ;AAAA,YAC/C,CAAC;AAAA,UACL;AAGA,2BAAiB;AAEjB,gBAAM,+BAA+B,EAAE,8BAA8B;AAGrE,cAAI,OAAO,iCAAiC,WAAY,8BAA6B;AAAA,QACzF;AAIA,cAAM,MAAM;AAAA;AAAA,UAER;AAAA,UACA;AAAA,UACA;AAAA;AAAA,UAGA;AAAA,UACA;AAAA;AAAA,UAGA;AAAA,UACA;AAAA,UACA;AAAA;AAAA,UAGA;AAAA,QACJ;AAEA,UAAE,eAAe,IAAI;AAAA,MACzB,GAAG;AAAA;AAAA;;;ACpZH;AAAA;AAAA;AAKA;AAEA,OAAC,MAAM;AACH;AAKA,cAAM,MAAM;AACZ,cAAMC,iBAAiB,IAAI,iBAA6C,CAAC;AAEzE,cAAM,YAAaA,eAAc,wBAAmC;AAEpE,cAAM,wBAAqC,CAAC,UAAU,SAAS,MAAM;AAErE,cAAM,kBAAkB,OAAO,WAAW,8BAA8B;AAExE,YAAI,mBAA8B,MAAM;AACpC,gBAAM,cAAc,UAAU,SAAS;AACvC,iBACI,eAAe,sBAAsB,SAAS,WAAW,IAAI,cAAc;AAAA,QAEnF,GAAG;AAEH,iBAAS,4BAAkC;AACvC,gBAAM,UACF,oBAAoB,UAAW,oBAAoB,YAAY,gBAAgB;AACnF,mBAAS,gBAAgB,UAAU,OAAO,QAAQ,OAAO;AAAA,QAC7D;AAEA,iBAAS,mBAAmB,MAAuB;AAC/C,cAAI,CAAC,sBAAsB,SAAS,IAAI,EAAG;AAC3C,4BAAkB;AAClB,oBAAU,WAAW,IAAI;AACzB,oCAA0B;AAG1B,iBAAO;AAAA,YACH,IAAI,YAAY,yBAAyB;AAAA,cACrC,QAAQ,EAAE,YAAY,KAAK;AAAA,YAC/B,CAAC;AAAA,UACL;AAAA,QACJ;AAEA,iBAAS,qBAAgC;AACrC,iBAAO;AAAA,QACX;AAGA,kCAA0B;AAE1B,cAAM,0BAA0B,MAAM;AAClC,oCAA0B;AAAA,QAC9B;AAQA,cAAM,MAAM;AACZ,YAAI,OAAO,IAAI,qBAAqB,YAAY;AAC5C,cAAI,iBAAiB,UAAU,uBAAwC;AAAA,QAC3E,WAAW,OAAO,IAAI,gBAAgB,YAAY;AAC9C,cAAI;AAAA,YACA;AAAA,UACJ;AAAA,QACJ;AAGA,cAAM,IAAI;AACV,UAAE,aAAa,IAAI;AAAA,UACf;AAAA,UACA;AAAA,UACA;AAAA,QACJ;AAGA,UAAE,oBAAoB,IAAI;AAC1B,UAAE,oBAAoB,IAAI;AAAA,MAC9B,GAAG;AAAA;AAAA;;;AC7EI,WAAS,gBAAgB,MAAoB;AAChD,UAAM,IAAI;AACV,UAAM,iBAAiB,EAAE;AACzB,QAAI,kBAAkB,OAAO,eAAe,qBAAqB,YAAY;AACzE,UAAI;AACA,QAAC,eAAe,iBAA4C,IAAI;AAAA,MACpE,SAAS,OAAO;AACZ,gBAAQ,KAAK,gCAAgC,KAAK;AAAA,MACtD;AAAA,IACJ;AAAA,EACJ;AAnBA;AAAA;AAAA;AAAA;AAAA;;;ACAA,MAkBa,oBAyMN;AA3NP;AAAA;AAAA;AAMA;AAYO,MAAM,qBAAN,MAAyB;AAAA,QAa5B,YAAY,QAA0B;AAClC,eAAK,aAAa,OAAO,MAAM,KAAK,YAAY;AAChD,eAAK,OAAO,OAAO,QAAQ;AAC3B,eAAK,QAAQ,OAAO,SAAS;AAC7B,eAAK,YAAY;AACjB,eAAK,gBAAgB;AACrB,eAAK,QAAQ,KAAK,iBAAiB,OAAO,gBAAgB,CAAC,CAAC;AAC5D,eAAK,iBAAiB,oBAAI,IAAI;AAC9B,eAAK,gBAAgB;AACrB,eAAK,YAAY;AACjB,eAAK,WAAW,OAAO,YAAY,CAAC;AACpC,eAAK,qBAAqB;AAAA,QAC9B;AAAA,QAEQ,cAAsB;AAC1B,iBAAO,GAAG,KAAK,IAAI,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;AAAA,QAChF;AAAA,QAEQ,iBAAiB,cAAwD;AAC7E,iBAAO;AAAA,YACH,GAAG;AAAA,YACH,SAAS,KAAK,IAAI;AAAA,YAClB,UAAU,KAAK,IAAI;AAAA,UACvB;AAAA,QACJ;AAAA,QAEA,KAAK,WAAwB;AACzB,cAAI,KAAK,eAAe;AACpB,oBAAQ,KAAK,YAAY,KAAK,UAAU,sBAAsB;AAC9D;AAAA,UACJ;AACA,eAAK,YAAY;AACjB,eAAK,OAAO;AACZ,eAAK,qBAAqB;AAC1B,eAAK,gBAAgB;AACrB,eAAK,KAAK,aAAa;AAAA,QAC3B;AAAA;AAAA,QAGA,SAAe;AACX,gBAAM,IAAI,MAAM,0CAA0C;AAAA,QAC9D;AAAA,QAEA,uBAA6B;AAAA,QAE7B;AAAA,QAEA,OAAa;AACT,cAAI,KAAK,WAAW;AAChB,kBAAM,WAAY,OAAe;AACjC,gBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,uBAAS,KAAK,KAAK,SAAS;AAAA,YAChC,OAAO;AACH,mBAAK,UAAU,UAAU,OAAO,QAAQ;AAAA,YAC5C;AACA,iBAAK,YAAY;AACjB,iBAAK,KAAK,OAAO;AAAA,UACrB;AAAA,QACJ;AAAA,QAEA,OAAa;AACT,cAAI,KAAK,WAAW;AAChB,kBAAM,WAAY,OAAe;AACjC,gBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,uBAAS,KAAK,KAAK,SAAS;AAAA,YAChC,OAAO;AACH,mBAAK,UAAU,UAAU,IAAI,QAAQ;AAAA,YACzC;AACA,iBAAK,YAAY;AACjB,iBAAK,KAAK,QAAQ;AAAA,UACtB;AAAA,QACJ;AAAA,QAEA,UAAgB;AACZ,eAAK,KAAK,eAAe;AACzB,eAAK,wBAAwB;AAC7B,cAAI,KAAK,WAAW;AAChB,gBAAI;AACA,kBAAI,OAAQ,KAAK,UAAkB,WAAW,YAAY;AACtD,gBAAC,KAAK,UAAkB,OAAO;AAAA,cACnC,WAAW,KAAK,UAAU,YAAY;AAClC,qBAAK,UAAU,WAAW,YAAY,KAAK,SAAS;AAAA,cACxD;AAAA,YACJ,QAAQ;AACJ,kBAAI;AACA,qBAAK,UAAU,YAAY;AAC3B,qBAAK,UAAU,UAAU,IAAI,QAAQ;AAAA,cACzC,QAAQ;AAAA,cAER;AAAA,YACJ;AACA,iBAAK,YAAY;AAAA,UACrB;AACA,eAAK,gBAAgB;AACrB,eAAK,gBAAgB;AACrB,eAAK,KAAK,WAAW;AAAA,QACzB;AAAA,QAEA,YAAY,SAAoC;AAC5C,gBAAM,WAAW,EAAE,GAAG,KAAK,MAAM;AACjC,eAAK,QAAQ;AAAA,YACT,GAAG,KAAK;AAAA,YACR,GAAG;AAAA,YACH,UAAU,KAAK,IAAI;AAAA,UACvB;AACA,eAAK,KAAK,gBAAgB,EAAE,UAAU,UAAU,KAAK,MAAM,CAAC;AAG5D,eAAK,iBAAiB;AAAA,QAC1B;AAAA,QAEQ,mBAAyB;AAC7B,gBAAM,IAAI;AACV,cAAI,EAAE,kBAAkB,OAAO,EAAE,eAAe,qBAAqB,YAAY;AAC7E,gBAAI;AACA,gBAAE,eAAe,iBAAiB,KAAK,IAAI;AAAA,YAC/C,SAAS,OAAO;AACZ,sBAAQ,KAAK,gCAAgC,KAAK;AAAA,YACtD;AAAA,UACJ;AAAA,QACJ;AAAA,QAEA,WAAgC;AAC5B,iBAAO,EAAE,GAAG,KAAK,MAAM;AAAA,QAC3B;AAAA,QAEA,YAAY;AACR,iBAAO;AAAA,YACH,YAAY,KAAK;AAAA,YACjB,MAAM,KAAK;AAAA,YACX,OAAO,KAAK;AAAA,YACZ,OAAO,KAAK,SAAS;AAAA,YACrB,UAAU,KAAK;AAAA,UACnB;AAAA,QACJ;AAAA,QAEA,YAAY,MAAW;AAEnB,eAAK,qBAAqB;AAE1B,cAAI,KAAK,MAAO,MAAK,QAAQ,KAAK;AAClC,cAAI,KAAK,MAAO,MAAK,QAAQ,KAAK;AAClC,cAAI,KAAK,SAAU,MAAK,WAAW,EAAE,GAAG,KAAK,UAAU,GAAG,KAAK,SAAS;AACxE,eAAK,KAAK,cAAc;AAAA,QAC5B;AAAA,QAEA,KAAK,WAAmB,MAAkB;AACtC,gBAAM,YAAY,KAAK,eAAe,IAAI,SAAS,KAAK,CAAC;AACzD,oBAAU,QAAQ,cAAY;AAC1B,gBAAI;AACA,uBAAS,KAAK,MAAM,IAAI;AAAA,YAC5B,SAAS,OAAO;AACZ,sBAAQ,MAAM,+BAA+B,SAAS,KAAK,KAAK;AAAA,YACpE;AAAA,UACJ,CAAC;AAAA,QACL;AAAA,QAEA,GAAG,WAAmB,UAA+B;AACjD,cAAI,CAAC,KAAK,eAAe,IAAI,SAAS,EAAG,MAAK,eAAe,IAAI,WAAW,CAAC,CAAC;AAC9E,eAAK,eAAe,IAAI,SAAS,EAAG,KAAK,QAAQ;AAAA,QACrD;AAAA,QAEA,IAAI,WAAmB,UAA+B;AAClD,cAAI,CAAC,KAAK,eAAe,IAAI,SAAS,EAAG;AACzC,gBAAM,YAAY,KAAK,eAAe,IAAI,SAAS;AACnD,gBAAM,QAAQ,UAAU,QAAQ,QAAQ;AACxC,cAAI,QAAQ,GAAI,WAAU,OAAO,OAAO,CAAC;AAAA,QAC7C;AAAA,QAEA,0BAAgC;AAC5B,eAAK,eAAe,MAAM;AAAA,QAC9B;AAAA,QAEA,QAAc;AACV,cAAI,KAAK,aAAa,KAAK,UAAW,MAAK,KAAK,SAAS;AAAA,QAC7D;AAAA,QAEA,OAAa;AACT,eAAK,KAAK,SAAS;AAAA,QACvB;AAAA,MACJ;AAIA,UAAI,OAAO,WAAW,aAAa;AAC/B,QAAC,OAAe,qBAAqB;AAAA,MACzC;AAEA,MAAO,+BAAQ;AACf,cAAQ,IAAI,2BAA2B;AAEvC,OAAC,WAAY;AACT;AAAA,QAyBA,MAAMC,oBAAmB;AAAA,UAarB,YAAY,QAAwB;AAChC,iBAAK,aAAa,OAAO,MAAM,KAAK,YAAY;AAChD,iBAAK,OAAO,OAAO,QAAQ;AAC3B,iBAAK,QAAQ,OAAO,SAAS;AAC7B,iBAAK,YAAY;AACjB,iBAAK,gBAAgB;AACrB,iBAAK,QAAQ,KAAK,iBAAiB,OAAO,gBAAgB,CAAC,CAAC;AAC5D,iBAAK,iBAAiB,oBAAI,IAAI;AAC9B,iBAAK,gBAAgB;AACrB,iBAAK,YAAY;AACjB,iBAAK,WAAW,OAAO,YAAY,CAAC;AACpC,iBAAK,qBAAqB;AAAA,UAC9B;AAAA,UAEU,cAAsB;AAC5B,mBAAO,GAAG,KAAK,IAAI,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;AAAA,UAChF;AAAA,UAEU,iBAAiB,cAAgE;AACvF,mBAAO;AAAA,cACH,GAAG;AAAA,cACH,SAAS,KAAK,IAAI;AAAA,cAClB,UAAU,KAAK,IAAI;AAAA,YACvB;AAAA,UACJ;AAAA,UAEA,KAAK,WAA8B;AAC/B,gBAAI,KAAK,eAAe;AACpB,sBAAQ,KAAK,YAAY,KAAK,UAAU,sBAAsB;AAC9D;AAAA,YACJ;AAEA,iBAAK,YAAY;AACjB,iBAAK,OAAO;AACZ,iBAAK,qBAAqB;AAC1B,iBAAK,gBAAgB;AACrB,iBAAK,KAAK,aAAa;AAAA,UAC3B;AAAA,UAEU,SAAe;AACrB,kBAAM,IAAI,MAAM,0CAA0C;AAAA,UAC9D;AAAA,UAEU,uBAA6B;AAAA,UAEvC;AAAA,UAEA,OAAa;AACT,gBAAI,KAAK,WAAW;AAChB,oBAAM,WAAY,OAAe;AACjC,kBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,yBAAS,KAAK,KAAK,SAAS;AAAA,cAChC,OAAO;AACH,qBAAK,UAAU,UAAU,OAAO,QAAQ;AAAA,cAC5C;AAAA,YACJ;AAAA,UACJ;AAAA,UAEA,OAAa;AACT,gBAAI,KAAK,WAAW;AAChB,oBAAM,WAAY,OAAe;AACjC,kBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,yBAAS,KAAK,KAAK,SAAS;AAAA,cAChC,OAAO;AACH,qBAAK,UAAU,UAAU,IAAI,QAAQ;AAAA,cACzC;AACA,mBAAK,YAAY;AACjB,mBAAK,KAAK,QAAQ;AAAA,YACtB;AAAA,UACJ;AAAA,UAEA,UAAgB;AACZ,iBAAK,KAAK,eAAe;AACzB,iBAAK,wBAAwB;AAE7B,gBAAI,KAAK,WAAW;AAChB,kBAAI;AAEA,oBAAI,OAAQ,KAAK,UAA0B,WAAW,YAAY;AAC9D,kBAAC,KAAK,UAA0B,OAAO;AAAA,gBAC3C,WAAY,KAAK,UAA0B,YAAY;AACnD,kBAAC,KAAK,UAA0B,WAAY;AAAA,oBACxC,KAAK;AAAA,kBACT;AAAA,gBACJ;AAAA,cACJ,QAAQ;AAEJ,oBAAI;AACA,uBAAK,UAAU,YAAY;AAC3B,uBAAK,UAAU,UAAU,IAAI,QAAQ;AAAA,gBACzC,QAAQ;AAAA,gBAER;AAAA,cACJ;AACA,mBAAK,YAAY;AAAA,YACrB;AAEA,iBAAK,gBAAgB;AACrB,iBAAK,gBAAgB;AACrB,iBAAK,KAAK,WAAW;AAAA,UACzB;AAAA,UAEA,YAAY,SAAwC;AAChD,kBAAM,WAAW,EAAE,GAAG,KAAK,MAAM;AACjC,iBAAK,QAAQ;AAAA,cACT,GAAG,KAAK;AAAA,cACR,GAAG;AAAA,cACH,UAAU,KAAK,IAAI;AAAA,YACvB;AACA,iBAAK,KAAK,gBAAgB,EAAE,UAAU,UAAU,KAAK,MAAM,CAAqB;AAGhF,iBAAK,iBAAiB;AAAA,UAC1B;AAAA,UAEQ,mBAAyB;AAC7B,4BAAgB,KAAK,IAAI;AAAA,UAC7B;AAAA,UAEA,WAAoC;AAChC,mBAAO,EAAE,GAAG,KAAK,MAAM;AAAA,UAC3B;AAAA,UAEA,YAAgC;AAC5B,mBAAO;AAAA,cACH,YAAY,KAAK;AAAA,cACjB,MAAM,KAAK;AAAA,cACX,OAAO,KAAK;AAAA,cACZ,OAAO,KAAK,SAAS;AAAA,cACrB,UAAU,KAAK;AAAA,YACnB;AAAA,UACJ;AAAA,UAEA,YAAY,MAAyC;AAEjD,iBAAK,qBAAqB;AAE1B,gBAAI,KAAK,OAAO;AACZ,mBAAK,QAAQ,KAAK;AAAA,YACtB;AACA,gBAAI,KAAK,OAAO;AACZ,mBAAK,QAAQ,KAAK;AAAA,YACtB;AACA,gBAAI,KAAK,UAAU;AACf,mBAAK,WAAW,EAAE,GAAG,KAAK,UAAU,GAAG,KAAK,SAAS;AAAA,YACzD;AACA,iBAAK,KAAK,cAAc;AAAA,UAC5B;AAAA,UAEA,KAAK,WAAmB,MAAsB;AAC1C,kBAAM,YAAY,KAAK,eAAe,IAAI,SAAS,KAAK,CAAC;AACzD,sBAAU,QAAQ,cAAY;AAC1B,kBAAI;AACA,yBAAS,KAAK,MAAM,IAAI;AAAA,cAC5B,SAAS,OAAO;AACZ,wBAAQ,MAAM,+BAA+B,SAAS,KAAK,KAAK;AAAA,cACpE;AAAA,YACJ,CAAC;AAAA,UACL;AAAA,UAEA,GAAG,WAAmB,UAA+B;AACjD,gBAAI,CAAC,KAAK,eAAe,IAAI,SAAS,GAAG;AACrC,mBAAK,eAAe,IAAI,WAAW,CAAC,CAAC;AAAA,YACzC;AACA,iBAAK,eAAe,IAAI,SAAS,EAAG,KAAK,QAAQ;AAAA,UACrD;AAAA,UAEA,IAAI,WAAmB,UAA+B;AAClD,gBAAI,CAAC,KAAK,eAAe,IAAI,SAAS,EAAG;AAEzC,kBAAM,YAAY,KAAK,eAAe,IAAI,SAAS;AACnD,kBAAM,QAAQ,UAAU,QAAQ,QAAQ;AACxC,gBAAI,QAAQ,IAAI;AACZ,wBAAU,OAAO,OAAO,CAAC;AAAA,YAC7B;AAAA,UACJ;AAAA,UAEA,0BAAgC;AAC5B,iBAAK,eAAe,MAAM;AAAA,UAC9B;AAAA,UAEA,QAAc;AACV,gBAAI,KAAK,aAAa,KAAK,WAAW;AAClC,mBAAK,KAAK,SAAS;AAAA,YACvB;AAAA,UACJ;AAAA,UAEA,OAAa;AACT,iBAAK,KAAK,SAAS;AAAA,UACvB;AAAA,QACJ;AAEA,QAAC,OAAwE,qBACrEA;AAAA,MACR,GAAG;AAAA;AAAA;;;ACvcH;AAAA;AAAA;AAAA;AACA;AAEA,cAAQ,IAAI,wBAAwB;AAEpC,OAAC,WAAY;AACT;AAAA,QA6BA,MAAM,gBAAgB;AAAA,UASlB,YAAY,QAAuB;AAC/B,iBAAK,OAAO,OAAO;AACnB,iBAAK,gBAAgB,OAAO;AAC5B,iBAAK,eAAe,OAAO,gBAAgB;AAC3C,iBAAK,kBACD,OAAO,mBAAmB,KAAK,wBAAwB,KAAK,IAAI;AAEpE,iBAAK,YAAY,oBAAI,IAAI;AACzB,iBAAK,mBAAmB;AACxB,iBAAK,kBAAkB;AAAA,UAC3B;AAAA,UAEA,eAAe,SAA+B,CAAC,GAA4B;AACvE,gBAAI,KAAK,eAAe,KAAK,KAAK,UAAU,QAAQ,KAAK,cAAc;AACnE,sBAAQ,KAAK,sBAAsB,KAAK,YAAY,iBAAiB,KAAK,IAAI,EAAE;AAChF,qBAAO;AAAA,YACX;AAEA,iBAAK;AACL,kBAAM,aAAa,OAAO,MAAM,GAAG,KAAK,IAAI,IAAI,KAAK,eAAe;AAKpE,gBAAI,OAAO,MAAM,KAAK,UAAU,IAAI,UAAU,GAAG;AAC7C,sBAAQ;AAAA,gBACJ,oBAAoB,UAAU,uBAAuB,KAAK,IAAI;AAAA,cAClE;AACA,oBAAM,WAAW,KAAK,UAAU,IAAI,UAAU;AAE9C,kBAAI;AACA,gBAAC,SAAiB,QAAQ,OAAO,SAAU,SAAiB;AAC5D,gBAAC,SAAiB,WAAW;AAAA,kBACzB,GAAI,SAAiB;AAAA,kBACrB,GAAI,OAAO,YAAY,CAAC;AAAA,gBAC5B;AAAA,cACJ,QAAQ;AAAA,cAAC;AAET,mBAAK,kBAAkB,UAAU;AAEjC,mBAAK,iBAAiB;AACtB,qBAAO;AAAA,YACX;AAEA,kBAAM,YAAY,KAAK,gBAAgB,UAAU;AACjD,gBAAI,CAAC,WAAW;AACZ,sBAAQ,MAAM,yCAAyC;AACvD,qBAAO;AAAA,YACX;AAEA,kBAAM,iBAAiB;AAAA,cACnB,IAAI;AAAA,cACJ,MAAM,KAAK;AAAA,cACX,OAAO,OAAO,SAAS,GAAG,KAAK,IAAI,IAAI,KAAK,eAAe;AAAA,cAC3D,cAAc,OAAO,gBAAgB,CAAC;AAAA,cACtC,UAAU,OAAO,YAAY,CAAC;AAAA,YAClC;AAEA,kBAAM,WAAW,IAAI,KAAK,cAAc,cAAc;AAEtD,gBAAI;AACA,uBAAS,KAAK,SAAS;AACvB,mBAAK,UAAU,IAAI,YAAY,QAAQ;AAEvC,mBAAK,qBAAqB,QAAQ;AAGlC,mBAAK,kBAAkB,UAAU;AAGjC,mBAAK,iBAAiB;AAEtB,sBAAQ,IAAI,qBAAqB,UAAU,EAAE;AAC7C,qBAAO;AAAA,YACX,SAAS,OAAO;AACZ,sBAAQ,MAAM,kCAAkC,KAAK;AACrD,wBAAU,OAAO;AACjB,qBAAO;AAAA,YACX;AAAA,UACJ;AAAA,UAEA,YAAY,YAA6C;AACrD,mBAAO,KAAK,UAAU,IAAI,UAAU,KAAK;AAAA,UAC7C;AAAA,UAEA,oBAA6C;AACzC,mBAAO,KAAK,mBAAmB,KAAK,UAAU,IAAI,KAAK,gBAAgB,KAAK,OAAO;AAAA,UACvF;AAAA,UAEA,kBAAkB,YAA0B;AACxC,gBAAI,KAAK,UAAU,IAAI,UAAU,GAAG;AAChC,oBAAM,aAAa,KAAK;AAGxB,kBAAI,eAAe,YAAY;AAC3B;AAAA,cACJ;AAEA,mBAAK,mBAAmB;AAGxB,kBAAI,YAAY;AACZ,sBAAM,mBAAmB,KAAK,UAAU,IAAI,UAAU;AACtD,oBAAI,kBAAkB;AAClB,mCAAiB,KAAK;AAAA,gBAC1B;AAAA,cACJ;AAGA,oBAAM,WAAW,KAAK,UAAU,IAAI,UAAU;AAC9C,kBAAI,UAAU;AACV,yBAAS,MAAM;AAAA,cACnB;AAGA,mBAAK,iBAAiB;AAGtB,kBAAI;AACA,sBAAM,MAAM;AACZ,sBAAM,MAAM,QAAuC,KAAK,CAAC,CAAC;AAC1D,oBAAI,KAAK,IAAI,IAAI,KAAK;AACtB,wBAAQ,KAAK,GAAG;AAAA,cACpB,QAAQ;AAAA,cAER;AAAA,YACJ;AAAA,UACJ;AAAA,UAEA,kBAAsC;AAClC,mBAAO,MAAM,KAAK,KAAK,UAAU,OAAO,CAAC;AAAA,UAC7C;AAAA,UAEA,oBAA8B;AAC1B,mBAAO,MAAM,KAAK,KAAK,UAAU,KAAK,CAAC;AAAA,UAC3C;AAAA,UAEA,gBAAgB,YAA0B;AACtC,kBAAM,WAAW,KAAK,UAAU,IAAI,UAAU;AAC9C,gBAAI,CAAC,UAAU;AACX,sBAAQ,KAAK,YAAY,UAAU,YAAY;AAC/C;AAAA,YACJ;AAEA,qBAAS,QAAQ;AACjB,iBAAK,UAAU,OAAO,UAAU;AAGhC,gBAAI,KAAK,qBAAqB,YAAY;AACtC,oBAAM,eAAe,KAAK,kBAAkB;AAE5C,oBAAM,SACF,aAAa,SAAS,IAAI,aAAa,aAAa,SAAS,CAAC,IAAI;AACtE,mBAAK,mBAAmB,0BAAU;AAAA,YACtC;AAGA,iBAAK,iBAAiB;AAEtB,oBAAQ,IAAI,uBAAuB,UAAU,EAAE;AAAA,UACnD;AAAA,UAEA,sBAA4B;AACxB,iBAAK,UAAU,QAAQ,cAAY;AAC/B,uBAAS,QAAQ;AAAA,YACrB,CAAC;AACD,iBAAK,UAAU,MAAM;AACrB,iBAAK,mBAAmB;AAGxB,iBAAK,iBAAiB;AAAA,UAC1B;AAAA,UAEA,eAAwB;AACpB,mBAAO,KAAK,UAAU,OAAO;AAAA,UACjC;AAAA,UAEA,mBAA2B;AACvB,mBAAO,KAAK,UAAU;AAAA,UAC1B;AAAA,UAEA,eAA0C;AACtC,kBAAM,WAAW,KAAK;AACtB,mBAAO,KAAK,gBAAgB,EAAE,IAAI,cAAY;AAC1C,oBAAM,OAAO,SAAS,UAAU;AAChC,kBAAI;AAEA,sBAAM,OAAQ,KAAa,YAAY,CAAC;AACxC,oBAAI,SAAS,eAAe,UAAU;AAClC,uBAAK,WAAW;AAAA,gBACpB;AACA,gBAAC,KAAa,WAAW;AAAA,cAC7B,QAAQ;AAAA,cAER;AACA,qBAAO;AAAA,YACX,CAAC;AAAA,UACL;AAAA,UAEA,eAAe,MAAqB;AAChC,gBAAI,CAAC,MAAM,QAAQ,IAAI,EAAG;AAC1B,gBAAI,kBAAiC;AAErC,iBAAK,QAAQ,CAAC,iBAA0C;AACpD,oBAAM,WAAW,KAAK,eAAe;AAAA,gBACjC,IAAI,aAAa;AAAA,gBACjB,OAAO,aAAa;AAAA,gBACpB,UAAU,aAAa;AAAA,cAC3B,CAAC;AAED,kBAAI,YAAY,aAAa,OAAO;AAChC,yBAAS,YAAY,YAAY;AAAA,cACrC;AAGA,kBAAI;AACA,sBAAM,OAAO,aAAa;AAC1B,oBAAI,QAAS,KAAa,UAAU;AAChC,oCAAmB,aAAa,cAAyB;AAAA,gBAC7D;AAAA,cACJ,QAAQ;AAAA,cAER;AAAA,YACJ,CAAC;AAGD,gBAAI,iBAAiB;AACjB,mBAAK,kBAAkB,eAAe;AAAA,YAC1C,WAAW,KAAK,UAAU,OAAO,GAAG;AAEhC,oBAAM,gBAAgB,MAAM,KAAK,KAAK,UAAU,OAAO,CAAC,EAAE,CAAC;AAC3D,kBAAI,eAAe;AACf,qBAAK,kBAAkB,cAAc,UAAU;AAAA,cACnD;AAAA,YACJ;AAGA,iBAAK,8BAA8B;AAAA,UACvC;AAAA,UAEQ,gCAAsC;AAC1C,kBAAM,IAAI;AACV,kBAAM,cAAc,EAAE,4BAA4B,EAAE;AACpD,gBAAI,eAAe,OAAO,YAAY,6BAA6B,YAAY;AAC3E,0BAAY,yBAAyB,KAAK,IAAI;AAAA,YAClD;AAAA,UACJ;AAAA;AAAA;AAAA;AAAA;AAAA,UAMA,iBAAiB,UAA0B;AAEvC,kBAAM,WAAW,SAAS,OAAO,QAAM,KAAK,UAAU,IAAI,EAAE,CAAC;AAC7D,gBAAI,SAAS,WAAW,KAAK,UAAU,MAAM;AACzC,sBAAQ;AAAA,gBACJ;AAAA,cACJ;AACA;AAAA,YACJ;AAGA,kBAAM,SAAS,oBAAI,IAA8B;AACjD,qBAAS,QAAQ,QAAM;AACnB,oBAAM,WAAW,KAAK,UAAU,IAAI,EAAE;AACtC,kBAAI,UAAU;AACV,uBAAO,IAAI,IAAI,QAAQ;AAAA,cAC3B;AAAA,YACJ,CAAC;AAGD,iBAAK,YAAY;AACjB,oBAAQ,IAAI,wBAAwB,QAAQ;AAAA,UAChD;AAAA,UAEQ,mBAAyB;AAC7B,4BAAgB,KAAK,IAAI;AAAA,UAC7B;AAAA,UAEQ,wBAAwB,YAAiC;AAC7D,kBAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,sBAAU,KAAK,GAAG,UAAU;AAC5B,sBAAU,YAAY;AACtB,qBAAS,KAAK,YAAY,SAAS;AACnC,mBAAO;AAAA,UACX;AAAA,UAEQ,qBAAqB,UAAkC;AAC3D,qBAAS,GAAG,WAAW,MAAM;AACzB,mBAAK,kBAAkB,SAAS,UAAU;AAAA,YAC9C,CAAC;AAED,qBAAS,GAAG,aAAa,MAAM;AAC3B,mBAAK,UAAU,OAAO,SAAS,UAAU;AAAA,YAC7C,CAAC;AAAA,UACL;AAAA,QACJ;AAEA,QAAC,OAAkE,kBAC/D;AAAA,MACR,GAAG;AAAA;AAAA;;;ACzVH;AAAA;AAAA;AAAA,cAAQ,IAAI,qBAAqB;AAEjC,OAAC,WAAY;AACX;AA4CA,iBAAS,oBAAoB,MAAmB,QAAgB,UAA0C;AACxG,gBAAM,MAAM,SAAS,cAAc,QAAQ;AAC3C,cAAI,OAAO;AACX,cAAI,YAAY,6BAA6B,IAAI;AACjD,cAAI,YAAY;AAChB,cAAI,MAAM,UACR;AAEF,cAAI,iBAAiB,cAAc,MAAM;AACvC,gBAAI,SAAS,SAAS;AACpB,kBAAI,MAAM,kBAAkB;AAC5B,kBAAI,MAAM,QAAQ;AAAA,YACpB,OAAO;AACL,kBAAI,MAAM,kBAAkB;AAAA,YAC9B;AAAA,UACF,CAAC;AAED,cAAI,iBAAiB,cAAc,MAAM;AACvC,gBAAI,MAAM,kBAAkB;AAC5B,gBAAI,MAAM,QAAQ;AAAA,UACpB,CAAC;AAED,cAAI,UAAU;AACZ,gBAAI,iBAAiB,SAAS,MAAM,SAAS,CAAC;AAAA,UAChD;AAEA,iBAAO;AAAA,QACT;AAEA,iBAAS,oBAAoB,QAA6C;AACxE,gBAAM,MAAM,SAAS,cAAc,QAAQ;AAC3C,cAAI,OAAO;AACX,cAAI,YAAY;AAEhB,cAAI,OAAO,MAAM;AACf,gBAAI,YAAY,OAAO;AAAA,UACzB,WAAW,OAAO,OAAO;AACvB,gBAAI,cAAc,OAAO;AAAA,UAC3B;AAEA,cAAI,OAAO,MAAO,KAAI,QAAQ,OAAO;AACrC,cAAI,OAAO,OAAQ,KAAI,QAAQ,SAAS,OAAO;AAC/C,cAAI,OAAO,QAAS,KAAI,iBAAiB,SAAS,OAAO,OAAO;AAEhE,iBAAO;AAAA,QACT;AAEA,cAAMC,gBAAe;AAAA,UACnB,eAAe,QAAqC;AAClD,kBAAM,WAAW,SAAS,cAAc,KAAK;AAC7C,qBAAS,YACP;AACF,qBAAS,MAAM,UAAU;AAEzB,kBAAM,WAAW,SAAS,cAAc,KAAK;AAC7C,qBAAS,YAAY;AAErB,gBAAI,OAAO,MAAM;AACf,oBAAM,SAAS,SAAS,cAAc,MAAM;AAC5C,qBAAO,YAAY;AAEnB,kBAAI,OAAO,KAAK,WAAW,MAAM,KAAK,OAAO,KAAK,WAAW,IAAI,KAAK,OAAO,KAAK,WAAW,GAAG,GAAG;AACjG,sBAAM,MAAM,SAAS,cAAc,KAAK;AACxC,oBAAI,MAAM,OAAO;AACjB,oBAAI,MAAM;AACV,oBAAI,MAAM,UAAU;AACpB,uBAAO,YAAY,GAAG;AAAA,cACxB,OAAO;AACL,uBAAO,cAAc,OAAO;AAC5B,uBAAO,MAAM,WAAW;AAAA,cAC1B;AAEA,uBAAS,YAAY,MAAM;AAAA,YAC7B;AAEA,kBAAM,UAAU,SAAS,cAAc,MAAM;AAC7C,oBAAQ,YAAY;AACpB,oBAAQ,cAAc,OAAO,SAAS;AACtC,YAAC,QAAwB,QAAQ,cAAc;AAC/C,qBAAS,YAAY,OAAO;AAE5B,qBAAS,YAAY,QAAQ;AAE7B,kBAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,sBAAU,YAAY;AAEtB,gBAAI,OAAO,cAAc;AACvB,wBAAU,YAAY,oBAAoB,YAAY,UAAK,OAAO,UAAU,CAAC;AAAA,YAC/E;AACA,gBAAI,OAAO,cAAc;AACvB,wBAAU,YAAY,oBAAoB,YAAY,UAAK,OAAO,UAAU,CAAC;AAAA,YAC/E;AACA,gBAAI,OAAO,cAAc,OAAO;AAC9B,wBAAU,YAAY,oBAAoB,SAAS,QAAK,OAAO,OAAO,CAAC;AAAA,YACzE;AAEA,qBAAS,YAAY,SAAS;AAE9B,mBAAO;AAAA,UACT;AAAA,UAEA,cAAc,SAAqC;AACjD,kBAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,oBAAQ,YACN;AAEF,oBAAQ,QAAQ,CAAC,QAAQ;AACvB,kBAAK,IAAyB,SAAS,aAAa;AAClD,sBAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,0BAAU,YAAY;AACtB,0BAAU,MAAM,UAAU;AAC1B,wBAAQ,YAAY,SAAS;AAAA,cAC/B,OAAO;AACL,wBAAQ,YAAY,oBAAoB,GAAuB,CAAC;AAAA,cAClE;AAAA,YACF,CAAC;AAED,mBAAO;AAAA,UACT;AAAA,UAEA,gBAAgB,QAAsC;AACpD,kBAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,sBAAU,YACR;AACF,sBAAU,MAAM,UAAU;AAE1B,kBAAM,SAAS,SAAS,cAAc,MAAM;AAC5C,mBAAO,YAAY;AACnB,mBAAO,cAAc,OAAO,eAAe;AAC3C,sBAAU,YAAY,MAAM;AAE5B,kBAAM,UAAU,SAAS,cAAc,MAAM;AAC7C,oBAAQ,YAAY;AACpB,oBAAQ,cAAc,OAAO,gBAAgB;AAC7C,sBAAU,YAAY,OAAO;AAE7B,mBAAO;AAAA,UACT;AAAA,UAEA,YAAY,UAAuB,UAAwB;AACzD,kBAAM,UAAU,SAAS,cAAc,4BAA4B;AACnE,gBAAI,QAAS,CAAC,QAAwB,cAAc;AAAA,UACtD;AAAA,UAEA,gBAAgB,WAAwB,MAAwB,SAAuB;AACrF,kBAAM,SAAS,UAAU,cAAc,cAAc,IAAI,EAAE;AAC3D,gBAAI,OAAQ,CAAC,OAAuB,cAAc;AAAA,UACpD;AAAA,UAEA,kBAAkB,QAA6C;AAC7D,kBAAM,QAAQ,SAAS,cAAc,KAAK;AAC1C,kBAAM,YAAY;AAElB,kBAAM,WAAW,KAAK,eAAe;AAAA,cACnC,OAAO,OAAO,SAAS;AAAA,cACvB,MAAM,OAAO;AAAA,cACb,WAAW,OAAO;AAAA,cAClB,cAAc,OAAO;AAAA,cACrB,cAAc,OAAO;AAAA,cACrB,SAAS,OAAO;AAAA,cAChB,YAAY,OAAO;AAAA,cACnB,YAAY,OAAO;AAAA,YACrB,CAAC;AACD,kBAAM,YAAY,QAAQ;AAE1B,gBAAI,OAAO,SAAS;AAClB,oBAAM,UAAU,KAAK,cAAc,OAAO,OAAO;AACjD,oBAAM,YAAY,OAAO;AAAA,YAC3B;AAEA,kBAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,oBAAQ,YAAY;AACpB,kBAAM,YAAY,OAAO;AAEzB,gBAAI,YAAgC;AACpC,gBAAI,OAAO,eAAe;AACxB,0BAAY,KAAK,gBAAgB;AAAA,gBAC/B,aAAa,OAAO,iBAAiB;AAAA,gBACrC,cAAc,OAAO,kBAAkB;AAAA,cACzC,CAAC;AACD,oBAAM,YAAY,SAAS;AAAA,YAC7B;AAEA,mBAAO,EAAE,OAAO,UAAU,SAAS,UAAU;AAAA,UAC/C;AAAA,QACF;AAEA,QAAC,OAA4D,eAAeA;AAAA,MAC9E,GAAG;AAAA;AAAA;;;AC3OH,MA8Ca;AA9Cb;AAAA;AAAA;AA8CO,MAAM,UAAN,MAAM,SAAQ;AAAA,QAWjB,YAAY,QAAmB;AAC3B,eAAK,KAAK,OAAO,MAAM,KAAK,YAAY;AACxC,eAAK,OAAO,OAAO;AACnB,eAAK,QAAQ,OAAO,SAAS;AAC7B,eAAK,OAAO,OAAO;AACnB,eAAK,eAAe;AACpB,eAAK,UAAU;AACf,eAAK,eAAe,OAAO,WAAW,CAAC;AACvC,eAAK,WAAW,OAAO,YAAY;AAAA,YAC/B,SAAS,KAAK,IAAI;AAAA,YAClB,UAAU,KAAK,IAAI;AAAA,UACvB;AACA,eAAK,YAAY;AAAA,QACrB;AAAA,QAEQ,cAAsB;AAC1B,iBAAO,OAAO,KAAK,IAAI,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;AAAA,QACpF;AAAA;AAAA;AAAA;AAAA,QAKA,gBAAgBC,SAA0B;AACtC,eAAK,eAAeA;AAAA,QACxB;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,YAAyB;AACrB,gBAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,oBAAU,KAAK,GAAG,KAAK,EAAE;AACzB,oBAAU,YAAY;AACtB,oBAAU,cAAc,mBAAmB,KAAK,KAAK;AACrD,eAAK,UAAU;AACf,iBAAO;AAAA,QACX;AAAA;AAAA;AAAA;AAAA,QAKA,SAAe;AACX,cAAI,CAAC,KAAK,SAAS;AACf,iBAAK,UAAU;AAAA,UACnB;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,OAAa;AA5GjB;AA6GQ,cAAI,CAAC,KAAK,SAAS;AACf,iBAAK,OAAO;AAGZ,iBAAI,UAAK,iBAAL,mBAAmB,gBAAgB;AACnC,mBAAK,aAAa,eAAe,YAAY,KAAK,OAAQ;AAAA,YAC9D;AAAA,UACJ;AAEA,cAAI,KAAK,SAAS;AACd,kBAAM,WAAY,OAAe;AACjC,gBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,uBAAS,KAAK,KAAK,OAAO;AAAA,YAC9B,OAAO;AACH,mBAAK,QAAQ,UAAU,OAAO,QAAQ;AAAA,YAC1C;AAAA,UACJ;AACA,eAAK,YAAY;AACjB,eAAK,OAAO;AAAA,QAChB;AAAA;AAAA;AAAA;AAAA,QAKA,OAAa;AACT,cAAI,KAAK,SAAS;AACd,kBAAM,WAAY,OAAe;AACjC,gBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,uBAAS,KAAK,KAAK,OAAO;AAAA,YAC9B,OAAO;AACH,mBAAK,QAAQ,UAAU,IAAI,QAAQ;AAAA,YACvC;AAAA,UACJ;AACA,eAAK,YAAY;AACjB,eAAK,OAAO;AAAA,QAChB;AAAA;AAAA;AAAA;AAAA,QAKU,SAAe;AAAA,QAEzB;AAAA;AAAA;AAAA;AAAA,QAKU,SAAe;AAAA,QAEzB;AAAA;AAAA;AAAA;AAAA,QAKA,SAAS,OAAqB;AAnKlC;AAoKQ,eAAK,QAAQ;AACb,eAAK,SAAS,WAAW,KAAK,IAAI;AAGlC,cAAI,KAAK,cAAc;AACnB,aAAC,gBAAK,cAAqB,gBAA1B;AAAA,UACL;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,mBAAmB,SAAoB;AACnC,eAAK,eAAe;AAAA,YAChB,GAAG,KAAK;AAAA,YACR,GAAG;AAAA,UACP;AACA,eAAK,SAAS,WAAW,KAAK,IAAI;AAClC,eAAK,WAAW;AAAA,QACpB;AAAA;AAAA;AAAA;AAAA,QAKA,YAAsB;AAClB,iBAAO;AAAA,YACH,IAAI,KAAK;AAAA,YACT,MAAM,KAAK;AAAA,YACX,OAAO,KAAK;AAAA,YACZ,MAAM,KAAK;AAAA,YACX,cAAc,KAAK;AAAA,YACnB,SAAS,KAAK,SAAS;AAAA,YACvB,UAAU,KAAK,SAAS,YAAY,KAAK,IAAI;AAAA,UACjD;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,OAAO,YAAY,OAA0B;AACzC,iBAAO,IAAI,SAAQ;AAAA,YACf,IAAI,MAAM;AAAA,YACV,MAAM,MAAM;AAAA,YACZ,OAAO,MAAM;AAAA,YACb,MAAM,MAAM;AAAA,YACZ,SAAS,MAAM;AAAA,YACf,UAAU;AAAA,cACN,SAAS,MAAM;AAAA,cACf,UAAU,MAAM;AAAA,YACpB;AAAA,UACJ,CAAC;AAAA,QACL;AAAA,QAEQ,aAAmB;AA1N/B;AA4NQ,cAAI,KAAK,cAAc;AAEnB,aAAC,gBAAK,cAAqB,eAA1B;AAAA,UACL;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,WAAW,cAAgC;AACvC,cAAI,CAAC,KAAK,gBAAgB,KAAK,iBAAiB,aAAc;AAG9D,eAAK,aAAa,UAAU,KAAK,EAAE;AAGnC,uBAAa,OAAO,IAAI;AAAA,QAC5B;AAAA;AAAA;AAAA;AAAA,QAKA,UAAgB;AACZ,cAAI,KAAK,SAAS;AACd,iBAAK,QAAQ,OAAO;AACpB,iBAAK,UAAU;AAAA,UACnB;AAEA,eAAK,eAAe;AACpB,eAAK,WAAW;AAAA,QACpB;AAAA,MACJ;AAGA,MAAC,OAAe,UAAU;AAAA;AAAA;;;AC9P1B,MAsEa;AAtEb;AAAA;AAAA;AAQA;AA8DO,MAAM,aAAN,MAAM,YAAW;AAAA,QAqBpB,YAAY,QAAsB;AAE9B,eAAK,OAAO,OAAO;AACnB,eAAK,KAAK,OAAO,MAAM,KAAK,YAAY;AACxC,eAAK,UAAU;AACf,eAAK,kBAAkB;AACvB,eAAK,iBAAiB;AACtB,eAAK,WAAW,OAAO,YAAY,KAAK,oBAAoB;AAC5D,eAAK,SAAS;AACd,eAAK,cAAc;AACnB,eAAK,cAAc;AACnB,eAAK,OAAO,oBAAI,IAAI;AACpB,eAAK,cAAc;AACnB,eAAK,WAAW,OAAO,YAAY,CAAC;AACpC,eAAK,YAAY;AAAA,YACb,YAAY;AAAA,YACZ,QAAQ;AAAA,YACR,QAAQ;AAAA,YACR,SAAS;AAAA,YACT,SAAS;AAAA,UACb;AAGA,cAAI,OAAO,MAAM;AACb,mBAAO,KAAK,QAAQ,SAAO,KAAK,OAAO,GAAG,CAAC;AAAA,UAC/C;AAAA,QACJ;AAAA,QAEQ,cAAsB;AAC1B,iBAAO,UAAU,KAAK,IAAI,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;AAAA,QACvF;AAAA,QAEQ,sBAAsC;AAE1C,gBAAM,SAAS,KAAK,OAAO,IAAI,MAAM;AACrC,iBAAO;AAAA,YACH,GAAG,OAAO,aAAa,IAAI,MAAM;AAAA,YACjC,GAAG,OAAO,cAAc,IAAI,MAAM;AAAA,YAClC,OAAO;AAAA,YACP,QAAQ;AAAA,UACZ;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAQA,YAAyB;AAErB,gBAAM,WAAW,SAAS,cAAc,KAAK;AAC7C,mBAAS,KAAK,KAAK;AAEnB,mBAAS,YACL;AACJ,mBAAS,aAAa,QAAQ,QAAQ;AACtC,mBAAS,aAAa,cAAc,OAAO;AAG3C,mBAAS,MAAM,gBAAgB;AAG/B,mBAAS,MAAM,OAAO,GAAG,KAAK,SAAS,CAAC;AACxC,mBAAS,MAAM,MAAM,GAAG,KAAK,SAAS,CAAC;AACvC,mBAAS,MAAM,QAAQ,GAAG,KAAK,SAAS,KAAK;AAC7C,mBAAS,MAAM,SAAS,GAAG,KAAK,SAAS,MAAM;AAC/C,mBAAS,MAAM,SAAS,OAAO,KAAK,MAAM;AAG1C,eAAK,kBAAkB,KAAK,gBAAgB;AAC5C,mBAAS,YAAY,KAAK,eAAe;AAGzC,gBAAM,SAAS,SAAS,cAAc,KAAK;AAC3C,iBAAO,KAAK,GAAG,KAAK,EAAE;AACtB,iBAAO,YAAY;AACnB,mBAAS,YAAY,MAAM;AAG3B,eAAK,iBAAiB,SAAS,cAAc,KAAK;AAClD,eAAK,eAAe,KAAK,GAAG,KAAK,EAAE;AACnC,eAAK,eAAe,YAAY;AAChC,mBAAS,YAAY,KAAK,cAAc;AAExC,eAAK,UAAU;AAGf,eAAK,oBAAoB;AACzB,eAAK,oBAAoB;AACzB,eAAK,sBAAsB;AAG3B,eAAK,2BAA2B;AAGhC,gBAAM,IAAI;AACV,cAAI,EAAE,WAAW,OAAO,EAAE,QAAQ,sBAAsB,YAAY;AAChE,cAAE,QAAQ,kBAAkB,QAAQ;AAAA,UACxC;AAEA,iBAAO;AAAA,QACX;AAAA;AAAA;AAAA;AAAA;AAAA,QAMQ,kBAA+B;AACnC,gBAAM,WAAW,SAAS,cAAc,KAAK;AAC7C,mBAAS,YACL;AAGJ,gBAAM,WAAW,SAAS,cAAc,KAAK;AAC7C,mBAAS,YAAY;AAGrB,gBAAM,WAAW,SAAS,cAAc,QAAQ;AAChD,mBAAS,YAAY;AACrB,mBAAS,QAAQ;AACjB,mBAAS,aAAa,mBAAmB,cAAc;AACvD,mBAAS,YAAY;AACrB,mBAAS,iBAAiB,SAAS,MAAM,KAAK,MAAM,CAAC;AAGrD,gBAAM,SAAS,SAAS,cAAc,KAAK;AAC3C,iBAAO,YAAY;AACnB,iBAAO,QAAQ;AACf,iBAAO,aAAa,mBAAmB,2BAA2B;AAClE,iBAAO,iBAAiB,SAAS,MAAM,KAAK,SAAS,CAAC;AAGtD,gBAAM,SAAS,SAAS,cAAc,KAAK;AAC3C,iBAAO,YAAY;AACnB,iBAAO,QAAQ;AACf,iBAAO,aAAa,mBAAmB,uBAAuB;AAC9D,iBAAO,iBAAiB,SAAS,MAAM,KAAK,eAAe,CAAC;AAE5D,mBAAS,YAAY,QAAQ;AAC7B,mBAAS,YAAY,MAAM;AAC3B,mBAAS,YAAY,MAAM;AAG3B,gBAAM,QAAQ,SAAS,cAAc,IAAI;AACzC,gBAAM,YAAY;AAIlB,gBAAM,UAAU,KAAK,SAAS,gBAAgB,SAAS,KAAK;AAC5D,gBAAM,WAAW,WAAW,OAAO;AACnC,gBAAM,aAAa,aAAa,QAAQ;AACxC,gBAAM,cAAc,KAAK,SAAS,SAAS,KAAK;AAEhD,mBAAS,YAAY,QAAQ;AAC7B,mBAAS,YAAY,KAAK;AAE1B,iBAAO;AAAA,QACX;AAAA;AAAA;AAAA;AAAA;AAAA,QAMQ,sBAA4B;AAChC,cAAI,CAAC,KAAK,gBAAiB;AAE3B,eAAK,gBAAgB,iBAAiB,aAAa,CAAC,MAAkB;AAlQ9E;AAmQY,gBAAK,EAAE,OAAuB,YAAY,SAAU;AAEpD,iBAAK,UAAU,aAAa;AAC5B,iBAAK,UAAU,SAAS,EAAE;AAC1B,iBAAK,UAAU,SAAS,EAAE;AAE1B,kBAAM,QAAO,UAAK,YAAL,mBAAc;AAC3B,gBAAI,MAAM;AACN,mBAAK,UAAU,UAAU,KAAK,UAAU,SAAS,KAAK;AACtD,mBAAK,UAAU,UAAU,KAAK,UAAU,SAAS,KAAK;AAAA,YAC1D;AAEA,cAAE,eAAe;AAAA,UACrB,CAAC;AAED,mBAAS,iBAAiB,aAAa,CAAC,MAAkB;AACtD,gBAAI,CAAC,KAAK,UAAU,cAAc,CAAC,KAAK,QAAS;AAEjD,kBAAM,OAAO,EAAE,UAAU,KAAK,UAAU;AACxC,kBAAM,OAAO,EAAE,UAAU,KAAK,UAAU;AAExC,iBAAK,SAAS,IAAI;AAClB,iBAAK,SAAS,IAAI;AAElB,iBAAK,gBAAgB;AAAA,UACzB,CAAC;AAED,mBAAS,iBAAiB,WAAW,MAAM;AACvC,gBAAI,KAAK,UAAU,YAAY;AAC3B,mBAAK,UAAU,aAAa;AAC5B,mBAAK,WAAW;AAAA,YACpB;AAAA,UACJ,CAAC;AAAA,QACL;AAAA;AAAA;AAAA;AAAA,QAKQ,sBAA4B;AAChC,cAAI,CAAC,KAAK,QAAS;AAGnB,eAAK,QAAQ,iBAAiB,aAAa,MAAM;AAC7C,iBAAK,aAAa;AAAA,UACtB,CAAC;AAAA,QACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAOQ,wBAA8B;AAClC,cAAI,CAAC,KAAK,QAAS;AAGnB,gBAAM,kBAAkB,KAAK,QAAQ,iBAAiB,UAAU;AAChE,0BAAgB,QAAQ,YAAU,OAAO,OAAO,CAAC;AAEjD,gBAAM,eAAe,CAAC,WAAgB;AAClC,kBAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,oBAAQ,UAAU,IAAI,WAAW,WAAW,OAAO,IAAI,EAAE;AACzD,mBAAO,OAAO,QAAQ,OAAO;AAAA,cACzB,UAAU;AAAA,cACV,QAAQ;AAAA,cACR,iBAAiB;AAAA,cACjB,eAAe;AAAA,cACf,aAAa;AAAA,cACb,QAAQ,OAAO;AAAA,cACf,GAAI,OAAO,SAAS,CAAC;AAAA,YACzB,CAAC;AAED,iBAAK,QAAS,YAAY,OAAO;AAEjC,kBAAM,cAAc,CAAC,UAAsB;AACvC,oBAAM,eAAe;AACrB,oBAAM,gBAAgB;AAEtB,mBAAK,aAAa;AAElB,oBAAM,SAAS,MAAM;AACrB,oBAAM,SAAS,MAAM;AACrB,oBAAM,OAAO,KAAK,QAAS,sBAAsB;AACjD,oBAAM,WAAW,OAAO,iBAAiB,KAAK,OAAQ;AACtD,oBAAM,WAAW,WAAW,SAAS,QAAQ,KAAK;AAClD,oBAAM,YAAY,WAAW,SAAS,SAAS,KAAK;AAEpD,kBAAI,YAAY,WAAW,SAAS,IAAI;AACxC,kBAAI,WAAW,WAAW,SAAS,GAAG;AACtC,kBAAI,CAAC,OAAO,SAAS,SAAS,EAAG,aAAY,KAAK;AAClD,kBAAI,CAAC,OAAO,SAAS,QAAQ,EAAG,YAAW,KAAK;AAEhD,oBAAM,aAAa,KAAK;AACxB,oBAAM,cAAc,KAAK;AAGzB,oBAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,qBAAO,OAAO,QAAQ,OAAO;AAAA,gBACzB,UAAU;AAAA,gBACV,KAAK;AAAA,gBACL,MAAM;AAAA,gBACN,OAAO;AAAA,gBACP,QAAQ;AAAA,gBACR,QAAQ;AAAA,gBACR,QAAQ,OAAO;AAAA,gBACf,iBAAiB;AAAA,gBACjB,aAAa;AAAA,cACjB,CAAC;AACD,uBAAS,KAAK,YAAY,OAAO;AAEjC,kBAAI,WAAW;AAEf,oBAAM,YAAY,CAAC,SAAiB,YAAoB;AACpD,oBAAI,CAAC,SAAU;AAEf,uBAAO,sBAAsB,MAAM;AAtXvD;AAuXwB,wBAAM,KAAK,UAAU;AACrB,wBAAM,KAAK,UAAU;AACrB,sBAAI,WAAW;AACf,sBAAI,YAAY;AAChB,sBAAI,UAAU;AACd,sBAAI,SAAS;AAGb,sBAAI,OAAO,WAAW,SAAS,GAAG,EAAG,YAAW,aAAa;AAC7D,sBAAI,OAAO,WAAW,SAAS,GAAG,EAAG,aAAY,cAAc;AAC/D,sBAAI,OAAO,WAAW,SAAS,GAAG,GAAG;AACjC,+BAAW,aAAa;AACxB,8BAAU,YAAY;AAAA,kBAC1B;AACA,sBAAI,OAAO,WAAW,SAAS,GAAG,GAAG;AACjC,gCAAY,cAAc;AAC1B,6BAAS,WAAW;AAAA,kBACxB;AAGA,sBAAI,WAAW,UAAU;AACrB,0BAAM,UAAU,WAAW;AAC3B,wBAAI,OAAO,WAAW,SAAS,GAAG,EAAG,YAAW;AAChD,+BAAW;AAAA,kBACf;AACA,sBAAI,YAAY,WAAW;AACvB,0BAAM,UAAU,YAAY;AAC5B,wBAAI,OAAO,WAAW,SAAS,GAAG,EAAG,WAAU;AAC/C,gCAAY;AAAA,kBAChB;AAGA,wBAAM,WAAU,YAAe,qBAAf,oCAAuC;AACvD,sBAAI,OAAO,WAAW,SAAS,GAAG,KAAK,SAAS,QAAQ;AACpD,0BAAM,YAAY,SAAS;AAC3B,6BAAS;AACT,gCAAY,KAAK,IAAI,WAAW,YAAY,SAAS;AAAA,kBACzD;AAGA,sBAAI,OAAO,WAAW,SAAS,GAAG,KAAK,OAAO,WAAW,SAAS,GAAG,GAAG;AACpE,yBAAK,QAAS,MAAM,QAAQ,KAAK,IAAI,UAAU,QAAQ,IAAI;AAC3D,yBAAK,SAAS,QAAQ,KAAK,IAAI,UAAU,QAAQ;AAAA,kBACrD;AACA,sBAAI,OAAO,WAAW,SAAS,GAAG,KAAK,OAAO,WAAW,SAAS,GAAG,GAAG;AACpE,yBAAK,QAAS,MAAM,SAAS,KAAK,IAAI,WAAW,SAAS,IAAI;AAC9D,yBAAK,SAAS,SAAS,KAAK,IAAI,WAAW,SAAS;AAAA,kBACxD;AACA,sBAAI,OAAO,WAAW,SAAS,GAAG,GAAG;AACjC,yBAAK,QAAS,MAAM,OAAO,UAAU;AACrC,yBAAK,SAAS,IAAI;AAAA,kBACtB;AACA,sBAAI,OAAO,WAAW,SAAS,GAAG,GAAG;AACjC,yBAAK,QAAS,MAAM,MAAM,SAAS;AACnC,yBAAK,SAAS,IAAI;AAAA,kBACtB;AAAA,gBACJ,CAAC;AAAA,cACL;AAEA,oBAAM,aAAa,MAAM;AACrB,oBAAI,CAAC,SAAU;AACf,2BAAW;AACX,wBAAQ,OAAO;AACf,wBAAQ,oBAAoB,aAAa,gBAAgB;AACzD,wBAAQ,oBAAoB,WAAW,cAAc;AACrD,uBAAO,oBAAoB,aAAa,eAAe;AACvD,uBAAO,oBAAoB,WAAW,aAAa;AACnD,uBAAO,oBAAoB,QAAQ,MAAM;AAGzC,qBAAK,WAAW;AAAA,cACpB;AAEA,oBAAM,mBAAmB,CAAC,cACtB,UAAU,UAAU,SAAS,UAAU,OAAO;AAClD,oBAAM,kBAAkB,CAAC,cACrB,UAAU,UAAU,SAAS,UAAU,OAAO;AAClD,oBAAM,iBAAiB,MAAM,WAAW;AACxC,oBAAM,gBAAgB,MAAM,WAAW;AACvC,oBAAM,SAAS,MAAM,WAAW;AAEhC,sBAAQ,iBAAiB,aAAa,gBAAgB;AACtD,sBAAQ,iBAAiB,WAAW,cAAc;AAClD,qBAAO,iBAAiB,aAAa,eAAe;AACpD,qBAAO,iBAAiB,WAAW,aAAa;AAChD,qBAAO,iBAAiB,QAAQ,MAAM;AAAA,YAC1C;AAEA,oBAAQ,iBAAiB,aAAa,WAAW;AAAA,UACrD;AAGA,gBAAM,UAAU;AAAA,YACZ;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,GAAG;AAAA,cAChB,OAAO,EAAE,KAAK,QAAQ,MAAM,QAAQ,OAAO,QAAQ,QAAQ,MAAM;AAAA,YACrE;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,GAAG;AAAA,cAChB,OAAO,EAAE,QAAQ,QAAQ,MAAM,QAAQ,OAAO,QAAQ,QAAQ,MAAM;AAAA,YACxE;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,GAAG;AAAA,cAChB,OAAO,EAAE,MAAM,QAAQ,KAAK,QAAQ,QAAQ,QAAQ,OAAO,MAAM;AAAA,YACrE;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,GAAG;AAAA,cAChB,OAAO,EAAE,OAAO,QAAQ,KAAK,QAAQ,QAAQ,QAAQ,OAAO,MAAM;AAAA,YACtE;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,KAAK,GAAG;AAAA,cACrB,OAAO,EAAE,KAAK,QAAQ,MAAM,QAAQ,OAAO,QAAQ,QAAQ,OAAO;AAAA,YACtE;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,KAAK,GAAG;AAAA,cACrB,OAAO,EAAE,KAAK,QAAQ,OAAO,QAAQ,OAAO,QAAQ,QAAQ,OAAO;AAAA,YACvE;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,KAAK,GAAG;AAAA,cACrB,OAAO,EAAE,QAAQ,QAAQ,MAAM,QAAQ,OAAO,QAAQ,QAAQ,OAAO;AAAA,YACzE;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,YAAY,CAAC,KAAK,GAAG;AAAA,cACrB,OAAO,EAAE,QAAQ,QAAQ,OAAO,QAAQ,OAAO,QAAQ,QAAQ,OAAO;AAAA,YAC1E;AAAA,UACJ;AAEA,kBAAQ,QAAQ,YAAY;AAAA,QAChC;AAAA,QAEQ,kBAAwB;AAC5B,cAAI,CAAC,KAAK,QAAS;AAGnB,eAAK,QAAQ,MAAM,OAAO,GAAG,KAAK,SAAS,CAAC;AAC5C,eAAK,QAAQ,MAAM,MAAM,GAAG,KAAK,SAAS,CAAC;AAAA,QAC/C;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,OAAa;AArhBjB;AAshBQ,cAAI,CAAC,KAAK,SAAS;AACf,iBAAK,UAAU;AACf,qBAAS,KAAK,YAAY,KAAK,OAAQ;AAGvC,gBAAI,KAAK,gBAAgB;AACrB,mBAAK,KAAK,QAAQ,SAAO;AACrB,oBAAI,IAAI,WAAW,CAAC,KAAK,eAAgB,SAAS,IAAI,OAAO,GAAG;AAC5D,uBAAK,eAAgB,YAAY,IAAI,OAAO;AAAA,gBAChD;AAAA,cACJ,CAAC;AAAA,YACL;AAAA,UACJ;AAEA,cAAI,KAAK,SAAS;AACd,kBAAM,WAAY,OAAe;AACjC,gBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,uBAAS,KAAK,KAAK,OAAO;AAAA,YAC9B,OAAO;AACH,mBAAK,QAAQ,UAAU,OAAO,QAAQ;AAAA,YAC1C;AAAA,UACJ;AACA,eAAK,aAAa;AAElB,gBAAM,IAAI;AACV,kBAAE,iCAAF;AACA,kBAAE,yBAAF;AACA,eAAK,WAAW;AAAA,QACpB;AAAA;AAAA;AAAA;AAAA,QAKA,OAAa;AAvjBjB;AAwjBQ,qBAAK,YAAL,mBAAc,UAAU,IAAI;AAE5B,gBAAM,IAAI;AACV,kBAAE,iCAAF;AACA,gBAAM,aAAa,EAAE;AACrB,cAAI,yCAAY,uBAAuB;AACnC,kBAAM,WAAU,gBAAW,0BAAX;AAChB,uBAAW,sBAAsB,OAAO;AAAA,UAC5C;AACA,eAAK,WAAW;AAAA,QACpB;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,QAAc;AAxkBlB;AAykBQ,eAAK,KAAK;AAGV,gBAAM,IAAI;AACV,gBAAM,gBAAgB,iBAAiB;AACvC,wBAAc,aAAa,KAAK,EAAE;AAGlC,cAAI,EAAE,gBAAgB;AAClB,cAAE,eAAe,aAAa,KAAK,EAAE;AAAA,UACzC;AAGA,kBAAE,yBAAF;AAEA,gBAAM,aAAa,EAAE;AACrB,cAAI,yCAAY,uBAAuB;AACnC,kBAAM,WAAU,gBAAW,0BAAX;AAChB,uBAAW,sBAAsB,OAAO;AAAA,UAC5C;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,WAAiB;AACb,eAAK,cAAc;AACnB,eAAK,KAAK;AAAA,QAEd;AAAA;AAAA;AAAA;AAAA,QAKA,iBAAuB;AACnB,eAAK,cAAc,CAAC,KAAK;AAEzB,cAAI,CAAC,KAAK,QAAS;AACnB,gBAAM,WAAW,KAAK,QAAQ,cAAc,KAAK;AACjD,cAAI,CAAC,SAAU;AAEf,cAAI,KAAK,aAAa;AAClB,qBAAS,MAAM,QAAQ;AACvB,qBAAS,MAAM,SAAS;AAAA,UAC5B,OAAO;AACH,qBAAS,MAAM,QAAQ,GAAG,KAAK,SAAS,KAAK;AAC7C,qBAAS,MAAM,SAAS,GAAG,KAAK,SAAS,MAAM;AAAA,UACnD;AAEA,eAAK,WAAW;AAAA,QACpB;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,eAAqB;AAloBzB;AAmoBQ,gBAAM,IAAI;AACV,gBAAM,gBAAgB,iBAAiB;AACvC,wBAAc,aAAa,KAAK,IAAI,KAAK,SAAS,KAAK,OAAO;AAE9D,cAAI,KAAK,SAAS;AACd,kBAAM,WAAW,SAAS,KAAK,QAAQ,MAAM,UAAU,KAAK,EAAE;AAC9D,gBAAI,CAAC,OAAO,MAAM,QAAQ,EAAG,MAAK,SAAS;AAAA,UAC/C;AAGA,wBAAE,mBAAF,mBAAkB,oBAAlB,4BAAoC,KAAK;AACzC,kBAAE,iCAAF;AAEA,gBAAM,aAAa,EAAE;AACrB,cAAI,yCAAY,uBAAuB;AAEnC,kBAAM,WAAU,gBAAW,0BAAX;AAChB,uBAAW,sBAAsB,OAAO;AAAA,UAC5C;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAOA,OAAO,KAAoB;AACvB,eAAK,KAAK,IAAI,IAAI,IAAI,GAAG;AACzB,cAAI,gBAAgB,IAAI;AAGxB,cAAI,CAAC,IAAI,SAAS;AACd,gBAAI,UAAU,IAAI,UAAU;AAAA,UAChC;AAGA,cAAI,IAAI,WAAW,KAAK,gBAAgB;AACpC,iBAAK,eAAe,YAAY,IAAI,OAAO;AAAA,UAC/C;AAGA,cAAI,CAAC,KAAK,aAAa;AACnB,iBAAK,aAAa,IAAI,EAAE;AAAA,UAC5B;AAEA,eAAK,YAAY;AACjB,eAAK,WAAW;AAAA,QACpB;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,UAAU,OAAqB;AAC3B,gBAAM,MAAM,KAAK,KAAK,IAAI,KAAK;AAC/B,cAAI,CAAC,IAAK;AAEV,cAAI,QAAQ;AACZ,eAAK,KAAK,OAAO,KAAK;AAGtB,cAAI,KAAK,gBAAgB,OAAO;AAC5B,kBAAM,gBAAgB,MAAM,KAAK,KAAK,KAAK,KAAK,CAAC;AACjD,iBAAK,cAAc,cAAc,CAAC,KAAK;AACvC,gBAAI,KAAK,aAAa;AAClB,mBAAK,aAAa,KAAK,WAAW;AAAA,YACtC;AAAA,UACJ;AAGA,cAAI,KAAK,KAAK,SAAS,GAAG;AACtB,iBAAK,MAAM;AAAA,UACf,OAAO;AACH,iBAAK,YAAY;AACjB,iBAAK,WAAW;AAAA,UACpB;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,UAAU,OAA+B;AACrC,gBAAM,MAAM,KAAK,KAAK,IAAI,KAAK,KAAK;AACpC,cAAI,CAAC,IAAK,QAAO;AAGjB,cAAI,KAAK;AACT,cAAI,gBAAgB,IAAsB;AAC1C,eAAK,KAAK,OAAO,KAAK;AAGtB,cAAI,KAAK,gBAAgB,OAAO;AAC5B,kBAAM,YAAY,MAAM,KAAK,KAAK,KAAK,KAAK,CAAC;AAC7C,iBAAK,cAAc,UAAU,CAAC,KAAK;AACnC,gBAAI,KAAK,YAAa,MAAK,aAAa,KAAK,WAAW;AAAA,UAC5D;AAEA,cAAI,KAAK,KAAK,SAAS,GAAG;AACtB,iBAAK,MAAM;AAAA,UACf,OAAO;AACH,iBAAK,YAAY;AACjB,iBAAK,WAAW;AAAA,UACpB;AAEA,iBAAO;AAAA,QACX;AAAA;AAAA;AAAA;AAAA,QAKA,cAAc,QAAoB,OAAqB;AACnD,gBAAM,MAAM,KAAK,UAAU,KAAK;AAChC,cAAI,KAAK;AACL,mBAAO,OAAO,GAAG;AACjB,mBAAO,aAAa,IAAI,EAAE;AAAA,UAC9B;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,aAAa,OAAqB;AAC9B,gBAAM,MAAM,KAAK,KAAK,IAAI,KAAK;AAC/B,cAAI,CAAC,IAAK;AAGV,eAAK,KAAK,QAAQ,CAAAC,OAAKA,GAAE,KAAK,CAAC;AAG/B,eAAK,cAAc;AACnB,cAAI,KAAK;AAET,eAAK,YAAY;AACjB,eAAK,WAAW;AAAA,QACpB;AAAA;AAAA;AAAA;AAAA;AAAA,QAMU,cAAoB;AAhxBlC;AAkxBQ,gBAAM,UAAS,UAAK,YAAL,mBAAc,cAAc,IAAI,KAAK,EAAE;AACtD,cAAI,CAAC,OAAQ;AAEb,iBAAO,YAAY;AAEnB,eAAK,KAAK,QAAQ,SAAO;AACrB,kBAAM,QAAQ,SAAS,cAAc,QAAQ;AAC7C,kBAAM,YAAY,qBAAqB,IAAI,OAAO,KAAK,cAAc,8BAA8B,8BAA8B;AACjI,kBAAM,cAAc,IAAI;AACxB,kBAAM,iBAAiB,SAAS,MAAM,KAAK,aAAa,IAAI,EAAE,CAAC;AAE/D,mBAAO,YAAY,KAAK;AAAA,UAC5B,CAAC;AAAA,QACL;AAAA;AAAA;AAAA;AAAA,QAKA,YAAyB;AACrB,iBAAO;AAAA,YACH,IAAI,KAAK;AAAA,YACT,MAAM,KAAK;AAAA,YACX,UAAU,EAAE,GAAG,KAAK,SAAS;AAAA,YAC7B,QAAQ,KAAK;AAAA,YACb,aAAa,KAAK;AAAA,YAClB,aAAa,KAAK;AAAA,YAClB,aAAa,KAAK;AAAA,YAClB,MAAM,MAAM,KAAK,KAAK,KAAK,KAAK,CAAC;AAAA,YACjC,SAAS,KAAK,SAAS,WAAW,KAAK,IAAI;AAAA,YAC3C,UAAU,KAAK,IAAI;AAAA,UACvB;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,OAAO,YAAY,OAAgC;AAC/C,gBAAMC,UAAS,IAAI,YAAW;AAAA,YAC1B,IAAI,MAAM;AAAA,YACV,MAAM,MAAM;AAAA,YACZ,UAAU,MAAM;AAAA,YAChB,UAAU;AAAA,cACN,SAAS,MAAM;AAAA,YACnB;AAAA,UACJ,CAAC;AAED,UAAAA,QAAO,SAAS,MAAM;AACtB,UAAAA,QAAO,cAAc,MAAM;AAC3B,UAAAA,QAAO,cAAc,MAAM;AAC3B,UAAAA,QAAO,cAAc,MAAM;AAE3B,iBAAOA;AAAA,QACX;AAAA,QAEQ,aAAmB;AAz0B/B;AA00BQ,gBAAM,IAAI;AAGV,cAAI,EAAE,2BAA2B;AAC7B,cAAE,0BAA0B,YAAY;AAAA,UAC5C;AAGA,cAAI,EAAE,gBAAgB;AAClB,0BAAE,gBAAe,oBAAjB,4BAAmC,KAAK,UAAU;AAAA,UACtD;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,UAAgB;AA31BpB;AA61BQ,eAAK,KAAK,QAAQ,SAAO,IAAI,QAAQ,CAAC;AACtC,eAAK,KAAK,MAAM;AAGhB,cAAI,KAAK,SAAS;AACd,iBAAK,QAAQ,OAAO;AACpB,iBAAK,UAAU;AAAA,UACnB;AAEA,eAAK,WAAW;AAEhB,gBAAM,IAAI;AACV,kBAAE,iCAAF;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAOQ,6BAAmC;AACvC,gBAAM,IAAI;AACV,gBAAM,KAAK,EAAE;AACb,cAAI,CAAC,MAAM,OAAO,GAAG,cAAc,cAAc,OAAO,GAAG,aAAa,WAAY;AACpF,cAAI,GAAG,UAAU,KAAK,EAAE,EAAG;AAG3B,gBAAM,MAA4D;AAAA,YAC9D,QAAQ,EAAE,YAAY,mBAAmB,MAAM,mBAAmB;AAAA,YAClE,eAAe,EAAE,YAAY,iBAAiB,MAAM,oBAAoB;AAAA,YACxE,UAAU,EAAE,YAAY,qBAAqB,MAAM,qBAAqB;AAAA,UAC5E;AACA,gBAAM,OAAO,IAAI,KAAK,IAAI,KAAK,EAAE,YAAY,oBAAoB,MAAM,mBAAmB;AAE1F,cAAI;AACA,eAAG,SAAS;AAAA,cACR,IAAI,KAAK;AAAA,cACT,MAAM;AAAA,cACN,YAAY,KAAK;AAAA,cACjB,MAAM,KAAK;AAAA,cACX,eAAe;AAAA,cACf,UAAU;AAAA;AAAA,cAEV;AAAA,YACJ,CAAC;AACD,gBAAI,OAAO,GAAG,sBAAsB,YAAY;AAC5C,iBAAG,kBAAkB,KAAK,IAAI;AAAA,gBAC1B,MAAM,MAAM,KAAK,KAAK;AAAA,gBACtB,OAAO,MAAM,KAAK,KAAK;AAAA,gBACvB,cAAc,MAAM,KAAK,aAAa;AAAA,cAC1C,CAAC;AAAA,YACL;AAAA,UACJ,SAAS,GAAG;AACR,oBAAQ,KAAK,uCAAuC,KAAK,IAAI,CAAC;AAAA,UAClE;AAAA,QACJ;AAAA,MACJ;AAGA,MAAC,OAAe,aAAa;AAAA;AAAA;;;ACx5B7B,MAkBM,gBAkPA,UAUC;AA9QP;AAAA;AAAA;AAOA;AAWA,MAAM,iBAAN,MAAqB;AAAA,QAOjB,cAAc;AAFd,eAAQ,gBAAgB,iBAAiB;AAGrC,eAAK,UAAU,oBAAI,IAAI;AAGvB,eAAK,aAAaC;AAClB,eAAK,cAAc;AACnB,eAAK,iBAAiB;AAAA,QAC1B;AAAA;AAAA;AAAA;AAAA,QAKQ,+BAAqC;AArCjD;AAsCQ,gBAAM,IAAI;AACV,gBAAM,cAAa,aAAE,kBAAF,mBAAiB,iBAAjB;AACnB,cAAI,OAAO,eAAe,UAAU;AAChC,iBAAK,aAAa,KAAK,cAAc,gBAAgB,UAAU;AAAA,UACnE,OAAO;AACH,iBAAK,aAAa,KAAK,cAAc,aAAa;AAAA,UACtD;AAAA,QACJ;AAAA,QAEA,OAAa;AACT,cAAI,KAAK,YAAa;AAGtB,eAAK,6BAA6B;AAGlC,mBAAS,iBAAiB,aAAa,CAAC,MAAkB;AACtD,kBAAM,SAAS,EAAE;AACjB,kBAAM,QAAQ,OAAO,QAAQ,QAAQ;AACrC,gBAAI,OAAO;AACP,oBAAM,WAAW,MAAM;AACvB,oBAAMC,UAAS,KAAK,QAAQ,IAAI,QAAQ;AACxC,kBAAIA,SAAQ;AACR,gBAAAA,QAAO,aAAa;AAAA,cACxB;AAAA,YACJ;AAAA,UACJ,CAAC;AAED,eAAK,cAAc;AAAA,QACvB;AAAA;AAAA;AAAA;AAAA,QAKA,eAAeA,SAA0B;AACrC,eAAK,QAAQ,IAAIA,QAAO,IAAIA,OAAM;AAClC,kBAAQ,IAAI,uCAAuCA,QAAO,EAAE,WAAWA,QAAO,IAAI,GAAG;AAErF,cAAI,CAAC,KAAK,eAAgB,MAAK,iBAAiBA,QAAO;AAAA,QAC3D;AAAA;AAAA;AAAA;AAAA,QAKA,aAAa,UAAwB;AACjC,gBAAMA,UAAS,KAAK,QAAQ,IAAI,QAAQ;AACxC,cAAIA,SAAQ;AACR,YAAAA,QAAO,QAAQ;AACf,iBAAK,QAAQ,OAAO,QAAQ;AAC5B,oBAAQ,IAAI,oCAAoC,QAAQ,EAAE;AAE1D,gBAAI,KAAK,mBAAmB,UAAU;AAClC,oBAAM,MAAM,KAAK,aAAa;AAC9B,mBAAK,iBAAiB,MAAM,IAAI,KAAK;AAAA,YACzC;AAAA,UACJ;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,UAAU,UAAqC;AAC3C,iBAAO,KAAK,QAAQ,IAAI,QAAQ,KAAK;AAAA,QACzC;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,cAAc,MAA6B;AACvC,gBAAM,aAAa,MAAM,KAAK,KAAK,QAAQ,OAAO,CAAC;AACnD,iBAAO,OAAO,WAAW,OAAO,OAAK,EAAE,SAAS,IAAI,IAAI;AAAA,QAC5D;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,iBAAiB,MAA4B;AACzC,iBAAO,KAAK,cAAc,IAAI;AAAA,QAClC;AAAA;AAAA;AAAA;AAAA,QAKA,gBAAwB;AAEpB,eAAK,6BAA6B;AAClC,eAAK,aAAa,KAAK,cAAc,WAAW;AAChD,iBAAO,KAAK;AAAA,QAChB;AAAA;AAAA;AAAA;AAAA,QAKA,eAAuB;AACnB,eAAK,aAAa,KAAK,cAAc,aAAa;AAClD,iBAAO,KAAK;AAAA,QAChB;AAAA;AAAA;AAAA;AAAA,QAKA,gBAAgB,WAAyB;AACrC,eAAK,aAAa,KAAK,cAAc,gBAAgB,SAAS;AAAA,QAClE;AAAA;AAAA;AAAA;AAAA,QAKA,sBAAsB,MAAoB;AACtC,gBAAM,UAAU,KAAK,iBAAiB,IAAI;AAC1C,kBAAQ,QAAQ,CAAAA,YAAUA,QAAO,MAAM,CAAC;AAAA,QAC5C;AAAA;AAAA;AAAA;AAAA,QAKA,kBAAwB;AACpB,gBAAM,UAAU,MAAM,KAAK,KAAK,QAAQ,OAAO,CAAC;AAChD,kBAAQ,QAAQ,CAAAA,YAAUA,QAAO,MAAM,CAAC;AAAA,QAC5C;AAAA;AAAA;AAAA;AAAA,QAKA,eAAkC;AAC9B,gBAAM,QAAQ,KAAK,cAAc,eAAe;AAChD,cAAI,OAAO;AACP,kBAAM,MAAM,KAAK,QAAQ,IAAI,KAAK;AAClC,gBAAI,IAAK,QAAO;AAAA,UACpB;AACA,gBAAM,UAAU,MAAM,KAAK,KAAK,QAAQ,OAAO,CAAC;AAChD,cAAI,QAAQ,WAAW,EAAG,QAAO;AAEjC,iBAAO,QAAQ,OAAO,CAAC,KAAK,YAAY;AACpC,mBAAO,QAAQ,SAAS,IAAI,SAAS,UAAU;AAAA,UACnD,CAAC;AAAA,QACL;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,gBAAgB,UAA+B;AAC3C,eAAK,iBAAiB;AAAA,QAC1B;AAAA;AAAA;AAAA;AAAA,QAKA,kBAAqC;AACjC,cAAI,CAAC,KAAK,eAAgB,QAAO;AACjC,iBAAO,KAAK,QAAQ,IAAI,KAAK,cAAc,KAAK;AAAA,QACpD;AAAA;AAAA;AAAA;AAAA,QAKA,eAA8B;AAC1B,iBAAO,MAAM,KAAK,KAAK,QAAQ,OAAO,CAAC,EAAE,IAAI,OAAK,EAAE,UAAU,CAAC;AAAA,QACnE;AAAA;AAAA;AAAA;AAAA,QAKA,mBAAmB,QAA6B;AAC5C,iBAAO,QAAQ,WAAS;AAGpB,oBAAQ,IAAI,mCAAmC,MAAM,EAAE,WAAW,MAAM,IAAI,GAAG;AAAA,UACnF,CAAC;AAAA,QACL;AAAA;AAAA;AAAA;AAAA,QAKA,eAAe,MAAuB;AAClC,cAAI,MAAM;AACN,mBAAO,KAAK,iBAAiB,IAAI,EAAE;AAAA,UACvC;AACA,iBAAO,KAAK,QAAQ;AAAA,QACxB;AAAA;AAAA;AAAA;AAAA,QAKA,iBAA0B;AACtB,iBAAO,KAAK,QAAQ,OAAO;AAAA,QAC/B;AAAA;AAAA;AAAA;AAAA,QAKA,kBAAkB,OAAkC;AAChD,qBAAWA,WAAU,KAAK,QAAQ,OAAO,GAAG;AACxC,gBAAIA,QAAO,KAAK,IAAI,KAAK,GAAG;AACxB,qBAAOA;AAAA,YACX;AAAA,UACJ;AACA,iBAAO;AAAA,QACX;AAAA;AAAA;AAAA;AAAA,QAKA,kBAAwB;AACpB,kBAAQ,IAAI,kCAAkC;AAAA,YAC1C,OAAO,KAAK,QAAQ;AAAA,YACpB,SAAS,MAAM,KAAK,KAAK,QAAQ,OAAO,CAAC,EAAE,IAAI,QAAM;AAAA,cACjD,IAAI,EAAE;AAAA,cACN,MAAM,EAAE;AAAA,cACR,MAAM,EAAE,KAAK;AAAA,cACb,QAAQ,EAAE;AAAA,cACV,WAAW,EAAE;AAAA,cACb,WAAW,EAAE;AAAA,YACjB,EAAE;AAAA,UACN,CAAC;AAAA,QACL;AAAA,MACJ;AAGA,MAAM,WAAW,IAAI,eAAe;AACpC,MAAC,OAAe,iBAAiB;AAGjC,UAAI,SAAS,eAAe,WAAW;AACnC,iBAAS,iBAAiB,oBAAoB,MAAM,SAAS,KAAK,CAAC;AAAA,MACvE,OAAO;AACH,iBAAS,KAAK;AAAA,MAClB;AAEA,MAAO,0BAAQ;AAAA;AAAA;;;AC9Qf,MAyDM,0BAolBO;AA7oBb;AAAA;AAAA;AAeA;AA0CA,MAAM,2BAAN,MAA+B;AAAA,QAW3B,cAAc;AATd,eAAQ,YAA0B,CAAC;AACnC,eAAiB,cAAc;AAC/B,eAAiB,kBAAkB;AACnC;AAAA,eAAQ,cAA6B;AAOjC,eAAK,OAAO,KAAK,uBAAuB;AACxC,eAAK,KAAK;AAAA,QACd;AAAA,QAPQ,mBAA2C;AAC/C,iBAAO,KAAK,KAAK,GAAG,EAAE;AAAA,QAC1B;AAAA;AAAA;AAAA;AAAA,QAWQ,yBAAyC;AAC7C,gBAAM,OAAM,oBAAI,KAAK,GAAE,YAAY;AAEnC,iBAAO;AAAA,YACH,KAAK;AAAA,cACD,MAAM;AAAA,cACN,MAAM;AAAA,cACN,SAAS;AAAA,cACT,UAAU;AAAA,cACV,UAAU;AAAA,gBACN,MAAM;AAAA,kBACF,MAAM;AAAA,kBACN,MAAM;AAAA,kBACN,SAAS;AAAA,kBACT,UAAU;AAAA,kBACV,UAAU;AAAA,oBACN,QAAQ;AAAA,sBACJ,MAAM;AAAA,sBACN,MAAM;AAAA,sBACN,SAAS;AAAA,sBACT,UAAU;AAAA,sBACV,UAAU;AAAA,wBACN,YAAY;AAAA,0BACR,MAAM;AAAA,0BACN,MAAM;AAAA,0BACN,SACI;AAAA,0BACJ,MAAM;AAAA,0BACN,SAAS;AAAA,0BACT,UAAU;AAAA,wBACd;AAAA,wBACA,aAAa;AAAA,0BACT,MAAM;AAAA,0BACN,MAAM;AAAA,0BACN,SACI;AAAA,0BACJ,MAAM;AAAA,0BACN,SAAS;AAAA,0BACT,UAAU;AAAA,wBACd;AAAA,wBACA,WAAW;AAAA,0BACP,MAAM;AAAA,0BACN,MAAM;AAAA,0BACN,SAAS;AAAA,0BACT,UAAU;AAAA,0BACV,UAAU;AAAA,4BACN,aAAa;AAAA,8BACT,MAAM;AAAA,8BACN,MAAM;AAAA,8BACN,SAAS;AAAA,8BACT,MAAM;AAAA,8BACN,SAAS;AAAA,8BACT,UAAU;AAAA,4BACd;AAAA,0BACJ;AAAA,wBACJ;AAAA,wBACA,WAAW;AAAA,0BACP,MAAM;AAAA,0BACN,MAAM;AAAA,0BACN,SAAS;AAAA,0BACT,UAAU;AAAA,0BACV,UAAU,CAAC;AAAA,wBACf;AAAA,wBACA,UAAU;AAAA,0BACN,MAAM;AAAA,0BACN,MAAM;AAAA,0BACN,SAAS;AAAA,0BACT,UAAU;AAAA,0BACV,UAAU,CAAC;AAAA,wBACf;AAAA,wBACA,UAAU;AAAA,0BACN,MAAM;AAAA,0BACN,MAAM;AAAA,0BACN,SAAS;AAAA,0BACT,UAAU;AAAA,0BACV,UAAU,CAAC;AAAA,wBACf;AAAA,sBACJ;AAAA,oBACJ;AAAA,kBACJ;AAAA,gBACJ;AAAA,gBACA,KAAK;AAAA,kBACD,MAAM;AAAA,kBACN,MAAM;AAAA,kBACN,SAAS;AAAA,kBACT,UAAU;AAAA,kBACV,UAAU;AAAA,oBACN,OAAO;AAAA,sBACH,MAAM;AAAA,sBACN,MAAM;AAAA,sBACN,SACI;AAAA,sBACJ,MAAM;AAAA,sBACN,SAAS;AAAA,sBACT,UAAU;AAAA,oBACd;AAAA,kBACJ;AAAA,gBACJ;AAAA,gBACA,KAAK;AAAA,kBACD,MAAM;AAAA,kBACN,MAAM;AAAA,kBACN,SAAS;AAAA,kBACT,UAAU;AAAA,kBACV,UAAU;AAAA,oBACN,KAAK;AAAA,sBACD,MAAM;AAAA,sBACN,MAAM;AAAA,sBACN,SAAS;AAAA,sBACT,UAAU;AAAA,sBACV,UAAU,CAAC;AAAA,oBACf;AAAA,oBACA,OAAO;AAAA,sBACH,MAAM;AAAA,sBACN,MAAM;AAAA,sBACN,SAAS;AAAA,sBACT,UAAU;AAAA,sBACV,UAAU;AAAA,wBACN,KAAK;AAAA,0BACD,MAAM;AAAA,0BACN,MAAM;AAAA,0BACN,SAAS;AAAA,0BACT,UAAU;AAAA,0BACV,UAAU;AAAA,4BACN,QAAQ;AAAA,8BACJ,MAAM;AAAA,8BACN,MAAM;AAAA,8BACN,SACI;AAAA,8BACJ,MAAM;AAAA,8BACN,SAAS;AAAA,8BACT,UAAU;AAAA,4BACd;AAAA,0BACJ;AAAA,wBACJ;AAAA,sBACJ;AAAA,oBACJ;AAAA,kBACJ;AAAA,gBACJ;AAAA,gBACA,KAAK;AAAA,kBACD,MAAM;AAAA,kBACN,MAAM;AAAA,kBACN,SAAS;AAAA,kBACT,UAAU;AAAA,kBACV,UAAU;AAAA,oBACN,KAAK;AAAA,sBACD,MAAM;AAAA,sBACN,MAAM;AAAA,sBACN,SAAS;AAAA,sBACT,UAAU;AAAA,sBACV,UAAU,CAAC;AAAA,oBACf;AAAA,oBACA,KAAK;AAAA,sBACD,MAAM;AAAA,sBACN,MAAM;AAAA,sBACN,SAAS;AAAA,sBACT,UAAU;AAAA,sBACV,UAAU,CAAC;AAAA,oBACf;AAAA,kBACJ;AAAA,gBACJ;AAAA,gBACA,KAAK;AAAA,kBACD,MAAM;AAAA,kBACN,MAAM;AAAA,kBACN,SAAS;AAAA,kBACT,UAAU;AAAA,kBACV,UAAU,CAAC;AAAA,gBACf;AAAA,cACJ;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAMA,OAAa;AACT,cAAI;AACA,kBAAM,SAAS,QAA+B,KAAK,aAAa,IAAI;AAEpE,gBAAI,UAAU,OAAO,KAAK,MAAM,EAAE,SAAS,GAAG;AAC1C,mBAAK,OAAO;AACZ,sBAAQ,IAAI,sCAAsC;AAAA,YACtD,OAAO;AAEH,mBAAK,OAAO,KAAK,uBAAuB;AACxC,sBAAQ,IAAI,uDAAuD;AAAA,YACvE;AAAA,UACJ,SAAS,OAAO;AACZ,oBAAQ,MAAM,+BAA+B,KAAK;AAElD,iBAAK,OAAO,KAAK,uBAAuB;AAAA,UAC5C;AAAA,QACJ;AAAA,QAEQ,eAAqB;AACzB,cAAI,KAAK,gBAAgB,MAAM;AAC3B,mBAAO,aAAa,KAAK,WAAW;AAAA,UACxC;AAEA,eAAK,cAAc,OAAO,WAAW,MAAM;AACvC,iBAAK,KAAK;AACV,iBAAK,cAAc;AAAA,UACvB,GAAG,KAAK,eAAe;AAAA,QAC3B;AAAA,QAEQ,OAAa;AACjB,cAAI;AACA,oBAAQ,KAAK,aAAa,KAAK,IAAI;AACnC,oBAAQ,IAAI,mCAAmC;AAAA,UACnD,SAAS,OAAO;AACZ,oBAAQ,MAAM,+BAA+B,KAAK;AAAA,UACtD;AAAA,QACJ;AAAA,QAEA,YAAkB;AACd,cAAI,KAAK,gBAAgB,MAAM;AAC3B,mBAAO,aAAa,KAAK,WAAW;AACpC,iBAAK,cAAc;AAAA,UACvB;AACA,eAAK,KAAK;AAAA,QACd;AAAA;AAAA;AAAA;AAAA,QAMA,iBAAiB,UAA4B;AACzC,eAAK,UAAU,KAAK,QAAQ;AAAA,QAChC;AAAA,QAEA,oBAAoB,UAA4B;AAC5C,gBAAM,QAAQ,KAAK,UAAU,QAAQ,QAAQ;AAC7C,cAAI,UAAU,IAAI;AACd,iBAAK,UAAU,OAAO,OAAO,CAAC;AAAA,UAClC;AAAA,QACJ;AAAA,QAEQ,KAAK,OAAsB;AAC/B,eAAK,UAAU,QAAQ,cAAY;AAC/B,gBAAI;AACA,uBAAS,KAAK;AAAA,YAClB,SAAS,OAAO;AACZ,sBAAQ,MAAM,+BAA+B,KAAK;AAAA,YACtD;AAAA,UACJ,CAAC;AAAA,QACL;AAAA;AAAA;AAAA;AAAA,QAMQ,UAAU,MAAmC;AACjD,cAAI,MAAM,QAAQ,IAAI,GAAG;AACrB,mBAAO;AAAA,UACX;AACA,iBAAO,KAAK,MAAM,GAAG,EAAE,OAAO,OAAK,EAAE,SAAS,CAAC;AAAA,QACnD;AAAA,QAEA,cAAc,MAAiC;AAC3C,iBAAO,KAAK,UAAU,IAAI,EAAE,KAAK,GAAG;AAAA,QACxC;AAAA,QAEA,SAAS,MAAwC;AAC7C,gBAAM,QAAQ,KAAK,UAAU,IAAI;AAGjC,cAAI,MAAM,WAAW,GAAG;AACpB,mBAAO;AAAA,UACX;AAGA,gBAAM,aAAa,KAAK,KAAK,GAAG;AAChC,cAAI,CAAC,cAAc,WAAW,SAAS,UAAU;AAC7C,mBAAO;AAAA,UACX;AAEA,cAAI,UAAkC,WAAW;AACjD,cAAI,WAA0B;AAE9B,qBAAW,QAAQ,OAAO;AACtB,kBAAM,OAAO,QAAQ,IAAI;AACzB,gBAAI,CAAC,MAAM;AACP,qBAAO;AAAA,YACX;AAEA,uBAAW;AAEX,gBAAI,KAAK,SAAS,UAAU;AACxB,wBAAU,KAAK;AAAA,YACnB,OAAO;AAEH,qBAAO;AAAA,YACX;AAAA,UACJ;AAEA,iBAAO;AAAA,QACX;AAAA;AAAA;AAAA;AAAA,QAMA,OAAO,MAAkC;AACrC,iBAAO,KAAK,SAAS,IAAI,MAAM;AAAA,QACnC;AAAA,QAEA,IAAI,MAAwC;AACxC,iBAAO,KAAK,SAAS,IAAI;AAAA,QAC7B;AAAA,QAEA,UAAU,MAA4C;AAClD,gBAAM,OAAO,KAAK,SAAS,IAAI;AAC/B,kBAAO,6BAAM,UAAS,WAAW,OAAO;AAAA,QAC5C;AAAA,QAEA,QAAQ,MAA0C;AAC9C,gBAAM,OAAO,KAAK,SAAS,IAAI;AAC/B,kBAAO,6BAAM,UAAS,SAAS,OAAO;AAAA,QAC1C;AAAA,QAEA,KAAK,OAA0B,CAAC,GAA2B;AACvD,gBAAM,QAAQ,KAAK,UAAU,IAAI;AAGjC,cAAI,MAAM,WAAW,GAAG;AACpB,kBAAM,aAAa,KAAK,KAAK,GAAG;AAChC,oBAAO,yCAAY,aAAY,CAAC;AAAA,UACpC;AAEA,gBAAM,SAAS,KAAK,UAAU,IAAI;AAClC,kBAAO,iCAAQ,aAAY,CAAC;AAAA,QAChC;AAAA,QAEA,SAAS,MAAwC;AAC7C,gBAAM,OAAO,KAAK,QAAQ,IAAI;AAC9B,kBAAO,6BAAM,YAAW;AAAA,QAC5B;AAAA;AAAA;AAAA;AAAA,QAMA,WAAW,MAAyB,UAAU,IAAI,OAAO,aAAe;AACpE,gBAAM,QAAQ,KAAK,UAAU,IAAI;AAEjC,cAAI,MAAM,WAAW,GAAG;AACpB,mBAAO;AAAA,UACX;AAEA,gBAAM,WAAW,MAAM,MAAM,SAAS,CAAC;AACvC,gBAAM,aAAa,MAAM,MAAM,GAAG,EAAE;AAEpC,gBAAM,SAAS,WAAW,SAAS,IAAI,KAAK,UAAU,UAAU,IAAI;AACpE,gBAAM,aAAoC,iCAAQ,aAAY,KAAK,iBAAiB;AAEpF,cAAI,UAAU,QAAQ,GAAG;AACrB,oBAAQ,KAAK,oCAAoC,KAAK,cAAc,IAAI,CAAC;AACzE,mBAAO;AAAA,UACX;AAEA,gBAAM,OAAM,oBAAI,KAAK,GAAE,YAAY;AACnC,gBAAM,OAAiB;AAAA,YACnB,MAAM;AAAA,YACN;AAAA,YACA;AAAA,YACA,MAAM,QAAQ;AAAA,YACd,SAAS;AAAA,YACT,UAAU;AAAA,UACd;AAEA,oBAAU,QAAQ,IAAI;AAEtB,cAAI,QAAQ;AACR,mBAAO,WAAW;AAAA,UACtB;AAEA,eAAK,aAAa;AAClB,eAAK,KAAK,EAAE,MAAM,UAAU,MAAM,KAAK,cAAc,IAAI,GAAG,MAAM,KAAK,CAAC;AAExE,iBAAO;AAAA,QACX;AAAA,QAEA,aAAa,MAAyB,OAAO,aAAe;AACxD,gBAAM,QAAQ,KAAK,UAAU,IAAI;AAEjC,cAAI,MAAM,WAAW,GAAG;AACpB,mBAAO;AAAA,UACX;AAEA,gBAAM,aAAa,MAAM,MAAM,SAAS,CAAC;AACzC,gBAAM,aAAa,MAAM,MAAM,GAAG,EAAE;AAEpC,gBAAM,SAAS,WAAW,SAAS,IAAI,KAAK,UAAU,UAAU,IAAI;AACpE,gBAAM,aAAoC,iCAAQ,aAAY,KAAK,iBAAiB;AAEpF,cAAI,UAAU,UAAU,GAAG;AACvB,oBAAQ,KAAK,sCAAsC,KAAK,cAAc,IAAI,CAAC;AAC3E,mBAAO;AAAA,UACX;AAEA,gBAAM,OAAM,oBAAI,KAAK,GAAE,YAAY;AACnC,gBAAM,SAAqB;AAAA,YACvB,MAAM;AAAA,YACN;AAAA,YACA,UAAU,CAAC;AAAA,YACX,SAAS;AAAA,YACT,UAAU;AAAA,UACd;AAEA,oBAAU,UAAU,IAAI;AAExB,cAAI,QAAQ;AACR,mBAAO,WAAW;AAAA,UACtB;AAEA,eAAK,aAAa;AAClB,eAAK,KAAK,EAAE,MAAM,UAAU,MAAM,KAAK,cAAc,IAAI,GAAG,MAAM,OAAO,CAAC;AAE1E,iBAAO;AAAA,QACX;AAAA,QAEA,UAAU,MAAyB,SAA0B;AACzD,gBAAM,OAAO,KAAK,QAAQ,IAAI;AAE9B,cAAI,CAAC,MAAM;AACP,oBAAQ,KAAK,+BAA+B,KAAK,cAAc,IAAI,CAAC;AACpE,mBAAO;AAAA,UACX;AAEA,eAAK,UAAU;AACf,eAAK,OAAO,QAAQ;AACpB,eAAK,YAAW,oBAAI,KAAK,GAAE,YAAY;AAEvC,eAAK,aAAa;AAClB,eAAK,KAAK,EAAE,MAAM,UAAU,MAAM,KAAK,cAAc,IAAI,GAAG,MAAM,KAAK,CAAC;AAExE,iBAAO;AAAA,QACX;AAAA,QAEA,OAAO,MAAkC;AACrC,gBAAM,QAAQ,KAAK,UAAU,IAAI;AAEjC,cAAI,MAAM,WAAW,GAAG;AACpB,mBAAO;AAAA,UACX;AAEA,gBAAM,WAAW,MAAM,MAAM,SAAS,CAAC;AACvC,gBAAM,aAAa,MAAM,MAAM,GAAG,EAAE;AAEpC,gBAAM,SAAS,WAAW,SAAS,IAAI,KAAK,UAAU,UAAU,IAAI;AACpE,gBAAM,aAAoC,iCAAQ,aAAY,KAAK,iBAAiB;AAEpF,cAAI,CAAC,UAAU,QAAQ,GAAG;AACtB,oBAAQ,KAAK,+BAA+B,KAAK,cAAc,IAAI,CAAC;AACpE,mBAAO;AAAA,UACX;AAEA,gBAAM,OAAO,UAAU,QAAQ;AAC/B,iBAAO,UAAU,QAAQ;AAEzB,cAAI,QAAQ;AACR,mBAAO,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,UAC7C;AAEA,eAAK,aAAa;AAClB,eAAK,KAAK,EAAE,MAAM,UAAU,MAAM,KAAK,cAAc,IAAI,GAAG,KAAK,CAAC;AAElE,iBAAO;AAAA,QACX;AAAA,QAEA,OAAO,SAA4B,SAA0B;AACzD,gBAAM,QAAQ,KAAK,UAAU,OAAO;AAEpC,cAAI,MAAM,WAAW,GAAG;AACpB,mBAAO;AAAA,UACX;AAEA,gBAAM,UAAU,MAAM,MAAM,SAAS,CAAC;AACtC,gBAAM,aAAa,MAAM,MAAM,GAAG,EAAE;AAEpC,gBAAM,SAAS,WAAW,SAAS,IAAI,KAAK,UAAU,UAAU,IAAI;AACpE,gBAAM,aAAoC,iCAAQ,aAAY,KAAK,iBAAiB;AAEpF,cAAI,CAAC,UAAU,OAAO,GAAG;AACrB,oBAAQ,KAAK,+BAA+B,KAAK,cAAc,OAAO,CAAC;AACvE,mBAAO;AAAA,UACX;AAEA,cAAI,UAAU,OAAO,GAAG;AACpB,oBAAQ,KAAK,2CAA2C,OAAO;AAC/D,mBAAO;AAAA,UACX;AAEA,gBAAM,OAAO,UAAU,OAAO;AAC9B,oBAAU,OAAO,IAAI;AACrB,iBAAO,UAAU,OAAO;AAExB,cAAI,QAAQ;AACR,mBAAO,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,UAC7C;AAEA,eAAK,YAAW,oBAAI,KAAK,GAAE,YAAY;AAEvC,gBAAM,UAAU,CAAC,GAAG,YAAY,OAAO,EAAE,KAAK,GAAG;AAEjD,eAAK,aAAa;AAClB,eAAK,KAAK;AAAA,YACN,MAAM;AAAA,YACN,MAAM;AAAA,YACN,SAAS,KAAK,cAAc,OAAO;AAAA,YACnC;AAAA,UACJ,CAAC;AAED,iBAAO;AAAA,QACX;AAAA;AAAA;AAAA;AAAA,QAMA,WAA4E;AACxE,cAAI,aAAa;AACjB,cAAI,eAAe;AACnB,cAAI,YAAY;AAEhB,gBAAM,WAAW,CAAC,UAAkC;AAChD,uBAAW,QAAQ,OAAO,OAAO,KAAK,GAAG;AACrC,kBAAI,KAAK,SAAS,QAAQ;AACtB;AACA,6BAAa,KAAK;AAAA,cACtB,WAAW,KAAK,SAAS,UAAU;AAC/B;AACA,yBAAS,KAAK,QAAQ;AAAA,cAC1B;AAAA,YACJ;AAAA,UACJ;AAEA,mBAAS,KAAK,KAAK,GAAG,EAAE,QAAQ;AAEhC,iBAAO,EAAE,YAAY,cAAc,UAAU;AAAA,QACjD;AAAA,QAEA,QAAc;AACV,eAAK,OAAO,KAAK,uBAAuB;AACxC,eAAK,KAAK;AACV,kBAAQ,IAAI,+BAA+B;AAAA,QAC/C;AAAA,QAEA,SAAyB;AACrB,iBAAO,KAAK,MAAM,KAAK,UAAU,KAAK,IAAI,CAAC;AAAA,QAC/C;AAAA,QAEA,OAAO,MAA+B;AAClC,cAAI;AAEA,gBAAI,CAAC,QAAQ,OAAO,SAAS,UAAU;AACnC,qBAAO;AAAA,YACX;AAEA,iBAAK,OAAO;AACZ,iBAAK,KAAK;AACV,oBAAQ,IAAI,mCAAmC;AAE/C,mBAAO;AAAA,UACX,SAAS,OAAO;AACZ,oBAAQ,MAAM,8BAA8B,KAAK;AACjD,mBAAO;AAAA,UACX;AAAA,QACJ;AAAA,MACJ;AAMO,MAAM,YAAY,IAAI,yBAAyB;AAItD,UAAI,OAAO,WAAW,aAAa;AAC/B,QAAC,OAAe,YAAY;AAAA,MAChC;AAAA;AAAA;;;ACnpBA,MAoBa;AApBb;AAAA;AAAA;AAQA;AACA;AAWO,MAAM,kBAAN,MAAM,yBAAwB,QAAQ;AAAA,QAOzC,YAAY,QAA6B;AACrC,gBAAM;AAAA,YACF,MAAM;AAAA,YACN,QAAO,iCAAQ,UAAS;AAAA,YACxB,GAAG;AAAA,UACP,CAAC;AAED,eAAK,gBAAgB;AACrB,eAAK,eAAe;AACpB,eAAK,iBAAiB,CAAC;AACvB,eAAK,eAAe;AACpB,eAAK,SAAS;AAGd,cAAI;AACA,kBAAM,OAAO,UAAU,UAAU,cAAc;AAC/C,gBAAI,CAAC,QAAQ,CAAC,KAAK,UAAU;AACzB,sBAAQ,KAAK,yDAAyD;AACtE,wBAAU,MAAM;AAAA,YACpB;AAAA,UACJ,SAAS,OAAO;AACZ,oBAAQ,KAAK,uDAAuD,KAAK;AACzE,sBAAU,MAAM;AAAA,UACpB;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,YAAyB;AACrB,gBAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,oBAAU,KAAK,GAAG,KAAK,EAAE;AACzB,oBAAU,YAAY;AAEtB,gBAAM,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,+EAK0D,KAAK,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAalF,oBAAU,YAAY;AACtB,eAAK,UAAU;AAEf,eAAK,gBAAgB,UAAU,cAAc,wBAAwB;AACrE,eAAK,eAAe,UAAU,cAAc,uBAAuB;AAEnE,eAAK,sBAAsB;AAC3B,eAAK,mBAAmB;AAExB,iBAAO;AAAA,QACX;AAAA,QAEQ,wBAA8B;AAClC,cAAI,CAAC,KAAK,aAAc;AAExB,eAAK,aAAa,iBAAiB,WAAW,CAAC,MAAqB;AAChE,gBAAI,EAAE,QAAQ,SAAS;AACnB,gBAAE,eAAe;AACjB,oBAAM,UAAU,KAAK,aAAc,MAAM,KAAK;AAC9C,kBAAI,SAAS;AACT,qBAAK,eAAe,OAAO;AAAA,cAE/B;AACA,mBAAK,aAAc,QAAQ;AAC3B,mBAAK,aAAc,MAAM;AAAA,YAC7B,WAAW,EAAE,QAAQ,WAAW;AAC5B,gBAAE,eAAe;AACjB,kBAAI,KAAK,eAAe,GAAG;AACvB,qBAAK;AACL,sBAAM,eAAe,KAAK,eAAe,KAAK,YAAY;AAC1D,oBAAI,iBAAiB,QAAW;AAC5B,uBAAK,aAAc,QAAQ;AAAA,gBAC/B;AAAA,cACJ;AAAA,YACJ,WAAW,EAAE,QAAQ,aAAa;AAC9B,gBAAE,eAAe;AACjB,kBAAI,KAAK,eAAe,KAAK,eAAe,SAAS,GAAG;AACpD,qBAAK;AACL,sBAAM,eAAe,KAAK,eAAe,KAAK,YAAY;AAC1D,oBAAI,iBAAiB,QAAW;AAC5B,uBAAK,aAAc,QAAQ;AAAA,gBAC/B;AAAA,cACJ,OAAO;AACH,qBAAK,eAAe,KAAK,eAAe;AACxC,qBAAK,aAAc,QAAQ;AAAA,cAC/B;AAAA,YACJ,WAAW,EAAE,QAAQ,OAAO;AAExB,gBAAE,eAAe;AACjB,mBAAK,oBAAoB;AAAA,YAC7B;AAAA,UACJ,CAAC;AAAA,QACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAUQ,sBAA4B;AA7IxC;AA8IQ,cAAI,CAAC,KAAK,aAAc;AAExB,gBAAM,QAAQ,KAAK,aAAa;AAChC,cAAI,UAAU,GAAI;AAElB,gBAAM,gBAAgB,MAAM,SAAS,GAAG;AACxC,gBAAM,SAAS,MAAM,MAAM,GAAG,EAAE,OAAO,CAACC,IAAG,GAAG,QAAQ;AAElD,gBAAIA,OAAM,GAAI,QAAO;AACrB,mBAAO,MAAM,IAAI,SAAS;AAAA,UAC9B,CAAC;AAED,gBAAM,OAAM,YAAO,CAAC,MAAR,YAAa;AACzB,gBAAM,QAAO,YAAO,CAAC,MAAR,YAAa;AAG1B,gBAAM,oBAAoB;AAAA,YACtB;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACJ;AAGA,cAAI;AACA,oBAAQ,MAAM,kCAAkC,EAAE,OAAO,KAAK,KAAK,OAAO,CAAC;AAAA,UAC/E,QAAQ;AAAA,UAAC;AAGT,cAAI,OAAO,UAAU,KAAK,CAAC,eAAe;AACtC,kBAAM,UAAU,kBAAkB,OAAO,OAAK,EAAE,WAAW,GAAG,CAAC;AAC/D,gBAAI;AACA,sBAAQ,MAAM,qCAAqC,EAAE,KAAK,QAAQ,CAAC;AAAA,YACvE,QAAQ;AAAA,YAAC;AACT,gBAAI,QAAQ,WAAW,GAAG;AACtB,oBAAM,QAAQ,QAAQ,CAAC;AACvB,kBAAI,UAAU,OAAW,MAAK,aAAa,QAAQ,QAAQ;AAC3D;AAAA,YACJ;AAGA,gBAAI,kBAAkB,SAAS,GAAG,GAAG;AACjC,mBAAK,aAAa,QAAQ,MAAM;AAAA,YACpC;AACA;AAAA,UACJ;AAIA,cAAI,OAAO,WAAW,KAAK,iBAAiB,kBAAkB,SAAS,GAAG,GAAG;AACzE,iBAAK,aAAa,QAAQ,MAAM;AAChC;AAAA,UACJ;AAGA,gBAAM,iBAAiB,QAAQ,QAAQ,QAAQ,SAAS,QAAQ,WAAW,QAAQ;AACnF,cAAI,CAAC,eAAgB;AAGrB,cAAI,SAAS,GAAI;AAGjB,cAAI,QAAQ,WAAW,KAAK,SAAS,GAAG,EAAG;AAE3C,gBAAM,eAAe,QAAQ,QAAQ,QAAQ;AAC7C,gBAAM,aAAa,QAAQ,SAAS,QAAQ;AAC5C,gBAAM,YAAY,QAAQ;AAE1B,eAAK,qBAAqB,KAAK,MAAM;AAAA,YACjC,cAAc,YAAY,OAAO;AAAA,YACjC,YAAY,YAAY,OAAO;AAAA,UACnC,CAAC;AAAA,QACL;AAAA,QAEQ,iBAAiB,SAA2B;AAhOxD;AAiOQ,cAAI,QAAQ,WAAW,EAAG,QAAO;AACjC,gBAAM,SAAQ,aAAQ,CAAC,MAAT,YAAc;AAC5B,cAAI,QAAQ,WAAW,EAAG,QAAO;AAEjC,cAAI,SAAS;AACb,mBAAS,IAAI,GAAG,IAAI,QAAQ,QAAQ,KAAK;AACrC,kBAAM,MAAM,QAAQ,CAAC;AACrB,gBAAI,QAAQ,OAAW;AACvB,mBAAO,IAAI,QAAQ,MAAM,MAAM,GAAG;AAC9B,uBAAS,OAAO,MAAM,GAAG,EAAE;AAC3B,kBAAI,WAAW,GAAI,QAAO;AAAA,YAC9B;AAAA,UACJ;AACA,iBAAO;AAAA,QACX;AAAA,QAEQ,qBACJ,KACA,QACA,MACI;AACJ,cAAI,CAAC,KAAK,aAAc;AAGxB,gBAAM,eAAe,OAAO,YAAY,GAAG;AAC3C,gBAAM,YAAY,gBAAgB,IAAI,OAAO,MAAM,GAAG,eAAe,CAAC,IAAI;AAC1E,gBAAM,aAAa,gBAAgB,IAAI,OAAO,MAAM,eAAe,CAAC,IAAI;AAGxE,cAAI,eAAe,MAAM,OAAO,SAAS,GAAG,EAAG;AAG/C,cAAI;AACJ,cAAI,cAAc,IAAI;AAClB,4BAAgB,KAAK;AAAA,UACzB,OAAO;AACH,kBAAM,SAAS,UAAU,SAAS,GAAG,IAAI,UAAU,MAAM,GAAG,EAAE,IAAI;AAClE,4BAAgB,KAAK,WAAW,MAAM;AAAA,UAC1C;AAEA,gBAAM,SAAS,UAAU,UAAU,aAAa;AAChD,cAAI;AACA,oBAAQ,MAAM,iCAAiC;AAAA,cAC3C;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA,aAAa,CAAC,CAAC;AAAA,YACnB,CAAC;AAAA,UACL,QAAQ;AAAA,UAAC;AACT,cAAI,CAAC,OAAQ;AAEb,gBAAM,UAAU,OAAO,QAAQ,OAAO,QAAQ;AAC9C,gBAAM,UAAU,QACX,OAAO,CAAC,CAAC,MAAM,IAAI,MAAM;AACtB,gBAAI,CAAC,KAAK,WAAW,UAAU,EAAG,QAAO;AACzC,gBAAI,KAAK,SAAS,SAAU,QAAO,KAAK;AACxC,mBAAO,KAAK;AAAA,UAChB,CAAC,EACA,IAAI,CAAC,CAAC,MAAM,IAAI,OAAO,EAAE,MAAM,KAAK,EAAE;AAE3C,cAAI;AACA,oBAAQ,MAAM,kCAAkC;AAAA,cAC5C;AAAA,cACA;AAAA,cACA,OAAO,QAAQ;AAAA,cACf,OAAO,QAAQ,IAAI,OAAK,EAAE,IAAI;AAAA,YAClC,CAAC;AAAA,UACL,QAAQ;AAAA,UAAC;AACT,cAAI,QAAQ,WAAW,EAAG;AAE1B,gBAAM,QAAQ,QAAQ,IAAI,OAAK,EAAE,IAAI;AAErC,cAAI,QAAQ,WAAW,GAAG;AACtB,kBAAM,IAAI,QAAQ,CAAC;AACnB,gBAAI,YAAY,EAAE;AAGlB,gBAAI,QAAQ,QAAQ,EAAE,KAAK,SAAS,YAAY,CAAC,UAAU,SAAS,GAAG,GAAG;AACtE,2BAAa;AAAA,YACjB;AAEA,iBAAK,aAAa,QAAQ,GAAG,GAAG,IAAI,SAAS,GAAG,SAAS;AACzD;AAAA,UACJ;AAGA,gBAAM,SAAS,KAAK,iBAAiB,KAAK;AAC1C,cAAI,OAAO,SAAS,WAAW,QAAQ;AACnC,iBAAK,aAAa,QAAQ,GAAG,GAAG,IAAI,SAAS,GAAG,MAAM;AAAA,UAC1D,OAAO;AAEH,gBAAI;AACA,oBAAM,YAAY,QAAQ;AAAA,gBACtB,QAAM,EAAE,KAAK,SAAS,WAAW,eAAQ,gBAAS,EAAE;AAAA,cACxD;AACA,mBAAK;AAAA,gBACD,gBAAgB,KAAK,MAAM,KAAK,KAAK,aAAc,KAAK;AAAA,gBACxD;AAAA,cACJ;AACA,mBAAK,UAAU,UAAU,KAAK,IAAI,GAAG,MAAM;AAAA,YAC/C,QAAQ;AAAA,YAAC;AAAA,UACb;AAAA,QACJ;AAAA,QAEA,qBAA2B;AACvB,eAAK,UAAU,wEAAkE,MAAM;AAAA,QAC3F;AAAA,QAEA,eAAe,SAAuB;AAClC,eAAK,UAAU,gBAAgB,KAAK,MAAM,KAAK,OAAO,IAAI,SAAS;AACnE,gBAAM,CAAC,KAAK,GAAG,IAAI,IAAI,QAAQ,MAAM,GAAG;AAExC,cAAI,QAAQ,OAAW;AAEvB,gBAAM,WAAuC;AAAA,YACzC,MAAM,MAAM,KAAK,SAAS;AAAA,YAC1B,OAAO,MAAM,KAAK,YAAY;AAAA,YAC9B,IAAI,MAAM,KAAK,cAAc,KAAK,CAAC,CAAC;AAAA,YACpC,KAAK,MAAM,KAAK,sBAAsB;AAAA,YACtC,IAAI,MAAM,KAAK,gBAAgB,KAAK,CAAC,CAAC;AAAA,YACtC,KAAK,MAAM,KAAK,QAAQ,KAAK,CAAC,CAAC;AAAA,YAC/B,OAAO,MAAM,KAAK,MAAM,KAAK,CAAC,CAAC;AAAA,YAC/B,OAAO,MAAM,KAAK,MAAM,KAAK,CAAC,CAAC;AAAA,YAC/B,IAAI,MAAM,KAAK,GAAG,KAAK,CAAC,CAAC;AAAA,YACzB,MAAM,MAAM,KAAK,KAAK,KAAK,KAAK,GAAG,CAAC;AAAA,YACpC,MAAM,MAAM,KAAK,SAAS;AAAA,YAC1B,QAAQ,MAAM,KAAK,UAAU,SAAS,QAAQ;AAAA,UAClD;AAEA,gBAAM,YAAY,SAAS,GAAG;AAC9B,cAAI,cAAc,QAAW;AACzB,sBAAU;AAAA,UACd,OAAO;AACH,iBAAK;AAAA,cACD,0BAA0B,GAAG;AAAA,cAC7B;AAAA,YACJ;AAAA,UACJ;AAGA,eAAK,eAAe,KAAK,OAAO;AAChC,eAAK,eAAe,KAAK,eAAe;AACxC,eAAK,mBAAmB,EAAE,gBAAgB,KAAK,eAAe,CAAC;AAAA,QACnE;AAAA,QAEA,UAAU,MAAc,OAAgD,UAAgB;AACpF,cAAI,CAAC,KAAK,cAAe;AACzB,gBAAM,OAAO,SAAS,cAAc,KAAK;AACzC,eAAK,YAAY,0BAA0B,IAAI;AAC/C,gBAAM,WAAmC;AAAA,YACrC,SAAS;AAAA,YACT,QAAQ;AAAA,YACR,OAAO;AAAA,YACP,MAAM;AAAA,UACV;AACA,eAAK,aAAa,IAAI,SAAS,IAAI,KAAK,gBAAgB;AACxD,eAAK,cAAc;AACnB,eAAK,cAAc,YAAY,IAAI;AACnC,eAAK,cAAc,YAAY,KAAK,cAAc;AAAA,QACtD;AAAA,QAEA,cAAoB;AAChB,cAAI,KAAK,cAAe,MAAK,cAAc,YAAY;AAAA,QAC3D;AAAA,QAEA,WAAiB;AACb,gBAAM,WAAW;AAAA,YACb;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACJ;AACA,mBAAS,QAAQ,OAAK,KAAK,UAAU,GAAG,MAAM,CAAC;AAAA,QACnD;AAAA,QAEA,cAAc,MAAqB;AAC/B,gBAAM,SAAS,KAAK,WAAW,IAAI;AACnC,gBAAM,OAAO,UAAU,IAAI,MAAM;AACjC,cAAI,CAAC,MAAM;AACP,iBAAK,UAAU,qCAAqC,QAAQ,MAAM,IAAI,OAAO;AAC7E;AAAA,UACJ;AACA,cAAI,KAAK,SAAS,QAAQ;AACtB,iBAAK,UAAU,eAAQ,OAAO,MAAM,GAAG,EAAE,IAAI,GAAG,QAAQ;AACxD;AAAA,UACJ;AACA,gBAAM,UAAU,UAAU,KAAK,MAAM;AACrC,gBAAM,QAAQ,OAAO,KAAK,OAAO;AACjC,cAAI,MAAM,WAAW,GAAG;AACpB,iBAAK,UAAU,UAAU,QAAQ;AACjC;AAAA,UACJ;AACA,gBAAM,QAAQ,UAAQ;AAClB,kBAAM,QAAQ,QAAQ,IAAI;AAC1B,gBAAI,OAAO;AACP,oBAAM,SAAS,MAAM,SAAS,WAAW,eAAQ;AACjD,mBAAK,UAAU,SAAS,MAAM,QAAQ;AAAA,YAC1C;AAAA,UACJ,CAAC;AAAA,QACL;AAAA,QAEA,wBAA8B;AAC1B,eAAK,UAAU,KAAK,QAAQ,QAAQ;AAAA,QACxC;AAAA,QAEA,gBAAgB,MAAqB;AACjC,gBAAM,SAAS,KAAK,WAAW,QAAQ,cAAc;AACrD,gBAAM,SAAS,UAAU,UAAU,MAAM;AACzC,cAAI,CAAC,QAAQ;AACT,iBAAK,UAAU,+BAA+B,QAAQ,MAAM,IAAI,OAAO;AACvE;AAAA,UACJ;AACA,eAAK,SAAS;AACd,eAAK,aAAa;AAClB,eAAK,mBAAmB,EAAE,aAAa,KAAK,OAAO,CAAC;AAAA,QACxD;AAAA,QAEA,QAAQ,UAAyB;AAC7B,cAAI,CAAC,UAAU;AACX,iBAAK,UAAU,mBAAmB,OAAO;AACzC;AAAA,UACJ;AACA,gBAAM,SAAS,KAAK,WAAW,QAAQ;AACvC,gBAAM,OAAO,UAAU,QAAQ,MAAM;AACrC,cAAI,CAAC,KAAM,MAAK,UAAU,yBAAyB,QAAQ,IAAI,OAAO;AAAA,cACjE,MAAK,UAAU,KAAK,SAAS,QAAQ;AAAA,QAC9C;AAAA,QAEA,KAAK,MAAoB;AACrB,eAAK,UAAU,MAAM,QAAQ;AAAA,QACjC;AAAA,QAEA,WAAiB;AACb,eAAK,WAAU,oBAAI,KAAK,GAAE,SAAS,GAAG,QAAQ;AAAA,QAClD;AAAA,QAEA,eAAqB;AAvdzB;AAwdQ,gBAAM,UAAS,UAAK,YAAL,mBAAc,cAAc;AAC3C,cAAI,QAAQ;AACR,mBAAO,cAAc,gBAAgB,KAAK,MAAM;AAAA,UACpD;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKQ,WAAW,MAAuB;AAEtC,cAAI,CAAC,QAAQ,KAAK,KAAK,MAAM,MAAM,SAAS,IAAK,QAAO,KAAK;AAG7D,cAAI,MAAM,KAAK,KAAK;AACpB,cAAI,QAAQ,IAAK,QAAO;AACxB,cAAI,IAAI,WAAW,IAAI,EAAG,OAAM,kBAAkB,IAAI,MAAM,CAAC;AAG7D,cAAI,IAAI,WAAW,GAAG,GAAG;AAErB,kBAAMC,SAAQ,IAAI,MAAM,GAAG,EAAE,OAAO,OAAO;AAC3C,kBAAMC,YAAqB,CAAC;AAC5B,uBAAW,KAAKD,QAAO;AACnB,kBAAI,MAAM,IAAK;AACf,kBAAI,MAAM,MAAM;AACZ,oBAAIC,UAAS,SAAS,EAAG,CAAAA,UAAS,IAAI;AAAA,cAC1C,OAAO;AACH,gBAAAA,UAAS,KAAK,CAAC;AAAA,cACnB;AAAA,YACJ;AACA,mBAAO,MAAMA,UAAS,KAAK,GAAG;AAAA,UAClC;AAGA,gBAAM,OAAO,KAAK,OAAO,MAAM,GAAG,EAAE,OAAO,OAAO;AAClD,gBAAM,QAAQ,IAAI,MAAM,GAAG,EAAE,OAAO,OAAO;AAC3C,gBAAM,WAAW,CAAC,GAAG,MAAM,GAAG,KAAK;AAGnC,gBAAM,WAAqB,CAAC;AAC5B,qBAAW,KAAK,UAAU;AACtB,gBAAI,MAAM,IAAK;AACf,gBAAI,MAAM,MAAM;AACZ,kBAAI,SAAS,SAAS,EAAG,UAAS,IAAI;AAAA,YAC1C,OAAO;AACH,uBAAS,KAAK,CAAC;AAAA,YACnB;AAAA,UACJ;AACA,iBAAO,MAAM,SAAS,KAAK,GAAG;AAAA,QAClC;AAAA,QAEA,MAAM,MAAqB;AACvB,cAAI,CAAC,MAAM;AACP,iBAAK,UAAU,wBAAwB,OAAO;AAC9C;AAAA,UACJ;AACA,gBAAM,SAAS,KAAK,WAAW,IAAI;AACnC,gBAAM,WAAW,UAAU,IAAI,MAAM;AACrC,cAAI,UAAU;AACV,gBAAI,SAAS,SAAS,QAAQ;AAC1B,mBAAK,UAAU,4BAA4B,MAAM,IAAI,OAAO;AAAA,YAChE,OAAO;AACH,mBAAK,UAAU,6BAA6B,MAAM,IAAI,OAAO;AAAA,YACjE;AACA;AAAA,UACJ;AAEA,gBAAM,QAAQ,OAAO,MAAM,GAAG;AAC9B,gBAAM,OAAO,MAAM,IAAI;AACvB,gBAAM,aAAa,MAAM,KAAK,GAAG;AACjC,gBAAM,SAAS,UAAU,UAAU,UAAU;AAC7C,cAAI,CAAC,QAAQ;AACT,iBAAK,UAAU,iDAA8C,UAAU,IAAI,OAAO;AAClF;AAAA,UACJ;AACA,gBAAM,KAAK,UAAU,WAAW,CAAC,GAAG,OAAO,IAAI,EAAE,KAAK,GAAG,GAAG,EAAE;AAC9D,cAAI,CAAC,GAAI,MAAK,UAAU,iCAAiC,MAAM,IAAI,OAAO;AAAA,QAC9E;AAAA,QAEA,MAAM,MAAqB;AACvB,cAAI,CAAC,MAAM;AACP,iBAAK,UAAU,yBAAyB,OAAO;AAC/C;AAAA,UACJ;AACA,gBAAM,SAAS,KAAK,WAAW,IAAI;AACnC,gBAAM,QAAQ,OAAO,MAAM,GAAG;AAC9B,gBAAM,OAAO,MAAM,IAAI;AACvB,gBAAM,aAAa,MAAM,KAAK,GAAG;AACjC,gBAAM,SAAS,UAAU,UAAU,UAAU;AAC7C,cAAI,CAAC,QAAQ;AACT,iBAAK,UAAU,iDAA8C,UAAU,IAAI,OAAO;AAClF;AAAA,UACJ;AACA,gBAAM,KAAK,UAAU,aAAa,CAAC,GAAG,OAAO,IAAI,EAAE,KAAK,GAAG,CAAC;AAC5D,cAAI,CAAC,GAAI,MAAK,UAAU,uCAAuC,MAAM,IAAI,OAAO;AAAA,QACpF;AAAA,QAEA,GAAG,MAAqB;AACpB,cAAI,CAAC,MAAM;AACP,iBAAK,UAAU,cAAc,OAAO;AACpC;AAAA,UACJ;AACA,gBAAM,SAAS,KAAK,WAAW,IAAI;AACnC,cAAI,CAAC,UAAU,IAAI,MAAM,GAAG;AACxB,iBAAK,UAAU,mBAAmB,MAAM,IAAI,OAAO;AACnD;AAAA,UACJ;AACA,gBAAM,KAAK,UAAU,OAAO,MAAM;AAClC,cAAI,CAAC,GAAI,MAAK,UAAU,4BAAyB,MAAM,IAAI,OAAO;AAAA,QACtE;AAAA;AAAA;AAAA;AAAA,QAKQ,WAAW,MAAsB;AACrC,gBAAM,QAAQ,KAAK,MAAM,GAAG,EAAE,OAAO,OAAO;AAC5C,gBAAM,IAAI;AACV,iBAAO,MAAM,SAAS,IAAI,MAAM,MAAM,KAAK,GAAG,IAAI;AAAA,QACtD;AAAA;AAAA;AAAA;AAAA,QAIA,YAAiB;AACb,iBAAO;AAAA,YACH,GAAG,MAAM,UAAU;AAAA,YACnB,aAAa,KAAK;AAAA,YAClB,gBAAgB,KAAK;AAAA,YACrB,QAAQ,KAAK;AAAA,UACjB;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,OAAO,YAAY,OAA6B;AAC5C,gBAAM,UAAU,IAAI,iBAAgB;AAAA,YAChC,IAAI,MAAM;AAAA,YACV,OAAO,MAAM;AAAA,UACjB,CAAC;AAKD,cAAI,MAAM,QAAQ;AACd,oBAAQ,SAAS,MAAM;AAAA,UAC3B,WAAW,MAAM,aAAa;AAC1B,oBAAQ,SAAS,MAAM;AAAA,UAC3B;AAEA,cAAI,MAAM,gBAAgB;AACtB,oBAAQ,iBAAiB,MAAM;AAC/B,oBAAQ,eAAe,QAAQ,eAAe;AAAA,UAClD;AAEA,iBAAO;AAAA,QACX;AAAA;AAAA;AAAA;AAAA,QAKU,SAAe;AACrB,cAAI,KAAK,gBAAgB,OAAO,KAAK,aAAa,UAAU,YAAY;AACpE,iBAAK,aAAa,MAAM;AAAA,UAC5B;AAAA,QACJ;AAAA,MACJ;AAGA,MAAC,OAAe,kBAAkB;AAAA;AAAA;;;ACjoBlC,MAiBa;AAjBb;AAAA;AAAA;AAMA;AAWO,MAAM,iBAAN,MAAM,wBAAuB,WAAW;AAAA,QAC3C,YAAY,QAAgC;AACxC,gBAAM;AAAA,YACF,MAAM;AAAA,YACN,OAAO;AAAA,YACP,GAAG;AAAA,UACP,CAAC;AAAA,QACL;AAAA;AAAA;AAAA;AAAA,QAKA,IAAI,WAAsB;AACtB,iBAAO,MAAM,KAAK,KAAK,KAAK,OAAO,CAAC;AAAA,QACxC;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,IAAI,gBAAgC;AAChC,cAAI,CAAC,KAAK,YAAa,QAAO;AAC9B,iBAAO,KAAK,KAAK,IAAI,KAAK,WAAW,KAAK;AAAA,QAC9C;AAAA;AAAA;AAAA;AAAA,QAKA,YAAyB;AACrB,gBAAM,QAAQ,MAAM,UAAU;AAE9B,iBAAO;AAAA,QACX;AAAA;AAAA;AAAA;AAAA,QAKU,cAAoB;AAC1B,gBAAM,IAAI;AACV,cAAI,CAAC,EAAE,cAAc,CAAC,KAAK,QAAS;AAEpC,gBAAM,SAAS,KAAK,QAAQ,cAAc,IAAI,KAAK,EAAE,OAAO;AAC5D,cAAI,CAAC,OAAQ;AAGb,gBAAM,WAAW,CAAC,SAAc;AAAA,YAC5B,YAAY,IAAI;AAAA,YAChB,OAAO,IAAI;AAAA,YACX,UAAU,EAAE,UAAU,IAAI,MAAM;AAAA,YAChC,OAAO;AAAA,YACP,MAAM,MAAM,IAAI,KAAK;AAAA,YACrB,MAAM,MAAM,IAAI,KAAK;AAAA,UACzB;AACA,gBAAM,UAAU;AAAA,YACZ,iBAAiB,MAAM,MAAM,KAAK,KAAK,KAAK,OAAO,CAAC,EAAE,IAAI,QAAQ;AAAA,YAClE,mBAAmB,MAAM;AACrB,oBAAM,WAAW,KAAK;AACtB,oBAAMC,KAAI,WAAW,KAAK,KAAK,IAAI,QAAQ,IAAI;AAC/C,qBAAOA,KAAI,SAASA,EAAC,IAAI;AAAA,YAC7B;AAAA,YACA,mBAAmB,MAAM,MAAM,KAAK,KAAK,KAAK,KAAK,CAAC;AAAA,YACpD,aAAa,CAAC,OAAe;AACzB,oBAAMA,KAAI,KAAK,KAAK,IAAI,EAAE,KAAK;AAC/B,qBAAOA,KAAI,SAASA,EAAC,IAAI;AAAA,YAC7B;AAAA,YACA,mBAAmB,CAAC,OAAe,KAAK,aAAa,EAAE;AAAA,YACvD,gBAAgB,CAAC,QAAc;AAC3B,oBAAMC,KAAI;AACV,oBAAM,UAAUA,GAAE,kBACZ,IAAIA,GAAE,gBAAgB;AAAA,gBAClB,QAAO,2BAAK,UAAS,YAAY,KAAK,KAAK,OAAO,CAAC;AAAA,cACvD,CAAC,IACD;AACN,kBAAI,SAAS;AACT,qBAAK,OAAO,OAAO;AACnB,uBAAO,SAAS,OAAO;AAAA,cAC3B;AACA,qBAAO;AAAA,YACX;AAAA,YACA,iBAAiB,CAAC,OAAe,KAAK,UAAU,EAAE;AAAA,YAClD,kBAAkB,MAAM,KAAK,KAAK;AAAA,YAClC,kBAAkB,CAAC,aAAuB;AACtC,oBAAM,MAAM,KAAK;AACjB,oBAAM,UAAU,oBAAI,IAAiB;AACrC,uBAAS,QAAQ,QAAM;AACnB,sBAAMD,KAAI,IAAI,IAAI,EAAE;AACpB,oBAAIA,GAAG,SAAQ,IAAI,IAAIA,EAAC;AAAA,cAC5B,CAAC;AACD,kBAAI,QAAQ,CAACA,IAAG,OAAO;AACnB,oBAAI,CAAC,QAAQ,IAAI,EAAE,EAAG,SAAQ,IAAI,IAAIA,EAAC;AAAA,cAC3C,CAAC;AACD,cAAC,KAAa,OAAO;AACrB,mBAAK,YAAY;AAAA,YACrB;AAAA,YACA,gBAAgB,CAAC,OAAe;AAC5B,oBAAMA,KAAI,KAAK,UAAU,EAAE;AAC3B,qBAAOA,KAAI,SAASA,EAAC,IAAI;AAAA,YAC7B;AAAA,YACA,eAAe,CAAC,SAAc;AAC1B,oBAAM,MAAM,KAAK,SAAS;AAC1B,mBAAK,OAAO,GAAG;AACf,mBAAK,aAAa,IAAI,EAAE;AACxB,qBAAO,SAAS,GAAG;AAAA,YACvB;AAAA,UACJ;AAGA,cAAK,KAAa,eAAe;AAC7B,YAAC,KAAa,cAAc,QAAQ;AAAA,UACxC;AAGA,UAAC,KAAa,gBAAgB,EAAE,WAAW,OAAO,SAAS,QAAuB;AAAA,YAC9E,WAAW;AAAA,YACX,uBAAuB,MAAM,YAAY,KAAK,KAAK,OAAO,CAAC;AAAA,UAC/D,CAAC;AAAA,QACL;AAAA;AAAA;AAAA;AAAA,QAKA,cAAc,OAAgC;AAC1C,gBAAM,IAAI;AACV,cAAI,CAAC,EAAE,iBAAiB;AACpB,oBAAQ,MAAM,kCAAkC;AAChD,mBAAO;AAAA,UACX;AAEA,gBAAM,UAAU,IAAI,EAAE,gBAAgB;AAAA,YAClC,OAAO,SAAS,YAAY,KAAK,KAAK,OAAO,CAAC;AAAA,UAClD,CAAC;AAED,eAAK,OAAO,OAAO;AACnB,iBAAO;AAAA,QACX;AAAA;AAAA;AAAA;AAAA,QAKA,OAAO,OAAO,QAAgD;AAC1D,gBAAME,UAAS,IAAI,gBAAe,MAAM;AAGxC,UAAAA,QAAO,cAAc;AAGrB,gBAAM,IAAI;AACV,cAAI,EAAE,gBAAgB;AAClB,cAAE,eAAe,eAAeA,OAAM;AAAA,UAC1C;AAGA,UAAAA,QAAO,KAAK;AAEZ,iBAAOA;AAAA,QACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAOA,OAAO,cAAc,QAAgD;AACjE,gBAAM,IAAI;AACV,cAAI,CAAC,EAAE,gBAAgB;AAEnB,mBAAO,gBAAe,OAAO,MAAM;AAAA,UACvC;AAGA,gBAAM,kBAAkB,EAAE,eAAe,iBAAiB,UAAU;AAEpE,cAAI,gBAAgB,WAAW,GAAG;AAE9B,mBAAO,gBAAe,OAAO,MAAM;AAAA,UACvC;AAGA,cAAI,mBAAmB,gBAAgB,CAAC;AACxC,qBAAW,OAAO,iBAAiB;AAC/B,gBAAI,IAAI,SAAS,iBAAiB,QAAQ;AACtC,iCAAmB;AAAA,YACvB;AAAA,UACJ;AAEA,cAAI,iBAAiB,KAAK,SAAS,KAAK,EAAE,iBAAiB;AACvD,6BAAiB,cAAc;AAAA,UACnC;AAGA,2BAAiB,aAAa;AAC9B,iBAAO;AAAA,QACX;AAAA,MACJ;AAGA,MAAC,OAAe,iBAAiB;AAAA;AAAA;;;ACrNjC,MAoBa;AApBb;AAAA;AAAA;AAMA;AACA;AAaO,MAAM,qBAAN,MAAM,4BAA2B,QAAQ;AAAA,QAc5C,YAAY,QAA6B;AACrC,gBAAM;AAAA,YACF,MAAM;AAAA,YACN,QAAO,iCAAQ,UAAS;AAAA,YACxB,GAAG;AAAA,UACP,CAAC;AAED,eAAK,SAAS;AACd,eAAK,YAAY;AACjB,eAAK,mBAAmB;AACxB,eAAK,iBAAiB;AACtB,eAAK,mBAAmB;AACxB,eAAK,YAAY;AACjB,eAAK,eAAe;AACpB,eAAK,YAAY;AAEjB,eAAK,WAAW;AAChB,eAAK,WAAW,KAAK;AACrB,eAAK,UAAU;AAAA,QACnB;AAAA;AAAA;AAAA;AAAA,QAKA,YAAyB;AACrB,gBAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,oBAAU,KAAK,GAAG,KAAK,EAAE;AACzB,oBAAU,YAAY;AAEtB,gBAAM,SAAS,SAAS,gBAAgB,UAAU,SAAS,MAAM;AAEjE,oBAAU,YAAY;AAAA,uFACyD,SAAS,YAAY,SAAS,YAAY,SAAS,YAAY,SAAS;AAAA;AAAA,gFAE/E,SAAS,YAAY,SAAS,iDAAiD,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA,wEAIrH,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA,wEAI9B,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qEAOjC,SAAS,YAAY,SAAS,iDAAiD,SAAS,YAAY,SAAS;AAAA,+HACnD,SAAS,YAAY,SAAS,qCAAqC,SAAS,YAAY,SAAS;AAAA,oIAC5F,SAAS,YAAY,SAAS,qCAAqC,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6FAQxI,SAAS,YAAY,SAAS,iBAAiB,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCAMjI,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA,6EAIM,SAAS,YAAY,SAAS,8CAA8C,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAO/K,eAAK,UAAU;AAGf,eAAK,SAAS,UAAU,cAAc,uBAAuB;AAC7D,eAAK,YAAY,UAAU,cAAc,aAAa;AACtD,eAAK,mBAAmB,UAAU,cAAc,aAAa;AAC7D,eAAK,iBAAiB,UAAU,cAAc,WAAW;AACzD,eAAK,mBAAmB,UAAU,cAAc,qBAAqB;AACrE,eAAK,YAAY,UAAU,cAAc,aAAa;AACtD,eAAK,eAAe,UAAU,cAAc,gBAAgB;AAC5D,eAAK,YAAY,UAAU,cAAc,aAAa;AAEtD,eAAK,sBAAsB;AAC3B,eAAK,mBAAmB;AACxB,eAAK,oBAAoB;AAGzB,cAAI,KAAK,gBAAgB,KAAK,aAAa,WAAW,KAAK,QAAQ;AAC/D,iBAAK,OAAO,QAAQ,KAAK,aAAa;AACtC,iBAAK,iBAAiB;AACtB,iBAAK,sBAAsB;AAAA,UAC/B;AAEA,iBAAO;AAAA,QACX;AAAA,QAEQ,wBAA8B;AAxI1C;AAyIQ,cAAI,CAAC,KAAK,QAAS;AAGnB,qBAAK,WAAL,mBAAa,iBAAiB,SAAS,MAAM,KAAK,aAAa;AAC/D,qBAAK,WAAL,mBAAa,iBAAiB,SAAS,MAAM,KAAK,sBAAsB;AACxE,qBAAK,WAAL,mBAAa,iBAAiB,SAAS,MAAM,KAAK,sBAAsB;AAGxE,qBAAK,QACA,cAAc,UAAU,MAD7B,mBAEM,iBAAiB,SAAS,MAAM,KAAK,aAAa;AACxD,qBAAK,QAAQ,cAAc,WAAW,MAAtC,mBAAyC,iBAAiB,SAAS,MAAM,KAAK,SAAS;AACvF,qBAAK,QAAQ,cAAc,WAAW,MAAtC,mBAAyC,iBAAiB,SAAS,MAAM,KAAK,SAAS;AACvF,qBAAK,QACA,cAAc,WAAW,MAD9B,mBAEM,iBAAiB,SAAS,MAAM,KAAK,eAAe,MAAM,IAAI;AACpE,qBAAK,QACA,cAAc,aAAa,MADhC,mBAEM,iBAAiB,SAAS,MAAM,KAAK,eAAe,KAAK,GAAG;AAClE,qBAAK,QACA,cAAc,gBAAgB,MADnC,mBAEM,iBAAiB,SAAS,MAAM,KAAK,eAAe,OAAO,MAAM;AACvE,qBAAK,QACA,cAAc,WAAW,MAD9B,mBAEM,iBAAiB,SAAS,MAAM,KAAK,kBAAkB;AAC7D,qBAAK,QACA,cAAc,WAAW,MAD9B,mBAEM,iBAAiB,SAAS,MAAM,KAAK,eAAe;AAG1D,qBAAK,QACA,cAAc,gBAAgB,MADnC,mBAEM,iBAAiB,SAAS,MAAM,KAAK,SAAS;AACpD,qBAAK,QACA,cAAc,kBAAkB,MADrC,mBAEM,iBAAiB,SAAS,MAAM,KAAK,WAAW;AACtD,qBAAK,QACA,cAAc,kBAAkB,MADrC,mBAEM,iBAAiB,SAAS,MAAM,KAAK,WAAW;AACtD,qBAAK,QACA,cAAc,iBAAiB,MADpC,mBAEM,iBAAiB,SAAS,MAAM,KAAK,iBAAiB;AAG5D,qBAAK,cAAL,mBAAgB,iBAAiB,UAAU,OAAK,KAAK,gBAAgB,CAAC;AAAA,QAC1E;AAAA,QAEQ,qBAA2B;AAC/B,cAAI,CAAC,KAAK,QAAS;AACnB,gBAAM,SAAS,SAAS,gBAAgB,UAAU,SAAS,MAAM;AACjE,gBAAM,UAAU,KAAK,QAAQ,iBAAiB,QAAQ;AACtD,kBAAQ,QAAQ,SAAO;AACnB,gBAAI,MAAM,UAAU;AAAA;AAAA;AAAA,oCAGI,SAAS,YAAY,SAAS;AAAA,8BACpC,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA,UAKpD,CAAC;AAAA,QACL;AAAA,QAEQ,eAAqB;AACzB,eAAK,UAAU;AACf,cAAI,KAAK,QAAQ;AACb,iBAAK,mBAAmB,EAAE,SAAS,KAAK,OAAO,MAAM,CAAC;AACtD,iBAAK,iBAAiB;AAAA,UAC1B;AAAA,QACJ;AAAA,QAEQ,mBAAyB;AAC7B,cAAI,CAAC,KAAK,UAAU,CAAC,KAAK,iBAAkB;AAC5C,gBAAM,OAAO,KAAK,OAAO;AACzB,gBAAM,QAAQ,KAAK,KAAK,IAAI,KAAK,KAAK,EAAE,MAAM,KAAK,EAAE,SAAS;AAC9D,gBAAM,QAAQ,KAAK;AACnB,eAAK,iBAAiB,cAAc,cAAW,KAAK,eAAe,KAAK;AAAA,QAC5E;AAAA,QAEQ,wBAA8B;AAClC,cAAI,CAAC,KAAK,UAAU,CAAC,KAAK,eAAgB;AAC1C,gBAAM,MAAM,KAAK,OAAO;AACxB,gBAAM,mBAAmB,KAAK,OAAO,MAAM,UAAU,GAAG,GAAG;AAC3D,gBAAM,QAAQ,iBAAiB,MAAM,KAAK,KAAK,CAAC,GAAG,SAAS;AAC5D,gBAAM,cAAc,iBAAiB,YAAY,IAAI;AACrD,gBAAM,MAAM,MAAM;AAClB,eAAK,eAAe,cAAc,SAAS,IAAI,YAAY,GAAG;AAAA,QAClE;AAAA,QAEA,eAAqB;AACjB,cAAI,KAAK,WAAW,CAAC,QAAQ,0DAAuD;AAChF;AACJ,cAAI,KAAK,OAAQ,MAAK,OAAO,QAAQ;AACrC,eAAK,WAAW;AAChB,eAAK,UAAU;AACf,eAAK,SAAS,KAAK,QAAQ;AAC3B,eAAK,mBAAmB,EAAE,SAAS,GAAG,CAAC;AACvC,eAAK,iBAAiB;AAAA,QAC1B;AAAA,QAEA,WAAiB;AA9OrB;AA+OQ,qBAAK,cAAL,mBAAgB;AAAA,QACpB;AAAA,QAEQ,gBAAgB,OAAoB;AAlPhD;AAmPQ,gBAAM,SAAS,MAAM;AACrB,gBAAM,QAAO,sCAAQ,UAAR,mBAAgB;AAC7B,cAAI,CAAC,KAAM;AAEX,gBAAM,SAAS,IAAI,WAAW;AAC9B,iBAAO,SAAS,OAAK;AACjB,kBAAM,UAAW,EAAE,OAAsB;AACzC,gBAAI,KAAK,OAAQ,MAAK,OAAO,QAAQ;AACrC,iBAAK,WAAW,KAAK;AACrB,iBAAK,SAAS,KAAK,QAAQ;AAC3B,iBAAK,UAAU;AACf,iBAAK,mBAAmB,EAAE,QAAQ,CAAC;AACnC,iBAAK,iBAAiB;AACtB,iBAAK,YAAY,gBAAa,KAAK,IAAI,EAAE;AAAA,UAC7C;AACA,iBAAO,WAAW,IAAI;AAAA,QAC1B;AAAA,QAEA,WAAiB;AArQrB;AAsQQ,gBAAM,YAAU,UAAK,WAAL,mBAAa,UAAS;AACtC,gBAAM,OAAO,IAAI,KAAK,CAAC,OAAO,GAAG,EAAE,MAAM,aAAa,CAAC;AACvD,gBAAM,MAAM,IAAI,gBAAgB,IAAI;AACpC,gBAAM,IAAI,SAAS,cAAc,GAAG;AACpC,YAAE,OAAO;AACT,YAAE,WAAW,KAAK;AAClB,YAAE,MAAM;AACR,cAAI,gBAAgB,GAAG;AACvB,eAAK,UAAU;AACf,eAAK,YAAY,gBAAgB,KAAK,QAAQ,EAAE;AAAA,QACpD;AAAA,QAEQ,eAAe,QAAgB,OAAqB;AACxD,cAAI,CAAC,KAAK,OAAQ;AAClB,gBAAM,QAAQ,KAAK,OAAO;AAC1B,gBAAM,MAAM,KAAK,OAAO;AACxB,gBAAM,eAAe,KAAK,OAAO,MAAM,UAAU,OAAO,GAAG;AAC3D,gBAAM,cAAc,SAAS,eAAe;AAC5C,eAAK,OAAO,aAAa,aAAa,OAAO,KAAK,QAAQ;AAC1D,eAAK,OAAO,MAAM;AAClB,eAAK,aAAa;AAAA,QACtB;AAAA,QAEA,iBAAuB;AACnB,eAAK,WAAW,KAAK,aAAa,SAAS,QAAQ;AACnD,cAAI,KAAK,QAAQ;AACb,iBAAK,OAAO,OAAO,KAAK;AACxB,iBAAK,OAAO,MAAM,aAAa,KAAK,aAAa,SAAS,aAAa;AAAA,UAC3E;AACA,cAAI;AACA,sBAAU,sBAAsB,KAAK,EAAE,IAAI,KAAK,QAAQ;AAAA,UAC5D,SAAS,GAAG;AACR,oBAAQ,KAAK,4BAA4B,CAAC;AAAA,UAC9C;AACA,eAAK,mBAAmB,EAAE,UAAU,KAAK,SAAS,CAAC;AAAA,QACvD;AAAA,QAEQ,sBAA4B;AAChC,cAAI;AACA,kBAAM,QAAQ,UAAU,sBAAsB,KAAK,EAAE,EAAE;AACvD,gBAAI,SAAS,KAAK,QAAQ;AACtB,mBAAK,WAAW;AAChB,mBAAK,OAAO,OAAO,KAAK;AACxB,mBAAK,OAAO,MAAM,aAAa,KAAK,aAAa,SAAS,aAAa;AAAA,YAC3E;AAAA,UACJ,SAAS,GAAG;AACR,oBAAQ,KAAK,4BAA4B,CAAC;AAAA,UAC9C;AAAA,QACJ;AAAA,QAEA,oBAA0B;AAxT9B;AAyTQ,cAAI,CAAC,KAAK,iBAAkB;AAC5B,gBAAM,WAAW,KAAK,iBAAiB,MAAM,YAAY;AACzD,eAAK,iBAAiB,MAAM,UAAU,WAAW,SAAS;AAC1D,cAAI,YAAY,KAAK,UAAW,MAAK,UAAU,MAAM;AAAA,cAChD,YAAK,WAAL,mBAAa;AAAA,QACtB;AAAA,QAEA,mBAAyB;AAhU7B;AAiUQ,cAAI,KAAK,kBAAkB;AACvB,iBAAK,iBAAiB,MAAM,UAAU;AACtC,uBAAK,WAAL,mBAAa;AAAA,UACjB;AAAA,QACJ;AAAA,QAEA,WAAiB;AACb,cAAI,CAAC,KAAK,aAAa,CAAC,KAAK,OAAQ;AACrC,gBAAM,aAAa,KAAK,UAAU;AAClC,cAAI,CAAC,WAAY;AACjB,gBAAM,UAAU,KAAK,OAAO;AAC5B,gBAAM,aAAa,KAAK,OAAO;AAC/B,gBAAM,QAAQ,QAAQ,QAAQ,YAAY,UAAU;AACpD,cAAI,UAAU,IAAI;AACd,iBAAK,OAAO,kBAAkB,OAAO,QAAQ,WAAW,MAAM;AAC9D,iBAAK,OAAO,MAAM;AAAA,UACtB,OAAO;AACH,kBAAM,aAAa,QAAQ,QAAQ,UAAU;AAC7C,gBAAI,eAAe,IAAI;AACnB,mBAAK,OAAO,kBAAkB,YAAY,aAAa,WAAW,MAAM;AACxE,mBAAK,OAAO,MAAM;AAAA,YACtB;AAAA,UACJ;AAAA,QACJ;AAAA,QAEA,aAAmB;AACf,cAAI,CAAC,KAAK,aAAa,CAAC,KAAK,gBAAgB,CAAC,KAAK,OAAQ;AAC3D,gBAAM,aAAa,KAAK,UAAU;AAClC,gBAAM,cAAc,KAAK,aAAa;AACtC,cAAI,CAAC,WAAY;AACjB,gBAAM,QAAQ,KAAK,OAAO;AAC1B,gBAAM,MAAM,KAAK,OAAO;AACxB,gBAAM,eAAe,KAAK,OAAO,MAAM,UAAU,OAAO,GAAG;AAC3D,cAAI,iBAAiB,YAAY;AAC7B,iBAAK,OAAO,aAAa,aAAa,OAAO,KAAK,KAAK;AACvD,iBAAK,aAAa;AAAA,UACtB;AACA,eAAK,SAAS;AAAA,QAClB;AAAA,QAEA,aAAmB;AACf,cAAI,CAAC,KAAK,aAAa,CAAC,KAAK,gBAAgB,CAAC,KAAK,OAAQ;AAC3D,gBAAM,aAAa,KAAK,UAAU;AAClC,gBAAM,cAAc,KAAK,aAAa;AACtC,cAAI,CAAC,WAAY;AACjB,gBAAM,SAAS,KAAK,OAAO,MAAM,MAAM,IAAI,OAAO,YAAY,GAAG,CAAC,KAAK,CAAC,GAAG;AAC3E,eAAK,OAAO,QAAQ,KAAK,OAAO,MAAM,MAAM,UAAU,EAAE,KAAK,WAAW;AACxE,eAAK,aAAa;AAClB,eAAK,YAAY,GAAG,KAAK,cAAc;AAAA,QAC3C;AAAA,QAEQ,YAAY,SAAuB;AACvC,cAAI,CAAC,KAAK,UAAW;AACrB,eAAK,UAAU,cAAc;AAC7B,eAAK,UAAU,MAAM,UAAU;AAC/B,qBAAW,MAAM;AACb,gBAAI,KAAK,UAAW,MAAK,UAAU,MAAM,UAAU;AAAA,UACvD,GAAG,GAAI;AAAA,QACX;AAAA;AAAA;AAAA;AAAA,QAKA,YAAiB;AACb,iBAAO;AAAA,YACH,GAAG,MAAM,UAAU;AAAA,YACnB,UAAU,KAAK;AAAA,YACf,UAAU,KAAK;AAAA,YACf,SAAS,KAAK;AAAA,UAClB;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,OAAO,YAAY,OAAgC;AAC/C,gBAAM,MAAM,IAAI,oBAAmB;AAAA,YAC/B,IAAI,MAAM;AAAA,YACV,OAAO,MAAM,SAAS,MAAM;AAAA,YAC5B,SAAS,MAAM;AAAA,UACnB,CAAC;AAED,cAAI,MAAM,SAAU,KAAI,WAAW,MAAM;AACzC,cAAI,MAAM,SAAU,KAAI,WAAW,MAAM;AACzC,cAAI,MAAM,YAAY,OAAW,KAAI,UAAU,MAAM;AAErD,iBAAO;AAAA,QACX;AAAA;AAAA;AAAA;AAAA,QAKU,SAAe;AACrB,cAAI,KAAK,UAAU,OAAO,KAAK,OAAO,UAAU,YAAY;AACxD,iBAAK,OAAO,MAAM;AAAA,UACtB;AAAA,QACJ;AAAA,MACJ;AAGA,MAAC,OAAe,qBAAqB;AAAA;AAAA;;;ACrarC,MAiBa;AAjBb;AAAA;AAAA;AAMA;AAWO,MAAM,mBAAN,MAAM,0BAAyB,WAAW;AAAA,QAC7C,YAAY,QAAgC;AACxC,gBAAM;AAAA,YACF,MAAM;AAAA,YACN,OAAO;AAAA,YACP,GAAG;AAAA,UACP,CAAC;AAAA,QACL;AAAA;AAAA;AAAA;AAAA,QAKA,YAAyB;AACrB,gBAAM,QAAQ,MAAM,UAAU;AAE9B,iBAAO;AAAA,QACX;AAAA;AAAA;AAAA;AAAA,QAKU,cAAoB;AAC1B,gBAAM,IAAI;AACV,cAAI,CAAC,EAAE,cAAc,CAAC,KAAK,QAAS;AAEpC,gBAAM,SAAS,KAAK,QAAQ,cAAc,IAAI,KAAK,EAAE,OAAO;AAC5D,cAAI,CAAC,OAAQ;AAGb,gBAAM,WAAW,CAAC,SAAc;AAAA,YAC5B,YAAY,IAAI;AAAA,YAChB,OAAO,IAAI;AAAA,YACX,UAAU,EAAE,UAAU,IAAI,MAAM;AAAA,YAChC,OAAO;AAAA,YACP,MAAM,MAAM,IAAI,KAAK;AAAA,YACrB,MAAM,MAAM,IAAI,KAAK;AAAA,UACzB;AACA,gBAAM,UAAU;AAAA,YACZ,iBAAiB,MAAM,MAAM,KAAK,KAAK,KAAK,OAAO,CAAC,EAAE,IAAI,QAAQ;AAAA,YAClE,mBAAmB,MAAM;AACrB,oBAAM,WAAW,KAAK;AACtB,oBAAMC,KAAI,WAAW,KAAK,KAAK,IAAI,QAAQ,IAAI;AAC/C,qBAAOA,KAAI,SAASA,EAAC,IAAI;AAAA,YAC7B;AAAA,YACA,mBAAmB,MAAM,MAAM,KAAK,KAAK,KAAK,KAAK,CAAC;AAAA,YACpD,aAAa,CAAC,OAAe;AACzB,oBAAMA,KAAI,KAAK,KAAK,IAAI,EAAE,KAAK;AAC/B,qBAAOA,KAAI,SAASA,EAAC,IAAI;AAAA,YAC7B;AAAA,YACA,mBAAmB,CAAC,OAAe,KAAK,aAAa,EAAE;AAAA,YACvD,gBAAgB,CAAC,QAAc;AAC3B,oBAAMC,KAAI;AACV,oBAAM,MAAMA,GAAE,qBACR,IAAIA,GAAE,mBAAmB;AAAA,gBACrB,QAAO,2BAAK,UAAS,UAAU,KAAK,KAAK,OAAO,CAAC;AAAA,cACrD,CAAC,IACD;AACN,kBAAI,KAAK;AACL,qBAAK,OAAO,GAAG;AACf,uBAAO,SAAS,GAAG;AAAA,cACvB;AACA,qBAAO;AAAA,YACX;AAAA,YACA,iBAAiB,CAAC,OAAe,KAAK,UAAU,EAAE;AAAA,YAClD,kBAAkB,MAAM,KAAK,KAAK;AAAA,YAClC,kBAAkB,CAAC,aAAuB;AACtC,oBAAM,MAAM,KAAK;AACjB,oBAAM,UAAU,oBAAI,IAAiB;AACrC,uBAAS,QAAQ,QAAM;AACnB,sBAAMD,KAAI,IAAI,IAAI,EAAE;AACpB,oBAAIA,GAAG,SAAQ,IAAI,IAAIA,EAAC;AAAA,cAC5B,CAAC;AACD,kBAAI,QAAQ,CAACA,IAAG,OAAO;AACnB,oBAAI,CAAC,QAAQ,IAAI,EAAE,EAAG,SAAQ,IAAI,IAAIA,EAAC;AAAA,cAC3C,CAAC;AACD,cAAC,KAAa,OAAO;AACrB,mBAAK,YAAY;AAAA,YACrB;AAAA,YACA,gBAAgB,CAAC,OAAe;AAC5B,oBAAMA,KAAI,KAAK,UAAU,EAAE;AAC3B,qBAAOA,KAAI,SAASA,EAAC,IAAI;AAAA,YAC7B;AAAA,YACA,eAAe,CAAC,SAAc;AAC1B,oBAAM,MAAM,KAAK,SAAS;AAC1B,mBAAK,OAAO,GAAG;AACf,mBAAK,aAAa,IAAI,EAAE;AACxB,qBAAO,SAAS,GAAG;AAAA,YACvB;AAAA,UACJ;AAGA,cAAK,KAAa,eAAe;AAC7B,YAAC,KAAa,cAAc,QAAQ;AAAA,UACxC;AAGA,UAAC,KAAa,gBAAgB,EAAE,WAAW,OAAO,SAAS,QAAuB;AAAA,YAC9E,WAAW;AAAA,YACX,uBAAuB,MAAM,UAAU,KAAK,KAAK,OAAO,CAAC;AAAA,UAC7D,CAAC;AAAA,QACL;AAAA;AAAA;AAAA;AAAA,QAKA,eAAe,OAAgB,SAAkC;AAC7D,gBAAM,IAAI;AACV,cAAI,CAAC,EAAE,oBAAoB;AACvB,oBAAQ,MAAM,qCAAqC;AACnD,mBAAO;AAAA,UACX;AAEA,gBAAM,MAAM,IAAI,EAAE,mBAAmB;AAAA,YACjC,OAAO,SAAS,UAAU,KAAK,KAAK,OAAO,CAAC;AAAA,YAC5C,SAAS,EAAE,SAAS,WAAW,GAAG;AAAA,UACtC,CAAC;AAED,eAAK,OAAO,GAAG;AACf,iBAAO;AAAA,QACX;AAAA;AAAA;AAAA;AAAA,QAKA,OAAO,OAAO,QAAkD;AAC5D,gBAAME,UAAS,IAAI,kBAAiB,MAAM;AAG1C,UAAAA,QAAO,eAAe;AAGtB,UAAAA,QAAO,KAAK;AAGZ,gBAAM,IAAI;AACV,cAAI,EAAE,gBAAgB;AAClB,cAAE,eAAe,eAAeA,OAAM;AAAA,UAC1C;AAEA,iBAAOA;AAAA,QACX;AAAA,MACJ;AAGA,MAAC,OAAe,mBAAmB;AAAA;AAAA;;;ACjKnC;AAAA;AAAA;AAEA;AAFA,cAAQ,IAAI,gCAAgC;AAQ5C,OAAC,MAAM;AACH;AASA,cAAM,OAAQ,OAAuD;AAAA,QAErE,MAAM,2BAA2B,KAAK;AAAA,UAgBlC,YAAY,QAAiC;AACzC,kBAAM;AAAA,cACF,GAAG;AAAA,cACH,MAAM;AAAA,YACV,CAAC;AAED,iBAAK,SAAS;AACd,iBAAK,YAAY;AACjB,iBAAK,aAAa;AAClB,iBAAK,YAAY;AACjB,iBAAK,mBAAmB;AACxB,iBAAK,iBAAiB;AACtB,iBAAK,mBAAmB;AACxB,iBAAK,YAAY;AACjB,iBAAK,eAAe;AAEpB,iBAAK,WAAW;AAChB,iBAAK,oBAAoB;AACzB,iBAAK,kBACC,OAAmC,YAAuB;AAChE,iBAAK,UAAU;AAAA,UACnB;AAAA,UAEU,SAAe;AACrB,gBAAI,CAAC,KAAK,UAAW;AACrB,kBAAM,SAAS,SAAS,gBAAgB,UAAU,SAAS,MAAM;AACjE,iBAAK,UAAU,YAAY;AAAA,2FACoD,SAAS,YAAY,SAAS,YAAY,SAAS,YAAY,SAAS;AAAA;AAAA,oFAE/E,SAAS,YAAY,SAAS,iDAAiD,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yEAiBxH,SAAS,YAAY,SAAS,iDAAiD,SAAS,YAAY,SAAS;AAAA,mIACnD,SAAS,YAAY,SAAS,qCAAqC,SAAS,YAAY,SAAS;AAAA,wIAC5F,SAAS,YAAY,SAAS,qCAAqC,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uGAQlI,SAAS,YAAY,SAAS,iBAAiB,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6CAMvI,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA,sFAIW,SAAS,YAAY,SAAS,8CAA8C,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAMpL,iBAAK,mBAAmB;AAAA,UAC5B;AAAA,UAEQ,qBAA2B;AAC/B,gBAAI,CAAC,KAAK,UAAW;AACrB,kBAAM,SAAS,SAAS,gBAAgB,UAAU,SAAS,MAAM;AACjE,kBAAM,UAAU,KAAK,UAAU;AAAA,cAC3B;AAAA,YACJ;AACA,oBAAQ,QAAQ,SAAO;AACnB,cAAC,IAAoB,MAAM,UAAU;AAAA;AAAA;AAAA,wCAGb,SAAS,YAAY,SAAS;AAAA,kCACpC,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAMpD,CAAC;AACD,kBAAM,aAAa,KAAK,UAAU,iBAAiB,oBAAoB;AACvE,uBAAW,QAAQ,SAAO;AACtB,cAAC,IAAoB,MAAM,UAAU;AAAA;AAAA;AAAA,kCAGnB,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA,YAGpD,CAAC;AAAA,UACL;AAAA,UAEU,uBAA6B;AA5I/C;AA6IY,gBAAI,CAAC,KAAK,UAAW;AACrB,iBAAK,SAAS,KAAK,UAAU;AAAA,cACzB;AAAA,YACJ;AACA,iBAAK,YAAY,KAAK,UAAU,cAAc,mBAAmB;AACjE,iBAAK,aAAa,KAAK,UAAU,cAAc,sBAAsB;AACrE,iBAAK,YAAY,KAAK,UAAU;AAAA,cAC5B;AAAA,YACJ;AACA,iBAAK,mBAAmB,KAAK,UAAU,cAAc,qBAAqB;AAC1E,iBAAK,iBAAiB,KAAK,UAAU,cAAc,mBAAmB;AACtE,iBAAK,mBAAmB,KAAK,UAAU,cAAc,qBAAqB;AAC1E,iBAAK,YAAY,KAAK,UAAU,cAAc,aAAa;AAC3D,iBAAK,eAAe,KAAK,UAAU;AAAA,cAC/B;AAAA,YACJ;AAGA,gBACI,CAAC,KAAK,sBACN,KAAK,SACJ,KAAK,MAAkC,WACxC,KAAK,QACP;AACE,mBAAK,OAAO,QAAS,KAAK,MAAkC;AAAA,YAChE;AAEA,uBAAK,WAAL,mBAAa,iBAAiB,SAAS,MAAM,KAAK,aAAa;AAC/D,uBAAK,WAAL,mBAAa,iBAAiB,SAAS,MAAM,KAAK,sBAAsB;AACxE,uBAAK,WAAL,mBAAa,iBAAiB,SAAS,MAAM,KAAK,sBAAsB;AACxE,uBAAK,WAAL,mBAAa,iBAAiB,UAAU,MAAM,KAAK,sBAAsB;AAEzE,iBAAK,UAAU,iBAAiB,SAAS,OAAK;AAC1C,oBAAM,SAAS,EAAE;AACjB,oBAAM,MAAM,iCAAQ,QAAQ;AAC5B,kBAAI,CAAC,IAAK;AACV,oBAAM,SAAS,IAAI,aAAa,aAAa;AAC7C,mBAAK,cAAc,MAAM;AAAA,YAC7B,CAAC;AAED,gBAAI,KAAK,WAAW;AAChB,mBAAK,UAAU;AAAA,gBAAiB;AAAA,gBAAU,OACtC,KAAK,gBAAgB,CAAqB;AAAA,cAC9C;AAAA,YACJ;AAEA,iBAAK,iBAAiB;AACtB,iBAAK,sBAAsB;AAC3B,iBAAK,oBAAoB;AAAA,UAC7B;AAAA,UAEQ,cAAc,QAAsB;AACxC,kBAAM,UAAsC;AAAA,cACxC,OAAO,MAAM,KAAK,aAAa;AAAA,cAC/B,MAAM,MAAM,KAAK,SAAS;AAAA,cAC1B,MAAM,MAAM,KAAK,SAAS;AAAA,cAC1B,MAAM,MAAM,KAAK,eAAe,MAAM,IAAI;AAAA,cAC1C,QAAQ,MAAM,KAAK,eAAe,KAAK,GAAG;AAAA,cAC1C,WAAW,MAAM,KAAK,eAAe,OAAO,MAAM;AAAA,cAClD,MAAM,MAAM,KAAK,kBAAkB;AAAA,cACnC,YAAY,MAAM,KAAK,eAAe;AAAA,cACtC,UAAU,MAAM,KAAK,SAAS;AAAA,cAC9B,YAAY,MAAM,KAAK,WAAW;AAAA,cAClC,YAAY,MAAM,KAAK,WAAW;AAAA,cAClC,kBAAkB,MAAM,KAAK,iBAAiB;AAAA,YAClD;AACA,gBAAI,QAAQ,MAAM,EAAG,SAAQ,MAAM,EAAE;AAAA,UACzC;AAAA,UAEQ,eAAqB;AACzB,iBAAK,UAAU;AACf,gBAAI,KAAK,QAAQ;AACb,mBAAK,YAAY,EAAE,SAAS,KAAK,OAAO,MAAM,CAAC;AAC/C,mBAAK,iBAAiB;AACtB,mBAAK,kBAAkB;AACvB,oBAAM,OACF,KAAK,UAGP;AACF,mBAAK,KAAK,MAAM,kBAAkB,EAAE,SAAS,KAAK,OAAO,MAAM,CAAC;AAAA,YACpE;AAAA,UACJ;AAAA,UAEQ,mBAAyB;AAC7B,gBAAI,CAAC,KAAK,UAAU,CAAC,KAAK,iBAAkB;AAC5C,kBAAM,OAAO,KAAK,OAAO;AACzB,kBAAM,QAAQ,KAAK,KAAK,IAAI,KAAK,KAAK,EAAE,MAAM,KAAK,EAAE,SAAS;AAC9D,kBAAM,QAAQ,KAAK;AACnB,iBAAK,iBAAiB,cAAc,cAAW,KAAK,eAAe,KAAK;AAAA,UAC5E;AAAA,UAEQ,wBAA8B;AAClC,gBAAI,CAAC,KAAK,UAAU,CAAC,KAAK,eAAgB;AAC1C,kBAAM,MAAM,KAAK,OAAO;AACxB,kBAAM,mBAAmB,KAAK,OAAO,MAAM,UAAU,GAAG,GAAG;AAC3D,kBAAM,QAAQ,iBAAiB,MAAM,KAAK,KAAK,CAAC,GAAG,SAAS;AAC5D,kBAAM,cAAc,iBAAiB,YAAY,IAAI;AACrD,kBAAM,MAAM,MAAM;AAClB,iBAAK,eAAe,cAAc,SAAS,IAAI,YAAY,GAAG;AAC9D,iBAAK,YAAY,EAAE,gBAAgB,EAAE,MAAM,IAAI,EAAE,CAAC;AAAA,UACtD;AAAA,UAEQ,oBAA0B;AAC9B,gBAAI,CAAC,KAAK,WAAY;AACtB,gBAAI,KAAK,SAAS;AACd,cAAC,KAAK,WAA2B,MAAM,aAAa;AACpD,cAAC,KAAK,WAA2B,aAAa,SAAS,yBAAsB;AAAA,YACjF,OAAO;AACH,cAAC,KAAK,WAA2B,MAAM,aAAa;AACpD,cAAC,KAAK,WAA2B,aAAa,SAAS,WAAW;AAAA,YACtE;AAAA,UACJ;AAAA,UAEA,eAAqB;AACjB,gBAAI,KAAK,WAAW,CAAC,QAAQ,0DAAuD,GAAG;AACnF;AAAA,YACJ;AACA,gBAAI,KAAK,OAAQ,MAAK,OAAO,QAAQ;AACrC,iBAAK,kBAAkB;AACvB,iBAAK,UAAU;AACf,iBAAK,YAAY,EAAE,SAAS,IAAI,UAAU,KAAK,gBAAgB,CAAC;AAChE,iBAAK,iBAAiB;AACtB,iBAAK,kBAAkB;AACvB,iBAAK,eAAe;AACpB,kBAAM,OACF,KAAK,UAGP;AACF,iBAAK,KAAK,MAAM,gBAAgB;AAAA,UACpC;AAAA,UAEA,WAAiB;AAlRzB;AAmRY,uBAAK,cAAL,mBAAgB;AAAA,UACpB;AAAA,UAEQ,gBAAgB,OAAoB;AAtRpD;AAuRY,kBAAM,SAAS,MAAM;AACrB,kBAAM,QAAO,sCAAQ,UAAR,mBAAgB;AAC7B,gBAAI,CAAC,KAAM;AACX,kBAAM,SAAS,IAAI,WAAW;AAC9B,mBAAO,SAAS,OAAK;AACjB,oBAAM,SAAU,EAAE,OAAsB;AACxC,kBAAI,KAAK,OAAQ,MAAK,OAAO,QAAQ;AACrC,mBAAK,kBAAkB,KAAK;AAC5B,mBAAK,UAAU;AACf,mBAAK,YAAY,EAAE,SAAS,QAAQ,UAAU,KAAK,KAAK,CAAC;AACzD,mBAAK,iBAAiB;AACtB,mBAAK,kBAAkB;AACvB,mBAAK,eAAe,gBAAa,KAAK,IAAI,EAAE;AAC5C,oBAAM,OACF,KAAK,UAGP;AACF,mBAAK,KAAK,MAAM,cAAc,EAAE,UAAU,KAAK,KAAK,CAAC;AAAA,YACzD;AACA,mBAAO,WAAW,IAAI;AAAA,UAC1B;AAAA,UAEA,WAAiB;AA9SzB;AA+SY,kBAAM,YAAU,UAAK,WAAL,mBAAa,UAAS;AACtC,kBAAM,OAAO,IAAI,KAAK,CAAC,OAAO,GAAG,EAAE,MAAM,aAAa,CAAC;AACvD,kBAAM,MAAM,IAAI,gBAAgB,IAAI;AACpC,kBAAM,IAAI,SAAS,cAAc,GAAG;AACpC,cAAE,OAAO;AACT,cAAE,WAAW,KAAK;AAClB,cAAE,MAAM;AACR,gBAAI,gBAAgB,GAAG;AACvB,iBAAK,UAAU;AACf,iBAAK,kBAAkB;AACvB,iBAAK,eAAe,gBAAgB,KAAK,eAAe,EAAE;AAC1D,kBAAM,OACF,KAAK,UAGP;AACF,iBAAK,KAAK,MAAM,aAAa,EAAE,UAAU,KAAK,gBAAgB,CAAC;AAAA,UACnE;AAAA,UAEQ,eAAe,QAAgB,OAAqB;AACxD,gBAAI,CAAC,KAAK,OAAQ;AAClB,kBAAM,QAAQ,KAAK,OAAO;AAC1B,kBAAM,MAAM,KAAK,OAAO;AACxB,kBAAM,eAAe,KAAK,OAAO,MAAM,UAAU,OAAO,GAAG;AAC3D,kBAAM,cAAc,SAAS,eAAe;AAC5C,iBAAK,OAAO,aAAa,aAAa,OAAO,KAAK,QAAQ;AAC1D,iBAAK,OAAO,MAAM;AAClB,iBAAK,aAAa;AAAA,UACtB;AAAA,UAEA,iBAAuB;AACnB,iBAAK,WAAW,KAAK,aAAa,SAAS,QAAQ;AACnD,gBAAI,KAAK,QAAQ;AACb,mBAAK,OAAO,OAAO,KAAK;AACxB,mBAAK,OAAO,MAAM,aAAa,KAAK,aAAa,SAAS,aAAa;AAAA,YAC3E;AACA,gBAAI;AACA;AAAA,gBACI,sBAAuB,KAA2C,UAAU;AAAA,gBAC5E,KAAK;AAAA,cACT;AAAA,YACJ,SAAS,GAAG;AACR,sBAAQ,KAAK,4BAA4B,CAAC;AAAA,YAC9C;AACA,iBAAK,YAAY,EAAE,UAAU,KAAK,SAAS,CAAC;AAC5C,iBAAK;AAAA,cACD,KAAK,aAAa,SAAS,4BAA4B;AAAA,YAC3D;AAAA,UACJ;AAAA,UAEQ,sBAA4B;AAChC,gBAAI;AACA,oBAAM,KAAM,KAA2C;AACvD,oBAAM,QAAQ,UAAU,sBAAsB,EAAE,EAAE;AAClD,kBAAI,SAAS,KAAK,QAAQ;AACtB,qBAAK,WAAW;AAChB,qBAAK,OAAO,OAAO,KAAK;AACxB,qBAAK,OAAO,MAAM,aAAa,KAAK,aAAa,SAAS,aAAa;AAAA,cAC3E;AAAA,YACJ,SAAS,GAAG;AACR,sBAAQ,KAAK,4BAA4B,CAAC;AAAA,YAC9C;AAAA,UACJ;AAAA,UAEA,oBAA0B;AA/WlC;AAgXY,gBAAI,CAAC,KAAK,iBAAkB;AAC5B,kBAAM,WAAW,KAAK,iBAAiB,MAAM,YAAY;AACzD,iBAAK,iBAAiB,MAAM,UAAU,WAAW,SAAS;AAC1D,gBAAI,YAAY,KAAK,UAAW,MAAK,UAAU,MAAM;AAAA,gBAChD,YAAK,WAAL,mBAAa;AAAA,UACtB;AAAA,UAEA,mBAAyB;AAvXjC;AAwXY,gBAAI,KAAK,kBAAkB;AACvB,mBAAK,iBAAiB,MAAM,UAAU;AACtC,yBAAK,WAAL,mBAAa;AAAA,YACjB;AAAA,UACJ;AAAA,UAEA,WAAiB;AACb,gBAAI,CAAC,KAAK,aAAa,CAAC,KAAK,OAAQ;AACrC,kBAAM,aAAa,KAAK,UAAU;AAClC,gBAAI,CAAC,WAAY;AACjB,kBAAM,UAAU,KAAK,OAAO;AAC5B,kBAAM,aAAa,KAAK,OAAO;AAC/B,kBAAM,QAAQ,QAAQ,QAAQ,YAAY,UAAU;AACpD,gBAAI,UAAU,IAAI;AACd,mBAAK,OAAO,kBAAkB,OAAO,QAAQ,WAAW,MAAM;AAC9D,mBAAK,OAAO,MAAM;AAAA,YACtB,OAAO;AACH,oBAAM,aAAa,QAAQ,QAAQ,UAAU;AAC7C,kBAAI,eAAe,IAAI;AACnB,qBAAK,OAAO,kBAAkB,YAAY,aAAa,WAAW,MAAM;AACxE,qBAAK,OAAO,MAAM;AAAA,cACtB,OAAO;AACH,qBAAK,eAAe,gBAAgB;AAAA,cACxC;AAAA,YACJ;AAAA,UACJ;AAAA,UAEA,aAAmB;AACf,gBAAI,CAAC,KAAK,aAAa,CAAC,KAAK,gBAAgB,CAAC,KAAK,OAAQ;AAC3D,kBAAM,aAAa,KAAK,UAAU;AAClC,kBAAM,cAAc,KAAK,aAAa;AACtC,gBAAI,CAAC,WAAY;AACjB,kBAAM,QAAQ,KAAK,OAAO;AAC1B,kBAAM,MAAM,KAAK,OAAO;AACxB,kBAAM,eAAe,KAAK,OAAO,MAAM,UAAU,OAAO,GAAG;AAC3D,gBAAI,iBAAiB,YAAY;AAC7B,mBAAK,OAAO,aAAa,aAAa,OAAO,KAAK,KAAK;AACvD,mBAAK,aAAa;AAAA,YACtB;AACA,iBAAK,SAAS;AAAA,UAClB;AAAA,UAEA,aAAmB;AACf,gBAAI,CAAC,KAAK,aAAa,CAAC,KAAK,gBAAgB,CAAC,KAAK,OAAQ;AAC3D,kBAAM,aAAa,KAAK,UAAU;AAClC,kBAAM,cAAc,KAAK,aAAa;AACtC,gBAAI,CAAC,WAAY;AACjB,kBAAM,aAAa,KAAK,OAAO,MAAM,MAAM,UAAU,EAAE,KAAK,WAAW;AACvE,kBAAM,SAAS,KAAK,OAAO,MAAM,MAAM,IAAI,OAAO,YAAY,GAAG,CAAC,KAAK,CAAC,GAAG;AAC3E,iBAAK,OAAO,QAAQ;AACpB,iBAAK,aAAa;AAClB,iBAAK,eAAe,GAAG,KAAK,0BAA0B;AAAA,UAC1D;AAAA,UAEQ,eAAe,SAAuB;AAC1C,gBAAI,CAAC,KAAK,UAAW;AACrB,iBAAK,UAAU,cAAc;AAC7B,iBAAK,UAAU,MAAM,UAAU;AAC/B,uBAAW,MAAM,KAAK,eAAe,GAAG,GAAI;AAAA,UAChD;AAAA,UAEQ,iBAAuB;AAC3B,gBAAI,KAAK,UAAW,MAAK,UAAU,MAAM,UAAU;AAAA,UACvD;AAAA,UAEA,OAAa;AACT,kBAAM,WAAY,KAAK,UAA8C;AACrE,qBAAS,KAAK,IAAI;AAGlB,gBAAI,KAAK,WAAW;AAChB,mBAAK,SAAS,KAAK,UAAU;AAAA,gBACzB;AAAA,cACJ;AAAA,YACJ;AAGA,gBAAI,KAAK,UAAU,KAAK,SAAS,OAAQ,KAAK,MAAc,YAAY,UAAU;AAC9E,mBAAK,OAAO,QAAS,KAAK,MAAc;AACxC,mBAAK,iBAAiB;AACtB,mBAAK,sBAAsB;AAAA,YAC/B;AAAA,UACJ;AAAA,UAEA,QAAc;AA5ctB;AA6cY,kBAAM,YAAa,KAAK,UAA+C;AACvE,sBAAU,KAAK,IAAI;AACnB,uBAAK,WAAL,mBAAa;AAAA,UACjB;AAAA,UAEA,YAAqC;AAld7C;AAmdY,kBAAM,gBACF,KAAK,UAGP;AACF,kBAAM,UAAU,cAAc,KAAK,IAAI;AACvC,mBAAO;AAAA,cACH,GAAG;AAAA,cACH,WAAS,UAAK,WAAL,mBAAa,UAAS;AAAA,cAC/B,UAAU,KAAK;AAAA,cACf,UAAU,KAAK;AAAA,cACf,SAAS,KAAK;AAAA,YAClB;AAAA,UACJ;AAAA,UAEA,YAAY,MAAqC;AAC7C,kBAAM,kBACF,KAAK,UAGP;AACF,4BAAgB,KAAK,MAAM,IAAI;AAE/B,kBAAM,IAAI;AAMV,gBAAI,EAAE,WAAW,KAAK,QAAQ;AAC1B,mBAAK,OAAO,QAAQ,EAAE;AACtB,mBAAK,iBAAiB;AAAA,YAC1B;AACA,gBAAI,EAAE,SAAU,MAAK,kBAAkB,EAAE;AACzC,gBAAI,EAAE,UAAU;AACZ,mBAAK,WAAW,EAAE;AAClB,kBAAI,KAAK,QAAQ;AACb,qBAAK,OAAO,OAAO,KAAK;AACxB,qBAAK,OAAO,MAAM,aAAa,KAAK,aAAa,SAAS,aAAa;AAAA,cAC3E;AAAA,YACJ;AACA,gBAAI,OAAO,EAAE,YAAY,aAAa;AAClC,mBAAK,UAAU,EAAE;AACjB,mBAAK,kBAAkB;AAAA,YAC3B;AAAA,UACJ;AAAA,QACJ;AAEA,QAAC,OAAwE,qBACrE;AAIJ,cAAM,IAAI;AAGV,cAAM,kCAAkC,MAAM;AAC1C,cAAI,EAAE,2BAA2B,EAAG,QAAO;AAE3C,gBAAM,kBAAkB,EAAE,iBAAiB;AAC3C,cAAI,CAAC,iBAAiB;AAClB,mBAAO;AAAA,UACX;AAEA,cAAI;AACA,YAAC,EAAE,2BAA2B,IAC1B,IAAK,gBAAwC;AAAA,cACzC,MAAM;AAAA,cACN,eAAe;AAAA,cACf,cAAc;AAAA,cACd,iBAAiB,SAAU,YAAwC;AAC/D,sBAAM,uBACF,SAAS,eAAe,uBAAuB;AACnD,oBAAI,CAAC,sBAAsB;AACvB,0BAAQ,MAAM,iCAAiC;AAC/C,yBAAO;AAAA,gBACX;AACA,sBAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,0BAAU,KAAK,GAAG,UAAU;AAC5B,0BAAU,YAAY;AAEtB,sBAAM,WACF,OACF;AACF,oBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,2BAAS,KAAK,SAAS;AAAA,gBAC3B,OAAO;AACH,4BAAU,UAAU,IAAI,QAAQ;AAAA,gBACpC;AACA,qCAAqB,YAAY,SAAS;AAC1C,uBAAO;AAAA,cACX;AAAA,YACJ,CAAC;AACL,oBAAQ,IAAI,wDAAwD;AACpE,mBAAO;AAAA,UACX,SAAS,KAAK;AACV,oBAAQ,MAAM,oEAAoE,GAAG;AACrF,mBAAO;AAAA,UACX;AAAA,QACJ;AAGA,YAAI,CAAC,gCAAgC,GAAG;AAGpC,gBAAM,WAAW,MAAM;AACnB,gBAAI,gCAAgC,GAAG;AAEnC;AAAA,YACJ;AAEA,uBAAW,UAAU,GAAG;AAAA,UAC5B;AAGA,kBAAQ,QAAQ,EAAE,KAAK,QAAQ;AAAA,QACnC;AAAA,MACJ,GAAG;AAAA;AAAA;;;ACxkBH,MA4BM,cAaO,uBAsLN;AA/NP;AAAA;AAAA;AAAA;AA4BA,MAAM,eAAgB,OAAuC;AAatD,MAAM,wBAAN,cAAoC,6BAAmB;AAAA,QAI1D,YAAY,QAA0B;AAClC,gBAAM,MAAM;AAHhB,eAAQ,cAAwB,CAAC;AAK7B,eAAK,YAAY;AAAA,YACb,MAAM;AAAA,YACN,QAAQ,CAAC;AAAA,YACT,cAAc;AAAA,UAClB,CAAC;AAAA,QACL;AAAA,QAEA,SAAe;AAvDnB;AAwDQ,cAAI,CAAC,KAAK,UAAW;AACrB,eAAK,UAAU,YAAY;AAC3B,gBAAM,WAAW,aAAa,eAAe;AAAA,YACzC,OAAO,KAAK;AAAA,YACZ,MAAM;AAAA,YACN,WAAW;AAAA,YACX,cAAc;AAAA,YACd,cAAc;AAAA,YACd,SAAS,MAAM,KAAK,QAAQ;AAAA,UAChC,CAAC;AACD,eAAK,UAAU,YAAY,QAAQ;AAGnC,gBAAM,UAAU,aAAa,cAAc;AAAA,YACvC,EAAE,OAAO,WAAW,MAAM,cAAO,SAAS,MAAM,KAAK,OAAO,EAAE;AAAA,YAC9D,EAAE,OAAO,YAAY,MAAM,cAAO,SAAS,MAAM,KAAK,QAAQ,EAAE;AAAA,YAChE,EAAE,MAAM,YAAY;AAAA,YACpB,EAAE,OAAO,YAAY,MAAM,gBAAM,SAAS,MAAM,KAAK,UAAU,EAAE;AAAA,YACjE,EAAE,OAAO,QAAQ,MAAM,gBAAM,SAAS,MAAM,KAAK,UAAU,EAAE;AAAA,UACjE,CAAC;AACD,eAAK,UAAU,YAAY,OAAO;AAGlC,gBAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,oBAAU,YAAY;AACtB,oBAAU,MAAM,SAAS;AACzB,oBAAU,MAAM,WAAW;AAC3B,oBAAU,SAAS,OAAK,KAAK,WAAW,CAAC;AACzC,oBAAU,aAAa,OAAK,EAAE,eAAe;AAE7C,gBAAM,KAAK,KAAK,SAAS;AACzB,gBAAM,SAAS,GAAG,UAAU,CAAC;AAC7B,gBAAM,OAAM,QAAG,iBAAH,YAAmB;AAG/B,cAAI;AACA,kBAAM,OAAO,KAAK,eAAe,CAAC;AAClC,kBAAM,UAAU,KAAK,OAAO,OAAK,KAAK,EAAE,WAAW,OAAO,KAAK,CAAC,OAAO,SAAS,CAAC,CAAC;AAClF,oBAAQ,QAAQ,OAAK;AACjB,kBAAI;AACA,oBAAI,gBAAgB,CAAC;AAAA,cACzB,SAAS,GAAG;AAAA,cAAC;AAAA,YACjB,CAAC;AAAA,UACL,SAAS,GAAG;AAAA,UAAC;AAEb,cAAI,OAAO,SAAS,KAAK,OAAO,GAAG,GAAG;AAClC,kBAAM,MAAM,SAAS,cAAc,KAAK;AACxC,gBAAI,MAAM,OAAO,GAAG;AACpB,gBAAI,MAAM,WAAW;AACrB,gBAAI,MAAM,YAAY;AACtB,gBAAI,MAAM,YAAY,UAAS,QAAG,SAAH,YAAW,CAAC;AAC3C,gBAAI,MAAM,UAAU;AACpB,gBAAI,MAAM,aAAa;AACvB,gBAAI,YAAY;AAChB,gBAAI,iBAAiB,eAAe,OAAK,KAAK,gBAAgB,CAAC,CAAC;AAChE,gBAAI,iBAAiB,QAAQ,MAAM;AAC/B,kBAAI,MAAM,aAAa;AACvB,kBAAI,MAAM,UAAU;AAAA,YACxB,CAAC;AACD,gBAAI,iBAAiB,SAAS,MAAM;AAAA,YAEpC,CAAC;AACD,sBAAU,YAAY,GAAG;AAAA,UAC7B,OAAO;AAEH,kBAAM,cAAc,SAAS,cAAc,KAAK;AAChD,wBAAY,YAAY;AACxB,wBAAY,cAAc;AAC1B,sBAAU,YAAY,WAAW;AAAA,UACrC;AACA,eAAK,UAAU,YAAY,SAAS;AAGpC,eAAK,cAAc,OAAO,MAAM;AAGhC,gBAAM,UAAU,OAAO,SAAS,IAAI,GAAG,MAAM,CAAC,MAAM,OAAO,MAAM,KAAK;AACtE,gBAAM,YAAY,aAAa,gBAAgB;AAAA,YAC3C,aAAa,GAAG,QAAQ;AAAA,YACxB,cAAc,SAAS,KAAK,OAAO,GAAG,QAAQ,KAAK,GAAG,CAAC,KAAK,OAAO;AAAA,UACvE,CAAC;AACD,eAAK,UAAU,YAAY,SAAS;AAGpC,eAAK,wBAAwB;AAAA,QACjC;AAAA,QAEA,0BAA0B;AAEtB,cAAI,KAAK,iBAAiB;AACtB,qBAAS,oBAAoB,WAAW,KAAK,eAAe;AAAA,UAChE;AACA,eAAK,kBAAkB,CAAC,MAAqB;AACzC,gBAAI,CAAC,KAAK,UAAW;AACrB,gBAAI,EAAE,QAAQ,aAAa;AACvB,gBAAE,eAAe;AACjB,mBAAK,UAAU;AAAA,YACnB,WAAW,EAAE,QAAQ,cAAc;AAC/B,gBAAE,eAAe;AACjB,mBAAK,UAAU;AAAA,YACnB;AAAA,UACJ;AACA,mBAAS,iBAAiB,WAAW,KAAK,eAAe;AAAA,QAC7D;AAAA,QAEA,SAAS;AACL,gBAAM,KAAK,KAAK,SAAS;AACzB,eAAK,YAAY,EAAE,MAAM,KAAK,KAAK,GAAG,QAAQ,KAAK,KAAK,CAAC,EAAE,CAAC;AAC5D,eAAK,OAAO;AAAA,QAChB;AAAA,QACA,UAAU;AACN,gBAAM,KAAK,KAAK,SAAS;AACzB,eAAK,YAAY,EAAE,MAAM,KAAK,KAAK,GAAG,QAAQ,KAAK,KAAK,GAAG,EAAE,CAAC;AAC9D,eAAK,OAAO;AAAA,QAChB;AAAA,QACA,YAAY;AA3KhB;AA4KQ,gBAAM,KAAK,KAAK,SAAS;AACzB,gBAAM,SAAS,GAAG,UAAU,CAAC;AAC7B,cAAI,OAAO,WAAW,EAAG;AACzB,gBAAM,UAAS,QAAG,iBAAH,YAAmB,KAAK,KAAK,OAAO;AACnD,eAAK,YAAY,EAAE,cAAc,KAAK,CAAC;AACvC,eAAK,OAAO;AAAA,QAChB;AAAA,QACA,YAAY;AAnLhB;AAoLQ,gBAAM,KAAK,KAAK,SAAS;AACzB,gBAAM,SAAS,GAAG,UAAU,CAAC;AAC7B,cAAI,OAAO,WAAW,EAAG;AACzB,gBAAM,UAAS,QAAG,iBAAH,YAAmB,KAAK,IAAI,OAAO,UAAU,OAAO;AACnE,eAAK,YAAY,EAAE,cAAc,KAAK,CAAC;AACvC,eAAK,OAAO;AAAA,QAChB;AAAA,QACA,WAAW,GAAc;AA3L7B;AA4LQ,YAAE,eAAe;AACjB,gBAAM,SAAQ,OAAE,iBAAF,mBAAgB;AAC9B,cAAI,SAAS,MAAM,SAAS,KAAK,MAAM,CAAC,GAAG;AACvC,kBAAM,MAAM,IAAI,gBAAgB,MAAM,CAAC,CAAC;AACxC,iBAAK,YAAY,EAAE,QAAQ,CAAC,GAAG,GAAG,cAAc,EAAE,CAAC;AACnD,iBAAK,OAAO;AAAA,UAChB;AAAA,QACJ;AAAA,QACA,gBAAgB,GAAe;AAC3B,YAAE,eAAe;AAAA,QAErB;AAAA,QACA,UAAU;AAEN,cAAI,KAAK,iBAAiB;AACtB,qBAAS,oBAAoB,WAAW,KAAK,eAAe;AAAA,UAChE;AAEA,cAAI;AACA,aAAC,KAAK,eAAe,CAAC,GAAG,QAAQ,OAAK;AAClC,kBAAI,KAAK,EAAE,WAAW,OAAO,GAAG;AAC5B,oBAAI;AACA,sBAAI,gBAAgB,CAAC;AAAA,gBACzB,SAAS,GAAG;AAAA,gBAAC;AAAA,cACjB;AAAA,YACJ,CAAC;AAAA,UACL,SAAS,GAAG;AAAA,UAAC;AAEb,gBAAM,QAAQ;AAAA,QAClB;AAAA,MACJ;AAIA,MAAC,OAAwC,wBAAwB;AACjE,MAAO,kCAAQ;AAAA;AAAA;;;AC/Nf,MAEa,wBA6GN;AA/GP;AAAA;AAAA;AAAA;AAEO,MAAM,yBAAN,MAA6B;AAAA,QAMhC,OAAO,eAAe,SAAsC,CAAC,GAA0B;AACnF,eAAK;AACL,gBAAM,aAAa,GAAG,KAAK,IAAI,IAAI,KAAK,eAAe;AACvD,gBAAM,WAAW,IAAI,gCAAsB;AAAA,YACvC,IAAI;AAAA,YACJ,MAAM,KAAK;AAAA,YACX,OAAO,OAAO,OAAO,YAAY,OAAO,IAAI,KAAK;AAAA,YACjD,cAAc;AAAA,UAClB,CAAC;AACD,eAAK,UAAU,IAAI,YAAY,QAAQ;AACvC,iBAAO;AAAA,QACX;AAAA;AAAA,QAGA,OAAO,uBAAqD;AACxD,gBAAM,WAAW,KAAK,UAAU,IAAI,KAAK,WAAW;AACpD,cAAI,YAAa,SAAiB,cAAe,QAAO;AACxD,gBAAM,gBAAgB,SAAS,eAAe,mBAAmB;AACjE,cAAI,CAAC,eAAe;AAChB,oBAAQ,MAAM,gDAAgD;AAC9D,mBAAO;AAAA,UACX;AAEA,cAAI,gBAAgB,cAAc;AAAA,YAC9B;AAAA,UACJ;AACA,cAAI,CAAC,eAAe;AAChB,4BAAgB,SAAS,cAAc,KAAK;AAC5C,0BAAc,KAAK;AACnB,0BAAc,YAAY;AAC1B,0BAAc,YAAY,aAAa;AAAA,UAC3C;AACA,gBAAM,WAAW,IAAI,gCAAsB;AAAA,YACvC,IAAI,KAAK;AAAA,YACT,MAAM,KAAK;AAAA,YACX,OAAO;AAAA,YACP,cAAc,EAAE,QAAQ,CAAC,GAAG,cAAc,GAAG,MAAM,EAAE;AAAA,UACzD,CAAC;AACD,cAAI;AACA,qBAAS,KAAK,aAAa;AAAA,UAC/B,SAAS,GAAG;AACR,oBAAQ,MAAM,0CAA0C,CAAC;AACzD,mBAAO;AAAA,UACX;AACA,eAAK,UAAU,IAAI,KAAK,aAAa,QAAQ;AAC7C,iBAAO;AAAA,QACX;AAAA;AAAA,QAGA,OAAO,WAAW,QAAkB,aAAa,GAAG,MAAqB;AAzD7E;AA0DQ,cAAI,CAAC,MAAM,QAAQ,MAAM,KAAK,OAAO,WAAW,EAAG;AAEnD,cAAI;AACA,kBAAM,IAAI;AACV,iBAAI,aAAE,QAAF,mBAAO,WAAP,mBAAe,KAAM,GAAE,IAAI,OAAO,KAAK,eAAe;AAAA,gBACrD,eAAE,kBAAF,mBAAiB,SAAjB,4BAAwB;AAAA,UACjC,QAAQ;AAAA,UAAC;AAGT,cAAI;AACA,kBAAM,gBAAgB,SAAS,eAAe,mBAAmB;AACjE,gBAAI,eAAe;AACf,oBAAM,WAAY,OAAe;AACjC,kBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,yBAAS,KAAK,aAAa;AAAA,cAC/B,OAAO;AACH,8BAAc,UAAU,OAAO,QAAQ;AAAA,cAC3C;AACA,4BAAc,MAAM,gBAAgB;AAAA,YACxC;AAAA,UACJ,SAAS,GAAG;AAAA,UAEZ;AAEA,gBAAM,WAAW,KAAK,qBAAqB;AAC3C,cAAI,CAAC,SAAU;AACf,gBAAM,MAAM,KAAK,IAAI,GAAG,KAAK,IAAI,YAAY,OAAO,SAAS,CAAC,CAAC;AAC/D,mBAAS,YAAY,EAAE,QAAQ,cAAc,KAAK,MAAM,QAAQ,OAAU,CAAC;AAC3E,mBAAS,OAAO;AAEhB,WAAC,cAAiB,SAAjB;AAAA,QACL;AAAA,QAEA,OAAO,YAAY,YAAuD;AACtE,iBAAO,KAAK,UAAU,IAAI,UAAU;AAAA,QACxC;AAAA,QAEA,OAAO,gBAAgB,YAA0B;AAC7C,gBAAM,WAAW,KAAK,UAAU,IAAI,UAAU;AAC9C,cAAI,UAAU;AACV,qBAAS,QAAQ;AACjB,iBAAK,UAAU,OAAO,UAAU;AAAA,UACpC;AAAA,QACJ;AAAA,QAEA,OAAO,aAAmB;AACtB,eAAK,UAAU,QAAQ,cAAY,SAAS,QAAQ,CAAC;AACrD,eAAK,UAAU,MAAM;AAAA,QACzB;AAAA,MACJ;AAxGI,MADS,uBACF,OAAO;AACd,MAFS,uBAEF,YAAgD,oBAAI,IAAI;AAC/D,MAHS,uBAGF,kBAAkB;AACzB,MAJS,uBAIF,cAAc;AAwGzB,MAAC,OAA2C,yBAAyB;AACrE,MAAO,mCAAQ;AAAA;AAAA;;;AC/Gf,MA0BM,kBAsBO;AAhDb;AAAA;AAAA;AAsBA;AACA;AACA;AAEA,MAAM,mBAAmB;AAsBlB,MAAM,cAAN,MAAM,oBAAmB,QAAQ;AAAA,QAyCpC,YAAY,QAAyD;AAzFzE;AA0FQ,gBAAM;AAAA,YACF,MAAM;AAAA,YACN,QAAO,iCAAQ,UAAS;AAAA,YACxB,MAAM;AAAA,YACN,GAAG;AAAA,UACP,CAAC;AAbL,6BAAc;AACd,oCAAqB;AAIrB;AAAA,eAAQ,uBAAuB;AAU3B,eAAK,UAAS,iCAAQ,WAAU;AAChC,eAAK,cAAc,CAAC;AACpB,eAAK,WAAW;AAChB,eAAK,SAAS;AACd,eAAK,YAAY;AACjB,eAAK,gBAAgB,oBAAI,IAAI;AAC7B,eAAK,iBAAiB,CAAC;AACvB,eAAK,yBAAyB;AAC9B,eAAK,gBAAe,4CAAQ,YAAR,mBAAiB,iBAAjB,YAAiC;AAErD,eAAK,cAAc,CAAC;AACpB,eAAK,qBAAqB,oBAAI,IAAI;AAGlC,gBAAM,mBAAiB,sCAAQ,YAAR,mBAAiB,cAAa,CAAC;AACtD,eAAK,YAAY,IAAI,IAAI,cAAc;AAGvC,eAAK,cAAc,YAAW,gBAAgB;AAC9C,eAAK,iBAAiB,YAAW;AAGjC,eAAK,aAAa;AAGlB,eAAK,qBAAqB,oBAAI,IAAI;AAClC,eAAK,WAAW,IAAI,KAAK;AAEzB,eAAK,MAAM;AAAA,YACP,SAAS;AAAA,YACT,aAAa;AAAA,YACb,SAAS;AAAA,YACT,aAAa;AAAA,YACb,aAAa;AAAA,YACb,SAAS;AAAA,YACT,SAAS;AAAA,UACb;AAAA,QACJ;AAAA,QAEA,YAAyB;AACrB,gBAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,oBAAU,KAAK,GAAG,KAAK,EAAE;AACzB,oBAAU,YAAY;AAEtB,gBAAM,WAAW,KAAK,WAAW;AACjC,oBAAU,YAAY;AAAA;AAAA,sKAEwI,KAAK,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoE/K,eAAK,UAAU;AACf,eAAK,IAAI,UAAU,UAAU,cAAc,iBAAiB;AAC5D,eAAK,IAAI,cAAc,UAAU,cAAc,cAAc;AAC7D,eAAK,IAAI,UAAU,UAAU,cAAc,iBAAiB;AAC5D,eAAK,IAAI,UAAU,UAAU,cAAc,iBAAiB;AAC5D,eAAK,IAAI,UAAU,UAAU,cAAc,iBAAiB;AAC5D,eAAK,IAAI,cAAc;AACvB,eAAK,IAAI,cAAc;AAGvB,eAAK,cAAc;AACnB,eAAK,qBAAqB;AAC1B,eAAK,sBAAsB;AAC3B,eAAK,2BAA2B;AAChC,eAAK,WAAW;AAGhB,gBAAM,IAAI;AACV,cAAI,EAAE,SAAS;AACX,cAAE,QAAQ,kBAAkB,SAAS;AAAA,UACzC;AAEA,iBAAO;AAAA,QACX;AAAA,QAEQ,wBAA8B;AA7O1C;AA8OQ,gBAAM,UAAU,KAAK,IAAI;AACzB,gBAAM,UAAU,KAAK,IAAI;AACzB,gBAAM,eAAc,UAAK,YAAL,mBAAc;AAAA,YAC9B;AAAA;AAEJ,cAAI,CAAC,WAAW,CAAC,QAAS;AAE1B,gBAAM,WAAW;AACjB,gBAAM,WAAW;AAEjB,cAAI,SAAS;AACb,cAAI,aAAa;AACjB,cAAI,WAAW;AAEf,gBAAM,cAAc,CAAC,MAAkB;AACnC,gBAAI,CAAC,SAAU;AACf,kBAAM,KAAK,EAAE,UAAU;AACvB,gBAAI,WAAW,KAAK,IAAI,UAAU,KAAK,IAAI,aAAa,IAAI,QAAQ,CAAC;AAGrE,kBAAM,YAAY,KAAK;AACvB,gBAAI,WAAW;AACX,oBAAM,QAAQ,UAAU;AACxB,oBAAM,aAAa;AACnB,yBAAW,KAAK,IAAI,UAAU,KAAK,IAAI,QAAQ,YAAY,QAAQ,CAAC;AAAA,YACxE;AAEA,oBAAQ,MAAM,QAAQ,GAAG,QAAQ;AACjC,iBAAK,eAAe;AAAA,UACxB;AAEA,gBAAM,eAAe,MAAM;AACvB,gBAAI,CAAC,SAAU;AACf,uBAAW;AACX,qBAAS,oBAAoB,aAAa,WAAW;AACrD,qBAAS,oBAAoB,WAAW,YAAY;AACpD,qBAAS,KAAK,UAAU,OAAO,aAAa;AAC5C,iBAAK,cAAc;AAAA,UACvB;AAEA,kBAAQ,iBAAiB,aAAa,CAAC,MAAkB;AACrD,cAAE,eAAe;AACjB,uBAAW;AACX,qBAAS,EAAE;AACX,yBAAa,QAAQ,sBAAsB,EAAE;AAC7C,qBAAS,iBAAiB,aAAa,WAAW;AAClD,qBAAS,iBAAiB,WAAW,YAAY;AACjD,qBAAS,KAAK,UAAU,IAAI,aAAa;AAAA,UAC7C,CAAC;AAAA,QACL;AAAA,QAEQ,gBAAsB;AAC1B,cAAI,CAAC,KAAK,QAAS;AACnB,gBAAM,QAAQ,KAAK,QAAQ,cAAiC,6BAA6B;AACzF,gBAAM,UAAU,KAAK,QAAQ;AAAA,YACzB;AAAA,UACJ;AACA,gBAAM,UAAU,KAAK,QAAQ,cAAiC,2BAA2B;AACzF,gBAAM,UAAU,KAAK,QAAQ,cAAiC,2BAA2B;AACzF,gBAAM,cAAc,KAAK,QAAQ,cAAgC,gBAAgB;AACjF,gBAAM,gBAAgB,KAAK,QAAQ;AAAA,YAC/B;AAAA,UACJ;AACA,gBAAM,WAAW,KAAK,QAAQ,cAA2B,mBAAmB;AAC5E,gBAAM,cAAc,KAAK,QAAQ;AAAA,YAC7B;AAAA,UACJ;AAEA,yCAAO,iBAAiB,SAAS,MAAM,KAAK,WAAW;AACvD,6CAAS,iBAAiB,SAAS,MAAM,KAAK,OAAO;AACrD,6CAAS,iBAAiB,SAAS,MAAM,KAAK,YAAY,MAAM;AAChE,6CAAS,iBAAiB,SAAS,MAAM,KAAK,YAAY,MAAM;AAGhE,qDAAa,iBAAiB,SAAS,OAAK;AACxC,iBAAK,aAAc,EAAE,OAA4B;AACjD,iBAAK,cAAc;AAAA,UACvB;AAGA,yDAAe,iBAAiB,SAAS,MAAM;AAC3C,iDAAU,UAAU,OAAO;AAAA,UAC/B;AAGA,+CAAU,iBAAoC,eAAe,QAAQ,SAAO;AACxE,gBAAI,iBAAiB,SAAS,MAAM;AAChC,oBAAM,SAAS,IAAI,QAAQ;AAC3B,mBAAK,UAAU,MAAM;AACrB,uBAAS,UAAU,IAAI,QAAQ;AAAA,YACnC,CAAC;AAAA,UACL;AAEA,+CAAU,iBAAoC,gBAAgB,QAAQ,SAAO;AACzE,gBAAI,iBAAiB,SAAS,MAAM;AAChC,oBAAM,QAAQ,IAAI,QAAQ;AAC1B,mBAAK,aAAa,KAAK;AACvB,uBAAS,UAAU,IAAI,QAAQ;AAAA,YACnC,CAAC;AAAA,UACL;AAGA,mBAAS,iBAAiB,SAAS,OAAK;AACpC,gBACI,EAAC,+CAAe,SAAS,EAAE,YAC3B,EAAC,qCAAU,SAAS,EAAE,UACxB;AACE,mDAAU,UAAU,IAAI;AAAA,YAC5B;AAAA,UACJ,CAAC;AAGD,qDAAa,iBAAiB,SAAS,MAAM;AACzC,gBAAI,KAAK,YAAY,SAAS,GAAG;AAC7B,mBAAK,eAAe,KAAK,YAAY,KAAK,GAAG,CAAC;AAAA,YAClD;AAAA,UACJ;AAAA,QACJ;AAAA,QAEQ,uBAA6B;AACjC,cAAI,CAAC,KAAK,QAAS;AAGnB,gBAAM,iBACF,KAAK,QAAQ,iBAAoC,uBAAuB;AAC5E,yBAAe,QAAQ,SAAO;AAC1B,gBAAI,iBAAiB,SAAS,MAAM;AAChC,oBAAM,SAAS,IAAI,QAAQ;AAG3B,kBAAI,WAAW,QAAQ;AACnB,qBAAK,SAAS;AACd,qBAAK,cAAc,CAAC,QAAQ,QAAQ;AACpC,qBAAK,cAAc;AACnB,qBAAK,WAAW;AAAA,cACpB,WAAW,WAAW,YAAY;AAC9B,qBAAK,SAAS;AACd,qBAAK,OAAO;AAAA,cAChB,WAAW,WAAW,UAAU;AAC5B,qBAAK,SAAS;AACd,qBAAK,OAAO;AAAA,cAChB,WAAW,WAAW,UAAU;AAC5B,qBAAK,SAAS;AACd,qBAAK,OAAO;AAAA,cAChB,WAAW,WAAW,WAAW;AAC7B,qBAAK,SAAS;AACd,qBAAK,OAAO;AAAA,cAChB;AAGA,mBAAK,8BAA8B;AAAA,YACvC,CAAC;AAAA,UACL,CAAC;AAAA,QACL;AAAA,QAEQ,6BAAmC;AAzY/C;AA0YQ,cAAI,KAAK,wBAAwB;AAC7B;AAAA,UACJ;AAEA,gBAAM,gBAAgB,CAAC,QAAmC;AACtD,kBAAM,OAAO,IAAI;AACjB,gBAAI,KAAqB;AACzB,gBAAI,QAAS,KAAiB,SAAS;AACnC,mBAAM,KAAiB,QAAQ,mBAAmB;AAAA,YACtD,WAAW,QAAS,KAAa,eAAe;AAC5C,mBAAO,KAAa,cAA0B,QAAQ,mBAAmB;AAAA,YAC7E;AACA,mBAAO;AAAA,UACX;AAEA,qBAAK,IAAI,YAAT,mBAAkB,iBAAiB,SAAS,OAAK;AAC7C,kBAAM,SAAS,cAAc,CAAC;AAC9B,gBAAI,CAAC,OAAQ;AACb,kBAAM,MAAM,SAAS,OAAO,QAAQ,aAAa,MAAM,EAAE;AACzD,kBAAM,OAAO,KAAK,eAAe,GAAG;AACpC,gBAAI,CAAC,KAAM;AACX,iBAAK,YAAY,KAAK,IAAI;AAAA,UAC9B;AACA,qBAAK,IAAI,YAAT,mBAAkB,iBAAiB,YAAY,OAAK;AAChD,kBAAM,SAAS,cAAc,CAAC;AAC9B,gBAAI,CAAC,OAAQ;AACb,kBAAM,MAAM,SAAS,OAAO,QAAQ,aAAa,MAAM,EAAE;AACzD,kBAAM,OAAO,KAAK,eAAe,GAAG;AACpC,gBAAI,CAAC,KAAM;AACX,iBAAK,KAAK,SAAS,KAAK,MAAM,KAAK,IAAI;AAAA,UAC3C;AACA,eAAK,yBAAyB;AAAA,QAClC;AAAA,QAEQ,aAAmB;AAEvB,eAAK,oBAAoB;AAEzB,eAAK,kBAAkB;AACvB,eAAK,cAAc;AACnB,eAAK,8BAA8B;AAInC,eAAK,uBAAuB;AAC5B,gCAAsB,MAAM;AACxB,iBAAK,uBAAuB;AAAA,UAChC,CAAC;AAED,qBAAW,MAAM;AACb,iBAAK,uBAAuB;AAAA,UAChC,GAAG,CAAC;AAAA,QACR;AAAA,QAEA,oBAA0B;AACtB,cAAI,CAAC,KAAK,IAAI,YAAa;AAE3B,eAAK,gBAAgB;AACrB,gBAAM,QAAkB,CAAC;AACzB,gBAAM,YAAY,KAAK,WAAW,WAAW,WAAW;AACxD,gBAAM;AAAA,YACF,+DAA+D,SAAS;AAAA,UAC5E;AACA,eAAK,YAAY,QAAQ,CAAC,MAAM,UAAU;AACtC,gBAAI,KAAK,WAAW,cAAc,UAAU,KAAK,SAAS,iBAAkB;AAC5E,kBAAM,eAAe,KAAK,YAAY,MAAM,GAAG,QAAQ,CAAC,EAAE,KAAK,GAAG;AAClE,kBAAM,KAAK,yDAAoD;AAC/D,kBAAM;AAAA,cACF,wEAAwE,YAAY,KAAK,IAAI;AAAA,YACjG;AAAA,UACJ,CAAC;AACD,eAAK,IAAI,YAAY,YAAY,MAAM,KAAK,EAAE;AAC9C,eAAK,IAAI,YACJ,iBAAoC,4BAA4B,EAChE,QAAQ,SAAO;AACZ,gBAAI,iBAAiB,SAAS,MAAM;AAChC,oBAAM,OAAO,IAAI,QAAQ,QAAQ;AACjC,oBAAMC,SAAQ,KAAK,MAAM,GAAG,EAAE,OAAO,OAAO;AAC5C,mBAAK,eAAeA,MAAK;AAAA,YAC7B,CAAC;AAAA,UACL,CAAC;AACL,gBAAM,UAAU,KAAK,IAAI,YAAY;AAAA,YACjC;AAAA,UACJ;AACA,cAAI,QAAS,SAAQ,iBAAiB,SAAS,MAAM,KAAK,OAAO,CAAC;AAAA,QACtE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAUQ,gCAAsC;AAC1C,cAAI,CAAC,KAAK,QAAS;AAEnB,gBAAM,iBAAiB,KAAK,QAAQ,iBAA8B,uBAAuB;AACzF,yBAAe,QAAQ,OAAK,EAAE,UAAU,OAAO,uBAAuB,CAAC;AAEvE,cAAI,aAA4B;AAChC,kBAAQ,KAAK,QAAQ;AAAA,YACjB,KAAK;AACD,2BAAa;AACb;AAAA,YACJ,KAAK;AACD,2BAAa;AACb;AAAA,YACJ,KAAK;AACD,2BAAa;AACb;AAAA,YACJ,KAAK;AAAA,YACL,SAAS;AACL,oBAAM,SAAS,KAAK,YAAY,SAAS,KAAK,KAAK,YAAY,CAAC,MAAM;AACtE,2BAAa,SAAS,yBAAyB;AAC/C;AAAA,YACJ;AAAA,UACJ;AAEA,cAAI,YAAY;AACZ,kBAAM,KAAK,KAAK,QAAQ,cAAc,UAAU;AAChD,qCAAI,UAAU,IAAI;AAAA,UACtB;AAAA,QACJ;AAAA,QAEA,gBAAsB;AAClB,cAAI,CAAC,KAAK,IAAI,QAAS;AAEvB,cAAI,QAAoB,CAAC;AAEzB,cAAI,KAAK,WAAW,UAAU;AAE1B,iBAAK,KAAK,oBAAoB;AAC9B;AAAA,UACJ,WAAW,KAAK,WAAW,UAAU;AACjC,oBAAQ,KAAK,eAAe;AAAA,UAChC,WAAW,KAAK,WAAW,WAAW;AAClC,oBAAQ,KAAK,iBAAiB;AAAA,UAClC,OAAO;AACH,oBAAQ,KAAK,iBAAiB;AAAA,UAClC;AAGA,gBAAM,WAAW,KAAK,YAAY,OAAO,KAAK,UAAU;AAGxD,gBAAM,SAAS,KAAK,WAAW,WAAW,WAAW,KAAK,UAAU,QAAQ;AAE5E,kBAAQ,KAAK,UAAU;AAAA,YACnB,KAAK;AACD,mBAAK,eAAe,MAAM;AAC1B;AAAA,YACJ,KAAK;AACD,mBAAK,eAAe,MAAM;AAC1B;AAAA,UACR;AAAA,QACJ;AAAA,QAEA,mBAA+B;AAI3B,gBAAM,OAAO,KAAK,YAAY,WAAW,IAAI,MAAM,KAAK;AACxD,gBAAM,QAAQ,UAAU,KAAK,IAAI;AACjC,iBAAO,OAAO,QAAQ,KAAK,EAAE,IAAI,CAAC,CAAC,MAAM,IAAI,OAAsB;AAAA,YAC/D;AAAA,YACA,MAAM,KAAK;AAAA,YACX,MAAM,KAAK,SAAS,KAAK,SAAS,WAAW,cAAO;AAAA,YACpD,MAAM,KAAK,QAAQ;AAAA,YACnB,UAAU,KAAK,aAAY,oBAAI,KAAK,GAAE,YAAY;AAAA,UACtD,EAAE;AAAA,QACN;AAAA,QAEA,UAAU,OAA+B;AACrC,gBAAM,SAAS,CAAC,GAAG,KAAK;AACxB,iBAAO,KAAK,CAAC,GAAG,MAAM;AAClB,gBAAI,EAAE,SAAS,YAAY,EAAE,SAAS,SAAU,QAAO;AACvD,gBAAI,EAAE,SAAS,YAAY,EAAE,SAAS,SAAU,QAAO;AACvD,gBAAI,aAAa;AACjB,oBAAQ,KAAK,QAAQ;AAAA,cACjB,KAAK;AACD,6BAAa,EAAE,KAAK,cAAc,EAAE,IAAI;AACxC;AAAA,cACJ,KAAK;AACD,8BAAc,EAAE,QAAQ,MAAM,EAAE,QAAQ;AACxC;AAAA,cACJ,KAAK,QAAQ;AACT,sBAAM,QAAQ,EAAE,WAAW,KAAK,MAAM,EAAE,QAAQ,IAAI;AACpD,sBAAM,QAAQ,EAAE,WAAW,KAAK,MAAM,EAAE,QAAQ,IAAI;AACpD,6BAAa,QAAQ;AACrB;AAAA,cACJ;AAAA,cACA,KAAK;AACD,8BAAc,EAAE,QAAQ,IAAI,cAAc,EAAE,QAAQ,EAAE;AACtD;AAAA,YACR;AACA,mBAAO,KAAK,cAAc,QAAQ,aAAa,CAAC;AAAA,UACpD,CAAC;AACD,iBAAO;AAAA,QACX;AAAA,QAEA,eAAe,OAAyB;AACpC,eAAK,iBAAiB;AACtB,gBAAM,OAAO,MACR;AAAA,YACG,CAAC,MAAM,MAAM;AAAA,0CACa,KAAK,cAAc,IAAI,KAAK,IAAI,IAAI,iCAAiC,EAAE,sBAAsB,CAAC,qBAAqB,KAAK,IAAI,qBAAqB,KAAK,IAAI,IAAI,KAAK,OAAO,oBAAoB,KAAK,IAAI,MAAM,EAAE;AAAA;AAAA;AAAA,8DAG3L,KAAK,QAAQ,EAAE;AAAA,2DAClB,KAAK,IAAI;AAAA;AAAA;AAAA,qEAGC,KAAK,WAAW,KAAK,IAAI,CAAC;AAAA,iGACE,KAAK,WAAW,KAAK,QAAQ,CAAC;AAAA;AAAA;AAAA,UAGnH,EACC,KAAK,EAAE;AACZ,eAAK,IAAI,QAAS,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAeT,IAAI;AAAA;AAAA;AAAA;AAAA,QAI7B;AAAA,QAEA,eAAe,OAAyB;AACpC,eAAK,iBAAiB;AACtB,gBAAM,QAAQ,MACT;AAAA,YACG,CAAC,MAAM,MAAM;AAAA,2CACc,KAAK,cAAc,IAAI,KAAK,IAAI,IAAI,oGAAoG,EAAE,0CAA0C,CAAC,qBAAqB,KAAK,IAAI,qBAAqB,KAAK,IAAI,IAAI,KAAK,OAAO,oBAAoB,KAAK,IAAI,MAAM,EAAE;AAAA,8DACnR,KAAK,QAAQ,EAAE;AAAA,iEACZ,KAAK,IAAI;AAAA;AAAA;AAAA,UAG9D,EACC,KAAK,EAAE;AACZ,eAAK,IAAI,QAAS,YAAY;AAAA,gHAC0E,KAAK;AAAA;AAAA,QAEjH;AAAA,QAEA,WAAW,MAAuB;AAC9B,cAAI,CAAC,KAAM,QAAO;AAClB,gBAAM,QAAQ,CAAC,KAAK,MAAM,MAAM,IAAI;AACpC,cAAI,MAAM;AACV,cAAI,MAAM;AACV,iBAAO,MAAM,QAAQ,MAAM,MAAM,SAAS,GAAG;AACzC,mBAAO;AACP;AAAA,UACJ;AACA,iBAAO,GAAG,IAAI,QAAQ,CAAC,CAAC,IAAI,MAAM,GAAG,CAAC;AAAA,QAC1C;AAAA,QAEA,WAAW,GAAoB;AAC3B,cAAI,CAAC,EAAG,QAAO;AACf,cAAI;AACA,kBAAM,KAAK,IAAI,KAAK,CAAC;AACrB,mBAAO,GAAG,eAAe;AAAA,UAC7B,QAAQ;AACJ,mBAAO;AAAA,UACX;AAAA,QACJ;AAAA,QAEA,YAAY,MAAoB;AAC5B,gBAAM,cAAc,KAAK,cAAc,IAAI,IAAI;AAC/C,eAAK,cAAc,MAAM;AAEzB,cAAI,CAAC,aAAa;AACd,iBAAK,cAAc,IAAI,IAAI;AAAA,UAC/B;AAIA,cAAI,KAAK,IAAI,SAAS;AAClB,kBAAM,WAAW,KAAK,IAAI,QAAQ,iBAAiB,kBAAkB;AACrE,qBAAS,QAAQ,QAAM;AACnB,oBAAM,WAAY,GAAmB,QAAQ;AAC7C,oBAAM,aAAa,KAAK,cAAc,IAAI,YAAY,EAAE;AAExD,kBAAI,KAAK,aAAa,QAAQ;AAC1B,oBAAI,YAAY;AACZ,qBAAG,UAAU,IAAI,eAAe,kBAAkB;AAAA,gBACtD,OAAO;AACH,qBAAG,UAAU,OAAO,eAAe,kBAAkB;AAAA,gBACzD;AAAA,cACJ,OAAO;AAEH,oBAAI,YAAY;AACZ,qBAAG,UAAU;AAAA,oBACT;AAAA,oBACA;AAAA,oBACA;AAAA,oBACA;AAAA,oBACA;AAAA,oBACA;AAAA,kBACJ;AAAA,gBACJ,OAAO;AACH,qBAAG,UAAU;AAAA,oBACT;AAAA,oBACA;AAAA,oBACA;AAAA,oBACA;AAAA,oBACA;AAAA,oBACA;AAAA,kBACJ;AAAA,gBACJ;AAAA,cACJ;AAAA,YACJ,CAAC;AAAA,UACL;AAAA,QACJ;AAAA,QAEA,MAAM,SAAS,MAAc,MAAwC;AACjE,cAAI,SAAS,UAAU;AACnB,iBAAK,iBAAiB,IAAI;AAAA,UAC9B,OAAO;AAEH,gBAAI,KAAK,WAAW,UAAU;AAC1B,oBAAM,OAAO,KAAK,eAAe,KAAK,OAAK,EAAE,SAAS,IAAI;AAC1D,kBAAI,6BAAM,MAAM;AACZ,qBAAK,qBAAqB,KAAK,IAAI;AACnC;AAAA,cACJ;AAAA,YACJ;AAGA,gBAAI,KAAK,WAAW,UAAU;AAC1B,mBAAK,YAAY,IAAI;AAAA,YACzB;AAGA,iBAAK,oBAAoB;AAGzB,iBAAK,YAAY,IAAI;AAGrB,kBAAM,OAAO,KAAK,MAAM,GAAG,EAAE,IAAI,KAAK,IAAI,YAAY;AACtD,kBAAM,WAAW,oBAAI,IAAI;AAAA,cACrB;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,YACJ,CAAC;AACD,kBAAM,YAAY,oBAAI,IAAI;AAAA,cACtB;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,YACJ,CAAC;AACD,kBAAM,UAAU,oBAAI,IAAI,CAAC,KAAK,CAAC;AAG/B,kBAAM,mBAAmB,CACrB,UACA,SACA,SACC;AAvxBjB;AAwxBgB,kBAAI;AACA,sBAAM,IAAI;AACV,oBAAI,eAAoB;AAExB,oBACI,EAAE,kBACF,OAAO,EAAE,eAAe,qBAAqB,YAC/C;AACE,wBAAM,WAAW,EAAE,eAAe,iBAAiB,aAAa;AAChE,sBAAI,YAAY,SAAS,SAAS,GAAG;AACjC,mCAAe,SAAS,CAAC;AAAA,kBAC7B;AAAA,gBACJ;AAEA,oBACI,CAAC,gBACD,EAAE,oBACF,OAAO,EAAE,iBAAiB,WAAW,YACvC;AACE,iCAAe,EAAE,iBAAiB,OAAO;AAAA,gBAC7C;AAEA,oBAAI,gBAAgB,OAAO,aAAa,mBAAmB,YAAY;AAEnE,wBAAM,eAAe,MAAM,KAAK,aAAa,KAAK,OAAO,CAAC;AAC1D,wBAAM,cAAc,aAAa,KAAK,CAAC,QAAa,IAAI,UAAU,QAAQ;AAE1E,sBAAI,aAAa;AAEb,iCAAa,aAAa,YAAY,EAAE;AACxC,uCAAa,iBAAb;AAAA,kBACJ,OAAO;AAEH,0BAAM,SAAS,aAAa,eAAe,UAAU,OAAO;AAE5D,wBAAI,UAAU,OAAO,IAAI;AACrB,mCAAa,aAAa,OAAO,EAAE;AAAA,oBACvC;AACA,uCAAa,iBAAb;AAAA,kBACJ;AACA,yBAAO;AAAA,gBACX;AAGA,oBACI,EAAE,oBACF,OAAO,EAAE,iBAAiB,mBAAmB,YAC/C;AACE,oBAAE,iBAAiB,eAAe;AAAA,oBAC9B;AAAA,oBACA;AAAA,oBACA,MAAM,6BAAM;AAAA,oBACZ,MAAM,6BAAM;AAAA,kBAChB,CAAC;AACD,yBAAO;AAAA,gBACX;AAAA,cACJ,SAAS,GAAG;AACR,wBAAQ,KAAK,+CAA+C,CAAC;AAAA,cACjE;AACA,qBAAO;AAAA,YACX;AAGA,gBAAI,KAAK,WAAW,YAAY;AAC5B,kBAAI;AAEA,sBAAM,YACF,KAAK,YAAY,SAAS,IAAI,CAAC,GAAG,KAAK,aAAa,IAAI,IAAI,CAAC,IAAI;AACrE,sBAAM,UAAW,UAAkB,SAAS,SAAS;AACrD,oBAAI,YAAY,QAAQ,SAAS,IAAI,GAAG,GAAG;AACvC,mCAAiB,MAAM,OAAO;AAC9B;AAAA,gBACJ;AAAA,cACJ,SAAS,GAAG;AACR,wBAAQ,KAAK,uCAAuC,CAAC;AAAA,cACzD;AAAA,YACJ;AAGA,gBAAI,KAAK,WAAW,UAAU;AAC1B,oBAAMC,OAAM,KAAK,OAAO;AACxB,oBAAM,WAAW,KAAK,kBAAkB;AACxC,oBAAM,OAAO,KAAK,YAAY,CAAC;AAC/B,oBAAM,UAAU,KAAK,YAAY,MAAM,CAAC,EAAE,OAAO,IAAI,EAAE,KAAK,GAAG;AAC/D,oBAAM,QAAQ,KAAK,mBAAmB,IAAI,IAAI;AAG9C,kBAAI,SAAS,MAAM,cAAc;AAC7B,oBAAI;AACA,sBAAI,UAAU,IAAI,GAAG,GAAG;AACpB,0BAAM,MAAM,MAAM;AAClB,wBAAI;AAEA,4BAAM,OAAO,MAAM,MAAM,GAAG;AAC5B,0BAAI,KAAK,IAAI;AACT,8BAAM,OAAO,MAAM,KAAK,KAAK;AAC7B,8BAAM,MAAM,IAAI,gBAAgB,IAAI;AACpC,4BACI,oCACA,OAAO,iCAAuB,eAAe,YAC/C;AACE,2DAAuB,WAAW,CAAC,GAAG,GAAG,GAAG,OAAO;AAAA,wBACvD,OAAO;AACH,iCAAO,KAAK,KAAK,QAAQ;AAAA,wBAC7B;AACA;AAAA,sBACJ,OAAO;AAEH,+BAAO,KAAK,KAAK,QAAQ;AACzB,6BAAK,WAAW;AAChB;AAAA,sBACJ;AAAA,oBACJ,SAAS,QAAQ;AACb,8BAAQ;AAAA,wBACJ;AAAA,wBACA;AAAA,sBACJ;AACA,6BAAO,KAAK,KAAK,QAAQ;AACzB,2BAAK,WAAW;AAChB;AAAA,oBACJ;AACA,yBAAK,WAAW;AAChB;AAAA,kBACJ;AACA,sBAAI,QAAQ,IAAI,GAAG,GAAG;AAClB,2BAAO,KAAK,MAAM,cAAc,QAAQ;AACxC,yBAAK,WAAW;AAChB;AAAA,kBACJ;AAAA,gBACJ,SAAS,MAAM;AACX,0BAAQ,KAAK,mDAAmD,IAAI;AAAA,gBACxE;AAAA,cACJ;AAEA,kBAAI;AAEA,oBAAI,SAAS,MAAM,SAAS;AACxB,wBAAM,MACF,MAAM,aAAa,WACb,MAAM,MAAM,WAAW,IAAI,QAAQ,OAAO,EAAE,CAAC,IAC7C,MAAM;AAChB,sBAAI,SAAS,IAAI,GAAG,GAAG;AACnB,qCAAiB,MAAM,KAAK,EAAE,MAAM,MAAM,QAAQ,CAAC;AACnD;AAAA,kBACJ;AAEA,sBAAI;AACA,wBAAI,UAAU,IAAI,GAAG,GAAG;AACpB,4BAAM,MACF,MAAM,aAAa,YACZ,MAAM,WAAW,IAAI,QAAQ,OAAO,EAAE,IACvC;AACV,0BAAI,KAAK;AACL,8BAAM,QAAQ,KAAK,GAAG;AACtB,8BAAM,MAAM,IAAI,WAAW,MAAM,MAAM;AACvC,iCAAS,IAAI,GAAG,IAAI,MAAM,QAAQ;AAC9B,8BAAI,CAAC,IAAI,MAAM,WAAW,CAAC;AAC/B,8BAAM,UAAkC;AAAA,0BACpC,KAAK;AAAA,0BACL,MAAM;AAAA,0BACN,KAAK;AAAA,0BACL,KAAK;AAAA,0BACL,MAAM;AAAA,0BACN,KAAK;AAAA,0BACL,KAAK;AAAA,0BACL,KAAK;AAAA,0BACL,MAAM;AAAA,wBACV;AACA,8BAAM,OAAO,QAAQ,GAAG,KAAK;AAC7B,8BAAM,OAAO,IAAI,KAAK,CAAC,GAAG,GAAG,EAAE,MAAM,KAAK,CAAC;AAC3C,8BAAM,MAAM,IAAI,gBAAgB,IAAI;AACpC,4BACI,oCACA,OAAO,iCAAuB,eAAe,YAC/C;AACE,2DAAuB,WAAW,CAAC,GAAG,GAAG,GAAG,OAAO;AAAA,wBACvD,OAAO;AACH,iCAAO,KAAK,KAAK,QAAQ;AAAA,wBAC7B;AACA;AAAA,sBACJ;AAAA,oBACJ;AACA,wBAAI,QAAQ,IAAI,GAAG,GAAG;AAClB,4BAAM,MACF,MAAM,aAAa,YACZ,MAAM,WAAW,IAAI,QAAQ,OAAO,EAAE,IACvC;AACV,0BAAI,KAAK;AACL,8BAAM,QAAQ,KAAK,GAAG;AACtB,8BAAM,MAAM,IAAI,WAAW,MAAM,MAAM;AACvC,iCAAS,IAAI,GAAG,IAAI,MAAM,QAAQ;AAC9B,8BAAI,CAAC,IAAI,MAAM,WAAW,CAAC;AAC/B,8BAAM,OAAO,IAAI,KAAK,CAAC,GAAG,GAAG,EAAE,MAAM,kBAAkB,CAAC;AACxD,8BAAM,MAAM,IAAI,gBAAgB,IAAI;AACpC,+BAAO,KAAK,KAAK,QAAQ;AACzB;AAAA,sBACJ;AAAA,oBACJ;AAAA,kBACJ,SAAS,MAAM;AACX,4BAAQ,KAAK,gDAAgD,IAAI;AAAA,kBACrE;AAAA,gBACJ;AAGA,oBAAIA,QAAO,OAAOA,KAAI,sBAAsB,YAAY;AAEpD,uBAAK,IAAI,QAAS,YACd;AACJ,wBAAM,UAAU,MAAMA,KAAI,kBAAkB,UAAU,MAAM,OAAO;AAEnE,sBAAI,WAAW,QAAQ,cAAc;AACjC,wBAAI;AACA,0BAAI,UAAU,IAAI,GAAG,GAAG;AACpB,8BAAM,MAAM,QAAQ;AACpB,4BAAI;AACA,gCAAM,OAAO,MAAM,MAAM,GAAG;AAC5B,8BAAI,KAAK,IAAI;AACT,kCAAM,OAAO,MAAM,KAAK,KAAK;AAC7B,kCAAM,MAAM,IAAI,gBAAgB,IAAI;AACpC,6DAAuB,WAAW,CAAC,GAAG,GAAG,GAAG,OAAO;AACnD,iCAAK,WAAW;AAChB;AAAA,0BACJ;AAAA,wBACJ,SAAS,IAAI;AACT,kCAAQ;AAAA,4BACJ;AAAA,4BACA;AAAA,0BACJ;AAAA,wBACJ;AACA,+BAAO,KAAK,QAAQ,cAAc,QAAQ;AAC1C,6BAAK,WAAW;AAChB;AAAA,sBACJ;AACA,0BAAI,QAAQ,IAAI,GAAG,GAAG;AAClB,+BAAO,KAAK,QAAQ,cAAc,QAAQ;AAC1C,6BAAK,WAAW;AAChB;AAAA,sBACJ;AAAA,oBACJ,SAAS,MAAM;AACX,8BAAQ,KAAK,6CAA6C,IAAI;AAAA,oBAClE;AAAA,kBACJ;AAGA,sBAAI,WAAW,QAAQ,WAAW,QAAQ,aAAa,UAAU;AAC7D,0BAAM,aAAa,QAAQ,WAAW,IAAI,QAAQ,OAAO,EAAE;AAC3D,0BAAM,UAAU,KAAK,SAAS;AAC9B,wBAAI,SAAS,IAAI,GAAG,GAAG;AACnB,uCAAiB,MAAM,SAAS,EAAE,MAAM,MAAM,QAAQ,CAAC;AACvD,2BAAK,WAAW;AAChB;AAAA,oBACJ;AACA,wBAAI;AACA,0BAAI,UAAU,IAAI,GAAG,GAAG;AACpB,8BAAM,QAAQ,KAAK,SAAS;AAC5B,8BAAM,MAAM,IAAI,WAAW,MAAM,MAAM;AACvC,iCAAS,IAAI,GAAG,IAAI,MAAM,QAAQ;AAC9B,8BAAI,CAAC,IAAI,MAAM,WAAW,CAAC;AAC/B,8BAAM,UAAkC;AAAA,0BACpC,KAAK;AAAA,0BACL,MAAM;AAAA,0BACN,KAAK;AAAA,0BACL,KAAK;AAAA,0BACL,MAAM;AAAA,0BACN,KAAK;AAAA,0BACL,KAAK;AAAA,0BACL,KAAK;AAAA,0BACL,MAAM;AAAA,wBACV;AACA,8BAAM,OAAO,QAAQ,GAAG,KAAK;AAC7B,8BAAM,OAAO,IAAI,KAAK,CAAC,GAAG,GAAG,EAAE,MAAM,KAAK,CAAC;AAC3C,8BAAM,MAAM,IAAI,gBAAgB,IAAI;AACpC,4BACI,oCACA,OAAO,iCAAuB,eAAe,YAC/C;AACE,2DAAuB,WAAW,CAAC,GAAG,GAAG,GAAG,OAAO;AAAA,wBACvD,OAAO;AACH,iCAAO,KAAK,KAAK,QAAQ;AAAA,wBAC7B;AACA,6BAAK,WAAW;AAChB;AAAA,sBACJ;AACA,0BAAI,QAAQ,IAAI,GAAG,GAAG;AAClB,8BAAM,QAAQ,KAAK,SAAS;AAC5B,8BAAM,MAAM,IAAI,WAAW,MAAM,MAAM;AACvC,iCAAS,IAAI,GAAG,IAAI,MAAM,QAAQ;AAC9B,8BAAI,CAAC,IAAI,MAAM,WAAW,CAAC;AAC/B,8BAAM,OAAO,IAAI,KAAK,CAAC,GAAG,GAAG,EAAE,MAAM,kBAAkB,CAAC;AACxD,8BAAM,MAAM,IAAI,gBAAgB,IAAI;AACpC,+BAAO,KAAK,KAAK,QAAQ;AACzB,6BAAK,WAAW;AAChB;AAAA,sBACJ;AAAA,oBACJ,SAAS,IAAI;AACT,8BAAQ,KAAK,4CAA4C,EAAE;AAAA,oBAC/D;AAAA,kBACJ,OAAO;AACH,0BAAM,MAAM,UAAU,QAAQ,WAAW,KAAK;AAC9C,wBAAI,SAAS,IAAI,GAAG,GAAG;AACnB,uCAAiB,MAAM,KAAK,EAAE,MAAM,MAAM,QAAQ,CAAC;AACnD,2BAAK,WAAW;AAChB;AAAA,oBACJ;AAAA,kBACJ;AAAA,gBACJ;AAAA,cACJ,SAAS,GAAQ;AACb,wBAAQ,KAAK,4CAA4C,CAAC;AAC1D,qBAAK,WAAW;AAAA,cACpB;AAAA,YACJ;AAAA,UAGJ;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKQ,qBAAqB,UAAwB;AAEjD,gBAAM,QAAQ,SAAS,MAAM,GAAG,EAAE,OAAO,OAAO;AAChD,cAAI,MAAM,WAAW,EAAG;AAExB,gBAAM,WAAW,MAAM,MAAM,SAAS,CAAC;AACvC,cAAI,CAAC,SAAU;AAEf,gBAAM,cAAc,MAAM,MAAM,GAAG,EAAE;AAGrC,eAAK,SAAS;AACd,eAAK,cAAc;AACnB,eAAK,cAAc;AACnB,eAAK,WAAW;AAGhB,eAAK,YAAY,QAAQ;AAAA,QAC7B;AAAA,QAEA,iBAAiB,MAAoB;AACjC,cAAI,KAAK,WAAW,UAAU;AAC1B,iBAAK,cAAc,CAAC,GAAG,KAAK,aAAa,IAAI;AAC7C,iBAAK,cAAc;AACnB,iBAAK,WAAW;AAChB;AAAA,UACJ;AAGA,gBAAM,aAAa,KAAK,YAAY,WAAW,IAAI,OAAO,CAAC,GAAG,KAAK,aAAa,IAAI;AACpF,gBAAM,SAAS,UAAU,UAAU,UAAU;AAC7C,cAAI,QAAQ;AACR,iBAAK,cAAc,CAAC,GAAG,KAAK,aAAa,IAAI;AAC7C,iBAAK,cAAc;AACnB,iBAAK,WAAW;AAAA,UACpB;AAAA,QACJ;AAAA,QAEA,aAAmB;AACf,cAAI,KAAK,YAAY,WAAW,EAAG;AACnC,eAAK,cAAc,KAAK,YAAY,MAAM,GAAG,EAAE;AAC/C,eAAK,cAAc;AACnB,eAAK,WAAW;AAAA,QACpB;AAAA,QAEA,SAAe;AACX,eAAK,cAAc,CAAC;AACpB,eAAK,cAAc;AACnB,eAAK,WAAW;AAAA,QACpB;AAAA,QAEA,eAAe,OAAuB;AAClC,eAAK,cAAc;AACnB,eAAK,cAAc;AACnB,eAAK,WAAW;AAAA,QACpB;AAAA,QAEA,YAAY,MAAsB;AAC9B,eAAK,WAAW;AAChB,eAAK,mBAAmB,EAAE,UAAU,KAAK,SAAS,CAAC;AACnD,eAAK,cAAc;AAAA,QACvB;AAAA,QAEA,UAAU,QAAiD;AACvD,eAAK,SAAS;AACd,eAAK,cAAc;AACnB,eAAK,cAAc;AAAA,QACvB;AAAA,QAEA,aAAa,OAA6B;AACtC,eAAK,YAAY;AACjB,eAAK,cAAc;AACnB,eAAK,cAAc;AAAA,QACvB;AAAA;AAAA,QAGA,eAAe,MAAoB;AAC/B,cAAI,KAAK,UAAU,IAAI,IAAI,GAAG;AAC1B,iBAAK,UAAU,OAAO,IAAI;AAAA,UAC9B,OAAO;AACH,iBAAK,UAAU,IAAI,IAAI;AAAA,UAC3B;AACA,eAAK,cAAc;AACnB,eAAK,cAAc;AAAA,QACvB;AAAA,QAEA,mBAA+B;AAC3B,gBAAM,QAAoB,CAAC;AAC3B,qBAAW,QAAQ,KAAK,WAAW;AAC/B,kBAAM,QAAQ,KAAK,MAAM,GAAG;AAC5B,kBAAM,OAAO,MAAM,MAAM,SAAS,CAAC,KAAK;AACxC,kBAAM,KAAK;AAAA,cACP;AAAA,cACA,MAAM;AAAA,cACN,MAAM;AAAA,cACN,WAAU,oBAAI,KAAK,GAAE,YAAY;AAAA,YACrC,CAAC;AAAA,UACL;AACA,iBAAO;AAAA,QACX;AAAA;AAAA;AAAA;AAAA,QASA,OAAe,kBAAgC;AAC3C,cAAI;AACA,kBAAM,SAAS,aAAa,QAAQ,YAAW,gBAAgB;AAC/D,gBAAI,QAAQ;AACR,qBAAO,KAAK,MAAM,MAAM;AAAA,YAC5B;AAAA,UACJ,SAAS,GAAG;AACR,oBAAQ,KAAK,6CAA6C,CAAC;AAAA,UAC/D;AACA,iBAAO,YAAW,sBAAsB;AAAA,QAC5C;AAAA;AAAA;AAAA;AAAA,QAKA,OAAe,gBAAgB,OAA2B;AACtD,cAAI;AACA,yBAAa,QAAQ,YAAW,kBAAkB,KAAK,UAAU,KAAK,CAAC;AAAA,UAC3E,SAAS,GAAG;AACR,oBAAQ,KAAK,6CAA6C,CAAC;AAAA,UAC/D;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,OAAe,wBAAsC;AACjD,gBAAM,OAAM,oBAAI,KAAK,GAAE,YAAY;AACnC,gBAAM,YAAY,IAAI,KAAK,KAAK,IAAI,IAAI,KAAQ,EAAE,YAAY;AAC9D,gBAAM,aAAa,IAAI,KAAK,KAAK,IAAI,IAAI,MAAS,EAAE,YAAY;AAEhE,iBAAO;AAAA,YACH;AAAA,cACI,MAAM;AAAA,cACN,MAAM;AAAA,cACN,MAAM;AAAA,cACN,UAAU;AAAA,YACd;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,MAAM;AAAA,cACN,MAAM;AAAA,cACN,UAAU;AAAA,YACd;AAAA,YACA;AAAA,cACI,MAAM;AAAA,cACN,MAAM;AAAA,cACN,MAAM;AAAA,cACN,UAAU;AAAA,YACd;AAAA,UACJ;AAAA,QACJ;AAAA,QAEA,YAAY,MAAoB;AAxvCpC;AA0vCQ,gBAAM,YAAY,KAAK,WAAW,aAAa,KAAK,cAAc,CAAC;AACnE,gBAAM,WAAW,UAAU,SAAS,IAAI,UAAU,KAAK,GAAG,IAAI,MAAM,OAAO;AAG3E,gBAAM,QAAM,UAAK,MAAM,GAAG,EAAE,IAAI,MAApB,mBAAuB,kBAAiB;AACpD,cAAI,OAAO;AACX,cAAI,CAAC,MAAM,KAAK,EAAE,SAAS,GAAG,EAAG,QAAO;AAAA,mBAC/B,CAAC,OAAO,QAAQ,OAAO,OAAO,MAAM,EAAE,SAAS,GAAG,EAAG,QAAO;AAAA,mBAC5D,CAAC,KAAK,EAAE,SAAS,GAAG,EAAG,QAAO;AAAA,mBAC9B,CAAC,OAAO,OAAO,IAAI,EAAE,SAAS,GAAG,EAAG,QAAO;AAEpD,gBAAM,aAAyB;AAAA,YAC3B;AAAA,YACA,MAAM;AAAA,YACN;AAAA,YACA,WAAU,oBAAI,KAAK,GAAE,YAAY;AAAA,UACrC;AAGA,gBAAM,cAAc,YAAW,gBAAgB;AAG/C,gBAAM,WAAW,YAAY,OAAO,OAAK,EAAE,SAAS,QAAQ;AAG5D,mBAAS,QAAQ,UAAU;AAG3B,gBAAM,UAAU,SAAS,MAAM,GAAG,YAAW,gBAAgB;AAG7D,sBAAW,gBAAgB,OAAO;AAGlC,eAAK,cAAc;AACnB,eAAK,cAAc;AAAA,QACvB;AAAA,QAEA,iBAA6B;AAEzB,gBAAM,cAAc,YAAW,gBAAgB;AAG/C,iBAAO,YAAY,IAAI,SAAO;AAAA,YAC1B,MAAM,GAAG;AAAA,YACT,MAAM;AAAA,YACN,MAAM,GAAG;AAAA,YACT,UAAU,GAAG;AAAA;AAAA,YAEb,MAAM,GAAG;AAAA,UACb,EAAE;AAAA,QACN;AAAA;AAAA,QAGA,YAAY,OAAmB,YAAgC;AAC3D,cAAI,CAAC,cAAc,WAAW,KAAK,MAAM,IAAI;AACzC,mBAAO;AAAA,UACX;AACA,gBAAM,OAAO,WAAW,YAAY;AACpC,iBAAO,MAAM,OAAO,UAAQ,KAAK,KAAK,YAAY,EAAE,SAAS,IAAI,CAAC;AAAA,QACtE;AAAA;AAAA,QAGQ,gBAAsB;AAzzClC;AA2zCQ,eAAK,eAAe;AAAA,YAChB,aAAa,KAAK;AAAA,YAClB,UAAU,KAAK;AAAA,YACf,QAAQ,KAAK;AAAA,YACb,WAAW,KAAK;AAAA,YAChB,WAAW,MAAM,KAAK,KAAK,SAAS;AAAA,YACpC,aAAa,KAAK;AAAA,YAClB,cAAc,KAAK;AAAA,UACvB;AACA,eAAK,SAAS,WAAW,KAAK,IAAI;AAGlC,cAAI,KAAK,cAAc;AACnB,aAAC,gBAAK,cAAqB,eAA1B;AAAA,UACL;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKQ,sBAA4B;AAChC,cAAI,KAAK,IAAI,SAAS;AAClB,iBAAK,uBAAuB,KAAK,IAAI,QAAQ;AAAA,UACjD;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKQ,yBAA+B;AACnC,cAAI,KAAK,IAAI,WAAW,KAAK,uBAAuB,GAAG;AAEnD,kCAAsB,MAAM;AACxB,kBAAI,KAAK,IAAI,SAAS;AAClB,qBAAK,IAAI,QAAQ,YAAY,KAAK;AAAA,cACtC;AAAA,YACJ,CAAC;AAAA,UACL;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,OAAa;AACT,gBAAM,KAAK;AACX,eAAK,uBAAuB;AAAA,QAChC;AAAA;AAAA;AAAA;AAAA,QAKA,OAAa;AACT,eAAK,oBAAoB;AACzB,gBAAM,KAAK;AAAA,QACf;AAAA,QAEA,YAAiB;AACb,iBAAO;AAAA,YACH,GAAG,MAAM,UAAU;AAAA,YACnB,QAAQ,KAAK;AAAA,YACb,aAAa,KAAK;AAAA,YAClB,UAAU,KAAK;AAAA,YACf,QAAQ,KAAK;AAAA,YACb,WAAW,KAAK;AAAA,YAChB,WAAW,MAAM,KAAK,KAAK,SAAS;AAAA,YACpC,aAAa,KAAK;AAAA,UACtB;AAAA,QACJ;AAAA,QAEA,OAAO,YAAY,OAAwB;AAh4C/C;AAi4CQ,gBAAM,OAAO,IAAI,YAAW;AAAA,YACxB,IAAI,MAAM;AAAA,YACV,OAAO,MAAM,UAAU,MAAM,WAAW,WAAW,WAAW;AAAA,YAC9D,MAAM,MAAM,SAAS,MAAM,WAAW,WAAW,cAAO;AAAA,YACxD,QAAS,MAAM,UAA2B;AAAA,YAC1C,SAAS;AAAA,cACL,GAAG,MAAM;AAAA,cACT,WAAW,MAAM,eAAa,WAAM,iBAAN,mBAAoB,cAAa,CAAC;AAAA,cAChE,aAAa,MAAM,iBAAe,WAAM,iBAAN,mBAAoB,gBAAe,CAAC;AAAA,cACtE,cAAc,MAAM,kBAAgB,WAAM,iBAAN,mBAAoB,iBAAgB;AAAA,YAC5E;AAAA,UACJ,CAAC;AACD,eAAK,cAAc,MAAM,eAAe,CAAC;AACzC,eAAK,WAAW,MAAM,YAAY;AAClC,eAAK,SAAS,MAAM,UAAU;AAC9B,eAAK,YAAY,MAAM,aAAa;AACpC,iBAAO;AAAA,QACX;AAAA;AAAA,QAGQ,oBAA4B;AAChC,gBAAM,IAAI;AACV,iBAAO,EAAE,mBAAmB;AAAA,QAChC;AAAA,QAEQ,SAAc;AAClB,gBAAM,IAAI;AACV,iBAAO,EAAE,aAAa;AAAA,QAC1B;AAAA,QAEA,MAAM,sBAAqC;AACvC,cAAI,CAAC,KAAK,IAAI,QAAS;AACvB,gBAAMA,OAAM,KAAK,OAAO;AACxB,gBAAM,WAAW,KAAK,kBAAkB;AACxC,eAAK,IAAI,QAAQ,YAAY;AAE7B,cAAI,CAACA,MAAK;AACN,iBAAK,IAAI,QAAQ,YACb;AACJ;AAAA,UACJ;AAEA,cAAI;AACA,gBAAI,KAAK,YAAY,WAAW,GAAG;AAE/B,oBAAM,WAAW;AACjB,kBAAI;AAGJ,oBAAM,SAAS,KAAK,iBAAiB,QAAQ;AAC7C,kBAAI,QAAQ;AACR,wBAAQ;AAAA,cACZ,OAAO;AAEH,sBAAM,YAAYA,KAAI,UAAU,OAAO;AACvC,wBAAQ,gCAAc,MAAMA,KAAI,eAAe,QAAQ;AACvD,oBAAI,CAAC,UAAW,CAAAA,KAAI,WAAW,SAAS,IAAI,IAAI,KAAK;AACrD,qBAAK,kBAAkB,UAAU,KAAK;AAAA,cAC1C;AAEA,mBAAK,cAAc,MAAM,QAAQ,KAAK,IAAI,QAAQ,CAAC;AACnD,oBAAM,QAAoB,KAAK,YAAY,IAAI,CAAC,UAAe;AAAA,gBAC3D,MAAM,KAAK;AAAA,gBACX,MAAM;AAAA,gBACN,MAAM;AAAA,cACV,EAAE;AACF,mBAAK,mBAAmB,MAAM;AAC9B,oBAAM,QAAQ,QAAM,KAAK,mBAAmB,IAAI,GAAG,MAAM,EAAE,CAAC;AAG5D,oBAAM,WAAW,KAAK,YAAY,OAAO,KAAK,UAAU;AACxD,mBAAK,eAAe,KAAK,UAAU,QAAQ,CAAC;AAAA,YAChD,OAAO;AAEH,oBAAM,OAAO,KAAK,YAAY,CAAC;AAC/B,oBAAM,UAAU,KAAK,YAAY,MAAM,CAAC,EAAE,KAAK,GAAG;AAClD,oBAAM,WAAW,GAAG,IAAI,IAAI,OAAO;AACnC,kBAAI;AAGJ,oBAAM,SAAS,KAAK,iBAAiB,QAAQ;AAC7C,kBAAI,QAAQ;AACR,2BAAW;AAAA,cACf,OAAO;AAEH,sBAAM,YAAYA,KAAI,UAAU,YAAY,MAAM,OAAO;AACzD,2BAAW,gCAAc,MAAMA,KAAI,kBAAkB,UAAU,MAAM,OAAO;AAC5E,oBAAI,CAAC,UAAW,CAAAA,KAAI,WAAW,YAAY,MAAM,SAAS,QAAQ;AAClE,qBAAK,kBAAkB,UAAU,QAAQ;AAAA,cAC7C;AAEA,oBAAM,SAAqB,MAAM,QAAQ,QAAQ,IAAI,WAAW,CAAC,GAAG;AAAA,gBAChE,CAAC,OAAS;AA79C9B;AA69CkC;AAAA,oBACV,MAAM,GAAG;AAAA,oBACT,MAAM,GAAG,SAAS,QAAQ,WAAW;AAAA,oBACrC,MAAM,GAAG,SAAS,QAAQ,cAAO;AAAA,oBACjC,OAAM,QAAG,SAAH,YAAW;AAAA,oBACjB,UAAU,GAAG,UAAU,SAAY;AAAA,kBACvC;AAAA;AAAA,cACJ;AACA,mBAAK,mBAAmB,MAAM;AAC9B,eAAC,MAAM,QAAQ,QAAQ,IAAI,WAAW,CAAC,GAAG;AAAA,gBAAQ,CAAC,OAC/C,KAAK,mBAAmB,IAAI,GAAG,MAAM,EAAE;AAAA,cAC3C;AAGA,oBAAM,WAAW,KAAK,YAAY,OAAO,KAAK,UAAU;AACxD,mBAAK,eAAe,KAAK,UAAU,QAAQ,CAAC;AAAA,YAChD;AAAA,UACJ,SAAS,GAAQ;AACb,iBAAK,cAAc;AACnB,iBAAK,sBAAqB,uBAAG,YAAW;AACxC,iBAAK,IAAI,QAAQ,YAAY,wDAAwD,KAAK,kBAAkB;AAAA,UAChH;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAOQ,iBAAiB,KAAyB;AAC9C,gBAAM,SAAS,KAAK,mBAAmB,IAAI,GAAG;AAC9C,cAAI,CAAC,OAAQ,QAAO;AAEpB,gBAAM,MAAM,KAAK,IAAI;AACrB,cAAI,MAAM,OAAO,YAAY,KAAK,UAAU;AAExC,iBAAK,mBAAmB,OAAO,GAAG;AAClC,mBAAO;AAAA,UACX;AAEA,iBAAO,OAAO;AAAA,QAClB;AAAA;AAAA,QAGQ,kBAAkB,KAAa,MAAiB;AACpD,eAAK,mBAAmB,IAAI,KAAK;AAAA,YAC7B;AAAA,YACA,WAAW,KAAK,IAAI;AAAA,UACxB,CAAC;AAAA,QACL;AAAA;AAAA;AAAA;AAAA;AAAA,QAMQ,kBAAwB;AAC5B,gBAAM,IAAI;AACV,gBAAMC,KAAI,CAAC,KAAa,OACpB,EAAE,UAAU,EAAE,QAAQ,UAAU,KAAK,CAAC,GAAG,EAAE,UAAU,GAAG,CAAC,IAAI;AAEjE,cAAI,QAAQ;AACZ,gBAAM,SAAS,KAAK,YAAY,WAAW;AAC3C,kBAAQ,KAAK,QAAQ;AAAA,YACjB,KAAK;AACD,sBAAQ,SACFA,GAAE,2BAA2B,UAAU,IACvC,KAAK,YAAY,KAAK,YAAY,SAAS,CAAC;AAClD;AAAA,YACJ,KAAK;AAED,sBAAQ,SACF,WACA,KAAK,YAAY,KAAK,YAAY,SAAS,CAAC,KAAK;AACvD;AAAA,YACJ,KAAK;AACD,sBAAQA,GAAE,yBAAyB,mBAAmB;AACtD;AAAA,YACJ,KAAK;AACD,sBAAQA,GAAE,0BAA0B,UAAU;AAC9C;AAAA,YACJ;AACI,sBAAQ,KAAK,SAAS;AAAA,UAC9B;AAEA,cAAI,KAAK,UAAU,OAAO;AACtB,iBAAK,SAAS,KAAK;AAAA,UACvB;AAAA,QACJ;AAAA,MACJ;AAxXI;AAAA,MA7oCS,YA6oCM,mBAAmB;AAClC,MA9oCS,YA8oCM,mBAAmB;AA9oC/B,MAAM,aAAN;AAugDP,MAAC,OAAe,aAAa;AAAA;AAAA;;;ACvjD7B,MASa;AATb;AAAA;AAAA;AAMA;AAGO,MAAM,eAAN,MAAM,sBAAqB,WAAW;AAAA,QACzC,YAAY,QAAgC;AACxC,gBAAM;AAAA,YACF,MAAM;AAAA,YACN,OAAO;AAAA,YACP,GAAG;AAAA,UACP,CAAC;AAAA,QACL;AAAA,QAEA,YAAyB;AACrB,gBAAM,WAAW,MAAM,UAAU;AAIjC,gBAAM,aAAa,SAAS,cAAc,iBAAiB;AAC3D,cAAI,YAAY;AACZ,uBAAW,OAAO;AAAA,UACtB;AACA,cAAI,KAAK,gBAAgB;AACrB,iBAAK,eAAe,OAAO;AAAA,UAC/B;AAGA,gBAAM,SAAS,SAAS,cAAc,KAAK;AAC3C,iBAAO,KAAK,GAAG,KAAK,EAAE;AACtB,iBAAO,YAAY;AACnB,mBAAS,YAAY,MAAM;AAG3B,eAAK,iBAAiB,SAAS,cAAc,KAAK;AAClD,eAAK,eAAe,KAAK,GAAG,KAAK,EAAE;AACnC,eAAK,eAAe,YAAY;AAChC,mBAAS,YAAY,KAAK,cAAc;AAExC,iBAAO;AAAA,QACX;AAAA,QAEA,OAAa;AACT,gBAAM,KAAK;AAEX,eAAK,YAAY;AAAA,QACrB;AAAA,QAEU,cAAoB;AAC1B,eAAK,cAAc;AAAA,QACvB;AAAA,QAEQ,gBAAsB;AAC1B,gBAAM,IAAI;AACV,cAAI,CAAC,EAAE,cAAc,CAAC,KAAK,SAAS;AAChC;AAAA,UACJ;AACA,gBAAM,SAAS,KAAK,QAAQ,cAAc,IAAI,KAAK,EAAE,OAAO;AAC5D,cAAI,CAAC,QAAQ;AACT;AAAA,UACJ;AAIA,UAAC,OAAuB,MAAM,UAAU;AAExC,gBAAM,WAAW,CAAC,SAAc;AAAA,YAC5B,YAAY,IAAI;AAAA,YAChB,OAAO,IAAI;AAAA,YACX,UAAU,EAAE,UAAU,IAAI,MAAM;AAAA,YAChC,OAAO;AAAA,YACP,MAAM,MAAM,IAAI,KAAK;AAAA,YACrB,MAAM,MAAM,IAAI,KAAK;AAAA,UACzB;AACA,gBAAM,UAAU;AAAA,YACZ,iBAAiB,MAAM,MAAM,KAAK,KAAK,KAAK,OAAO,CAAC,EAAE,IAAI,QAAQ;AAAA,YAClE,mBAAmB,MAAM;AACrB,oBAAM,WAAW,KAAK;AACtB,oBAAMC,KAAI,WAAW,KAAK,KAAK,IAAI,QAAQ,IAAI;AAC/C,qBAAOA,KAAI,SAASA,EAAC,IAAI;AAAA,YAC7B;AAAA,YACA,mBAAmB,MAAM,MAAM,KAAK,KAAK,KAAK,KAAK,CAAC;AAAA,YACpD,aAAa,CAAC,OAAe;AACzB,oBAAMA,KAAI,KAAK,KAAK,IAAI,EAAE,KAAK;AAC/B,qBAAOA,KAAI,SAASA,EAAC,IAAI;AAAA,YAC7B;AAAA,YACA,mBAAmB,CAAC,OAAe,KAAK,aAAa,EAAE;AAAA,YACvD,gBAAgB,CAAC,QAAc;AAC3B,oBAAM,OAAO,EAAE,aACT,IAAI,EAAE,WAAW,EAAE,QAAO,2BAAK,UAAS,YAAY,QAAQ,WAAW,CAAC,IACxE;AACN,kBAAI,MAAM;AACN,qBAAK,OAAO,IAAI;AAEhB,qBAAK,aAAa,KAAK,EAAE;AACzB,uBAAO,SAAS,IAAI;AAAA,cACxB;AACA,qBAAO;AAAA,YACX;AAAA,YACA,iBAAiB,CAAC,OAAe,KAAK,UAAU,EAAE;AAAA,YAClD,kBAAkB,MAAM,KAAK,KAAK;AAAA,YAClC,kBAAkB,CAAC,aAAuB;AACtC,oBAAM,MAAM,KAAK;AACjB,oBAAM,UAAU,oBAAI,IAAiB;AACrC,uBAAS,QAAQ,QAAM;AACnB,sBAAMA,KAAI,IAAI,IAAI,EAAE;AACpB,oBAAIA,GAAG,SAAQ,IAAI,IAAIA,EAAC;AAAA,cAC5B,CAAC;AACD,kBAAI,QAAQ,CAACA,IAAG,OAAO;AACnB,oBAAI,CAAC,QAAQ,IAAI,EAAE,EAAG,SAAQ,IAAI,IAAIA,EAAC;AAAA,cAC3C,CAAC;AACD,cAAC,KAAa,OAAO;AACrB,mBAAK,YAAY;AAAA,YACrB;AAAA,YACA,gBAAgB,CAAC,OAAe;AAC5B,oBAAMA,KAAI,KAAK,UAAU,EAAE;AAC3B,qBAAOA,KAAI,SAASA,EAAC,IAAI;AAAA,YAC7B;AAAA,YACA,eAAe,CAAC,SAAc;AAC1B,oBAAM,MAAM,KAAK,SAAS;AAC1B,mBAAK,OAAO,GAAG;AACf,mBAAK,aAAa,IAAI,EAAE;AACxB,qBAAO,SAAS,GAAG;AAAA,YACvB;AAAA,UACJ;AAGA,cAAK,KAAa,eAAe;AAC7B,YAAC,KAAa,cAAc,QAAQ;AAAA,UACxC;AACA,UAAC,KAAa,gBAAgB,EAAE,WAAW,OAAO,SAAS,QAAuB;AAAA,YAC9E,WAAW;AAAA,YACX,uBAAuB,MAAM,OAAO,KAAK,KAAK,OAAO,CAAC;AAAA,UAC1D,CAAC;AAAA,QACL;AAAA,QAEA,WAAW,OAAgC;AACvC,gBAAM,IAAI;AACV,cAAI,CAAC,EAAE,YAAY;AACf,oBAAQ,MAAM,6BAA6B;AAC3C,mBAAO;AAAA,UACX;AACA,gBAAM,OAAO,IAAI,EAAE,WAAW,EAAE,OAAO,SAAS,YAAY,QAAQ,WAAW,CAAC;AAChF,eAAK,OAAO,IAAI;AAChB,iBAAO;AAAA,QACX;AAAA,QAEA,iBAAiB,OAAgC;AAC7C,gBAAM,IAAI;AACV,cAAI,CAAC,EAAE,YAAY;AACf,oBAAQ,MAAM,6BAA6B;AAC3C,mBAAO;AAAA,UACX;AACA,gBAAM,OAAO,IAAI,EAAE,WAAW,EAAE,OAAO,SAAS,UAAU,QAAQ,UAAU,MAAM,YAAK,CAAC;AACxF,eAAK,OAAO,IAAI;AAChB,iBAAO;AAAA,QACX;AAAA,QAEA,OAAO,OAAO,QAA8C;AACxD,gBAAMC,UAAS,IAAI,cAAa,MAAM;AACtC,UAAAA,QAAO,WAAW,UAAU;AAG5B,gBAAM,IAAI;AACV,cAAI,EAAE,eAAgB,GAAE,eAAe,eAAeA,OAAM;AAE5D,UAAAA,QAAO,KAAK;AACZ,iBAAOA;AAAA,QACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAOA,OAAO,cAAc,QAA8C;AAC/D,gBAAM,IAAI;AACV,cAAI,CAAC,EAAE,gBAAgB;AAEnB,mBAAO,cAAa,OAAO,MAAM;AAAA,UACrC;AAGA,gBAAM,gBAAgB,EAAE,eAAe,iBAAiB,QAAQ;AAEhE,cAAI,cAAc,WAAW,GAAG;AAE5B,mBAAO,cAAa,OAAO,MAAM;AAAA,UACrC;AAGA,cAAI,mBAAmB,cAAc,CAAC;AACtC,qBAAW,OAAO,eAAe;AAC7B,gBAAI,IAAI,SAAS,iBAAiB,QAAQ;AACtC,iCAAmB;AAAA,YACvB;AAAA,UACJ;AAGA,2BAAiB,aAAa;AAC9B,iBAAO;AAAA,QACX;AAAA,MACJ;AAEA,MAAC,OAAe,eAAe;AAAA;AAAA;;;AChN/B,MAqEM,uDAgvBA;AArzBN;AAAA;AAAA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AAsDA,MAAM,6BAAN,MAAM,2BAA0B;AAAA,QAAhC;AAOI;AAAA,eAAQ,gBAA+B;AACvC,eAAQ,cAAc;AACtB,eAAQ,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA,QAKtB,OAAa;AACT,cAAI,KAAK,YAAa;AAEtB,kBAAQ,IAAI,6CAA6C;AAGzD,iBAAO,iBAAiB,QAAQ,MAAM;AAClC,iBAAK,YAAY,EAAE,WAAW,KAAK,CAAC;AAAA,UACxC,CAAC;AAGD,iBAAO,iBAAiB,gBAAgB,MAAM;AAC1C,iBAAK,qBAAqB;AAAA,UAC9B,CAAC;AAGD,mBAAS,iBAAiB,oBAAoB,MAAM;AAChD,gBAAI,SAAS,QAAQ;AACjB,mBAAK,YAAY,EAAE,WAAW,KAAK,CAAC;AAAA,YACxC;AAAA,UACJ,CAAC;AAED,eAAK,cAAc;AACnB,kBAAQ,IAAI,yCAAyC;AAAA,QACzD;AAAA;AAAA;AAAA;AAAA,QAKA,YAAY,UAAmC,CAAC,GAAS;AACrD,kBAAQ,IAAI,mDAAmD;AAAA,YAC3D,WAAW,QAAQ;AAAA,YACnB,aAAa,KAAK;AAAA,UACtB,CAAC;AAED,cAAI,KAAK,aAAa;AAClB,oBAAQ,IAAI,0DAA0D;AACtE;AAAA,UACJ;AAEA,cAAI,QAAQ,WAAW;AACnB,iBAAK,qBAAqB;AAAA,UAC9B,OAAO;AACH,iBAAK,iBAAiB;AAAA,UAC1B;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKQ,uBAA6B;AACjC,kBAAQ,IAAI,yDAAyD;AAErE,cAAI,KAAK,kBAAkB,MAAM;AAC7B,yBAAa,KAAK,aAAa;AAC/B,iBAAK,gBAAgB;AAAA,UACzB;AAEA,cAAI;AACA,oBAAQ,IAAI,0DAA0D;AACtE,kBAAM,UAAU,KAAK,cAAc;AACnC,oBAAQ,IAAI,gDAAgD;AAAA,cACxD,SAAS,QAAQ,QAAQ;AAAA,cACzB,WAAW,QAAQ,QAAQ,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,KAAK,QAAQ,CAAC;AAAA,YACxE,CAAC;AAED,kBAAM,aAAa,KAAK,UAAU,OAAO;AACzC,oBAAQ;AAAA,cACJ;AAAA,cACA,WAAW;AAAA,YACf;AAEA,yBAAa,QAAQ,2BAA0B,aAAa,UAAU;AACtE,oBAAQ,IAAI,2DAA2D;AAEvE,oBAAQ,IAAI,8CAA8C;AAAA,cACtD,SAAS,QAAQ,QAAQ;AAAA,cACzB,WAAW,QAAQ,QAAQ,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,KAAK,QAAQ,CAAC;AAAA,cACpE,aAAa,KAAK;AAAA,YACtB,CAAC;AAAA,UACL,SAAS,OAAO;AACZ,oBAAQ,MAAM,uDAAuD,KAAK;AAC1E,gBAAI,iBAAiB,OAAO;AACxB,sBAAQ,MAAM,4CAA4C,MAAM,KAAK;AAAA,YACzE;AAAA,UACJ;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKQ,mBAAyB;AAC7B,cAAI,KAAK,kBAAkB,MAAM;AAC7B,yBAAa,KAAK,aAAa;AAAA,UACnC;AAEA,eAAK,gBAAgB,OAAO,WAAW,MAAM;AACzC,iBAAK,qBAAqB;AAAA,UAC9B,GAAG,2BAA0B,eAAe;AAAA,QAChD;AAAA;AAAA;AAAA;AAAA,QAKQ,gBAAoC;AACxC,gBAAM,UAAU,wBAAe,cAAc;AAE7C,iBAAO;AAAA,YACH,SAAS,2BAA0B;AAAA,YACnC,WAAW,KAAK,IAAI;AAAA,YACpB,SAAS,QAAQ,IAAI,CAAAC,YAAU,KAAK,gBAAgBA,OAAM,CAAC;AAAA,YAC3D,UAAU;AAAA,cACN,OAAO,KAAK,gBAAgB;AAAA,cAC5B,UAAU,KAAK,mBAAmB;AAAA,YACtC;AAAA,UACJ;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKQ,gBAAgBA,SAAuC;AAC3D,gBAAM,OAAO,MAAM,KAAKA,QAAO,KAAK,OAAO,CAAC;AAE5C,iBAAO;AAAA,YACH,IAAIA,QAAO;AAAA,YACX,MAAMA,QAAO;AAAA,YACb,UAAU,EAAE,GAAGA,QAAO,SAAS;AAAA,YAC/B,QAAQA,QAAO;AAAA,YACf,aAAaA,QAAO;AAAA,YACpB,aAAaA,QAAO;AAAA,YACpB,aAAaA,QAAO;AAAA,YACpB,MAAM,KAAK,IAAI,SAAO,KAAK,aAAa,GAAG,CAAC;AAAA,YAC5C,UAAUA,QAAO;AAAA,UACrB;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKQ,aAAa,KAAoB;AA/N7C;AAiOQ,cAAI,OAAO,IAAI,cAAc,YAAY;AACrC,mBAAO,IAAI,UAAU;AAAA,UACzB;AAGA,iBAAO;AAAA,YACH,IAAI,IAAI;AAAA,YACR,MAAM,IAAI;AAAA,YACV,OAAO,IAAI;AAAA,YACX,MAAM,IAAI;AAAA,YACV,cAAc,IAAI,gBAAgB,CAAC;AAAA,YACnC,WAAS,SAAI,aAAJ,mBAAc,YAAW,KAAK,IAAI;AAAA,YAC3C,YAAU,SAAI,aAAJ,mBAAc,aAAY,KAAK,IAAI;AAAA,UACjD;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,MAAM,iBAAmC;AACrC,kBAAQ;AAAA,YACJ;AAAA,UACJ;AACA,eAAK,cAAc;AAEnB,cAAI;AAEA,kBAAM,cAAc,aAAa,QAAQ,2BAA0B,WAAW;AAE9E,gBAAI,aAAa;AACb,sBAAQ,IAAI,4DAA4D;AACxE,oBAAM,UAAU,KAAK,MAAM,WAAW;AACtC,sBAAQ,IAAI,+CAA+C;AAAA,gBACvD,SAAS,QAAQ,QAAQ;AAAA,gBACzB,aAAa,QAAQ,QAAQ,IAAI,OAAK,EAAE,IAAI;AAAA,cAChD,CAAC;AAED,mBAAK,oBAAoB,OAAO;AAChC,oBAAM,KAAK,0BAA0B,OAAO;AAC5C,sBAAQ,IAAI,2DAA2D;AACvE,qBAAO;AAAA,YACX;AAGA,kBAAM,eAAe,aAAa;AAAA,cAC9B,2BAA0B;AAAA,YAC9B;AACA,gBAAI,cAAc;AACd,sBAAQ,IAAI,4DAA4D;AACxE,oBAAM,aAAa,KAAK,MAAM,YAAY;AAE1C,oBAAM,UAAU,KAAK,yBAAyB,UAAU;AAExD,mBAAK,oBAAoB,OAAO;AAChC,oBAAM,KAAK,0BAA0B,OAAO;AAE5C,2BAAa,WAAW,2BAA0B,qBAAqB;AACvE,mBAAK,qBAAqB;AAC1B,qBAAO;AAAA,YACX;AAGA,kBAAM,aAAa,aAAa,QAAQ,2BAA0B,kBAAkB;AACpF,gBAAI,YAAY;AACZ,sBAAQ,IAAI,yDAAyD;AACrE,oBAAM,gBAAgB,KAAK,MAAM,UAAU;AAC3C,oBAAM,KAAK,qBAAqB,aAAa;AAC7C,qBAAO;AAAA,YACX;AAEA,oBAAQ,IAAI,mDAAmD;AAC/D,mBAAO;AAAA,UACX,SAAS,OAAO;AACZ,oBAAQ,MAAM,0DAA0D,KAAK;AAC7E,mBAAO;AAAA,UACX,UAAE;AACE,oBAAQ;AAAA,cACJ;AAAA,YACJ;AACA,iBAAK,cAAc;AAAA,UACvB;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,MAAc,0BAA0B,SAA4C;AAvTxF;AAwTQ,kBAAQ,IAAI,kDAAkD;AAAA,YAC1D,SAAS,QAAQ;AAAA,YACjB,SAAS,QAAQ,QAAQ;AAAA,YACzB,WAAW,IAAI,KAAK,QAAQ,SAAS;AAAA,UACzC,CAAC;AAID,gBAAM,uBAAuB;AAC7B,gBAAM,oBAAoB;AAE1B,cAAI,QAAQ,QAAQ,SAAS,mBAAmB;AAC5C,oBAAQ;AAAA,cACJ,2CAA2C,QAAQ,QAAQ,MAAM,iBAAiB,iBAAiB;AAAA,YACvG;AACA,yBAAa,WAAW,2BAA0B,WAAW;AAC7D;AAAA,UACJ;AAGA,gBAAM,YAAY,oBAAI,IAAoB;AAC1C,kBAAQ,QAAQ,QAAQ,OAAK;AACzB,kBAAM,QAAQ,UAAU,IAAI,EAAE,IAAI,KAAK;AACvC,sBAAU,IAAI,EAAE,MAAM,QAAQ,CAAC;AAAA,UACnC,CAAC;AAGD,qBAAW,CAAC,MAAM,KAAK,KAAK,UAAU,QAAQ,GAAG;AAC7C,gBAAI,QAAQ,sBAAsB;AAC9B,sBAAQ;AAAA,gBACJ,2CAA2C,KAAK,IAAI,IAAI,iBAAiB,oBAAoB;AAAA,cACjG;AACA,2BAAa,WAAW,2BAA0B,WAAW;AAC7D;AAAA,YACJ;AAAA,UACJ;AAGA,gBAAM,gBAAgB,oBAAI,IAAoB;AAC9C,gBAAM,kBAAkB,QAAQ,QAAQ,OAAO,OAAK;AAChD,kBAAM,QAAQ,cAAc,IAAI,EAAE,IAAI,KAAK;AAC3C,gBAAI,SAAS,sBAAsB;AAC/B,sBAAQ;AAAA,gBACJ,wCAAwC,EAAE,IAAI,kBAAkB,oBAAoB;AAAA,cACxF;AACA,qBAAO;AAAA,YACX;AACA,0BAAc,IAAI,EAAE,MAAM,QAAQ,CAAC;AACnC,mBAAO;AAAA,UACX,CAAC;AAGD,gBAAM,gBAAgB,gBAAgB,KAAK,CAAC,GAAG,MAAM,EAAE,SAAS,EAAE,MAAM;AAGxE,qBAAW,cAAc,eAAe;AACpC,kBAAM,KAAK,cAAc,UAAU;AAAA,UACvC;AAGA,cAAI,QAAQ,UAAU;AAClB,iBAAK,gBAAgB,QAAQ,QAAQ;AAAA,UACzC;AAEA,kBAAQ,IAAI,2DAA2D;AAGvE,gBAAM,IAAI;AACV,kBAAE,yBAAF;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,MAAc,cAAc,MAAqD;AAC7E,cAAI;AAEA,kBAAMA,UAAS,KAAK,mBAAmB,KAAK,MAAM,IAAI;AACtD,gBAAI,CAACA,SAAQ;AACT,sBAAQ,MAAM,oDAAoD,KAAK,IAAI,EAAE;AAC7E,qBAAO;AAAA,YACX;AAGA,uBAAW,WAAW,KAAK,MAAM;AAC7B,oBAAM,MAAM,KAAK,WAAW,OAAO;AACnC,kBAAI,KAAK;AACL,gBAAAA,QAAO,OAAO,GAAG;AAAA,cACrB;AAAA,YACJ;AAGA,gBAAI,KAAK,eAAeA,QAAO,KAAK,IAAI,KAAK,WAAW,GAAG;AACvD,cAAAA,QAAO,aAAa,KAAK,WAAW;AAAA,YACxC,WAAWA,QAAO,KAAK,OAAO,GAAG;AAE7B,oBAAM,aAAa,MAAM,KAAKA,QAAO,KAAK,KAAK,CAAC,EAAE,CAAC;AACnD,kBAAI,WAAY,CAAAA,QAAO,aAAa,UAAU;AAAA,YAClD;AAGA,YAAAA,QAAO,KAAK;AACZ,oCAAe,eAAeA,OAAM;AAGpC,uBAAW,MAAM;AACb,kBAAIA,QAAO,SAAS;AAChB,gBAAAA,QAAO,QAAQ,MAAM,SAAS,OAAO,KAAK,MAAM;AAGhD,oBAAI,KAAK,YAAY,CAAC,KAAK,aAAa;AACpC,kBAAAA,QAAO,QAAQ,MAAM,OAAO,GAAG,KAAK,SAAS,CAAC;AAC9C,kBAAAA,QAAO,QAAQ,MAAM,MAAM,GAAG,KAAK,SAAS,CAAC;AAC7C,kBAAAA,QAAO,QAAQ,MAAM,QAAQ,GAAG,KAAK,SAAS,KAAK;AACnD,kBAAAA,QAAO,QAAQ,MAAM,SAAS,GAAG,KAAK,SAAS,MAAM;AAErD,kBAAAA,QAAO,WAAW,EAAE,GAAG,KAAK,SAAS;AAAA,gBACzC;AAEA,oBAAI,KAAK,aAAa;AAClB,kBAAAA,QAAO,SAAS;AAAA,gBACpB,WAAW,KAAK,eAAe,CAACA,QAAO,aAAa;AAChD,kBAAAA,QAAO,eAAe;AAAA,gBAC1B;AAAA,cACJ;AAAA,YACJ,GAAG,CAAC;AAEJ,mBAAOA;AAAA,UACX,SAAS,OAAO;AACZ,oBAAQ,MAAM,yDAAyD,KAAK;AAC5E,mBAAO;AAAA,UACX;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKQ,mBAAmB,MAAc,MAA4C;AACjF,gBAAM,SAAS;AAAA,YACX,IAAI,KAAK;AAAA,YACT;AAAA,YACA,UAAU,KAAK;AAAA,YACf,UAAU,KAAK;AAAA,UACnB;AAEA,kBAAQ,MAAM;AAAA,YACV,KAAK;AACD,qBAAO,IAAI,eAAe,MAAM;AAAA,YAEpC,KAAK;AACD,qBAAO,IAAI,iBAAiB,MAAM;AAAA,YAEtC,KAAK;AACD,qBAAO,IAAI,aAAa,MAAM;AAAA,YAElC;AACI,qBAAO;AAAA,UACf;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKQ,WAAW,MAAqB;AACpC,cAAI;AAEA,oBAAQ,KAAK,MAAM;AAAA,cACf,KAAK;AACD,uBAAO,gBAAgB,YAAY,IAAI;AAAA,cAE3C,KAAK;AACD,uBAAO,mBAAmB,YAAY,IAAI;AAAA,cAE9C,KAAK;AACD,uBAAO,WAAW,YAAY,IAAI;AAAA,cAEtC;AACI,wBAAQ,KAAK,iDAAiD,KAAK,IAAI,EAAE;AACzE,uBAAO;AAAA,YACf;AAAA,UACJ,SAAS,OAAO;AACZ,oBAAQ,MAAM,sDAAsD,KAAK;AACzE,mBAAO;AAAA,UACX;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKQ,kBAAkB,MAAyC;AAC/D,cAAI,CAAC,KAAM,QAAO;AAGlB,cAAI,KAAK,WAAW,GAAG,EAAG,QAAO;AAGjC,cAAI,SAAS,cAAc,SAAS,KAAK;AACrC,mBAAO;AAAA,UACX;AAEA,cAAI,KAAK,WAAW,eAAe,GAAG;AAGlC,kBAAM,UAAU,KAAK,MAAM,gBAAgB,MAAM;AACjD,mBAAO,UAAU,eAAe,OAAO,KAAK;AAAA,UAChD;AAEA,cAAI,KAAK,WAAW,WAAW,GAAG;AAE9B,kBAAM,UAAU,KAAK,MAAM,YAAY,MAAM;AAC7C,mBAAO,gBAAgB,OAAO;AAAA,UAClC;AAGA,cAAI,KAAK,WAAW,IAAI,GAAG;AACvB,mBAAO,kBAAkB,KAAK,MAAM,CAAC;AAAA,UACzC;AAGA,iBAAO,gBAAgB,IAAI;AAAA,QAC/B;AAAA;AAAA;AAAA;AAAA,QAKQ,oBAAoB,SAAoB;AAzhBpD;AA0hBQ,cAAI,CAAC,WAAW,CAAC,QAAQ,QAAS;AAElC,qBAAWA,WAAU,QAAQ,SAAS;AAElC,kBAAM,YAAYA,QAAO,QAAQA,QAAO,YAAY,CAAC;AAErD,uBAAW,OAAO,WAAW;AAEzB,kBAAI,IAAI,QAAQ;AACZ,sBAAM,WAAW,KAAK,kBAAkB,IAAI,MAAM;AAClD,wBAAQ;AAAA,kBACJ,+CAA+C,IAAI,MAAM,WAAM,QAAQ;AAAA,gBAC3E;AACA,oBAAI,SAAS;AAAA,cACjB;AAGA,kBAAI,IAAI,eAAe,CAAC,IAAI,QAAQ;AAChC,sBAAM,WAAW,KAAK,kBAAkB,IAAI,WAAW;AACvD,wBAAQ;AAAA,kBACJ,sDAAsD,IAAI,WAAW,WAAM,QAAQ;AAAA,gBACvF;AACA,oBAAI,SAAS;AACb,oBAAI,cAAc;AAAA,cACtB;AAGA,mBAAI,SAAI,iBAAJ,mBAAkB,QAAQ;AAC1B,sBAAM,WAAW,KAAK,kBAAkB,IAAI,aAAa,MAAM;AAC/D,oBAAI,aAAa,SAAS;AAAA,cAC9B;AAGA,mBAAI,SAAI,iBAAJ,mBAAkB,aAAa;AAC/B,sBAAM,WAAW,KAAK,kBAAkB,IAAI,aAAa,WAAW;AACpE,oBAAI,aAAa,cAAc;AAAA,cACnC;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA;AAAA,QAMQ,yBAAyB,SAAkC;AAC/D,gBAAM,aAAiC;AAAA,YACnC,SAAS,2BAA0B;AAAA,YACnC,WAAW,QAAQ,aAAa,KAAK,IAAI;AAAA,YACzC,SAAS,CAAC;AAAA,YACV,UAAU,QAAQ,YAAY,CAAC;AAAA,UACnC;AAEA,qBAAWA,WAAU,QAAQ,WAAW,CAAC,GAAG;AACxC,kBAAM,aAAgC;AAAA,cAClC,IAAIA,QAAO,MAAMA,QAAO,YAAY,UAAU,KAAK,IAAI,CAAC;AAAA,cACxD,MAAMA,QAAO,QAAQ,QAAQ,cAAc;AAAA,cAC3C,UAAUA,QAAO,YAAY,EAAE,GAAG,KAAK,GAAG,KAAK,OAAO,KAAK,QAAQ,IAAI;AAAA,cACvE,QAAQA,QAAO,UAAU;AAAA,cACzB,aAAaA,QAAO,eAAe;AAAA,cACnC,aAAaA,QAAO,eAAe;AAAA,cACnC,aAAaA,QAAO,eAAe;AAAA,cACnC,MAAM,CAAC;AAAA,cACP,UAAUA,QAAO,YAAY,CAAC;AAAA,YAClC;AAGA,kBAAM,aAAaA,QAAO,QAAQA,QAAO,YAAY,CAAC;AACtD,uBAAW,OAAO,YAAY;AAC1B,oBAAM,UAAe;AAAA,gBACjB,IAAI,IAAI,MAAM,IAAI,aAAa,OAAO,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,CAAC;AAAA,gBACjE,MAAM,IAAI,QAAQ;AAAA,gBAClB,OAAO,IAAI,SAAS;AAAA,gBACpB,MAAM,IAAI;AAAA,gBACV,cAAc,IAAI,gBAAgB,CAAC;AAAA,gBACnC,SAAS,IAAI,WAAW,KAAK,IAAI;AAAA,gBACjC,UAAU,IAAI,YAAY,KAAK,IAAI;AAAA,cACvC;AAGA,kBAAI,IAAI,OAAQ,SAAQ,SAAS,IAAI;AACrC,kBAAI,IAAI,YAAa,SAAQ,cAAc,IAAI;AAC/C,kBAAI,IAAI,eAAgB,SAAQ,iBAAiB,IAAI;AAErD,yBAAW,KAAK,KAAK,OAAO;AAAA,YAChC;AAGA,gBAAI,CAAC,WAAW,eAAe,WAAW,KAAK,SAAS,GAAG;AACvD,oBAAM,WAAW,WAAW,KAAK,CAAC;AAClC,kBAAI,UAAU;AACV,2BAAW,cAAc,SAAS;AAAA,cACtC;AAAA,YACJ;AAEA,uBAAW,QAAQ,KAAK,UAAU;AAAA,UACtC;AAEA,iBAAO;AAAA,QACX;AAAA;AAAA;AAAA;AAAA,QAKA,MAAc,qBAAqB,QAAsC;AACrE,kBAAQ,IAAI,0DAA0D;AAEtE,gBAAM,YAAY,OAAO,aAAa,CAAC;AAGvC,cAAI,UAAU,UAAU,KAAK,UAAU,UAAU,EAAE,SAAS,GAAG;AAC3D,kBAAM,aAAa,eAAe,OAAO;AAEzC,uBAAW,eAAe,UAAU,UAAU,GAAG;AAC7C,kBAAI;AACA,sBAAM,UAAU,gBAAgB,YAAY,WAAW;AACvD,2BAAW,OAAO,OAAO;AAAA,cAC7B,SAAS,OAAO;AACZ,wBAAQ;AAAA,kBACJ;AAAA,kBACA;AAAA,gBACJ;AAAA,cACJ;AAAA,YACJ;AAEA,gBAAI,WAAW,KAAK,OAAO,GAAG;AAC1B,oBAAM,aAAa,MAAM,KAAK,WAAW,KAAK,KAAK,CAAC,EAAE,CAAC;AACvD,kBAAI,WAAY,YAAW,aAAa,UAAU;AAAA,YACtD;AAAA,UACJ;AAGA,cAAI,UAAU,aAAa,KAAK,UAAU,aAAa,EAAE,SAAS,GAAG;AACjE,kBAAM,eAAe,iBAAiB,OAAO;AAE7C,uBAAW,WAAW,UAAU,aAAa,GAAG;AAC5C,kBAAI;AACA,sBAAM,MAAM,mBAAmB,YAAY,OAAO;AAClD,6BAAa,OAAO,GAAG;AAAA,cAC3B,SAAS,OAAO;AACZ,wBAAQ;AAAA,kBACJ;AAAA,kBACA;AAAA,gBACJ;AAAA,cACJ;AAAA,YACJ;AAEA,gBAAI,aAAa,KAAK,OAAO,GAAG;AAC5B,oBAAM,aAAa,MAAM,KAAK,aAAa,KAAK,KAAK,CAAC,EAAE,CAAC;AACzD,kBAAI,WAAY,cAAa,aAAa,UAAU;AAAA,YACxD;AAAA,UACJ;AAGA,cAAI,UAAU,QAAQ,KAAK,UAAU,QAAQ,EAAE,SAAS,GAAG;AACvD,kBAAM,eAAe,aAAa,OAAO;AAEzC,uBAAW,YAAY,UAAU,QAAQ,GAAG;AACxC,kBAAI;AACA,sBAAM,OAAO,WAAW,YAAY,QAAQ;AAC5C,6BAAa,OAAO,IAAI;AAAA,cAC5B,SAAS,OAAO;AACZ,wBAAQ;AAAA,kBACJ;AAAA,kBACA;AAAA,gBACJ;AAAA,cACJ;AAAA,YACJ;AAEA,gBAAI,aAAa,KAAK,OAAO,GAAG;AAC5B,oBAAM,aAAa,MAAM,KAAK,aAAa,KAAK,KAAK,CAAC,EAAE,CAAC;AACzD,kBAAI,WAAY,cAAa,aAAa,UAAU;AAAA,YACxD;AAAA,UACJ;AAGA,eAAK,qBAAqB;AAC1B,uBAAa,WAAW,2BAA0B,kBAAkB;AAEpE,kBAAQ,IAAI,wDAAwD;AAAA,QACxE;AAAA;AAAA;AAAA;AAAA,QAKA,gBAAwB;AACpB,gBAAM,UAAU,KAAK,cAAc;AACnC,iBAAO,KAAK,UAAU,SAAS,MAAM,CAAC;AAAA,QAC1C;AAAA;AAAA;AAAA;AAAA,QAKA,MAAM,cAAc,YAAsC;AACtD,cAAI;AACA,kBAAM,UAAU,KAAK,MAAM,UAAU;AAGrC,gBAAI,QAAQ,YAAY,2BAA0B,SAAS;AACvD,sBAAQ;AAAA,gBACJ;AAAA,cACJ;AAAA,YACJ;AAGA,oCAAe,gBAAgB;AAG/B,kBAAM,KAAK,0BAA0B,OAAO;AAE5C,mBAAO;AAAA,UACX,SAAS,OAAO;AACZ,oBAAQ,MAAM,yDAAyD,KAAK;AAC5E,mBAAO;AAAA,UACX;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,eAAqB;AACjB,uBAAa,WAAW,2BAA0B,WAAW;AAC7D,kBAAQ,IAAI,6CAA6C;AAAA,QAC7D;AAAA;AAAA;AAAA;AAAA,QAKQ,kBAA0B;AAC9B,iBAAO,aAAa,QAAQ,kBAAkB,KAAK;AAAA,QACvD;AAAA;AAAA;AAAA;AAAA,QAKQ,qBAA6B;AACjC,iBAAO,aAAa,QAAQ,qBAAqB,KAAK;AAAA,QAC1D;AAAA;AAAA;AAAA;AAAA,QAKQ,gBAAgB,UAAqC;AAEzD,kBAAQ,IAAI,iDAAiD,QAAQ;AAAA,QACzE;AAAA;AAAA;AAAA;AAAA,QAKA,iBAAsB;AAClB,gBAAM,cAAc,aAAa,QAAQ,2BAA0B,WAAW;AAC9E,cAAI,CAAC,YAAa,QAAO;AAEzB,cAAI;AACA,kBAAM,UAAU,KAAK,MAAM,WAAW;AACtC,mBAAO;AAAA,cACH,SAAS,QAAQ;AAAA,cACjB,WAAW,IAAI,KAAK,QAAQ,SAAS;AAAA,cACrC,aAAa,QAAQ,QAAQ;AAAA,cAC7B,UAAU,QAAQ,QAAQ,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,KAAK,QAAQ,CAAC;AAAA,cACnE,SAAS,QAAQ,QAAQ,IAAI,QAAM;AAAA,gBAC/B,MAAM,EAAE;AAAA,gBACR,MAAM,EAAE,KAAK;AAAA,gBACb,WAAW,EAAE;AAAA,gBACb,UAAU,EAAE;AAAA,cAChB,EAAE;AAAA,YACN;AAAA,UACJ,QAAQ;AACJ,mBAAO;AAAA,UACX;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,WAAiB;AACb,gBAAM,OAAO,KAAK,eAAe;AACjC,kBAAQ,IAAI,gDAAgD,IAAI;AAAA,QACpE;AAAA,MACJ;AA5uBI,MADE,2BACa,cAAc;AAC7B,MAFE,2BAEa,qBAAqB;AACpC;AAAA,MAHE,2BAGa,wBAAwB;AACvC;AAAA,MAJE,2BAIa,UAAU;AACzB,MALE,2BAKa,kBAAkB;AALrC,MAAM,4BAAN;AAgvBA,MAAM,4BAA4B,IAAI,0BAA0B;AAChE,MAAC,OAAe,4BAA4B;AAAA;AAAA;;;ACtzB5C;AAAA;AAAA;AASA;AAFA,cAAQ,IAAI,uBAAuB;AAInC,OAAC,MAAM;AACH;AAwBA,cAAM,sBAAsB;AAC5B,cAAM,kBAAkB;AACxB,cAAM,sBAAsB;AAC5B,cAAM,mBAAmB,IAAI,OAAO;AAGpC,YAAI,YAA2B;AAC/B,YAAI,gBAAgB;AACpB,YAAI,mBAAmB,oBAAI,IAAY;AACvC,YAAI,gBAAgB;AACpB,YAAI,iBAAiB;AAOrB,iBAAS,aAAa,MAAuB;AACzC,cAAI;AACA,mBAAO,KAAK,UAAU,IAAI,EAAE,SAAS;AAAA,UACzC,QAAQ;AACJ,mBAAO;AAAA,UACX;AAAA,QACJ;AAKA,iBAAS,kBAAkB,UAA2B;AAClD,cAAI,eAAe;AACf,mBAAO;AAAA,UACX;AACA,iBAAO,WAAW;AAAA,QACtB;AAKA,iBAAS,cAAkC;AACvC,cAAI;AACA,kBAAM,SAAS,QAA4B,qBAAqB,IAAI;AACpE,gBAAI,CAAC,UAAU,OAAO,WAAW,SAAU,QAAO;AAClD,gBAAI,OAAO,YAAY,iBAAiB;AACpC,sBAAQ;AAAA,gBACJ,6CAA6C,OAAO,OAAO,eAAe,eAAe;AAAA,cAC7F;AACA,qBAAO;AAAA,YACX;AACA,mBAAO;AAAA,UACX,SAAS,KAAK;AACV,oBAAQ,KAAK,2CAA2C,GAAG;AAC3D,mBAAO;AAAA,UACX;AAAA,QACJ;AAKA,iBAAS,aAAa,SAA+B;AACjD,gBAAM,OAAO,aAAa,OAAO;AAEjC,cAAI,CAAC,kBAAkB,IAAI,GAAG;AAC1B,gBAAI,CAAC,eAAe;AAChB,sBAAQ,MAAM,6DAA6D;AAC3E,sBAAQ;AAAA,gBACJ,sBAAsB,OAAO,MAAM,QAAQ,CAAC,CAAC,iBAAiB,mBAAmB,MAAM,QAAQ,CAAC,CAAC;AAAA,cACrG;AACA,8BAAgB;AAAA,YACpB;AACA,mBAAO;AAAA,UACX;AAEA,cAAI;AACA,oBAAQ,qBAAqB,OAAO;AACpC,4BAAgB;AAChB,mBAAO;AAAA,UACX,SAAS,KAAK;AACV,gBAAI,eAAe,SAAS,IAAI,SAAS,sBAAsB;AAC3D,sBAAQ,MAAM,2CAA2C,GAAG;AAC5D,8BAAgB;AAAA,YACpB,OAAO;AACH,sBAAQ,MAAM,4CAA4C,GAAG;AAAA,YACjE;AACA,mBAAO;AAAA,UACX;AAAA,QACJ;AAKA,iBAAS,eAAqB;AAC1B,cAAI;AACA,mBAAO,mBAAmB;AAC1B,oBAAQ,IAAI,iCAAiC;AAAA,UACjD,SAAS,KAAK;AACV,oBAAQ,KAAK,4CAA4C,GAAG;AAAA,UAChE;AAAA,QACJ;AAOA,iBAAS,sBAA4C;AACjD,gBAAM,WAAW,oBAAI,IAAqB;AAC1C,gBAAM,IAAI;AAIV,gBAAM,gBAAgB,CAAC,2BAA2B,2BAA2B;AAE7E,wBAAc,QAAQ,SAAO;AACzB,kBAAM,UAAU,EAAE,GAAG;AACrB,gBAAI,WAAW,OAAO,YAAY,UAAU;AACxC,oBAAM,MAAM;AACZ,oBAAM,OACF,OAAO,IAAI,SAAS,WACd,IAAI,OACJ,IAAI,QAAQ,mBAAmB,EAAE,EAAE,YAAY;AACzD,uBAAS,IAAI,MAAM,OAAO;AAAA,YAC9B;AAAA,UACJ,CAAC;AAED,iBAAO;AAAA,QACX;AAKA,iBAAS,wBAGP;AACE,gBAAM,SAAyC,CAAC;AAChD,gBAAM,SAAwC,CAAC;AAC/C,gBAAM,WAAW,oBAAoB;AAErC,mBAAS,QAAQ,CAAC,SAAS,SAAS;AAChC,kBAAM,MAAM;AACZ,gBAAI,OAAO,IAAI,iBAAiB,YAAY;AACxC,kBAAI;AACA,sBAAM,YACF,IAAI,aACN,KAAK,GAAG;AACV,oBAAI,MAAM,QAAQ,SAAS,GAAG;AAC1B,yBAAO,IAAI,IAAI;AAAA,gBACnB;AAAA,cACJ,SAAS,KAAK;AACV,wBAAQ;AAAA,kBACJ,2DAA2D,IAAI;AAAA,kBAC/D;AAAA,gBACJ;AAAA,cACJ;AAAA,YACJ;AAGA,gBAAI;AACA,kBAAI,OAAQ,IAAY,sBAAsB,YAAY;AACtD,sBAAM,aAAc,IAAY,kBAAkB,KAAK,GAAG;AAC1D,uBAAO,IAAI,KAAI,yCAAY,eAAc;AAAA,cAC7C,OAAO;AACH,uBAAO,IAAI,IAAI;AAAA,cACnB;AAAA,YACJ,QAAQ;AACJ,qBAAO,IAAI,IAAI;AAAA,YACnB;AAAA,UACJ,CAAC;AAED,iBAAO,EAAE,WAAW,QAAQ,OAAO;AAAA,QACvC;AAOA,iBAAS,cAAoB;AACzB,cAAI,gBAAgB;AAChB,oBAAQ,KAAK,oDAAoD;AACjE;AAAA,UACJ;AAEA,2BAAiB;AAEjB,cAAI;AACA,kBAAM,EAAE,WAAW,OAAO,IAAI,sBAAsB;AAGpD,kBAAM,gBAAiB,OAAe;AACtC,kBAAM,cACF,iBAAiB,OAAO,cAAc,mBAAmB,aACnD,cAAc,eAAe,IAC7B,CAAC;AAEX,kBAAM,UAAuB;AAAA,cACzB,SAAS;AAAA,cACT,WAAW,KAAK,IAAI;AAAA,cACpB;AAAA,cACA;AAAA,cACA;AAAA,YACJ;AAEA,kBAAM,UAAU,aAAa,OAAO;AACpC,gBAAI,SAAS;AACT,oBAAM,gBAAgB,OAAO,OAAO,SAAS,EAAE;AAAA,gBAC3C,CAAC,KAAK,QAAQ,MAAM,IAAI;AAAA,gBACxB;AAAA,cACJ;AACA,sBAAQ;AAAA,gBACJ,yBAAyB,aAAa,qBAAqB,OAAO,KAAK,SAAS,EAAE,MAAM;AAAA,cAC5F;AAAA,YACJ;AAEA,6BAAiB,MAAM;AAAA,UAC3B,SAAS,KAAK;AACV,oBAAQ,MAAM,gCAAgC,GAAG;AAAA,UACrD,UAAE;AACE,6BAAiB;AAAA,UACrB;AAAA,QACJ;AAKA,iBAAS,aAAa,cAA6B;AAC/C,cAAI,cAAc;AACd,6BAAiB,IAAI,YAAY;AAAA,UACrC;AAEA,cAAI,cAAc,MAAM;AACpB,yBAAa,SAAS;AAAA,UAC1B;AAEA,sBAAY,OAAO,WAAW,MAAM;AAChC,wBAAY;AACZ,wBAAY;AAAA,UAChB,GAAG,aAAa;AAAA,QACpB;AAOA,iBAAS,QAAQ,UAAuB,CAAC,GAAS;AAC9C,cAAI,QAAQ,WAAW;AACnB,gBAAI,cAAc,MAAM;AACpB,2BAAa,SAAS;AACtB,0BAAY;AAAA,YAChB;AACA,wBAAY;AAAA,UAChB,OAAO;AACH,yBAAa;AAAA,UACjB;AAAA,QACJ;AAKA,iBAAS,iBAAiB,cAAsB,UAAuB,CAAC,GAAS;AAC7E,cAAI,QAAQ,WAAW;AACnB,gBAAI,cAAc,MAAM;AACpB,2BAAa,SAAS;AACtB,0BAAY;AAAA,YAChB;AACA,wBAAY;AAAA,UAChB,OAAO;AACH,yBAAa,YAAY;AAAA,UAC7B;AAAA,QACJ;AAKA,iBAAS,iBAA0B;AAC/B,gBAAM,UAAU,YAAY;AAE5B,cAAI;AACA,oBAAQ,KAAK,yCAAyC;AACtD,oBAAQ,MAAM,iCAAiC,OAAO;AAAA,UAC1D,QAAQ;AAAA,UAER;AACA,cAAI,CAAC,SAAS;AACV,oBAAQ,IAAI,uCAAuC;AACnD,mBAAO;AAAA,UACX;AAEA,gBAAM,WAAW,oBAAoB;AACrC,cAAI;AACA,oBAAQ,KAAK,yCAAyC,MAAM,KAAK,SAAS,KAAK,CAAC,CAAC;AAAA,UACrF,QAAQ;AAAA,UAER;AACA,cAAI,gBAAgB;AAEpB,gBAAM,YAAa,QAAwB,UAAU,CAAC;AAEtD,iBAAO,QAAQ,QAAQ,SAAS,EAAE,QAAQ,CAAC,CAAC,MAAM,SAAS,MAAM;AAC7D,kBAAM,UAAU,SAAS,IAAI,IAAI;AACjC,gBAAI,CAAC,SAAS;AACV,sBAAQ,KAAK,8CAA8C,IAAI,GAAG;AAClE;AAAA,YACJ;AAEA,kBAAM,MAAM;AACZ,gBAAI,OAAO,IAAI,mBAAmB,YAAY;AAC1C,kBAAI;AACA,gBAAC,IAAI,eAAkD,SAAS;AAChE,iCAAiB,UAAU;AAC3B,wBAAQ,IAAI,4BAA4B,UAAU,MAAM,KAAK,IAAI,aAAa;AAE9E,sBAAM,WAAW,UAAU,IAAI,KAAK;AACpC,oBAAI,YAAY,OAAQ,IAAY,sBAAsB,YAAY;AAClE,sBAAI;AACA,oBAAC,IAAY,kBAAkB,QAAQ;AAAA,kBAC3C,SAAS,GAAG;AACR,4BAAQ;AAAA,sBACJ,qDAAqD,IAAI;AAAA,sBACzD;AAAA,oBACJ;AAAA,kBACJ;AAAA,gBACJ;AAAA,cACJ,SAAS,KAAK;AACV,wBAAQ;AAAA,kBACJ,yDAAyD,IAAI;AAAA,kBAC7D;AAAA,gBACJ;AAAA,cACJ;AAAA,YACJ;AAAA,UACJ,CAAC;AAGD,gBAAM,cAAc,QAAQ,eAAe,CAAC;AAC5C,cAAI,YAAY,SAAS,GAAG;AACxB,kBAAM,gBAAiB,OAAe;AACtC,gBAAI,iBAAiB,OAAO,cAAc,uBAAuB,YAAY;AACzE,kBAAI;AACA,8BAAc,mBAAmB,WAAW;AAC5C,wBAAQ;AAAA,kBACJ,8CAA8C,YAAY,MAAM;AAAA,gBACpE;AAAA,cACJ,SAAS,KAAK;AACV,wBAAQ,KAAK,2DAA2D,GAAG;AAAA,cAC/E;AAAA,YACJ;AAAA,UACJ;AAEA,kBAAQ,IAAI,4BAA4B,aAAa,kBAAkB;AACvE,iBAAO,gBAAgB;AAAA,QAC3B;AAKA,iBAAS,iBAAiB,IAAkB;AACxC,cAAI,KAAK,OAAO,KAAK,KAAM;AACvB,oBAAQ,KAAK,0CAA0C,EAAE,wBAAwB;AACjF;AAAA,UACJ;AACA,0BAAgB;AAChB,kBAAQ,IAAI,yCAAyC,EAAE,IAAI;AAAA,QAC/D;AAKA,iBAAS,mBAA2B;AAChC,iBAAO;AAAA,QACX;AAKA,iBAAS,QAAc;AACnB,cAAI,cAAc,MAAM;AACpB,yBAAa,SAAS;AACtB,wBAAY;AAAA,UAChB;AACA,2BAAiB,MAAM;AACvB,uBAAa;AACb,0BAAgB;AAAA,QACpB;AAKA,iBAAS,WAAW;AAChB,gBAAM,UAAU,YAAY;AAC5B,cAAI,CAAC,SAAS;AACV,mBAAO;AAAA,cACH,YAAY;AAAA,cACZ,eAAe;AAAA,cACf,OAAO,CAAC;AAAA,cACR,WAAW;AAAA,cACX,WAAW;AAAA,YACf;AAAA,UACJ;AAEA,gBAAM,gBAAgB,OAAO,OAAO,QAAQ,SAAS,EAAE;AAAA,YACnD,CAAC,KAAK,QAAQ,MAAM,IAAI;AAAA,YACxB;AAAA,UACJ;AACA,gBAAM,QAAQ,OAAO,KAAK,QAAQ,SAAS;AAC3C,gBAAM,YAAY,aAAa,OAAO;AAEtC,iBAAO;AAAA,YACH,YAAY;AAAA,YACZ;AAAA,YACA;AAAA,YACA,WAAW,QAAQ;AAAA,YACnB;AAAA,YACA;AAAA,UACJ;AAAA,QACJ;AAMA,iBAAS,iBAAiB;AACtB,gBAAM,QAAQ,SAAS;AACvB,iBAAO;AAAA,YACH,YAAY,MAAM;AAAA,YAClB,eAAe,MAAM;AAAA,YACrB,OAAO,MAAM;AAAA,YACb,WAAW,MAAM;AAAA,YACjB,WAAW,MAAM;AAAA,YACjB,eAAe,MAAM;AAAA,UACzB;AAAA,QACJ;AAMA,iBAAS,gBAA+B;AAEpC,sBAAY;AAEZ,gBAAM,UAAU,YAAY;AAC5B,cAAI,CAAC,SAAS;AACV,oBAAQ,KAAK,sCAAsC;AACnD,mBAAO;AAAA,UACX;AAEA,cAAI;AAEA,kBAAM,OAAO,KAAK,UAAU,SAAS,MAAM,CAAC;AAC5C,oBAAQ,IAAI,sCAAsC,KAAK,SAAS,MAAM,QAAQ,CAAC,CAAC,KAAK;AACrF,mBAAO;AAAA,UACX,SAAS,KAAK;AACV,oBAAQ,MAAM,6CAA6C,GAAG;AAC9D,mBAAO;AAAA,UACX;AAAA,QACJ;AAOA,iBAAS,cAAc,MAAuB;AAC1C,cAAI,CAAC,QAAQ,OAAO,SAAS,UAAU;AACnC,oBAAQ,MAAM,gEAAgE;AAC9E,mBAAO;AAAA,UACX;AAEA,cAAI;AACJ,cAAI;AACA,sBAAU,KAAK,MAAM,IAAI;AAAA,UAC7B,SAAS,KAAK;AACV,oBAAQ,MAAM,gDAAgD,GAAG;AACjE,mBAAO;AAAA,UACX;AAGA,cAAI,CAAC,WAAW,OAAO,YAAY,UAAU;AACzC,oBAAQ,MAAM,uDAAuD;AACrE,mBAAO;AAAA,UACX;AAEA,cAAI,CAAC,QAAQ,WAAW,OAAO,QAAQ,YAAY,UAAU;AACzD,oBAAQ,MAAM,kDAAkD;AAChE,mBAAO;AAAA,UACX;AAGA,cAAI,QAAQ,YAAY,iBAAiB;AACrC,oBAAQ;AAAA,cACJ,+CAA+C,QAAQ,OAAO,cAAc,eAAe;AAAA,YAC/F;AAEA,oBAAQ,MAAM,8DAA8D;AAC5E,mBAAO;AAAA,UACX;AAEA,cAAI,CAAC,QAAQ,aAAa,OAAO,QAAQ,cAAc,UAAU;AAC7D,oBAAQ,MAAM,oDAAoD;AAClE,mBAAO;AAAA,UACX;AAGA,gBAAM,UAAU,aAAa,OAAO;AACpC,cAAI,CAAC,SAAS;AACV,oBAAQ,MAAM,4DAA4D;AAC1E,mBAAO;AAAA,UACX;AAGA,gBAAM,WAAW,eAAe;AAChC,cAAI,CAAC,UAAU;AACX,oBAAQ,KAAK,+DAA+D;AAC5E,mBAAO;AAAA,UACX;AAEA,kBAAQ,IAAI,4DAA4D;AACxE,iBAAO;AAAA,QACX;AAOA,iBAAS,OAAa;AAClB,kBAAQ,IAAI,+CAA+C;AAG3D,iBAAO,iBAAiB,QAAQ,MAAM;AAClC,oBAAQ,EAAE,WAAW,KAAK,CAAC;AAAA,UAC/B,CAAC;AAUD,mBAAS,iBAAiB,oBAAoB,MAAM;AAChD,gBAAI,SAAS,QAAQ;AACjB,sBAAQ,EAAE,WAAW,KAAK,CAAC;AAAA,YAC/B;AAAA,UACJ,CAAC;AAED,kBAAQ,IAAI,oCAAoC,aAAa,aAAa;AAAA,QAC9E;AAQA,iBAAS,gBAAgB,OAAe,UAAyB;AAE7D,kBAAQ,IAAI,wEAAwE;AAAA,QACxF;AAMA,iBAAS,kBAAkB,OAAqB;AAAA,QAEhD;AAEA,cAAM,iBAAiB;AAAA,UACnB;AAAA,UACA;AAAA,UACA,iBAAiB;AAAA;AAAA,UACjB;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA;AAAA,UACA;AAAA;AAAA,QACJ;AAEA,QAAC,OAAgE,iBAC7D;AAAA,MACR,GAAG;AAAA;AAAA;;;ACjnBH;AAAA;AAAA;AAiBA,OAAC,WAAY;AACT;AAmDA,YAAI,aAAiC;AACrC,YAAI,oBAAmC;AACvC,YAAI,iBAAiC;AACrC,YAAI,qBAAsC;AAE1C,iBAAS,YAAY,UAAoB,UAAgC;AA1E7E;AA2EQ,gBAAM,MAAM,SAAS,cAAc,QAAQ;AAC3C,cAAI,OAAO;AACX,cAAI,YAAY;AAAA,YACZ;AAAA,YACA;AAAA,YACA;AAAA,YACA,WACM,oGACA;AAAA,UACV,EAAE,KAAK,GAAG;AACV,cAAI,QAAQ,aAAa,SAAS;AAClC,cAAI,YAAY;AAEhB,gBAAM,QAAQ,SAAS,cAAc,MAAM;AAC3C,gBAAM,YAAY;AAClB,gBAAM,YAAY,cAAiB,aAAjB,mBAA2B;AAC7C,gBAAM,cAAc,YAAY,SAAS,SAAS,SAAS;AAC3D,cAAI,YAAY,KAAK;AAErB,gBAAM,QAAQ,SAAS,cAAc,MAAM;AAC3C,gBAAM,YAAY;AAClB,gBAAM,cAAc;AACpB,gBAAM,aAAa,cAAc,kBAAe;AAChD,gBAAM,QAAQ;AACd,cAAI,YAAY,KAAK;AAErB,iBAAO;AAAA,QACX;AAEA,iBAAS,WACL,WACA,SACA,SACA,UACA,SACA,OACI;AA/GZ;AAgHQ,oBAAU,YAAY;AAEtB,gBAAM,MAAM,SAAS,cAAc,KAAK;AACxC,cAAI,YAAY;AAGhB,cAAI,iBAAiB,YAAY,CAAC,MAAiB;AAC/C,gBAAI,mBAAmB;AACnB,gBAAE,eAAe;AACjB,kBAAI,EAAE,aAAc,GAAE,aAAa,aAAa;AAAA,YACpD;AAAA,UACJ,CAAC;AACD,cAAI,iBAAiB,QAAQ,CAAC,MAAiB;AAC3C,gBAAI,CAAC,kBAAmB;AACxB,cAAE,eAAe;AACjB,cAAE,gBAAgB;AAElB,gBACI,kBACA,mBAAmB,WACnB,QAAQ,iBACR,eAAe,gBACjB;AACE,oBAAM,OAAO,eAAe,eAAe,iBAAiB;AAC5D,kBAAI,MAAM;AACN,sBAAM,UAAU,QAAQ,cAAc,IAAI;AAC1C,oBAAI,mCAAS,YAAY;AACrB,0BAAQ,kBAAkB,QAAQ,UAAU;AAAA,gBAChD;AAAA,cACJ;AAAA,YACJ;AAAA,UACJ,CAAC;AAED,gBAAM,YAAY,QAAQ,gBAAgB;AAC1C,gBAAM,SAAS,QAAQ,kBAAkB;AACzC,gBAAM,YAAW,sCAAQ,eAAR,YAAsB;AAGvC,kBAAQ;AAAA,YACJ;AAAA,YACA,UAAU,IAAI,OAAK,EAAE,UAAU;AAAA,UACnC;AACA,oBAAU,QAAQ,CAAC,SAAmB;AAClC,kBAAM,MAAM,YAAY,MAAM,KAAK,eAAe,QAAQ;AAE1D,gBAAI,iBAAiB,SAAS,OAAK;AAC/B,oBAAM,SAAS,EAAE;AACjB,kBAAI,OAAO,QAAQ,eAAe,GAAG;AACjC,wBAAQ,KAAK,UAAU;AAAA,cAC3B,OAAO;AACH,yBAAS,KAAK,UAAU;AAAA,cAC5B;AAAA,YACJ,CAAC;AAED,gBAAI,iBAAiB,YAAY,CAAC,MAAkB;AAChD,kBAAI,EAAE,WAAW,GAAG;AAChB,wBAAQ,KAAK,UAAU;AAAA,cAC3B;AAAA,YACJ,CAAC;AAED,gBAAI,iBAAiB,aAAa,CAAC,MAAiB;AAChD,2BAAa;AACb,kCAAoB,KAAK;AACzB,+BAAiB;AACjB,mCAAqB;AACrB,kBAAI,EAAE,cAAc;AAChB,kBAAE,aAAa,gBAAgB;AAC/B,kBAAE,aAAa,QAAQ,cAAc,KAAK,cAAc,EAAE;AAAA,cAC9D;AACA,kBAAI,MAAM,UAAU;AAAA,YACxB,CAAC;AACD,gBAAI,iBAAiB,WAAW,MAAM;AAClC,kBAAI,MAAM,UAAU;AACpB,2BAAa;AACb,kCAAoB;AACpB,+BAAiB;AACjB,mCAAqB;AAErB,oBAAM,UAAU,IAAI,iBAAiB,SAAS;AAC9C,sBAAQ,QAAQ,CAAAC,OAAK;AACjB,gBAACA,GAAkB,UAAU,OAAO,cAAc,mBAAmB;AAAA,cACzE,CAAC;AAAA,YACL,CAAC;AACD,gBAAI,iBAAiB,YAAY,CAAC,MAAiB;AAC/C,gBAAE,eAAe;AACjB,kBAAI,EAAE,cAAc;AAChB,kBAAE,aAAa,aAAa;AAAA,cAChC;AAEA,kBAAI,QAAQ,YAAY;AACpB;AAAA,cACJ;AAEA,oBAAM,UAAU,IAAI,iBAAiB,SAAS;AAC9C,sBAAQ,QAAQ,CAAAA,OAAK;AACjB,gBAACA,GAAkB,UAAU,OAAO,cAAc,mBAAmB;AAAA,cACzE,CAAC;AACD,kBAAI,UAAU,IAAI,cAAc,mBAAmB;AAAA,YACvD,CAAC;AACD,gBAAI,iBAAiB,aAAa,MAAM;AACpC,kBAAI,UAAU,OAAO,cAAc,mBAAmB;AAAA,YAC1D,CAAC;AACD,gBAAI,iBAAiB,QAAQ,CAAC,MAAiB;AAC3C,gBAAE,eAAe;AACjB,gBAAE,gBAAgB;AAElB,kBAAI,UAAU,OAAO,cAAc,mBAAmB;AACtD,kBAAI,CAAC,qBAAqB,sBAAsB,KAAK,YAAY;AAC7D;AAAA,cACJ;AAEA,oBAAM,eAAe,QAAQ,kBAAkB;AAC/C,oBAAM,aAAa,aAAa,QAAQ,iBAAiB;AACzD,oBAAM,YAAY,aAAa,QAAQ,KAAK,UAAU;AACtD,kBAAI,eAAe,MAAM,cAAc,IAAI;AACvC;AAAA,cACJ;AAEA,oBAAM,WAAW,CAAC,GAAG,YAAY;AACjC,uBAAS,OAAO,YAAY,CAAC;AAC7B,oBAAM,eAAe,SAAS,QAAQ,KAAK,UAAU;AACrD,uBAAS,OAAO,cAAc,GAAG,iBAAiB;AAElD,kBAAI,QAAQ,kBAAkB;AAC1B,wBAAQ,iBAAiB,QAAQ;AAEjC,2BAAW,WAAW,SAAS,SAAS,UAAU,SAAS,KAAK;AAAA,cACpE;AAAA,YACJ,CAAC;AACD,gBAAI,YAAY,GAAG;AAAA,UACvB,CAAC;AAED,cAAI,QAAQ,cAAc,OAAO;AAC7B,kBAAM,SAAS,SAAS,cAAc,QAAQ;AAC9C,mBAAO,OAAO;AACd,mBAAO,YACH;AACJ,mBAAO,cAAc;AACrB,mBAAO,QAAQ;AACf,mBAAO,iBAAiB,SAAS,MAAM;AA3PnD,kBAAAC;AA4PgB,kBAAI,OAAO;AACP,sBAAM;AAAA,cACV,OAAO;AACH,sBAAM,SAAQA,MAAA,QAAQ,0BAAR,gBAAAA,IAAA;AACd,wBAAQ,eAAe,EAAE,MAAM,CAAC;AAAA,cACpC;AAAA,YAEJ,CAAC;AACD,gBAAI,YAAY,MAAM;AAAA,UAC1B;AAEA,oBAAU,YAAY,GAAG;AAGzB,gBAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,oBAAU,YAAY;AACtB,oBAAU,YAAY,SAAS;AAAA,QACnC;AAEA,iBAAS,YAAY,SAAkB,UAA+B;AAClE,gBAAM,aAAa,QAAQ,eAAe,KAAK,OAAO;AACtD,gBAAM,cAAc,QAAQ,gBAAgB,KAAK,OAAO;AACxD,gBAAM,gBAAgB,QAAQ,kBAAkB,KAAK,OAAO;AAG5D,UAAC,QAA2B,iBAAiB,CAAC,QAAkC;AAC5E,kBAAM,OAAO,WAAW,GAAG;AAC3B,qBAAS;AACT,mBAAO;AAAA,UACX;AACA,UAAC,QAA2B,kBAAkB,CAAC,OAAe;AAC1D,wBAAY,EAAE;AACd,qBAAS;AAAA,UACb;AACA,UAAC,QAA2B,oBAAoB,CAAC,OAAe;AAC5D,0BAAc,EAAE;AAChB,qBAAS;AAAA,UACb;AACA,iBAAO;AAAA,QACX;AAEA,iBAAS,iBACL,SACA,SACA,UAA6B,CAAC,GACV;AACpB,gBAAM,UAAU,YAAY,SAAS,MAAM,WAAW,QAAQ,CAAC;AAE/D,gBAAM,aAAmC;AAAA,YACrC,IAAI;AAAA,YACJ,UAAU;AACN;AAAA,gBACI;AAAA,gBACA;AAAA,gBACA;AAAA,gBACA,QAAM,QAAQ,kBAAkB,EAAE;AAAA,gBAClC,QAAM,QAAQ,gBAAgB,EAAE;AAAA,cACpC;AAAA,YACJ;AAAA,YACA,UAAU;AACN,sBAAQ,YAAY;AAAA,YACxB;AAAA,YACA,SAAS,YAAoB,OAAe;AACxC,oBAAM,OAAO,QAAQ,YAAY,UAAU;AAC3C,kBAAI,MAAM;AACN,qBAAK,WAAW,EAAE,GAAI,KAAK,YAAY,CAAC,GAAI,UAAU,MAAM;AAC5D,qBAAK,QAAQ;AAAA,cACjB;AAAA,YACJ;AAAA,UACJ;AAEA,qBAAW,QAAQ;AACnB,iBAAO;AAAA,QACX;AAGA,iBAAS,iBAAiB,YAAY,CAAC,MAAiB;AACpD,cAAI,mBAAmB;AACnB,cAAE,eAAe;AAAA,UACrB;AAAA,QACJ,CAAC;AACD,iBAAS,iBAAiB,QAAQ,CAAC,MAAiB;AA7UxD;AA8UQ,cAAI,CAAC,qBAAqB,CAAC,eAAgB;AAC3C,gBAAM,MAAM,EAAE;AACd,cAAI,IAAI,QAAQ,cAAc,EAAG;AACjC,YAAE,eAAe;AACjB,YAAE,gBAAgB;AAClB,cAAI,CAAC,eAAe,eAAgB;AACpC,gBAAM,OAAO,eAAe,eAAe,iBAAiB;AAC5D,cAAI,CAAC,KAAM;AACX,gBAAM,MAAO,KAAa,SAAS;AACnC,gBAAM,QAAS,OAAO,IAAI,QAAS;AACnC,gBAAM,IAAI;AACV,cAAI,aAAkB;AACtB,cAAI,MAAM,SAAS,UAAU,EAAG,cAAa,EAAE;AAAA,mBACtC,MAAM,SAAS,aAAa,EAAG,cAAa,EAAE;AAAA,mBAC9C,MAAM,SAAS,QAAQ,EAAG,cAAa,EAAE;AAElD,cAAI,CAAC,WAAY;AACjB,gBAAM,SAAS,IAAI,WAAW,EAAE,UAAQ,gCAAK,iBAAL,mBAAmB,SAAQ,IAAI,SAAS,EAAE,CAAC;AACnF,cAAI,OAAO,OAAO,SAAS,WAAY,QAAO,KAAK;AACnD,cAAI,EAAE,eAAgB,GAAE,eAAe,eAAe,MAAM;AAC5D,cAAI,OAAO,OAAO,WAAW,YAAY;AACrC,mBAAO,OAAO,GAAG;AACjB,yBAAO,iBAAP,gCAAsB,IAAI;AAAA,UAC9B;AAAA,QACJ,CAAC;AAED,cAAM,aAAa;AAAA;AAAA;AAAA;AAAA,UAIf,OACI,SACA,SACA,SACoB;AACpB,mBAAO,iBAAiB,SAAS,SAAS,OAAO;AAAA,UACrD;AAAA,QACJ;AAEA,QAAC,OAA+C,aAAa;AAAA,MACjE,GAAG;AAAA;AAAA;;;ACtXH;AAAA;AAAA;AAAA,cAAQ,IAAI,8BAA8B;AAM1C,OAAC,MAAM;AACH;AAPJ;AA2BI,cAAM,OAAQ,OAAuD;AAAA,QAErE,MAAM,yBAAyB,KAAK;AAAA,UAQhC,YAAY,QAAiC;AACzC,kBAAM;AAAA,cACF,GAAG;AAAA,cACH,MAAM;AAAA,YACV,CAAC;AAXL,iCAAoC;AACpC,gCAAwC;AACxC,kCAA2B,CAAC;AAC5B,gCAAe;AACf,+BAAc;AASV,iBAAK,aAAa;AAAA,cACd,KAAK;AAAA,gBACD,MAAM;AAAA,gBACN,UAAU;AAAA,kBACN,SAAS,EAAE,MAAM,aAAa,UAAU,CAAC,EAAE;AAAA,kBAC3C,WAAW;AAAA,oBACP,MAAM;AAAA,oBACN,UAAU;AAAA,sBACN,cAAc;AAAA,wBACV,MAAM;AAAA,wBACN,SAAS;AAAA,sBACb;AAAA,oBACJ;AAAA,kBACJ;AAAA,kBACA,WAAW,EAAE,MAAM,aAAa,UAAU,CAAC,EAAE;AAAA,kBAC7C,eAAe;AAAA,oBACX,MAAM;AAAA,oBACN,SACI;AAAA,kBACR;AAAA,gBACJ;AAAA,cACJ;AAAA,YACJ;AAAA,UACJ;AAAA;AAAA,UAIU,SAAe;AACrB,gBAAI,CAAC,KAAK,UAAW;AAErB,kBAAM,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,mFAK0D,KAAK,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAavF,iBAAK,UAAU,YAAY;AAC3B,iBAAK,gBAAgB,KAAK,UAAU,cAAc,wBAAwB;AAC1E,iBAAK,eAAe,KAAK,UAAU,cAAc,uBAAuB;AAExE,gBAAI;AACA,mBAAK,mBAAmB;AAAA,YAC5B,QAAQ;AAAA,YAER;AACA,gBAAI,KAAK,gBAAgB,OAAO,KAAK,aAAa,UAAU,YAAY;AACpE,mBAAK,aAAa,MAAM;AAAA,YAC5B;AAAA,UACJ;AAAA,UAEU,uBAA6B;AACnC,gBAAI,CAAC,KAAK,aAAc;AAExB,iBAAK,aAAa,iBAAiB,WAAW,CAAC,MAAqB;AAChE,kBAAI,EAAE,QAAQ,SAAS;AACnB,kBAAE,eAAe;AACjB,sBAAM,UAAU,KAAK,aAAc,MAAM,KAAK;AAC9C,oBAAI,SAAS;AACT,uBAAK,eAAe,OAAO;AAC3B,uBAAK,eAAe,KAAK,OAAO;AAChC,uBAAK,eAAe,KAAK,eAAe;AACxC,uBAAK,YAAY,EAAE,gBAAgB,KAAK,eAAe,CAAC;AAAA,gBAC5D;AACA,qBAAK,aAAc,QAAQ;AAC3B,qBAAK,aAAc,MAAM;AAAA,cAC7B,WAAW,EAAE,QAAQ,OAAO;AACxB,kBAAE,eAAe;AACjB,qBAAK,oBAAoB;AAAA,cAC7B,WAAW,EAAE,QAAQ,WAAW;AAC5B,kBAAE,eAAe;AACjB,oBAAI,KAAK,eAAe,GAAG;AACvB,uBAAK;AAEL,wBAAM,eAAe,KAAK,eAAe,KAAK,YAAY;AAC1D,sBAAI,iBAAiB,QAAW;AAC5B,yBAAK,aAAc,QAAQ;AAAA,kBAC/B;AAAA,gBACJ;AAAA,cACJ,WAAW,EAAE,QAAQ,aAAa;AAC9B,kBAAE,eAAe;AACjB,oBAAI,KAAK,eAAe,KAAK,eAAe,SAAS,GAAG;AACpD,uBAAK;AAEL,wBAAM,eAAe,KAAK,eAAe,KAAK,YAAY;AAC1D,sBAAI,iBAAiB,QAAW;AAC5B,yBAAK,aAAc,QAAQ;AAAA,kBAC/B;AAAA,gBACJ,OAAO;AACH,uBAAK,eAAe,KAAK,eAAe;AACxC,uBAAK,aAAc,QAAQ;AAAA,gBAC/B;AAAA,cACJ;AAAA,YACJ,CAAC;AAAA,UACL;AAAA,UAEA,qBAA2B;AACvB,iBAAK;AAAA,cACD;AAAA,cACA;AAAA,YACJ;AAAA,UACJ;AAAA,UAEA,sBAA4B;AACxB,gBAAI,CAAC,KAAK,aAAc;AAExB,kBAAM,QAAQ,KAAK,aAAa;AAChC,kBAAM,CAAC,YAAY,GAAG,IAAI,IAAI,MAAM,MAAM,GAAG;AAG7C,gBAAI,eAAe,OAAW;AAE9B,kBAAM,oBAAoB;AAAA,cACtB;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,YACJ;AAEA,gBAAI,KAAK,WAAW,GAAG;AACnB,oBAAM,UAAU,kBAAkB,OAAO,SAAO,IAAI,WAAW,UAAU,CAAC;AAE1E,kBAAI,QAAQ,WAAW,GAAG;AACtB,sBAAM,QAAQ,QAAQ,CAAC;AACvB,oBAAI,UAAU,QAAW;AACrB,uBAAK,aAAa,QAAQ,QAAQ;AAAA,gBACtC;AAAA,cACJ,WAAW,QAAQ,SAAS,GAAG;AAC3B,qBAAK,UAAU,gBAAgB,KAAK,WAAW,KAAK,KAAK,IAAI,SAAS;AACtE,qBAAK,UAAU,QAAQ,KAAK,IAAI,GAAG,MAAM;AACzC,sBAAM,eAAe,KAAK,iBAAiB,OAAO;AAClD,oBAAI,aAAa,SAAS,WAAW,QAAQ;AACzC,uBAAK,aAAa,QAAQ;AAAA,gBAC9B;AAAA,cACJ;AAAA,YACJ,OAAO;AACH,kBAAI,eAAe,QAAQ,eAAe,OAAO;AAC7C,qBAAK,qBAAqB,YAAY,KAAK,CAAC,KAAK,EAAE;AAAA,cACvD;AAAA,YACJ;AAAA,UACJ;AAAA,UAEA,iBAAiB,SAA2B;AACxC,gBAAI,CAAC,QAAQ,OAAQ,QAAO;AAE5B,kBAAM,cAAc,QAAQ,CAAC;AAC7B,gBAAI,QAAQ,WAAW,EAAG,QAAO,oCAAe;AAChD,gBAAI,gBAAgB,OAAW,QAAO;AAEtC,gBAAI,SAAiB;AACrB,qBAAS,IAAI,GAAG,IAAI,QAAQ,QAAQ,KAAK;AACrC,oBAAM,gBAAgB,QAAQ,CAAC;AAC/B,kBAAI,kBAAkB,OAAW;AAEjC,qBAAO,cAAc,QAAQ,MAAM,MAAM,GAAG;AACxC,yBAAS,OAAO,UAAU,GAAG,OAAO,SAAS,CAAC;AAC9C,oBAAI,CAAC,OAAQ,QAAO;AAAA,cACxB;AAAA,YACJ;AACA,mBAAO;AAAA,UACX;AAAA,UAEA,qBAAqB,KAAmB,SAAuB;AAC3D,kBAAM,aAAa,KAAK,YAAY,KAAK,WAAW;AACpD,gBAAI,CAAC,cAAc,WAAW,SAAS,YAAa;AAEpD,kBAAM,QAAQ,OAAO,KAAK,WAAW,QAAQ;AAC7C,gBAAI;AACJ,gBAAI,QAAQ,MAAM;AAEd,wBAAU,MAAM;AAAA,gBACZ,UACK,WAAW,SAAS,IAAI,EAAa,SAAS,eAC/C,KAAK,WAAW,OAAO;AAAA,cAC/B;AAAA,YACJ,OAAO;AAEH,wBAAU,MAAM;AAAA,gBACZ,UACK,WAAW,SAAS,IAAI,EAAa,SAAS,UAC/C,KAAK,WAAW,OAAO;AAAA,cAC/B;AAAA,YACJ;AAEA,gBAAI,QAAQ,WAAW,GAAG;AACtB,oBAAM,QAAQ,QAAQ,CAAC;AACvB,kBAAI,UAAU,QAAW;AACrB,qBAAK,aAAc,QAAQ,GAAG,GAAG,IAAI,KAAK;AAAA,cAC9C;AAAA,YACJ,WAAW,QAAQ,SAAS,GAAG;AAC3B,mBAAK;AAAA,gBACD,gBAAgB,KAAK,WAAW,KAAK,KAAK,aAAc,KAAK;AAAA,gBAC7D;AAAA,cACJ;AACA,oBAAM,YAAY,QAAQ,IAAI,UAAQ;AAElC,sBAAM,UAAU,WAAW,SAAS,IAAI;AACxC,oBAAI,CAAC,QAAS,QAAO;AACrB,sBAAM,SAAS,QAAQ,SAAS,cAAc,eAAQ;AACtD,uBAAO,SAAS;AAAA,cACpB,CAAC;AACD,mBAAK,UAAU,UAAU,KAAK,IAAI,GAAG,MAAM;AAC3C,oBAAM,eAAe,KAAK,iBAAiB,OAAO;AAClD,kBAAI,aAAa,SAAS,QAAQ,QAAQ;AACtC,qBAAK,aAAc,QAAQ,GAAG,GAAG,IAAI,YAAY;AAAA,cACrD;AAAA,YACJ;AAAA,UACJ;AAAA,UAEA,eAAe,SAAuB;AAClC,iBAAK,UAAU,gBAAgB,KAAK,WAAW,KAAK,OAAO,IAAI,SAAS;AACxE,kBAAM,CAAC,KAAK,GAAG,IAAI,IAAI,QAAQ,MAAM,GAAG;AAGxC,gBAAI,QAAQ,OAAW;AAEvB,kBAAM,WAAuC;AAAA,cACzC,MAAM,MAAM,KAAK,SAAS;AAAA,cAC1B,OAAO,MAAM,KAAK,YAAY;AAAA,cAC9B,IAAI,MAAM,KAAK,cAAc,KAAK,CAAC,CAAC;AAAA,cACpC,KAAK,MAAM,KAAK,sBAAsB;AAAA,cACtC,IAAI,MAAM,KAAK,gBAAgB,KAAK,CAAC,CAAC;AAAA,cACtC,KAAK,MAAM,KAAK,QAAQ,KAAK,CAAC,CAAC;AAAA,cAC/B,MAAM,MAAM,KAAK,KAAK,KAAK,KAAK,GAAG,CAAC;AAAA,cACpC,MAAM,MAAM,KAAK,SAAS;AAAA,cAC1B,QAAQ,MAAM,KAAK,UAAU,SAAS,QAAQ;AAAA,YAClD;AAEA,kBAAM,YAAY,SAAS,GAAG;AAC9B,gBAAI,cAAc,QAAW;AACzB,wBAAU;AAAA,YACd,OAAO;AACH,mBAAK;AAAA,gBACD,0BAA0B,GAAG;AAAA,gBAC7B;AAAA,cACJ;AAAA,YACJ;AAAA,UACJ;AAAA,UAEA,UAAU,MAAc,OAAgD,UAAgB;AACpF,gBAAI,CAAC,KAAK,cAAe;AACzB,kBAAM,OAAO,SAAS,cAAc,KAAK;AACzC,iBAAK,YAAY,0BAA0B,IAAI;AAC/C,kBAAM,WAAmC;AAAA,cACrC,SAAS;AAAA,cACT,QAAQ;AAAA,cACR,OAAO;AAAA,cACP,MAAM;AAAA,YACV;AACA,iBAAK,aAAa,IAAI,SAAS,IAAI,KAAK,gBAAgB;AACxD,iBAAK,cAAc;AACnB,iBAAK,cAAc,YAAY,IAAI;AACnC,iBAAK,cAAc,YAAY,KAAK,cAAc;AAAA,UACtD;AAAA,UAEA,cAAoB;AAChB,gBAAI,KAAK,cAAe,MAAK,cAAc,YAAY;AAAA,UAC3D;AAAA,UAEA,WAAiB;AACb,kBAAM,WAAW;AAAA,cACb;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,YACJ;AACA,qBAAS,QAAQ,OAAK,KAAK,UAAU,GAAG,MAAM,CAAC;AAAA,UACnD;AAAA,UAEA,cAAc,MAAqB;AAC/B,kBAAM,aAAa,OAAO,KAAK,cAAc,IAAI,IAAI,KAAK;AAC1D,kBAAM,YAAY,KAAK,YAAY,UAAU;AAC7C,gBAAI,CAAC,WAAW;AACZ,mBAAK,UAAU,+BAA+B,QAAQ,UAAU,IAAI,OAAO;AAC3E;AAAA,YACJ;AACA,gBAAI,UAAU,SAAS,aAAa;AAChC,mBAAK,UAAU,GAAG,QAAQ,UAAU,yBAAyB,OAAO;AACpE;AAAA,YACJ;AACA,kBAAM,QAAQ,OAAO,KAAK,UAAU,QAAQ;AAC5C,gBAAI,MAAM,WAAW,EAAG,MAAK,UAAU,UAAU,QAAQ;AAAA,iBACpD;AACD,oBAAM,QAAQ,UAAQ;AAElB,sBAAM,UAAU,UAAU,SAAS,IAAI;AACvC,oBAAI,CAAC,QAAS;AACd,sBAAM,SAAS,QAAQ,SAAS,cAAc,eAAQ;AACtD,qBAAK,UAAU,SAAS,MAAM,QAAQ;AAAA,cAC1C,CAAC;AAAA,YACL;AAAA,UACJ;AAAA,UAEA,wBAA8B;AAC1B,iBAAK,UAAU,KAAK,aAAa,QAAQ;AAAA,UAC7C;AAAA,UAEA,gBAAgB,MAAqB;AACjC,gBAAI,CAAC,MAAM;AACP,mBAAK,cAAc;AACnB,mBAAK,aAAa;AAClB;AAAA,YACJ;AACA,kBAAM,UAAU,KAAK,cAAc,IAAI;AACvC,kBAAM,WAAW,KAAK,YAAY,OAAO;AACzC,gBAAI,CAAC,UAAU;AACX,mBAAK,UAAU,+BAA+B,IAAI,IAAI,OAAO;AAC7D;AAAA,YACJ;AACA,gBAAI,SAAS,SAAS,aAAa;AAC/B,mBAAK,UAAU,GAAG,IAAI,yBAAyB,OAAO;AACtD;AAAA,YACJ;AACA,iBAAK,cAAc;AACnB,iBAAK,aAAa;AAClB,iBAAK,YAAY,EAAE,aAAa,KAAK,YAAY,CAAC;AAAA,UACtD;AAAA,UAEA,QAAQ,UAAyB;AA3YzC,gBAAAC,KAAAC;AA4YY,gBAAI,CAAC,UAAU;AACX,mBAAK,UAAU,mBAAmB,OAAO;AACzC;AAAA,YACJ;AACA,gBAAI,SAAS,SAAS,GAAG,GAAG;AACxB,oBAAM,iBAAiB,KAAK,cAAc,QAAQ;AAClD,oBAAM,YAAY,eAAe,MAAM,GAAG,EAAE,OAAO,OAAK,MAAM,EAAE;AAChE,oBAAM,WAAW,UAAU,IAAI;AAC/B,oBAAM,UAAU,UAAU,SAAS,IAAI,UAAU,KAAK,GAAG,IAAI;AAC7D,oBAAM,MAAM,KAAK,YAAY,OAAO;AACpC,kBAAI,CAAC,KAAK;AACN,qBAAK,UAAU,+BAA+B,OAAO,IAAI,OAAO;AAChE;AAAA,cACJ;AACA,oBAAM,QAAQD,MAAA,IAAiB,aAAjB,gBAAAA,IAA4B;AAC1C,kBAAI,CAAC,KAAM,MAAK,UAAU,yBAAyB,QAAQ,IAAI,OAAO;AAAA,uBAC7D,KAAK,SAAS;AACnB,qBAAK,UAAU,GAAG,QAAQ,oBAAoB,OAAO;AAAA,kBACpD,MAAK,UAAU,KAAK,SAAS,QAAQ;AAAA,YAC9C,OAAO;AACH,oBAAM,aAAa,KAAK,YAAY,KAAK,WAAW;AACpD,oBAAM,QAAOC,MAAA,yCAAY,aAAZ,gBAAAA,IAAuB;AACpC,kBAAI,CAAC,KAAM,MAAK,UAAU,yBAAyB,QAAQ,IAAI,OAAO;AAAA,uBAC7D,KAAK,SAAS;AACnB,qBAAK,UAAU,GAAG,QAAQ,oBAAoB,OAAO;AAAA,kBACpD,MAAK,UAAU,KAAK,SAAS,QAAQ;AAAA,YAC9C;AAAA,UACJ;AAAA,UAEA,KAAK,MAAoB;AACrB,iBAAK,UAAU,MAAM,QAAQ;AAAA,UACjC;AAAA,UAEA,WAAiB;AACb,iBAAK,WAAU,oBAAI,KAAK,GAAE,SAAS,GAAG,QAAQ;AAAA,UAClD;AAAA,UAEA,eAAqB;AAjb7B,gBAAAD;AAkbY,kBAAM,UAASA,MAAA,KAAK,cAAL,gBAAAA,IAAgB,cAAc;AAC7C,gBAAI,QAAQ;AACR,qBAAO,cAAc,gBAAgB,KAAK,WAAW;AAAA,YACzD;AAAA,UACJ;AAAA,UAEA,YAAY,MAAgD;AACxD,gBAAI,CAAC,KAAM,QAAO;AAClB,kBAAM,iBAAiB,KAAK,cAAc,IAAI;AAG9C,kBAAM,WAAW,KAAK,WAAW,GAAG;AACpC,gBAAI,mBAAmB,IAAK,QAAO,8BAAY;AAC/C,gBAAI,aAAa,OAAW,QAAO;AAEnC,gBAAI,UAAkB;AACtB,kBAAM,QAAQ,eACT,QAAQ,SAAS,EAAE,EACnB,MAAM,GAAG,EACT,OAAO,OAAK,CAAC;AAClB,uBAAW,QAAQ,OAAO;AACtB,kBAAK,QAAqB,SAAS,YAAa,QAAO;AACvD,kBAAI,CAAE,QAAqB,YAAY,CAAE,QAAqB,SAAS,IAAI;AACvE,uBAAO;AAEX,oBAAM,WAAY,QAAqB,SAAS,IAAI;AACpD,kBAAI,aAAa,OAAW,QAAO;AACnC,wBAAU;AAAA,YACd;AACA,mBAAO;AAAA,UACX;AAAA,UAEA,cAAc,MAAsB;AAChC,gBAAI,CAAC,QAAQ,SAAS,IAAK,QAAO;AAClC,gBAAI,SAAS,IAAK,QAAO,KAAK;AAC9B,gBAAI,SAAS,KAAM,QAAO,KAAK;AAC/B,gBAAI;AACJ,gBAAI,KAAK,WAAW,GAAG,EAAG,eAAc;AAAA,qBAC/B,KAAK,WAAW,GAAG,EAAG,eAAc,MAAM;AAAA;AAE/C,4BACI,KAAK,gBAAgB,MAAM,KAAK,IAAI,KAAK,GAAG,KAAK,WAAW,IAAI,IAAI;AAC5E,kBAAM,QAAQ,YAAY,MAAM,GAAG,EAAE,OAAO,OAAK,MAAM,MAAM,MAAM,GAAG;AACtE,kBAAM,WAAqB,CAAC;AAC5B,uBAAW,QAAQ,OAAO;AACtB,kBAAI,SAAS,MAAM;AACf,oBAAI,SAAS,SAAS,KAAK,SAAS,SAAS,SAAS,CAAC,MAAM,KAAK;AAC9D,2BAAS,IAAI;AAAA,gBACjB;AAAA,cACJ,OAAO;AACH,yBAAS,KAAK,IAAI;AAAA,cACtB;AAAA,YACJ;AACA,gBAAI,SAAS,WAAW,KAAM,SAAS,WAAW,KAAK,SAAS,CAAC,MAAM,IAAM,QAAO;AACpF,gBAAI,SAAS,CAAC,MAAM,IAAK,UAAS,QAAQ,GAAG;AAC7C,mBAAO,SAAS,KAAK,GAAG;AAAA,UAC5B;AAAA,UAEA,WAAW,MAAsB;AAC7B,kBAAM,QAAQ,KAAK,MAAM,GAAG,EAAE,OAAO,OAAO;AAC5C,kBAAM,IAAI;AACV,mBAAO,MAAM,SAAS,IAAI,MAAM,MAAM,KAAK,GAAG,IAAI;AAAA,UACtD;AAAA,UAEA,YAAqC;AACjC,kBAAM,gBACF,KAAK,UAGP;AACF,kBAAM,UAAU,cAAc,KAAK,IAAI;AACvC,mBAAO;AAAA,cACH,GAAG;AAAA,cACH,aAAa,KAAK;AAAA,cAClB,gBAAgB,KAAK;AAAA,cACrB,YAAY,KAAK;AAAA,YACrB;AAAA,UACJ;AAAA,UAEA,YAAY,MAAqC;AAC7C,kBAAM,kBACF,KAAK,UAGP;AACF,4BAAgB,KAAK,MAAM,IAAI;AAC/B,kBAAM,IAAI;AAKV,gBAAI,EAAE,aAAa;AACf,mBAAK,cAAc,EAAE;AACrB,mBAAK,aAAa;AAAA,YACtB;AACA,gBAAI,EAAE,gBAAgB;AAClB,mBAAK,iBAAiB,EAAE;AACxB,mBAAK,eAAe,KAAK,eAAe;AAAA,YAC5C;AACA,gBAAI,EAAE,YAAY;AACd,mBAAK,aAAa,EAAE;AAAA,YACxB;AAAA,UACJ;AAAA,UAEA,QAAc;AACV,kBAAM,YAAa,KAAK,UAA+C;AACvE,sBAAU,KAAK,IAAI;AACnB,gBAAI,KAAK,aAAc,MAAK,aAAa,MAAM;AAAA,UACnD;AAAA,QACJ;AAEA,QAAC,OAAoE,mBACjE;AAGJ,cAAM,IAAI;AAKV,cAAM,kBAAkB,EAAE,iBAAiB;AAC3C,YAAI,iBAAiB;AACjB,UAAC,EAAE,yBAAyB,IAAgB,IAAK,gBAAwC;AAAA,YACrF,MAAM;AAAA,YACN,eAAe;AAAA,YACf,cAAc;AAAA,YACd,iBAAiB,SAAU,YAAwC;AAC/D,oBAAM,yBAAyB,SAAS,eAAe,oBAAoB;AAC3E,kBAAI,CAAC,wBAAwB;AACzB,wBAAQ,MAAM,8BAA8B;AAC5C,uBAAO;AAAA,cACX;AACA,oBAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,wBAAU,KAAK,GAAG,UAAU;AAC5B,wBAAU,YAAY;AAEtB,oBAAM,WACF,OACF;AACF,kBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,yBAAS,KAAK,SAAS;AAAA,cAC3B,OAAO;AACH,0BAAU,UAAU,IAAI,QAAQ;AAAA,cACpC;AACA,qCAAuB,YAAY,SAAS;AAC5C,qBAAO;AAAA,YACX;AAAA,UACJ,CAAC;AAED,cAAI;AACA,oBAAQ,MAAM,mCAAmC;AAAA,cAC7C,OAAO,OAAE,yBAAyB,MAA3B,mBAAoD;AAAA,cAC3D,gBACI,aAAE,yBAAyB,MAA3B,mBACD,qBADC;AAAA,YAER,CAAC;AAAA,UACL,SAAS,OAAO;AACZ,oBAAQ,MAAM,sDAAsD,KAAK;AAAA,UAC7E;AAAA,QACJ;AAAA,MACJ,GAAG;AAAA;AAAA;;;ACllBH;AAAA;AAAA;AAAA;AAiGA,UAAM,mBAA6C;AAAA,QAC/C,WAAW;AAAA,QACX,QAAQ;AAAA,QACR,WAAW;AAAA,QACX,YAAY;AAAA,QACZ,WAAW;AAAA,QACX,UAAU;AAAA,QACV,mBAAmB;AAAA,QACnB,aAAa;AAAA,QACb,kBAAkB;AAAA,QAClB,gBAAgB;AAAA,QAChB,kBAAkB;AAAA,QAClB,WAAW;AAAA,QACX,cAAc;AAAA,QACd,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA,QAMhB,KAAK,eAA2C;AAC5C,gBAAM,YACF,OAAO,kBAAkB,WACnB,SAAS,eAAe,aAAa,IACrC;AAEV,cAAI,CAAC,WAAW;AACZ,oBAAQ,MAAM,oCAAoC,aAAa;AAC/D;AAAA,UACJ;AAEA,eAAK,YAAY;AACjB,eAAK,OAAO;AACZ,eAAK,cAAc;AACnB,eAAK,mBAAmB;AACxB,eAAK,gBAAgB;AACrB,eAAK,iBAAiB;AACtB,eAAK,oBAAoB;AAGzB,cAAI,OAAO,WAAW;AAClB,iBAAK,gBAAgB;AAAA,UACzB;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,SAAe;AACX,cAAI,CAAC,KAAK,UAAW;AAErB,eAAK,UAAU,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoD3B,eAAK,mBAAmB;AAGxB,cAAI,OAAO,WAAW,OAAO,OAAO,QAAQ,sBAAsB,YAAY;AAC1E,mBAAO,QAAQ,kBAAkB;AAAA,UACrC;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,qBAA2B;AACvB,cAAI,CAAC,KAAK,UAAW;AAErB,gBAAM,SAAS,SAAS,gBAAgB,UAAU,SAAS,MAAM;AAEjE,eAAK,UAAU,MAAM,YAAY,oBAAoB,SAAS,YAAY,SAAS;AACnF,eAAK,UAAU,MAAM,YAAY,iBAAiB,SAAS,YAAY,SAAS;AAChF,eAAK,UAAU,MAAM,YAAY,uBAAuB,SAAS,YAAY,SAAS;AACtF,eAAK,UAAU,MAAM,YAAY,2BAA2B,SAAS,YAAY,SAAS;AAC1F,eAAK,UAAU,MAAM;AAAA,YACjB;AAAA,YACA,SAAS,YAAY;AAAA,UACzB;AACA,eAAK,UAAU,MAAM;AAAA,YACjB;AAAA,YACA,SAAS,YAAY;AAAA,UACzB;AACA,eAAK,UAAU,MAAM;AAAA,YACjB;AAAA,YACA,SAAS,YAAY;AAAA,UACzB;AACA,eAAK,UAAU,MAAM,YAAY,uBAAuB,SAAS,YAAY,SAAS;AAGtF,gBAAM,UAAU,KAAK,UAAU,iBAA8B,kBAAkB;AAC/E,kBAAQ,QAAQ,SAAO;AACnB,gBAAI,MAAM,SAAS;AACnB,gBAAI,MAAM,UAAU;AACpB,gBAAI,MAAM,WAAW;AACrB,gBAAI,MAAM,SAAS,aAAa,SAAS,YAAY,SAAS;AAC9D,gBAAI,MAAM,aAAa,SAAS,YAAY;AAC5C,gBAAI,MAAM,SAAS;AACnB,gBAAI,MAAM,QAAQ;AAClB,gBAAI,MAAM,eAAe;AAAA,UAC7B,CAAC;AAAA,QACL;AAAA;AAAA;AAAA;AAAA,QAKA,gBAAsB;AAClB,cAAI,CAAC,KAAK,UAAW;AAErB,eAAK,SAAS,KAAK,UAAU,cAAmC,uBAAuB;AACvF,eAAK,YAAY,KAAK,UAAU,cAA2B,mBAAmB;AAC9E,eAAK,aAAa,KAAK,UAAU,cAAiC,mBAAmB;AACrF,eAAK,YAAY,KAAK,UAAU,cAAgC,kBAAkB;AAClF,eAAK,mBAAmB,KAAK,UAAU,cAA2B,qBAAqB;AACvF,eAAK,iBAAiB,KAAK,UAAU,cAA2B,mBAAmB;AACnF,eAAK,mBAAmB,KAAK,UAAU,cAA2B,qBAAqB;AACvF,eAAK,YAAY,KAAK,UAAU,cAAgC,aAAa;AAC7E,eAAK,eAAe,KAAK,UAAU,cAAgC,gBAAgB;AAAA,QACvF;AAAA;AAAA;AAAA;AAAA,QAKA,qBAA2B;AACvB,gBAAM,iBAAiB,UAAU,oBAAoB;AACrD,eAAK,WAAW,mBAAmB,SAAS,SAAS;AACrD,eAAK,cAAc,KAAK,QAAQ;AAAA,QACpC;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,cAAc,MAAqB;AAC/B,cAAI,CAAC,KAAK,OAAQ;AAClB,gBAAM,YAAY,sBAAQ,KAAK;AAC/B,gBAAM,aAAa,cAAc,SAAS,SAAS;AACnD,eAAK,WAAW;AAChB,eAAK,OAAO,OAAO;AACnB,eAAK,OAAO,MAAM,aAAa,eAAe,SAAS,aAAa;AAEpE,cAAI;AACA,sBAAU,sBAAsB,UAAU;AAAA,UAC9C,SAAS,KAAK;AACV,oBAAQ,KAAK,wCAAwC,GAAG;AAAA,UAC5D;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,iBAAuB;AACnB,gBAAM,OAAO,KAAK,aAAa,SAAS,QAAQ;AAChD,eAAK,cAAc,IAAI;AACvB,eAAK;AAAA,YACD,SAAS,SAAS,4BAA4B;AAAA,UAClD;AACA,eAAK,YAAY;AAAA,QACrB;AAAA;AAAA;AAAA;AAAA,QAKA,kBAAwB;AACpB,cAAI,CAAC,KAAK,UAAU,CAAC,KAAK,UAAW;AAGrC,eAAK,OAAO,iBAAiB,SAAS,MAAM;AACxC,iBAAK,kBAAkB;AACvB,iBAAK,gBAAgB;AAAA,UACzB,CAAC;AAGD,eAAK,OAAO,iBAAiB,SAAS,MAAM;AACxC,iBAAK,qBAAqB;AAAA,UAC9B,CAAC;AAED,eAAK,OAAO,iBAAiB,SAAS,MAAM;AACxC,iBAAK,qBAAqB;AAAA,UAC9B,CAAC;AAGD,eAAK,UAAU,iBAAiB,UAAU,WAAS;AAC/C,iBAAK,iBAAiB,KAAK;AAAA,UAC/B,CAAC;AAGD,gBAAM,gBAAgB,IAAI,iBAAiB,MAAM;AAC7C,iBAAK,mBAAmB;AAAA,UAC5B,CAAC;AACD,wBAAc,QAAQ,SAAS,iBAAiB;AAAA,YAC5C,YAAY;AAAA,YACZ,iBAAiB,CAAC,OAAO;AAAA,UAC7B,CAAC;AAGD,iBAAO,iBAAiB,4BAA4B,MAAM;AACtD,iBAAK,oBAAoB;AACzB,iBAAK,iBAAiB;AAAA,UAC1B,CAAC;AAGD,eAAK,gBAAgB;AACrB,eAAK,qBAAqB;AAAA,QAC9B;AAAA;AAAA;AAAA;AAAA,QAKA,kBAAwB;AACpB,cAAI,CAAC,OAAO,UAAW;AAEvB,iBAAO,UAAU,YAAY;AAAA,YACzB,oBAAoB,MAAM,KAAK,YAAY;AAAA,YAC3C,mBAAmB,MAAM,KAAK,SAAS;AAAA,YACvC,mBAAmB,MAAM,KAAK,SAAS;AAAA,YACvC,yBAAyB,MAAM,KAAK,eAAe;AAAA,YACnD,mBAAmB,MAAM,KAAK,YAAY,MAAM;AAAA,YAChD,mBAAmB,MAAM,KAAK,YAAY,MAAM;AAAA,YAChD,kBAAkB,MAAM,KAAK,YAAY,KAAK;AAAA,YAC9C,mBAAmB,MAAM,KAAK,YAAY,MAAM;AAAA,YAChD,oBAAoB,MAAM,KAAK,YAAY;AAAA,YAC3C,wBAAwB,MAAM,KAAK,UAAU;AAAA;AAAA,YAE7C,mBAAmB,MAAM,KAAK,cAAc,MAAM,IAAI;AAAA,YACtD,qBAAqB,MAAM,KAAK,cAAc,KAAK,GAAG;AAAA,YACtD,wBAAwB,MAAM,KAAK,cAAc,OAAO,MAAM;AAAA,YAC9D,4BAA4B,MAAM,KAAK,cAAc,MAAM,IAAI;AAAA,YAC/D,uBAAuB,MAAM,KAAK,cAAc,CAAC;AAAA,YACjD,uBAAuB,MAAM,KAAK,cAAc,CAAC;AAAA,YACjD,uBAAuB,MAAM,KAAK,cAAc,CAAC;AAAA,YACjD,4BAA4B,MAAM,KAAK,WAAW,WAAW;AAAA,YAC7D,0BAA0B,MAAM,KAAK,WAAW,SAAS;AAAA,YACzD,wBAAwB,MAAM,KAAK,UAAU,MAAM;AAAA,YACnD,0BAA0B,MAAM,KAAK,UAAU,QAAQ;AAAA,YACvD,yBAAyB,MAAM,KAAK,UAAU,OAAO;AAAA,YACrD,yBAAyB,MAAM,KAAK,WAAW;AAAA,YAC/C,0BAA0B,MAAM,KAAK,kBAAkB;AAAA,YACvD,uBAAuB,MAAM,KAAK,SAAS;AAAA,YAC3C,yBAAyB,MAAM,KAAK,WAAW;AAAA,YAC/C,yBAAyB,MAAM,KAAK,WAAW;AAAA,YAC/C,+BAA+B,MAAM,KAAK,iBAAiB;AAAA,UAC/D,CAAC;AAAA,QACL;AAAA;AAAA;AAAA;AAAA,QAKA,oBAA0B;AACtB,cAAI,CAAC,KAAK,OAAQ;AAElB,cAAI;AACA,sBAAU,qBAAqB,KAAK,OAAO,KAAK;AAAA,UACpD,SAAS,KAAK;AACV,oBAAQ,KAAK,kDAAkD,GAAG;AAAA,UACtE;AAEA,eAAK,oBAAoB;AAAA,QAC7B;AAAA;AAAA;AAAA;AAAA,QAKA,iBAAiB,OAAoB;AAxZzC;AAyZQ,gBAAM,QAAQ,MAAM;AACpB,gBAAM,QAAO,oCAAO,UAAP,mBAAe;AAC5B,cAAI,CAAC,KAAM;AAEX,gBAAM,SAAS,IAAI,WAAW;AAC9B,iBAAO,SAAS,CAAC,MAAiC;AA9Z1D,gBAAAE;AA+ZY,kBAAM,WAAUA,MAAA,EAAE,WAAF,gBAAAA,IAAU;AAC1B,gBAAI,OAAO,YAAY,YAAY,KAAK,QAAQ;AAC5C,mBAAK,OAAO,QAAQ;AACpB,mBAAK,gBAAgB;AACrB,mBAAK,qBAAqB;AAAA,YAC9B;AACA,iBAAK,oBAAoB,EAAE,UAAU,KAAK,MAAM,SAAS,GAAG;AAC5D,iBAAK,oBAAoB;AACzB,iBAAK,eAAe,KAAK,IAAI;AAC7B,iBAAK,oBAAoB;AACzB,iBAAK,YAAY;AAAA,UACrB;AACA,iBAAO,WAAW,IAAI;AAGtB,cAAI,OAAO;AACP,kBAAM,QAAQ;AAAA,UAClB;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,mBAAyB;AACrB,cAAI,CAAC,KAAK,OAAQ;AAElB,cAAI;AACA,kBAAM,QAAQ,UAAU,mBAAmB;AAC3C,gBAAI,OAAO;AACP,mBAAK,OAAO,QAAQ;AACpB,mBAAK,gBAAgB;AACrB,mBAAK,qBAAqB;AAAA,YAC9B;AAAA,UACJ,SAAS,KAAK;AACV,oBAAQ,KAAK,iCAAiC,GAAG;AAAA,UACrD;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,sBAA4B;AACxB,cAAI,CAAC,KAAK,cAAc,CAAC,KAAK,OAAQ;AAEtC,eAAK,WAAW,WAAW,KAAK,OAAO,MAAM,WAAW;AAAA,QAC5D;AAAA;AAAA;AAAA;AAAA,QAKA,cAAoB;AAChB,cAAI,KAAK,QAAQ;AACb,iBAAK,OAAO,MAAM;AAAA,UACtB;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,cAAoB;AAChB,cAAI,CAAC,KAAK,OAAQ;AAElB,eAAK,OAAO,QAAQ;AACpB,eAAK,gBAAgB;AACrB,eAAK,qBAAqB;AAC1B,iBAAO,mBAAmB;AAC1B,eAAK,oBAAoB;AACzB,eAAK,oBAAoB;AACzB,eAAK,YAAY;AACjB,eAAK,oBAAoB;AACzB,eAAK,YAAY;AAAA,QACrB;AAAA;AAAA;AAAA;AAAA,QAKA,WAAiB;AACb,cAAI,KAAK,WAAW;AAChB,iBAAK,UAAU,MAAM;AAAA,UACzB;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,WAAiB;AACb,cAAI,CAAC,KAAK,OAAQ;AAElB,gBAAM,UAAU,KAAK,OAAO;AAC5B,gBAAM,OAAO,IAAI,KAAK,CAAC,OAAO,GAAG;AAAA,YAC7B,MAAM;AAAA,UACV,CAAC;AACD,gBAAM,MAAM,IAAI,gBAAgB,IAAI;AACpC,gBAAM,IAAI,SAAS,cAAc,GAAG;AACpC,YAAE,OAAO;AAET,gBAAM,YAAY,QAAQ,MAAM,IAAI,EAAE,CAAC,KAAK;AAC5C,gBAAM,YACF,UACK,KAAK,EACL,UAAU,GAAG,EAAE,EACf,QAAQ,mBAAmB,EAAE,KAAK;AAC3C,YAAE,WAAW,GAAG,SAAS;AAEzB,mBAAS,KAAK,YAAY,CAAC;AAC3B,YAAE,MAAM;AACR,mBAAS,KAAK,YAAY,CAAC;AAC3B,cAAI,gBAAgB,GAAG;AAAA,QAC3B;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,YAAY,SAAuB;AAC/B,eAAK,YAAY;AACjB,cAAI;AACA,gBAAI,CAAC,SAAS,YAAY,OAAO,GAAG;AAChC,mBAAK,eAAe,WAAW,OAAO,gBAAgB;AAAA,YAC1D;AAAA,UACJ,SAAS,KAAK;AACV,oBAAQ,KAAK,WAAW,OAAO,YAAY,GAAG;AAC9C,iBAAK,eAAe,WAAW,OAAO,SAAS;AAAA,UACnD;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,YAAY,GAAiB;AACzB,eAAK,YAAY;AAEjB,cAAI,UAAU,aAAa,OAAO,UAAU,UAAU,aAAa,YAAY;AAC3E,sBAAU,UACL,SAAS,EACT,KAAK,UAAQ;AACV,kBAAI,QAAQ,KAAK,QAAQ;AACrB,qBAAK,mBAAmB,IAAI;AAAA,cAChC;AAAA,YACJ,CAAC,EACA,MAAM,MAAM;AACT,mBAAK,YAAY,OAAO;AAAA,YAC5B,CAAC;AAAA,UACT,OAAO;AACH,iBAAK,YAAY,OAAO;AAAA,UAC5B;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,YAAkB;AACd,eAAK,YAAY;AACjB,cAAI,KAAK,QAAQ;AACb,iBAAK,OAAO,OAAO;AAAA,UACvB;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,mBAAmB,MAAoB;AACnC,cAAI,CAAC,KAAK,UAAU,OAAO,SAAS,SAAU;AAE9C,gBAAM,QACF,OAAO,KAAK,OAAO,mBAAmB,WAChC,KAAK,OAAO,iBACZ,KAAK,OAAO,MAAM;AAC5B,gBAAM,MAAM,OAAO,KAAK,OAAO,iBAAiB,WAAW,KAAK,OAAO,eAAe;AAEtF,eAAK,OAAO,aAAa,MAAM,OAAO,KAAK,KAAK;AAChD,eAAK,OAAO,cAAc,IAAI,MAAM,SAAS,EAAE,SAAS,KAAK,CAAC,CAAC;AAAA,QACnE;AAAA;AAAA;AAAA;AAAA,QAKA,sBAA4B;AACxB,gBAAM,WACF,KAAK,qBAAqB,KAAK,kBAAkB,WAC3C,qCACA;AAEV,gBAAM,SACF,KAAK,qBAAqB,KAAK,kBAAkB,WAC3C,EAAE,UAAU,KAAK,kBAAkB,SAAS,IAC5C;AAEV,gBAAM,EAAE,KAAK,IAAI,KAAK,mBAAmB,UAAU,MAAM;AACzD,mBAAS,QAAQ;AAAA,QACrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAOA,gBAAgB,OAAiB,CAAC,GAAW;AACzC,gBAAM,QAAQ,CAAC;AACf,cAAI,KAAK,KAAM,OAAM,KAAK,KAAK,IAAI;AACnC,cAAI,KAAK,MAAM;AACX,kBAAM,KAAK,KAAK,IAAI;AAAA,UACxB,WAAW,KAAK,UAAU;AACtB,kBAAM,KAAK,KAAK,QAAQ;AAAA,UAC5B;AACA,iBAAO,MAAM,KAAK,KAAK;AAAA,QAC3B;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,eAAe,MAAuC;AAClD,cAAI,CAAC,MAAM;AACP,iBAAK,YAAY;AACjB;AAAA,UACJ;AACA,eAAK,cAAc,EAAE,MAAM,SAAS,KAAK;AACzC,eAAK,iBAAiB;AAAA,QAC1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAOA,mBAAmB,KAAa,QAAwC;AACpE,eAAK,cAAc;AAAA,YACf,MAAM;AAAA,YACN;AAAA,YACA,QAAQ,UAAU;AAAA,UACtB;AACA,eAAK,iBAAiB;AAAA,QAC1B;AAAA;AAAA;AAAA;AAAA,QAKA,cAAoB;AAChB,eAAK,cAAc;AACnB,eAAK,iBAAiB;AAAA,QAC1B;AAAA;AAAA;AAAA;AAAA,QAKA,mBAAyB;AACrB,cAAI,CAAC,KAAK,UAAW;AAErB,cAAI,CAAC,KAAK,aAAa;AACnB,iBAAK,UAAU,cAAc;AAC7B,iBAAK,UAAU,MAAM,UAAU;AAC/B,iBAAK,UAAU,gBAAgB,WAAW;AAC1C,iBAAK,UAAU,gBAAgB,kBAAkB;AACjD;AAAA,UACJ;AAEA,cAAI,KAAK,YAAY,SAAS,QAAQ;AAClC,kBAAM,EAAE,MAAM,WAAW,IAAI,KAAK;AAAA,cAC9B,KAAK,YAAY;AAAA,cACjB,KAAK,YAAY;AAAA,YACrB;AACA,iBAAK,UAAU,cAAc;AAE7B,gBAAI,YAAY;AACZ,mBAAK,UAAU,aAAa,aAAa,KAAK,YAAY,GAAG;AAC7D,kBAAI,KAAK,YAAY,QAAQ;AACzB,qBAAK,UAAU;AAAA,kBACX;AAAA,kBACA,KAAK,UAAU,KAAK,YAAY,MAAM;AAAA,gBAC1C;AAAA,cACJ,OAAO;AACH,qBAAK,UAAU,gBAAgB,kBAAkB;AAAA,cACrD;AAEA,kBAAI,OAAO,WAAW,OAAO,OAAO,QAAQ,sBAAsB,YAAY;AAC1E,uBAAO,QAAQ,kBAAkB;AAAA,cACrC;AAAA,YACJ,OAAO;AACH,mBAAK,UAAU,gBAAgB,WAAW;AAC1C,mBAAK,UAAU,gBAAgB,kBAAkB;AAAA,YACrD;AAAA,UACJ,OAAO;AACH,iBAAK,UAAU,gBAAgB,WAAW;AAC1C,iBAAK,UAAU,gBAAgB,kBAAkB;AACjD,iBAAK,UAAU,cAAc,KAAK,YAAY;AAAA,UAClD;AAEA,eAAK,UAAU,MAAM,UAAU;AAAA,QACnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAQA,mBACI,KACA,QACqC;AACrC,cAAI,CAAC,IAAK,QAAO,EAAE,MAAM,IAAI,YAAY,MAAM;AAE/C,gBAAM,mBAAmB;AAAA,YACrB,4BAA4B,MAAM;AAAA,YAClC,oCAAoC,CAAC,MAAe;AAChD,oBAAM,WAAW,KAAM,EAAU,WAAY,EAAU,WAAW;AAClE,qBAAO,WAAW,qBAAgB,QAAQ,KAAK;AAAA,YACnD;AAAA,YACA,6BAA6B,MAAM;AAAA,YACnC,sCAAsC,CAAC,MAAe;AAClD,oBAAM,QAAQ,KAAM,EAAU,QAAS,EAAU,QAAQ;AACzD,qBAAO,QAAQ,GAAG,KAAK,sBAAc;AAAA,YACzC;AAAA,YACA,+BAA+B,MAAM;AAAA,YACrC,+BAA+B,MAC3B;AAAA,YACJ,+BAA+B,CAAC,MAAe;AAC3C,oBAAM,QAAQ,KAAK,OAAQ,EAAU,UAAU,WAAY,EAAU,QAAQ;AAC7E,oBAAM,QAAQ,KAAK,OAAQ,EAAU,UAAU,WAAY,EAAU,QAAQ;AAC7E,qBAAO,UAAU,KAAK,kBAAkB,KAAK;AAAA,YACjD;AAAA,YACA,8BAA8B,CAAC,MAAe;AAC1C,oBAAM,OAAO,KAAK,OAAQ,EAAU,SAAS,WAAY,EAAU,OAAO;AAC1E,oBAAM,MAAM,KAAK,OAAQ,EAAU,QAAQ,WAAY,EAAU,MAAM;AACvE,qBAAO,QAAQ,IAAI,SAAS,GAAG;AAAA,YACnC;AAAA,YACA,kCAAkC,MAAM;AAAA,YACxC,wCAAwC,CAAC,MAAe;AACpD,oBAAM,QAAQ,KAAK,OAAQ,EAAU,UAAU,WAAY,EAAU,QAAQ;AAC7E,qBAAO,YAAY,KAAK;AAAA,YAC5B;AAAA,UACJ;AAEA,cAAI;AACA,gBAAI,OAAO,WAAW,OAAO,OAAO,QAAQ,cAAc,YAAY;AAClE,oBAAM,aAAa,OAAO,QAAQ,UAAU,GAAG;AAC/C,kBAAI,cAAc,eAAe,KAAK;AAClC,uBAAO,EAAE,MAAM,YAAY,YAAY,KAAK;AAAA,cAChD;AAAA,YACJ;AAAA,UACJ,SAAS,KAAK;AACV,oBAAQ,KAAK,qCAAqC,GAAG;AAAA,UACzD;AAEA,gBAAM,aAAa,iBAAiB,GAAG;AACvC,cAAI,OAAO,eAAe,YAAY;AAClC,mBAAO,EAAE,MAAM,WAAW,UAAU,CAAC,CAAC,GAAG,YAAY,MAAM;AAAA,UAC/D;AAEA,iBAAO,EAAE,MAAM,KAAK,YAAY,MAAM;AAAA,QAC1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAYA,eAAe,SAA2C;AACtD,cAAI,OAAO,QAAQ,YAAY,UAAU;AACrC,oBAAQ,KAAK,uCAAuC,OAAO;AAC3D;AAAA,UACJ;AAEA,gBAAM,gBAAmC;AAAA,YACrC,SAAS,QAAQ;AAAA,YACjB,UAAU,QAAQ;AAAA,YAClB,MAAM,QAAQ;AAAA,YACd,MAAM,QAAQ;AAAA,UAClB;AAEA,cAAI,KAAK,QAAQ;AACb,iBAAK,OAAO,QAAQ,cAAc;AAClC,iBAAK,gBAAgB;AACrB,iBAAK,qBAAqB;AAAA,UAC9B;AAEA,eAAK,oBAAoB;AACzB,gBAAM,QAAQ,KAAK,gBAAgB,aAAa;AAChD,eAAK,oBAAoB;AACzB,eAAK,eAAe,KAAK;AAEzB,cAAI;AACA,sBAAU,qBAAqB,cAAc,OAAO;AAAA,UACxD,SAAS,KAAK;AACV,oBAAQ,KAAK,mCAAmC,GAAG;AAAA,UACvD;AAEA,eAAK,oBAAoB;AACzB,eAAK,YAAY;AAAA,QACrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QASA,YAAY,UAAoB,CAAC,GAAS;AACtC,gBAAM,QAAQ,KAAK,gBAAgB,OAAO;AAC1C,cAAI,OAAO;AACP,iBAAK,mBAAmB,sCAAsC;AAAA,cAC1D;AAAA,YACJ,CAAC;AAAA,UACL,OAAO;AACH,iBAAK,mBAAmB,2BAA2B;AAAA,UACvD;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAUA,cAAc,UAA4B,CAAC,GAAS;AAChD,gBAAM,QAAQ,KAAK,gBAAgB,OAAO;AAC1C,gBAAM,WAAW,KAAK,mBAAmB,6BAA6B;AACtE,gBAAM,UAAU,WAAW,QAAQ,UAAU,QAAQ,UAAU,SAAS;AAExE,cAAI,OAAO;AACP,iBAAK,eAAe,GAAG,KAAK,WAAM,OAAO,EAAE;AAAA,UAC/C,OAAO;AACH,iBAAK,eAAe,OAAO;AAAA,UAC/B;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,iBAAiB,QAAsB;AACnC,cAAI,CAAC,OAAQ;AAEb,gBAAM,YAAoC;AAAA,YACtC,YAAY;AAAA,YACZ,aAAa;AAAA,YACb,aAAa;AAAA,YACb,aAAa;AAAA,YACb,aAAa;AAAA,YACb,YAAY;AAAA,YACZ,aAAa;AAAA,YACb,cAAc;AAAA,YACd,kBAAkB;AAAA,YAClB,mBAAmB;AAAA,UACvB;AAEA,gBAAM,eAAe,UAAU,MAAM;AACrC,cAAI,gBAAgB,OAAO,WAAW;AAClC,mBAAO,UAAU,QAAQ,YAAY;AAAA,UACzC,OAAO;AACH,oBAAQ,KAAK,wBAAwB,MAAM;AAAA,UAC/C;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QASA,cAAc,QAAgB,QAAsB;AAChD,cAAI,CAAC,KAAK,OAAQ;AAElB,gBAAM,QAAQ,KAAK,OAAO;AAC1B,gBAAM,MAAM,KAAK,OAAO;AACxB,gBAAM,eAAe,KAAK,OAAO,MAAM,UAAU,OAAO,GAAG;AAC3D,gBAAM,cAAc,SAAS,eAAe;AAE5C,eAAK,OAAO,aAAa,aAAa,OAAO,KAAK,QAAQ;AAC1D,eAAK,OAAO,cAAc,IAAI,MAAM,SAAS,EAAE,SAAS,KAAK,CAAC,CAAC;AAC/D,eAAK,YAAY;AAAA,QACrB;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,cAAc,OAAqB;AAC/B,cAAI,CAAC,KAAK,OAAQ;AAElB,gBAAM,QAAQ,KAAK,OAAO;AAC1B,gBAAM,OAAO,KAAK,OAAO;AAGzB,gBAAM,YAAY,KAAK,YAAY,MAAM,QAAQ,CAAC,IAAI;AACtD,cAAI,UAAU,KAAK,QAAQ,MAAM,KAAK;AACtC,cAAI,YAAY,GAAI,WAAU,KAAK;AAEnC,gBAAM,cAAc,KAAK,UAAU,WAAW,OAAO;AACrD,gBAAM,SAAS,IAAI,OAAO,KAAK,IAAI;AAGnC,gBAAM,eAAe,YAAY,MAAM,OAAO;AAC9C,cAAI;AAEJ,cAAI,cAAc;AAEd,sBAAU,SAAS,YAAY,UAAU,aAAa,CAAC,EAAE,MAAM;AAAA,UACnE,OAAO;AAEH,sBAAU,SAAS;AAAA,UACvB;AAEA,eAAK,OAAO,aAAa,SAAS,WAAW,SAAS,KAAK;AAC3D,eAAK,OAAO,cAAc,IAAI,MAAM,SAAS,EAAE,SAAS,KAAK,CAAC,CAAC;AAC/D,eAAK,YAAY;AAAA,QACrB;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,WAAW,MAAqC;AAC5C,cAAI,CAAC,KAAK,OAAQ;AAElB,gBAAM,QAAQ,KAAK,OAAO;AAC1B,gBAAM,MAAM,KAAK,OAAO;AACxB,gBAAM,OAAO,KAAK,OAAO;AAGzB,gBAAM,YAAY,KAAK,YAAY,MAAM,QAAQ,CAAC,IAAI;AACtD,cAAI,UAAU,KAAK,QAAQ,MAAM,GAAG;AACpC,cAAI,YAAY,GAAI,WAAU,KAAK;AAEnC,gBAAM,gBAAgB,KAAK,UAAU,WAAW,OAAO,EAAE,MAAM,IAAI;AACnE,gBAAM,SAAS,SAAS,YAAY,OAAO;AAE3C,gBAAM,WAAW,cAAc,IAAI,CAAC,MAAM,UAAU;AAEhD,kBAAM,YAAY,KAAK,QAAQ,yBAAyB,EAAE;AAE1D,gBAAI,SAAS,WAAW;AACpB,qBAAO,GAAG,QAAQ,CAAC,KAAK,SAAS;AAAA,YACrC;AAEA,mBAAO,GAAG,MAAM,GAAG,SAAS;AAAA,UAChC,CAAC;AAED,gBAAM,UAAU,SAAS,KAAK,IAAI;AAClC,eAAK,OAAO,aAAa,SAAS,WAAW,SAAS,KAAK;AAC3D,eAAK,OAAO,cAAc,IAAI,MAAM,SAAS,EAAE,SAAS,KAAK,CAAC,CAAC;AAC/D,eAAK,YAAY;AAAA,QACrB;AAAA;AAAA;AAAA;AAAA;AAAA,QAMA,UAAU,WAA8C;AACpD,cAAI,CAAC,KAAK,OAAQ;AAElB,gBAAM,QAAQ,KAAK,OAAO;AAC1B,gBAAM,MAAM,KAAK,OAAO;AACxB,gBAAM,OAAO,KAAK,OAAO;AAGzB,gBAAM,YAAY,KAAK,YAAY,MAAM,QAAQ,CAAC,IAAI;AACtD,cAAI,UAAU,KAAK,QAAQ,MAAM,GAAG;AACpC,cAAI,YAAY,GAAI,WAAU,KAAK;AAEnC,gBAAM,eAAe,KAAK,UAAU,WAAW,OAAO;AACtD,gBAAM,cAAc,2BAA2B,SAAS;AAAA,EAAQ,YAAY;AAAA;AAE5E,eAAK,OAAO,aAAa,aAAa,WAAW,SAAS,KAAK;AAC/D,eAAK,OAAO,cAAc,IAAI,MAAM,SAAS,EAAE,SAAS,KAAK,CAAC,CAAC;AAC/D,eAAK,YAAY;AAAA,QACrB;AAAA;AAAA;AAAA;AAAA,QAKA,aAAmB;AACf,cAAI,CAAC,KAAK,OAAQ;AAElB,gBAAM,QAAQ,KAAK,OAAO;AAC1B,gBAAM,MAAM,KAAK,OAAO;AACxB,gBAAM,eAAe,KAAK,OAAO,MAAM,UAAU,OAAO,GAAG;AAE3D,gBAAM,WACF,KAAK,mBAAmB,gCAAgC,EAAE,QAAQ;AACtE,eAAK,eAAe,UAAU,uBAAuB,UAAU,EAAE;AAAA,YAC7D,CAAC,QAAuB;AA/+BpC;AAg/BgB,kBAAI,CAAC,IAAK;AAEV,oBAAM,WAAW,gBAAgB;AACjC,oBAAM,WAAW,IAAI,QAAQ,KAAK,GAAG;AAErC,yBAAK,WAAL,mBAAa,aAAa,UAAU,OAAO,KAAK;AAChD,yBAAK,WAAL,mBAAa,cAAc,IAAI,MAAM,SAAS,EAAE,SAAS,KAAK,CAAC;AAC/D,mBAAK,YAAY;AAAA,YACrB;AAAA,UACJ;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,kBAAwB;AACpB,cAAI,CAAC,KAAK,UAAU,CAAC,KAAK,iBAAkB;AAE5C,gBAAM,OAAO,KAAK,OAAO;AACzB,gBAAM,QAAQ,KAAK;AACnB,gBAAM,cAAc,KAAK,KAAK;AAC9B,gBAAM,QAAQ,gBAAgB,KAAK,IAAI,YAAY,MAAM,KAAK,EAAE;AAGhE,gBAAM,KAAK,KAAK,mBAAmB,+BAA+B,EAAE,OAAO,MAAM,CAAC;AAClF,cAAI,GAAG,YAAY;AACf,iBAAK,iBAAiB,cAAc,GAAG;AACvC;AAAA,UACJ;AAGA,eAAK,iBAAiB,cAAc,UAAU,KAAK,kBAAkB,KAAK;AAAA,QAC9E;AAAA;AAAA;AAAA;AAAA,QAKA,uBAA6B;AACzB,cAAI,CAAC,KAAK,UAAU,CAAC,KAAK,eAAgB;AAE1C,gBAAM,OAAO,KAAK,OAAO;AACzB,gBAAM,MAAM,KAAK,OAAO;AAExB,gBAAM,mBAAmB,KAAK,UAAU,GAAG,GAAG;AAC9C,gBAAM,QAAQ,iBAAiB,MAAM,IAAI;AACzC,gBAAM,OAAO,MAAM;AACnB,gBAAM,WAAW,MAAM,MAAM,SAAS,CAAC,KAAK;AAC5C,gBAAM,MAAM,SAAS,SAAS;AAG9B,gBAAM,SAAS,KAAK,mBAAmB,8BAA8B,EAAE,MAAM,IAAI,CAAC;AAClF,cAAI,OAAO,YAAY;AACnB,iBAAK,eAAe,cAAc,OAAO;AACzC;AAAA,UACJ;AAGA,eAAK,eAAe,cAAc,QAAQ,IAAI,SAAS,GAAG;AAAA,QAC9D;AAAA;AAAA;AAAA;AAAA,QAKA,oBAA0B;AACtB,cAAI,CAAC,KAAK,iBAAkB;AAE5B,cAAI,KAAK,iBAAiB,MAAM,YAAY,QAAQ;AAChD,iBAAK,iBAAiB,MAAM,UAAU;AACtC,gBAAI,KAAK,WAAW;AAChB,mBAAK,UAAU,MAAM;AAAA,YACzB;AAAA,UACJ,OAAO;AACH,iBAAK,iBAAiB,MAAM,UAAU;AACtC,iBAAK,YAAY;AAAA,UACrB;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,mBAAyB;AACrB,cAAI,CAAC,KAAK,iBAAkB;AAC5B,eAAK,iBAAiB,MAAM,UAAU;AACtC,eAAK,YAAY;AAAA,QACrB;AAAA;AAAA;AAAA;AAAA,QAKA,WAAiB;AACb,cAAI,CAAC,KAAK,UAAU,CAAC,KAAK,UAAW;AAErC,gBAAM,aAAa,KAAK,UAAU;AAClC,cAAI,CAAC,WAAY;AAEjB,gBAAM,OAAO,KAAK,OAAO;AACzB,gBAAM,QAAQ,KAAK,OAAO;AAC1B,gBAAM,QAAQ,KAAK,QAAQ,YAAY,KAAK;AAE5C,cAAI,UAAU,IAAI;AACd,iBAAK,OAAO,kBAAkB,OAAO,QAAQ,WAAW,MAAM;AAC9D,iBAAK,OAAO,MAAM;AAAA,UACtB,OAAO;AAEH,kBAAM,aAAa,KAAK,QAAQ,UAAU;AAC1C,gBAAI,eAAe,IAAI;AACnB,mBAAK,OAAO,kBAAkB,YAAY,aAAa,WAAW,MAAM;AACxE,mBAAK,OAAO,MAAM;AAAA,YACtB,OAAO;AACH,oBAAM,UACF,KAAK,mBAAmB,gCAAgC,EAAE,QAC1D;AACJ,mBAAK,UAAU,SAAS,MAAM;AAAA,YAClC;AAAA,UACJ;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,aAAmB;AACf,cAAI,CAAC,KAAK,UAAU,CAAC,KAAK,aAAa,CAAC,KAAK,aAAc;AAE3D,gBAAM,aAAa,KAAK,UAAU;AAClC,gBAAM,cAAc,KAAK,aAAa;AAEtC,cAAI,CAAC,WAAY;AAEjB,gBAAM,QAAQ,KAAK,OAAO;AAC1B,gBAAM,MAAM,KAAK,OAAO;AACxB,gBAAM,eAAe,KAAK,OAAO,MAAM,UAAU,OAAO,GAAG;AAE3D,cAAI,iBAAiB,YAAY;AAC7B,iBAAK,OAAO,aAAa,aAAa,OAAO,KAAK,KAAK;AACvD,iBAAK,OAAO,cAAc,IAAI,MAAM,SAAS,EAAE,SAAS,KAAK,CAAC,CAAC;AAC/D,iBAAK,SAAS;AAAA,UAClB,OAAO;AACH,iBAAK,SAAS;AAAA,UAClB;AAAA,QACJ;AAAA;AAAA;AAAA;AAAA,QAKA,aAAmB;AACf,cAAI,CAAC,KAAK,UAAU,CAAC,KAAK,aAAa,CAAC,KAAK,aAAc;AAE3D,gBAAM,aAAa,KAAK,UAAU;AAClC,gBAAM,cAAc,KAAK,aAAa;AAEtC,cAAI,CAAC,WAAY;AAEjB,gBAAM,OAAO,KAAK,OAAO;AACzB,gBAAM,QAAQ,KAAK,MAAM,UAAU;AACnC,gBAAM,QAAQ,MAAM,SAAS;AAE7B,cAAI,QAAQ,GAAG;AACX,kBAAM,UAAU,MAAM,KAAK,WAAW;AACtC,iBAAK,OAAO,QAAQ;AACpB,iBAAK,OAAO,cAAc,IAAI,MAAM,SAAS,EAAE,SAAS,KAAK,CAAC,CAAC;AAE/D,kBAAM,UACF,KAAK,mBAAmB,wCAAwC,EAAE,MAAM,CAAC,EAAE,QAC3E,YAAY,KAAK;AACrB,iBAAK,UAAU,SAAS,SAAS;AAAA,UACrC,OAAO;AACH,kBAAM,UACF,KAAK,mBAAmB,gCAAgC,EAAE,QAAQ;AACtE,iBAAK,UAAU,SAAS,MAAM;AAAA,UAClC;AAEA,eAAK,YAAY;AAAA,QACrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAQA,UAAU,SAAiB,OAAqC,QAAQ,WAAW,KAAY;AAC3F,cAAI,CAAC,KAAK,UAAW;AAErB,gBAAM,QAAQ,SAAS,cAAc,KAAK;AAC1C,gBAAM,YAAY,uCAAuC,IAAI;AAC7D,gBAAM,cAAc;AAGpB,cAAI,CAAC,KAAK,gBAAgB;AACtB,iBAAK,iBAAiB,SAAS,cAAc,KAAK;AAClD,iBAAK,eAAe,YAAY;AAChC,iBAAK,UAAU,YAAY,KAAK,cAAc;AAAA,UAClD;AAEA,eAAK,eAAe,YAAY,KAAK;AAGrC,qBAAW,MAAM,MAAM,UAAU,IAAI,MAAM,GAAG,EAAE;AAGhD,qBAAW,MAAM;AACb,kBAAM,UAAU,OAAO,MAAM;AAC7B,uBAAW,MAAM,MAAM,OAAO,GAAG,GAAG;AAAA,UACxC,GAAG,QAAQ;AAAA,QACf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QASA,eAAe,OAAe,eAAe,IAAI,cAAc,IAA4B;AACvF,iBAAO,IAAI,QAAQ,aAAW;AAC1B,kBAAM,QAAQ,SAAS,cAAc,KAAK;AAC1C,kBAAM,YAAY;AAElB,kBAAM,YAAY;AAAA;AAAA;AAAA,kCAGI,KAAK;AAAA;AAAA;AAAA,8FAGuD,WAAW,YAAY,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASrH,qBAAS,KAAK,YAAY,KAAK;AAE/B,kBAAM,QAAQ,MAAM;AAAA,cAChB;AAAA,YACJ;AACA,kBAAM,YAAY,MAAM;AAAA,cACpB;AAAA,YACJ;AACA,kBAAM,aAAa,MAAM;AAAA,cACrB;AAAA,YACJ;AAEA,gBAAI,CAAC,SAAS,CAAC,aAAa,CAAC,YAAY;AACrC,oBAAM,OAAO;AACb,sBAAQ,IAAI;AACZ;AAAA,YACJ;AAGA,uBAAW,MAAM;AACb,6CAAO;AACP,6CAAO;AAAA,YACX,GAAG,EAAE;AAEL,kBAAM,UAAU,MAAM;AAClB,oBAAM,UAAU,IAAI,SAAS;AAC7B,yBAAW,MAAM,MAAM,OAAO,GAAG,GAAG;AAAA,YACxC;AAEA,kBAAM,gBAAgB,MAAM;AACxB,oBAAM,QAAQ,+BAAO,MAAM;AAC3B,sBAAQ;AACR,sBAAU,SAAS,MAAkB,IAAI;AAAA,YAC7C;AAEA,kBAAM,eAAe,MAAM;AACvB,sBAAQ;AACR,sBAAQ,IAAI;AAAA,YAChB;AAGA,uBAAW,iBAAiB,SAAS,aAAa;AAClD,sBAAU,iBAAiB,SAAS,YAAY;AAChD,kBAAM,iBAAiB,WAAW,CAAC,MAAqB;AACpD,kBAAI,EAAE,QAAQ,SAAS;AACnB,kBAAE,eAAe;AACjB,8BAAc;AAAA,cAClB,WAAW,EAAE,QAAQ,UAAU;AAC3B,kBAAE,eAAe;AACjB,6BAAa;AAAA,cACjB;AAAA,YACJ,CAAC;AAGD,kBAAM,iBAAiB,SAAS,CAAC,MAAkB;AAC/C,kBAAI,EAAE,WAAW,OAAO;AACpB,6BAAa;AAAA,cACjB;AAAA,YACJ,CAAC;AAGD,uBAAW,MAAM,MAAM,UAAU,IAAI,MAAM,GAAG,EAAE;AAAA,UACpD,CAAC;AAAA,QACL;AAAA;AAAA;AAAA;AAAA,QAKA,UAAgB;AACZ,cAAI,KAAK,WAAW;AAChB,iBAAK,UAAU,YAAY;AAC3B,iBAAK,YAAY;AAAA,UACrB;AACA,eAAK,SAAS;AACd,eAAK,YAAY;AACjB,eAAK,aAAa;AAClB,eAAK,YAAY;AACjB,eAAK,mBAAmB;AACxB,eAAK,iBAAiB;AACtB,eAAK,mBAAmB;AACxB,eAAK,YAAY;AACjB,eAAK,eAAe;AACpB,eAAK,iBAAiB;AAAA,QAC1B;AAAA,MACJ;AAGA,aAAO,mBAAmB;AAG1B,UAAI,SAAS,eAAe,WAAW;AACnC,iBAAS,iBAAiB,oBAAoB,MAAM;AAChD,gBAAM,YAAY,SAAS,eAAe,uBAAuB;AACjE,cAAI,WAAW;AACX,6BAAiB,KAAK,SAAS;AAAA,UACnC;AAAA,QACJ,CAAC;AAAA,MACL,OAAO;AACH,cAAM,YAAY,SAAS,eAAe,uBAAuB;AACjE,YAAI,WAAW;AACX,2BAAiB,KAAK,SAAS;AAAA,QACnC;AAAA,MACJ;AAAA;AAAA;;;AC/zCA;AAAA;AAAA;AAKA,cAAQ,IAAI,wBAAwB;AAEpC,OAAC,MAAM;AACH;AAoBA,cAAM,iBAAqC;AAAA,UACvC,gBAAgB;AAAA,UAChB,WAAW;AAAA;AAAA;AAAA;AAAA,UAKX,KAAK,eAA2C;AAC5C,kBAAM,YACF,OAAO,kBAAkB,WACnB,SAAS,eAAe,aAAa,IACrC;AAEV,gBAAI,CAAC,WAAW;AACZ,sBAAQ,MAAM,iCAAiC,aAAa;AAC5D;AAAA,YACJ;AAEA,iBAAK,YAAY;AACjB,iBAAK,OAAO;AACZ,iBAAK,gBAAgB;AACrB,iBAAK,oBAAoB;AACzB,iBAAK,uBAAuB;AAC5B,iBAAK,YAAY,SAAS;AAAA,UAC9B;AAAA;AAAA;AAAA;AAAA,UAKA,SAAe;AACX,gBAAI,CAAC,KAAK,UAAW;AAErB,iBAAK,UAAU,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0I3B,kBAAMC,WAAW,OAA+E;AAChG,gBAAIA,YAAA,gBAAAA,SAAS,mBAAmB;AAC5B,cAAAA,SAAQ,kBAAkB,KAAK,SAAS;AAAA,YAC5C;AAAA,UACJ;AAAA;AAAA;AAAA;AAAA,UAKA,kBAAwB;AACpB,gBAAI,CAAC,KAAK,UAAW;AAGrB,kBAAM,cAAc,KAAK,UAAU,iBAAmC,0BAA0B;AAChG,wBAAY,QAAQ,WAAS;AACzB,oBAAM,iBAAiB,UAAU,MAAM;AArNvD;AAsNoB,oBAAI,CAAC,MAAM,QAAS;AAEpB,sBAAM,QAAQ,MAAM;AAEpB,sBAAMC,OAAO,OAAqF;AAClG,qBAAI,KAAAA,QAAA,gBAAAA,KAAK,UAAL,mBAAY,oBAAoB;AAChC,kBAAAA,KAAI,MAAM,mBAAmB,KAAK;AAAA,gBACtC,OAAO;AAEH,wBAAM,cAAe,OAAiF;AACtG,sBAAI,2CAAa,oBAAoB;AACjC,gCAAY,mBAAmB,KAAK;AAAA,kBACxC;AAAA,gBACJ;AAAA,cACJ,CAAC;AAAA,YACL,CAAC;AAGD,kBAAM,iBAAiB,KAAK,UAAU,iBAAmC,mCAAmC;AAC5G,2BAAe,QAAQ,WAAS;AAC5B,oBAAM,iBAAiB,UAAU,MAAM;AA1OvD;AA2OoB,oBAAI,CAAC,MAAM,QAAS;AAEpB,sBAAM,OAAO,MAAM;AAEnB,sBAAMA,OAAO,OAAuF;AACpG,qBAAI,KAAAA,QAAA,gBAAAA,KAAK,SAAL,mBAAW,uBAAuB;AAClC,kBAAAA,KAAI,KAAK,sBAAsB,IAAI;AAAA,gBACvC,OAAO;AAEH,wBAAMD,WAAW,OAAgF;AACjG,sBAAIA,YAAA,gBAAAA,SAAS,uBAAuB;AAChC,oBAAAA,SAAQ,sBAAsB,IAAI;AAAA,kBACtC;AAAA,gBACJ;AAAA,cACJ,CAAC;AAAA,YACL,CAAC;AAAA,UACL;AAAA;AAAA;AAAA;AAAA,UAKA,sBAA4B;AAhQpC;AAiQY,gBAAI,CAAC,KAAK,UAAW;AAErB,gBAAI,aAAa;AACjB,kBAAMC,OAAO,OAA2E;AACxF,kBAAM,cAAe,OAAuE;AAE5F,iBAAI,KAAAA,QAAA,gBAAAA,KAAK,UAAL,mBAAY,oBAAoB;AAChC,2BAAaA,KAAI,MAAM,mBAAmB;AAAA,YAC9C,WAAW,2CAAa,oBAAoB;AACxC,2BAAa,YAAY,mBAAmB;AAAA,YAChD;AAEA,kBAAM,cAAc,KAAK,UAAU,iBAAmC,0BAA0B;AAChG,wBAAY,QAAQ,WAAS;AACzB,oBAAM,UAAU,MAAM,UAAU;AAAA,YACpC,CAAC;AAAA,UACL;AAAA;AAAA;AAAA;AAAA,UAKA,yBAA+B;AAtRvC;AAuRY,gBAAI,CAAC,KAAK,UAAW;AAErB,gBAAI,aAAa;AACjB,kBAAMA,OAAO,OAA6E;AAC1F,kBAAMD,WAAW,OAAsE;AAEvF,iBAAI,KAAAC,QAAA,gBAAAA,KAAK,SAAL,mBAAW,uBAAuB;AAClC,2BAAaA,KAAI,KAAK,sBAAsB;AAAA,YAChD,WAAWD,YAAA,gBAAAA,SAAS,uBAAuB;AACvC,2BAAaA,SAAQ,sBAAsB;AAAA,YAC/C;AAEA,kBAAM,iBAAiB,KAAK,UAAU,iBAAmC,mCAAmC;AAC5G,2BAAe,QAAQ,WAAS;AAC5B,oBAAM,UAAU,MAAM,UAAU;AAAA,YACpC,CAAC;AAAA,UACL;AAAA;AAAA;AAAA;AAAA,UAKA,YAAY,SAA4B;AACpC,gBAAI,CAAC,KAAK,UAAW;AAErB,iBAAK,iBAAiB;AAGtB,kBAAM,WAA0B,CAAC,WAAW,WAAW,UAAU;AACjE,qBAAS,QAAQ,UAAQ;AAnTrC;AAoTgB,oBAAM,MAAK,UAAK,cAAL,mBAAgB,cAAc,aAAa,IAAI;AAC1D,kBAAI,IAAI;AACJ,mBAAG,UAAU,IAAI,QAAQ;AAAA,cAC7B;AAAA,YACJ,CAAC;AAGD,kBAAM,SAAS,KAAK,UAAU,cAAc,aAAa,OAAO,EAAE;AAClE,gBAAI,QAAQ;AACR,qBAAO,UAAU,OAAO,QAAQ;AAAA,YACpC;AAGA,kBAAM,WAAW,KAAK,UAAU,iBAAiB,sCAAsC;AACvF,qBAAS,QAAQ,UAAQ;AACrB,oBAAM,cAAc,KAAK,aAAa,cAAc;AACpD,kBAAI,gBAAgB,SAAS;AACzB,qBAAK,UAAU;AAAA,kBACX;AAAA,kBACA;AAAA,kBACA;AAAA,kBACA;AAAA,kBACA;AAAA,gBACJ;AAAA,cACJ,OAAO;AACH,qBAAK,UAAU;AAAA,kBACX;AAAA,kBACA;AAAA,kBACA;AAAA,kBACA;AAAA,kBACA;AAAA,gBACJ;AAAA,cACJ;AAAA,YACJ,CAAC;AAAA,UACL;AAAA;AAAA;AAAA;AAAA,UAKA,UAAgB;AACZ,gBAAI,KAAK,WAAW;AAChB,mBAAK,UAAU,YAAY;AAC3B,mBAAK,YAAY;AAAA,YACrB;AAAA,UACJ;AAAA,QACJ;AAGA,QAAC,OAA2D,iBAAiB;AAG7E,YAAI,SAAS,eAAe,WAAW;AACnC,mBAAS,iBAAiB,oBAAoB,MAAM;AAChD,kBAAM,YAAY,SAAS,eAAe,oBAAoB;AAC9D,gBAAI,WAAW;AACX,6BAAe,KAAK,SAAS;AAAA,YACjC;AAAA,UACJ,CAAC;AAAA,QACL,OAAO;AACH,gBAAM,YAAY,SAAS,eAAe,oBAAoB;AAC9D,cAAI,WAAW;AACX,2BAAe,KAAK,SAAS;AAAA,UACjC;AAAA,QACJ;AAAA,MACJ,GAAG;AAAA;AAAA;;;ACpXH;AAAA;AAAA;AAAA,OAAC,WAAY;AACT;AAIA,iBAAS,MAAM,IAAgC;AAC3C,iBAAO,SAAS,eAAe,EAAE;AAAA,QACrC;AAEA,iBAASE,mBAAkB,IAA8B;AACrD,gBAAMC,KAAI;AACV,cAAI,MAAMA,GAAE,WAAW,OAAOA,GAAE,QAAQ,sBAAsB,YAAY;AACtE,YAAAA,GAAE,QAAQ,kBAAkB,EAAE;AAAA,UAClC;AAAA,QACJ;AAEA,iBAAS,eAAe,YAAoB,QAAwC;AAChF,gBAAM,cAAc,MAAM,mBAAmB;AAC7C,cAAI,CAAC,YAAa;AAClB,cAAI,OAAO,eAAe,YAAY,WAAW,WAAW,GAAG;AAC3D,wBAAY,gBAAgB,WAAW;AACvC,wBAAY,gBAAgB,kBAAkB;AAC9C,wBAAY,cAAc;AAE1B,kBAAM,WAAY,OAAe;AACjC,gBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,uBAAS,KAAK,WAAW;AAAA,YAC7B,OAAO;AACH,0BAAY,UAAU,IAAI,QAAQ;AAAA,YACtC;AAEA,kBAAM,cAAc;AACpB;AAAA,UACJ;AACA,sBAAY,aAAa,aAAa,UAAU;AAChD,cAAI,UAAU,OAAO,KAAK,MAAM,EAAE,SAAS,GAAG;AAC1C,wBAAY,aAAa,oBAAoB,KAAK,UAAU,MAAM,CAAC;AAAA,UACvE,OAAO;AACH,wBAAY,gBAAgB,kBAAkB;AAAA,UAClD;AACA,gBAAM,cAAc,EAAE,KAAK,YAAY,OAAO;AAC9C,UAAAD,mBAAkB,WAAW;AAC7B;AACI,kBAAM,WAAY,OACb;AACL,gBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,uBAAS,KAAK,WAAW;AAAA,YAC7B,OAAO;AACH,0BAAY,UAAU,OAAO,QAAQ;AAAA,YACzC;AAAA,UACJ;AAAA,QACJ;AAEA,iBAAS,WAAW,MAKX;AACL,gBAAM,SAAS,MAAM,YAAY;AACjC,cAAI,CAAC,OAAQ;AACb,gBAAM,QAAkB,CAAC;AACzB,cAAI,KAAK,KAAM,OAAM,KAAK,KAAK,IAAI;AACnC,cAAI,KAAK,KAAM,OAAM,KAAK,KAAK,IAAI;AACnC,gBAAM,OAAiB,CAAC;AACxB,cAAI,KAAK,WAAY,MAAK,KAAK,KAAK,UAAU;AAC9C,cAAI,OAAO,KAAK,SAAS,YAAY,KAAK,OAAO,GAAG;AAChD,kBAAM,MAAM,KAAK,OAAO,MAAM,QAAQ,CAAC;AACvC,iBAAK,KAAK,GAAG,EAAE,KAAK;AAAA,UACxB;AACA,gBAAM,OAAO,CAAC,MAAM,KAAK,KAAK,GAAG,KAAK,KAAK,UAAK,CAAC,EAAE,OAAO,OAAO,EAAE,KAAK,UAAK;AAC7E,cAAI,MAAM;AACN,mBAAO,cAAc;AACrB,kBAAM,WAAY,OACb;AACL,gBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,uBAAS,KAAK,MAAM;AAAA,YACxB,OAAO;AACH,qBAAO,UAAU,OAAO,QAAQ;AAAA,YACpC;AAAA,UACJ,OAAO;AACH,mBAAO,cAAc;AACrB,kBAAM,WAAY,OACb;AACL,gBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,uBAAS,KAAK,MAAM;AAAA,YACxB,OAAO;AACH,qBAAO,UAAU,IAAI,QAAQ;AAAA,YACjC;AAAA,UACJ;AAAA,QACJ;AAEA,cAAM,QAA2C,EAAE,aAAa,KAAK;AAGrE,cAAM,KAAK;AACX,YAAI,CAAC,GAAG,yBAAyB;AAC7B,aAAG,0BAA0B;AAC7B,iBAAO,iBAAiB,4BAA4B,MAAM;AACtD,gBAAI,MAAM,aAAa;AACnB,6BAAe,MAAM,YAAY,KAAK,MAAM,YAAY,MAAM;AAAA,YAClE;AAAA,UACJ,CAAC;AAAA,QACL;AAWA,cAAM,IAAI;AACV,UAAE,mBAAmB,EAAE,oBAAoB,CAAC;AAC5C,UAAE,iBAAiB,iBAAiB;AACpC,UAAE,iBAAiB,aAAa;AAChC,YAAI,OAAO,EAAE,wBAAwB,WAAY,GAAE,sBAAsB;AACzE,YAAI,OAAO,EAAE,oBAAoB,WAAY,GAAE,kBAAkB;AAAA,MACrE,GAAG;AAAA;AAAA;;;ACxHH;AAAA;AAAA;AAAA,OAAC,WAAY;AACT;AAyBA,cAAM,QAAQ;AAAA,UACV,UAAU,CAAC;AAAA,UACX,kBAAkB,MAAM;AAAA,UACxB,wBAAwB;AAAA,QAC5B;AAIA,iBAAS,WAAW,QAAqC;AAlC7D;AAmCQ,cAAI,EAAE,kBAAkB,SAAU,QAAO;AACzC,gBAAM,OAAM,YAAO,YAAP,mBAAgB;AAC5B,cAAI,QAAQ,WAAW,QAAQ,cAAc,QAAQ,SAAU,QAAO;AACtE,iBAAQ,OAAuB;AAAA,QACnC;AAEA,iBAAS,UAAU,SAAiB,OAAuB;AACvD,kBAAQ,UAAU,KAAK;AAAA,QAC3B;AAEA,iBAAS,UAAU,SAAiB,OAAuB;AACvD,kBAAQ,UAAU,IAAI,SAAS;AAAA,QACnC;AAEA,iBAAS,UAAU,GAA0B;AACzC,cAAI,OAAO,MAAM,YAAY,MAAM,KAAM,QAAO;AAChD,gBAAM,MAAM;AACZ,iBAAO,OAAO,IAAI,QAAQ,YAAY,OAAO,IAAI,YAAY;AAAA,QACjE;AAMA,iBAAS,SAAS,MAAyB,OAAgB,CAAC,GAA0B;AAElF,cAAI,UAAU,IAAI,GAAG;AACjB,kBAAM,IAAI;AACV,kBAAM,SAAS,KAAK,CAAC;AACrB,iCAAqB;AACrB,mBAAO,MAAM;AACT,oBAAM,MAAM,MAAM,SAAS,QAAQ,CAAC;AACpC,kBAAI,OAAO,EAAG,OAAM,SAAS,OAAO,KAAK,CAAC;AAAA,YAC9C;AAAA,UACJ;AAGA,gBAAM,UAAU;AAChB,gBAAM,QAAgC,KAAK,SAAS;AACpD,gBAAM,UAAU,CAAC,MAAqB;AA1E9C;AA4EY,kBAAM,MAAM,EAAE,WAAW,EAAE;AAC3B,gBAAI,CAAC,IAAK;AACV,gBAAI,WAAW,EAAE,MAAM,EAAG;AAC1B,kBAAM,MAAM,EAAE,IAAI,YAAY;AAE9B,gBAAI,QAAQ,OAAO,QAAQ,KAAK;AAC5B,gBAAE,eAAe;AACjB,oBAAM,SAAQ,UAAK,oBAAL;AACd,sBAAQ,eAAe,EAAE,MAAM,CAAC;AAChC;AAAA,YACJ;AAEA,kBAAM,SAAS,QAAQ,kBAAkB;AACzC,kBAAM,YAAY,QAAQ,gBAAgB;AAC1C,kBAAM,QAAQ,UAAU;AACxB,gBAAI,UAAU,EAAG;AAEjB,gBAAI,QAAQ,OAAO,QAAQ;AACvB,gBAAE,eAAe;AACjB,sBAAQ,gBAAgB,OAAO,UAAU;AACzC;AAAA,YACJ;AAEA,gBAAI,QAAQ,OAAO;AACf,gBAAE,eAAe;AACjB,oBAAM,eAAe,SACf,UAAU,UAAU,OAAK,EAAE,eAAe,OAAO,UAAU,IAC3D;AACN,oBAAM,MAAM,EAAE,WACR,UAAU,cAAc,KAAK,IAC7B,UAAU,cAAc,KAAK;AACnC,oBAAM,SAAS,UAAU,GAAG;AAC5B,kBAAI,OAAQ,SAAQ,kBAAkB,OAAO,UAAU;AACvD;AAAA,YACJ;AAEA,gBAAI,UAAU,KAAK,GAAG,GAAG;AACrB,gBAAE,eAAe;AACjB,oBAAM,IAAI,SAAS,KAAK,EAAE;AAC1B,oBAAM,MAAM,KAAK,IAAI,IAAI,GAAG,QAAQ,CAAC;AACrC,oBAAM,SAAS,UAAU,GAAG;AAC5B,kBAAI,OAAQ,SAAQ,kBAAkB,OAAO,UAAU;AACvD;AAAA,YACJ;AAAA,UACJ;AACA,gBAAM,iBAAiB,WAAW,OAAmC;AACrE,iBAAO,MAAM,MAAM,oBAAoB,WAAW,OAAmC;AAAA,QACzF;AAEA,iBAAS,uBAAuB;AAC5B,cAAI,MAAM,uBAAwB;AAClC,gBAAM,WAAW,CAAC,MAAqB;AA/H/C;AAiIY,kBAAM,MAAM,EAAE,WAAW,EAAE;AAC3B,gBAAI,CAAC,IAAK;AACV,gBAAI,WAAW,EAAE,MAAM,EAAG;AAC1B,kBAAM,MAAM,EAAE,IAAI,YAAY;AAC9B,kBAAM,YAAU,WAAM,oBAAN,mCAA6B;AAE7C,kBAAM,UAAU,MAAM,SAAS,KAAK,OAAK;AACrC,kBAAI,EAAE,IAAI,YAAY,MAAM,IAAK,QAAO;AACxC,kBAAI,CAAC,CAAC,EAAE,SAAS,KAAM,QAAO;AAC9B,kBAAI,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC,EAAE,YAAY,EAAE,UAAU,OAAW,QAAO;AAChE,kBAAI,EAAE,WAAW,EAAE,YAAY,QAAS,QAAO;AAC/C,qBAAO;AAAA,YACX,CAAC;AACD,gBAAI,SAAS;AACT,gBAAE,eAAe;AACjB,kBAAI;AACA,wBAAQ,QAAQ;AAAA,cACpB,QAAQ;AAAA,cAAC;AAAA,YACb;AAAA,UACJ;AACA,mBAAS,iBAAiB,WAAW,QAAoC;AACzE,gBAAM,yBAAyB;AAAA,QACnC;AAEA,iBAAS,mBAAmB,UAAwB;AAChD,gBAAM,kBAAkB;AACxB,+BAAqB;AAAA,QACzB;AAEA,cAAM,oBAAoB,EAAE,UAAU,mBAAmB;AACzD,QAAC,OAA+C,oBAAoB;AAAA,MACxE,GAAG;AAAA;AAAA;;;AChKH;AAAA;AAAA;AAAA;AAEA,OAAC,WAAY;AACT;AAEA,cAAM,kBAAkB;AAExB,iBAAS,cAAsB;AAC3B,gBAAM,OAAO,IAAI,KAAK;AACtB,cAAI;AACA,kBAAM,YACD,OAAkE,iBACnE,CAAC;AACL,kBAAM,MAAO,UAAsC,uBAAuB;AAC1E,mBAAO,OAAO,QAAQ,WAAY,MAAiB;AAAA,UACvD,QAAQ;AACJ,mBAAO;AAAA,UACX;AAAA,QACJ;AAEA,iBAAS,aAAa,MAA4B,OAAO,IAAI,UAAU,IAAY;AAC/E,cAAI,SAAS,QAAS,QAAO,kBAAkB;AAC/C,iBAAO,GAAG,eAAe,YAAY,IAAI,IAAI,OAAO;AAAA,QACxD;AAEA,iBAAS,WACL,MACA,MACA,SACA,MACI;AACJ,gBAAM,MAAM,aAAa,MAAM,MAAM,OAAO;AAC5C,cAAI;AACA,kBAAM,UAAU,EAAE,GAAG,KAAK,IAAI,GAAG,GAAG,KAAK;AACzC,oBAAQ,KAAK,OAAO;AAAA,UACxB,QAAQ;AAAA,UAER;AAAA,QACJ;AAEA,iBAAS,UAAuB,MAA4B,OAAO,IAAI,UAAU,IAAc;AAxCnG;AAyCQ,gBAAM,MAAM,aAAa,MAAM,MAAM,OAAO;AAC5C,cAAI;AACA,kBAAM,SAAS,QAAoC,KAAK,IAAI;AAC5D,gBAAI,CAAC,UAAU,OAAO,WAAW,SAAU,QAAO;AAClD,kBAAM,MAAM,YAAY;AACxB,gBAAI,OAAO,OAAO,MAAM,YAAY,KAAK,IAAI,IAAI,OAAO,IAAI,IAAK,QAAO;AACxE,oBAAQ,YAAO,MAAP,YAAkB;AAAA,UAC9B,QAAQ;AACJ,mBAAO;AAAA,UACX;AAAA,QACJ;AAEA,iBAAS,aAAqC;AAC1C,gBAAM,UAAkC,EAAE,QAAQ,iCAAiC;AACnF,cAAI;AACA,kBAAM,QAAQ,UAAU,aAAa;AACrC,gBAAI,SAAS,MAAM,KAAK,GAAG;AACvB,sBAAQ,eAAe,IAAI,SAAS,MAAM,KAAK,CAAC;AAAA,YACpD;AAAA,UACJ,QAAQ;AAAA,UAER;AACA,iBAAO;AAAA,QACX;AAEA,uBAAe,UAAuB,KAAyB;AAC3D,gBAAM,MAAM,MAAM,MAAM,KAAK,EAAE,SAAS,WAAW,EAAE,CAAC;AACtD,cAAI,CAAC,IAAI,IAAI;AACT,kBAAM,OAAO,OAAO,IAAI,MAAM,qBAAqB,IAAI,MAAM,EAAE,GAAG;AAAA,cAC9D,QAAQ,IAAI;AAAA,YAChB,CAAC;AAAA,UACL;AACA,iBAAO,IAAI,KAAK;AAAA,QACpB;AAEA,uBAAe,eACX,UACA,QACkB;AA/E1B;AAgFQ,gBAAM,SAAS,IAAI,WAAW,gBAAgB;AAC9C,iBAAO,IAAI,YAAY,QAAO,sCAAQ,aAAR,YAAoB,GAAG,CAAC;AACtD,iBAAO,IAAI,SAAQ,sCAAQ,SAAR,YAAgB,SAAS;AAC5C,gBAAM,MAAM,gCAAgC,mBAAmB,QAAQ,CAAC,UAAU,OAAO,SAAS,CAAC;AACnG,iBAAO,UAAqB,GAAG;AAAA,QACnC;AAEA,uBAAe,kBACX,UACA,MACA,UAAU,IACM;AAChB,gBAAM,WAAW,UAAU,IAAI,mBAAmB,OAAO,EAAE,QAAQ,QAAQ,GAAG,CAAC,KAAK;AACpF,gBAAM,MAAM,gCAAgC,mBAAmB,QAAQ,CAAC,IAAI,mBAAmB,IAAI,CAAC,YAAY,QAAQ;AACxH,iBAAO,UAAmB,GAAG;AAAA,QACjC;AAuBA,QAAC,OAAwD,YAAY;AAAA,UACjE;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACJ;AAAA,MACJ,GAAG;AAAA;AAAA;;;AC9HH;AAAA;AAAA;AAoHA,UAAM,eAAe;AAsBrB,eAASE,GAAE,KAAa,UAAkB,QAA0C;AA1IpF;AA2II,cAAMC,cAAY,kBAAa,YAAb,mBAAsB;AACxC,YAAI,OAAOA,eAAc,YAAY;AACjC,iBAAOA,WAAU,KAAK,QAAQ,EAAE,SAAS,CAAC;AAAA,QAC9C;AACA,eAAO;AAAA,MACX;AAEA,OAAC,SAAS,mBAAmB;AACzB,cAAM,QAAqB;AAAA,UACvB,aAAa;AAAA,UACb,QAAQ,CAAC;AAAA,UACT,gBAAgB,CAAC;AAAA,UAChB,kBAAkB,oBAAI,IAAI;AAAA,UAC1B,WAAW,oBAAI,IAAI;AAAA,UACnB,cAAc;AAAA,UACd,eAAe;AAAA,UACf,YAAY;AAAA,UACZ,WAAW;AAAA,UACX,aAAa;AAAA,UACb,gBAAgB;AAAA,UAChB,eAAe;AAAA,UACf,eAAe;AAAA,UACf,eAAe;AAAA,UACf,gBAAgB;AAAA,UAChB,mBAAmB,EAAE,WAAW,GAAG,UAAU,GAAG,QAAQ,EAAE;AAAA,QAC9D;AAED,cAAM,WAA2B;AAAA,UAC7B,WAAW;AAAA,UACX,SAAS;AAAA,UACT,SAAS;AAAA,UACT,SAAS;AAAA,UACT,OAAO;AAAA,UACP,YAAY;AAAA,UACZ,OAAO;AAAA,UACP,aAAa;AAAA,UACb,YAAY;AAAA,UACZ,eAAe;AAAA,UACf,aAAa;AAAA,UACb,aAAa;AAAA,UACb,gBAAgB,CAAC;AAAA,UACjB,gBAAgB,CAAC;AAAA,UACjB,SAAS;AAAA,UACT,aAAa;AAAA,UACb,YAAY;AAAA,UACZ,kBAAkB;AAAA,UAClB,eAAe;AAAA,UACf,YAAY;AAAA,UACZ,gBAAgB;AAAA,UAChB,gBAAgB;AAAA,UAChB,qBAAqB;AAAA,UACrB,oBAAoB;AAAA,UACpB,aAAa;AAAA,UACb,YAAY;AAAA,UACZ,YAAY;AAAA,UACZ,OAAO;AAAA,UACP,WAAW;AAAA,UACX,QAAQ;AAAA,UACR,UAAU;AAAA,UACV,gBAAgB;AAAA,UAChB,gBAAgB;AAAA,UAChB,eAAe;AAAA,UACf,aAAa;AAAA,UACb,UAAU;AAAA,UACV,WAAW;AAAA,QACf;AAAM,iBAAS,gBAAgB,OAAiD;AAC5E,iBAAQ,MAA4B,eAAe;AAAA,QACvD;AAEA,iBAAS,eAAmC;AACxC,gBAAMC,gBAAe,aAAa;AAClC,cAAI,CAACA,eAAc;AACf,oBAAQ,MAAM,4BAA4B;AAC1C,mBAAO;AAAA,UACX;AAEA,gBAAM,EAAE,OAAO,UAAU,SAAS,UAAU,IAAIA,cAAa,kBAAkB;AAAA,YAC3E,OAAOF,GAAE,gBAAgB,OAAO;AAAA,YAChC,MAAM;AAAA,YACN,WAAW;AAAA,YACX,cAAc;AAAA,YACd,cAAc;AAAA,YACd,SAAS,MAAM;AA7N3B;AA8NgB,6CAAa,QAAb,mBAAkB,WAAlB,mBAA0B,UAA1B,4BAAkC;AAAA,YACtC;AAAA,YACA,SAAS;AAAA,cACL;AAAA,gBACI,OAAO;AAAA,gBACP,MAAM;AAAA,+EACqDA,GAAE,6BAA6B,mBAAmB,CAAC;AAAA;AAAA;AAAA,qCAG7FA,GAAE,uBAAuB,kBAAe,CAAC;AAAA;AAAA,cAE9D;AAAA,cACA,EAAE,MAAM,YAAY;AAAA,cACpB;AAAA,gBACI,OAAO;AAAA,gBACP,MAAM;AAAA,4GACkFA,GAAE,2BAA2B,SAAS,CAAC;AAAA,gHACnCA,GAAE,+BAA+B,YAAY,CAAC;AAAA,0GACpDA,GAAE,yBAAyB,OAAO,CAAC;AAAA;AAAA,cAE7H;AAAA,YACJ;AAAA,YACA,eAAe;AAAA,YACf,eAAeA,GAAE,kCAAkC,cAAS;AAAA,YAC5D,gBAAgB;AAAA,UACpB,CAAC;AAGD,mBAAS,WAAW;AACpB,mBAAS,YAAY;AAGrB,gBAAM,UAAU,SAAS,cAAc,OAAO;AAC9C,kBAAQ,YAAY;AACpB,kBAAQ,YAAY;AAAA;AAAA,iGAEqEA,GAAE,0BAA0B,YAAY,CAAC;AAAA;AAAA;AAAA,gCAG1GA,GAAE,4BAA4B,YAAY,CAAC;AAAA;AAAA;AAAA;AAAA,gCAI3CA,GAAE,kCAAkC,WAAW,CAAC;AAAA;AAAA;AAAA;AAAA,sGAIsBA,GAAE,0BAA0B,QAAQ,CAAC;AAAA;AAAA;AAAA,gCAG3GA,GAAE,kCAAkC,YAAY,CAAC;AAAA;AAAA;AAAA;AAAA,gCAIjDA,GAAE,iCAAiC,YAAY,CAAC;AAAA;AAAA;AAAA;AAAA,gCAIhDA,GAAE,+BAA+B,aAAa,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAQnDA,GAAE,0BAA0B,WAAW,CAAC;AAAA;AAAA,+FAE2BA,GAAE,6BAA6B,uEAA+D,CAAC;AAAA;AAAA;AAKtL,gBAAM,WAAW,SAAS,cAAc,KAAK;AAC7C,mBAAS,YAAY;AACrB,mBAAS,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA,4DAK+BA,GAAE,yBAAyB,kBAAa,CAAC;AAAA;AAAA;AAAA;AAAA,oDAIjDA,GAAE,yBAAyB,mBAAmB,CAAC;AAAA,yCAC1DA,GAAE,6BAA6B,gEAA0D,CAAC;AAAA,+LAC4DA,GAAE,wBAAwB,kBAAkB,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,2DAKjLA,GAAE,sBAAsB,sBAAsB,CAAC;AAAA,kDACxDA,GAAE,4BAA4B,6DAA6D,CAAC;AAAA;AAAA;AAAA,qLAGuCA,GAAE,sBAAsB,6CAA0C,CAAC;AAAA;AAAA;AAKhP,gBAAM,gBAAgB,SAAS,cAAc,KAAK;AAClD,wBAAc,KAAK;AACnB,wBAAc,YAAY;AAC1B,wBAAc,YAAY;AAAA;AAAA;AAAA;AAAA,6HAI2FA,GAAE,+BAA+B,MAAM,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCAMjIA,GAAE,6BAA6B,cAAc,CAAC;AAAA;AAAA,0OAEwJA,GAAE,0BAA0B,eAAe,CAAC;AAAA,2RACKA,GAAE,gBAAgB,cAAW,CAAC;AAAA;AAAA;AAAA;AAAA,mPAItEA,GAAE,sBAAsB,iBAAiB,CAAC;AAAA;AAAA,mGAE1LA,GAAE,0BAA0B,sBAAmB,CAAC;AAAA,uKACoBA,GAAE,wBAAwB,yBAAoB,CAAC;AAAA;AAAA,mPAE6BA,GAAE,sBAAsB,kBAAe,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uJASpIA,GAAE,+BAA+B,sBAAmB,CAAC;AAAA;AAAA;AAAA;AAAA;AAOpM,gBAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,oBAAU,YAAY;AACtB,oBAAU,YAAY,OAAO;AAC7B,oBAAU,YAAY,QAAQ;AAE9B,kBAAQ,YAAY,SAAS;AAC7B,kBAAQ,YAAY,aAAa;AAEjC,iBAAO;AAAA,QACX;AAEA,iBAAS,OAAa;AAtX1B;AAuXQ,cAAI,MAAM,aAAa;AACnB;AAAA,UACJ;AACA,gBAAM,cAAc;AAGpB,gBAAM,eAAe,SAAS,eAAe,eAAe;AAC5D,cAAI,CAAC,cAAc;AAEf,kBAAM,QAAQ,aAAa;AAC3B,gBAAI,CAAC,OAAO;AACR,sBAAQ,MAAM,gCAAgC;AAC9C;AAAA,YACJ;AAGA,gBAAI,YAAY,SAAS,eAAe,eAAe;AACvD,gBAAI,CAAC,WAAW;AACZ,0BAAY,SAAS,cAAc,KAAK;AACxC,wBAAU,KAAK;AACf,wBAAU,YAAY;AACtB,wBAAU,MAAM,SAAS;AACzB,uBAAS,KAAK,YAAY,SAAS;AAAA,YACvC;AAGA,kBAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,oBAAQ,YAAY;AACpB,oBAAQ,YAAY,KAAK;AACzB,sBAAU,YAAY,OAAO;AAE7B,qBAAS,YAAY;AAAA,UACzB,OAAO;AACH,qBAAS,YAAY;AAAA,UACzB;AAEA,wBAAc;AACd,cAAI,CAAC,SAAS,SAAS;AACnB;AAAA,UACJ;AACA,sBAAY;AACZ,uBAAa;AACb,qBAAW;AACX,sBAAY;AACZ,qBAAW;AACX,mCAAa,YAAb,mBAAsB,sBAAtB,6BAA0C,cAAS,cAAT,YAAsB;AAChE,eAAK,YAAY;AAAA,QACrB;AAEA,iBAAS,gBAAsB;AAxanC;AAyaQ,cAAI,CAAC,SAAS,WAAW;AACrB;AAAA,UACJ;AACA,mBAAS,WAAU,cAAS,UAAU,cAAc,iBAAiB,MAAlD,YAAuD;AAC1E,mBAAS,WAAU,cAAS,UAAU,cAAc,iBAAiB,MAAlD,YAAuD;AAC1E,mBAAS,WAAU,cAAS,UAAU,cAAc,iBAAiB,MAAlD,YAAuD;AAC1E,mBAAS,SAAQ,cAAS,UAAU,cAAc,eAAe,MAAhD,YAAqD;AACtE,mBAAS,aAAa,SAAS,UAAU,cAAc,qBAAqB;AAC5E,mBAAS,SAAQ,cAAS,UAAU,cAAc,eAAe,MAAhD,YAAqD;AACtE,mBAAS,eAAc,cAAS,UAAU,cAAc,oBAAoB,MAArD,YAA0D;AACjF,mBAAS,cAAa,oBAAS,cAAT,mBAAoB,cAAc,uBAAlC,YAAwD;AAC9E,mBAAS,gBAAgB,SAAS,UAAU,cAAc,iBAAiB;AAC3E,mBAAS,cAAc,SAAS,UAAU,cAAc,gBAAgB;AACxE,mBAAS,cAAc,SAAS,UAAU,cAAc,sBAAsB;AAC9E,mBAAS,WAAU,cAAS,UAAU,cAAc,uBAAuB,MAAxD,YAA6D;AAChF,mBAAS,eAAc,cAAS,UAAU,cAAc,qBAAqB,MAAtD,YAA2D;AAClF,mBAAS,cAAa,cAAS,UAAU,cAAc,oBAAoB,MAArD,YAA0D;AAChF,mBAAS,oBAAmB,cAAS,UAAU,cAAc,0BAA0B,MAA3D,YAAgE;AAC5F,mBAAS,iBAAgB,cAAS,UAAU,cAAc,uBAAuB,MAAxD,YAA6D;AACtF,mBAAS,aAAa,SAAS,UAAU,cAAc,oBAAoB;AAC3E,mBAAS,iBAAiB,SAAS,UAAU,cAAc,wBAAwB;AACnF,mBAAS,iBAAiB,SAAS,UAAU,cAAc,wBAAwB;AACnF,mBAAS,uBAAsB,oBAAS,mBAAT,mBAAyB,cAAc,uBAAvC,YAA6D;AAC5F,mBAAS,sBAAqB,oBAAS,mBAAT,mBAAyB,cAAc,gCAAvC,YAAsE;AACpG,mBAAS,cAAc,SAAS,UAAU,cAAc,qBAAqB;AAC7E,mBAAS,aAAa,SAAS,UAAU,cAAc,oBAAoB;AAC3E,mBAAS,aAAa,SAAS,UAAU,cAAc,oBAAoB;AAC3E,mBAAS,QAAQ,SAAS,UAAU,cAAc,eAAe;AACjE,mBAAS,aAAY,cAAS,UAAU,cAAc,aAAa,MAA9C,YAAmD;AACxE,mBAAS,UAAS,cAAS,UAAU,cAAc,sBAAsB,MAAvD,YAA4D;AAC9E,mBAAS,YAAW,cAAS,UAAU,cAAc,mBAAmB,MAApD,YAAyD;AAC7E,mBAAS,kBAAiB,cAAS,UAAU,cAAc,yBAAyB,MAA1D,YAA+D;AACzF,mBAAS,kBAAiB,cAAS,UAAU,cAAc,yBAAyB,MAA1D,YAA+D;AACzF,mBAAS,iBAAgB,cAAS,UAAU,cAAc,wBAAwB,MAAzD,YAA8D;AACvF,mBAAS,eAAc,cAAS,UAAU,cAAc,sBAAsB,MAAvD,YAA4D;AAEnF,gBAAM,kBAAiB,oBAAS,YAAT,mBAAkB,iBAAoC,kCAAtD,YAAuF,CAAC;AAC/G,mBAAS,iBAAiB,MAAM,KAAK,cAAc;AACnD,gBAAM,iBAAiB,SAAS,UAAU,iBAAoC,6BAA6B;AAC3G,mBAAS,iBAAiB,MAAM,KAAK,cAAc;AAAA,QACvD;AAEC,iBAAS,cAAoB;AAndlC;AAodS,mBAAS,eAAe,QAAQ,YAAU;AACtC,mBAAO,iBAAiB,SAAS,MAAM;AACnC,oBAAM,SAAS,OAAO,aAAa,oBAAoB;AACvD,kBAAI,CAAC,UAAU,MAAM,iBAAiB,QAAQ;AAC1C;AAAA,cACJ;AACA,oBAAM,eAAe;AACrB,mCAAqB;AACrB,2BAAa;AAAA,YACjB,CAAC;AAAA,UACL,CAAC;AACD,+BAAqB;AACrB,yBAAS,kBAAT,mBAAwB,iBAAiB,SAAS,MAAM;AACpD,iBAAK,YAAY,EAAE,SAAS,KAAK,CAAC;AAAA,UACtC;AAAA,QACJ;AAEA,iBAAS,eAAqB;AAC1B,mBAAS,eAAe,QAAQ,YAAU;AACtC,mBAAO,iBAAiB,SAAS,MAAM;AACnC,oBAAM,UAAU,OAAO,aAAa,qBAAqB;AACzD,kBAAI,CAAC,WAAW,MAAM,kBAAkB,SAAS;AAC7C;AAAA,cACJ;AACA,oBAAM,gBAAgB;AACtB,mCAAqB;AACrB,4BAAc;AAAA,YAClB,CAAC;AAAA,UACL,CAAC;AACD,+BAAqB;AAAA,QACzB;AAEA,iBAAS,aAAmB;AApfjC;AAqfS,yBAAS,gBAAT,mBAAsB,iBAAiB,SAAS,WAAS;AACrD,kBAAM,SAAS,MAAM;AACrB,kBAAM,aAAa,OAAO;AAC1B,8BAAkB;AAClB,yBAAa;AAAA,UACjB;AACA,yBAAS,gBAAT,mBAAsB,iBAAiB,SAAS,MAAM;AAClD,gBAAI,CAAC,SAAS,aAAa;AACvB;AAAA,YACJ;AACA,qBAAS,YAAY,QAAQ;AAC7B,kBAAM,aAAa;AACnB,8BAAkB;AAClB,yBAAa;AAAA,UACjB;AACA,4BAAkB;AAAA,QACtB;AAEA,iBAAS,cAAoB;AAvgBlC;AAwgBS,yBAAS,YAAT,mBAAkB,iBAAiB,SAAS,WAAS;AACjD,kBAAM,SAAS,MAAM;AACrB,gBAAI,CAAC,QAAQ;AACT;AAAA,YACJ;AACA,kBAAM,OAAO,OAAO,QAAqB,oBAAoB;AAC7D,gBAAI,CAAC,MAAM;AACP;AAAA,YACJ;AACA,kBAAM,WAAW,KAAK,aAAa,kBAAkB;AACrD,kBAAM,QAAQ,WAAW,OAAO,QAAQ,IAAI;AAC5C,gBAAI,OAAO,MAAM,KAAK,KAAK,QAAQ,GAAG;AAClC;AAAA,YACJ;AACA,uBAAW,KAAK;AAAA,UACpB;AAAA,QACJ;AAEA,iBAAS,aAAmB;AA1hBjC;AA2hBS,yBAAS,gBAAT,mBAAsB,iBAAiB,SAAS;AAChD,yBAAS,YAAT,mBAAkB,iBAAiB,SAAS,WAAS;AACjD,gBAAI,MAAM,WAAW,SAAS,SAAS;AACnC,0BAAY;AAAA,YAChB;AAAA,UACJ;AACA,yBAAS,eAAT,mBAAqB,iBAAiB,SAAS,MAAM,cAAc,EAAE;AACrE,yBAAS,eAAT,mBAAqB,iBAAiB,SAAS,MAAM,cAAc,CAAC;AACpE,yBAAS,mBAAT,mBAAyB,iBAAiB,SAAS;AACnD,mBAAS,iBAAiB,WAAW,mBAAmB;AACxD,yBAAS,eAAT,mBAAqB,iBAAiB,SAAS,MAAM;AACjD,iBAAK,YAAY,EAAE,SAAS,KAAK,CAAC;AAAA,UACtC;AACA,cAAI,SAAS,OAAO;AAChB,qBAAS,MAAM,iBAAiB,QAAQ,iBAAiB;AACzD,qBAAS,MAAM,iBAAiB,SAAS,gBAAgB;AAAA,UAC7D;AAAA,QACJ;AAEA,iBAAS,oBAA0B;AAC/B,2BAAiB,KAAK;AACtB,cAAI,CAAC,SAAS,OAAO;AACjB;AAAA,UACJ;AACA,cAAI,MAAM,gBAAgB;AACtB,kBAAM,QAAQ,SAAS,MAAM;AAC7B,kBAAM,SAAS,SAAS,MAAM;AAC9B,kBAAM,cAAc,UAAU,SAAS,WAAW,QAAQ,SAAS,cAAc;AACjF,gBAAI,MAAM,iBAAiB,MAAM,cAAc,OAAO,MAAM,gBAAgB;AACxE,oBAAM,cAAc,QAAQ;AAC5B,oBAAM,cAAc,SAAS;AAC7B,oBAAM,cAAc,cAAc;AAAA,YACtC;AACD,gBAAI,MAAM,gBAAgB;AACtB,oBAAM,UAAU,sBAAsB;AACtC,kBAAI,SAAS;AACT,qCAAqB,OAAO;AAAA,cAChC;AAAA,YACJ;AAAA,UACH;AACA,gBAAM,iBAAiB;AAAA,QAC3B;AAED,iBAAS,mBAAyB;AAC9B,2BAAiB,KAAK;AACtB,cAAI,SAAS,YAAY;AACrB,qBAAS,WAAW,cAAcA;AAAA,cAC9B;AAAA,cACA;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ;AAEC,uBAAe,YAAY,UAAiC,CAAC,GAAkB;AAC3E,cAAI,MAAM,WAAW;AACjB;AAAA,UACJ;AACA,mBAAS,KAAK;AACd,qBAAW,IAAI;AACf,cAAI;AACD,kBAAM,kBAAkB,QAAQ,WAAW,MAAM,OAAO,WAAW;AACnE,kBAAM,OAAO,kBAAkB,cAAc,IAAI,MAAM;AACtD,kBAAM,QAAQ;AACd,kBAAM,WAAW,MAAM,MAAM,sCAAsC,IAAI,UAAU,KAAK,EAAE;AACxF,gBAAI,CAAC,SAAS,IAAI;AACd,oBAAM,IAAI,MAAM,uBAAuB;AAAA,YAC3C;AACA,kBAAM,OAAQ,MAAM,SAAS,KAAK;AAClC,kBAAM,SAAS,KAAK,IAAI,YAAY;AACpC,kBAAM,SAAS;AACf,kBAAM,cAAc;AACpB,kBAAM,UAAU,MAAM;AACtB,kBAAM,gBAAgB;AACtB,kBAAM,oBAAoB,2BAA2B,MAAM;AAC3D,yBAAa;AACb,gCAAoB;AAAA,UACxB,SAAS,OAAO;AACb,oBAAQ,KAAK,8BAA8B,KAAK;AAC/C,qBAAS,IAAI;AAAA,UACjB,UAAE;AACE,uBAAW,KAAK;AAAA,UACpB;AAAA,QACJ;AAEA,iBAAS,aAAa,MAAsB,OAAiC;AACzE,gBAAM,QAAQ,OAAO,KAAK,KAAK,KAAK;AACpC,gBAAM,SAAS,OAAO,KAAK,MAAM,KAAK;AACtC,gBAAM,cAA2B,UAAU,SAAS,WAAW,QAAQ,SAAS,cAAc;AAC9F,gBAAM,YAAY,OAAO,SAAS,KAAK,IAAI,EAAE;AAC7C,gBAAM,WAAW,OAAO,SAAS,SAAS,IAAI,YAAY;AAC1D,gBAAM,OAAO,QAAS,WAAW,KAAM;AACxC,gBAAM,kBACF,KAAK,UAAU,KAAK,OAAO,KAAK,EAAE,SAAS,IACrC,KAAK,OAAO,KAAK,IACjBA,GAAE,qCAAqC,sBAAsB;AACtE,gBAAM,KAAK,OAAO,KAAK,EAAE;AACzB,iBAAO;AAAA,YACH;AAAA,YACA,QAAQ;AAAA,YACR;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA,KAAK,KAAK;AAAA,YACV,aAAa,KAAK;AAAA,YAClB,UAAU,4BAA4B,EAAE;AAAA,YACxC,UAAU,4BAA4B,EAAE;AAAA,UAC5C;AAAA,QACJ;AAEA,iBAAS,2BAA2B,QAAyD;AACzF,iBAAO,OAAO;AAAA,YACV,CAAC,KAAK,UAAU;AACZ,kBAAI,MAAM,WAAW,KAAK;AAC1B,qBAAO;AAAA,YACX;AAAA,YACA,EAAE,WAAW,GAAG,UAAU,GAAG,QAAQ,EAAE;AAAA,UAC3C;AAAA,QACJ;AAEA,iBAAS,eAAqB;AAC1B,gBAAM,SAAS,MAAM,WAAW,KAAK,EAAE,YAAY;AACnD,gBAAM,mBAAmB,MAAM,iBAAiB,MAAM,gBAAgB;AACtE,gBAAM,WAAW,MAAM,OAAO,OAAO,WAAS;AAC1C,gBAAI,MAAM,iBAAiB,eAAe,CAAC,MAAM,UAAU,IAAI,MAAM,EAAE,GAAG;AACtE,qBAAO;AAAA,YACX;AACA,gBAAI,MAAM,iBAAiB,eAAe,MAAM,gBAAgB,aAAa;AACzE,qBAAO;AAAA,YACX;AACA,gBAAI,MAAM,iBAAiB,cAAc,MAAM,gBAAgB,YAAY;AACvE,qBAAO;AAAA,YACX;AACA,gBAAI,MAAM,iBAAiB,YAAY,MAAM,gBAAgB,UAAU;AACnE,qBAAO;AAAA,YACX;AACA,gBAAI,UAAU,CAAC,MAAM,OAAO,YAAY,EAAE,SAAS,MAAM,GAAG;AACxD,qBAAO;AAAA,YACX;AACA,mBAAO;AAAA,UACX,CAAC;AACD,gBAAM,iBAAiB;AACvB,gBAAM,mBAAmB,IAAI,IAAI,SAAS,IAAI,CAAC,OAAO,UAAU,CAAC,MAAM,IAAI,KAAK,CAAC,CAAC;AAClF,wBAAc;AACd,2BAAiB;AACjB,2BAAiB;AACjB,8BAAoB;AACpB,cAAI,kBAAkB;AAClB,kBAAM,WAAW,MAAM,iBAAiB,IAAI,gBAAgB;AAC5D,gBAAI,OAAO,aAAa,UAAU;AAC9B,oBAAM,gBAAgB;AACtB,sCAAwB;AACxB,4BAAc;AACd,4BAAc,gBAAgB;AAAA,YAClC,WAAW,CAAC,MAAM,eAAe;AAC7B,0BAAY;AAAA,YAChB;AAAA,UACJ;AAAA,QACJ;AAEA,iBAAS,gBAAsB;AAC3B,cAAI,CAAC,SAAS,SAAS;AACnB;AAAA,UACJ;AACA,mBAAS,QAAQ,YAAY;AAC7B,cAAI,CAAC,MAAM,eAAe,QAAQ;AAC9B;AAAA,UACJ;AACA,gBAAM,SAAS,YAAY,MAAM,gBAAgB,MAAM,aAAa;AACpE,iBAAO,QAAQ,WAAS;AApsBjC;AAqsBa,kBAAM,UAAU,SAAS,cAAc,SAAS;AAChD,oBAAQ,YAAY;AAEpB,kBAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,oBAAQ,YAAY;AACrB,kBAAM,QAAQ,SAAS,cAAc,IAAI;AACzC,kBAAM,YAAY;AAClB,kBAAM,cAAc,MAAM;AAC1B,kBAAM,QAAQ,SAAS,cAAc,MAAM;AAC3C,kBAAM,YAAY;AAClB,kBAAM,WACF,MAAM,OAAO,WAAW,IAAI,gCAAgC;AAChE,kBAAM,aAAaA,GAAE,UAAU,MAAM,OAAO,WAAW,IAAI,UAAU,QAAQ;AAC7E,kBAAM,cAAc,GAAG,MAAM,OAAO,MAAM,IAAI,UAAU;AACxD,oBAAQ,OAAO,OAAO,KAAK;AAC3B,oBAAQ,OAAO,OAAO;AAEtB,kBAAM,OAAO,SAAS,cAAc,KAAK;AACzC,iBAAK,YAAY;AAEhB,kBAAM,OAAO,QAAQ,WAAS;AAztB3C,kBAAAG;AA0tBiB,oBAAM,SAAQA,MAAA,MAAM,iBAAiB,IAAI,MAAM,EAAE,MAAnC,OAAAA,MAAwC;AACtD,oBAAM,OAAO,SAAS,cAAc,QAAQ;AAC5C,mBAAK,OAAO;AACZ,mBAAK,YAAY;AACjB,mBAAK,QAAQ,UAAU,MAAM;AAC7B,mBAAK,QAAQ,aAAa,OAAO,KAAK;AACtC,kBAAI,MAAM,UAAU,IAAI,MAAM,EAAE,GAAG;AAC/B,qBAAK,QAAQ,WAAW;AAAA,cAC5B;AACD,kBAAI,MAAM,kBAAkB,MAAM,MAAM,MAAM,gBAAgB;AAC1D,qBAAK,QAAQ,WAAW;AAAA,cAC5B;AAEA,oBAAM,QAAQ,SAAS,cAAc,KAAK;AAC1C,oBAAM,MAAM,MAAM;AAClB,oBAAM,MAAMH,GAAE,sBAAsB,qBAAqB,EAAE,QAAQ,MAAM,OAAO,CAAC;AACjF,oBAAM,UAAU;AAChB,oBAAM,YAAY;AAEjB,oBAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,sBAAQ,YAAY;AACpB,oBAAM,SAAS,SAAS,cAAc,GAAG;AACzC,qBAAO,YAAY;AACnB,qBAAO,cAAc,MAAM;AAC3B,oBAAM,OAAO,SAAS,cAAc,GAAG;AACvC,mBAAK,YAAY;AACjB,mBAAK,cAAc,GAAG,MAAM,IAAI,mBAAQ,kBAAkB,MAAM,WAAW,CAAC;AAC5E,sBAAQ,OAAO,QAAQ,IAAI;AAE3B,mBAAK,OAAO,OAAO,OAAO;AAC1B,mBAAK,OAAO,IAAI;AAAA,YACpB,CAAC;AAED,oBAAQ,OAAO,IAAI;AACnB,2BAAS,YAAT,mBAAkB,OAAO;AAAA,UAC7B,CAAC;AAAA,QACL;AAEA,iBAAS,YAAY,QAA4B,SAAoC;AAClF,cAAI,YAAY,eAAe;AAC3B,kBAAM,eAA2D;AAAA,cAC7D,EAAE,OAAOA,GAAE,gCAAgC,YAAY,GAAG,KAAK,YAAY;AAAA,cAC3E,EAAE,OAAOA,GAAE,+BAA+B,WAAW,GAAG,KAAK,WAAW;AAAA,cACxE,EAAE,OAAOA,GAAE,6BAA6B,SAAS,GAAG,KAAK,SAAS;AAAA,YACtE;AACA,mBAAO,aACF,IAAI,WAAS,EAAE,OAAO,KAAK,OAAO,QAAQ,OAAO,OAAO,WAAS,MAAM,gBAAgB,KAAK,GAAG,EAAE,EAAE,EACnG,OAAO,WAAS,MAAM,OAAO,SAAS,CAAC;AAAA,UAChD;AACC,cAAI,YAAY,SAAS;AACrB,kBAAM,SAAS,oBAAI,IAAgC;AACnD,mBAAO,QAAQ,WAAS;AA7wBrC;AA8wBiB,oBAAM,cAAa,YAAO,IAAI,MAAM,IAAI,MAArB,YAA0B,CAAC;AAC9C,yBAAW,KAAK,KAAK;AACrB,qBAAO,IAAI,MAAM,MAAM,UAAU;AAAA,YACrC,CAAC;AACD,mBAAO,MAAM,KAAK,OAAO,QAAQ,CAAC,EAC7B,KAAK,CAAC,GAAG,MAAM,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,EAC1B,IAAI,CAAC,CAAC,MAAM,KAAK,OAAO,EAAE,OAAO,OAAO,IAAI,GAAG,QAAQ,MAAM,EAAE;AAAA,UACxE;AAEA,gBAAM,WAAW,oBAAI,IAAgC;AACrD,iBAAO,QAAQ,WAAS;AAxxBjC;AAyxBa,kBAAM,MAAM,MAAM;AAClB,kBAAM,cAAa,cAAS,IAAI,GAAG,MAAhB,YAAqB,CAAC;AACzC,uBAAW,KAAK,KAAK;AACrB,qBAAS,IAAI,KAAK,UAAU;AAAA,UAChC,CAAC;AACD,iBAAO,MAAM,KAAK,SAAS,QAAQ,CAAC,EAC/B,KAAK,CAAC,GAAG,MAAM;AACZ,kBAAM,UAAU,KAAK,IAAI,GAAG,EAAE,CAAC,EAAE,IAAI,UAAQ,KAAK,IAAI,CAAC;AACvD,kBAAM,UAAU,KAAK,IAAI,GAAG,EAAE,CAAC,EAAE,IAAI,UAAQ,KAAK,IAAI,CAAC;AACvD,mBAAO,UAAU;AAAA,UACrB,CAAC,EACA,IAAI,CAAC,CAAC,QAAQ,KAAK,OAAO,EAAE,OAAO,QAAQ,QAAQ,MAAM,EAAE;AAAA,QACpE;AAED,iBAAS,kBAAkB,aAA8C;AACrE,cAAI,gBAAgB,YAAY;AAC5B,mBAAOA,GAAE,gCAAgC,UAAU;AAAA,UACvD;AACA,cAAI,gBAAgB,UAAU;AAC1B,mBAAOA,GAAE,8BAA8B,QAAQ;AAAA,UACnD;AACA,iBAAOA,GAAE,iCAAiC,WAAW;AAAA,QACzD;AAEC,iBAAS,cAAc,SAAuB;AAC1C,cAAI,CAAC,SAAS,SAAS;AACnB;AAAA,UACJ;AACA,gBAAM,UAAU,SAAS,QAAQ,cAA2B,oCAAoC;AAChG,cAAI,SAAS;AACT,oBAAQ,gBAAgB,eAAe;AAAA,UAC3C;AACA,gBAAM,OAAO,SAAS,QAAQ,cAA2B,+BAA+B,OAAO,IAAI;AACnG,cAAI,MAAM;AACN,iBAAK,QAAQ,WAAW;AAAA,UAC5B;AAAA,QACJ;AAEA,iBAAS,kBAAwB;AAC7B,cAAI,CAAC,SAAS,SAAS;AACnB;AAAA,UACJ;AACA,gBAAM,UAAU,SAAS,QAAQ,cAA2B,oCAAoC;AAChG,6CAAS,gBAAgB;AAAA,QAC7B;AAEA,iBAAS,mBAAyB;AAv0BvC;AAw0BS,gBAAM,aAAa,MAAM,eAAe,WAAW;AACnD,yBAAS,UAAT,mBAAgB,UAAU,OAAO,UAAU,CAAC;AAAA,QAChD;AAEA,iBAAS,mBAAyB;AAC/B,gBAAM,QAAQ,MAAM,eAAe;AACnC,gBAAM,WAAW,UAAU,IAAI,gCAAgC;AAC/D,gBAAM,QAAQA,GAAE,UAAU,UAAU,IAAI,UAAU,QAAQ;AAC1D,gBAAM,aACF,MAAM,kBAAkB,gBAClB,gCACA,MAAM,kBAAkB,UACxB,0BACA;AACV,gBAAM,kBACF,MAAM,kBAAkB,gBAClB,gBACA,MAAM,kBAAkB,UACxB,UACA;AACV,gBAAM,eAAeA,GAAE,YAAY,eAAe;AAClD,gBAAM,aAAaA;AAAA,YACf;AAAA,YACA,GAAG,KAAK,IAAI,KAAK,mBAAQ,YAAY;AAAA,YACrC,EAAE,OAAO,OAAO,OAAO,SAAS,aAAa;AAAA,UACjD;AAGA,cAAI,SAAS,aAAa,aAAa,cAAc;AACjD,yBAAa,aAAa,gBAAgB,SAAS,WAAW,QAAQ,UAAU;AAAA,UACpF;AAGA,cAAI,SAAS,YAAY;AACrB,qBAAS,WAAW,cAAc;AAAA,UACtC;AAAA,QACH;AAEA,iBAAS,sBAA4B;AACjC,cAAI,SAAS,UAAU;AACnB,qBAAS,SAAS,cAAc,OAAO,MAAM,OAAO,MAAM;AAAA,UAC9D;AACA,cAAI,SAAS,gBAAgB;AACzB,qBAAS,eAAe,cAAc,OAAO,MAAM,UAAU,IAAI;AAAA,UACrE;AACA,cAAI,SAAS,gBAAgB;AACzB,qBAAS,eAAe,cAAc,OAAO,MAAM,kBAAkB,SAAS;AAAA,UAClF;AACA,cAAI,SAAS,eAAe;AACxB,qBAAS,cAAc,cAAc,OAAO,MAAM,kBAAkB,QAAQ;AAAA,UAChF;AACA,cAAI,SAAS,aAAa;AACtB,qBAAS,YAAY,cAAc,OAAO,MAAM,kBAAkB,MAAM;AAAA,UAC5E;AAAA,QACJ;AAEA,iBAAS,uBAA6B;AAClC,mBAAS,eAAe,QAAQ,YAAU;AACtC,kBAAM,SAAS,OAAO,aAAa,oBAAoB;AACvD,mBAAO,QAAQ,SAAS,WAAW,MAAM,eAAe,SAAS;AAAA,UACrE,CAAC;AAAA,QACL;AAEA,iBAAS,uBAA6B;AAClC,mBAAS,eAAe,QAAQ,YAAU;AACtC,kBAAM,UAAU,OAAO,aAAa,qBAAqB;AACzD,mBAAO,QAAQ,SAAS,YAAY,MAAM,gBAAgB,SAAS;AAAA,UACvE,CAAC;AAAA,QACL;AAEA,iBAAS,oBAA0B;AAC/B,cAAI,CAAC,SAAS,aAAa;AACvB;AAAA,UACJ;AACA,gBAAM,WAAW,QAAQ,MAAM,WAAW,KAAK,CAAC;AAChD,mBAAS,YAAY,UAAU,OAAO,aAAa,CAAC,QAAQ;AAC5D,mBAAS,YAAY,UAAU,OAAO,uBAAuB,CAAC,QAAQ;AAAA,QAC1E;AAEA,iBAAS,WAAW,WAA0B;AAv5BnD;AAw5BS,gBAAM,YAAY;AAClB,yBAAS,YAAT,mBAAkB,UAAU,OAAO,UAAU,CAAC;AAAA,QAClD;AAEA,iBAAS,SAAS,UAAyB;AA55BhD;AA65BS,yBAAS,UAAT,mBAAgB,UAAU,OAAO,UAAU,CAAC;AAAA,QAChD;AAEA,iBAAS,WAAW,OAAe,UAA6D,CAAC,GAAS;AACtG,gBAAM,UAAU,SAAS;AACzB,cAAI,CAAC,WAAW,CAAC,SAAS,OAAO;AAC7B;AAAA,UACJ;AACA,cAAI,QAA6B;AACjC,cAAI,QAAQ,YAAY,QAAQ,OAAO;AACnC,oBAAQ,QAAQ;AAChB,kBAAM,gBAAgB,QAAQ;AAC9B,kBAAM,gBAAgB;AACtB,kBAAM,gBAAgB,QAAQ,MAAM;AAAA,UACxC,OAAO;AACH,kBAAM,WAAW,MAAM,eAAe,KAAK;AAC3C,gBAAI,CAAC,UAAU;AACX;AAAA,YACJ;AACA,oBAAQ;AACR,kBAAM,gBAAgB;AACtB,kBAAM,gBAAgB,SAAS;AAC/B,kBAAM,gBAAgB;AAAA,UAC1B;AACA,gBAAM,iBAAiB;AACvB,kBAAQ,UAAU,OAAO,QAAQ;AACjC,kBAAQ,UAAU,IAAI,MAAM;AAC5B,cAAI,CAAC,OAAO;AACR;AAAA,UACJ;AACA,2BAAiB,IAAI;AACrB,gBAAM,iBAAiB,MAAM;AAC7B,cAAI,cAAc,SAAS,MAAM,UAAU;AACvC,qBAAS,MAAM,MAAM,MAAM;AAAA,UAC/B,OAAO;AACH,qBAAS,MAAM,MAAM,MAAM;AAAA,UAC/B;AACA,+BAAqB,KAAK;AAC1B,kCAAwB;AACxB,wBAAc;AACd,cAAI,CAAC,QAAQ,UAAU;AACnB,0BAAc,MAAM,EAAE;AAAA,UAC1B,OAAO;AACH,4BAAgB;AAAA,UACpB;AAAA,QACJ;AAEA,iBAAS,wBAA6C;AA58B3D;AA68BS,cAAI,MAAM,eAAe;AACrB,mBAAO,MAAM;AAAA,UACjB;AACA,cAAI,MAAM,iBAAiB,GAAG;AAC1B,oBAAO,WAAM,eAAe,MAAM,aAAa,MAAxC,YAA6C;AAAA,UACxD;AACA,iBAAO;AAAA,QACX;AAEA,iBAAS,qBAAqB,OAA2B;AAt9B9D;AAu9BQ,cAAI,SAAS,aAAa;AACtB,kBAAM,gBAAgBA,GAAE,8BAA8B,eAAe;AACrE,qBAAS,YAAY,cAAc,MAAM,UAAU;AAAA,UACvD;AACA,cAAI,SAAS,WAAW;AACpB,kBAAM,QAAQ,gBAAgB,KAAK,KAAK,MAAM,aAAa,MAAM,aAAa,MAAM;AACpF,qBAAS,UAAU,cAAc;AAAA,UACrC;AACA,gBAAM,mBAAmB,kBAAkB,MAAM,WAAW;AAC5D,gBAAM,YAAsB,CAAC;AAC7B,cAAI,gBAAgB,KAAK,GAAG;AACxB,sBAAU,KAAKA,GAAE,+BAA+B,gBAAgB,CAAC;AACjE,gBAAI,MAAM,YAAY;AAClB,wBAAU,KAAK,MAAM,UAAU;AAAA,YACnC;AAAA,UACJ,OAAO;AACH,sBAAU,KAAK,OAAO,MAAM,IAAI,CAAC;AACjC,sBAAU,KAAK,gBAAgB;AAAA,UACnC;AACA,cAAI,SAAS,YAAY;AACrB,qBAAS,WAAW,cAAc,UAAU,KAAK,kBAAO;AAAA,UAC5D;AACA,cAAI,SAAS,kBAAkB;AAC3B,gBAAI,MAAM,SAAS,MAAM,QAAQ;AAC7B,uBAAS,iBAAiB,cAAcA;AAAA,gBACpC;AAAA,gBACA,eAAe,MAAM,KAAK,eAAO,MAAM,MAAM;AAAA,gBAC7C,EAAE,OAAO,MAAM,OAAO,QAAQ,MAAM,OAAO;AAAA,cAC/C;AAAA,YACJ,OAAO;AACH,uBAAS,iBAAiB,cAAc;AAAA,YAC5C;AAAA,UACJ;AACA,cAAI,SAAS,YAAY;AACrB,qBAAS,WAAW,QAAO,WAAM,QAAN,YAAa,MAAM;AAAA,UAClD;AACA,cAAI,SAAS,gBAAgB;AACzB,qBAAS,eAAe,OAAO,MAAM;AACrC,qBAAS,eAAe,WAAWA;AAAA,cAC/B;AAAA,cACA,SAAS,MAAM,EAAE;AAAA,cACjB,EAAE,IAAI,MAAM,GAAG;AAAA,YACnB;AAAA,UACJ;AACA,+BAAqB,KAAK;AAAA,QAC9B;AAEA,iBAAS,qBAAqB,OAA2B;AACrD,cAAI,CAAC,SAAS,kBAAkB,CAAC,SAAS,uBAAuB,CAAC,SAAS,oBAAoB;AAC3F;AAAA,UACJ;AACA,cAAI,gBAAgB,KAAK,GAAG;AACxB,qBAAS,eAAe,aAAa,YAAY,MAAM;AACvD,qBAAS,eAAe,UAAU,IAAI,cAAc,qBAAqB;AACzE,qBAAS,oBAAoB,cAAcA;AAAA,cACvC;AAAA,cACA;AAAA,YACJ;AACA,qBAAS,mBAAmB,cAAc;AAC1C;AAAA,UACJ;AACA,gBAAM,aAAa,MAAM,UAAU,IAAI,MAAM,EAAE;AAC/C,mBAAS,eAAe,gBAAgB,UAAU;AAClD,mBAAS,eAAe,UAAU,OAAO,cAAc,qBAAqB;AAC5E,gBAAM,cAAcA,GAAE,gCAAgC,iBAAiB;AACvE,gBAAM,WAAWA,GAAE,6BAA6B,kBAAkB;AAClE,mBAAS,oBAAoB,cAAc,aAAa,cAAc;AACtE,mBAAS,mBAAmB,cAAc,aAAa,mBAAQ;AAAA,QACnE;AAEC,iBAAS,cAAoB;AACzB,cAAI,CAAC,SAAS,SAAS;AACnB;AAAA,UACJ;AACA,mBAAS,QAAQ,UAAU,IAAI,QAAQ;AACvC,mBAAS,QAAQ,UAAU,OAAO,MAAM;AACxC,gBAAM,iBAAiB;AACvB,gBAAM,gBAAgB;AACtB,gBAAM,gBAAgB;AACtB,gBAAM,gBAAgB;AACtB,gBAAM,iBAAiB;AACvB,0BAAgB;AAChB,2BAAiB,KAAK;AAAA,QAC1B;AAEA,iBAAS,cAAc,OAAqB;AACxC,cAAI,MAAM,eAAe;AACrB;AAAA,UACJ;AACA,gBAAM,YAAY,MAAM,gBAAgB;AACxC,cAAI,YAAY,KAAK,aAAa,MAAM,eAAe,QAAQ;AAC3D;AAAA,UACJ;AACA,qBAAW,SAAS;AAAA,QACxB;AAEA,iBAAS,iBAAuB;AAC5B,cAAI,MAAM,eAAe;AACrB;AAAA,UACJ;AACA,gBAAM,QAAQ,MAAM,eAAe,MAAM,aAAa;AACtD,cAAI,CAAC,OAAO;AACR;AAAA,UACJ;AACA,cAAI,MAAM,UAAU,IAAI,MAAM,EAAE,GAAG;AAC/B,kBAAM,UAAU,OAAO,MAAM,EAAE;AAAA,UACnC,OAAO;AACH,kBAAM,UAAU,IAAI,MAAM,EAAE;AAAA,UAChC;AACA,+BAAqB,KAAK;AAC1B,8BAAoB;AACpB,kCAAwB,MAAM,EAAE;AAAA,QACpC;AAEA,iBAAS,wBAAwB,SAAuB;AACpD,cAAI,CAAC,SAAS,SAAS;AACnB;AAAA,UACJ;AACA,gBAAM,OAAO,SAAS,QAAQ,cAA2B,+BAA+B,OAAO,IAAI;AACnG,cAAI,CAAC,MAAM;AACP;AAAA,UACJ;AACA,cAAI,MAAM,UAAU,IAAI,OAAO,GAAG;AAC9B,iBAAK,QAAQ,WAAW;AAAA,UAC5B,OAAO;AACH,iBAAK,gBAAgB,eAAe;AAAA,UACxC;AAAA,QACJ;AAEA,iBAAS,0BAAgC;AACrC,gBAAM,UAAU,MAAM,gBAAgB,KAAK,CAAC,MAAM;AAClD,gBAAM,UACF,MAAM,iBAAiB,KACvB,MAAM,gBAAgB,MAAM,eAAe,SAAS,KACpD,CAAC,MAAM;AACX,cAAI,SAAS,YAAY;AACrB,qBAAS,WAAW,UAAU,OAAO,cAAc,CAAC,OAAO;AAC3D,qBAAS,WAAW,UAAU,OAAO,uBAAuB,CAAC,OAAO;AAAA,UACxE;AACA,cAAI,SAAS,YAAY;AACrB,qBAAS,WAAW,UAAU,OAAO,cAAc,CAAC,OAAO;AAC3D,qBAAS,WAAW,UAAU,OAAO,uBAAuB,CAAC,OAAO;AAAA,UACxE;AAAA,QACJ;AAEA,iBAAS,gBAAsB;AAC5B,cAAI,CAAC,SAAS,eAAe;AACzB;AAAA,UACJ;AACA,cAAI,MAAM,eAAe;AACrB,qBAAS,cAAc,cAAcA,GAAE,iCAAiC,gBAAgB;AACxF;AAAA,UACJ;AACA,cAAI,MAAM,iBAAiB,GAAG;AAC1B,qBAAS,cAAc,cAAcA;AAAA,cACjC;AAAA,cACA,GAAG,MAAM,gBAAgB,CAAC,OAAO,MAAM,eAAe,MAAM;AAAA,cAC5D,EAAE,OAAO,MAAM,gBAAgB,GAAG,OAAO,MAAM,eAAe,OAAO;AAAA,YACzE;AAAA,UACJ,OAAO;AACH,qBAAS,cAAc,cAAc;AAAA,UACzC;AAAA,QACJ;AAEC,iBAAS,iBAAiB,WAA0B;AA3nCzD;AA4nCS,yBAAS,WAAT,mBAAiB,UAAU,OAAO,UAAU,CAAC;AAAA,QACjD;AAED,iBAAS,oBAAoB,OAA4B;AACrD,cAAI,CAAC,MAAM,gBAAgB;AACvB;AAAA,UACJ;AACA,cAAI,MAAM,QAAQ,UAAU;AACxB,wBAAY;AAAA,UAChB,WAAW,MAAM,QAAQ,aAAa;AAClC,0BAAc,EAAE;AAAA,UACpB,WAAW,MAAM,QAAQ,cAAc;AACnC,0BAAc,CAAC;AAAA,UACnB;AAAA,QACJ;AAEC,iBAAS,gBAAwB;AAC7B,iBAAO,KAAK,MAAM,KAAK,OAAO,IAAI,EAAE,IAAI;AAAA,QAC5C;AAED,iBAAS,kBAAkB,SAA+C;AACtE,cAAI,CAAC,WAAW,CAAC,QAAQ,KAAK;AAC1B;AAAA,UACJ;AACA,cAAI,CAAC,MAAM,aAAa;AACpB,iBAAK;AAAA,UACT;AACA,gBAAM,OACF,QAAQ,QAAQ,QAAQ,KAAK,KAAK,EAAE,SAAS,IACvC,QAAQ,KAAK,KAAK,IAClBA,GAAE,8BAA8B,eAAe;AACzD,gBAAM,gBAAmC;AAAA,YACrC,IAAI,YAAY,KAAK,IAAI,CAAC;AAAA,YAC1B,QAAQ;AAAA,YACR,aAAa,QAAQ;AAAA,YACrB,UAAU,QAAQ;AAAA,YAClB,KAAK,QAAQ;AAAA,YACb,YAAY;AAAA,YACZ,YAAY;AAAA,UAChB;AACA,qBAAW,IAAI,EAAE,UAAU,MAAM,OAAO,cAAc,CAAC;AAAA,QAC3D;AAEA,iBAAS,uBAA6B;AAvqC1C;AAwqCQ,cAAI,CAAC,MAAM,aAAa;AACpB;AAAA,UACJ;AACA,wBAAc;AACd,2BAAiB;AACjB,2BAAiB;AACjB,cAAI,MAAM,gBAAgB;AACtB,kBAAM,UAAU,sBAAsB;AACtC,gBAAI,SAAS;AACT,mCAAqB,OAAO;AAAA,YAChC;AACA,oCAAwB;AACxB,0BAAc;AAAA,UAClB,OAAO;AACH,0BAAc;AAAA,UAClB;AACA,mCAAa,YAAb,mBAAsB,sBAAtB,6BAA0C,cAAS,cAAT,YAAsB;AAAA,QACpE;AAEA,cAAM,MAAoB;AAAA,UACtB;AAAA,UACA;AAAA,QACJ;AAEA,qBAAa,YAAY;AAEzB,eAAO,iBAAiB,4BAA4B,oBAAoB;AAAA,MAQ3E,GAAG;AAAA;AAAA;;;AC1sCJ,MA2Ba;AA3Bb;AAAA;AAAA;AA2BO,MAAM,uBAA8C;AAAA,QACvD;AAAA,UACI,IAAI;AAAA,UACJ,MAAM;AAAA,UACN,YAAY;AAAA,UACZ,MAAM;AAAA,UACN,eAAe;AAAA,UACf,UAAU;AAAA;AAAA;AAAA,YAGN,sBAAsB;AAAA,YACtB,mBAAmB;AAAA,YACnB,aAAa,WAAY;AAvCrC;AAyCgB,kBAAI,OAAO,mBAAmB,GAAE,YAAe,oBAAf,mBAAgC,YAAW;AACvE,sBAAM,YAAY,SAAS,eAAe,qBAAqB;AAC/D,oBAAI,UAAW,QAAO,gBAAgB,KAAK,SAAS;AAAA,cACxD;AAEA,mBAAI,YAAO,oBAAP,mBAAwB,QAAS,QAAO,gBAAgB,QAAQ;AAAA,YACxE;AAAA,UACJ;AAAA,QACJ;AAAA,QACA;AAAA,UACI,IAAI;AAAA,UACJ,MAAM;AAAA,UACN,YAAY;AAAA,UACZ,MAAM;AAAA,UACN,eAAe;AAAA,QACnB;AAAA,QACA;AAAA,UACI,IAAI;AAAA,UACJ,MAAM;AAAA,UACN,YAAY;AAAA,UACZ,MAAM;AAAA,UACN,eAAe;AAAA,QACnB;AAAA,QACA;AAAA,UACI,IAAI;AAAA,UACJ,MAAM;AAAA,UACN,YAAY;AAAA,UACZ,MAAM;AAAA,UACN,eAAe;AAAA,UACf,UAAU;AAAA,YACN,aAAa,WAAY;AAvErC;AAwEgB,kBAAI,OAAO,kBAAkB,GAAE,YAAe,mBAAf,mBAA+B,YAAW;AACrE,sBAAM,YAAY,SAAS,eAAe,oBAAoB;AAC9D,oBAAI,UAAW,QAAO,eAAe,KAAK,SAAS;AAAA,cACvD;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ;AAAA,QACA;AAAA,UACI,IAAI;AAAA,UACJ,MAAM;AAAA,UACN,YAAY;AAAA,UACZ,MAAM;AAAA,UACN,eAAe;AAAA,UACf,UAAU;AAAA,YACN,aAAa,WAAY;AAtFrC;AAwFgB,kBACI,OAAO,6BACP,CAAC,OAAO,0BAA0B,aAAa,GACjD;AACE,uBAAO,0BAA0B,eAAe;AAAA,kBAC5C,OAAO;AAAA,gBACX,CAAC;AAAA,cACL,WAGI,CAAC,OAAO,6BACR,OAAO,oBACP,GAAE,YAAe,qBAAf,mBAAiC,YACrC;AACE,sBAAM,YAAY,SAAS,eAAe,uBAAuB;AACjE,oBAAI,UAAW,QAAO,iBAAiB,KAAK,SAAS;AAAA,cACzD;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ;AAAA,QACA;AAAA,UACI,IAAI;AAAA,UACJ,MAAM;AAAA,UACN,YAAY;AAAA,UACZ,MAAM;AAAA,UACN,eAAe;AAAA,UACf,UAAU;AAAA,YACN,aAAa,WAAY;AAnHrC;AAoHgB,mBAAI,YAAO,cAAP,mBAAkB,KAAM,QAAO,UAAU,KAAK;AAAA,YACtD;AAAA,UACJ;AAAA,QACJ;AAAA,QACA;AAAA,UACI,IAAI;AAAA,UACJ,MAAM;AAAA,UACN,YAAY;AAAA,UACZ,MAAM;AAAA,UACN,eAAe;AAAA,QACnB;AAAA,QACA;AAAA,UACI,IAAI;AAAA,UACJ,MAAM;AAAA,UACN,YAAY;AAAA,UACZ,MAAM;AAAA,UACN,eAAe;AAAA,UACf,UAAU;AAAA,YACN,aAAa,WAAY;AAtIrC;AAwIgB,kBACI,OAAO,2BACP,CAAC,OAAO,wBAAwB,aAAa,GAC/C;AACE,uBAAO,wBAAwB,eAAe;AAAA,kBAC1C,OAAO;AAAA,gBACX,CAAC;AAAA,cACL,WAGI,CAAC,OAAO,2BACR,OAAO,kBACP,GAAE,YAAe,mBAAf,mBAA+B,YACnC;AACE,sBAAM,YAAY,SAAS,eAAe,oBAAoB;AAC9D,oBAAI,UAAW,QAAO,eAAe,KAAK,SAAS;AAAA,cACvD;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ;AAGA,UAAI,OAAO,eAAe;AACtB,eAAO,cAAc,YAAY,oBAAoB;AACrD,gBAAQ,IAAI,8BAA8B,qBAAqB,MAAM,UAAU;AAAA,MACnF,OAAO;AAEH,iBAAS,iBAAiB,oBAAoB,MAAM;AAChD,cAAI,OAAO,eAAe;AACtB,mBAAO,cAAc,YAAY,oBAAoB;AACrD,oBAAQ;AAAA,cACJ,8BAA8B,qBAAqB,MAAM;AAAA,YAC7D;AAAA,UACJ;AAAA,QACJ,CAAC;AAAA,MACL;AAGA,aAAO,uBAAuB;AAAA;AAAA;;;AC/K9B;AAAA;AAAA;AAAA;AAAA;;;ACAA;AAAA;AAAA;AAOA;AAFA,cAAQ,IAAI,uBAAuB;AAInC,OAAC,MAAM;AACH;AAIA,YAAI,YAAgC;AACpC,YAAI,cAAuC;AAC3C,YAAI,WAA+B;AACnC,YAAI,UAAsB,CAAC;AAC3B,YAAI,eAA2B,CAAC;AAIhC,iBAAS,KAAK,kBAAqC;AAC/C,cAAI,CAAC,kBAAkB;AACnB,oBAAQ,KAAK,gDAAgD;AAC7D;AAAA,UACJ;AACA,cAAI,WAAW;AACX,oBAAQ,KAAK,sCAAsC;AACnD;AAAA,UACJ;AACA,sBAAY;AACZ,iBAAO;AACP,mBAAS;AAAA,QACb;AAEA,iBAAS,SAAe;AACpB,cAAI,CAAC,UAAW;AAChB,oBAAU,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uCAMS,UAAU,oCAAoC,KAAK,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQ/F,wBAAc,UAAU,cAAgC,yBAAyB;AACjF,qBAAW,UAAU,cAA2B,sBAAsB;AACtE,cAAI,YAAa,aAAY,iBAAiB,SAAS,YAAY;AAAA,QACvE;AAEA,iBAAS,WAAiB;AACtB,gBAAM,KAAM,OAAe;AAC3B,cAAI,CAAC,IAAI;AACL,oBAAQ,KAAK,8CAA8C;AAC3D;AAAA,UACJ;AACA,gBAAM,YAAsB,GAAG,gBAAgB;AAC/C,oBAAU,CAAC;AACX,oBAAU,QAAQ,QAAM;AACpB,kBAAM,MAAM,GAAG,UAAU,EAAE;AAC3B,kBAAM,OAAO,GAAG,eAAe,EAAE;AACjC,gBAAI,OAAO,IAAI,SAAS,YAAa;AACrC,gBAAI,OAAO,kBAAmB;AAC9B,gBAAI,MAAM;AACN,sBAAQ,KAAK;AAAA,gBACT;AAAA,gBACA,MAAM,KAAK,gBAAgB,UAAU,wBAAwB,KAAK;AAAA,gBAClE,MAAM,KAAK,QAAQ;AAAA,gBACnB,YAAY,MAAM,IAAI,aAAa;AAAA,cACvC,CAAC;AAAA,YACL;AAAA,UACJ,CAAC;AACD,yBAAe,CAAC,GAAG,OAAO;AAC1B,qBAAW;AAAA,QACf;AAEA,iBAAS,aAAa,GAAgB;AAClC,gBAAM,IAAK,EAAE,OAA4B,MAAM,YAAY,EAAE,KAAK;AAClE,yBAAe,IAAI,QAAQ,OAAO,OAAK,EAAE,KAAK,YAAY,EAAE,SAAS,CAAC,CAAC,IAAI,CAAC,GAAG,OAAO;AACtF,qBAAW;AAAA,QACf;AAEA,iBAAS,aAAmB;AACxB,cAAI,CAAC,SAAU;AACf,mBAAS,YAAY;AACrB,cAAI,aAAa,WAAW,GAAG;AAC3B,qBAAS,YAAY;AAAA;AAAA,yBAER,UAAU,cAAc,KAAK,eAAe;AAAA;AAAA;AAGzD;AAAA,UACJ;AACA,gBAAM,OAAO;AACb,cAAI,CAAC,KAAM;AACX,uBAAa,QAAQ,SAAO;AACxB,kBAAM,MAAM,SAAS,cAAc,QAAQ;AAC3C,gBAAI,YAAY;AAChB,gBAAI,aAAa,kBAAkB,IAAI,EAAE;AACzC,gBAAI,aAAa,eAAe,qBAAqB;AACrD,gBAAI,QAAQ,IAAI;AAEhB,kBAAM,WAAW,SAAS,cAAc,KAAK;AAC7C,qBAAS,YAAY;AACrB,kBAAM,OAAO,IAAI;AACjB,kBAAM,QAAQ,OAAO,SAAS,YAAY,kCAAkC,KAAK,IAAI;AACrF,gBACI,SACC,OAAO,SAAS,aAAa,KAAK,WAAW,IAAI,KAAK,KAAK,WAAW,MAAM,IAC/E;AACE,oBAAM,MAAM,SAAS,cAAc,KAAK;AACxC,kBAAI,MAAM;AACV,kBAAI,MAAM,IAAI;AACd,kBAAI,YAAY;AAChB,uBAAS,YAAY,GAAG;AAAA,YAC5B,WAAW,OAAO,SAAS,YAAY,KAAK,KAAK,EAAE,QAAQ;AACvD,oBAAM,QAAQ,SAAS,cAAc,KAAK;AAC1C,oBAAM,YAAY;AAClB,oBAAM,cAAc;AACpB,uBAAS,YAAY,KAAK;AAAA,YAC9B,OAAO;AACH,oBAAM,WAAW,SAAS,cAAc,KAAK;AAC7C,uBAAS,MAAM;AACf,uBAAS,MAAM,IAAI;AACnB,uBAAS,YAAY;AACrB,uBAAS,YAAY,QAAQ;AAAA,YACjC;AAEA,kBAAM,QAAQ,SAAS,cAAc,MAAM;AAC3C,kBAAM,YAAY;AAClB,kBAAM,cAAc,IAAI;AAExB,gBAAI,YAAY,QAAQ;AACxB,gBAAI,YAAY,KAAK;AACrB,iBAAK,YAAY,GAAG;AAAA,UACxB,CAAC;AAAA,QACL;AAEA,iBAAS,QAAQ,UAAwB;AAjJ7C;AAkJQ,cAAI,CAAC,SAAU;AACf,gBAAM,IAAS;AACf,gBAAM,iBAAiB,SAAS,eAAe,iBAAiB;AAChE,cAAI,kBAAkB,EAAE,WAAW,EAAE,QAAQ,iBAAiB,GAAG;AAC7D,0BAAE,QAAQ,iBAAiB,GAAE,UAA7B;AAAA,UACJ,WAAW,gBAAgB;AACvB,2BAAe,UAAU,IAAI,QAAQ;AAAA,UACzC;AAEA,gBAAM,KAAK,EAAE;AACb,cAAI,yBAAI,MAAM;AACV,eAAG,KAAK,QAAQ;AAChB;AAAA,UACJ;AACA,gBAAM,SAAS,EAAE,WAAW,EAAE,QAAQ,QAAQ;AAC9C,cAAI,iCAAQ,KAAM,QAAO,KAAK;AAAA,eACzB;AACD,kBAAM,eAAe,SAAS,eAAe,QAAQ;AACrD,gBAAI,cAAc;AACd,oBAAM,WAAY,OAAe;AACjC,kBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,yBAAS,KAAK,YAAY;AAAA,cAC9B,OAAO;AACH,6BAAa,UAAU,OAAO,QAAQ;AAAA,cAC1C;AACA,sBAAE,uBAAF,2BAAuB;AACvB,sBAAE,iCAAF;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ;AAEA,iBAAS,UAAgB;AACrB,mBAAS;AAAA,QACb;AAEA,iBAAS,cAAoB;AACzB,cAAI,YAAa,aAAY,QAAQ;AACrC,yBAAe,CAAC,GAAG,OAAO;AAC1B,qBAAW;AAAA,QACf;AAEA,eAAO,iBAAiB,4BAA4B,MAAM;AACtD,cAAI,UAAW,UAAS;AAAA,QAC5B,CAAC;AAGD,cAAM,KAAM,OAAe;AAC3B,YAAI,QAAO,yBAAI,cAAa,YAAY;AACpC,UAAC,GAAW,SAAS,uBAAuB,CAAC,WAAgB;AACzD,kBAAM,MAAK,iCAAQ,cAAY,iCAAQ,cAAY,iCAAQ,YAAU,iCAAQ;AAC7E,gBAAI,GAAI,SAAQ,EAAE;AAAA,UACtB,CAAC;AAAA,QACL;AAEA,QAAC,OAAe,kBAAkB;AAAA,UAC9B;AAAA,UACA;AAAA,UACA;AAAA,UACA,IAAI,YAAY;AACZ,mBAAO;AAAA,UACX;AAAA,QACJ;AAAA,MACJ,GAAG;AAAA;AAAA;;;AChNH;AAAA;AAAA;AAOA;AAEA,OAAC,MAAM;AACH;AAAA,QAgCA,MAAM,yBAAyB;AAAA,UAA/B;AACI,iBAAQ,eAA+C,oBAAI,IAAI;AAC/D,iBAAQ,gBAAgB;AAAA;AAAA,UAExB,OAAO;AACH,gBAAI,KAAK,cAAe;AACxB,gBAAI,SAAS,eAAe,WAAW;AACnC,uBAAS,iBAAiB,oBAAoB,MAAM,KAAK,MAAM,CAAC;AAAA,YACpE,OAAO;AACH,mBAAK,MAAM;AAAA,YACf;AAAA,UACJ;AAAA,UAEQ,QAAQ;AACZ,kBAAM,IAAI;AACV,gBAAI,CAAC,EAAE,mBAAmB,CAAC,EAAE,cAAc,CAAC,EAAE,mBAAmB;AAC7D,sBAAQ,MAAM,4DAA4D;AAC1E;AAAA,YACJ;AAEA,gBAAI,EAAE;AACF,mBAAK,YAAY;AAAA,gBACb,MAAM;AAAA,gBACN,SAAS,EAAE;AAAA,gBACX,SAAS;AAAA,gBACT,YAAY;AAAA,gBACZ,aAAa;AAAA,gBACb,WAAW;AAAA,gBACX,cAAc,aAAQ;AAtE1C;AAuEwB,wCAAa,aAAQ,qBAAR,qCAAgC,QAAQ,gBAAgB,EAAE,UAAU,CAAC;AAAA;AAAA,gBACtF,SAAS,MAAM,KAAK,iBAAiB,gBAAgB;AAAA,cACzD,CAAC;AAEL,gBAAI,EAAE;AACF,mBAAK,YAAY;AAAA,gBACb,MAAM;AAAA,gBACN,SAAS,EAAE;AAAA,gBACX,SAAS;AAAA,gBACT,YAAY;AAAA,gBACZ,aAAa;AAAA,gBACb,WAAW;AAAA,gBACX,cAAc,aAAQ;AAnF1C;AAoFwB,sCAAW,aAAQ,qBAAR,qCAAgC,QAAQ,gBAAgB,EAAE,UAAU,CAAC;AAAA;AAAA,gBACpF,SAAS,MAAM,KAAK,iBAAiB,YAAY;AAAA,cACrD,CAAC;AAEL,gBAAI,EAAE;AACF,mBAAK,YAAY;AAAA,gBACb,MAAM;AAAA,gBACN,SAAS,EAAE;AAAA,gBACX,SAAS;AAAA;AAAA,gBACT,YAAY;AAAA,gBACZ,aAAa;AAAA,gBACb,WAAW;AAAA,gBACX,cAAc,aAAQ;AAhG1C;AAiGwB,sCAAW,aAAQ,qBAAR,qCAAgC,QAAQ,gBAAgB,EAAE,UAAU,CAAC;AAAA;AAAA;AAAA,cAExF,CAAC;AAKL,iBAAK,aAAa,QAAQ,CAACI,cAAa,SAAS;AAxG7D;AAyGgB,oBAAM,EAAE,SAAS,WAAW,IAAIA;AAEhC,kBAAI;AACA,sBAAM,QAAQ;AACd,sBAAM,YACF,QAAO,+BAAO,aAAY,aACpB,MAAM,QAAQ,KAAK,KAAK,IACxB,SAAO,oCAAO,eAAP,mBAAmB,aAAY,aACpC,MAAM,WAAW,QAAQ,KAAK,MAAM,UAAU,IAC9C;AACZ,oBAAI,UAAW,WAAU;AAAA,cAC7B,QAAQ;AAAA,cAAC;AAET,kBAAI;AACA,sBAAM,MAAM,QAAuC,yBAAyB,CAAC,CAAC;AAC9E,sBAAM,UAAS,2BAAM,UAAS;AAC9B,oBAAI,UAAU,OAAQ,QAAgB,sBAAsB,YAAY;AAEpE,wBAAM,SAAS,QAAQ,gBAAgB,EAAE,KAAK,OAAK,EAAE,eAAe,MAAM;AAC1E,sBAAI,OAAQ,CAAC,QAAgB,kBAAkB,MAAM;AAAA,gBACzD;AAAA,cACJ,QAAQ;AAAA,cAAC;AAET,oBAAM,SAAS,QAAQ,kBAAkB;AACzC,kBAAI,OAAQ,MAAK,aAAa,MAAM,OAAO,UAAU;AAAA,YACzD,CAAC;AAGD,gBACI,EAAE,qBACF,OAAO,EAAE,kBAAkB,uBAAuB,YACpD;AACE,gBAAE,kBAAkB,mBAAmB,MAAM;AACzC,oBAAI;AACA,wBAAM,KAAK,EAAE;AACb,wBAAM,MACF,MAAM,OAAO,GAAG,iBAAiB,aAAa,GAAG,aAAa,IAAI;AACtE,wBAAM,SAAQ,2BAAK,OAAM;AACzB,sBAAI,QAAQ;AACZ,uBAAK,aAAa,QAAQ,CAAC,KAAK,QAAQ;AACpC,wBAAI,OAAO,IAAI,YAAY,MAAO,SAAQ;AAAA,kBAC9C,CAAC;AACD,yBAAO;AAAA,gBACX,QAAQ;AACJ,yBAAO;AAAA,gBACX;AAAA,cACJ,CAAC;AAAA,YACL;AAEA,iBAAK,gBAAgB;AAAA,UACzB;AAAA;AAAA;AAAA;AAAA,UAKQ,YAAY,SAAsB;AACtC,kBAAM;AAAA,cACF;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA,YAAY;AAAA,cACZ;AAAA,cACA;AAAA,YACJ,IAAI;AAEJ,kBAAM,IAAI;AACV,kBAAM,QAAQ,SAAS,eAAe,UAAU;AAChD,gBAAI,CAAC,MAAO;AAEZ,kBAAM,aAAa,EAAE,WAAW,OAAO,SAAS,OAAO;AAAA,cACnD;AAAA,cACA,uBAAuB,MAAG;AAlL1C;AAmLoB,qEAAe,aACf,GAAG,IAAI,OAAK,aAAQ,qBAAR,qCAAgC,QAAQ,gBAAgB,EAAE,UAAU,CAAC;AAAA;AAAA,YACzF,CAAC;AAED,kBAAM,gBAAgB,QAAQ,kBAAkB,KAAK,OAAO;AAC5D,oBAAQ,oBAAoB,CAAC,OAAe;AACxC,4BAAc,EAAE;AAChB,mBAAK,aAAa,MAAM,EAAE;AAAA,YAC9B;AAEA,kBAAM,cAAc,QAAQ,gBAAgB,KAAK,OAAO;AACxD,oBAAQ,kBAAkB,CAAC,OAAe;AACtC,0BAAY,EAAE;AACd,oBAAM,YAAY,QAAQ,gBAAgB,EAAE;AAC5C,kBAAI,cAAc,GAAG;AACjB;AAAA,cACJ,OAAO;AACH,sBAAM,SAAS,QAAQ,kBAAkB;AACzC,oBAAI,OAAQ,MAAK,aAAa,MAAM,OAAO,UAAU;AAAA,cACzD;AAAA,YACJ;AAEA,iBAAK,aAAa,IAAI,MAAM;AAAA,cACxB;AAAA,cACA,YAAY;AAAA,cACZ,SAAS,WAAW;AAAA,cACpB;AAAA,YACJ,CAAC;AAED,iBAAK,yBAAyB,MAAM,SAAS,WAAW,MAAS;AACjE,iBAAK,yBAAyB,IAAI;AAClC,iBAAK,uBAAuB,IAAI;AAAA,UACpC;AAAA;AAAA,UAGQ,iBAAiB,SAAiB;AAtNlD;AAuNY,gBAAI;AACA,oBAAMC,OAAO,OAAe;AAC5B,mBAAI,KAAAA,QAAA,gBAAAA,KAAK,WAAL,mBAAa,OAAO;AACpB,gBAAAA,KAAI,OAAO,MAAM,OAAO;AACxB;AAAA,cACJ;AACA,oBAAM,QAAQ,SAAS,eAAe,OAAO;AAC7C,kBAAI,CAAC,MAAO;AACZ,oBAAM,WAAY,OAAe;AACjC,kBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,yBAAS,KAAK,KAAK;AAAA,cACvB,OAAO;AACH,sBAAM,UAAU,IAAI,QAAQ;AAAA,cAChC;AAAA,YACJ,QAAQ;AAAA,YAER;AAAA,UACJ;AAAA,UAEQ,uBAAuB,MAAc;AACzC,kBAAMD,eAAc,KAAK,aAAa,IAAI,IAAI;AAC9C,gBAAI,CAACA,aAAa;AAClB,kBAAM,EAAE,QAAQ,IAAIA;AAEpB,kBAAM,iBAAiB,QAAQ,eAAe,KAAK,OAAO;AAC1D,oBAAQ,iBAAiB,CAAC,WAAgC;AACtD,oBAAM,WAAW,eAAe,MAAM;AAEtC,oBAAM,SAAS,QAAQ,kBAAkB;AACzC,kBAAI,QAAQ;AACR,qBAAK,aAAa,MAAM,OAAO,UAAU;AAAA,cAC7C,WAAW,UAAU;AACjB,qBAAK,aAAa,MAAM,SAAS,UAAU;AAAA,cAC/C;AACA,qBAAO;AAAA,YACX;AAAA,UACJ;AAAA,UAEA,aAAa,MAAc,YAAoB;AAC3C,kBAAMA,eAAc,KAAK,aAAa,IAAI,IAAI;AAC9C,gBAAI,CAACA,aAAa;AAClB,kBAAM,YAAYA,aAAY,QAAQ,gBAAgB;AACtD,sBAAU,QAAQ,UAAQ;AAjQtC;AAkQgB,kBAAI,KAAK,eAAe,WAAY,YAAK,SAAL;AAAA,kBAC/B,YAAK,SAAL;AAAA,YACT,CAAC;AAAA,UACL;AAAA,UAEA,yBAAyB,MAAc;AAvQ/C;AAwQY,kBAAMA,eAAc,KAAK,aAAa,IAAI,IAAI;AAC9C,gBAAI,CAACA,aAAa;AAClB,kBAAM,SAASA,aAAY,QAAQ,kBAAkB;AACrD,gBAAI,QAAQ;AACR,mBAAK,aAAa,MAAM,OAAO,UAAU;AAAA,YAC7C,OAAO;AACH,oBAAM,MAAMA,aAAY,QAAQ,gBAAgB;AAChD,kBAAI,IAAI,SAAS,GAAG;AAChB,sBAAM,WAAU,SAAI,CAAC,MAAL,mBAAQ;AACxB,oBAAI,SAAS;AAET,kBAAAA,aAAY,QAAQ,kBAAkB,OAAO;AAC7C,uBAAK,aAAa,MAAM,OAAO;AAAA,gBACnC;AAAA,cACJ;AAAA,YACJ;AAAA,UACJ;AAAA,UAEQ,yBAAyB,MAAc,SAAkB,SAAkB;AAC/E,kBAAM,IAAI;AACV,gBAAI,SAAS;AACT,oBAAM,UAAU,SAAS,eAAe,OAAO;AAC/C,kBAAI,CAAC,SAAS;AACV,wBAAQ;AAAA,kBACJ,iCAAiC,IAAI,WAAW,OAAO;AAAA,gBAC3D;AACA;AAAA,cACJ;AAAA,YACJ;AACA,kBAAM,aAAa,EAAE,kBAAkB,SAAS,SAAS;AAAA,cACrD,OAAO;AAAA,cACP,iBAAiB,MAAM,GAAG,IAAI,IAAI,QAAQ,iBAAiB,IAAI,CAAC;AAAA,YACpE,CAAC;AACD,kBAAM,MAAM,KAAK,aAAa,IAAI,IAAI;AACtC,gBAAI,IAAK,KAAI,sBAAsB;AAAA,UACvC;AAAA,QACJ;AAGA,cAAM,cAAc,IAAI,yBAAyB;AACjD,QAAC,OAAe,2BAA2B;AAC3C,QAAC,OAAe,2BAA2B;AAC3C,oBAAY,KAAK;AAAA,MACrB,GAAG;AAAA;AAAA;;;ACnTH;AAAA;AAAA;AAYA,cAAQ,IAAI,wBAAmB;AAE/B,OAAC,MAAM;AACH;AAmDA,cAAME,WAAsB,OAAO,WAAW;AAAA,UAC1C,WAAW,SAAO;AAAA,UAClB,mBAAmB,MAAM;AAAA,UAAC;AAAA,UAC1B,mBAAmB,MAAM;AAAA,QAC7B;AAEA,cAAM,aAAa,OAAO,cAAc,CAAC;AACzC,cAAM,eAAe,WAAW,gBAAgB,CAAC;AACjD,cAAM,qBAAqB,WAAW,uBAAuB,CAAC,QAAgB;AAC9E,cAAM,wBAAwB,WAAW,0BAA0B,MAAM;AAAA,QAAC;AAE1E,cAAM,cAAc,OAAO,eAAe,CAAC;AAC3C,cAAM,qBAAqB,YAAY,uBAAuB,MAAM;AAAA,QAAC;AAGrE,cAAM,oBACF,OAAO,sBACN,MAAM;AACH,gBAAM,WAAY,OAAe;AACjC,mBAAS,iBAAiB,gBAAgB,EAAE,QAAQ,cAAY;AAC5D,gBAAI,CAAC,SAAS,UAAU,SAAS,QAAQ,GAAG;AACxC,kBAAI,YAAY,OAAO,SAAS,SAAS,YAAY;AACjD,yBAAS,KAAK,QAAuB;AAAA,cACzC,OAAO;AACH,yBAAS,UAAU,IAAI,QAAQ;AAAA,cACnC;AAAA,YACJ;AAAA,UACJ,CAAC;AACD,mBAAS,iBAAiB,sCAAsC,EAAE,QAAQ,YAAU;AAChF,mBAAO,aAAa,iBAAiB,OAAO;AAAA,UAChD,CAAC;AACD,mBAAS,iBAAiB,4BAA4B,EAAE,QAAQ,YAAU;AACtE,mBAAO,aAAa,iBAAiB,OAAO;AAAA,UAChD,CAAC;AAAA,QACL;AAGJ,cAAM,eAA6B;AAAA,UAC/B,MAAM;AAAA,UACN,WAAW;AAAA,UACX,OAAO;AAAA,UACP,UAAU,SAAS,gBAAgB,UAAU,SAAS,MAAM;AAAA,UAC5D,YAAY;AAAA,UACZ,QAAQ;AAAA,UACR,aAAa;AAAA,UACb,SAAS;AAAA,UACT,SAAS;AAAA,UACT,0BAA0B;AAAA,QAC9B;AAIA,iBAAS,gBAAgB,WAAmB,SAAuB;AAC/D,gBAAM,MAAM,aAAa,OAAO;AAChC,gBAAM,SAAS,MAAM,mBAAmB,GAAG,IAAI;AAC/C,mBAAS,iBAAiB,eAAe,SAAS,IAAI,EAAE,QAAQ,QAAM;AAClE,kCAAsB,IAAmB,QAAQ,SAAS;AAAA,UAC9D,CAAC;AAAA,QACL;AAEA,iBAAS,sBACL,UACA,MACI;AACJ,mBAAS,iBAAiB,gBAAgB,QAAQ,IAAI,EAAE,QAAQ,QAAM;AAClE,eAAG,cAAc,SAAS,QAAQ,SAAS,SAAY,OAAO,IAAI,IAAI;AAAA,UAC1E,CAAC;AAAA,QACL;AAEA,iBAAS,wBAAwB,WAAmB,QAAuB;AACvE,gBAAMC,UAAS,SAAS,cAAc,wBAAwB,SAAS,IAAI;AAC3E,cAAIA,SAAQ;AACR,YAAAA,QAAO,UAAU,OAAO,aAAa,CAAC,CAAC,MAAM;AAC7C,YAAAA,QAAO,aAAa,gBAAgB,SAAS,SAAS,OAAO;AAAA,UACjE;AAAA,QACJ;AAEA,iBAAS,yBAAyB,WAAmB,SAAwB;AACzE,gBAAM,WAAW,SAAS,cAAc,wBAAwB,SAAS,IAAI;AAC7E,cAAI,UAAU;AACV,qBAAS,aAAa,gBAAgB,UAAU,SAAS,OAAO;AAChE,qBAAS,UAAU,OAAO,aAAa,CAAC,CAAC,OAAO;AAAA,UACpD;AAAA,QACJ;AAEA,iBAAS,wBAAwB,MAAc,OAAqB;AAChE,mBACK,iBAAmC,wBAAwB,IAAI,IAAI,EACnE,QAAQ,YAAU;AACf,gBAAI,OAAO,OAAO,KAAK,MAAM,OAAO;AAChC,qBAAO,QAAQ,OAAO,KAAK;AAAA,YAC/B;AAAA,UACJ,CAAC;AACL,mBAAS,iBAAiB,gBAAgB,IAAI,IAAI,EAAE,QAAQ,WAAS;AACjE,kBAAM,cAAc,GAAG,KAAK;AAAA,UAChC,CAAC;AAAA,QACL;AAIA,iBAAS,eAAqB;AAC1B,gBAAM,UAAU,aAAa,OAAO,WAAW;AAC/C,0BAAgB,QAAQ,OAAO;AAC/B;AAAA,YACI;AAAA,YACAD,SAAQ,UAAU,aAAa,OAAO,qBAAqB,mBAAmB;AAAA,UAClF;AACA,kCAAwB,QAAQ,aAAa,IAAI;AACjD,mCAAyB,eAAe,aAAa,IAAI;AACzD,mBAAS,iBAAiB,2BAA2B,EAAE,QAAQ,SAAO;AAClE,kBAAM,WAAW,CAAC,aAAa;AAC/B,gBAAI,UAAU;AACV,kBAAI,aAAa,iBAAiB,MAAM;AAAA,YAC5C,OAAO;AACH,kBAAI,gBAAgB,eAAe;AAAA,YACvC;AAAA,UACJ,CAAC;AACD,8BAAoB,aAAa,SAAS,EAAE,QAAQ,KAAK,CAAC;AAAA,QAC9D;AAEA,iBAAS,oBAA0B;AAC/B,gBAAM,UAAU,aAAa,YAAY,gBAAgB;AACzD,0BAAgB,aAAa,OAAO;AACpC;AAAA,YACI;AAAA,YACAA,SAAQ,UAAU,aAAa,YAAY,qBAAqB,mBAAmB;AAAA,UACvF;AACA,kCAAwB,aAAa,aAAa,SAAS;AAC3D,mCAAyB,oBAAoB,aAAa,SAAS;AACnE,gBAAM,UAAU,SAAS,iBAAiB,+BAA+B;AACzE,kBAAQ,QAAQ,SAAO;AACnB,kBAAM,YAAY,IAAI,cAAc,2BAA2B;AAC/D,gBAAI,aAAa,CAAC,UAAU,aAAa,cAAc,GAAG;AACtD,wBAAU,aAAa,gBAAgB,UAAU,eAAe,EAAE;AAAA,YACtE;AACA,kBAAM,WAAW,CAAC,aAAa;AAC/B,gBAAI,UAAU;AACV,kBAAI,aAAa,iBAAiB,MAAM;AAAA,YAC5C,OAAO;AACH,kBAAI,gBAAgB,eAAe;AAAA,YACvC;AAAA,UACJ,CAAC;AACD,6BAAmB,aAAa,0BAA0B;AAAA,YACtD,QAAQ;AAAA,YACR,WAAW;AAAA,UACf,CAAC;AAAA,QACL;AAEA,iBAAS,gBAAsB;AAC3B,kCAAwB,SAAS,aAAa,KAAK;AACnD;AAAA,YACI;AAAA,YACAA,SAAQ,UAAU,aAAa,QAAQ,yBAAyB,mBAAmB;AAAA,UACvF;AAAA,QACJ;AAEA,iBAAS,mBAAyB;AAC9B,gBAAM,SAAS,aAAa;AAC5B,kCAAwB,aAAa,MAAM;AAC3C;AAAA,YACI;AAAA,YACAA,SAAQ,UAAU,SAAS,yBAAyB,mBAAmB;AAAA,UAC3E;AACA,0BAAgB,cAAc,SAAS,mBAAmB,iBAAiB;AAAA,QAC/E;AAEA,iBAAS,iBAAuB;AAC5B,gBAAM,QAAQ,KAAK,IAAI,GAAG,KAAK,IAAI,KAAK,OAAO,aAAa,MAAM,KAAK,CAAC,CAAC;AACzE,uBAAa,SAAS;AACtB,cAAI,UAAU;AACd,cAAI,UAAU,GAAG;AACb,sBAAU;AAAA,UACd,WAAW,SAAS,IAAI;AACpB,sBAAU;AAAA,UACd,WAAW,SAAS,IAAI;AACpB,sBAAU;AAAA,UACd,OAAO;AACH,sBAAU;AAAA,UACd;AACA,0BAAgB,UAAU,OAAO;AACjC,kCAAwB,UAAU,KAAK;AAAA,QAC3C;AAEA,iBAAS,qBAA2B;AAChC,gBAAM,QAAQ,KAAK,IAAI,GAAG,KAAK,IAAI,KAAK,OAAO,aAAa,UAAU,KAAK,CAAC,CAAC;AAC7E,uBAAa,aAAa;AAC1B,kCAAwB,cAAc,KAAK;AAAA,QAC/C;AAEA,iBAAS,kBAAwB;AAC7B,0BAAgB,WAAW,aAAa;AACxC,gCAAsB,WAAW,GAAG,aAAa,OAAO,GAAG;AAAA,QAC/D;AAEA,iBAAS,sBAA4B;AACjC,gBAAM,SAAS,aAAa;AAC5B,mBAAS,iBAAiB,qBAAqB,EAAE,QAAQ,SAAO;AAC5D,kBAAM,WAAW,IAAI,aAAa,mBAAmB,MAAM;AAC3D,gBAAI,aAAa,gBAAgB,WAAW,SAAS,OAAO;AAC5D,gBAAI,UAAU,OAAO,aAAa,QAAQ;AAAA,UAC9C,CAAC;AAAA,QACL;AAIA,iBAAS,oBAAoB,SAAiB,UAAyB,CAAC,GAAS;AAC7E,cAAI,SAAS;AACT,yBAAa,UAAU;AAAA,UAC3B;AACA,gBAAM,gBAAgB,aAAa;AACnC,mBAAS,iBAAiB,2BAA2B,EAAE,QAAQ,SAAO;AAClE,kBAAM,YAAY,IAAI,cAAc,2BAA2B;AAC/D,gBAAI,aAAa,CAAC,UAAU,aAAa,cAAc,GAAG;AACtD,wBAAU,aAAa,gBAAgB,UAAU,eAAe,EAAE;AAAA,YACtE;AACA,kBAAM,WACF,CAAC,IAAI,aAAa,eAAe,KACjC,IAAI,aAAa,cAAc,MAAM,iBACrC,aAAa;AACjB,gBAAI,UAAU,OAAO,aAAa,QAAQ;AAC1C,gBAAI,aAAa,gBAAgB,WAAW,SAAS,OAAO;AAC5D,gBAAI,WAAW;AACX,kBAAI,CAAC,aAAa,MAAM;AACpB,0BAAU,cAAc,UAAU,aAAa,cAAc,KAAK;AAAA,cACtE,WAAW,UAAU;AACjB,0BAAU,cAAcA,SAAQ,UAAU,yBAAyB;AAAA,cACvE,OAAO;AACH,0BAAU,cAAc,UAAU,aAAa,cAAc,KAAK;AAAA,cACtE;AAAA,YACJ;AAAA,UACJ,CAAC;AACD,cAAI,CAAC,QAAQ,QAAQ;AACjB,8BAAkB;AAAA,UACtB;AAAA,QACJ;AAEA,iBAAS,mBAAmB,YAAoB,UAAyB,CAAC,GAAS;AAC/E,gBAAM,YAAY,QAAQ,cAAc;AACxC,cAAI,YAAY;AACZ,yBAAa,2BAA2B;AACxC,gBAAI,aAAa,eAAe,WAAW;AACvC,2BAAa,cAAc;AAAA,YAC/B;AAAA,UACJ;AACA,gBAAM,eAAe,aAAa;AAClC,mBAAS,iBAAiB,+BAA+B,EAAE,QAAQ,SAAO;AACtE,kBAAM,YAAY,IAAI,cAAc,2BAA2B;AAC/D,gBAAI,aAAa,CAAC,UAAU,aAAa,cAAc,GAAG;AACtD,wBAAU,aAAa,gBAAgB,UAAU,eAAe,EAAE;AAAA,YACtE;AACA,kBAAM,WACF,aAAa,aAAa,IAAI,aAAa,aAAa,MAAM;AAClE,gBAAI,UAAU,OAAO,aAAa,QAAQ;AAC1C,gBAAI,aAAa,gBAAgB,WAAW,SAAS,OAAO;AAC5D,gBAAI,WAAW;AACX,kBAAI,CAAC,aAAa,WAAW;AACzB,0BAAU,cAAc,UAAU,aAAa,cAAc,KAAK;AAAA,cACtE,WAAW,UAAU;AACjB,0BAAU,cAAcA,SAAQ,UAAU,yBAAyB;AAAA,cACvE,OAAO;AACH,0BAAU,cAAc,UAAU,aAAa,cAAc,KAAK;AAAA,cACtE;AAAA,YACJ;AAAA,UACJ,CAAC;AACD,8BAAoB;AACpB,cAAI,CAAC,QAAQ,QAAQ;AACjB,8BAAkB;AAAA,UACtB;AAAA,QACJ;AAEA,iBAAS,eAAe,WAAmB,UAAyB,CAAC,GAAS;AAC1E,cAAI,CAAC,UAAW;AAChB,uBAAa,cAAc;AAC3B,cAAI,cAAc,WAAW;AACzB,yBAAa,2BAA2B;AAAA,UAC5C;AACA,8BAAoB;AACpB,4BAAkB;AAClB,cAAI,CAAC,QAAQ,QAAQ;AACjB,8BAAkB;AAAA,UACtB;AAAA,QACJ;AAIA,iBAAS,mBAAmB,WAAyB;AACjD,kBAAQ,WAAW;AAAA,YACf,KAAK;AACD,2BAAa,OAAO,CAAC,aAAa;AAClC,2BAAa;AACb;AAAA,YACJ,KAAK;AACD,2BAAa,YAAY,CAAC,aAAa;AACvC,gCAAkB;AAClB;AAAA,YACJ,KAAK;AACD,2BAAa,QAAQ,CAAC,aAAa;AACnC,4BAAc;AACd;AAAA,YACJ,KAAK,aAAa;AACd,oBAAM,OAAO,CAAC,SAAS,gBAAgB,UAAU,SAAS,MAAM;AAChE,2BAAa,WAAW;AACxB,kBAAI,OAAO,uBAAuB,YAAY;AAC1C,mCAAmB,OAAO,SAAS,OAAO;AAAA,cAC9C,OAAO;AACH,yBAAS,gBAAgB,UAAU,OAAO,QAAQ,IAAI;AAAA,cAC1D;AACA,+BAAiB;AACjB;AAAA,YACJ;AAAA,YACA;AACI;AAAA,UACR;AAAA,QACJ;AAEA,iBAAS,mBAAmB,WAAyB;AACjD,kBAAQ,WAAW;AAAA,YACf,KAAK;AACD,iCAAmB,MAAM;AACzB;AAAA,YACJ,KAAK;AACD,iCAAmB,WAAW;AAC9B;AAAA,YACJ,KAAK;AAAA,YACL,KAAK;AAAA,YACL,KAAK;AACD;AACI,sBAAM,UACF,OACF;AACF,oBAAI,mCAAU,mBAAmB;AAC7B,0BAAQ,gBAAgB,EAAE,KAAK;AAAA,gBACnC,OAAO;AACH,0BAAQ,KAAK,WAAW,SAAS,qCAA+B;AAAA,gBACpE;AACA,kCAAkB;AAAA,cACtB;AACA;AAAA,YACJ,KAAK;AAAA,YACL,KAAK;AACD,sBAAQ,KAAK,WAAW,SAAS,iBAAc;AAC/C,gCAAkB;AAClB;AAAA,YACJ;AACI;AAAA,UACR;AAAA,QACJ;AAEA,iBAAS,wBAAwB,MAAc,OAAqB;AAChE,cAAI,CAAC,OAAO,SAAS,KAAK,EAAG;AAC7B,cAAI,SAAS,UAAU;AACnB,yBAAa,SAAS;AACtB,2BAAe;AAAA,UACnB,WAAW,SAAS,cAAc;AAC9B,yBAAa,aAAa;AAC1B,+BAAmB;AAAA,UACvB;AAAA,QACJ;AAIA,iBAAS,0BAAgC;AACrC,0BAAgB,OAAO,KAAK;AAC5B,0BAAgB,QAAQ,MAAM;AAC9B,uBAAa;AACb,4BAAkB;AAClB,wBAAc;AACd,2BAAiB;AACjB,yBAAe;AACf,6BAAmB;AACnB,0BAAgB;AAChB,8BAAoB;AAAA,QACxB;AAIA,iBAAS,2BAAiC;AACtC,mBAAS,iBAAiB,2BAA2B,EAAE,QAAQ,eAAa;AACxE,sBAAU,aAAa,gBAAgB,UAAU,eAAe,EAAE;AAAA,UACtE,CAAC;AAED,mBAAS,iBAAiB,4BAA4B,EAAE,QAAQ,aAAW;AAEvE,kBAAM,WACF,OAGF;AACF,gBAAI,OAAO,aAAa,YAAY;AAChC,uBAAS,SAAS;AAAA,gBACd,mBAAmB;AAAA,cACvB,CAAC;AAAA,YACL;AAAA,UACJ,CAAC;AAGD,mBAAS,iBAAiB,sBAAsB,EAAE,QAAQ,CAAAC,YAAU;AAChE,YAAAA,QAAO,aAAa,eAAe,eAAe;AAAA,UAEtD,CAAC;AAED,mBAAS,iBAAiB,sBAAsB,EAAE,QAAQ,YAAU;AAChE,aAAC,eAAe,aAAa,YAAY,EAAE,QAAQ,SAAO;AACtD,qBAAO,iBAAiB,KAAK,CAAC,MAAa,EAAE,gBAAgB,CAAC;AAAA,YAClE,CAAC;AACD,mBAAO,iBAAiB,SAAS,CAAC,UAAiB;AAC/C,oBAAM,gBAAgB;AACtB,oBAAM,SAAS,MAAM;AACrB,oBAAM,QAAQ,OAAO,OAAO,KAAK;AACjC,oBAAM,OAAO,OAAO,aAAa,oBAAoB;AACrD,kBAAI,MAAM;AACN,wCAAwB,MAAM,KAAK;AAAA,cACvC;AAAA,YACJ,CAAC;AAAA,UACL,CAAC;AAED,mBAAS,iBAAiB,sBAAsB,EAAE,QAAQ,SAAO;AAC7D,gBAAI,aAAa,eAAe,eAAe;AAAA,UACnD,CAAC;AAED,mBAAS,iBAAiB,qBAAqB,EAAE,QAAQ,SAAO;AAC5D,gBAAI,aAAa,eAAe,uBAAuB;AAAA,UAC3D,CAAC;AAED,mBAAS,iBAAiB,gBAAgB,EAAE,QAAQ,SAAO;AACvD,gBAAI,aAAa,eAAe,mBAAmB;AAAA,UACvD,CAAC;AAED,mBAAS,iBAAiB,eAAe,EAAE,QAAQ,SAAO;AACtD,gBAAI,aAAa,eAAe,2BAA2B;AAAA,UAC/D,CAAC;AAED,kCAAwB;AAAA,QAC5B;AAIA,cAAM,mBAA6B;AAAA,UAC/B;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA,iBAAiB,MAAM,OAAO,OAAO,CAAC,GAAG,YAAY;AAAA,QACzD;AAEA,QAAC,OAAsD,WAAW;AAAA,MACtE,GAAG;AAAA;AAAA;;;ACtdH,WAAS,EAAE,KAAa,UAA0B;AA9ClD;AA+CI,UAAM,MAAO,OAAwC;AACrD,YAAO,4CAAK,SAAL,mBAAW,cAAX,4BAAuB,KAAK,cAA5B,YAAyC;AAAA,EACpD;AAKA,WAAS,oBAA0B;AAtDnC;AAuDI,QAAI;AACA,YAAM,YAAY,SAAS,eAAe,uBAAuB;AACjE,YAAM,WAAW,SAAS,eAAe,sBAAsB;AAE/D,UAAI,CAAC,aAAa,CAAC,UAAU;AACzB,uBAAO,KAAK,UAAU,wCAAwC;AAC9D;AAAA,MACJ;AAIA,YAAM,eAAe,oBAAI,IAA0B;AACnD,YAAMC,YAAY,OACb;AACL,YAAM,eAAa,KAAAA,aAAA,gBAAAA,UAAU,kBAAV,wBAAAA,eAA+B,CAAC;AAEnD,iBAAW,QAAQ,CAAC,QAAoB;AACpC,cAAM,OAAO,2BAAK;AAClB,YAAI,CAAC,KAAM;AACX,YAAI,CAAC,aAAa,IAAI,IAAI,GAAG;AACzB,uBAAa,IAAI,MAAM,CAAC,CAAC;AAAA,QAC7B;AACA,qBAAa,IAAI,IAAI,EAAG,KAAK,GAAG;AAAA,MACpC,CAAC;AAGD,UAAI,aAAa,SAAS,GAAG;AACzB,kBAAU,MAAM,UAAU;AAC1B;AAAA,MACJ;AAEA,gBAAU,MAAM,UAAU;AAG1B,eAAS,YAAY;AAErB,YAAM,gBAAe,KAAAA,aAAA,gBAAAA,UAAU,oBAAV,wBAAAA;AACrB,YAAM,aAAiC;AAAA,QACnC;AAAA,UACI,SAAS;AAAA,UACT,OAAO,EAAE,qBAAqB,QAAQ;AAAA,QAC1C;AAAA,QACA;AAAA,UACI,SAAS;AAAA,UACT,OAAO,EAAE,uBAAuB,UAAU;AAAA,QAC9C;AAAA,QACA;AAAA,UACI,SAAS;AAAA,UACT,OAAO,EAAE,0BAA0B,iBAAiB;AAAA,QACxD;AAAA,QACA;AAAA,UACI,SAAS;AAAA,UACT,OAAO,EAAE,qBAAqB,OAAO;AAAA,QACzC;AAAA,MACJ;AAGA,iBAAW,QAAQ,CAAC,QAAQ,UAAU;AAClC,cAAM,YAAY,aAAa,IAAI,OAAO,OAAO,KAAK,CAAC;AACvD,YAAI,UAAU,WAAW,EAAG;AAG5B,YAAI,QAAQ,GAAG;AACX,gBAAM,YAAY,SAAS,cAAc,IAAI;AAC7C,oBAAU,YAAY;AACtB,oBAAU,aAAa,QAAQ,WAAW;AAC1C,oBAAU,aAAa,eAAe,MAAM;AAC5C,mBAAS,YAAY,SAAS;AAAA,QAClC;AAIA,cAAM,SAAS,CAAC,GAAG,SAAS,EAAE,KAAK,CAAC,GAAG,QAAO,uBAAG,WAAU,OAAM,uBAAG,WAAU,EAAE;AAChF,eAAO,QAAQ,CAAC,UAAsB,kBAA0B;AAC5D,gBAAM,WAAW,CAAC,CAAC,gBAAgB,aAAa,OAAO,SAAS;AAChE,gBAAM,KAAK,SAAS,cAAc,IAAI;AACtC,aAAG,aAAa,QAAQ,MAAM;AAE9B,gBAAM,SAAS,SAAS,cAAc,QAAQ;AAC9C,iBAAO,OAAO;AACd,iBAAO,YAAY;AACnB,iBAAO,aAAa,QAAQ,UAAU;AACtC,iBAAO,aAAa,YAAY,IAAI;AACpC,iBAAO,QAAQ,WAAW,SAAS;AACnC,iBAAO,QAAQ,SAAS;AACxB,iBAAO,QAAQ,QAAQ,SAAS;AAGhC,gBAAM,YAAY,SAAS,cAAc,MAAM;AAC/C,oBAAU,YAAY;AACtB,oBAAU,cAAc,GAAG,OAAO,KAAK,IAAI,gBAAgB,CAAC;AAE5D,iBAAO,YAAY,SAAS;AAG5B,cAAI,UAAU;AACV,kBAAM,YAAY,SAAS,cAAc,MAAM;AAC/C,sBAAU,YAAY;AACtB,sBAAU,cAAc;AACxB,sBAAU,MAAM,aAAa;AAC7B,mBAAO,YAAY,SAAS;AAAA,UAChC;AAEA,aAAG,YAAY,MAAM;AACrB,mBAAS,YAAY,EAAE;AAAA,QAC3B,CAAC;AAAA,MACL,CAAC;AAGD,YAAM,MAAM,SAAS,cAAc,IAAI;AACvC,UAAI,YAAY;AAChB,UAAI,aAAa,QAAQ,WAAW;AACpC,UAAI,aAAa,eAAe,MAAM;AACtC,eAAS,YAAY,GAAG;AAGxB,YAAM,cAAc,SAAS,cAAc,IAAI;AAC/C,kBAAY,aAAa,QAAQ,MAAM;AACvC,YAAM,kBAAkB,SAAS,cAAc,QAAQ;AACvD,sBAAgB,OAAO;AACvB,sBAAgB,YAAY;AAC5B,sBAAgB,aAAa,QAAQ,UAAU;AAC/C,sBAAgB,aAAa,YAAY,IAAI;AAC7C,sBAAgB,QAAQ,SAAS;AAEjC,YAAM,iBAAiB,SAAS,cAAc,MAAM;AACpD,qBAAe,YAAY;AAC3B,qBAAe,QAAQ,OAAO;AAC9B,qBAAe,cAAc,EAAE,4BAA4B,cAAc;AAEzE,sBAAgB,YAAY,cAAc;AAC1C,kBAAY,YAAY,eAAe;AACvC,eAAS,YAAY,WAAW;AAGhC,YAAM,iBAAiB,MAAM,KAAK,aAAa,OAAO,CAAC,EAAE;AAAA,QACrD,CAAC,KAAK,QAAQ,MAAM,IAAI;AAAA,QACxB;AAAA,MACJ;AACA,UAAI,iBAAiB,GAAG;AACpB,cAAM,aAAa,SAAS,cAAc,IAAI;AAC9C,mBAAW,aAAa,QAAQ,MAAM;AACtC,cAAM,iBAAiB,SAAS,cAAc,QAAQ;AACtD,uBAAe,OAAO;AACtB,uBAAe,YAAY;AAC3B,uBAAe,aAAa,QAAQ,UAAU;AAC9C,uBAAe,aAAa,YAAY,IAAI;AAC5C,uBAAe,QAAQ,SAAS;AAEhC,cAAM,gBAAgB,SAAS,cAAc,MAAM;AACnD,sBAAc,YAAY;AAC1B,sBAAc,QAAQ,OAAO;AAC7B,sBAAc,cAAc,EAAE,2BAA2B,mBAAgB;AAEzE,uBAAe,YAAY,aAAa;AACxC,mBAAW,YAAY,cAAc;AACrC,iBAAS,YAAY,UAAU;AAAA,MACnC;AAEA,qBAAO,KAAK,UAAU,4BAA4B,WAAW,MAAM,YAAY;AAAA,IACnF,SAAS,KAAK;AACV,qBAAO,KAAK,UAAU,6BAA6B,GAAG;AAAA,IAE1D;AAAA,EACJ;AAKO,WAAS,uBAA6B;AAhO7C;AAiOI,QAAI;AACA,YAAM,YAAa,OAAoD;AACvE,UAAI,CAAC,WAAW;AACZ,uBAAO,KAAK,UAAU,kDAAkD;AACxE,mBAAW,sBAAsB,GAAG;AACpC;AAAA,MACJ;AAEA,YAAM,IAAI;AAOV,YAAM,uBAAuB,MAAM;AAC/B,cAAMC,WAAU,SAAS,eAAe,qBAAqB;AAC7D,YAAI,CAACA,SAAS;AAEd,YAAIA,SAAQ,aAAa,gCAAgC,MAAM,IAAK;AACpE,cAAM,SAAS;AACf,YAAI,OAAO,OAAO,wBAAwB,YAAY;AAClD,iBAAO,oBAAoBA,UAAS,EAAE,mBAAmB,KAAK,CAAC;AAC/D,UAAAA,SAAQ,aAAa,kCAAkC,GAAG;AAC1D;AAAA,QACJ;AAGA,UAAE,2BAA2B,OAAO,WAAW,sBAAsB,GAAG;AAAA,MAC5E;AAIA,2BAAqB;AACrB,YAAM,UAAU,SAAS,eAAe,qBAAqB;AAC7D,UAAI,WAAW,QAAQ,aAAa,yBAAyB,MAAM,KAAK;AACpE,gBAAQ,aAAa,2BAA2B,GAAG;AACnD,gBAAQ;AAAA,UACJ;AAAA,UACA,MAAM;AACF,8BAAkB;AAAA,UACtB;AAAA,UACA;AAAA,QACJ;AAAA,MACJ;AAGA,gBAAU,SAAS,kBAAkB,CAAC,WAAyB;AAhRvE,YAAAC;AAiRY,YAAI;AACA,gBAAM,YAAW,iCAAQ,WAAS,iCAAQ;AAC1C,cAAI,CAAC,SAAU;AACf,gBAAMF,YAAY,OACb;AACL,gBAAM,OAAME,MAAAF,aAAA,gBAAAA,UAAU,cAAV,gBAAAE,IAAA,KAAAF,WAAsB;AAClC,cAAI,CAAC,IAAK;AAEV,cAAI,OAAO,IAAI,iBAAiB,YAAY;AACxC,gBAAI,aAAa;AAAA,UACrB;AACA,yBAAO,KAAK,UAAU,sBAAsB,QAAQ,EAAE;AACtD,4BAAkB;AAAA,QACtB,SAAS,KAAK;AACV,yBAAO,KAAK,UAAU,iCAAiC,GAAG;AAAA,QAC9D;AAAA,MACJ,CAAC;AAGD,gBAAU,SAAS,mBAAmB,MAAM;AACxC,YAAI;AAEA,gBAAM,KAAM,OACP;AACL,cAAI,MAAM,OAAO,GAAG,WAAW,YAAY;AACvC,eAAG,OAAO;AACV,2BAAO,KAAK,UAAU,2BAA2B;AACjD,uBAAW,mBAAmB,EAAE;AAChC;AAAA,UACJ;AACA,yBAAO;AAAA,YACH;AAAA,YACA;AAAA,UACJ;AAAA,QACJ,SAAS,KAAK;AACV,yBAAO,KAAK,UAAU,kCAAkC,GAAG;AAAA,QAC/D;AAAA,MACJ,CAAC;AAGD,gBAAU,SAAS,mBAAmB,MAAM;AACxC,YAAI;AACA,gBAAM,YAAY;AAAA,YACd,EAAE,kCAAkC,qCAAkC;AAAA,UAC1E;AACA,cAAI,CAAC,UAAW;AAEhB,gBAAMA,YAAY,OACb;AACL,cAAIA,aAAY,OAAOA,UAAS,oBAAoB,YAAY;AAC5D,YAAAA,UAAS,gBAAgB;AAAA,UAC7B;AACA,yBAAO,KAAK,UAAU,oBAAoB;AAC1C,4BAAkB;AAAA,QACtB,SAAS,KAAK;AACV,yBAAO,KAAK,UAAU,kCAAkC,GAAG;AAAA,QAC/D;AAAA,MACJ,CAAC;AAGD,wBAAkB;AAIlB,UAAI,EAAE,kBAAkB,CAAC,EAAE,qBAAqB;AAC5C,UAAE,sBAAsB;AAExB,YAAI,YAAY;AAChB,cAAM,WAAW,MAAM;AACnB,cAAI,UAAW;AACf,sBAAY;AACZ,qBAAW,MAAM;AACb,wBAAY;AACZ,8BAAkB;AAAA,UACtB,GAAG,EAAE;AAAA,QACT;AAEA,YAAI;AACA,gBAAM,sBAAqB,OAAE,eAAe,mBAAjB,mBAAiC,KAAK,EAAE;AACnE,cAAI,oBAAoB;AACpB,cAAE,eAAe,iBAAiB,CAAC,QAAoB;AACnD,iCAAmB,GAAG;AACtB,uBAAS;AAAA,YACb;AAAA,UACJ;AAAA,QACJ,SAAS,KAAK;AACV,yBAAO,MAAM,UAAU,kDAAkD,GAAG;AAAA,QAChF;AAEA,YAAI;AACA,gBAAM,oBAAmB,OAAE,eAAe,iBAAjB,mBAA+B,KAAK,EAAE;AAC/D,cAAI,kBAAkB;AAClB,cAAE,eAAe,eAAe,CAAC,aAAqB;AAClD,+BAAiB,QAAQ;AACzB,uBAAS;AAAA,YACb;AAAA,UACJ;AAAA,QACJ,SAAS,KAAK;AACV,yBAAO,MAAM,UAAU,gDAAgD,GAAG;AAAA,QAC9E;AAEA,YAAI;AACA,gBAAM,iBAAgB,OAAE,eAAe,oBAAjB,mBAAkC,KAAK,EAAE;AAC/D,cAAI,eAAe;AACf,cAAE,eAAe,kBAAkB,CAAC,aAA4B;AAC5D,4BAAc,QAAQ;AACtB,uBAAS;AAAA,YACb;AAAA,UACJ;AAAA,QACJ,SAAS,KAAK;AACV,yBAAO,MAAM,UAAU,mDAAmD,GAAG;AAAA,QACjF;AAAA,MACJ;AAEA,qBAAO,KAAK,UAAU,yBAAyB;AAAA,IACnD,SAAS,KAAK;AACV,qBAAO,MAAM,UAAU,sCAAsC,GAAG;AAAA,IAEpE;AAAA,EACJ;AAxYA,MASM;AATN;AAAA;AAAA;AAMA;AAGA,MAAM,WAAW;AAAA;AAAA;;;ACQV,WAAS,2BACZ,UAAmB,cACiB;AAnBxC;AAoBI,UAAM,MAAM,QAAQ,QAAQ,SAAS;AACrC,QAAI,CAAC,IAAK,QAAO,EAAE,QAAQ,MAAM,aAAa,MAAM;AACpD,QAAI;AACA,YAAM,UAAU,KAAK,MAAM,GAAG;AAC9B,eAAS,kBAAgB,wCAAS,YAAT,mBAAkB,WAAU,GAAG,mCAAS,OAAO;AACxE,UAAI,eAAe,mCAAS,OAAO,GAAG;AAClC,oBAAY,cAAc;AAC1B,eAAO,EAAE,QAAQ,SAAS,aAAa,MAAM,QAAQ,mBAAmB;AAAA,MAC5E;AACA,UAAI,gBAAgB,mCAAS,OAAO,GAAG;AACnC,yBAAiB,cAAc;AAC/B,eAAO,EAAE,QAAQ,SAAS,aAAa,MAAM,QAAQ,gBAAgB;AAAA,MACzE;AACA,aAAO,EAAE,QAAQ,SAAS,aAAa,MAAM;AAAA,IACjD,SAAS,KAAK;AACV,cAAQ,KAAK,sDAAsD,GAAG;AACtE,aAAO,EAAE,QAAQ,MAAM,aAAa,MAAM,QAAQ,eAAe;AAAA,IACrE;AAAA,EACJ;AAEO,WAAS,sBACZ,UAAmB,cACY;AA1CnC;AA2CI,UAAM,MAAM,QAAQ,QAAQ,UAAU;AACtC,QAAI,CAAC,KAAK;AACN,cAAQ,IAAI,8CAA8C;AAC1D,aAAO,EAAE,QAAQ,MAAM,aAAa,MAAM;AAAA,IAC9C;AACA,QAAI;AACA,YAAM,UAAU,KAAK,MAAM,GAAG;AAC9B,eAAS,YAAU,wCAAS,cAAT,mBAAoB,WAAU,GAAG,mCAAS,SAAS;AACtE,UAAI,eAAe,mCAAS,SAAS,GAAG;AACpC,oBAAY,QAAQ;AACpB,eAAO,EAAE,QAAQ,SAAS,aAAa,MAAM,QAAQ,qBAAqB;AAAA,MAC9E;AACA,UAAI,gBAAgB,mCAAS,SAAS,GAAG;AACrC,yBAAiB,QAAQ;AACzB,eAAO,EAAE,QAAQ,SAAS,aAAa,MAAM,QAAQ,gBAAgB;AAAA,MACzE;AACA,aAAO,EAAE,QAAQ,SAAS,aAAa,MAAM;AAAA,IACjD,SAAS,KAAK;AACV,cAAQ,KAAK,gDAAgD,GAAG;AAChE,aAAO,EAAE,QAAQ,MAAM,aAAa,MAAM,QAAQ,eAAe;AAAA,IACrE;AAAA,EACJ;AAEO,WAAS,gBAAgB,KAAa,UAAmB,cAAoB;AAChF,QAAI;AACA,cAAQ,WAAW,GAAG;AAAA,IAC1B,SAAS,KAAK;AACV,cAAQ,KAAK,mCAAmC,GAAG,KAAK,GAAG;AAAA,IAC/D;AAAA,EACJ;AAEA,WAAS,eAAe,OAAiC;AACrD,QAAI,CAAC,MAAM,QAAQ,KAAK,EAAG,QAAO;AAClC,WAAO,MAAM,SAAS;AAAA,EAC1B;AAEA,WAAS,gBAAgB,OAA2C;AAChE,QAAI,CAAC,MAAM,QAAQ,KAAK,EAAG,QAAO;AAClC,UAAM,YAAY,oBAAI,IAAoB;AAC1C,eAAW,QAAQ,OAAO;AACtB,YAAMG,MAAK,6BAAM,SAAmB;AACpC,UAAI,CAACA,GAAG;AACR,YAAM,SAAS,UAAU,IAAIA,EAAC,KAAK,KAAK;AACxC,gBAAU,IAAIA,IAAG,KAAK;AACtB,UAAI,QAAQ,EAAG,QAAO;AAAA,IAC1B;AACA,WAAO;AAAA,EACX;AAEA,WAAS,SACL,OACA,OACA,OACI;AACJ,UAAM,SAAS,UAAU,WAAW,cAAc;AAClD,YAAQ,IAAI,yBAAyB,KAAK,aAAa;AAAA,MACnD,CAAC,GAAG,KAAK,OAAO,GAAG;AAAA,MACnB,QAAO,+BAAO,IAAI,QAAM,EAAE,MAAM,uBAAG,MAAM,IAAI,uBAAG,GAAG,QAAO,CAAC;AAAA,MAC3D;AAAA,MACA;AAAA,IACJ,CAAC;AAAA,EACL;AAEA,WAAS,YAAY,OAAwC;AACzD,UAAM,OAAO,UAAU,WAAW,cAAc;AAChD,YAAQ,KAAK,mBAAmB,KAAK,gCAAgC,IAAI,GAAG;AAAA,EAChF;AAEA,WAAS,iBAAiB,OAAwC;AAC9D,UAAM,OAAO,UAAU,WAAW,cAAc;AAChD,YAAQ,KAAK,mBAAmB,KAAK,yBAAyB,IAAI,gBAAgB;AAAA,EACtF;AAlHA,MAcM,WACA;AAfN;AAAA;AAAA;AAcA,MAAM,YAAY;AAClB,MAAM,aAAa;AAAA;AAAA;;;ACYZ,WAAS,YAAY,MAAmB,KAAgB;AAC3D,QAAI,OAAO,IAAI,KAAK,UAAU,MAAM,YAAa;AACjD,QAAI;AACA,UAAI,KAAK,UAAU,IAAI;AAAA,QACnB,gBAAgB,KAAK;AAAA,QACrB,kBAAkB,KAAK;AAAA,QACvB,iBAAiB,KAAK;AAAA,QACtB,mBAAmB,KAAK;AAAA,QACxB,mBAAmB,KAAK;AAAA,MAC5B;AACA,cAAQ,KAAK,YAAY,KAAK,UAAU,iBAAiB;AAAA,IAC7D,SAAS,KAAK;AACV,cAAQ,KAAK,YAAY,KAAK,UAAU,iBAAiB,GAAG;AAAA,IAChE;AAAA,EACJ;AAzCA;AAAA;AAAA;AAAA;AAAA;;;AC2FA,WAAS,eAAuE;AA3FhF;AA4FI,UAAM,MAAM;AAKZ,QAAI,IAAI,eAAe;AACnB,YAAM,aAAW,eAAI,eAAc,oBAAlB,gCAAyC,CAAC;AAC3D,YAAM,iBAAe,eAAI,eAAc,0BAAlB,gCAA+C,CAAC;AACrE,aAAO;AAAA,QACH;AAAA,QACA,mBAAmB,IAAI,IAAI,YAAY;AAAA,MAC3C;AAAA,IACJ,OAAO;AAEH,YAAM,aAAW,SAAI,kBAAJ,mBAAmB,cAAa;AAAA,QAC7C;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACJ;AACA,YAAM,sBACF,SAAI,kBAAJ,mBAAmB,wBAAuB,oBAAI,IAAI,CAAC,oBAAoB,CAAC;AAC5E,aAAO,EAAE,UAAU,kBAAkB;AAAA,IACzC;AAAA,EACJ;AAOA,WAAS,UAAgB;AA9HzB;AA+HI,UAAM,MAAM;AACZ,UAAM,QAAQ;AAad,UAAM,EAAE,SAAS,IAAI,aAAa;AAGlC,QAAI,IAAI,WAAW;AACf,sBAAI,WAAU,SAAd;AAAA,IACJ;AAGA,aAAS,iBAAiB,QAAQ,EAAE,QAAQ,WAAS;AACjD,YAAM,iBAAiB,SAAS,SAAU,GAAG;AAtJrD,YAAAC,KAAAC,KAAAC;AAwJY,cAAM,SAAS,EAAE;AACjB,YAAI,EAAE,WAAW,SAAS,MAAM,SAAS,MAAM,GAAG;AAC9C,WAAAF,MAAA,MAAM,sBAAN,gBAAAA,IAAA;AACA,WAAAC,MAAA,MAAM,uBAAN,gBAAAA,IAAA,YAA2B,MAAM;AACjC,WAAAC,MAAA,MAAM,iCAAN,gBAAAA,IAAA;AAAA,QACJ;AAAA,MACJ,CAAC;AAAA,IACL,CAAC;AAGD,UAAM,UAAU,OAAO,WAAW,CAAC;AACnC,WAAO,UAAU;AACjB,QAAI,YAAY,MAAM,QAAQ,QAAQ,GAAG;AACrC,eAAS,QAAQ,QAAM;AArK/B,YAAAF,KAAAC;AAsKY,cAAM,QAAQ,SAAS,eAAe,EAAE;AACxC,YAAI,CAAC,SAAS,CAAC,IAAI,OAAQ;AAE3B,YAAI;AACA,gBAAM,iBAAiB,IAAI,IAAI,OAAO,EAAE;AACxC,kBAAQ,EAAE,IAAI;AAGd,cAAI,IAAI,eAAe;AACnB,aAAAA,OAAAD,MAAA,IAAI,eAAc,sBAAlB,gBAAAC,IAAA,KAAAD,KAAsC,IAAI;AAAA,UAC9C;AAAA,QACJ,SAAS,KAAK;AACV,kBAAQ,MAAM,yCAAyC,EAAE,MAAM,GAAG;AAAA,QACtE;AAAA,MACJ,CAAC;AAAA,IACL;AAGA,UAAM,iBAAiB,SAAS,eAAe,iBAAiB;AAChE,QAAI,gBAAgB;AAEhB,qBAAe,iBAAiB,SAAS,SAAU,GAAG;AA3L9D,YAAAA;AA4LY,YAAI;AACA,gBAAM,QAAQ,eAAe,cAAc,wBAAwB;AACnE,gBAAM,SAAS,EAAE;AACjB,cAAI,QAAQ,CAAC,MAAM,SAAS,MAAM,IAAI,WAAW,gBAAgB;AAC7D,kBAAM,kBAAkB,QAAQ,iBAAiB;AACjD,aAAAA,MAAA,mDAAiB,UAAjB,gBAAAA,IAAA;AAAA,UACJ;AAAA,QACJ,QAAQ;AAAA,QAER;AAAA,MACJ,CAAC;AAID,eAAS;AAAA,QACL;AAAA,QACA,SAAU,GAAG;AA5MzB,cAAAA;AA6MgB,cAAI;AAEA,gBAAI,eAAe,UAAU,SAAS,QAAQ,EAAG;AACjD,kBAAM,QAAQ,eAAe,cAAc,wBAAwB;AACnE,kBAAM,SAAS,EAAE;AACjB,gBAAI,SAAS,MAAM,SAAS,MAAM,EAAG;AACrC,kBAAM,kBAAkB,QAAQ,iBAAiB;AACjD,aAAAA,MAAA,mDAAiB,UAAjB,gBAAAA,IAAA;AAAA,UACJ,QAAQ;AAAA,UAER;AAAA,QACJ;AAAA,QACA;AAAA,MACJ;AAAA,IACJ;AAEA,gBAAM,yBAAN;AACA,gBAAM,2BAAN;AAEA,IACI,OACF,gCAAgC;AAClC,gBAAM,sBAAN;AACA,gBAAM,6BAAN;AAGA,QAAI,IAAI,eAAe;AACnB,sBAAI,eAAc,gBAAlB;AAAA,IACJ;AASA,QAAI,IAAI,gBAAgB;AACpB,YAAM,oBAAoB,SAAS,eAAe,oBAAoB;AACtE,UAAI,mBAAmB;AACnB,wBAAI,gBAAe,SAAnB,4BAA0B;AAAA,MAC9B;AAAA,IACJ;AAGA,QAAI,IAAI,kBAAkB;AACtB,YAAM,sBAAsB,SAAS,eAAe,uBAAuB;AAC3E,UAAI,qBAAqB;AACrB,wBAAI,kBAAiB,SAArB,4BAA4B;AAAA,MAChC;AAAA,IACJ;AAIA,QAAI,CAAC,IAAI,2BAA2B,IAAI,gBAAgB;AACpD,YAAM,oBAAoB,SAAS,eAAe,oBAAoB;AACtE,UAAI,mBAAmB;AACnB,wBAAI,gBAAe,SAAnB,4BAA0B;AAAA,MAC9B;AAAA,IACJ;AAEA,gBAAM,0BAAN;AACA,QAAI,IAAI,cAAc,OAAO,IAAI,WAAW,qBAAqB,YAAY;AACzE,UAAI,WAAW,iBAAiB;AAAA,IACpC;AAGA,QAAI,IAAI,gBAAgB;AACpB,sBAAI,gBAAe,SAAnB;AAAA,IACJ;AAGA,QAAI;AACA,2BAAqB;AAAA,IACzB,SAAS,KAAK;AACV,cAAQ,KAAK,iDAAiD,GAAG;AAAA,IACrE;AAIA,QAAI,yBAAqC,MAAM;AAAA,IAAC;AAChD,UAAM,wBAAwB,IAAI,QAAc,aAAW;AACvD,+BAAyB;AAAA,IAC7B,CAAC;AACD,IAAC,OAAe,0BAA0B;AAE1C,QAAI,IAAI,2BAA2B;AAC/B,UAAI;AACA,cAAM,aAAa,2BAA2B;AAC9C,cAAM,cAAc,sBAAsB;AAE1C,YAAI,YAAY,aAAa;AACzB,kBAAQ,KAAK,qDAAqD;AAClE,0BAAgB,wBAAwB;AAAA,QAC5C;AAEA,YAAI,WAAW,aAAa;AACxB,kBAAQ,KAAK,sDAAsD;AACnE,0BAAgB,sBAAsB;AAAA,QAC1C;AAEA,wBAAI,2BAA0B,SAA9B;AACA,gBAAQ,IAAI,kDAAkD;AAG9D,mBAAW,YAAY;AAtTnC,cAAAA;AAuTgB,cAAI;AACA,iBAAIA,MAAA,IAAI,8BAAJ,gBAAAA,IAA+B,gBAAgB;AAC/C,oBAAM,WAAW,MAAM,IAAI,0BAA0B,eAAe;AACpE,kBAAI,UAAU;AACV,wBAAQ,IAAI,0CAA0C;AAAA,cAC1D;AAAA,YACJ;AAAA,UACJ,SAAS,KAAK;AACV,oBAAQ,KAAK,mDAAmD,GAAG;AAAA,UACvE,UAAE;AAEE,mCAAuB;AAAA,UAC3B;AAAA,QACJ,GAAG,GAAG;AAAA,MACV,SAAS,KAAK;AACV,gBAAQ,KAAK,+DAA+D,GAAG;AAE/E,+BAAuB;AAAA,MAC3B;AAAA,IACJ,OAAO;AAEH,6BAAuB;AAAA,IAC3B;AAGA,QAAI,IAAI,gBAAgB;AACpB,UAAI;AACA,wBAAI,gBAAe,SAAnB;AAGA,mBAAW,MAAM;AArV7B,cAAAA;AAsVgB,cAAI;AACA,iBAAIA,MAAA,IAAI,mBAAJ,gBAAAA,IAAoB,gBAAgB;AACpC,kBAAI,eAAe,eAAe;AAAA,YACtC;AAAA,UACJ,UAAE;AAEE,YACI,OAIF,gCAAgC;AAClC,YACI,OACF,yBAAyB;AAAA,UAC/B;AAAA,QACJ,GAAG,GAAG;AAAA,MACV,SAAS,KAAK;AACV,gBAAQ,KAAK,yCAAyC,GAAG;AAAA,MAC7D;AAAA,IACJ;AAMA,QAAI;AACA,YAAM,SAAS,SAAS,eAAe,MAAM;AAC7C,UAAI,QAAQ;AACR,YAAI,OAAO,UAAU,SAAS,QAAQ,EAAG,QAAO,UAAU,OAAO,QAAQ;AAEzE,eAAO,MAAM,UAAU,OAAO,MAAM,WAAW;AAC/C,eAAO,MAAM,aAAa,OAAO,MAAM,cAAc;AAAA,MACzD;AAAA,IACJ,QAAQ;AAAA,IAER;AAQA,QAAI;AACA,YAAM,SAAS,SAAS,eAAe,MAAM;AAC7C,UAAI,UAAU,OAAO,iBAAiB,OAAO,kBAAkB,SAAS,MAAM;AAC1E,iBAAS,KAAK,YAAY,MAAM;AAChC,gBAAQ,KAAK,qEAAqE;AAAA,MACtF;AAAA,IACJ,QAAQ;AAAA,IAER;AAMA,QAAI;AACA,YAAM,qBAAqB,MAAM;AAC7B,YAAI;AACA,gBAAM,SAAS,MAAM,KAAK,SAAS,iBAAiB,QAAQ,CAAC;AAC7D,cAAI,QAAQ;AACZ,iBAAO,QAAQ,OAAK;AAChB,gBAAI,EAAE,iBAAiB,EAAE,kBAAkB,SAAS,MAAM;AACtD,uBAAS,KAAK,YAAY,CAAC;AAC3B,sBAAQ;AAAA,YACZ;AAAA,UACJ,CAAC;AACD,cAAI;AACA,oBAAQ;AAAA,cACJ;AAAA,YACJ;AACJ,iBAAO;AAAA,QACX,QAAQ;AACJ,iBAAO;AAAA,QACX;AAAA,MACJ;AAEA,yBAAmB;AACnB,iBAAW,oBAAoB,EAAE;AACjC,iBAAW,oBAAoB,GAAG;AAClC,iBAAW,oBAAoB,GAAG;AAAA,IACtC,QAAQ;AAAA,IAER;AAIA,QAAI;AACA,YAAM,SAAS,SAAS,eAAe,MAAM;AAC7C,UAAI,QAAQ;AACR,cAAM,OAAO,OAAO,sBAAsB;AAC1C,cAAM,KAAK,OAAO,iBAAiB,MAAM;AACzC,gBAAQ,KAAK,0BAA0B;AAAA,UACnC,WAAW,OAAO;AAAA,UAClB,SAAS,GAAG;AAAA,UACZ,YAAY,GAAG;AAAA,UACf,SAAS,GAAG;AAAA,UACZ,OAAO,KAAK;AAAA,UACZ,QAAQ,KAAK;AAAA,UACb,KAAK,KAAK;AAAA,UACV,MAAM,KAAK;AAAA,UACX,YAAY,KAAK,OAAO,OAAO,eAAe,MAAM,KAAK,SAAS;AAAA,QACtE,CAAC;AAID,YAAI;AACA,gBAAM,MAAM,KAAK,UAAU;AAAA,YACvB,WAAW,OAAO;AAAA,YAClB,SAAS,GAAG;AAAA,YACZ,YAAY,GAAG;AAAA,YACf,SAAS,GAAG;AAAA,YACZ,OAAO,KAAK,MAAM,KAAK,KAAK;AAAA,YAC5B,QAAQ,KAAK,MAAM,KAAK,MAAM;AAAA,YAC9B,KAAK,KAAK,MAAM,KAAK,GAAG;AAAA,YACxB,MAAM,KAAK,MAAM,KAAK,IAAI;AAAA,YAC1B,YAAY,KAAK,OAAO,OAAO,eAAe,MAAM,KAAK,SAAS;AAAA,UACtE,CAAC;AACD,iBAAO,aAAa,mBAAmB,GAAG;AAAA,QAC9C,QAAQ;AAAA,QAER;AAAA,MACJ,OAAO;AACH,gBAAQ,KAAK,0CAA0C;AAAA,MAC3D;AAAA,IACJ,SAAS,GAAG;AACR,cAAQ,KAAK,gCAAgC,CAAC;AAAA,IAClD;AAOA,UAAM,KAAK;AACX,mBAAe,YAAY;AACvB,UAAI;AAEA,cAAMG,yBAAyB,OAAe;AAC9C,YAAIA,wBAAuB;AACvB,cAAI;AACA,kBAAMA;AACN,oBAAQ,IAAI,4DAA4D;AAAA,UAC5E,SAAS,GAAG;AACR,oBAAQ,KAAK,2CAA2C,CAAC;AAAA,UAC7D;AAAA,QACJ;AAMA,cAAM,mBAAmB,MAAM;AAC3B,cAAI;AACA,kBAAM,SAAS,SAAS,eAAe,MAAM;AAC7C,gBAAI,UAAU,OAAO,iBAAiB,OAAO,kBAAkB,SAAS,MAAM;AAC1E,uBAAS,KAAK,YAAY,MAAM;AAChC,sBAAQ,KAAK,2DAA2D;AACxE,qBAAO;AAAA,YACX;AAAA,UACJ,QAAQ;AAAA,UAER;AACA,iBAAO;AAAA,QACX;AAIA,yBAAiB;AACjB,mBAAW,kBAAkB,EAAE;AAC/B,mBAAW,kBAAkB,GAAG;AAChC,mBAAW,kBAAkB,GAAG;AAUhC,cAAM,MAAM;AAGZ,YAAI,OAAO,IAAI,cAAc,eAAe,IAAI,gBAAgB,QAAW;AACvE,cAAI;AAGA,kBAAM,SAAS,MAAM;AAphBzC,kBAAAH,KAAAC;AAshBwB,mBAAIA,OAAAD,MAAA,IAAI,4BAAJ,gBAAAA,IAA6B,qBAA7B,gBAAAC,IAAA,KAAAD,MAAmD;AAEnD,uBAAO;AAAA,cACX;AACA,qBAAO;AAAA,YACX;AAEA,gBAAI,oBAAoB,OAAO;AAC/B,oBAAQ,KAAK,2CAA2C;AAAA,UAC5D,SAAS,GAAG;AACR,oBAAQ,MAAM,0CAA2C,EAAY,OAAO;AAAA,UAChF;AAAA,QACJ;AAGA,YAAI,IAAI,gBAAgB;AACpB,cAAI,mBAAmB,IAAI;AAC3B,kBAAQ,KAAK,uDAAuD;AAAA,QACxE;AAGA,YAAI,IAAI,cAAc;AAClB,cAAI,iBAAiB,IAAI;AACzB,kBAAQ,KAAK,mDAAmD;AAAA,QACpE;AAGA,YAAI,IAAI,gBAAgB;AACpB,cAAI,mBAAmB,IAAI;AAC3B,kBAAQ,KAAK,uDAAuD;AAAA,QACxE;AAGA,YAAI,IAAI,iBAAiB;AACrB,cAAI,oBAAoB,IAAI;AAC5B,kBAAQ,KAAK,yDAAyD;AAAA,QAC1E;AAGA,YAAI,IAAI,gBAAgB;AACpB,cAAI,mBAAmB,IAAI;AAC3B,kBAAQ,KAAK,uDAAuD;AAAA,QACxE;AAGA,YAAI,IAAI,gBAAgB;AACpB,kBAAQ,KAAK,8CAA8C;AAAA,QAC/D;AAGA,YAAI,IAAI,YAAY;AAChB,cAAI,eAAe,IAAI;AACvB,kBAAQ,KAAK,+CAA+C;AAAA,QAChE;AAGA,YAAI,IAAI,WAAW;AACf,cAAI,cAAc,IAAI;AACtB,kBAAQ,KAAK,6CAA6C;AAAA,QAC9D;AAKA,YAAI,OAAO,IAAI,0BAA0B,aAAa;AAClD,cAAI;AACA,kBAAMI,YAAW,IAAI;AACrB;AAAA,cACI;AAAA,gBACI,YAAY;AAAA,gBACZ,cAAc;AAAA,gBACd,eAAe,MAA2B;AACtC,sBAAI;AACA,0BAAM,UAAUA,UAAS,cAAc,QAAQ,KAAK,CAAC;AACrD,0BAAM,cAAc,QAAQ,CAAC;AAC7B,wBAAI,eAAe,OAAO,YAAY,WAAW,YAAY;AACzD,4BAAM,UAAU,IAAI,aACd,IAAI,IAAI,WAAW;AAAA,wBACf,QAAO,6BAAM,UAAS;AAAA,wBACtB,QAAQ;AAAA,sBACZ,CAAC,IACD;AACN,0BAAI,SAAS;AACT,oCAAY,OAAO,OAAO;AAC1B,+BAAO;AAAA,0BACH,YAAY,QAAQ;AAAA,0BACpB,MAAM;AAAA,0BACN,OAAO,QAAQ;AAAA,wBACnB;AAAA,sBACJ;AAAA,oBACJ;AACA,2BAAO;AAAA,kBACX,SAAS,GAAG;AACR,4BAAQ;AAAA,sBACJ;AAAA,sBACA;AAAA,oBACJ;AACA,2BAAO;AAAA,kBACX;AAAA,gBACJ;AAAA,gBACA,mBAAmB;AACf,sBAAI;AACA,0BAAM,UAAUA,UAAS,cAAc,QAAQ,KAAK,CAAC;AACrD,wBAAI,YAAY;AAChB,4BAAQ,QAAQ,CAACC,SAAa;AAC1B,0BAAIA,KAAI,QAAQ,OAAOA,KAAI,KAAK,SAAS,UAAU;AAC/C,qCAAaA,KAAI,KAAK;AAAA,sBAC1B;AAAA,oBACJ,CAAC;AACD,2BAAO;AAAA,kBACX,QAAQ;AACJ,2BAAO;AAAA,kBACX;AAAA,gBACJ;AAAA,gBACA,kBAAkB;AACd,sBAAI;AACA,0BAAM,UAAUD,UAAS,cAAc,QAAQ,KAAK,CAAC;AACrD,0BAAM,UAAiB,CAAC;AACxB,4BAAQ,QAAQ,CAACC,SAAa;AAC1B,0BAAIA,KAAI,QAAQ,OAAOA,KAAI,KAAK,WAAW,YAAY;AACnD,8BAAM,OAAO,MAAM,KAAKA,KAAI,KAAK,OAAO,CAAC;AACzC,6BAAK,QAAQ,CAAC,QAAa;AACvB,kCAAQ,KAAK;AAAA,4BACT,YAAY,IAAI;AAAA,4BAChB,MAAM;AAAA,4BACN,OAAO,IAAI,SAAS;AAAA,4BACpB,MAAM,MAAG;AAppB7D,kCAAAL;AAopBgE,sCAAAA,MAAA,IAAI,SAAJ,gBAAAA,IAAA;AAAA;AAAA,4BACZ,MAAM,MAAG;AArpB7D,kCAAAA;AAqpBgE,sCAAAA,MAAA,IAAI,SAAJ,gBAAAA,IAAA;AAAA;AAAA,0BAChB,CAAC;AAAA,wBACL,CAAC;AAAA,sBACL;AAAA,oBACJ,CAAC;AACD,2BAAO;AAAA,kBACX,QAAQ;AACJ,2BAAO,CAAC;AAAA,kBACZ;AAAA,gBACJ;AAAA,gBACA,oBAAoB;AAChB,sBAAI;AACA,0BAAM,eAAeI,UAAS,gBAAgB;AAC9C,wBAAI,gBAAgB,aAAa,SAAS,UAAU;AAChD,4BAAM,eAAe;AACrB,0BAAI,aAAa,eAAe,aAAa,MAAM;AAC/C,8BAAM,YAAY,aAAa,KAAK;AAAA,0BAChC,aAAa;AAAA,wBACjB;AACA,4BAAI,WAAW;AACX,iCAAO;AAAA,4BACH,YAAY,UAAU;AAAA,4BACtB,MAAM;AAAA,4BACN,OAAO,UAAU,SAAS;AAAA,0BAC9B;AAAA,wBACJ;AAAA,sBACJ;AAAA,oBACJ;AAEA,0BAAM,UAAUA,UAAS,cAAc,QAAQ,KAAK,CAAC;AACrD,+BAAWC,QAAO,SAAS;AACvB,4BAAM,IAAIA;AACV,0BAAI,EAAE,aAAa,EAAE,UAAU,GAAG;AAC9B,4BAAI,EAAE,eAAe,EAAE,MAAM;AACzB,gCAAM,YAAY,EAAE,KAAK,IAAI,EAAE,WAAW;AAC1C,8BAAI,WAAW;AACX,mCAAO;AAAA,8BACH,YAAY,UAAU;AAAA,8BACtB,MAAM;AAAA,8BACN,OAAO,UAAU,SAAS;AAAA,4BAC9B;AAAA,0BACJ;AAAA,wBACJ;AAAA,sBACJ;AAAA,oBACJ;AAEA,wBAAI,QAAQ,SAAS,GAAG;AACpB,4BAAM,cAAc,QAAQ,CAAC;AAC7B,0BAAI,YAAY,eAAe,YAAY,MAAM;AAC7C,8BAAM,YAAY,YAAY,KAAK;AAAA,0BAC/B,YAAY;AAAA,wBAChB;AACA,4BAAI,WAAW;AACX,iCAAO;AAAA,4BACH,YAAY,UAAU;AAAA,4BACtB,MAAM;AAAA,4BACN,OAAO,UAAU,SAAS;AAAA,0BAC9B;AAAA,wBACJ;AAAA,sBACJ;AAAA,oBACJ;AACA,2BAAO;AAAA,kBACX,SAAS,GAAG;AACR,4BAAQ;AAAA,sBACJ;AAAA,sBACA;AAAA,oBACJ;AACA,2BAAO;AAAA,kBACX;AAAA,gBACJ;AAAA,gBACA,kBAAkB,YAAoB;AA3tBlE,sBAAAL,KAAAC;AA4tBgC,sBAAI;AACA,0BAAM,UAAUG,UAAS,cAAc,QAAQ,KAAK,CAAC;AACrD,+BAAWC,QAAO,SAAS;AACvB,2BAAKL,MAAAK,KAAY,SAAZ,gBAAAL,IAAkB,IAAI,aAAa;AACpC,yBAACC,MAAAI,KAAY,iBAAZ,gBAAAJ,IAAA,KAAAI,MAA2B;AAC5B,wBAAAD,UAAS,gBAAgBC,KAAI,EAAE;AAC/B;AAAA,sBACJ;AAAA,oBACJ;AAAA,kBACJ,SAAS,GAAG;AACR,4BAAQ;AAAA,sBACJ;AAAA,sBACA;AAAA,oBACJ;AAAA,kBACJ;AAAA,gBACJ;AAAA,cACJ;AAAA,cACA;AAAA,YACJ;AAAA,UACJ,SAAS,GAAG;AACR,oBAAQ,KAAK,iDAAiD,CAAC;AAAA,UACnE;AAAA,QACJ;AAEA,WAAG,cAAc;AACjB,gBAAQ,KAAK,6BAA6B;AAK1C,SAAC,SAAS,0BAA0B;AAChC,gBAAM,WAAW,CAAC,IAAI,KAAK,KAAK,KAAM,GAAI;AAC1C,gBAAM,aAAa,MAAM;AACrB,gBAAI;AACA,oBAAM,IAAI;AACV,oBAAM,cAAc,CAAC,MAAc,eAAwB;AACvD,oBAAI;AACA,wBAAM,OAAO,EAAE,IAAI,KAAK,EAAE,cAAc,IAAI;AAC5C,sBAAI,MAAM;AAEN,wBAAI,OAAO,EAAE,cAAc,IAAI,MAAM,aAAa;AAC9C,wBAAE,cAAc,IAAI,IAAI;AAAA,oBAC5B;AACA,0BAAM,QAAQ,KAAK,IAAI;AACvB,wBAAI,OAAO,EAAE,KAAK,MAAM,aAAa;AACjC,wBAAE,KAAK,IAAI;AAAA,oBACf;AAAA,kBACJ;AAAA,gBACJ,QAAQ;AAAA,gBAER;AAAA,cACJ;AAGA;AAAA,gBACI;AAAA,gBACA;AAAA,gBACA;AAAA,gBACA;AAAA,gBACA;AAAA,gBACA;AAAA,gBACA;AAAA,gBACA;AAAA,cACJ,EAAE,QAAQ,OAAK,YAAY,CAAC,CAAC;AAAA,YACjC,QAAQ;AAAA,YAER;AAAA,UACJ;AAGA,qBAAW;AACX,mBAAS,QAAQ,CAAAC,OAAK,WAAW,YAAYA,EAAC,CAAC;AAAA,QACnD,GAAG;AAAA,MACP,QAAQ;AAAA,MAER;AAAA,IACJ;AAEA,QAAI,SAAS,eAAe,YAAY;AAEpC,gBAAU;AAAA,IACd,OAAO;AACH,aAAO,iBAAiB,QAAQ,WAAW,EAAE,MAAM,KAAK,CAAC;AAGzD,iBAAW,MAAM;AACb,YAAI,CAAC,GAAG,aAAa;AACjB,kBAAQ;AAAA,YACJ;AAAA,UACJ;AACA,oBAAU;AAAA,QACd;AAAA,MACJ,GAAG,GAAI;AAAA,IACX;AAAA,EACJ;AA1zBA;AAAA;AAAA;AAcA;AACA;AAKA;AA4yBA,OAAC,MAAM;AACH,YAAI,OAAO,OAAO,YAAY,YAAY;AACtC,iBAAO,UAAU;AAAA,QACrB;AAGA,YAAI,SAAS,eAAe,WAAW;AACnC,mBAAS,iBAAiB,oBAAoB,OAAO;AAAA,QACzD,OAAO;AAEH,kBAAQ;AAAA,QACZ;AAAA,MACJ,GAAG;AAAA;AAAA;;;AC50BH;AAAA;AASA;AAGA;AAGA;AAGA;AACA;AACA;AAGA,uBAAO;AACP,kCAAO;AACP,8BAAO;AACP;AACA,8BAAO;AACP,mCAAO;AACP,qCAAO;AACP;AACA;AACA;AACA,iCAAO;AACP;AACA,2BAAO;AACP,yBAAO;AACP;AACA,oCAAO;AACP,iCAAO;AAGP;AACA;AACA;AAGA;AACA;AAGA;AACA;AACA,wCAAO;AAIP;AACA;AAGA;AACA,mCAAO;AAEP,+BAAO;AACP,qCAAO;AACP,+BAAO;AACP;AACA,sCAAO;AACP;AACA,sCAAO;AACP,8BAAO;AAGP,8BAAO;AAGP;AAEA;AACA,6BAAO;AACP,8CAAO;AACP;AAEA;AAKA;AAnFA,cAAQ,IAAI,uCAAuC;AA0FnD,UAAM,IAAI;AAEV,UAAI,EAAE,cAAc,IAAI;AACpB,UAAE,UAAU,IAAI;AAAA,MACpB;AAGA,UAAI;AACA,YAAI,CAAE,EAAU,WAAY,CAAC,EAAU,aAAa;AACpD,YAAI,CAAE,EAAU,aAAc,CAAC,EAAU,eAAe;AACxD,YAAI,CAAE,EAAU,eAAgB,CAAC,EAAU,iBAAiB;AAAA,MAChE,QAAQ;AAAA,MAER;AAEA,UAAI;AACA,gBAAQ,IAAI,6BAA6B;AAAA,UACrC,YAAY,CAAC,CAAE,EAAU;AAAA,UACzB,cAAc,CAAC,CAAE,EAAU;AAAA,UAC3B,gBAAgB,CAAC,CAAE,EAAU;AAAA,UAC7B,gBAAgB,CAAC,CAAE,EAAU;AAAA,UAC7B,WAAW,CAAC,CAAE,EAAU;AAAA,QAC5B,CAAC;AAAA,MACL,QAAQ;AAAA,MAER;AAIA,UAAI,OAAO,EAAE,YAAY,YAAY;AACjC,gBAAQ,IAAI,4CAA4C,SAAS,UAAU;AAC3E,YAAI,SAAS,eAAe,WAAW;AACnC,mBAAS,iBAAiB,oBAAoB,EAAE,OAAO;AAAA,QAC3D,OAAO;AACH,YAAE,QAAQ;AAAA,QACd;AAAA,MACJ,OAAO;AACH,gBAAQ,MAAM,mEAAmE;AAAA,MACrF;AAGA,QAAE,mBAAmB;AAAA;AAAA;",
  "names": ["logger", "logger", "module", "API", "appI18n", "BASE_Z_INDEX", "_a", "_b", "translate", "BASE_Z_INDEX", "translate", "_a", "_b", "DESKTOP_SHORTCUTS", "getDockReservedBottom", "sendTextEditorMenuAction", "translate", "t", "renderApplicationMenu", "info", "registry", "_a", "_b", "r", "_a", "_b", "_c", "minTop", "openModal", "toggleDarkMode", "getMenuItemsForTarget", "clearMenu", "renderMenu", "clampPosition", "showContextMenu", "buildAndOpenAt", "hideContextMenu", "bindAutoClose", "unbindAutoClose", "t", "APP_CONSTANTS", "getModalIds", "updateDockIndicators", "syncTopZIndexWithDOM", "APP_CONSTANTS", "BaseWindowInstance", "WindowChrome", "window", "t", "window", "BASE_Z_INDEX", "window", "t", "parts", "resolved", "t", "W", "window", "t", "W", "window", "parts", "API", "t", "t", "window", "window", "t", "_a", "_a", "_b", "_a", "appI18n", "API", "applyTranslations", "w", "t", "translate", "WindowChrome", "_a", "integration", "API", "appI18n", "toggle", "registry", "trigger", "_a", "t", "_a", "_b", "_c", "sessionRestorePromise", "registry", "win", "t"]
}
