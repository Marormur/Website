{"version":3,"file":"context-menu.js","sourceRoot":"","sources":["../src/ts/context-menu.ts"],"names":[],"mappings":"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","sourcesContent":["/*\r\n * src/ts/context-menu.ts\r\n * Typed port of js/context-menu.js\r\n */\r\n\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nconst guardKey = '__customContextMenuInit';\r\nif ((window as any)[guardKey]) {\r\n    // already initialized\r\n} else {\r\n    (window as any)[guardKey] = true;\r\n\r\n    const i18n =\r\n        (window as any).appI18n ||\r\n        ({\r\n            translate: (k: string) => k,\r\n            applyTranslations: (_el?: Element) => {},\r\n        } as { translate: (k: string) => string; applyTranslations: (el?: Element) => void });\r\n\r\n    const hideAllDropdowns =\r\n        typeof (window as any).hideMenuDropdowns === 'function'\r\n            ? (window as any).hideMenuDropdowns\r\n            : () => {\r\n                  const domUtils = (window as any).DOMUtils;\r\n                  document.querySelectorAll('.menu-dropdown').forEach(d => {\r\n                      if (domUtils && typeof domUtils.hide === 'function') {\r\n                          domUtils.hide(d);\r\n                      } else {\r\n                          d.classList.add('hidden');\r\n                      }\r\n                  });\r\n                  document\r\n                      .querySelectorAll('[aria-expanded=\"true\"]')\r\n                      .forEach(b => b.setAttribute('aria-expanded', 'false'));\r\n              };\r\n\r\n    function openModal(id: string) {\r\n        const el = document.getElementById(id);\r\n        if (!el) return;\r\n        if (!(window as any).dialogs) (window as any).dialogs = {};\r\n        if (!(window as any).dialogs[id] && typeof (window as any).Dialog === 'function') {\r\n            try {\r\n                (window as any).dialogs[id] = new (window as any).Dialog(id);\r\n            } catch {\r\n                // noop\r\n            }\r\n        }\r\n        const dlg = (window as any).dialogs[id];\r\n        if (dlg && typeof dlg.open === 'function') {\r\n            dlg.open();\r\n        } else {\r\n            const domUtils = (window as any).DOMUtils;\r\n            if (domUtils && typeof domUtils.show === 'function') {\r\n                domUtils.show(el);\r\n            } else {\r\n                el.classList.remove('hidden');\r\n            }\r\n            if (typeof (window as any).bringDialogToFront === 'function') {\r\n                (window as any).bringDialogToFront(id);\r\n            }\r\n        }\r\n        if (typeof (window as any).updateProgramLabelByTopModal === 'function') {\r\n            (window as any).updateProgramLabelByTopModal();\r\n        }\r\n    }\r\n\r\n    function toggleDarkMode() {\r\n        if (\r\n            (window as any).SystemUI &&\r\n            typeof (window as any).SystemUI.handleSystemToggle === 'function'\r\n        ) {\r\n            (window as any).SystemUI.handleSystemToggle('dark-mode');\r\n        } else {\r\n            const next = !document.documentElement.classList.contains('dark');\r\n            document.documentElement.classList.toggle('dark', next);\r\n            if (\r\n                (window as any).ThemeSystem &&\r\n                typeof (window as any).ThemeSystem.setThemePreference === 'function'\r\n            ) {\r\n                (window as any).ThemeSystem.setThemePreference(next ? 'dark' : 'light');\r\n            }\r\n        }\r\n    }\r\n\r\n    function getMenuItemsForTarget(target: Element | null) {\r\n        const items: Array<any> = [];\r\n        const inDesktop = !!(\r\n            target &&\r\n            (target as Element).closest &&\r\n            (target as Element).closest('#desktop')\r\n        );\r\n        const inDockItem = !!(\r\n            target &&\r\n            (target as Element).closest &&\r\n            (target as Element).closest('#dock .dock-item')\r\n        );\r\n        const inImageModal = !!(\r\n            target &&\r\n            (target as Element).closest &&\r\n            (target as Element).closest('#image-modal')\r\n        );\r\n        const inFinderModal = !!(\r\n            target &&\r\n            (target as Element).closest &&\r\n            (target as Element).closest('#finder-modal')\r\n        );\r\n\r\n        if (inDockItem) {\r\n            const dockItem = (target as Element).closest('#dock .dock-item') as Element | null;\r\n            const winId = dockItem && dockItem.getAttribute('data-window-id');\r\n            if (winId) {\r\n                items.push({\r\n                    id: 'open-dock-window',\r\n                    label: i18n.translate('context.open') || 'Öffnen',\r\n                    action: () => openModal(winId),\r\n                });\r\n                items.push({ type: 'separator' });\r\n            }\r\n        }\r\n\r\n        if (inImageModal && typeof (window as any).getImageViewerState === 'function') {\r\n            const st = (window as any).getImageViewerState();\r\n            if (st && st.hasImage) {\r\n                items.push({\r\n                    id: 'image-open-tab',\r\n                    label:\r\n                        i18n.translate('context.image.openInTab') ||\r\n                        i18n.translate('menu.image.openInTab') ||\r\n                        'Bild in neuem Tab öffnen',\r\n                    action: () => {\r\n                        if (typeof (window as any).openActiveImageInNewTab === 'function')\r\n                            (window as any).openActiveImageInNewTab();\r\n                    },\r\n                });\r\n                items.push({\r\n                    id: 'image-save',\r\n                    label:\r\n                        i18n.translate('context.image.save') ||\r\n                        i18n.translate('menu.image.saveImage') ||\r\n                        'Bild sichern …',\r\n                    action: () => {\r\n                        if (typeof (window as any).downloadActiveImage === 'function')\r\n                            (window as any).downloadActiveImage();\r\n                    },\r\n                });\r\n                items.push({ type: 'separator' });\r\n            }\r\n        }\r\n\r\n        if (inFinderModal) {\r\n            const finderItem =\r\n                target &&\r\n                (target as Element).closest &&\r\n                (target as Element).closest('.finder-list-item, .finder-grid-item');\r\n            if (finderItem) {\r\n                const itemName = (finderItem as Element).getAttribute('data-item-name');\r\n                const itemType = (finderItem as Element).getAttribute('data-item-type');\r\n                if (itemName && itemType) {\r\n                    items.push({\r\n                        id: 'finder-open-item',\r\n                        label: i18n.translate('context.finder.openItem') || 'Öffnen',\r\n                        action: () => {\r\n                            if (\r\n                                (window as any).FinderSystem &&\r\n                                typeof (window as any).FinderSystem.openItem === 'function'\r\n                            )\r\n                                (window as any).FinderSystem.openItem(itemName, itemType);\r\n                        },\r\n                    });\r\n\r\n                    // \"Open with Preview\" for image files\r\n                    const isImage = /\\.(png|jpe?g|gif|bmp|webp|svg)$/i.test(itemName);\r\n                    if (isImage && itemType === 'file') {\r\n                        items.push({\r\n                            id: 'finder-open-with-preview',\r\n                            label: i18n.translate('context.finder.openWithPreview') || 'Öffnen mit Vorschau',\r\n                            action: () => {\r\n                                // Use ActionBus for simplicity\r\n                                const ab = (window as any).ActionBus;\r\n                                if (ab && typeof ab.execute === 'function') {\r\n                                    ab.execute('openWithPreview', { itemName });\r\n                                }\r\n                            },\r\n                        });\r\n                    }\r\n\r\n                    items.push({ type: 'separator' });\r\n                    items.push({\r\n                        id: 'finder-get-info',\r\n                        label: i18n.translate('context.finder.getInfo') || 'Informationen',\r\n                        action: () => {\r\n                            console.log('Get info for:', itemName, itemType);\r\n                        },\r\n                    });\r\n                    return items;\r\n                }\r\n            }\r\n\r\n            items.push({\r\n                id: 'finder-refresh',\r\n                label: i18n.translate('context.finder.refresh') || 'Aktualisieren',\r\n                action: () => {\r\n                    if (\r\n                        (window as any).FinderSystem &&\r\n                        typeof (window as any).FinderSystem.navigateTo === 'function'\r\n                    ) {\r\n                        const state = (window as any).FinderSystem.getState();\r\n                        if (state) {\r\n                            (window as any).FinderSystem.navigateTo(\r\n                                state.currentPath,\r\n                                state.currentView\r\n                            );\r\n                        }\r\n                    }\r\n                },\r\n            });\r\n            items.push({ type: 'separator' });\r\n\r\n            const currentViewMode =\r\n                (window as any).FinderSystem && (window as any).FinderSystem.getState\r\n                    ? (window as any).FinderSystem.getState().viewMode\r\n                    : 'list';\r\n            if (currentViewMode !== 'list') {\r\n                items.push({\r\n                    id: 'finder-view-list',\r\n                    label: i18n.translate('context.finder.viewList') || 'Als Liste',\r\n                    action: () => {\r\n                        if (\r\n                            (window as any).FinderSystem &&\r\n                            typeof (window as any).FinderSystem.setViewMode === 'function'\r\n                        )\r\n                            (window as any).FinderSystem.setViewMode('list');\r\n                    },\r\n                });\r\n            }\r\n            if (currentViewMode !== 'grid') {\r\n                items.push({\r\n                    id: 'finder-view-grid',\r\n                    label: i18n.translate('context.finder.viewGrid') || 'Als Raster',\r\n                    action: () => {\r\n                        if (\r\n                            (window as any).FinderSystem &&\r\n                            typeof (window as any).FinderSystem.setViewMode === 'function'\r\n                        )\r\n                            (window as any).FinderSystem.setViewMode('grid');\r\n                    },\r\n                });\r\n            }\r\n            items.push({ type: 'separator' });\r\n\r\n            items.push({\r\n                id: 'finder-sort-name',\r\n                label: i18n.translate('context.finder.sortByName') || 'Nach Name sortieren',\r\n                action: () => {\r\n                    if (\r\n                        (window as any).FinderSystem &&\r\n                        typeof (window as any).FinderSystem.setSortBy === 'function'\r\n                    )\r\n                        (window as any).FinderSystem.setSortBy('name');\r\n                },\r\n            });\r\n            items.push({\r\n                id: 'finder-sort-date',\r\n                label: i18n.translate('context.finder.sortByDate') || 'Nach Datum sortieren',\r\n                action: () => {\r\n                    if (\r\n                        (window as any).FinderSystem &&\r\n                        typeof (window as any).FinderSystem.setSortBy === 'function'\r\n                    )\r\n                        (window as any).FinderSystem.setSortBy('date');\r\n                },\r\n            });\r\n            items.push({\r\n                id: 'finder-sort-size',\r\n                label: i18n.translate('context.finder.sortBySize') || 'Nach Größe sortieren',\r\n                action: () => {\r\n                    if (\r\n                        (window as any).FinderSystem &&\r\n                        typeof (window as any).FinderSystem.setSortBy === 'function'\r\n                    )\r\n                        (window as any).FinderSystem.setSortBy('size');\r\n                },\r\n            });\r\n\r\n            return items;\r\n        }\r\n\r\n        if (inDesktop) {\r\n            items.push({\r\n                id: 'open-finder',\r\n                label: i18n.translate('context.openFinder') || 'Finder öffnen',\r\n                action: () => openModal('finder-modal'),\r\n            });\r\n            items.push({\r\n                id: 'open-text',\r\n                label: i18n.translate('context.openTextEditor') || 'Texteditor öffnen',\r\n                action: () => openModal('text-modal'),\r\n            });\r\n            items.push({\r\n                id: 'open-projects',\r\n                label: i18n.translate('context.openProjects') || 'Projekte öffnen',\r\n                action: () => openModal('projects-modal'),\r\n            });\r\n            items.push({ type: 'separator' });\r\n            items.push({\r\n                id: 'toggle-dark',\r\n                label: i18n.translate('context.toggleDarkMode') || 'Dark Mode umschalten',\r\n                action: toggleDarkMode,\r\n            });\r\n            items.push({\r\n                id: 'open-settings',\r\n                label: i18n.translate('context.openSettings') || 'Systemeinstellungen …',\r\n                action: () => openModal('settings-modal'),\r\n            });\r\n            items.push({ type: 'separator' });\r\n            items.push({\r\n                id: 'about',\r\n                label: i18n.translate('context.about') || 'Über Marvin',\r\n                action: () => openModal('about-modal'),\r\n            });\r\n            return items;\r\n        }\r\n\r\n        items.push({\r\n            id: 'open-finder',\r\n            label: i18n.translate('context.openFinder') || 'Finder öffnen',\r\n            action: () => openModal('finder-modal'),\r\n        });\r\n        items.push({\r\n            id: 'open-text',\r\n            label: i18n.translate('context.openTextEditor') || 'Texteditor öffnen',\r\n            action: () => openModal('text-modal'),\r\n        });\r\n        items.push({ type: 'separator' });\r\n        items.push({\r\n            id: 'toggle-dark',\r\n            label: i18n.translate('context.toggleDarkMode') || 'Dark Mode umschalten',\r\n            action: toggleDarkMode,\r\n        });\r\n        items.push({\r\n            id: 'open-settings',\r\n            label: i18n.translate('context.openSettings') || 'Systemeinstellungen …',\r\n            action: () => openModal('settings-modal'),\r\n        });\r\n        items.push({ type: 'separator' });\r\n        items.push({\r\n            id: 'about',\r\n            label: i18n.translate('context.about') || 'Über Marvin',\r\n            action: () => openModal('about-modal'),\r\n        });\r\n        return items;\r\n    }\r\n\r\n    // Create DOM once\r\n    const menu = document.createElement('ul');\r\n    menu.id = 'context-menu';\r\n    menu.className = 'menu-dropdown context-menu hidden';\r\n    menu.setAttribute('role', 'menu');\r\n    menu.setAttribute('aria-label', i18n.translate('context.menuLabel') || 'Kontextmenü');\r\n\r\n    document.addEventListener('DOMContentLoaded', () => {\r\n        if (!document.body.contains(menu)) document.body.appendChild(menu);\r\n        try {\r\n            i18n.applyTranslations(menu);\r\n        } catch {}\r\n    });\r\n\r\n    function clearMenu() {\r\n        while (menu.firstChild) menu.removeChild(menu.firstChild);\r\n    }\r\n\r\n    function renderMenu(items: Array<any>) {\r\n        clearMenu();\r\n        const fragment = document.createDocumentFragment();\r\n        let firstFocusable: HTMLElement | null = null;\r\n        items.forEach((it: any, idx: number) => {\r\n            if (it.type === 'separator') {\r\n                const sep = document.createElement('li');\r\n                sep.className = 'menu-separator';\r\n                sep.setAttribute('role', 'separator');\r\n                fragment.appendChild(sep);\r\n                return;\r\n            }\r\n            const li = document.createElement('li');\r\n            const btn = document.createElement('button');\r\n            btn.type = 'button';\r\n            btn.className = 'menu-item';\r\n            btn.setAttribute('role', 'menuitem');\r\n            btn.tabIndex = -1;\r\n            btn.dataset.itemId = it.id || 'item-' + idx;\r\n            const labelSpan = document.createElement('span');\r\n            labelSpan.className = 'menu-item-label';\r\n            labelSpan.textContent = it.label || '';\r\n            btn.appendChild(labelSpan);\r\n            btn.addEventListener('click', ev => {\r\n                ev.stopPropagation();\r\n                hideContextMenu();\r\n                try {\r\n                    if (it.action) {\r\n                        it.action();\r\n                    }\r\n                } catch (e) {\r\n                    console.warn('Context action failed', e);\r\n                }\r\n            });\r\n            li.appendChild(btn);\r\n            fragment.appendChild(li);\r\n            if (!firstFocusable) firstFocusable = btn;\r\n        });\r\n        menu.appendChild(fragment);\r\n        try {\r\n            i18n.applyTranslations(menu);\r\n        } catch {}\r\n        return firstFocusable;\r\n    }\r\n\r\n    function clampPosition(x: number, y: number) {\r\n        const rect = menu.getBoundingClientRect();\r\n        const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\r\n        const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\r\n        const margin = 6;\r\n        const nx = Math.min(Math.max(margin, x), Math.max(margin, vw - rect.width - margin));\r\n        const ny = Math.min(Math.max(margin, y), Math.max(margin, vh - rect.height - margin));\r\n        return { x: nx, y: ny };\r\n    }\r\n\r\n    function showContextMenu(ev: MouseEvent) {\r\n        const target = ev.target instanceof Element ? ev.target : null;\r\n        if (!target) return;\r\n        if (target.closest('input, textarea, [contenteditable=\"true\"]')) return;\r\n        ev.preventDefault();\r\n        ev.stopPropagation();\r\n        hideAllDropdowns();\r\n        buildAndOpenAt(ev.clientX, ev.clientY, target);\r\n    }\r\n\r\n    function buildAndOpenAt(x: number, y: number, target: Element | null) {\r\n        const items = getMenuItemsForTarget(target);\r\n        const firstFocusable = renderMenu(items);\r\n        if (document.body && menu.parentElement !== document.body) {\r\n            document.body.appendChild(menu);\r\n        } else if (document.body && document.body.lastElementChild !== menu) {\r\n            document.body.appendChild(menu);\r\n        }\r\n        const domUtils = (window as any).DOMUtils;\r\n        if (domUtils && typeof domUtils.show === 'function') {\r\n            domUtils.show(menu);\r\n        } else {\r\n            menu.classList.remove('hidden');\r\n        }\r\n        menu.style.left = Math.max(0, x) + 'px';\r\n        menu.style.top = Math.max(0, y) + 'px';\r\n        const clamped = clampPosition(x, y);\r\n        menu.style.left = clamped.x + 'px';\r\n        menu.style.top = clamped.y + 'px';\r\n        if (lastInvokeWasKeyboard && firstFocusable) {\r\n            (firstFocusable as HTMLElement).focus();\r\n        }\r\n        bindAutoClose();\r\n    }\r\n\r\n    function hideContextMenu() {\r\n        const domUtils = (window as any).DOMUtils;\r\n        if (!menu.classList.contains('hidden')) {\r\n            if (domUtils && typeof domUtils.hide === 'function') {\r\n                domUtils.hide(menu);\r\n            } else {\r\n                menu.classList.add('hidden');\r\n            }\r\n        }\r\n        unbindAutoClose();\r\n    }\r\n\r\n    let onDocClick: ((e: Event) => void) | null = null;\r\n    let onDocScroll: (() => void) | null = null;\r\n    let onResize: (() => void) | null = null;\r\n    let onKeyDown: ((e: KeyboardEvent) => void) | null = null;\r\n\r\n    function bindAutoClose() {\r\n        unbindAutoClose();\r\n        onDocClick = (e: Event) => {\r\n            const t = e.target instanceof Element ? e.target : null;\r\n            if (!t) {\r\n                hideContextMenu();\r\n                return;\r\n            }\r\n            if (t.closest('#context-menu')) return;\r\n            hideContextMenu();\r\n        };\r\n        onDocScroll = () => hideContextMenu();\r\n        onResize = () => hideContextMenu();\r\n        onKeyDown = (e: KeyboardEvent) => {\r\n            const items = Array.from(menu.querySelectorAll('.menu-item')) as HTMLElement[];\r\n            const focusIdx = items.findIndex(el => el === document.activeElement);\r\n            if (e.key === 'Escape') {\r\n                e.preventDefault();\r\n                hideContextMenu();\r\n                return;\r\n            }\r\n            if (!items.length) return;\r\n            if (e.key === 'ArrowDown') {\r\n                e.preventDefault();\r\n                const next = items[(Math.max(0, focusIdx) + 1) % items.length];\r\n                if (next) next.focus();\r\n            } else if (e.key === 'ArrowUp') {\r\n                e.preventDefault();\r\n                const next = items[(focusIdx > 0 ? focusIdx : items.length) - 1];\r\n                if (next) next.focus();\r\n            } else if (e.key === 'Home') {\r\n                e.preventDefault();\r\n                items[0]?.focus();\r\n            } else if (e.key === 'End') {\r\n                e.preventDefault();\r\n                items[items.length - 1]?.focus();\r\n            } else if (e.key === 'Enter' || e.key === ' ') {\r\n                if (\r\n                    document.activeElement &&\r\n                    (document.activeElement as Element).classList.contains('menu-item')\r\n                ) {\r\n                    e.preventDefault();\r\n                    (document.activeElement as HTMLElement).click();\r\n                }\r\n            }\r\n        };\r\n        document.addEventListener('click', onDocClick as EventListener, { capture: true });\r\n        document.addEventListener('contextmenu', onDocClick as EventListener, { capture: true });\r\n        document.addEventListener('scroll', onDocScroll as EventListener, { capture: true });\r\n        window.addEventListener('resize', onResize as EventListener);\r\n        document.addEventListener('keydown', onKeyDown as EventListener);\r\n    }\r\n\r\n    function unbindAutoClose() {\r\n        if (onDocClick)\r\n            document.removeEventListener('click', onDocClick as EventListener, { capture: true });\r\n        if (onDocClick)\r\n            document.removeEventListener('contextmenu', onDocClick as EventListener, {\r\n                capture: true,\r\n            });\r\n        if (onDocScroll)\r\n            document.removeEventListener('scroll', onDocScroll as EventListener, { capture: true });\r\n        if (onResize) window.removeEventListener('resize', onResize as EventListener);\r\n        if (onKeyDown) document.removeEventListener('keydown', onKeyDown as EventListener);\r\n        onDocClick = onDocScroll = onResize = onKeyDown = null;\r\n    }\r\n\r\n    let lastInvokeWasKeyboard = false;\r\n    document.addEventListener('keydown', e => {\r\n        if (e.key === 'ContextMenu' || (e.shiftKey && e.key === 'F10')) {\r\n            lastInvokeWasKeyboard = true;\r\n        }\r\n    });\r\n    document.addEventListener(\r\n        'keyup',\r\n        () => {\r\n            lastInvokeWasKeyboard = false;\r\n        },\r\n        { capture: true }\r\n    );\r\n\r\n    document.addEventListener('contextmenu', showContextMenu);\r\n\r\n    if (typeof (window as any).bindDropdownTrigger === 'function') {\r\n        document.querySelectorAll('[data-menubar-trigger-button=\"true\"]').forEach(btn => {\r\n            btn.addEventListener('click', () => hideContextMenu());\r\n        });\r\n    }\r\n}\r\n\r\nexport {};\r\n\r\n"]}