{"version":3,"file":"context-menu.js","sourceRoot":"","sources":["../src/ts/context-menu.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * src/ts/context-menu.ts\n * Typed port of js/context-menu.js\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\nconst guardKey = '__customContextMenuInit';\nif ((window as any)[guardKey]) {\n    // already initialized\n} else {\n    (window as any)[guardKey] = true;\n\n    const i18n =\n        (window as any).appI18n ||\n        ({\n            translate: (k: string) => k,\n            applyTranslations: (_el?: Element) => {},\n        } as { translate: (k: string) => string; applyTranslations: (el?: Element) => void });\n\n    const hideAllDropdowns =\n        typeof (window as any).hideMenuDropdowns === 'function'\n            ? (window as any).hideMenuDropdowns\n            : () => {\n                  const domUtils = (window as any).DOMUtils;\n                  document\n                      .querySelectorAll('.menu-dropdown')\n                      .forEach(d => {\n                          if (domUtils && typeof domUtils.hide === 'function') {\n                              domUtils.hide(d);\n                          } else {\n                              d.classList.add('hidden');\n                          }\n                      });\n                  document\n                      .querySelectorAll('[aria-expanded=\"true\"]')\n                      .forEach(b => b.setAttribute('aria-expanded', 'false'));\n              };\n\n    function openModal(id: string) {\n        const el = document.getElementById(id);\n        if (!el) return;\n        if (!(window as any).dialogs) (window as any).dialogs = {};\n        if (!(window as any).dialogs[id] && typeof (window as any).Dialog === 'function') {\n            try {\n                (window as any).dialogs[id] = new (window as any).Dialog(id);\n            } catch {\n                // noop\n            }\n        }\n        const dlg = (window as any).dialogs[id];\n        if (dlg && typeof dlg.open === 'function') {\n            dlg.open();\n        } else {\n            const domUtils = (window as any).DOMUtils;\n            if (domUtils && typeof domUtils.show === 'function') {\n                domUtils.show(el);\n            } else {\n                el.classList.remove('hidden');\n            }\n            if (typeof (window as any).bringDialogToFront === 'function') {\n                (window as any).bringDialogToFront(id);\n            }\n        }\n        if (typeof (window as any).updateProgramLabelByTopModal === 'function') {\n            (window as any).updateProgramLabelByTopModal();\n        }\n    }\n\n    function toggleDarkMode() {\n        if (\n            (window as any).SystemUI &&\n            typeof (window as any).SystemUI.handleSystemToggle === 'function'\n        ) {\n            (window as any).SystemUI.handleSystemToggle('dark-mode');\n        } else {\n            const next = !document.documentElement.classList.contains('dark');\n            document.documentElement.classList.toggle('dark', next);\n            if (\n                (window as any).ThemeSystem &&\n                typeof (window as any).ThemeSystem.setThemePreference === 'function'\n            ) {\n                (window as any).ThemeSystem.setThemePreference(next ? 'dark' : 'light');\n            }\n        }\n    }\n\n    function getMenuItemsForTarget(target: Element | null) {\n        const items: Array<any> = [];\n        const inDesktop = !!(\n            target &&\n            (target as Element).closest &&\n            (target as Element).closest('#desktop')\n        );\n        const inDockItem = !!(\n            target &&\n            (target as Element).closest &&\n            (target as Element).closest('#dock .dock-item')\n        );\n        const inImageModal = !!(\n            target &&\n            (target as Element).closest &&\n            (target as Element).closest('#image-modal')\n        );\n        const inFinderModal = !!(\n            target &&\n            (target as Element).closest &&\n            (target as Element).closest('#finder-modal')\n        );\n\n        if (inDockItem) {\n            const dockItem = (target as Element).closest('#dock .dock-item') as Element | null;\n            const winId = dockItem && dockItem.getAttribute('data-window-id');\n            if (winId) {\n                items.push({\n                    id: 'open-dock-window',\n                    label: i18n.translate('context.open') || 'Öffnen',\n                    action: () => openModal(winId),\n                });\n                items.push({ type: 'separator' });\n            }\n        }\n\n        if (inImageModal && typeof (window as any).getImageViewerState === 'function') {\n            const st = (window as any).getImageViewerState();\n            if (st && st.hasImage) {\n                items.push({\n                    id: 'image-open-tab',\n                    label:\n                        i18n.translate('context.image.openInTab') ||\n                        i18n.translate('menu.image.openInTab') ||\n                        'Bild in neuem Tab öffnen',\n                    action: () => {\n                        if (typeof (window as any).openActiveImageInNewTab === 'function')\n                            (window as any).openActiveImageInNewTab();\n                    },\n                });\n                items.push({\n                    id: 'image-save',\n                    label:\n                        i18n.translate('context.image.save') ||\n                        i18n.translate('menu.image.saveImage') ||\n                        'Bild sichern …',\n                    action: () => {\n                        if (typeof (window as any).downloadActiveImage === 'function')\n                            (window as any).downloadActiveImage();\n                    },\n                });\n                items.push({ type: 'separator' });\n            }\n        }\n\n        if (inFinderModal) {\n            const finderItem =\n                target &&\n                (target as Element).closest &&\n                (target as Element).closest('.finder-list-item, .finder-grid-item');\n            if (finderItem) {\n                const itemName = (finderItem as Element).getAttribute('data-item-name');\n                const itemType = (finderItem as Element).getAttribute('data-item-type');\n                if (itemName && itemType) {\n                    items.push({\n                        id: 'finder-open-item',\n                        label: i18n.translate('context.finder.openItem') || 'Öffnen',\n                        action: () => {\n                            if (\n                                (window as any).FinderSystem &&\n                                typeof (window as any).FinderSystem.openItem === 'function'\n                            )\n                                (window as any).FinderSystem.openItem(itemName, itemType);\n                        },\n                    });\n                    items.push({ type: 'separator' });\n                    items.push({\n                        id: 'finder-get-info',\n                        label: i18n.translate('context.finder.getInfo') || 'Informationen',\n                        action: () => {\n                            console.log('Get info for:', itemName, itemType);\n                        },\n                    });\n                    return items;\n                }\n            }\n\n            items.push({\n                id: 'finder-refresh',\n                label: i18n.translate('context.finder.refresh') || 'Aktualisieren',\n                action: () => {\n                    if (\n                        (window as any).FinderSystem &&\n                        typeof (window as any).FinderSystem.navigateTo === 'function'\n                    ) {\n                        const state = (window as any).FinderSystem.getState();\n                        if (state) {\n                            (window as any).FinderSystem.navigateTo(\n                                state.currentPath,\n                                state.currentView\n                            );\n                        }\n                    }\n                },\n            });\n            items.push({ type: 'separator' });\n\n            const currentViewMode =\n                (window as any).FinderSystem && (window as any).FinderSystem.getState\n                    ? (window as any).FinderSystem.getState().viewMode\n                    : 'list';\n            if (currentViewMode !== 'list') {\n                items.push({\n                    id: 'finder-view-list',\n                    label: i18n.translate('context.finder.viewList') || 'Als Liste',\n                    action: () => {\n                        if (\n                            (window as any).FinderSystem &&\n                            typeof (window as any).FinderSystem.setViewMode === 'function'\n                        )\n                            (window as any).FinderSystem.setViewMode('list');\n                    },\n                });\n            }\n            if (currentViewMode !== 'grid') {\n                items.push({\n                    id: 'finder-view-grid',\n                    label: i18n.translate('context.finder.viewGrid') || 'Als Raster',\n                    action: () => {\n                        if (\n                            (window as any).FinderSystem &&\n                            typeof (window as any).FinderSystem.setViewMode === 'function'\n                        )\n                            (window as any).FinderSystem.setViewMode('grid');\n                    },\n                });\n            }\n            items.push({ type: 'separator' });\n\n            items.push({\n                id: 'finder-sort-name',\n                label: i18n.translate('context.finder.sortByName') || 'Nach Name sortieren',\n                action: () => {\n                    if (\n                        (window as any).FinderSystem &&\n                        typeof (window as any).FinderSystem.setSortBy === 'function'\n                    )\n                        (window as any).FinderSystem.setSortBy('name');\n                },\n            });\n            items.push({\n                id: 'finder-sort-date',\n                label: i18n.translate('context.finder.sortByDate') || 'Nach Datum sortieren',\n                action: () => {\n                    if (\n                        (window as any).FinderSystem &&\n                        typeof (window as any).FinderSystem.setSortBy === 'function'\n                    )\n                        (window as any).FinderSystem.setSortBy('date');\n                },\n            });\n            items.push({\n                id: 'finder-sort-size',\n                label: i18n.translate('context.finder.sortBySize') || 'Nach Größe sortieren',\n                action: () => {\n                    if (\n                        (window as any).FinderSystem &&\n                        typeof (window as any).FinderSystem.setSortBy === 'function'\n                    )\n                        (window as any).FinderSystem.setSortBy('size');\n                },\n            });\n\n            return items;\n        }\n\n        if (inDesktop) {\n            items.push({\n                id: 'open-finder',\n                label: i18n.translate('context.openFinder') || 'Finder öffnen',\n                action: () => openModal('finder-modal'),\n            });\n            items.push({\n                id: 'open-text',\n                label: i18n.translate('context.openTextEditor') || 'Texteditor öffnen',\n                action: () => openModal('text-modal'),\n            });\n            items.push({\n                id: 'open-projects',\n                label: i18n.translate('context.openProjects') || 'Projekte öffnen',\n                action: () => openModal('projects-modal'),\n            });\n            items.push({ type: 'separator' });\n            items.push({\n                id: 'toggle-dark',\n                label: i18n.translate('context.toggleDarkMode') || 'Dark Mode umschalten',\n                action: toggleDarkMode,\n            });\n            items.push({\n                id: 'open-settings',\n                label: i18n.translate('context.openSettings') || 'Systemeinstellungen …',\n                action: () => openModal('settings-modal'),\n            });\n            items.push({ type: 'separator' });\n            items.push({\n                id: 'about',\n                label: i18n.translate('context.about') || 'Über Marvin',\n                action: () => openModal('about-modal'),\n            });\n            return items;\n        }\n\n        items.push({\n            id: 'open-finder',\n            label: i18n.translate('context.openFinder') || 'Finder öffnen',\n            action: () => openModal('finder-modal'),\n        });\n        items.push({\n            id: 'open-text',\n            label: i18n.translate('context.openTextEditor') || 'Texteditor öffnen',\n            action: () => openModal('text-modal'),\n        });\n        items.push({ type: 'separator' });\n        items.push({\n            id: 'toggle-dark',\n            label: i18n.translate('context.toggleDarkMode') || 'Dark Mode umschalten',\n            action: toggleDarkMode,\n        });\n        items.push({\n            id: 'open-settings',\n            label: i18n.translate('context.openSettings') || 'Systemeinstellungen …',\n            action: () => openModal('settings-modal'),\n        });\n        items.push({ type: 'separator' });\n        items.push({\n            id: 'about',\n            label: i18n.translate('context.about') || 'Über Marvin',\n            action: () => openModal('about-modal'),\n        });\n        return items;\n    }\n\n    // Create DOM once\n    const menu = document.createElement('ul');\n    menu.id = 'context-menu';\n    menu.className = 'menu-dropdown context-menu hidden';\n    menu.setAttribute('role', 'menu');\n    menu.setAttribute('aria-label', i18n.translate('context.menuLabel') || 'Kontextmenü');\n\n    document.addEventListener('DOMContentLoaded', () => {\n        if (!document.body.contains(menu)) document.body.appendChild(menu);\n        try {\n            i18n.applyTranslations(menu);\n        } catch {}\n    });\n\n    function clearMenu() {\n        while (menu.firstChild) menu.removeChild(menu.firstChild);\n    }\n\n    function renderMenu(items: Array<any>) {\n        clearMenu();\n        const fragment = document.createDocumentFragment();\n        let firstFocusable: HTMLElement | null = null;\n        items.forEach((it: any, idx: number) => {\n            if (it.type === 'separator') {\n                const sep = document.createElement('li');\n                sep.className = 'menu-separator';\n                sep.setAttribute('role', 'separator');\n                fragment.appendChild(sep);\n                return;\n            }\n            const li = document.createElement('li');\n            const btn = document.createElement('button');\n            btn.type = 'button';\n            btn.className = 'menu-item';\n            btn.setAttribute('role', 'menuitem');\n            btn.tabIndex = -1;\n            btn.dataset.itemId = it.id || 'item-' + idx;\n            const labelSpan = document.createElement('span');\n            labelSpan.className = 'menu-item-label';\n            labelSpan.textContent = it.label || '';\n            btn.appendChild(labelSpan);\n            btn.addEventListener('click', ev => {\n                ev.stopPropagation();\n                hideContextMenu();\n                try {\n                    if (it.action) {\n                        it.action();\n                    }\n                } catch (e) {\n                    console.warn('Context action failed', e);\n                }\n            });\n            li.appendChild(btn);\n            fragment.appendChild(li);\n            if (!firstFocusable) firstFocusable = btn;\n        });\n        menu.appendChild(fragment);\n        try {\n            i18n.applyTranslations(menu);\n        } catch {}\n        return firstFocusable;\n    }\n\n    function clampPosition(x: number, y: number) {\n        const rect = menu.getBoundingClientRect();\n        const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n        const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n        const margin = 6;\n        const nx = Math.min(Math.max(margin, x), Math.max(margin, vw - rect.width - margin));\n        const ny = Math.min(Math.max(margin, y), Math.max(margin, vh - rect.height - margin));\n        return { x: nx, y: ny };\n    }\n\n    function showContextMenu(ev: MouseEvent) {\n        const target = ev.target instanceof Element ? ev.target : null;\n        if (!target) return;\n        if (target.closest('input, textarea, [contenteditable=\"true\"]')) return;\n        ev.preventDefault();\n        ev.stopPropagation();\n        hideAllDropdowns();\n        buildAndOpenAt(ev.clientX, ev.clientY, target);\n    }\n\n    function buildAndOpenAt(x: number, y: number, target: Element | null) {\n        const items = getMenuItemsForTarget(target);\n        const firstFocusable = renderMenu(items);\n        if (document.body && menu.parentElement !== document.body) {\n            document.body.appendChild(menu);\n        } else if (document.body && document.body.lastElementChild !== menu) {\n            document.body.appendChild(menu);\n        }\n        const domUtils = (window as any).DOMUtils;\n        if (domUtils && typeof domUtils.show === 'function') {\n            domUtils.show(menu);\n        } else {\n            menu.classList.remove('hidden');\n        }\n        menu.style.left = Math.max(0, x) + 'px';\n        menu.style.top = Math.max(0, y) + 'px';\n        const clamped = clampPosition(x, y);\n        menu.style.left = clamped.x + 'px';\n        menu.style.top = clamped.y + 'px';\n        if (lastInvokeWasKeyboard && firstFocusable) {\n            (firstFocusable as HTMLElement).focus();\n        }\n        bindAutoClose();\n    }\n\n    function hideContextMenu() {\n        const domUtils = (window as any).DOMUtils;\n        if (!menu.classList.contains('hidden')) {\n            if (domUtils && typeof domUtils.hide === 'function') {\n                domUtils.hide(menu);\n            } else {\n                menu.classList.add('hidden');\n            }\n        }\n        unbindAutoClose();\n    }\n\n    let onDocClick: ((e: Event) => void) | null = null;\n    let onDocScroll: (() => void) | null = null;\n    let onResize: (() => void) | null = null;\n    let onKeyDown: ((e: KeyboardEvent) => void) | null = null;\n\n    function bindAutoClose() {\n        unbindAutoClose();\n        onDocClick = (e: Event) => {\n            const t = e.target instanceof Element ? e.target : null;\n            if (!t) {\n                hideContextMenu();\n                return;\n            }\n            if (t.closest('#context-menu')) return;\n            hideContextMenu();\n        };\n        onDocScroll = () => hideContextMenu();\n        onResize = () => hideContextMenu();\n        onKeyDown = (e: KeyboardEvent) => {\n            const items = Array.from(menu.querySelectorAll('.menu-item')) as HTMLElement[];\n            const focusIdx = items.findIndex(el => el === document.activeElement);\n            if (e.key === 'Escape') {\n                e.preventDefault();\n                hideContextMenu();\n                return;\n            }\n            if (!items.length) return;\n            if (e.key === 'ArrowDown') {\n                e.preventDefault();\n                const next = items[(Math.max(0, focusIdx) + 1) % items.length];\n                if (next) next.focus();\n            } else if (e.key === 'ArrowUp') {\n                e.preventDefault();\n                const next = items[(focusIdx > 0 ? focusIdx : items.length) - 1];\n                if (next) next.focus();\n            } else if (e.key === 'Home') {\n                e.preventDefault();\n                items[0]?.focus();\n            } else if (e.key === 'End') {\n                e.preventDefault();\n                items[items.length - 1]?.focus();\n            } else if (e.key === 'Enter' || e.key === ' ') {\n                if (\n                    document.activeElement &&\n                    (document.activeElement as Element).classList.contains('menu-item')\n                ) {\n                    e.preventDefault();\n                    (document.activeElement as HTMLElement).click();\n                }\n            }\n        };\n        document.addEventListener('click', onDocClick as EventListener, { capture: true });\n        document.addEventListener('contextmenu', onDocClick as EventListener, { capture: true });\n        document.addEventListener('scroll', onDocScroll as EventListener, { capture: true });\n        window.addEventListener('resize', onResize as EventListener);\n        document.addEventListener('keydown', onKeyDown as EventListener);\n    }\n\n    function unbindAutoClose() {\n        if (onDocClick)\n            document.removeEventListener('click', onDocClick as EventListener, { capture: true });\n        if (onDocClick)\n            document.removeEventListener('contextmenu', onDocClick as EventListener, {\n                capture: true,\n            });\n        if (onDocScroll)\n            document.removeEventListener('scroll', onDocScroll as EventListener, { capture: true });\n        if (onResize) window.removeEventListener('resize', onResize as EventListener);\n        if (onKeyDown) document.removeEventListener('keydown', onKeyDown as EventListener);\n        onDocClick = onDocScroll = onResize = onKeyDown = null;\n    }\n\n    let lastInvokeWasKeyboard = false;\n    document.addEventListener('keydown', e => {\n        if (e.key === 'ContextMenu' || (e.shiftKey && e.key === 'F10')) {\n            lastInvokeWasKeyboard = true;\n        }\n    });\n    document.addEventListener(\n        'keyup',\n        () => {\n            lastInvokeWasKeyboard = false;\n        },\n        { capture: true }\n    );\n\n    document.addEventListener('contextmenu', showContextMenu);\n\n    if (typeof (window as any).bindDropdownTrigger === 'function') {\n        document.querySelectorAll('[data-menubar-trigger-button=\"true\"]').forEach(btn => {\n            btn.addEventListener('click', () => hideContextMenu());\n        });\n    }\n}\n\nexport {};\n"]}