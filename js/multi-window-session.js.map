{"version":3,"file":"multi-window-session.js","sourceRoot":"","sources":["../src/ts/multi-window-session.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * src/ts/multi-window-session.ts\r\n * Multi-Window Session Management\r\n * Handles saving/restoring window layouts and tab states for the new multi-window system\r\n */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\nimport type { BaseWindow } from './base-window.js';\r\nimport type { TabState } from './base-tab.js';\r\nimport WindowRegistry from './window-registry.js';\r\nimport { TerminalWindow } from './terminal-window.js';\r\nimport { TextEditorWindow } from './text-editor-window.js';\r\nimport { FinderWindow } from './finder-window.js';\r\nimport { TerminalSession } from './terminal-session.js';\r\nimport { TextEditorDocument } from './text-editor-document.js';\r\nimport { FinderView } from './finder-view.js';\r\n\r\n/**\r\n * Multi-Window Session Schema v1.0\r\n */\r\nexport interface MultiWindowSession {\r\n    version: string; // Schema version for migration\r\n    timestamp: number;\r\n    windows: WindowSessionData[];\r\n    metadata?: {\r\n        theme?: string;\r\n        language?: string;\r\n        [key: string]: any;\r\n    };\r\n}\r\n\r\nexport interface WindowSessionData {\r\n    id: string;\r\n    type: string; // 'terminal', 'text-editor', 'finder'\r\n    position: {\r\n        x: number;\r\n        y: number;\r\n        width: number;\r\n        height: number;\r\n    };\r\n    zIndex: number;\r\n    isMinimized: boolean;\r\n    isMaximized: boolean;\r\n    activeTabId: string | null;\r\n    tabs: TabState[];\r\n    metadata?: Record<string, any>;\r\n}\r\n\r\n/**\r\n * Legacy Single-Window Session (for migration)\r\n */\r\nexport interface LegacySession {\r\n    version?: string;\r\n    timestamp?: number;\r\n    instances?: Record<string, any[]>; // Old instance manager format\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * MultiWindowSessionManager - Handles multi-window session persistence\r\n *\r\n * Features:\r\n * - Save/restore window positions and tab states\r\n * - Auto-save with debouncing\r\n * - Legacy session migration\r\n * - Export/import session JSON\r\n *\r\n * Note: This coexists with the legacy SessionManager for backwards compatibility\r\n */\r\nclass MultiWindowSessionManager {\r\n    private static STORAGE_KEY = 'multi-window-session';\r\n    private static LEGACY_STORAGE_KEY = 'windowInstancesSession'; // Old SessionManager key\r\n    private static VERSION = '1.0.0';\r\n    private static AUTO_SAVE_DELAY = 2000; // 2 seconds debounce\r\n\r\n    private autoSaveTimer: number | null = null;\r\n    private isRestoring = false;\r\n    private initialized = false;\r\n\r\n    /**\r\n     * Initialize session manager\r\n     */\r\n    init(): void {\r\n        if (this.initialized) return;\r\n\r\n        console.log('[MultiWindowSessionManager] Initializing...');\r\n\r\n        // Save on window blur\r\n        window.addEventListener('blur', () => {\r\n            this.saveSession({ immediate: true });\r\n        });\r\n\r\n        // Save on beforeunload\r\n        window.addEventListener('beforeunload', () => {\r\n            this.saveSessionImmediate();\r\n        });\r\n\r\n        // Save on visibility change\r\n        document.addEventListener('visibilitychange', () => {\r\n            if (document.hidden) {\r\n                this.saveSession({ immediate: true });\r\n            }\r\n        });\r\n\r\n        this.initialized = true;\r\n        console.log('[MultiWindowSessionManager] Initialized');\r\n    }\r\n\r\n    /**\r\n     * Save current session to localStorage\r\n     */\r\n    saveSession(options: { immediate?: boolean } = {}): void {\r\n        if (this.isRestoring) {\r\n            console.log('[MultiWindowSessionManager] Skipping save during restore');\r\n            return;\r\n        }\r\n\r\n        if (options.immediate) {\r\n            this.saveSessionImmediate();\r\n        } else {\r\n            this.scheduleAutoSave();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Save session immediately (bypasses debounce)\r\n     */\r\n    private saveSessionImmediate(): void {\r\n        if (this.autoSaveTimer !== null) {\r\n            clearTimeout(this.autoSaveTimer);\r\n            this.autoSaveTimer = null;\r\n        }\r\n\r\n        try {\r\n            const session = this.createSession();\r\n            localStorage.setItem(MultiWindowSessionManager.STORAGE_KEY, JSON.stringify(session));\r\n\r\n            console.log('[MultiWindowSessionManager] Session saved:', {\r\n                windows: session.windows.length,\r\n                totalTabs: session.windows.reduce((sum, w) => sum + w.tabs.length, 0),\r\n            });\r\n        } catch (error) {\r\n            console.error('[MultiWindowSessionManager] Failed to save session:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Schedule auto-save (debounced)\r\n     */\r\n    private scheduleAutoSave(): void {\r\n        if (this.autoSaveTimer !== null) {\r\n            clearTimeout(this.autoSaveTimer);\r\n        }\r\n\r\n        this.autoSaveTimer = window.setTimeout(() => {\r\n            this.saveSessionImmediate();\r\n        }, MultiWindowSessionManager.AUTO_SAVE_DELAY);\r\n    }\r\n\r\n    /**\r\n     * Create session object from current state\r\n     */\r\n    private createSession(): MultiWindowSession {\r\n        const windows = WindowRegistry.getAllWindows();\r\n\r\n        return {\r\n            version: MultiWindowSessionManager.VERSION,\r\n            timestamp: Date.now(),\r\n            windows: windows.map(window => this.serializeWindow(window)),\r\n            metadata: {\r\n                theme: this.getCurrentTheme(),\r\n                language: this.getCurrentLanguage(),\r\n            },\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Serialize a window and all its tabs\r\n     */\r\n    private serializeWindow(window: BaseWindow): WindowSessionData {\r\n        const tabs = Array.from(window.tabs.values());\r\n\r\n        return {\r\n            id: window.id,\r\n            type: window.type,\r\n            position: { ...window.position },\r\n            zIndex: window.zIndex,\r\n            isMinimized: window.isMinimized,\r\n            isMaximized: window.isMaximized,\r\n            activeTabId: window.activeTabId,\r\n            tabs: tabs.map(tab => this.serializeTab(tab)),\r\n            metadata: window.metadata,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Serialize a tab\r\n     */\r\n    private serializeTab(tab: any): TabState {\r\n        // Use tab's own serialize method if available\r\n        if (typeof tab.serialize === 'function') {\r\n            return tab.serialize();\r\n        }\r\n\r\n        // Fallback to basic serialization\r\n        return {\r\n            id: tab.id,\r\n            type: tab.type,\r\n            title: tab.title,\r\n            icon: tab.icon,\r\n            contentState: tab.contentState || {},\r\n            created: tab.metadata?.created || Date.now(),\r\n            modified: tab.metadata?.modified || Date.now(),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Restore session from localStorage\r\n     */\r\n    async restoreSession(): Promise<boolean> {\r\n        this.isRestoring = true;\r\n\r\n        try {\r\n            // Try to load multi-window session\r\n            const sessionData = localStorage.getItem(MultiWindowSessionManager.STORAGE_KEY);\r\n\r\n            if (sessionData) {\r\n                const session = JSON.parse(sessionData) as MultiWindowSession;\r\n                await this.restoreMultiWindowSession(session);\r\n                return true;\r\n            }\r\n\r\n            // Try to migrate legacy session\r\n            const legacyData = localStorage.getItem(MultiWindowSessionManager.LEGACY_STORAGE_KEY);\r\n            if (legacyData) {\r\n                console.log('[MultiWindowSessionManager] Migrating legacy session...');\r\n                const legacySession = JSON.parse(legacyData) as LegacySession;\r\n                await this.migrateLegacySession(legacySession);\r\n                return true;\r\n            }\r\n\r\n            console.log('[MultiWindowSessionManager] No session to restore');\r\n            return false;\r\n        } catch (error) {\r\n            console.error('[MultiWindowSessionManager] Failed to restore session:', error);\r\n            return false;\r\n        } finally {\r\n            this.isRestoring = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Restore multi-window session\r\n     */\r\n    private async restoreMultiWindowSession(session: MultiWindowSession): Promise<void> {\r\n        console.log('[MultiWindowSessionManager] Restoring session:', {\r\n            version: session.version,\r\n            windows: session.windows.length,\r\n            timestamp: new Date(session.timestamp),\r\n        });\r\n\r\n        // SAFETY: Limit maximum windows to prevent DOM explosion\r\n        // Allow multiple windows per type (e.g., 3 Finder windows, 2 Terminal windows)\r\n        const MAX_WINDOWS_PER_TYPE = 3;\r\n        const MAX_TOTAL_WINDOWS = 10;\r\n\r\n        if (session.windows.length > MAX_TOTAL_WINDOWS) {\r\n            console.warn(\r\n                `[MultiWindowSessionManager] Session has ${session.windows.length} windows (max ${MAX_TOTAL_WINDOWS}). Clearing corrupted session.`\r\n            );\r\n            localStorage.removeItem(MultiWindowSessionManager.STORAGE_KEY);\r\n            return;\r\n        }\r\n\r\n        // Count windows by type - if any type has more than 1, clear the session\r\n        const typeCount = new Map<string, number>();\r\n        session.windows.forEach(w => {\r\n            const count = typeCount.get(w.type) || 0;\r\n            typeCount.set(w.type, count + 1);\r\n        });\r\n\r\n        // Check for duplicates\r\n        for (const [type, count] of typeCount.entries()) {\r\n            if (count > MAX_WINDOWS_PER_TYPE) {\r\n                console.warn(\r\n                    `[MultiWindowSessionManager] Session has ${count} ${type} windows (max ${MAX_WINDOWS_PER_TYPE}). Clearing corrupted session.`\r\n                );\r\n                localStorage.removeItem(MultiWindowSessionManager.STORAGE_KEY);\r\n                return;\r\n            }\r\n        }\r\n\r\n        // Count windows by type and filter excessive ones\r\n        const windowsByType = new Map<string, number>();\r\n        const filteredWindows = session.windows.filter(w => {\r\n            const count = windowsByType.get(w.type) || 0;\r\n            if (count >= MAX_WINDOWS_PER_TYPE) {\r\n                console.warn(\r\n                    `[MultiWindowSessionManager] Skipping ${w.type} window (limit ${MAX_WINDOWS_PER_TYPE} reached)`\r\n                );\r\n                return false;\r\n            }\r\n            windowsByType.set(w.type, count + 1);\r\n            return true;\r\n        });\r\n\r\n        // Sort windows by z-index to restore stacking order\r\n        const sortedWindows = filteredWindows.sort((a, b) => a.zIndex - b.zIndex);\r\n\r\n        // Restore each window\r\n        for (const windowData of sortedWindows) {\r\n            await this.restoreWindow(windowData);\r\n        }\r\n\r\n        // Restore metadata (theme, language, etc.)\r\n        if (session.metadata) {\r\n            this.restoreMetadata(session.metadata);\r\n        }\r\n\r\n        console.log('[MultiWindowSessionManager] Session restored successfully');\r\n\r\n        // Update dock indicators after session restore\r\n        const W = window as any;\r\n        W.updateDockIndicators?.();\r\n    }\r\n\r\n    /**\r\n     * Restore a single window with its tabs\r\n     */\r\n    private async restoreWindow(data: WindowSessionData): Promise<BaseWindow | null> {\r\n        try {\r\n            // Create window based on type (without showing it yet)\r\n            const window = this.createWindowByType(data.type, data);\r\n            if (!window) {\r\n                console.error(`[MultiWindowSessionManager] Unknown window type: ${data.type}`);\r\n                return null;\r\n            }\r\n\r\n            // Restore tabs\r\n            for (const tabData of data.tabs) {\r\n                const tab = this.restoreTab(tabData);\r\n                if (tab) {\r\n                    window.addTab(tab);\r\n                }\r\n            }\r\n\r\n            // Set active tab\r\n            if (data.activeTabId && window.tabs.has(data.activeTabId)) {\r\n                window.setActiveTab(data.activeTabId);\r\n            } else if (window.tabs.size > 0) {\r\n                // Fallback to first tab\r\n                const firstTabId = Array.from(window.tabs.keys())[0];\r\n                if (firstTabId) window.setActiveTab(firstTabId);\r\n            }\r\n\r\n            // Show window and register\r\n            window.show();\r\n            WindowRegistry.registerWindow(window);\r\n\r\n            // Apply window state after DOM is ready\r\n            setTimeout(() => {\r\n                if (window.element) {\r\n                    window.element.style.zIndex = String(data.zIndex);\r\n\r\n                    // Restore position\r\n                    if (data.position && !data.isMaximized) {\r\n                        window.element.style.left = `${data.position.x}px`;\r\n                        window.element.style.top = `${data.position.y}px`;\r\n                        window.element.style.width = `${data.position.width}px`;\r\n                        window.element.style.height = `${data.position.height}px`;\r\n                        // Update internal position tracking\r\n                        window.position = { ...data.position };\r\n                    }\r\n\r\n                    if (data.isMinimized) {\r\n                        window.minimize();\r\n                    } else if (data.isMaximized && !window.isMaximized) {\r\n                        window.toggleMaximize();\r\n                    }\r\n                }\r\n            }, 0);\r\n\r\n            return window;\r\n        } catch (error) {\r\n            console.error('[MultiWindowSessionManager] Failed to restore window:', error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create window by type\r\n     */\r\n    private createWindowByType(type: string, data: WindowSessionData): BaseWindow | null {\r\n        const config = {\r\n            id: data.id,\r\n            type: type,\r\n            position: data.position,\r\n            metadata: data.metadata,\r\n        };\r\n\r\n        switch (type) {\r\n            case 'terminal':\r\n                return new TerminalWindow(config);\r\n\r\n            case 'text-editor':\r\n                return new TextEditorWindow(config);\r\n\r\n            case 'finder':\r\n                return new FinderWindow(config);\r\n\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Restore a single tab\r\n     */\r\n    private restoreTab(data: TabState): any {\r\n        try {\r\n            // Determine tab class based on type\r\n            switch (data.type) {\r\n                case 'terminal-session':\r\n                    return TerminalSession.deserialize(data);\r\n\r\n                case 'text-editor-document':\r\n                    return TextEditorDocument.deserialize(data);\r\n\r\n                case 'finder-view':\r\n                    return FinderView.deserialize(data);\r\n\r\n                default:\r\n                    console.warn(`[MultiWindowSessionManager] Unknown tab type: ${data.type}`);\r\n                    return null;\r\n            }\r\n        } catch (error) {\r\n            console.error('[MultiWindowSessionManager] Failed to restore tab:', error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Migrate legacy single-window session to multi-window format\r\n     */\r\n    private async migrateLegacySession(legacy: LegacySession): Promise<void> {\r\n        console.log('[MultiWindowSessionManager] Starting legacy migration...');\r\n\r\n        const instances = legacy.instances || {};\r\n\r\n        // Create terminal window if there are terminal sessions\r\n        if (instances['terminal'] && instances['terminal'].length > 0) {\r\n            const termWindow = TerminalWindow.create();\r\n\r\n            for (const sessionData of instances['terminal']) {\r\n                try {\r\n                    const session = TerminalSession.deserialize(sessionData);\r\n                    termWindow.addTab(session);\r\n                } catch (error) {\r\n                    console.error(\r\n                        '[MultiWindowSessionManager] Failed to migrate terminal session:',\r\n                        error\r\n                    );\r\n                }\r\n            }\r\n\r\n            if (termWindow.tabs.size > 0) {\r\n                const firstTabId = Array.from(termWindow.tabs.keys())[0];\r\n                if (firstTabId) termWindow.setActiveTab(firstTabId);\r\n            }\r\n        }\r\n\r\n        // Create text editor window if there are documents\r\n        if (instances['text-editor'] && instances['text-editor'].length > 0) {\r\n            const editorWindow = TextEditorWindow.create();\r\n\r\n            for (const docData of instances['text-editor']) {\r\n                try {\r\n                    const doc = TextEditorDocument.deserialize(docData);\r\n                    editorWindow.addTab(doc);\r\n                } catch (error) {\r\n                    console.error(\r\n                        '[MultiWindowSessionManager] Failed to migrate text editor document:',\r\n                        error\r\n                    );\r\n                }\r\n            }\r\n\r\n            if (editorWindow.tabs.size > 0) {\r\n                const firstTabId = Array.from(editorWindow.tabs.keys())[0];\r\n                if (firstTabId) editorWindow.setActiveTab(firstTabId);\r\n            }\r\n        }\r\n\r\n        // Create finder window if there are finder instances\r\n        if (instances['finder'] && instances['finder'].length > 0) {\r\n            const finderWindow = FinderWindow.create();\r\n\r\n            for (const viewData of instances['finder']) {\r\n                try {\r\n                    const view = FinderView.deserialize(viewData);\r\n                    finderWindow.addTab(view);\r\n                } catch (error) {\r\n                    console.error(\r\n                        '[MultiWindowSessionManager] Failed to migrate finder view:',\r\n                        error\r\n                    );\r\n                }\r\n            }\r\n\r\n            if (finderWindow.tabs.size > 0) {\r\n                const firstTabId = Array.from(finderWindow.tabs.keys())[0];\r\n                if (firstTabId) finderWindow.setActiveTab(firstTabId);\r\n            }\r\n        }\r\n\r\n        // Save new format and clear legacy\r\n        this.saveSessionImmediate();\r\n        localStorage.removeItem(MultiWindowSessionManager.LEGACY_STORAGE_KEY);\r\n\r\n        console.log('[MultiWindowSessionManager] Legacy migration completed');\r\n    }\r\n\r\n    /**\r\n     * Export session as JSON string\r\n     */\r\n    exportSession(): string {\r\n        const session = this.createSession();\r\n        return JSON.stringify(session, null, 2);\r\n    }\r\n\r\n    /**\r\n     * Import session from JSON string\r\n     */\r\n    async importSession(jsonString: string): Promise<boolean> {\r\n        try {\r\n            const session = JSON.parse(jsonString) as MultiWindowSession;\r\n\r\n            // Validate version\r\n            if (session.version !== MultiWindowSessionManager.VERSION) {\r\n                console.warn(\r\n                    '[MultiWindowSessionManager] Version mismatch, attempting import anyway'\r\n                );\r\n            }\r\n\r\n            // Close all current windows\r\n            WindowRegistry.closeAllWindows();\r\n\r\n            // Restore imported session\r\n            await this.restoreMultiWindowSession(session);\r\n\r\n            return true;\r\n        } catch (error) {\r\n            console.error('[MultiWindowSessionManager] Failed to import session:', error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear current session\r\n     */\r\n    clearSession(): void {\r\n        localStorage.removeItem(MultiWindowSessionManager.STORAGE_KEY);\r\n        console.log('[MultiWindowSessionManager] Session cleared');\r\n    }\r\n\r\n    /**\r\n     * Get current theme preference\r\n     */\r\n    private getCurrentTheme(): string {\r\n        return localStorage.getItem('theme-preference') || 'auto';\r\n    }\r\n\r\n    /**\r\n     * Get current language preference\r\n     */\r\n    private getCurrentLanguage(): string {\r\n        return localStorage.getItem('language-preference') || 'de';\r\n    }\r\n\r\n    /**\r\n     * Restore session metadata\r\n     */\r\n    private restoreMetadata(metadata: Record<string, any>): void {\r\n        // Theme and language are handled by existing systems\r\n        console.log('[MultiWindowSessionManager] Session metadata:', metadata);\r\n    }\r\n\r\n    /**\r\n     * Get session info (for debugging)\r\n     */\r\n    getSessionInfo(): any {\r\n        const sessionData = localStorage.getItem(MultiWindowSessionManager.STORAGE_KEY);\r\n        if (!sessionData) return null;\r\n\r\n        try {\r\n            const session = JSON.parse(sessionData) as MultiWindowSession;\r\n            return {\r\n                version: session.version,\r\n                timestamp: new Date(session.timestamp),\r\n                windowCount: session.windows.length,\r\n                tabCount: session.windows.reduce((sum, w) => sum + w.tabs.length, 0),\r\n                windows: session.windows.map(w => ({\r\n                    type: w.type,\r\n                    tabs: w.tabs.length,\r\n                    activeTab: w.activeTabId,\r\n                    position: w.position,\r\n                })),\r\n            };\r\n        } catch {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Debug log current session state\r\n     */\r\n    debugLog(): void {\r\n        const info = this.getSessionInfo();\r\n        console.log('[MultiWindowSessionManager] Current session:', info);\r\n    }\r\n}\r\n\r\n// Create and expose singleton\r\nconst multiWindowSessionManager = new MultiWindowSessionManager();\r\n(window as any).MultiWindowSessionManager = multiWindowSessionManager;\r\n\r\nexport default multiWindowSessionManager;\r\n"]}