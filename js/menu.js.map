{"version":3,"file":"menu.js","sourceRoot":"","sources":["../src/ts/menu.ts"],"names":[],"mappings":"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","sourcesContent":["/*\r\n * src/ts/menu.ts\r\n * Typed port of js/menu.js\r\n */\r\n\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\r\n// Allow dynamic access on window via string keys for legacy globals\r\ndeclare global {\r\n    interface Window {\r\n        [key: string]: any;\r\n    }\r\n}\r\n\r\ntype MenuHandler = (...args: any[]) => unknown;\r\nconst menuActionHandlers = new Map<string, MenuHandler>();\r\nlet menuActionIdCounter = 0;\r\n\r\ntype MenuContext = {\r\n    modalId?: string;\r\n    dialog?: { close?: () => void; minimize?: () => void; toggleMaximize?: () => void } | null;\r\n} | null;\r\n\r\nexport function registerMenuAction(handler: MenuHandler) {\r\n    if (typeof handler !== 'function') return null;\r\n    const actionId = `menu-action-${++menuActionIdCounter}`;\r\n    menuActionHandlers.set(actionId, handler);\r\n    return actionId;\r\n}\r\n\r\nexport function normalizeMenuItems(items: unknown[], context: MenuContext) {\r\n    if (!Array.isArray(items)) return [];\r\n    const normalized: Record<string, unknown>[] = [];\r\n    let previousWasSeparator = true;\r\n    items.forEach(raw => {\r\n        const item = raw as any;\r\n        if (!item) return;\r\n        if (item.type === 'separator') {\r\n            if (previousWasSeparator) return;\r\n            normalized.push({ type: 'separator' });\r\n            previousWasSeparator = true;\r\n            return;\r\n        }\r\n        const clone = Object.assign({}, item) as Record<string, unknown>;\r\n        if (typeof item.disabled === 'function')\r\n            (clone.disabled as unknown) = (item.disabled as (ctx: MenuContext) => boolean)(context);\r\n        if (typeof item.label === 'function')\r\n            (clone.label as unknown) = (item.label as (ctx: MenuContext) => string)(context);\r\n        if (typeof item.shortcut === 'function')\r\n            (clone.shortcut as unknown) = (item.shortcut as (ctx: MenuContext) => string)(context);\r\n        normalized.push(clone);\r\n        previousWasSeparator = false;\r\n    });\r\n    while (normalized.length && normalized[normalized.length - 1]?.type === 'separator')\r\n        normalized.pop();\r\n    return normalized;\r\n}\r\n\r\n// --- Menu builders (ported functions simplified to reference window helpers) ---\r\nfunction buildDefaultMenuDefinition(context: MenuContext) {\r\n    return buildFinderMenuDefinition(context);\r\n}\r\n\r\nfunction buildFinderMenuDefinition(context: MenuContext) {\r\n    return [\r\n        {\r\n            id: 'file',\r\n            label: () => translate('menu.sections.file'),\r\n            items: [\r\n                {\r\n                    id: 'finder-new-window',\r\n                    label: () => translate('menu.finder.newWindow'),\r\n                    shortcut: '⌘N',\r\n                    icon: 'new',\r\n                    action: () => {\r\n                        const mgr = window['FinderInstanceManager'];\r\n                        if (mgr && typeof mgr.createInstance === 'function') {\r\n                            const count = mgr.getInstanceCount\r\n                                ? mgr.getInstanceCount()\r\n                                : mgr.getAllInstances?.().length || 0;\r\n                            mgr.createInstance({ title: `Finder ${count + 1}` });\r\n                        }\r\n                    },\r\n                },\r\n                {\r\n                    id: 'finder-reload',\r\n                    label: () => translate('menu.finder.reload'),\r\n                    shortcut: '⌘R',\r\n                    icon: 'reload',\r\n                    action: () => {\r\n                        if (\r\n                            window['FinderSystem'] &&\r\n                            typeof window['FinderSystem'].navigateTo === 'function'\r\n                        ) {\r\n                            try {\r\n                                const st =\r\n                                    window['FinderSystem'].getState &&\r\n                                    window['FinderSystem'].getState();\r\n                                if (st && Array.isArray(st.githubRepos)) st.githubRepos = [];\r\n                                window['FinderSystem'].navigateTo([], 'github');\r\n                            } catch (e) {\r\n                                console.warn('Finder reload failed', e);\r\n                            }\r\n                        }\r\n                    },\r\n                },\r\n                { type: 'separator' },\r\n                {\r\n                    id: 'finder-close',\r\n                    label: () => translate('menu.finder.close'),\r\n                    shortcut: '⌘W',\r\n                    disabled: () => !(context && context.dialog),\r\n                    icon: 'close',\r\n                    action: () => closeContextWindow(context),\r\n                },\r\n            ],\r\n        },\r\n        createWindowMenuSection(context),\r\n        createHelpMenuSection(context, {\r\n            itemKey: 'menu.finder.help',\r\n            infoModalId: 'finder-modal',\r\n            itemIcon: 'help',\r\n        }),\r\n    ];\r\n}\r\n\r\nfunction buildSettingsMenuDefinition(context: MenuContext) {\r\n    return [\r\n        {\r\n            id: 'file',\r\n            label: () => translate('menu.sections.file'),\r\n            items: [\r\n                {\r\n                    id: 'settings-close',\r\n                    label: () => translate('menu.settings.close'),\r\n                    shortcut: '⌘W',\r\n                    disabled: () => !(context && context.dialog),\r\n                    icon: 'close',\r\n                    action: () => closeContextWindow(context),\r\n                },\r\n            ],\r\n        },\r\n        createWindowMenuSection(context),\r\n        createHelpMenuSection(context, {\r\n            itemKey: 'menu.settings.help',\r\n            infoModalId: 'settings-modal',\r\n            itemIcon: 'help',\r\n        }),\r\n    ];\r\n}\r\n\r\nfunction buildTextEditorMenuDefinition(context: MenuContext) {\r\n    return [\r\n        {\r\n            id: 'file',\r\n            label: () => translate('menu.sections.file'),\r\n            items: [\r\n                {\r\n                    id: 'text-new',\r\n                    label: () => translate('menu.text.newFile'),\r\n                    shortcut: '⌘N',\r\n                    icon: 'newFile',\r\n                    action: () => sendTextEditorMenuAction('file:new'),\r\n                },\r\n                {\r\n                    id: 'text-open',\r\n                    label: () => translate('menu.text.open'),\r\n                    shortcut: '⌘O',\r\n                    icon: 'open',\r\n                    action: () => sendTextEditorMenuAction('file:open'),\r\n                },\r\n                {\r\n                    id: 'text-save',\r\n                    label: () => translate('menu.text.save'),\r\n                    shortcut: '⌘S',\r\n                    icon: 'save',\r\n                    action: () => sendTextEditorMenuAction('file:save'),\r\n                },\r\n            ],\r\n        },\r\n        {\r\n            id: 'edit',\r\n            label: () => translate('menu.sections.edit'),\r\n            items: [\r\n                {\r\n                    id: 'text-undo',\r\n                    label: () => translate('menu.text.undo'),\r\n                    shortcut: '⌘Z',\r\n                    icon: 'undo',\r\n                    action: () => sendTextEditorMenuAction('edit:undo'),\r\n                },\r\n                {\r\n                    id: 'text-redo',\r\n                    label: () => translate('menu.text.redo'),\r\n                    shortcut: '⇧⌘Z',\r\n                    icon: 'redo',\r\n                    action: () => sendTextEditorMenuAction('edit:redo'),\r\n                },\r\n                { type: 'separator' },\r\n                {\r\n                    id: 'text-cut',\r\n                    label: () => translate('menu.text.cut'),\r\n                    shortcut: '⌘X',\r\n                    icon: 'cut',\r\n                    action: () => sendTextEditorMenuAction('edit:cut'),\r\n                },\r\n                {\r\n                    id: 'text-copy',\r\n                    label: () => translate('menu.text.copy'),\r\n                    shortcut: '⌘C',\r\n                    icon: 'copy',\r\n                    action: () => sendTextEditorMenuAction('edit:copy'),\r\n                },\r\n                {\r\n                    id: 'text-paste',\r\n                    label: () => translate('menu.text.paste'),\r\n                    shortcut: '⌘V',\r\n                    icon: 'paste',\r\n                    action: () => sendTextEditorMenuAction('edit:paste'),\r\n                },\r\n                { type: 'separator' },\r\n                {\r\n                    id: 'text-select-all',\r\n                    label: () => translate('menu.text.selectAll'),\r\n                    shortcut: '⌘A',\r\n                    icon: 'selectAll',\r\n                    action: () => sendTextEditorMenuAction('edit:selectAll'),\r\n                },\r\n            ],\r\n        },\r\n        {\r\n            id: 'view',\r\n            label: () => translate('menu.sections.view'),\r\n            items: [\r\n                {\r\n                    id: 'text-toggle-wrap',\r\n                    label: () => translate('menu.text.toggleWrap'),\r\n                    shortcut: '⌥⌘W',\r\n                    icon: 'wrap',\r\n                    action: () => sendTextEditorMenuAction('view:toggleWrap'),\r\n                },\r\n            ],\r\n        },\r\n        createWindowMenuSection(context),\r\n        createHelpMenuSection(context, {\r\n            itemKey: 'menu.text.help',\r\n            infoModalId: 'text-modal',\r\n            itemIcon: 'help',\r\n        }),\r\n    ];\r\n}\r\n\r\nfunction buildImageViewerMenuDefinition(context: MenuContext) {\r\n    const state = window['getImageViewerState']\r\n        ? window['getImageViewerState']()\r\n        : { hasImage: false };\r\n    return [\r\n        {\r\n            id: 'file',\r\n            label: () => translate('menu.sections.file'),\r\n            items: [\r\n                {\r\n                    id: 'image-open-tab',\r\n                    label: () => translate('menu.image.openInTab'),\r\n                    disabled: !state.hasImage,\r\n                    icon: 'imageOpen',\r\n                    action: () => {\r\n                        if (window['openActiveImageInNewTab']) window['openActiveImageInNewTab']();\r\n                    },\r\n                },\r\n                {\r\n                    id: 'image-download',\r\n                    label: () => translate('menu.image.saveImage'),\r\n                    disabled: !state.hasImage,\r\n                    icon: 'download',\r\n                    action: () => {\r\n                        if (window['downloadActiveImage']) window['downloadActiveImage']();\r\n                    },\r\n                },\r\n                { type: 'separator' },\r\n                {\r\n                    id: 'image-close',\r\n                    label: () => translate('menu.image.close'),\r\n                    shortcut: '⌘W',\r\n                    disabled: () => !(context && context.dialog),\r\n                    icon: 'close',\r\n                    action: () => closeContextWindow(context),\r\n                },\r\n            ],\r\n        },\r\n        createWindowMenuSection(context),\r\n        createHelpMenuSection(context, {\r\n            itemKey: 'menu.image.help',\r\n            infoModalId: 'image-modal',\r\n            itemIcon: 'help',\r\n        }),\r\n    ];\r\n}\r\n\r\nfunction buildAboutMenuDefinition(context: MenuContext) {\r\n    return [\r\n        {\r\n            id: 'file',\r\n            label: () => translate('menu.sections.file'),\r\n            items: [\r\n                {\r\n                    id: 'about-close',\r\n                    label: () => translate('menu.about.close'),\r\n                    shortcut: '⌘W',\r\n                    disabled: () => !(context && context.dialog),\r\n                    icon: 'close',\r\n                    action: () => closeContextWindow(context),\r\n                },\r\n            ],\r\n        },\r\n        createWindowMenuSection(context),\r\n        createHelpMenuSection(context, {\r\n            itemKey: 'menu.about.help',\r\n            infoModalId: 'about-modal',\r\n            itemIcon: 'info',\r\n        }),\r\n    ];\r\n}\r\n\r\nfunction buildProgramInfoMenuDefinition(context: MenuContext) {\r\n    return [\r\n        {\r\n            id: 'file',\r\n            label: () => translate('menu.sections.file'),\r\n            items: [\r\n                {\r\n                    id: 'program-info-close',\r\n                    label: () => translate('menu.programInfo.close'),\r\n                    shortcut: '⌘W',\r\n                    disabled: () => !(context && context.dialog),\r\n                    icon: 'close',\r\n                    action: () => closeContextWindow(context),\r\n                },\r\n            ],\r\n        },\r\n        createWindowMenuSection(context),\r\n    ];\r\n}\r\n\r\nfunction buildTerminalMenuDefinition(context: any) {\r\n    return [\r\n        {\r\n            id: 'file',\r\n            label: () => translate('menu.sections.file'),\r\n            items: [\r\n                {\r\n                    id: 'terminal-new-window',\r\n                    label: () => translate('menu.terminal.newWindow'),\r\n                    shortcut: '⌘N',\r\n                    icon: 'terminal',\r\n                    action: () => {\r\n                        if (\r\n                            window['TerminalInstanceManager'] &&\r\n                            typeof window['TerminalInstanceManager'].createInstance === 'function'\r\n                        )\r\n                            window['TerminalInstanceManager'].createInstance();\r\n                    },\r\n                },\r\n                { type: 'separator' },\r\n                {\r\n                    id: 'terminal-close',\r\n                    label: () => translate('menu.terminal.close'),\r\n                    shortcut: '⌘W',\r\n                    disabled: () => !(context && context.dialog),\r\n                    icon: 'close',\r\n                    action: () => closeContextWindow(context),\r\n                },\r\n            ],\r\n        },\r\n        {\r\n            id: 'edit',\r\n            label: () => translate('menu.sections.edit'),\r\n            items: [\r\n                {\r\n                    id: 'terminal-clear',\r\n                    label: () => translate('menu.terminal.clear'),\r\n                    shortcut: '⌘K',\r\n                    icon: 'clear',\r\n                    action: () => {\r\n                        if (context && context.instanceId && window['TerminalInstanceManager']) {\r\n                            const instance = window['TerminalInstanceManager'].getInstance(\r\n                                context.instanceId\r\n                            );\r\n                            if (instance && instance.clearOutput) instance.clearOutput();\r\n                        }\r\n                    },\r\n                },\r\n            ],\r\n        },\r\n        createWindowMenuSection(context),\r\n        createHelpMenuSection(context, {\r\n            itemKey: 'menu.terminal.help',\r\n            infoModalId: 'terminal-modal',\r\n            itemIcon: 'help',\r\n        }),\r\n    ];\r\n}\r\n\r\nfunction createWindowMenuSection(context: MenuContext) {\r\n    return {\r\n        id: 'window',\r\n        label: () => translate('menu.sections.window'),\r\n        items: getWindowMenuItems(context),\r\n    };\r\n}\r\n\r\nfunction getWindowMenuItems(context: MenuContext) {\r\n    const dialog = context && (context.dialog as any);\r\n    const hasDialog = Boolean(dialog && typeof dialog.close === 'function');\r\n    const items: any[] = [\r\n        {\r\n            id: 'window-minimize',\r\n            label: () => translate('menu.window.minimize'),\r\n            shortcut: '⌘M',\r\n            disabled: !hasDialog,\r\n            icon: 'windowMinimize',\r\n            action: () => {\r\n                if (dialog && typeof dialog.minimize === 'function') dialog.minimize();\r\n            },\r\n        },\r\n        {\r\n            id: 'window-zoom',\r\n            label: () => translate('menu.window.zoom'),\r\n            shortcut: '⌃⌘F',\r\n            disabled: !hasDialog,\r\n            icon: 'windowZoom',\r\n            action: () => {\r\n                if (dialog && typeof dialog.toggleMaximize === 'function') dialog.toggleMaximize();\r\n            },\r\n        },\r\n    ];\r\n    const multiInstanceItems = getMultiInstanceMenuItems(context);\r\n    if (multiInstanceItems.length > 0) {\r\n        items.push({ type: 'separator' });\r\n        items.push(...multiInstanceItems);\r\n    }\r\n    items.push(\r\n        { type: 'separator' },\r\n        {\r\n            id: 'window-all-front',\r\n            label: () => translate('menu.window.bringToFront'),\r\n            disabled: !hasAnyVisibleDialog(),\r\n            icon: 'windowFront',\r\n            action: () => {\r\n                if (window['bringAllWindowsToFront']) window['bringAllWindowsToFront']();\r\n            },\r\n        },\r\n        { type: 'separator' },\r\n        {\r\n            id: 'window-close',\r\n            label: () => translate('menu.window.close'),\r\n            shortcut: '⌘W',\r\n            disabled: !hasDialog,\r\n            icon: 'close',\r\n            action: () => closeContextWindow(context),\r\n        }\r\n    );\r\n    return items;\r\n}\r\n\r\nfunction getMultiInstanceMenuItems(context: MenuContext) {\r\n    const items: any[] = [];\r\n    let manager: any = null;\r\n    let typeLabel: string | null = null;\r\n    let newInstanceKey: string | null = null;\r\n    const modalId = context?.modalId;\r\n    if (\r\n        (modalId === 'finder-modal' || modalId === 'projects-modal') &&\r\n        window['FinderInstanceManager']\r\n    ) {\r\n        manager = window['FinderInstanceManager'];\r\n        typeLabel = 'Finder';\r\n        newInstanceKey = 'menu.window.newFinder';\r\n    } else if (modalId === 'terminal-modal' && window['TerminalInstanceManager']) {\r\n        manager = window['TerminalInstanceManager'];\r\n        typeLabel = 'Terminal';\r\n        newInstanceKey = 'menu.window.newTerminal';\r\n    } else if (modalId === 'text-modal' && window['TextEditorInstanceManager']) {\r\n        manager = window['TextEditorInstanceManager'];\r\n        typeLabel = 'Editor';\r\n        newInstanceKey = 'menu.window.newEditor';\r\n    }\r\n    if (!manager) return items;\r\n    items.push({\r\n        id: 'window-new-instance',\r\n        label: () => translate(newInstanceKey || 'menu.window.newWindow'),\r\n        shortcut: '⌘N',\r\n        icon: 'new',\r\n        action: () => {\r\n            const count = manager.getInstanceCount();\r\n            manager.createInstance({ title: `${typeLabel} ${count + 1}` } as any);\r\n        },\r\n    });\r\n    const instances = manager.getAllInstances();\r\n    if (instances.length > 1) {\r\n        items.push({ type: 'separator' });\r\n        instances.forEach((instance: any, index: number) => {\r\n            const isActive = manager.getActiveInstance()?.instanceId === instance.instanceId;\r\n            // Normalize label to always include index-based numbering for stable UI/test selection\r\n            const numberLabel = `${typeLabel} ${index + 1}`;\r\n            items.push({\r\n                id: `window-instance-${instance.instanceId}`,\r\n                label: () => `${isActive ? '✓ ' : ''}${numberLabel}`,\r\n                shortcut: index < 9 ? `⌘${index + 1}` : undefined,\r\n                action: () => {\r\n                    manager.setActiveInstance(instance.instanceId);\r\n                    // Also update visibility via MultiInstanceIntegration\r\n                    const integration = (window as any).multiInstanceIntegration;\r\n                    if (integration && typeof integration.updateInstanceVisibility === 'function') {\r\n                        // Determine type based on manager\r\n                        let type: string | null = null;\r\n                        if (manager === (window as any).FinderInstanceManager) type = 'finder';\r\n                        else if (manager === (window as any).TerminalInstanceManager)\r\n                            type = 'terminal';\r\n                        else if (manager === (window as any).TextEditorInstanceManager)\r\n                            type = 'text-editor';\r\n\r\n                        if (type) {\r\n                            integration.updateInstanceVisibility(type);\r\n                        }\r\n                    }\r\n                },\r\n            });\r\n        });\r\n        items.push(\r\n            { type: 'separator' },\r\n            {\r\n                id: 'window-close-all',\r\n                label: () => translate('menu.window.closeAll'),\r\n                icon: 'close',\r\n                action: () => {\r\n                    const base = translate('menu.window.closeAllConfirm');\r\n                    const confirmMsg =\r\n                        typeof base === 'string' && base !== 'menu.window.closeAllConfirm'\r\n                            ? base\r\n                            : `Close all ${typeLabel} (${instances.length})?`;\r\n                    if (confirm(confirmMsg)) {\r\n                        manager.destroyAllInstances();\r\n                        // If we closed all instances for a modal-backed window, also hide the modal\r\n                        const targetModal = (context as any)?.modalId;\r\n                        if (targetModal) {\r\n                            if (typeof window['API']?.window?.close === 'function') {\r\n                                window['API'].window.close(targetModal);\r\n                            } else {\r\n                                const el = document.getElementById(targetModal);\r\n                                if (el && !el.classList.contains('hidden')) {\r\n                                    const domUtils = (window as any).DOMUtils;\r\n                                    if (domUtils && typeof domUtils.hide === 'function') {\r\n                                        domUtils.hide(el);\r\n                                    } else {\r\n                                        el.classList.add('hidden');\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n            }\r\n        );\r\n    }\r\n    return items;\r\n}\r\n\r\nfunction createHelpMenuSection(context: any, overrides: any = {}) {\r\n    const sectionKey = overrides.sectionKey || 'menu.sections.help';\r\n    const itemKey = overrides.itemKey || 'menu.help.showHelp';\r\n    const infoModalId = overrides.infoModalId || context.modalId || null;\r\n    return {\r\n        id: overrides.id || 'help',\r\n        label: () => translate(sectionKey),\r\n        items: [\r\n            {\r\n                id: 'help-show-info',\r\n                label: () => translate(itemKey),\r\n                icon: overrides.itemIcon || 'help',\r\n                action: () => {\r\n                    if (window['openProgramInfoFromMenu'])\r\n                        window['openProgramInfoFromMenu'](infoModalId);\r\n                },\r\n            },\r\n        ],\r\n    };\r\n}\r\n\r\n// --- Rendering ---\r\nconst menuDefinitions: any = {\r\n    default: buildDefaultMenuDefinition,\r\n    'finder-modal': buildFinderMenuDefinition,\r\n    'projects-modal': buildFinderMenuDefinition,\r\n    'settings-modal': buildSettingsMenuDefinition,\r\n    'text-modal': buildTextEditorMenuDefinition,\r\n    'image-modal': buildImageViewerMenuDefinition,\r\n    'about-modal': buildAboutMenuDefinition,\r\n    'program-info-modal': buildProgramInfoMenuDefinition,\r\n    'terminal-modal': buildTerminalMenuDefinition,\r\n};\r\n\r\nlet currentMenuModalId: string | null = null;\r\n\r\nexport function renderApplicationMenu(activeModalId?: string | null) {\r\n    const container = document.getElementById('menubar-links');\r\n    if (!container) return;\r\n    const modalKey = activeModalId && menuDefinitions[activeModalId] ? activeModalId : 'default';\r\n    const builder = menuDefinitions[modalKey] || menuDefinitions.default;\r\n    const context = createMenuContext(activeModalId || null);\r\n    const sections =\r\n        typeof builder === 'function' ? builder(context) : Array.isArray(builder) ? builder : [];\r\n    container.innerHTML = '';\r\n    menuActionHandlers.clear();\r\n    menuActionIdCounter = 0;\r\n    currentMenuModalId = activeModalId || null;\r\n    if (!Array.isArray(sections) || sections.length === 0) return;\r\n    sections.forEach((section: any, sectionIndex: number) => {\r\n        if (!section) return;\r\n        const items = normalizeMenuItems(section.items, context);\r\n        if (!items.length) return;\r\n        const trigger = document.createElement('div');\r\n        trigger.className = 'menubar-trigger';\r\n        const button = document.createElement('button');\r\n        button.type = 'button';\r\n        button.className = 'menubar-item';\r\n        button.dataset.menubarTriggerButton = 'true';\r\n        const label = typeof section.label === 'function' ? section.label(context) : section.label;\r\n        button.textContent = label || '';\r\n        const sectionId = section.id || `section-${sectionIndex}`;\r\n        const buttonId = `menubar-menu-${sectionId}`;\r\n        const dropdownId = `menu-dropdown-${sectionId}`;\r\n        button.id = buttonId;\r\n        button.setAttribute('aria-haspopup', 'menu');\r\n        button.setAttribute('aria-expanded', 'false');\r\n        button.setAttribute('aria-controls', dropdownId);\r\n        const dropdown = document.createElement('ul');\r\n        dropdown.id = dropdownId;\r\n        dropdown.className = 'menu-dropdown hidden';\r\n        dropdown.setAttribute('role', 'menu');\r\n        dropdown.setAttribute('aria-labelledby', buttonId);\r\n        items.forEach(item => {\r\n            if (item.type === 'separator') {\r\n                const separator = document.createElement('li');\r\n                separator.className = 'menu-separator';\r\n                separator.setAttribute('role', 'separator');\r\n                separator.setAttribute('aria-hidden', 'true');\r\n                dropdown.appendChild(separator);\r\n                return;\r\n            }\r\n            const li = document.createElement('li');\r\n            li.setAttribute('role', 'none');\r\n            const tagName = item.href ? 'a' : 'button';\r\n            const actionEl = document.createElement(tagName) as any;\r\n            actionEl.className = 'menu-item';\r\n            if (tagName === 'button') actionEl.type = 'button';\r\n            else {\r\n                actionEl.href = item.href;\r\n                if (item.external) {\r\n                    actionEl.rel = 'noopener noreferrer';\r\n                    actionEl.target = '_blank';\r\n                }\r\n            }\r\n            const itemLabel =\r\n                item.label !== null\r\n                    ? typeof item.label === 'function'\r\n                        ? item.label(context)\r\n                        : item.label\r\n                    : '';\r\n            const labelSpan = document.createElement('span');\r\n            labelSpan.className = 'menu-item-label';\r\n            if (item.icon && (window as any).IconSystem) {\r\n                const iconSpan = document.createElement('span');\r\n                iconSpan.className = 'menu-item-icon';\r\n                const iconSvg = (window as any).IconSystem.getMenuIconSvg\r\n                    ? (window as any).IconSystem.getMenuIconSvg(item.icon)\r\n                    : '';\r\n                if ((window as any).IconSystem.renderIconIntoElement)\r\n                    (window as any).IconSystem.renderIconIntoElement(iconSpan, iconSvg, item.icon);\r\n                labelSpan.appendChild(iconSpan);\r\n            }\r\n            labelSpan.appendChild(document.createTextNode(itemLabel));\r\n            actionEl.appendChild(labelSpan);\r\n            if (item.shortcut) {\r\n                const shortcutSpan = document.createElement('span');\r\n                shortcutSpan.className = 'menu-item-shortcut';\r\n                shortcutSpan.textContent =\r\n                    typeof item.shortcut === 'function' ? item.shortcut() : item.shortcut;\r\n                actionEl.appendChild(shortcutSpan);\r\n            }\r\n            actionEl.setAttribute('role', 'menuitem');\r\n            if (item.title) actionEl.title = item.title;\r\n            const isDisabled = Boolean(item.disabled);\r\n            if (isDisabled) {\r\n                actionEl.setAttribute('aria-disabled', 'true');\r\n                if (tagName === 'button') actionEl.disabled = true;\r\n            } else if (typeof item.action === 'function') {\r\n                const actionId = registerMenuAction(item.action as MenuHandler);\r\n                if (actionId) actionEl.dataset.menuAction = actionId;\r\n            }\r\n            if (item.href && typeof item.onClick === 'function') {\r\n                actionEl.addEventListener('click', (event: Event) => {\r\n                    const result = (item.onClick as (e: Event) => boolean | void)(event);\r\n                    if (result === false) event.preventDefault();\r\n                });\r\n            }\r\n            li.appendChild(actionEl);\r\n            dropdown.appendChild(li);\r\n        });\r\n        if (!dropdown.childElementCount) return;\r\n        trigger.appendChild(button);\r\n        trigger.appendChild(dropdown);\r\n        container.appendChild(trigger);\r\n        if ((window as any).bindDropdownTrigger)\r\n            (window as any).bindDropdownTrigger(button, { hoverRequiresOpen: true });\r\n    });\r\n}\r\n\r\nexport function handleMenuActionActivation(event: Event) {\r\n    const target =\r\n        event.target instanceof Element\r\n            ? (event.target as Element).closest('[data-menu-action]')\r\n            : null;\r\n    if (!target) return;\r\n    const actionId = target.getAttribute('data-menu-action');\r\n    const handler = actionId ? menuActionHandlers.get(actionId) : null;\r\n    if (typeof handler !== 'function') return;\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    if ((window as any).hideMenuDropdowns) (window as any).hideMenuDropdowns();\r\n    try {\r\n        handler();\r\n    } catch (err) {\r\n        console.error('Error executing menu action:', err);\r\n    }\r\n}\r\n\r\nfunction closeContextWindow(context: any) {\r\n    const dialog = context && context.dialog;\r\n    if (dialog && typeof dialog.close === 'function') dialog.close();\r\n}\r\n\r\nfunction hasAnyVisibleDialog() {\r\n    if (!window['dialogs']) return false;\r\n    return Object.values(window['dialogs']).some((d: any) =>\r\n        d && typeof d.isOpen === 'function' ? d.isOpen() : Boolean(d && d.isOpen)\r\n    );\r\n}\r\n\r\nfunction sendTextEditorMenuAction(actionType: string) {\r\n    if ((window as any).sendTextEditorMenuAction)\r\n        (window as any).sendTextEditorMenuAction(actionType);\r\n}\r\n\r\nfunction createMenuContext(modalId: string | null) {\r\n    const w = window as any;\r\n    // Allow external override but avoid self-recursion when this function is\r\n    // hoisted onto window as a global in non-module script context.\r\n    if (w.createMenuContext && w.createMenuContext !== (createMenuContext as any)) {\r\n        try {\r\n            return w.createMenuContext(modalId);\r\n        } catch (e) {\r\n            console.warn('[Menu] createMenuContext override threw; falling back', e);\r\n        }\r\n    }\r\n    return { modalId: modalId, dialog: null };\r\n}\r\n\r\nfunction translate(key: string, fallback?: string) {\r\n    if ((window as any).appI18n && typeof (window as any).appI18n.translate === 'function') {\r\n        const result = (window as any).appI18n.translate(key);\r\n        if (result === key && fallback) return fallback;\r\n        return result;\r\n    }\r\n    return fallback || key;\r\n}\r\n\r\nexport function refreshCurrentMenu() {\r\n    renderApplicationMenu(currentMenuModalId);\r\n}\r\n\r\nexport function setupInstanceManagerListeners() {\r\n    const managers = [\r\n        window['FinderInstanceManager'],\r\n        window['TerminalInstanceManager'],\r\n        window['TextEditorInstanceManager'],\r\n    ];\r\n    managers.forEach(manager => {\r\n        if (!manager || !manager.getAllInstances) return;\r\n        const originalCreate = manager.createInstance;\r\n        const originalDestroy = manager.destroyInstance;\r\n        const originalDestroyAll = manager.destroyAllInstances;\r\n        if (originalCreate)\r\n            manager.createInstance = function (...args: any[]) {\r\n                const result = originalCreate.apply(this, args);\r\n                if (result) setTimeout(refreshCurrentMenu, 50);\r\n                return result;\r\n            };\r\n        if (originalDestroy)\r\n            manager.destroyInstance = function (...args: any[]) {\r\n                const result = originalDestroy.apply(this, args);\r\n                setTimeout(refreshCurrentMenu, 50);\r\n                return result;\r\n            };\r\n        if (originalDestroyAll)\r\n            manager.destroyAllInstances = function (...args: any[]) {\r\n                const result = originalDestroyAll.apply(this, args);\r\n                setTimeout(refreshCurrentMenu, 50);\r\n                return result;\r\n            };\r\n    });\r\n}\r\n\r\nif (document.readyState === 'loading')\r\n    document.addEventListener('DOMContentLoaded', setupInstanceManagerListeners);\r\nelse setTimeout(setupInstanceManagerListeners, 100);\r\n\r\n// Export\r\ndeclare global {\r\n    interface Window {\r\n        MenuSystem?: any;\r\n    }\r\n}\r\n(window as any).MenuSystem = {\r\n    renderApplicationMenu,\r\n    handleMenuActionActivation,\r\n    menuDefinitions,\r\n    getCurrentMenuModalId: () => currentMenuModalId,\r\n};\r\nconsole.log('✅ MenuSystem loaded');\r\n\r\nexport default {};\r\n\r\n"]}