{"version":3,"file":"menu.js","sourceRoot":"","sources":["../src/ts/menu.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * src/ts/menu.ts\n * Typed port of js/menu.js\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\n// Allow dynamic access on window via string keys for legacy globals\ndeclare global {\n    interface Window {\n        [key: string]: any;\n    }\n}\n\ntype MenuHandler = (...args: any[]) => unknown;\nconst menuActionHandlers = new Map<string, MenuHandler>();\nlet menuActionIdCounter = 0;\n\ntype MenuContext = {\n    modalId?: string;\n    dialog?: { close?: () => void; minimize?: () => void; toggleMaximize?: () => void } | null;\n} | null;\n\nexport function registerMenuAction(handler: MenuHandler) {\n    if (typeof handler !== 'function') return null;\n    const actionId = `menu-action-${++menuActionIdCounter}`;\n    menuActionHandlers.set(actionId, handler);\n    return actionId;\n}\n\nexport function normalizeMenuItems(items: unknown[], context: MenuContext) {\n    if (!Array.isArray(items)) return [];\n    const normalized: Record<string, unknown>[] = [];\n    let previousWasSeparator = true;\n    items.forEach(raw => {\n        const item = raw as any;\n        if (!item) return;\n        if (item.type === 'separator') {\n            if (previousWasSeparator) return;\n            normalized.push({ type: 'separator' });\n            previousWasSeparator = true;\n            return;\n        }\n        const clone = Object.assign({}, item) as Record<string, unknown>;\n        if (typeof item.disabled === 'function')\n            (clone.disabled as unknown) = (item.disabled as (ctx: MenuContext) => boolean)(context);\n        if (typeof item.label === 'function')\n            (clone.label as unknown) = (item.label as (ctx: MenuContext) => string)(context);\n        if (typeof item.shortcut === 'function')\n            (clone.shortcut as unknown) = (item.shortcut as (ctx: MenuContext) => string)(context);\n        normalized.push(clone);\n        previousWasSeparator = false;\n    });\n    while (normalized.length && normalized[normalized.length - 1]?.type === 'separator')\n        normalized.pop();\n    return normalized;\n}\n\n// --- Menu builders (ported functions simplified to reference window helpers) ---\nfunction buildDefaultMenuDefinition(context: MenuContext) {\n    return buildFinderMenuDefinition(context);\n}\n\nfunction buildFinderMenuDefinition(context: MenuContext) {\n    return [\n        {\n            id: 'file',\n            label: () => translate('menu.sections.file'),\n            items: [\n                {\n                    id: 'finder-new-window',\n                    label: () => translate('menu.finder.newWindow'),\n                    shortcut: '⌘N',\n                    icon: 'new',\n                    action: () => {\n                        const mgr = window['FinderInstanceManager'];\n                        if (mgr && typeof mgr.createInstance === 'function') {\n                            const count = mgr.getInstanceCount\n                                ? mgr.getInstanceCount()\n                                : mgr.getAllInstances?.().length || 0;\n                            mgr.createInstance({ title: `Finder ${count + 1}` });\n                        }\n                    },\n                },\n                {\n                    id: 'finder-reload',\n                    label: () => translate('menu.finder.reload'),\n                    shortcut: '⌘R',\n                    icon: 'reload',\n                    action: () => {\n                        if (\n                            window['FinderSystem'] &&\n                            typeof window['FinderSystem'].navigateTo === 'function'\n                        ) {\n                            try {\n                                const st =\n                                    window['FinderSystem'].getState &&\n                                    window['FinderSystem'].getState();\n                                if (st && Array.isArray(st.githubRepos)) st.githubRepos = [];\n                                window['FinderSystem'].navigateTo([], 'github');\n                            } catch (e) {\n                                console.warn('Finder reload failed', e);\n                            }\n                        }\n                    },\n                },\n                { type: 'separator' },\n                {\n                    id: 'finder-close',\n                    label: () => translate('menu.finder.close'),\n                    shortcut: '⌘W',\n                    disabled: () => !(context && context.dialog),\n                    icon: 'close',\n                    action: () => closeContextWindow(context),\n                },\n            ],\n        },\n        createWindowMenuSection(context),\n        createHelpMenuSection(context, {\n            itemKey: 'menu.finder.help',\n            infoModalId: 'finder-modal',\n            itemIcon: 'help',\n        }),\n    ];\n}\n\nfunction buildSettingsMenuDefinition(context: MenuContext) {\n    return [\n        {\n            id: 'file',\n            label: () => translate('menu.sections.file'),\n            items: [\n                {\n                    id: 'settings-close',\n                    label: () => translate('menu.settings.close'),\n                    shortcut: '⌘W',\n                    disabled: () => !(context && context.dialog),\n                    icon: 'close',\n                    action: () => closeContextWindow(context),\n                },\n            ],\n        },\n        createWindowMenuSection(context),\n        createHelpMenuSection(context, {\n            itemKey: 'menu.settings.help',\n            infoModalId: 'settings-modal',\n            itemIcon: 'help',\n        }),\n    ];\n}\n\nfunction buildTextEditorMenuDefinition(context: MenuContext) {\n    return [\n        {\n            id: 'file',\n            label: () => translate('menu.sections.file'),\n            items: [\n                {\n                    id: 'text-new',\n                    label: () => translate('menu.text.newFile'),\n                    shortcut: '⌘N',\n                    icon: 'newFile',\n                    action: () => sendTextEditorMenuAction('file:new'),\n                },\n                {\n                    id: 'text-open',\n                    label: () => translate('menu.text.open'),\n                    shortcut: '⌘O',\n                    icon: 'open',\n                    action: () => sendTextEditorMenuAction('file:open'),\n                },\n                {\n                    id: 'text-save',\n                    label: () => translate('menu.text.save'),\n                    shortcut: '⌘S',\n                    icon: 'save',\n                    action: () => sendTextEditorMenuAction('file:save'),\n                },\n            ],\n        },\n        {\n            id: 'edit',\n            label: () => translate('menu.sections.edit'),\n            items: [\n                {\n                    id: 'text-undo',\n                    label: () => translate('menu.text.undo'),\n                    shortcut: '⌘Z',\n                    icon: 'undo',\n                    action: () => sendTextEditorMenuAction('edit:undo'),\n                },\n                {\n                    id: 'text-redo',\n                    label: () => translate('menu.text.redo'),\n                    shortcut: '⇧⌘Z',\n                    icon: 'redo',\n                    action: () => sendTextEditorMenuAction('edit:redo'),\n                },\n                { type: 'separator' },\n                {\n                    id: 'text-cut',\n                    label: () => translate('menu.text.cut'),\n                    shortcut: '⌘X',\n                    icon: 'cut',\n                    action: () => sendTextEditorMenuAction('edit:cut'),\n                },\n                {\n                    id: 'text-copy',\n                    label: () => translate('menu.text.copy'),\n                    shortcut: '⌘C',\n                    icon: 'copy',\n                    action: () => sendTextEditorMenuAction('edit:copy'),\n                },\n                {\n                    id: 'text-paste',\n                    label: () => translate('menu.text.paste'),\n                    shortcut: '⌘V',\n                    icon: 'paste',\n                    action: () => sendTextEditorMenuAction('edit:paste'),\n                },\n                { type: 'separator' },\n                {\n                    id: 'text-select-all',\n                    label: () => translate('menu.text.selectAll'),\n                    shortcut: '⌘A',\n                    icon: 'selectAll',\n                    action: () => sendTextEditorMenuAction('edit:selectAll'),\n                },\n            ],\n        },\n        {\n            id: 'view',\n            label: () => translate('menu.sections.view'),\n            items: [\n                {\n                    id: 'text-toggle-wrap',\n                    label: () => translate('menu.text.toggleWrap'),\n                    shortcut: '⌥⌘W',\n                    icon: 'wrap',\n                    action: () => sendTextEditorMenuAction('view:toggleWrap'),\n                },\n            ],\n        },\n        createWindowMenuSection(context),\n        createHelpMenuSection(context, {\n            itemKey: 'menu.text.help',\n            infoModalId: 'text-modal',\n            itemIcon: 'help',\n        }),\n    ];\n}\n\nfunction buildImageViewerMenuDefinition(context: MenuContext) {\n    const state = window['getImageViewerState']\n        ? window['getImageViewerState']()\n        : { hasImage: false };\n    return [\n        {\n            id: 'file',\n            label: () => translate('menu.sections.file'),\n            items: [\n                {\n                    id: 'image-open-tab',\n                    label: () => translate('menu.image.openInTab'),\n                    disabled: !state.hasImage,\n                    icon: 'imageOpen',\n                    action: () => {\n                        if (window['openActiveImageInNewTab']) window['openActiveImageInNewTab']();\n                    },\n                },\n                {\n                    id: 'image-download',\n                    label: () => translate('menu.image.saveImage'),\n                    disabled: !state.hasImage,\n                    icon: 'download',\n                    action: () => {\n                        if (window['downloadActiveImage']) window['downloadActiveImage']();\n                    },\n                },\n                { type: 'separator' },\n                {\n                    id: 'image-close',\n                    label: () => translate('menu.image.close'),\n                    shortcut: '⌘W',\n                    disabled: () => !(context && context.dialog),\n                    icon: 'close',\n                    action: () => closeContextWindow(context),\n                },\n            ],\n        },\n        createWindowMenuSection(context),\n        createHelpMenuSection(context, {\n            itemKey: 'menu.image.help',\n            infoModalId: 'image-modal',\n            itemIcon: 'help',\n        }),\n    ];\n}\n\nfunction buildAboutMenuDefinition(context: MenuContext) {\n    return [\n        {\n            id: 'file',\n            label: () => translate('menu.sections.file'),\n            items: [\n                {\n                    id: 'about-close',\n                    label: () => translate('menu.about.close'),\n                    shortcut: '⌘W',\n                    disabled: () => !(context && context.dialog),\n                    icon: 'close',\n                    action: () => closeContextWindow(context),\n                },\n            ],\n        },\n        createWindowMenuSection(context),\n        createHelpMenuSection(context, {\n            itemKey: 'menu.about.help',\n            infoModalId: 'about-modal',\n            itemIcon: 'info',\n        }),\n    ];\n}\n\nfunction buildProgramInfoMenuDefinition(context: MenuContext) {\n    return [\n        {\n            id: 'file',\n            label: () => translate('menu.sections.file'),\n            items: [\n                {\n                    id: 'program-info-close',\n                    label: () => translate('menu.programInfo.close'),\n                    shortcut: '⌘W',\n                    disabled: () => !(context && context.dialog),\n                    icon: 'close',\n                    action: () => closeContextWindow(context),\n                },\n            ],\n        },\n        createWindowMenuSection(context),\n    ];\n}\n\nfunction buildTerminalMenuDefinition(context: any) {\n    return [\n        {\n            id: 'file',\n            label: () => translate('menu.sections.file'),\n            items: [\n                {\n                    id: 'terminal-new-window',\n                    label: () => translate('menu.terminal.newWindow'),\n                    shortcut: '⌘N',\n                    icon: 'terminal',\n                    action: () => {\n                        if (\n                            window['TerminalInstanceManager'] &&\n                            typeof window['TerminalInstanceManager'].createInstance === 'function'\n                        )\n                            window['TerminalInstanceManager'].createInstance();\n                    },\n                },\n                { type: 'separator' },\n                {\n                    id: 'terminal-close',\n                    label: () => translate('menu.terminal.close'),\n                    shortcut: '⌘W',\n                    disabled: () => !(context && context.dialog),\n                    icon: 'close',\n                    action: () => closeContextWindow(context),\n                },\n            ],\n        },\n        {\n            id: 'edit',\n            label: () => translate('menu.sections.edit'),\n            items: [\n                {\n                    id: 'terminal-clear',\n                    label: () => translate('menu.terminal.clear'),\n                    shortcut: '⌘K',\n                    icon: 'clear',\n                    action: () => {\n                        if (context && context.instanceId && window['TerminalInstanceManager']) {\n                            const instance = window['TerminalInstanceManager'].getInstance(\n                                context.instanceId\n                            );\n                            if (instance && instance.clearOutput) instance.clearOutput();\n                        }\n                    },\n                },\n            ],\n        },\n        createWindowMenuSection(context),\n        createHelpMenuSection(context, {\n            itemKey: 'menu.terminal.help',\n            infoModalId: 'terminal-modal',\n            itemIcon: 'help',\n        }),\n    ];\n}\n\nfunction createWindowMenuSection(context: MenuContext) {\n    return {\n        id: 'window',\n        label: () => translate('menu.sections.window'),\n        items: getWindowMenuItems(context),\n    };\n}\n\nfunction getWindowMenuItems(context: MenuContext) {\n    const dialog = context && (context.dialog as any);\n    const hasDialog = Boolean(dialog && typeof dialog.close === 'function');\n    const items: any[] = [\n        {\n            id: 'window-minimize',\n            label: () => translate('menu.window.minimize'),\n            shortcut: '⌘M',\n            disabled: !hasDialog,\n            icon: 'windowMinimize',\n            action: () => {\n                if (dialog && typeof dialog.minimize === 'function') dialog.minimize();\n            },\n        },\n        {\n            id: 'window-zoom',\n            label: () => translate('menu.window.zoom'),\n            shortcut: '⌃⌘F',\n            disabled: !hasDialog,\n            icon: 'windowZoom',\n            action: () => {\n                if (dialog && typeof dialog.toggleMaximize === 'function') dialog.toggleMaximize();\n            },\n        },\n    ];\n    const multiInstanceItems = getMultiInstanceMenuItems(context);\n    if (multiInstanceItems.length > 0) {\n        items.push({ type: 'separator' });\n        items.push(...multiInstanceItems);\n    }\n    items.push(\n        { type: 'separator' },\n        {\n            id: 'window-all-front',\n            label: () => translate('menu.window.bringToFront'),\n            disabled: !hasAnyVisibleDialog(),\n            icon: 'windowFront',\n            action: () => {\n                if (window['bringAllWindowsToFront']) window['bringAllWindowsToFront']();\n            },\n        },\n        { type: 'separator' },\n        {\n            id: 'window-close',\n            label: () => translate('menu.window.close'),\n            shortcut: '⌘W',\n            disabled: !hasDialog,\n            icon: 'close',\n            action: () => closeContextWindow(context),\n        }\n    );\n    return items;\n}\n\nfunction getMultiInstanceMenuItems(context: MenuContext) {\n    const items: any[] = [];\n    let manager: any = null;\n    let typeLabel: string | null = null;\n    let newInstanceKey: string | null = null;\n    const modalId = context?.modalId;\n    if (\n        (modalId === 'finder-modal' || modalId === 'projects-modal') &&\n        window['FinderInstanceManager']\n    ) {\n        manager = window['FinderInstanceManager'];\n        typeLabel = 'Finder';\n        newInstanceKey = 'menu.window.newFinder';\n    } else if (modalId === 'terminal-modal' && window['TerminalInstanceManager']) {\n        manager = window['TerminalInstanceManager'];\n        typeLabel = 'Terminal';\n        newInstanceKey = 'menu.window.newTerminal';\n    } else if (modalId === 'text-modal' && window['TextEditorInstanceManager']) {\n        manager = window['TextEditorInstanceManager'];\n        typeLabel = 'Editor';\n        newInstanceKey = 'menu.window.newEditor';\n    }\n    if (!manager) return items;\n    items.push({\n        id: 'window-new-instance',\n        label: () => translate(newInstanceKey || 'menu.window.newWindow'),\n        shortcut: '⌘N',\n        icon: 'new',\n        action: () => {\n            const count = manager.getInstanceCount();\n            manager.createInstance({ title: `${typeLabel} ${count + 1}` } as any);\n        },\n    });\n    const instances = manager.getAllInstances();\n    if (instances.length > 1) {\n        items.push({ type: 'separator' });\n        instances.forEach((instance: any, index: number) => {\n            const isActive = manager.getActiveInstance()?.instanceId === instance.instanceId;\n            // Normalize label to always include index-based numbering for stable UI/test selection\n            const numberLabel = `${typeLabel} ${index + 1}`;\n            items.push({\n                id: `window-instance-${instance.instanceId}`,\n                label: () => `${isActive ? '✓ ' : ''}${numberLabel}`,\n                shortcut: index < 9 ? `⌘${index + 1}` : undefined,\n                action: () => {\n                    manager.setActiveInstance(instance.instanceId);\n                    // Also update visibility via MultiInstanceIntegration\n                    const integration = (window as any).multiInstanceIntegration;\n                    if (integration && typeof integration.updateInstanceVisibility === 'function') {\n                        // Determine type based on manager\n                        let type: string | null = null;\n                        if (manager === (window as any).FinderInstanceManager) type = 'finder';\n                        else if (manager === (window as any).TerminalInstanceManager)\n                            type = 'terminal';\n                        else if (manager === (window as any).TextEditorInstanceManager)\n                            type = 'text-editor';\n\n                        if (type) {\n                            integration.updateInstanceVisibility(type);\n                        }\n                    }\n                },\n            });\n        });\n        items.push(\n            { type: 'separator' },\n            {\n                id: 'window-close-all',\n                label: () => translate('menu.window.closeAll'),\n                icon: 'close',\n                action: () => {\n                    const base = translate('menu.window.closeAllConfirm');\n                    const confirmMsg =\n                        typeof base === 'string' && base !== 'menu.window.closeAllConfirm'\n                            ? base\n                            : `Close all ${typeLabel} (${instances.length})?`;\n                    if (confirm(confirmMsg)) {\n                        manager.destroyAllInstances();\n                        // If we closed all instances for a modal-backed window, also hide the modal\n                        const targetModal = (context as any)?.modalId;\n                        if (targetModal) {\n                            if (typeof window['API']?.window?.close === 'function') {\n                                window['API'].window.close(targetModal);\n                            } else {\n                                const el = document.getElementById(targetModal);\n                                if (el && !el.classList.contains('hidden')) {\n                                    const domUtils = (window as any).DOMUtils;\n                                    if (domUtils && typeof domUtils.hide === 'function') {\n                                        domUtils.hide(el);\n                                    } else {\n                                        el.classList.add('hidden');\n                                    }\n                                }\n                            }\n                        }\n                    }\n                },\n            }\n        );\n    }\n    return items;\n}\n\nfunction createHelpMenuSection(context: any, overrides: any = {}) {\n    const sectionKey = overrides.sectionKey || 'menu.sections.help';\n    const itemKey = overrides.itemKey || 'menu.help.showHelp';\n    const infoModalId = overrides.infoModalId || context.modalId || null;\n    return {\n        id: overrides.id || 'help',\n        label: () => translate(sectionKey),\n        items: [\n            {\n                id: 'help-show-info',\n                label: () => translate(itemKey),\n                icon: overrides.itemIcon || 'help',\n                action: () => {\n                    if (window['openProgramInfoFromMenu'])\n                        window['openProgramInfoFromMenu'](infoModalId);\n                },\n            },\n        ],\n    };\n}\n\n// --- Rendering ---\nconst menuDefinitions: any = {\n    default: buildDefaultMenuDefinition,\n    'finder-modal': buildFinderMenuDefinition,\n    'projects-modal': buildFinderMenuDefinition,\n    'settings-modal': buildSettingsMenuDefinition,\n    'text-modal': buildTextEditorMenuDefinition,\n    'image-modal': buildImageViewerMenuDefinition,\n    'about-modal': buildAboutMenuDefinition,\n    'program-info-modal': buildProgramInfoMenuDefinition,\n    'terminal-modal': buildTerminalMenuDefinition,\n};\n\nlet currentMenuModalId: string | null = null;\n\nexport function renderApplicationMenu(activeModalId?: string | null) {\n    const container = document.getElementById('menubar-links');\n    if (!container) return;\n    const modalKey = activeModalId && menuDefinitions[activeModalId] ? activeModalId : 'default';\n    const builder = menuDefinitions[modalKey] || menuDefinitions.default;\n    const context = createMenuContext(activeModalId || null);\n    const sections =\n        typeof builder === 'function' ? builder(context) : Array.isArray(builder) ? builder : [];\n    container.innerHTML = '';\n    menuActionHandlers.clear();\n    menuActionIdCounter = 0;\n    currentMenuModalId = activeModalId || null;\n    if (!Array.isArray(sections) || sections.length === 0) return;\n    sections.forEach((section: any, sectionIndex: number) => {\n        if (!section) return;\n        const items = normalizeMenuItems(section.items, context);\n        if (!items.length) return;\n        const trigger = document.createElement('div');\n        trigger.className = 'menubar-trigger';\n        const button = document.createElement('button');\n        button.type = 'button';\n        button.className = 'menubar-item';\n        button.dataset.menubarTriggerButton = 'true';\n        const label = typeof section.label === 'function' ? section.label(context) : section.label;\n        button.textContent = label || '';\n        const sectionId = section.id || `section-${sectionIndex}`;\n        const buttonId = `menubar-menu-${sectionId}`;\n        const dropdownId = `menu-dropdown-${sectionId}`;\n        button.id = buttonId;\n        button.setAttribute('aria-haspopup', 'menu');\n        button.setAttribute('aria-expanded', 'false');\n        button.setAttribute('aria-controls', dropdownId);\n        const dropdown = document.createElement('ul');\n        dropdown.id = dropdownId;\n        dropdown.className = 'menu-dropdown hidden';\n        dropdown.setAttribute('role', 'menu');\n        dropdown.setAttribute('aria-labelledby', buttonId);\n        items.forEach(item => {\n            if (item.type === 'separator') {\n                const separator = document.createElement('li');\n                separator.className = 'menu-separator';\n                separator.setAttribute('role', 'separator');\n                separator.setAttribute('aria-hidden', 'true');\n                dropdown.appendChild(separator);\n                return;\n            }\n            const li = document.createElement('li');\n            li.setAttribute('role', 'none');\n            const tagName = item.href ? 'a' : 'button';\n            const actionEl = document.createElement(tagName) as any;\n            actionEl.className = 'menu-item';\n            if (tagName === 'button') actionEl.type = 'button';\n            else {\n                actionEl.href = item.href;\n                if (item.external) {\n                    actionEl.rel = 'noopener noreferrer';\n                    actionEl.target = '_blank';\n                }\n            }\n            const itemLabel =\n                item.label !== null\n                    ? typeof item.label === 'function'\n                        ? item.label(context)\n                        : item.label\n                    : '';\n            const labelSpan = document.createElement('span');\n            labelSpan.className = 'menu-item-label';\n            if (item.icon && (window as any).IconSystem) {\n                const iconSpan = document.createElement('span');\n                iconSpan.className = 'menu-item-icon';\n                const iconSvg = (window as any).IconSystem.getMenuIconSvg\n                    ? (window as any).IconSystem.getMenuIconSvg(item.icon)\n                    : '';\n                if ((window as any).IconSystem.renderIconIntoElement)\n                    (window as any).IconSystem.renderIconIntoElement(iconSpan, iconSvg, item.icon);\n                labelSpan.appendChild(iconSpan);\n            }\n            labelSpan.appendChild(document.createTextNode(itemLabel));\n            actionEl.appendChild(labelSpan);\n            if (item.shortcut) {\n                const shortcutSpan = document.createElement('span');\n                shortcutSpan.className = 'menu-item-shortcut';\n                shortcutSpan.textContent =\n                    typeof item.shortcut === 'function' ? item.shortcut() : item.shortcut;\n                actionEl.appendChild(shortcutSpan);\n            }\n            actionEl.setAttribute('role', 'menuitem');\n            if (item.title) actionEl.title = item.title;\n            const isDisabled = Boolean(item.disabled);\n            if (isDisabled) {\n                actionEl.setAttribute('aria-disabled', 'true');\n                if (tagName === 'button') actionEl.disabled = true;\n            } else if (typeof item.action === 'function') {\n                const actionId = registerMenuAction(item.action as MenuHandler);\n                if (actionId) actionEl.dataset.menuAction = actionId;\n            }\n            if (item.href && typeof item.onClick === 'function') {\n                actionEl.addEventListener('click', (event: Event) => {\n                    const result = (item.onClick as (e: Event) => boolean | void)(event);\n                    if (result === false) event.preventDefault();\n                });\n            }\n            li.appendChild(actionEl);\n            dropdown.appendChild(li);\n        });\n        if (!dropdown.childElementCount) return;\n        trigger.appendChild(button);\n        trigger.appendChild(dropdown);\n        container.appendChild(trigger);\n        if ((window as any).bindDropdownTrigger)\n            (window as any).bindDropdownTrigger(button, { hoverRequiresOpen: true });\n    });\n}\n\nexport function handleMenuActionActivation(event: Event) {\n    const target =\n        event.target instanceof Element\n            ? (event.target as Element).closest('[data-menu-action]')\n            : null;\n    if (!target) return;\n    const actionId = target.getAttribute('data-menu-action');\n    const handler = actionId ? menuActionHandlers.get(actionId) : null;\n    if (typeof handler !== 'function') return;\n    event.preventDefault();\n    event.stopPropagation();\n    if ((window as any).hideMenuDropdowns) (window as any).hideMenuDropdowns();\n    try {\n        handler();\n    } catch (err) {\n        console.error('Error executing menu action:', err);\n    }\n}\n\nfunction closeContextWindow(context: any) {\n    const dialog = context && context.dialog;\n    if (dialog && typeof dialog.close === 'function') dialog.close();\n}\n\nfunction hasAnyVisibleDialog() {\n    if (!window['dialogs']) return false;\n    return Object.values(window['dialogs']).some((d: any) =>\n        d && typeof d.isOpen === 'function' ? d.isOpen() : Boolean(d && d.isOpen)\n    );\n}\n\nfunction sendTextEditorMenuAction(actionType: string) {\n    if ((window as any).sendTextEditorMenuAction)\n        (window as any).sendTextEditorMenuAction(actionType);\n}\n\nfunction createMenuContext(modalId: string | null) {\n    const w = window as any;\n    // Allow external override but avoid self-recursion when this function is\n    // hoisted onto window as a global in non-module script context.\n    if (w.createMenuContext && w.createMenuContext !== (createMenuContext as any)) {\n        try {\n            return w.createMenuContext(modalId);\n        } catch (e) {\n            console.warn('[Menu] createMenuContext override threw; falling back', e);\n        }\n    }\n    return { modalId: modalId, dialog: null };\n}\n\nfunction translate(key: string, fallback?: string) {\n    if ((window as any).appI18n && typeof (window as any).appI18n.translate === 'function') {\n        const result = (window as any).appI18n.translate(key);\n        if (result === key && fallback) return fallback;\n        return result;\n    }\n    return fallback || key;\n}\n\nexport function refreshCurrentMenu() {\n    renderApplicationMenu(currentMenuModalId);\n}\n\nexport function setupInstanceManagerListeners() {\n    const managers = [\n        window['FinderInstanceManager'],\n        window['TerminalInstanceManager'],\n        window['TextEditorInstanceManager'],\n    ];\n    managers.forEach(manager => {\n        if (!manager || !manager.getAllInstances) return;\n        const originalCreate = manager.createInstance;\n        const originalDestroy = manager.destroyInstance;\n        const originalDestroyAll = manager.destroyAllInstances;\n        if (originalCreate)\n            manager.createInstance = function (...args: any[]) {\n                const result = originalCreate.apply(this, args);\n                if (result) setTimeout(refreshCurrentMenu, 50);\n                return result;\n            };\n        if (originalDestroy)\n            manager.destroyInstance = function (...args: any[]) {\n                const result = originalDestroy.apply(this, args);\n                setTimeout(refreshCurrentMenu, 50);\n                return result;\n            };\n        if (originalDestroyAll)\n            manager.destroyAllInstances = function (...args: any[]) {\n                const result = originalDestroyAll.apply(this, args);\n                setTimeout(refreshCurrentMenu, 50);\n                return result;\n            };\n    });\n}\n\nif (document.readyState === 'loading')\n    document.addEventListener('DOMContentLoaded', setupInstanceManagerListeners);\nelse setTimeout(setupInstanceManagerListeners, 100);\n\n// Export\ndeclare global {\n    interface Window {\n        MenuSystem?: any;\n    }\n}\n(window as any).MenuSystem = {\n    renderApplicationMenu,\n    handleMenuActionActivation,\n    menuDefinitions,\n    getCurrentMenuModalId: () => currentMenuModalId,\n};\nconsole.log('✅ MenuSystem loaded');\n\nexport default {};\n\n"]}