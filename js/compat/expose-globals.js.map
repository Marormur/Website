{"version":3,"file":"expose-globals.js","sourceRoot":"","sources":["../../src/ts/compat/expose-globals.ts"],"names":[],"mappings":";AAAA;;;;GAIG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEH,OAAO,CAAC,GAAG,CAAC,uCAAuC,CAAC,CAAC;AAErD,2DAA2D;AAC3D,uDAAyC;AAEzC,kEAAkE;AAClE,wBAAsB;AAEtB,mFAAmF;AACnF,kBAAgB;AAChB,6BAA2B;AAC3B,yBAAuB;AACvB,2BAAyB;AACzB,yBAAuB;AACvB,8BAA4B;AAC5B,gCAA8B;AAC9B,mBAAiB;AACjB,mBAAiB;AACjB,qBAAmB;AACnB,4BAA0B;AAC1B,2BAAyB;AACzB,sBAAoB;AACpB,8BAA4B,CAAC,iCAAiC;AAC9D,oBAAkB;AAClB,mCAAiC,CAAC,kCAAkC;AACpE,+BAA6B;AAC7B,4BAA0B;AAC1B,0BAAwB;AACxB,gCAA8B;AAC9B,mCAAiC;AACjC,0BAAwB;AACxB,iCAA+B;AAC/B,qBAAmB;AACnB,iCAA+B;AAC/B,yBAAuB;AACvB,4EAA4E;AAC5E,yFAAyF;AACzF,yBAAuB;AAEvB,yEAAyE;AACzE,uCAAqC,CAAC,0CAA0C;AAChF,wCAAsC;AACtC,kCAAgC;AAChC,yCAAuC;AACvC,gCAA8B;AAC9B,+BAA6B;AAE7B,uFAAuF;AACvF,kFAAkF;AAClF,uFAAuF;AACvF,uBAAqB;AAOrB,MAAM,CAAC,GAAG,MAAqC,CAAC;AAEhD,IAAI,CAAC,CAAC,UAAU,IAAI,CAAC,CAAC,EAAE,CAAC;IACrB,CAAC,CAAC,UAAU,CAAC,GAAG,QAAQ,CAAC;AAC7B,CAAC;AAED,oEAAoE;AACpE,mEAAmE;AACnE,IAAI,OAAO,CAAC,CAAC,OAAO,KAAK,UAAU,EAAE,CAAC;IAClC,OAAO,CAAC,GAAG,CAAC,0CAA0C,EAAE,QAAQ,CAAC,UAAU,CAAC,CAAC;IAC7E,IAAI,QAAQ,CAAC,UAAU,KAAK,SAAS,EAAE,CAAC;QACpC,QAAQ,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC;IAC7D,CAAC;SAAM,CAAC;QACJ,CAAC,CAAC,OAAO,EAAE,CAAC;IAChB,CAAC;AACL,CAAC;KAAM,CAAC;IACJ,OAAO,CAAC,KAAK,CAAC,mEAAmE,CAAC,CAAC;AACvF,CAAC;AAED,gCAAgC;AAChC,CAAC,CAAC,gBAAgB,GAAG,IAAI,CAAC","sourcesContent":["/*\r\n * src/ts/compat/expose-globals.ts\r\n * Central adapter to expose modern TS modules on window for legacy consumers.\r\n * This file is used as the single esbuild entry to produce an IIFE bundle.\r\n */\r\n\r\nconsole.log('[BUNDLE] expose-globals.ts loading...');\r\n\r\n// Import the modern module(s) we want to expose explicitly\r\nimport * as DOMUtils from '../dom-utils';\r\n\r\n// Import core constants first (needed by storage, app-init, etc.)\r\nimport '../constants';\r\n\r\n// Import legacy/global modules for their side effects so they register on window.*\r\nimport '../api';\r\nimport '../window-manager';\r\nimport '../action-bus';\r\nimport '../dialog-utils';\r\nimport '../snap-utils';\r\nimport '../program-actions';\r\nimport '../program-menu-sync';\r\nimport '../menu';\r\nimport '../dock';\r\nimport '../dialog';\r\nimport '../menubar-utils';\r\nimport '../context-menu';\r\nimport '../storage';\r\nimport '../session-manager'; // Auto-save system for instances\r\nimport '../theme';\r\nimport '../base-window-instance'; // Must come before instance types\r\nimport '../instance-manager';\r\nimport '../window-chrome';\r\nimport '../window-tabs';\r\nimport '../terminal-instance';\r\nimport '../text-editor-instance';\r\nimport '../text-editor';\r\nimport '../image-viewer-utils';\r\nimport '../logger';\r\nimport '../keyboard-shortcuts';\r\nimport '../github-api';\r\n// Include compiled Photos App JS into the bundle to expose window.PhotosApp\r\n// Using the compiled JS avoids TS encoding issues and ensures identical runtime behavior\r\nimport '../photos-app';\r\n\r\n// Legacy JS modules (copied to src/ts/legacy/ for esbuild compatibility)\r\nimport '../legacy/window-configs.js'; // Must load before windows are registered\r\nimport '../legacy/finder-instance.js';\r\nimport '../legacy/launchpad.js';\r\nimport '../multi-instance-integration';\r\nimport '../legacy/desktop.js';\r\nimport '../legacy/system.js';\r\n\r\n// Finally, include the TypeScript app initialization to bootstrap and signal readiness\r\n// This sets window.__APP_READY = true when the app finishes loading. It must come\r\n// AFTER all side-effect imports above so that globals like WindowManager/Dialog exist.\r\nimport '../app-init';\r\n\r\n// Guarded attach for modern modules not yet on window\r\ntype WindowWithBundle = Window & { __BUNDLE_READY__?: boolean; initApp?: () => void } & Record<\r\n        string,\r\n        unknown\r\n    >;\r\nconst w = window as unknown as WindowWithBundle;\r\n\r\nif (!('DOMUtils' in w)) {\r\n    w['DOMUtils'] = DOMUtils;\r\n}\r\n\r\n// Trigger app initialization manually since the IIFE in app-init.ts\r\n// runs in module scope and may not execute due to esbuild bundling\r\nif (typeof w.initApp === 'function') {\r\n    console.log('[BUNDLE] Triggering initApp; readyState:', document.readyState);\r\n    if (document.readyState === 'loading') {\r\n        document.addEventListener('DOMContentLoaded', w.initApp);\r\n    } else {\r\n        w.initApp();\r\n    }\r\n} else {\r\n    console.error('[BUNDLE] window.initApp is not defined; app initialization failed');\r\n}\r\n\r\n// Optional ready flag for tests\r\nw.__BUNDLE_READY__ = true;\r\n\r\n"]}